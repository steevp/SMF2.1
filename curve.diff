Only in a/Themes: core
diff -ru a/Themes/default/Admin.template.php b/Themes/default/Admin.template.php
--- a/Themes/default/Admin.template.php	2011-06-10 03:42:24.000000000 -0700
+++ b/Themes/default/Admin.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,738 +3,707 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
-// This is the administration center home.
+/**
+ * This is the administration center home.
+ */
 function template_admin()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
 	// Welcome message for the admin.
 	echo '
-	<div id="admincenter">
-		<div class="cat_bar">
-			<h3 class="catbg">';
-
-	if ($context['user']['is_admin'])
-		echo '
-			<object id="quick_search">
-				<form action="', $scripturl, '?action=admin;area=search" method="post" accept-charset="', $context['character_set'], '" class="floatright">
-					<img src="', $settings['images_url'] , '/filter.gif" alt="" />
-					<input type="text" name="search_term" value="', $txt['admin_search'], '" onclick="if (this.value == \'', $txt['admin_search'], '\') this.value = \'\';" class="input_text" />
-					<select name="search_type">
-						<option value="internal"', (empty($context['admin_preferences']['sb']) || $context['admin_preferences']['sb'] == 'internal' ? ' selected="selected"' : ''), '>', $txt['admin_search_type_internal'], '</option>
-						<option value="member"', (!empty($context['admin_preferences']['sb']) && $context['admin_preferences']['sb'] == 'member' ? ' selected="selected"' : ''), '>', $txt['admin_search_type_member'], '</option>
-						<option value="online"', (!empty($context['admin_preferences']['sb']) && $context['admin_preferences']['sb'] == 'online' ? ' selected="selected"' : ''), '>', $txt['admin_search_type_online'], '</option>
-					</select>
-					<input type="submit" name="search_go" id="search_go" value="', $txt['admin_search_go'], '" class="button_submit" />
-				</form>
-			</object>';
-
-	echo $txt['admin_center'], '
-			</h3>
-		</div>
-		<span class="upperframe"><span></span></span>
-		<div class="roundframe">
-			<div id="welcome">
-				<strong>', $txt['hello_guest'], ' ', $context['user']['name'], '!</strong>
-				', sprintf($txt['admin_main_welcome'], $txt['admin_center'], $txt['help'], $txt['help']), '
-			</div>
-		</div>
-		<span class="lowerframe"><span></span></span>';
+					<div id="admincenter">';
 
 	// Is there an update available?
 	echo '
-		<div id="update_section"></div>';
+						<div id="update_section"></div>';
 
 	echo '
-		<div id="admin_main_section">';
+						<div id="admin_main_section">';
 
 	// Display the "live news" from simplemachines.org.
 	echo '
-			<div id="live_news" class="floatleft">
-				<div class="cat_bar">
-					<h3 class="catbg">
-						<span class="ie6_header floatleft"><a href="', $scripturl, '?action=helpadmin;help=live_news" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" class="icon" alt="', $txt['help'], '" /></a> ', $txt['live'], '</span>
-					</h3>
-				</div>
-				<div class="windowbg nopadding">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<div id="smfAnnouncements">', $txt['lfyi'], '</div>
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
-			</div>';
+							<div id="live_news" class="floatleft">
+								<div class="cat_bar">
+									<h3 class="catbg">
+										<a href="', $scripturl, '?action=helpadmin;help=live_news" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a> ', $txt['live'], '
+									</h3>
+								</div>
+								<div class="windowbg nopadding">
+									<div id="smfAnnouncements">', $txt['lfyi'], '</div>
+								</div>
+							</div>';
 
 	// Show the user version information from their server.
 	echo '
-			<div id="supportVersionsTable" class="floatright">
-				<div class="cat_bar">
-					<h3 class="catbg">
-						<a href="', $scripturl, '?action=admin;area=credits">', $txt['support_title'], '</a>
-					</h3>
-				</div>
-				<div class="windowbg nopadding">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<div id="version_details">
-							<strong>', $txt['support_versions'], ':</strong><br />
-							', $txt['support_versions_forum'], ':
-							<em id="yourVersion" style="white-space: nowrap;">', $context['forum_version'], '</em><br />
-							', $txt['support_versions_current'], ':
-							<em id="smfVersion" style="white-space: nowrap;">??</em><br />
-							', $context['can_admin'] ? '<a href="' . $scripturl . '?action=admin;area=maintain;sa=routine;activity=version">' . $txt['version_check_more'] . '</a>' : '', '<br />';
+							<div id="supportVersionsTable" class="floatright">
+								<div class="cat_bar">
+									<h3 class="catbg">
+										<a href="', $scripturl, '?action=admin;area=credits">', $txt['support_title'], '</a>
+									</h3>
+								</div>
+								<div class="windowbg nopadding">
+									<div id="version_details" class="padding">
+										<strong>', $txt['support_versions'], ':</strong><br>
+										', $txt['support_versions_forum'], ':
+										<em id="yourVersion">', $context['forum_version'], '</em><br>
+										', $txt['support_versions_current'], ':
+										<em id="smfVersion">??</em><br>
+										', $context['can_admin'] ? '<a href="' . $scripturl . '?action=admin;area=maintain;sa=routine;activity=version">' . $txt['version_check_more'] . '</a>' : '', '<br>';
 
 	// Display all the members who can administrate the forum.
 	echo '
-							<br />
-							<strong>', $txt['administrators'], ':</strong>
-							', implode(', ', $context['administrators']);
+										<br>
+										<strong>', $txt['administrators'], ':</strong>
+										', implode(', ', $context['administrators']);
 	// If we have lots of admins... don't show them all.
 	if (!empty($context['more_admins_link']))
 		echo '
 							(', $context['more_admins_link'], ')';
 
 	echo '
-						</div>
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
-			</div>
-		</div>';
-
-	echo '
-		<div class="windowbg2 clear_right">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<ul id="quick_tasks" class="flow_hidden">';
-
-	foreach ($context['quick_admin_tasks'] as $task)
-		echo '
-					<li>
-						', !empty($task['icon']) ? '<a href="' . $task['href'] . '"><img src="' . $settings['default_images_url'] . '/admin/' . $task['icon'] . '" alt="" class="home_image png_fix" /></a>' : '', '
-						<h5>', $task['link'], '</h5>
-						<span class="task">', $task['description'],'</span>
-					</li>';
-
-	echo '
-				</ul>
-			</div>
-			<span class="botslice clear"><span></span></span>
-		</div>
-	</div>
-	<br class="clear" />';
+									</div>
+								</div>
+							</div>
+						</div>';
+
+	foreach ($context[$context['admin_menu_name']]['sections'] as $area_id => $area)
+	{
+		echo '
+						<fieldset id="group_', $area_id, '" class="windowbg admin_group">
+							<legend>', $area['title'], '</legend>';
+
+		foreach ($area['areas'] as $item_id => $item)
+		{
+			// No point showing the 'home' page here, we're already on it!
+			if ($area_id == 'forum' && $item_id == 'index')
+				continue;
+
+			$url = isset($item['url']) ? $item['url'] : $scripturl . '?action=admin;area=' . $item_id . (!empty($context[$context['admin_menu_name']]['extra_parameters']) ? $context[$context['admin_menu_name']]['extra_parameters'] : '');
+			if (!empty($item['icon_file']))
+				echo '
+							<a href="', $url, '" class="admin_group', !empty($item['inactive']) ? ' inactive' : '', '"><img class="large_admin_menu_icon_file" src="', $item['icon_file'], '" alt="">', $item['label'], '</a>';
+			else
+				echo '
+							<a href="', $url, '"><span class="large_', $item['icon_class'], !empty($item['inactive']) ? ' inactive' : '', '"></span>', $item['label'], '</a>';
+		}
+
+		echo '
+						</fieldset>';
+	}
+
+	echo '
+					</div>';
 
 	// The below functions include all the scripts needed from the simplemachines.org site. The language and format are passed for internationalization.
 	if (empty($modSettings['disable_smf_js']))
 		echo '
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=current-version.js"></script>
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=latest-news.js"></script>';
+					<script src="', $scripturl, '?action=viewsmfile;filename=current-version.js"></script>
+					<script src="', $scripturl, '?action=viewsmfile;filename=latest-news.js"></script>';
 
 	// This sets the announcements and current versions themselves ;).
 	echo '
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/admin.js?fin20"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var oAdminIndex = new smf_AdminIndex({
-				sSelf: \'oAdminCenter\',
-
-				bLoadAnnouncements: true,
-				sAnnouncementTemplate: ', JavaScriptEscape('
-					<dl>
-						%content%
-					</dl>
-				'), ',
-				sAnnouncementMessageTemplate: ', JavaScriptEscape('
-					<dt><a href="%href%">%subject%</a> ' . $txt['on'] . ' %time%</dt>
-					<dd>
-						%message%
-					</dd>
-				'), ',
-				sAnnouncementContainerId: \'smfAnnouncements\',
-
-				bLoadVersions: true,
-				sSmfVersionContainerId: \'smfVersion\',
-				sYourVersionContainerId: \'yourVersion\',
-				sVersionOutdatedTemplate: ', JavaScriptEscape('
-					<span class="alert">%currentVersion%</span>
-				'), ',
-
-				bLoadUpdateNotification: true,
-				sUpdateNotificationContainerId: \'update_section\',
-				sUpdateNotificationDefaultTitle: ', JavaScriptEscape($txt['update_available']), ',
-				sUpdateNotificationDefaultMessage: ', JavaScriptEscape($txt['update_message']), ',
-				sUpdateNotificationTemplate: ', JavaScriptEscape('
-					<div class="cat_bar">
-						<h3 id="update_title" class="catbg">
-							%title%
-						</h3>
-					</div>
-					<div class="windowbg">
-						<span class="topslice"><span></span></span>
-						<div class="content">
-							<div id="update_message" class="smalltext">
-								%message%
-							</div>
-						</div>
-						<span class="botslice"><span></span></span>
-					</div>
-				'), ',
-				sUpdateNotificationLink: ', JavaScriptEscape($scripturl . '?action=admin;area=packages;pgdownload;auto;package=%package%;' . $context['session_var'] . '=' . $context['session_id']), '
+					<script><!-- // --><![CDATA[
+						var oAdminIndex = new smf_AdminIndex({
+							sSelf: \'oAdminCenter\',
+
+							bLoadAnnouncements: true,
+							sAnnouncementTemplate: ', JavaScriptEscape('
+								<dl>
+									%content%
+								</dl>
+							'), ',
+							sAnnouncementMessageTemplate: ', JavaScriptEscape('
+								<dt><a href="%href%">%subject%</a> ' . $txt['on'] . ' %time%</dt>
+								<dd>
+									%message%
+								</dd>
+							'), ',
+							sAnnouncementContainerId: \'smfAnnouncements\',
+
+							bLoadVersions: true,
+							sSmfVersionContainerId: \'smfVersion\',
+							sYourVersionContainerId: \'yourVersion\',
+							sVersionOutdatedTemplate: ', JavaScriptEscape('
+								<span class="alert">%currentVersion%</span>
+							'), ',
+
+							bLoadUpdateNotification: true,
+							sUpdateNotificationContainerId: \'update_section\',
+							sUpdateNotificationDefaultTitle: ', JavaScriptEscape($txt['update_available']), ',
+							sUpdateNotificationDefaultMessage: ', JavaScriptEscape($txt['update_message']), ',
+							sUpdateNotificationTemplate: ', JavaScriptEscape('
+								<h3 id="update_title">
+									%title%
+								</h3>
+								<div id="update_message" class="smalltext">
+									%message%
+								</div>
+							'), ',
+							sUpdateNotificationLink: smf_scripturl + ', JavaScriptEscape('?action=admin;area=packages;pgdownload;auto;package=%package%;' . $context['session_var'] . '=' . $context['session_id']), '
 
-			});
-		// ]]></script>';
+						});
+					// ]]></script>';
 }
 
-// Show some support information and credits to those who helped make this.
+/**
+ * Show some support information and credits to those who helped make this.
+ */
 function template_credits()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $settings, $scripturl, $txt;
 
 	// Show the user version information from their server.
 	echo '
 
-	<div id="admincenter">
-		<div class="cat_bar">
-			<h3 class="catbg">
-				', $txt['support_title'], '
-			</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<strong>', $txt['support_versions'], ':</strong><br />
-					', $txt['support_versions_forum'], ':
-				<em id="yourVersion" style="white-space: nowrap;">', $context['forum_version'], '</em>', $context['can_admin'] ? ' <a href="' . $scripturl . '?action=admin;area=maintain;sa=routine;activity=version">' . $txt['version_check_more'] . '</a>' : '', '<br />
-					', $txt['support_versions_current'], ':
-				<em id="smfVersion" style="white-space: nowrap;">??</em><br />';
+					<div id="admincenter">
+						<div id="support_credits" class="roundframe">
+							<div class="sub_bar">
+								<h3 class="subbg">
+									', $txt['support_title'], ' <img src="', $settings['images_url'], '/smflogo.png" id="credits_logo" alt="">
+								</h3>
+							</div>
+							<div class="padding">
+								<strong>', $txt['support_versions'], ':</strong><br>
+									', $txt['support_versions_forum'], ':
+								<em id="yourVersion">', $context['forum_version'], '</em>', $context['can_admin'] ? ' <a href="' . $scripturl . '?action=admin;area=maintain;sa=routine;activity=version">' . $txt['version_check_more'] . '</a>' : '', '<br>
+									', $txt['support_versions_current'], ':
+								<em id="smfVersion">??</em><br>';
 
 	// Display all the variables we have server information for.
 	foreach ($context['current_versions'] as $version)
+	{
 		echo '
-					', $version['title'], ':
-				<em>', $version['version'], '</em><br />';
+									', $version['title'], ':
+								<em>', $version['version'], '</em>';
+
+		// more details for this item, show them a link
+		if ($context['can_admin'] && isset($version['more']))
+			echo
+								' <a href="', $scripturl, $version['more'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['version_check_more'], '</a>';
+		echo '
+								<br>';
+	}
 
 	echo '
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-	';
+							</div>';
 
 	// Point the admin to common support resources.
 	echo '
-		<div class="cat_bar">
-			<h3 class="catbg">
-				', $txt['support_resources'], '
-			</h3>
-		</div>
-		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $txt['support_resources_p1'], '</p>
-				<p>', $txt['support_resources_p2'], '</p>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
-
-	// Display latest support questions from simplemachines.org.
-	echo '
-		<div class="cat_bar">
-			<h3 class="catbg">
-				<span class="ie6_header floatleft"><a href="', $scripturl, '?action=helpadmin;help=latest_support" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" class="icon" alt="', $txt['help'], '" /></a> ', $txt['support_latest'], '</span>
-			</h3>
-		</div>
-		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<div id="latestSupport">', $txt['support_latest_fetch'], '</div>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
+							<div id="support_resources" class="sub_bar">
+								<h3 class="subbg">
+									', $txt['support_resources'], '
+								</h3>
+							</div>
+							<div class="padding">
+								<p>', $txt['support_resources_p1'], '</p>
+								<p>', $txt['support_resources_p2'], '</p>
+							</div>';
 
 	// The most important part - the credits :P.
 	echo '
-		<div class="cat_bar">
-			<h3 class="catbg">
-				', $txt['admin_credits'], '
-			</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">';
+							<div id="credits_sections" class="sub_bar">
+								<h3 class="subbg">
+									', $txt['admin_credits'], '
+								</h3>
+							</div>
+							<div class="padding">';
 
 	foreach ($context['credits'] as $section)
 	{
 		if (isset($section['pretext']))
 			echo '
-				<p>', $section['pretext'], '</p>';
+								<p>', $section['pretext'], '</p><hr>';
 
 		echo '
-				<dl>';
+								<dl>';
 
 		foreach ($section['groups'] as $group)
 		{
 			if (isset($group['title']))
 				echo '
-					<dt>
-						<strong>', $group['title'], ':</strong>
-					</dt>';
+									<dt>
+										<strong>', $group['title'], ':</strong>
+									</dt>';
 
 			echo '
-					<dd>', implode(', ', $group['members']), '</dd>';
+									<dd>', implode(', ', $group['members']), '</dd>';
 		}
 
 		echo '
-				</dl>';
+								</dl>';
 
 		if (isset($section['posttext']))
 			echo '
-				<p>', $section['posttext'], '</p>';
+								<hr>
+								<p>', $section['posttext'], '</p>';
 	}
 
 	echo '
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-	</div>
-	<br class="clear" />';
+							</div>
+						</div>
+					</div>';
 
 	// This makes all the support information available to the support script...
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var smfSupportVersions = {};
+						<script><!-- // --><![CDATA[
+							var smfSupportVersions = {};
 
-			smfSupportVersions.forum = "', $context['forum_version'], '";';
+							smfSupportVersions.forum = "', $context['forum_version'], '";';
 
 	// Don't worry, none of this is logged, it's just used to give information that might be of use.
 	foreach ($context['current_versions'] as $variable => $version)
 		echo '
-			smfSupportVersions.', $variable, ' = "', $version['version'], '";';
+							smfSupportVersions.', $variable, ' = "', $version['version'], '";';
 
 	// Now we just have to include the script and wait ;).
 	echo '
-		// ]]></script>
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=current-version.js"></script>
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=latest-news.js"></script>
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=latest-support.js"></script>';
+						// ]]></script>
+						<script src="', $scripturl, '?action=viewsmfile;filename=current-version.js"></script>
+						<script src="', $scripturl, '?action=viewsmfile;filename=latest-news.js"></script>';
 
 	// This sets the latest support stuff.
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			function smfSetLatestSupport()
-			{
-				if (window.smfLatestSupport)
-					setInnerHTML(document.getElementById("latestSupport"), window.smfLatestSupport);
-			}
-
-			function smfCurrentVersion()
-			{
-				var smfVer, yourVer;
-
-				if (!window.smfVersion)
-					return;
-
-				smfVer = document.getElementById("smfVersion");
-				yourVer = document.getElementById("yourVersion");
-
-				setInnerHTML(smfVer, window.smfVersion);
-
-				var currentVersion = getInnerHTML(yourVer);
-				if (currentVersion != window.smfVersion)
-					setInnerHTML(yourVer, "<span class=\"alert\">" + currentVersion + "</span>");
-			}';
-
-	// IE 4 is rather annoying, this wouldn't be necessary...
-	echo '
-			var fSetupCredits = function ()
-			{
-				smfSetLatestSupport();
-				smfCurrentVersion()
-			}
-			addLoadEvent(fSetupCredits);
-		// ]]></script>';
+						<script><!-- // --><![CDATA[
+							function smfCurrentVersion()
+							{
+								var smfVer, yourVer;
+
+								if (!window.smfVersion)
+									return;
+
+								smfVer = document.getElementById("smfVersion");
+								yourVer = document.getElementById("yourVersion");
+
+								setInnerHTML(smfVer, window.smfVersion);
+
+								var currentVersion = getInnerHTML(yourVer);
+								if (currentVersion != window.smfVersion)
+									setInnerHTML(yourVer, "<span class=\"alert\">" + currentVersion + "</span>");
+							}
+							addLoadEvent(smfCurrentVersion)
+						// ]]></script>';
 }
 
-// Displays information about file versions installed, and compares them to current version.
+/**
+ * Displays information about file versions installed, and compares them to current version.
+ */
 function template_view_versions()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
-	<div id="admincenter">
-		<div class="cat_bar">
-			<h3 class="catbg">
-				', $txt['admin_version_check'], '
-			</h3>
-		</div>
-		<div class="information">', $txt['version_check_desc'], '</div>
-			<table width="100%" class="table_grid">
-				<thead>
-					<tr class="catbg" align="left">
-						<th class="first_th" scope="col" width="50%">
-							<strong>', $txt['admin_smffile'], '</strong>
-						</th>
-						<th scope="col" width="25%">
-							<strong>', $txt['dvc_your'], '</strong>
-						</th>
-						<th class="last_th" scope="col"" width="25%">
-							<strong>', $txt['dvc_current'], '</strong>
-						</th>
-					</tr>
-				</thead>
-				<tbody>';
+					<div id="admincenter">
+						<div id="section_header" class="cat_bar">
+							<h3 class="catbg">
+								', $txt['admin_version_check'], '
+							</h3>
+						</div>
+						<div class="information">', $txt['version_check_desc'], '</div>
+						<div id="versions">
+							<table class="table_grid">
+								<thead>
+									<tr class="title_bar">
+										<th class="half_table">
+											<strong>', $txt['admin_smffile'], '</strong>
+										</th>
+										<th class="quarter_table">
+											<strong>', $txt['dvc_your'], '</strong>
+										</th>
+										<th class="quarter_table">
+											<strong>', $txt['dvc_current'], '</strong>
+										</th>
+									</tr>
+								</thead>
+								<tbody>';
 
 	// The current version of the core SMF package.
 	echo '
-					<tr>
-						<td class="windowbg">
-							', $txt['admin_smfpackage'], '
-						</td>
-						<td class="windowbg">
-							<em id="yourSMF">', $context['forum_version'], '</em>
-						</td>
-						<td class="windowbg">
-							<em id="currentSMF">??</em>
-						</td>
-					</tr>';
+									<tr class="windowbg">
+										<td class="half_table">
+											', $txt['admin_smfpackage'], '
+										</td>
+										<td class="quarter_table">
+											<em id="yourSMF">', $context['forum_version'], '</em>
+										</td>
+										<td class="quarter_table">
+											<em id="currentSMF">??</em>
+										</td>
+									</tr>';
 
 	// Now list all the source file versions, starting with the overall version (if all match!).
 	echo '
-					<tr>
-						<td class="windowbg">
-							<a href="#" id="Sources-link">', $txt['dvc_sources'], '</a>
-						</td>
-						<td class="windowbg">
-							<em id="yourSources">??</em>
-						</td>
-						<td class="windowbg">
-							<em id="currentSources">??</em>
-						</td>
-					</tr>
-				</tbody>
-			</table>
+									<tr class="windowbg">
+										<td class="half_table">
+											<a href="#" id="Sources-link">', $txt['dvc_sources'], '</a>
+										</td>
+										<td class="quarter_table">
+											<em id="yourSources">??</em>
+										</td>
+										<td class="quarter_table">
+											<em id="currentSources">??</em>
+										</td>
+									</tr>
+								</tbody>
+							</table>
 
-			<table id="Sources" width="100%" class="table_grid">
-			<tbody>';
+							<table id="Sources" class="table_grid">
+							<tbody>';
 
 	// Loop through every source file displaying its version - using javascript.
 	foreach ($context['file_versions'] as $filename => $version)
 		echo '
-				<tr>
-					<td class="windowbg2" width="50%" style="padding-left: 3ex;">
-						', $filename, '
-					</td>
-					<td class="windowbg2" width="25%">
-						<em id="yourSources', $filename, '">', $version, '</em>
-					</td>
-					<td class="windowbg2" width="25%">
-						<em id="currentSources', $filename, '">??</em>
-					</td>
-				</tr>';
+								<tr class="windowbg">
+									<td class="half_table">
+										', $filename, '
+									</td>
+									<td class="quarter_table">
+										<em id="yourSources', $filename, '">', $version, '</em>
+									</td>
+									<td class="quarter_table">
+										<em id="currentSources', $filename, '">??</em>
+									</td>
+								</tr>';
 
 	// Default template files.
 	echo '
-			</tbody>
-			</table>
+							</tbody>
+							</table>
 
-			<table width="100%" class="table_grid">
-				<tbody>
-					<tr>
-						<td class="windowbg" width="50%">
-							<a href="#" id="Default-link">', $txt['dvc_default'], '</a>
-						</td>
-						<td class="windowbg" width="25%">
-							<em id="yourDefault">??</em>
-						</td>
-						<td class="windowbg" width="25%">
-							<em id="currentDefault">??</em>
-						</td>
-					</tr>
-				</tbody>
-			</table>
+							<table class="table_grid">
+								<tbody>
+									<tr class="windowbg">
+										<td class="half_table">
+											<a href="#" id="Default-link">', $txt['dvc_default'], '</a>
+										</td>
+										<td class="quarter_table">
+											<em id="yourDefault">??</em>
+										</td>
+										<td class="quarter_table">
+											<em id="currentDefault">??</em>
+										</td>
+									</tr>
+								</tbody>
+							</table>
 
-			<table id="Default" width="100%" class="table_grid">
-				<tbody>';
+							<table id="Default" class="table_grid">
+								<tbody>';
 
 	foreach ($context['default_template_versions'] as $filename => $version)
 		echo '
-					<tr>
-						<td class="windowbg2" width="50%" style="padding-left: 3ex;">
-							', $filename, '
-						</td>
-						<td class="windowbg2" width="25%">
-							<em id="yourDefault', $filename, '">', $version, '</em>
-						</td>
-						<td class="windowbg2" width="25%">
-							<em id="currentDefault', $filename, '">??</em>
-						</td>
-					</tr>';
+									<tr class="windowbg">
+										<td class="half_table">
+											', $filename, '
+										</td>
+										<td class="quarter_table">
+											<em id="yourDefault', $filename, '">', $version, '</em>
+										</td>
+										<td class="quarter_table">
+											<em id="currentDefault', $filename, '">??</em>
+										</td>
+									</tr>';
 
 	// Now the language files...
 	echo '
-				</tbody>
-			</table>
+								</tbody>
+							</table>
 
-			<table width="100%" class="table_grid">
-				<tbody>
-					<tr>
-						<td class="windowbg" width="50%">
-							<a href="#" id="Languages-link">', $txt['dvc_languages'], '</a>
-						</td>
-						<td class="windowbg" width="25%">
-							<em id="yourLanguages">??</em>
-						</td>
-						<td class="windowbg" width="25%">
-							<em id="currentLanguages">??</em>
-						</td>
-					</tr>
-				</tbody>
-			</table>
+							<table class="table_grid">
+								<tbody>
+									<tr class="windowbg">
+										<td class="half_table">
+											<a href="#" id="Languages-link">', $txt['dvc_languages'], '</a>
+										</td>
+										<td class="quarter_table">
+											<em id="yourLanguages">??</em>
+										</td>
+										<td class="quarter_table">
+											<em id="currentLanguages">??</em>
+										</td>
+									</tr>
+								</tbody>
+							</table>
 
-			<table id="Languages" width="100%" class="table_grid">
-				<tbody>';
+							<table id="Languages" class="table_grid">
+								<tbody>';
 
 	foreach ($context['default_language_versions'] as $language => $files)
 	{
 		foreach ($files as $filename => $version)
 			echo '
-					<tr>
-						<td class="windowbg2" width="50%" style="padding-left: 3ex;">
-							', $filename, '.<em>', $language, '</em>.php
-						</td>
-						<td class="windowbg2" width="25%">
-							<em id="your', $filename, '.', $language, '">', $version, '</em>
-						</td>
-						<td class="windowbg2" width="25%">
-							<em id="current', $filename, '.', $language, '">??</em>
-						</td>
-					</tr>';
+									<tr class="windowbg">
+										<td class="half_table">
+											', $filename, '.<em>', $language, '</em>.php
+										</td>
+										<td class="quarter_table">
+											<em id="your', $filename, '.', $language, '">', $version, '</em>
+										</td>
+										<td class="quarter_table">
+											<em id="current', $filename, '.', $language, '">??</em>
+										</td>
+									</tr>';
 	}
 
 	echo '
-				</tbody>
-			</table>';
+								</tbody>
+							</table>';
 
-	// Finally, display the version information for the currently selected theme - if it is not the default one.
+	// Display the version information for the currently selected theme - if it is not the default one.
 	if (!empty($context['template_versions']))
 	{
 		echo '
-			<table width="100%" class="table_grid">
-				<tbody>
-					<tr>
-						<td class="windowbg" width="50%">
-							<a href="#" id="Templates-link">', $txt['dvc_templates'], '</a>
-						</td>
-						<td class="windowbg" width="25%">
-							<em id="yourTemplates">??</em>
-						</td>
-						<td class="windowbg" width="25%">
-							<em id="currentTemplates">??</em>
-						</td>
-					</tr>
-				</tbody>
-			</table>
+							<table class="table_grid">
+								<tbody>
+									<tr class="windowbg">
+										<td class="half_table">
+											<a href="#" id="Templates-link">', $txt['dvc_templates'], '</a>
+										</td>
+										<td class="quarter_table">
+											<em id="yourTemplates">??</em>
+										</td>
+										<td class="quarter_table">
+											<em id="currentTemplates">??</em>
+										</td>
+									</tr>
+								</tbody>
+							</table>
 
-			<table id="Templates" width="100%" class="table_grid">
-				<tbody>';
+							<table id="Templates" class="table_grid">
+								<tbody>';
 
 		foreach ($context['template_versions'] as $filename => $version)
 			echo '
-					<tr>
-						<td class="windowbg2" width="50%" style="padding-left: 3ex;">
-							', $filename, '
-						</td>
-						<td class="windowbg2" width="25%">
-							<em id="yourTemplates', $filename, '">', $version, '</em>
-						</td>
-						<td class="windowbg2" width="25%">
-							<em id="currentTemplates', $filename, '">??</em>
-						</td>
-					</tr>';
+									<tr class="windowbg">
+										<td class="half_table">
+											', $filename, '
+										</td>
+										<td class="quarter_table">
+											<em id="yourTemplates', $filename, '">', $version, '</em>
+										</td>
+										<td class="quarter_table">
+											<em id="currentTemplates', $filename, '">??</em>
+										</td>
+									</tr>';
+
+		echo '
+								</tbody>
+							</table>';
+	}
+
+	// Display the tasks files version.
+	if (!empty($context['tasks_versions']))
+	{
+		echo '
+							<table class="table_grid">
+								<tbody>
+									<tr class="windowbg">
+										<td class="half_table">
+											<a href="#" id="Tasks-link">', $txt['dvc_tasks'] ,'</a>
+										</td>
+										<td class="quarter_table">
+											<em id="yourTemplates">??</em>
+										</td>
+										<td class="quarter_table">
+											<em id="currentTemplates">??</em>
+										</td>
+									</tr>
+								</tbody>
+							</table>
+
+							<table id="Tasks" class="table_grid">
+								<tbody>';
+
+		foreach ($context['tasks_versions'] as $filename => $version)
+			echo '
+									<tr class="windowbg">
+										<td class="half_table">
+											', $filename, '
+										</td>
+										<td class="quarter_table">
+											<em id="yourTemplates', $filename, '">', $version, '</em>
+										</td>
+										<td class="quarter_table">
+											<em id="currentTemplates', $filename, '">??</em>
+										</td>
+									</tr>';
 
 		echo '
-				</tbody>
-			</table>';
+								</tbody>
+							</table>';
 	}
 
 	echo '
-		</div>
-	<br class="clear" />';
+						</div>
+						</div>';
 
 	/* Below is the hefty javascript for this. Upon opening the page it checks the current file versions with ones
 	   held at simplemachines.org and works out if they are up to date.  If they aren't it colors that files number
 	   red.  It also contains the function, swapOption, that toggles showing the detailed information for each of the
 	   file categories. (sources, languages, and templates.) */
 	echo '
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=detailed-version.js"></script>
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/admin.js?fin20"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var oViewVersions = new smf_ViewVersions({
-				aKnownLanguages: [
-					\'.', implode('\',
-					\'.', $context['default_known_languages']), '\'
-				],
-				oSectionContainerIds: {
-					Sources: \'Sources\',
-					Default: \'Default\',
-					Languages: \'Languages\',
-					Templates: \'Templates\'
-				}
-			});
-		// ]]></script>';
+						<script src="', $scripturl, '?action=viewsmfile;filename=detailed-version.js"></script>
+						<script><!-- // --><![CDATA[
+							var oViewVersions = new smf_ViewVersions({
+								aKnownLanguages: [
+									\'.', implode('\',
+									\'.', $context['default_known_languages']), '\'
+								],
+								oSectionContainerIds: {
+									Sources: \'Sources\',
+									Default: \'Default\',
+									Languages: \'Languages\',
+									Templates: \'Templates\',
+									Tasks: \'Tasks\'
+								}
+							});
+						// ]]></script>';
 
 }
 
 // Form for stopping people using naughty words, etc.
 function template_edit_censored()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
+
+	if (!empty($context['saved_successful']))
+		echo '
+					<div class="infobox">', $txt['settings_saved'], '</div>';
 
 	// First section is for adding/removing words from the censored list.
 	echo '
-	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=postsettings;sa=censor" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $txt['admin_censored_words'], '
-				</h3>
-			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>', $txt['admin_censored_where'], '</p>';
+					<div id="admincenter">
+						<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=postsettings;sa=censor" method="post" accept-charset="', $context['character_set'], '">
+							<div id="section_header" class="cat_bar">
+								<h3 class="catbg">
+									', $txt['admin_censored_words'], '
+								</h3>
+							</div>
+							<div class="windowbg2">
+								<p>', $txt['admin_censored_where'], '</p>';
 
 	// Show text boxes for censoring [bad   ] => [good  ].
 	foreach ($context['censored_words'] as $vulgar => $proper)
 		echo '
-					<div style="margin-top: 1ex;"><input type="text" name="censor_vulgar[]" value="', $vulgar, '" size="20" /> => <input type="text" name="censor_proper[]" value="', $proper, '" size="20" /></div>';
+								<div class="block">
+									<input type="text" name="censor_vulgar[]" value="', $vulgar, '" size="30"> =&gt; <input type="text" name="censor_proper[]" value="', $proper, '" size="30">
+								</div>';
 
 	// Now provide a way to censor more words.
 	echo '
-					<noscript>
-						<div style="margin-top: 1ex;"><input type="text" name="censor_vulgar[]" size="20" class="input_text" /> => <input type="text" name="censor_proper[]" size="20" class="input_text" /></div>
-					</noscript>
-					<div id="moreCensoredWords"></div><div style="margin-top: 1ex; display: none;" id="moreCensoredWords_link"><a href="#;" onclick="addNewWord(); return false;">', $txt['censor_clickadd'], '</a></div>
-					<script type="text/javascript"><!-- // --><![CDATA[
-						document.getElementById("moreCensoredWords_link").style.display = "";
-
-						function addNewWord()
-						{
-							setOuterHTML(document.getElementById("moreCensoredWords"), \'<div style="margin-top: 1ex;"><input type="text" name="censor_vulgar[]" size="20" class="input_text" /> => <input type="text" name="censor_proper[]" size="20" class="input_text" /><\' + \'/div><div id="moreCensoredWords"><\' + \'/div>\');
-						}
-					// ]]></script>
-					<hr width="100%" size="1" class="hrcolor clear" />
-					<dl class="settings">
-						<dt>
-							<strong><label for="censorWholeWord_check">', $txt['censor_whole_words'], ':</label></strong>
-						</dt>
-						<dd>
-							<input type="checkbox" name="censorWholeWord" value="1" id="censorWholeWord_check"', empty($modSettings['censorWholeWord']) ? '' : ' checked="checked"', ' class="input_check" />
-						</dd>
-						<dt>
-							<strong><label for="censorIgnoreCase_check">', $txt['censor_case'], ':</label></strong>
-						</dt>
-						<dd>
-							<input type="checkbox" name="censorIgnoreCase" value="1" id="censorIgnoreCase_check"', empty($modSettings['censorIgnoreCase']) ? '' : ' checked="checked"', ' class="input_check" />
-						</dd>
-					</dl>
-					<input type="submit" name="save_censor" value="', $txt['save'], '" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
+								<div class="block">
+									<input type="text" name="censor_vulgar[]" size="30" class="input_text"> =&gt; <input type="text" name="censor_proper[]" size="30" class="input_text">
+								</div>
+								<div id="moreCensoredWords"></div><div class="block" style="display: none;" id="moreCensoredWords_link">
+									<a class="button_link" href="#;" onclick="addNewWord(); return false;">', $txt['censor_clickadd'], '</a><br>
+								</div>
+								<script><!-- // --><![CDATA[
+									document.getElementById("moreCensoredWords_link").style.display = "";
+								// ]]></script>
+								<hr width="100%" size="1" class="hrcolor clear">
+								<dl class="settings">
+									<dt>
+										<strong><label for="allow_no_censored">', $txt['allow_no_censored'], ':</label></strong>
+									</dt>
+									<dd>
+										<input type="checkbox" name="allow_no_censored" value="1" id="allow_no_censored"', empty($modSettings['allow_no_censored']) ? '' : ' checked', ' class="input_check">
+									</dd>
+									<dt>
+										<strong><label for="censorWholeWord_check">', $txt['censor_whole_words'], ':</label></strong>
+									</dt>
+									<dd>
+										<input type="checkbox" name="censorWholeWord" value="1" id="censorWholeWord_check"', empty($modSettings['censorWholeWord']) ? '' : ' checked', ' class="input_check">
+									</dd>
+									<dt>
+										<strong><label for="censorIgnoreCase_check">', $txt['censor_case'], ':</label></strong>
+									</dt>
+									<dd>
+										<input type="checkbox" name="censorIgnoreCase" value="1" id="censorIgnoreCase_check"', empty($modSettings['censorIgnoreCase']) ? '' : ' checked', ' class="input_check">
+									</dd>
+								</dl>
+								<input type="submit" name="save_censor" value="', $txt['save'], '" class="button_submit">
+							</div>
+							<br>';
 
 	// This table lets you test out your filters by typing in rude words and seeing what comes out.
 	echo '
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $txt['censor_test'], '
-				</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p class="centertext">
-						<input type="text" name="censortest" value="', empty($context['censor_test']) ? '' : $context['censor_test'], '" class="input_text" />
-						<input type="submit" value="', $txt['censor_test_save'], '" class="button_submit" />
-					</p>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
-	</div>
-	<br class="clear" />';
+							<div class="cat_bar">
+								<h3 class="catbg">
+									', $txt['censor_test'], '
+								</h3>
+							</div>
+							<div class="windowbg2">
+								<p class="centertext">
+									<input type="text" name="censortest" value="', empty($context['censor_test']) ? '' : $context['censor_test'], '" class="input_text">
+									<input type="submit" value="', $txt['censor_test_save'], '" class="button_submit">
+								</p>
+							</div>
+
+							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+							<input type="hidden" name="', $context['admin-censor_token_var'], '" value="', $context['admin-censor_token'], '">
+						</form>
+					</div>';
 }
 
 // Maintenance is a lovely thing, isn't it?
 function template_not_done()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
-	<div id="admincenter">
-		<div class="cat_bar">
-			<h3 class="catbg">
-				', $txt['not_done_title'], '
-			</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				', $txt['not_done_reason'];
+					<div id="admincenter">
+						<div id="section_header" class="cat_bar">
+							<h3 class="catbg">
+								', $txt['not_done_title'], '
+							</h3>
+						</div>
+						<div class="windowbg">
+							', $txt['not_done_reason'];
 
 	if (!empty($context['continue_percent']))
 		echo '
-				<div style="padding-left: 20%; padding-right: 20%; margin-top: 1ex;">
-					<div style="font-size: 8pt; height: 12pt; border: 1px solid black; background-color: white; padding: 1px; position: relative;">
-						<div style="padding-top: ', $context['browser']['is_webkit'] || $context['browser']['is_konqueror'] ? '2pt' : '1pt', '; width: 100%; z-index: 2; color: black; position: absolute; text-align: center; font-weight: bold;">', $context['continue_percent'], '%</div>
-						<div style="width: ', $context['continue_percent'], '%; height: 12pt; z-index: 1; background-color: red;">&nbsp;</div>
-					</div>
-				</div>';
+							<div class="progress_bar">
+								<div class="full_bar">', $context['continue_percent'], '%</div>
+								<div class="green_percent" style="width: ', $context['continue_percent'], '%;">&nbsp;</div>
+							</div>';
 
 	if (!empty($context['substep_enabled']))
 		echo '
-				<div style="padding-left: 20%; padding-right: 20%; margin-top: 1ex;">
-					<span class="smalltext">', $context['substep_title'], '</span>
-					<div style="font-size: 8pt; height: 12pt; border: 1px solid black; background-color: white; padding: 1px; position: relative;">
-						<div style="padding-top: ', $context['browser']['is_webkit'] || $context['browser']['is_konqueror'] ? '2pt' : '1pt', '; width: 100%; z-index: 2; color: black; position: absolute; text-align: center; font-weight: bold;">', $context['substep_continue_percent'], '%</div>
-						<div style="width: ', $context['substep_continue_percent'], '%; height: 12pt; z-index: 1; background-color: blue;">&nbsp;</div>
-					</div>
-				</div>';
+							<div class="progress_bar">
+								<div class="full_bar">', $context['substep_title'], ' (', $context['substep_continue_percent'], '%)</div>
+								<div class="blue_percent" style="width: ', $context['substep_continue_percent'], '%;">&nbsp;</div>
+							</div>';
 
 	echo '
-				<form action="', $scripturl, $context['continue_get_data'], '" method="post" accept-charset="', $context['character_set'], '" style="margin: 0;" name="autoSubmit" id="autoSubmit">
-					<div style="margin: 1ex; text-align: right;"><input type="submit" name="cont" value="', $txt['not_done_continue'], '" class="button_submit" /></div>
-					', $context['continue_post_data'], '
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-	</div>
-	<br class="clear" />
-	<script type="text/javascript"><!-- // --><![CDATA[
-		var countdown = ', $context['continue_countdown'], ';
-		doAutoSubmit();
+							<form action="', $scripturl, $context['continue_get_data'], '" method="post" accept-charset="', $context['character_set'], '" name="autoSubmit" id="autoSubmit">
+								<input type="submit" name="cont" value="', $txt['not_done_continue'], '" class="button_submit">
+								', $context['continue_post_data'], '
+							</form>
+						</div>
+					</div>
+					<script><!-- // --><![CDATA[
+						var countdown = ', $context['continue_countdown'], ';
+						doAutoSubmit();
 
-		function doAutoSubmit()
-		{
-			if (countdown == 0)
-				document.forms.autoSubmit.submit();
-			else if (countdown == -1)
-				return;
+						function doAutoSubmit()
+						{
+							if (countdown == 0)
+								document.forms.autoSubmit.submit();
+							else if (countdown == -1)
+								return;
 
-			document.forms.autoSubmit.cont.value = "', $txt['not_done_continue'], ' (" + countdown + ")";
-			countdown--;
+							document.forms.autoSubmit.cont.value = "', $txt['not_done_continue'], ' (" + countdown + ")";
+							countdown--;
 
-			setTimeout("doAutoSubmit();", 1000);
-		}
-	// ]]></script>';
+							setTimeout("doAutoSubmit();", 1000);
+						}
+					// ]]></script>';
 }
 
 // Template for showing settings (Of any kind really!)
@@ -742,51 +711,35 @@
 {
 	global $context, $txt, $settings, $scripturl;
 
-	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[';
+	if (!empty($context['saved_successful']))
+		echo '
+					<div class="infobox">', $txt['settings_saved'], '</div>';
+	elseif (!empty($context['saved_failed']))
+		echo '
+					<div class="errorbox">', sprintf($txt['settings_not_saved'], $context['saved_failed']), '</div>';
 
 	if (!empty($context['settings_pre_javascript']))
-		echo $context['settings_pre_javascript'];
-
-	// If we have BBC selection we have a bit of JS.
-	if (!empty($context['bbc_sections']))
-	{
 		echo '
-		function toggleBBCDisabled(section, disable)
-		{
-			for (var i = 0; i < document.forms.bbcForm.length; i++)
-			{
-				if (typeof(document.forms.bbcForm[i].name) == "undefined" || (document.forms.bbcForm[i].name.substr(0, 11) != "enabledTags") || (document.forms.bbcForm[i].name.indexOf(section) != 11))
-					continue;
-
-				document.forms.bbcForm[i].disabled = disable;
-			}
-			document.getElementById("bbc_" + section + "_select_all").disabled = disable;
-		}';
-	}
-	echo '
-	// ]]></script>';
+					<script><!-- // --><![CDATA[', $context['settings_pre_javascript'], '// ]]></script>';
 
 	if (!empty($context['settings_insert_above']))
 		echo $context['settings_insert_above'];
 
 	echo '
-	<div id="admincenter">
-		<form action="', $context['post_url'], '" method="post" accept-charset="', $context['character_set'], '"', !empty($context['force_form_onsubmit']) ? ' onsubmit="' . $context['force_form_onsubmit'] . '"' : '', '>';
+					<div id="admincenter">
+						<form id="admin_form_wrapper" action="', $context['post_url'], '" method="post" accept-charset="', $context['character_set'], '"', !empty($context['force_form_onsubmit']) ? ' onsubmit="' . $context['force_form_onsubmit'] . '"' : '', '>';
 
 	// Is there a custom title?
 	if (isset($context['settings_title']))
 		echo '
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $context['settings_title'], '
-				</h3>
-			</div>';
+							<div class="cat_bar">
+								<h3 class="catbg">', $context['settings_title'], '</h3>
+							</div>';
 
-	// Have we got some custom code to insert?
+	// Have we got a message to display?
 	if (!empty($context['settings_message']))
 		echo '
-			<div class="information">', $context['settings_message'], '</div>';
+							<div class="information">', $context['settings_message'], '</div>';
 
 	// Now actually loop through all the variables.
 	$is_open = false;
@@ -800,30 +753,28 @@
 			{
 				$is_open = false;
 				echo '
-					</dl>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
+									</dl>
+							</div>';
 			}
 
 			// A title?
 			if ($config_var['type'] == 'title')
 			{
 				echo '
-					<div class="cat_bar">
-						<h3 class="', !empty($config_var['class']) ? $config_var['class'] : 'catbg', '"', !empty($config_var['force_div_id']) ? ' id="' . $config_var['force_div_id'] . '"' : '', '>
-							', ($config_var['help'] ? '<a href="' . $scripturl . '?action=helpadmin;help=' . $config_var['help'] . '" onclick="return reqWin(this.href);" class="help"><img src="' . $settings['images_url'] . '/helptopics.gif" class="icon" alt="' . $txt['help'] . '" /></a>' : ''), '
-							', $config_var['label'], '
-						</h3>
-					</div>';
+							<div class="cat_bar">
+								<h3 class="', !empty($config_var['class']) ? $config_var['class'] : 'catbg', '"', !empty($config_var['force_div_id']) ? ' id="' . $config_var['force_div_id'] . '"' : '', '>
+									', ($config_var['help'] ? '<a href="' . $scripturl . '?action=helpadmin;help=' . $config_var['help'] . '" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="'. $txt['help'].'"></span></a>' : ''), '
+									', $config_var['label'], '
+								</h3>
+							</div>';
 			}
 			// A description?
 			else
 			{
 				echo '
-					<p class="description">
-						', $config_var['label'], '
-					</p>';
+							<div class="information winfo">
+								', $config_var['label'], '
+							</div>';
 			}
 
 			continue;
@@ -834,10 +785,8 @@
 		{
 			$is_open = true;
 			echo '
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">';
+							<div class="windowbg2">
+								<dl class="settings">';
 		}
 
 		// Hang about? Are you pulling my leg - a callback?!
@@ -855,59 +804,87 @@
 			if (in_array($config_var['type'], array('message', 'warning')))
 			{
 				echo '
-						<dd', $config_var['type'] == 'warning' ? ' class="alert"' : '', (!empty($config_var['force_div_id']) ? ' id="' . $config_var['force_div_id'] . '_dd"' : ''), '>
-							', $config_var['label'], '
-						</dd>';
+									<dd', $config_var['type'] == 'warning' ? ' class="alert"' : '', (!empty($config_var['force_div_id']) ? ' id="' . $config_var['force_div_id'] . '_dd"' : ''), '>
+										', $config_var['label'], '
+									</dd>';
 			}
 			// Otherwise it's an input box of some kind.
 			else
 			{
 				echo '
-						<dt', is_array($config_var) && !empty($config_var['force_div_id']) ? ' id="' . $config_var['force_div_id'] . '"' : '', '>';
+									<dt', is_array($config_var) && !empty($config_var['force_div_id']) ? ' id="' . $config_var['force_div_id'] . '"' : '', '>';
 
 				// Some quick helpers...
 				$javascript = $config_var['javascript'];
-				$disabled = !empty($config_var['disabled']) ? ' disabled="disabled"' : '';
-				$subtext = !empty($config_var['subtext']) ? '<br /><span class="smalltext"> ' . $config_var['subtext'] . '</span>' : '';
+				$disabled = !empty($config_var['disabled']) ? ' disabled' : '';
+				$subtext = !empty($config_var['subtext']) ? '<br><span class="smalltext"> ' . $config_var['subtext'] . '</span>' : '';
+
+				// Various HTML5 input types that are basically enhanced textboxes
+				$text_types = array('color', 'date', 'datetime', 'datetime-local', 'email', 'month', 'time');
 
 				// Show the [?] button.
 				if ($config_var['help'])
 					echo '
-							<a id="setting_', $config_var['name'], '" href="', $scripturl, '?action=helpadmin;help=', $config_var['help'], '" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" class="icon" alt="', $txt['help'], '" /></a><span', ($config_var['disabled'] ? ' style="color: #777777;"' : ($config_var['invalid'] ? ' class="error"' : '')), '><label for="', $config_var['name'], '">', $config_var['label'], '</label>', $subtext, ($config_var['type'] == 'password' ? '<br /><em>' . $txt['admin_confirm_password'] . '</em>' : ''), '</span>
-						</dt>';
-				else
-					echo '
-							<a id="setting_', $config_var['name'], '"></a> <span', ($config_var['disabled'] ? ' style="color: #777777;"' : ($config_var['invalid'] ? ' class="error"' : '')), '><label for="', $config_var['name'], '">', $config_var['label'], '</label>', $subtext, ($config_var['type'] == 'password' ? '<br /><em>' . $txt['admin_confirm_password'] . '</em>' : ''), '</span>
-						</dt>';
+							<a id="setting_', $config_var['name'], '" href="', $scripturl, '?action=helpadmin;help=', $config_var['help'], '" onclick="return reqOverlayDiv(this.href);"><span class="generic_icons help" title="', $txt['help'],'"></span></a> ';
 
 				echo '
-						<dd', (!empty($config_var['force_div_id']) ? ' id="' . $config_var['force_div_id'] . '_dd"' : ''), '>',
-							$config_var['preinput'];
+										<a id="setting_', $config_var['name'], '"></a> <span', ($config_var['disabled'] ? ' style="color: #777777;"' : ($config_var['invalid'] ? ' class="error"' : '')), '><label for="', $config_var['name'], '">', $config_var['label'], '</label>', $subtext, ($config_var['type'] == 'password' ? '<br><em>' . $txt['admin_confirm_password'] . '</em>' : ''), '</span>
+									</dt>
+									<dd', (!empty($config_var['force_div_id']) ? ' id="' . $config_var['force_div_id'] . '_dd"' : ''), '>',
+										$config_var['preinput'];
 
 				// Show a check box.
 				if ($config_var['type'] == 'check')
 					echo '
-							<input type="checkbox"', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '"', ($config_var['value'] ? ' checked="checked"' : ''), ' value="1" class="input_check" />';
+										<input type="checkbox"', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '"', ($config_var['value'] ? ' checked' : ''), ' value="1" class="input_check">';
 				// Escape (via htmlspecialchars.) the text box.
 				elseif ($config_var['type'] == 'password')
 					echo '
-							<input type="password"', $disabled, $javascript, ' name="', $config_var['name'], '[0]"', ($config_var['size'] ? ' size="' . $config_var['size'] . '"' : ''), ' value="*#fakepass#*" onfocus="this.value = \'\'; this.form.', $config_var['name'], '.disabled = false;" class="input_password" /><br />
-							<input type="password" disabled="disabled" id="', $config_var['name'], '" name="', $config_var['name'], '[1]"', ($config_var['size'] ? ' size="' . $config_var['size'] . '"' : ''), ' class="input_password" />';
+										<input type="password"', $disabled, $javascript, ' name="', $config_var['name'], '[0]"', ($config_var['size'] ? ' size="' . $config_var['size'] . '"' : ''), ' value="*#fakepass#*" onfocus="this.value = \'\'; this.form.', $config_var['name'], '.disabled = false;" class="input_password"><br>
+										<input type="password" disabled id="', $config_var['name'], '" name="', $config_var['name'], '[1]"', ($config_var['size'] ? ' size="' . $config_var['size'] . '"' : ''), ' class="input_password">';
 				// Show a selection box.
 				elseif ($config_var['type'] == 'select')
 				{
 					echo '
-							<select name="', $config_var['name'], '" id="', $config_var['name'], '" ', $javascript, $disabled, (!empty($config_var['multiple']) ? ' multiple="multiple"' : ''), '>';
+										<select name="', $config_var['name'], '" id="', $config_var['name'], '" ', $javascript, $disabled, (!empty($config_var['multiple']) ? ' multiple="multiple"' : ''), '>';
 					foreach ($config_var['data'] as $option)
 						echo '
-								<option value="', $option[0], '"', (($option[0] == $config_var['value'] || (!empty($config_var['multiple']) && in_array($option[0], $config_var['value']))) ? ' selected="selected"' : ''), '>', $option[1], '</option>';
+											<option value="', $option[0], '"', (!empty($config_var['value']) && ($option[0] == $config_var['value'] || (!empty($config_var['multiple']) && in_array($option[0], $config_var['value']))) ? ' selected' : ''), '>', $option[1], '</option>';
+					echo '
+										</select>';
+				}
+				// List of boards? This requires getBoardList() having been run and the results in $context['board_list'].
+				elseif ($config_var['type'] == 'boards')
+				{
+					$board_list = true;
+					$first = true;
+					echo '
+										<a href="#" class="board_selector">[ ', $txt['select_boards_from_list'], ' ]</a>
+										<fieldset>
+												<legend class="board_selector"><a href="#">', $txt['select_boards_from_list'], '</a></legend>';
+					foreach ($context['board_list'] as $id_cat => $cat)
+					{
+						if (!$first)
+							echo '
+											<hr>';
+						echo '
+											<strong>', $cat['name'], '</strong>
+											<ul>';
+						foreach ($cat['boards'] as $id_board => $brd)
+							echo '
+												<li><label><input type="checkbox" name="', $config_var['name'], '[', $brd['id'], ']" value="1" class="input_check"', in_array($brd['id'], $config_var['value']) ? ' checked' : '', '> ', $brd['child_level'] > 0 ? str_repeat('&nbsp; &nbsp;', $brd['child_level']) : '', $brd['name'], '</label></li>';
+
+						echo '
+											</ul>';
+						$first = false;
+					}
 					echo '
-							</select>';
+											</fieldset>';
 				}
 				// Text area?
 				elseif ($config_var['type'] == 'large_text')
 					echo '
-							<textarea rows="', ($config_var['size'] ? $config_var['size'] : 4), '" cols="30" ', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '">', $config_var['value'], '</textarea>';
+											<textarea rows="', (!empty($config_var['size']) ? $config_var['size'] : (!empty($config_var['rows']) ? $config_var['rows'] : 4)), '" cols="', (!empty($config_var['cols']) ? $config_var['cols'] : 30), '" ', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '">', $config_var['value'], '</textarea>';
 				// Permission group?
 				elseif ($config_var['type'] == 'permissions')
 					theme_inline_permissions($config_var['name']);
@@ -915,34 +892,49 @@
 				elseif ($config_var['type'] == 'bbc')
 				{
 					echo '
-							<fieldset id="', $config_var['name'], '">
-								<legend>', $txt['bbcTagsToUse_select'], '</legend>
-									<ul class="reset">';
+											<fieldset id="', $config_var['name'], '">
+												<legend>', $txt['bbcTagsToUse_select'], '</legend>
+													<ul class="reset">';
 
 					foreach ($context['bbc_columns'] as $bbcColumn)
 					{
 						foreach ($bbcColumn as $bbcTag)
 							echo '
-										<li class="list_bbc floatleft">
-											<input type="checkbox" name="', $config_var['name'], '_enabledTags[]" id="tag_', $config_var['name'], '_', $bbcTag['tag'], '" value="', $bbcTag['tag'], '"', !in_array($bbcTag['tag'], $context['bbc_sections'][$config_var['name']]['disabled']) ? ' checked="checked"' : '', ' class="input_check" /> <label for="tag_', $config_var['name'], '_', $bbcTag['tag'], '">', $bbcTag['tag'], '</label>', $bbcTag['show_help'] ? ' (<a href="' . $scripturl . '?action=helpadmin;help=tag_' . $bbcTag['tag'] . '" onclick="return reqWin(this.href);">?</a>)' : '', '
-										</li>';
+														<li class="list_bbc floatleft">
+															<input type="checkbox" name="', $config_var['name'], '_enabledTags[]" id="tag_', $config_var['name'], '_', $bbcTag['tag'], '" value="', $bbcTag['tag'], '"', !in_array($bbcTag['tag'], $context['bbc_sections'][$config_var['name']]['disabled']) ? ' checked' : '', ' class="input_check"> <label for="tag_', $config_var['name'], '_', $bbcTag['tag'], '">', $bbcTag['tag'], '</label>', $bbcTag['show_help'] ? ' (<a href="' . $scripturl . '?action=helpadmin;help=tag_' . $bbcTag['tag'] . '" onclick="return reqOverlayDiv(this.href);">?</a>)' : '', '
+														</li>';
 					}
-					echo '			</ul>
-								<input type="checkbox" id="select_all" onclick="invertAll(this, this.form, \'', $config_var['name'], '_enabledTags\');"', $context['bbc_sections'][$config_var['name']]['all_selected'] ? ' checked="checked"' : '', ' class="input_check" /> <label for="select_all"><em>', $txt['bbcTagsToUse_select_all'], '</em></label>
-							</fieldset>';
+					echo '							</ul>
+												<input type="checkbox" id="bbc_', $config_var['name'], '_select_all" onclick="invertAll(this, this.form, \'', $config_var['name'], '_enabledTags\');"', $context['bbc_sections'][$config_var['name']]['all_selected'] ? ' checked' : '', ' class="input_check"> <label for="bbc_', $config_var['name'], '_select_all"><em>', $txt['bbcTagsToUse_select_all'], '</em></label>
+											</fieldset>';
 				}
 				// A simple message?
 				elseif ($config_var['type'] == 'var_message')
 					echo '
-							<div', !empty($config_var['name']) ? ' id="' . $config_var['name'] . '"' : '', '>', $config_var['var_message'], '</div>';
-				// Assume it must be a text box.
+											<div', !empty($config_var['name']) ? ' id="' . $config_var['name'] . '"' : '', '>', $config_var['var_message'], '</div>';
+				// Assume it must be a text box
 				else
+				{
+					// Figure out the exact type - use "number" for "float" and "int".
+					$type = in_array($config_var['type'], $text_types) ? $config_var['type'] : ($config_var['type'] == 'int' || $config_var['type'] == 'float' ? 'number' : 'text');
+
+					// Extra options for float/int values - how much to decrease/increase by, the min value and the max value
+					// The step - only set if incrementing by something other than 1 for int or 0.1 for float
+					$step = isset($config_var['step']) ? ' step="' . $config_var['step'] . '"' : ($config_var['type'] == 'float' ? ' step="0.1"' : '');
+
+					// Minimum allowed value for this setting. SMF forces a default of 0 if not specified in the settings
+					$min = isset($config_var['min']) ? ' min="' . $config_var['min'] . '"' : '';
+
+					// Maximum allowed value for this setting.
+					$max = isset($config_var['max']) ? ' max="' . $config_var['max'] . '"' : '';
+
 					echo '
-							<input type="text"', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '" value="', $config_var['value'], '"', ($config_var['size'] ? ' size="' . $config_var['size'] . '"' : ''), ' class="input_text" />';
+											<input type="', $type ,'"', $javascript, $disabled, ' name="', $config_var['name'], '" id="', $config_var['name'], '" value="', $config_var['value'], '"', ($config_var['size'] ? ' size="' . $config_var['size'] . '"' : ''), ' class="input_text"', $min . $max . $step, '>';
+				}
 
 				echo isset($config_var['postinput']) ? '
-							' . $config_var['postinput'] : '',
-						'</dd>';
+											' . $config_var['postinput'] : '',
+										'</dd>';
 			}
 		}
 
@@ -951,65 +943,90 @@
 			// Just show a separator.
 			if ($config_var == '')
 				echo '
-					</dl>
-					<hr class="hrcolor clear" />
-					<dl class="settings">';
+								</dl>
+								<hr class="hrcolor clear">
+								<dl class="settings">';
 			else
 				echo '
-						<dd>
-							<strong>' . $config_var . '</strong>
-						</dd>';
+									<dd>
+										<strong>' . $config_var . '</strong>
+									</dd>';
 		}
 	}
 
 	if ($is_open)
 		echo '
-					</dl>';
+								</dl>';
 
 	if (empty($context['settings_save_dont_show']))
 		echo '
-					<hr class="hrcolor clear" />
-					<div class="righttext">
-						<input type="submit" value="', $txt['save'], '"', (!empty($context['save_disabled']) ? ' disabled="disabled"' : ''), (!empty($context['settings_save_onclick']) ? ' onclick="' . $context['settings_save_onclick'] . '"' : ''), ' class="button_submit" />
-					</div>';
+								<input type="submit" value="', $txt['save'], '"', (!empty($context['save_disabled']) ? ' disabled' : ''), (!empty($context['settings_save_onclick']) ? ' onclick="' . $context['settings_save_onclick'] . '"' : ''), ' class="button_submit">';
 
 	if ($is_open)
 		echo '
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
+							</div>';
+
+
+	// At least one token has to be used!
+	if (isset($context['admin-ssc_token']))
+		echo '
+							<input type="hidden" name="', $context['admin-ssc_token_var'], '" value="', $context['admin-ssc_token'], '">';
+
+	if (isset($context['admin-dbsc_token']))
+		echo '
+							<input type="hidden" name="', $context['admin-dbsc_token_var'], '" value="', $context['admin-dbsc_token'], '">';
+
+	if (isset($context['admin-mp_token']))
+		echo '
+							<input type="hidden" name="', $context['admin-mp_token_var'], '" value="', $context['admin-mp_token'], '">';
 
 	echo '
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
-	</div>
-	<br class="clear" />';
+							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+						</form>
+					</div>';
 
 	if (!empty($context['settings_post_javascript']))
 		echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-	', $context['settings_post_javascript'], '
-	// ]]></script>';
+					<script><!-- // --><![CDATA[
+					', $context['settings_post_javascript'], '
+					// ]]></script>';
 
 	if (!empty($context['settings_insert_below']))
 		echo $context['settings_insert_below'];
+
+	// We may have added a board listing. If we did, we need to make it work.
+	addInlineJavascript('
+	$("legend.board_selector").closest("fieldset").hide();
+	$("a.board_selector").click(function(e) {
+		e.preventDefault();
+		$(this).hide().next("fieldset").show();
+	});
+	$("fieldset legend.board_selector a").click(function(e) {
+		e.preventDefault();
+		$(this).closest("fieldset").hide().prev("a").show();
+	});
+	', true);
 }
 
 // Template for showing custom profile fields.
 function template_show_custom_profile()
 {
-	global $context, $txt, $settings, $scripturl;
+	global $context, $txt;
+
+	if (!empty($context['saved_successful']))
+		echo '
+					<div class="infobox">', $txt['settings_saved'], '</div>';
 
 	// Standard fields.
 	template_show_list('standard_profile_fields');
 
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		var iNumChecks = document.forms.standardProfileFields.length;
-		for (var i = 0; i < iNumChecks; i++)
-			if (document.forms.standardProfileFields[i].id.indexOf(\'reg_\') == 0)
-				document.forms.standardProfileFields[i].disabled = document.forms.standardProfileFields[i].disabled || !document.getElementById(\'active_\' + document.forms.standardProfileFields[i].id.substr(4)).checked;
-	// ]]></script><br />';
+					<script><!-- // --><![CDATA[
+						var iNumChecks = document.forms.standardProfileFields.length;
+						for (var i = 0; i < iNumChecks; i++)
+							if (document.forms.standardProfileFields[i].id.indexOf(\'reg_\') == 0)
+								document.forms.standardProfileFields[i].disabled = document.forms.standardProfileFields[i].disabled || !document.getElementById(\'active_\' + document.forms.standardProfileFields[i].id.substr(4)).checked;
+					// ]]></script><br>';
 
 	// Custom fields.
 	template_show_list('custom_profile_fields');
@@ -1020,1093 +1037,562 @@
 {
 	global $context, $txt, $settings, $scripturl;
 
-	// All the javascript for this page - quite a bit!
+	// All the javascript for this page - quite a bit in script.js!
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function updateInputBoxes()
-		{
-			curType = document.getElementById("field_type").value;
-			privStatus = document.getElementById("private").value;
-			document.getElementById("max_length_dt").style.display = curType == "text" || curType == "textarea" ? "" : "none";
-			document.getElementById("max_length_dd").style.display = curType == "text" || curType == "textarea" ? "" : "none";
-			document.getElementById("dimension_dt").style.display = curType == "textarea" ? "" : "none";
-			document.getElementById("dimension_dd").style.display = curType == "textarea" ? "" : "none";
-			document.getElementById("bbc_dt").style.display = curType == "text" || curType == "textarea" ? "" : "none";
-			document.getElementById("bbc_dd").style.display = curType == "text" || curType == "textarea" ? "" : "none";
-			document.getElementById("options_dt").style.display = curType == "select" || curType == "radio" ? "" : "none";
-			document.getElementById("options_dd").style.display = curType == "select" || curType == "radio" ? "" : "none";
-			document.getElementById("default_dt").style.display = curType == "check" ? "" : "none";
-			document.getElementById("default_dd").style.display = curType == "check" ? "" : "none";
-			document.getElementById("mask_dt").style.display = curType == "text" ? "" : "none";
-			document.getElementById("mask").style.display = curType == "text" ? "" : "none";
-			document.getElementById("can_search_dt").style.display = curType == "text" || curType == "textarea" ? "" : "none";
-			document.getElementById("can_search_dd").style.display = curType == "text" || curType == "textarea" ? "" : "none";
-			document.getElementById("regex_div").style.display = curType == "text" && document.getElementById("mask").value == "regex" ? "" : "none";
-			document.getElementById("display").disabled = false;
-			// Cannot show this on the topic
-			if (curType == "textarea" || privStatus >= 2)
-			{
-				document.getElementById("display").checked = false;
-				document.getElementById("display").disabled = true;
-			}
-		}
+					<script><!-- // --><![CDATA[
+						var startOptID = ', count($context['field']['options']), ';
+					// ]]></script>';
 
-		var startOptID = ', count($context['field']['options']), ';
-		function addOption()
-		{
-			setOuterHTML(document.getElementById("addopt"), \'<br /><input type="radio" name="default_select" value="\' + startOptID + \'" id="\' + startOptID + \'" class="input_radio" /><input type="text" name="select_option[\' + startOptID + \']" value="" class="input_text" /><span id="addopt"></span>\');
-			startOptID++;
-		}
-	// ]]></script>';
+	// any errors messages to show?
+	if (isset($_GET['msg']))
+	{
+		loadLanguage('Errors');
+		if (isset($txt['custom_option_' . $_GET['msg']]))
+			echo '
+					<div class="errorbox">',
+						$txt['custom_option_' . $_GET['msg']], '
+					</div>';
+	}
 
 	echo '
-	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=featuresettings;sa=profileedit;fid=', $context['fid'], ';', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $context['page_title'], '
-				</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<fieldset>
-						<legend>', $txt['custom_edit_general'], '</legend>
-
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['custom_edit_name'], ':</strong>
-							</dt>
-							<dd>
-								<input type="text" name="field_name" value="', $context['field']['name'], '" size="20" maxlength="40" class="input_text" />
-							</dd>
-							<dt>
-								<strong>', $txt['custom_edit_desc'], ':</strong>
-							</dt>
-							<dd>
-								<textarea name="field_desc" rows="3" cols="40">', $context['field']['desc'], '</textarea>
-							</dd>
-							<dt>
-								<strong>', $txt['custom_edit_profile'], ':</strong><br />
-								<span class="smalltext">', $txt['custom_edit_profile_desc'], '</span>
-							</dt>
-							<dd>
-								<select name="profile_area">
-									<option value="none"', $context['field']['profile_area'] == 'none' ? ' selected="selected"' : '', '>', $txt['custom_edit_profile_none'], '</option>
-									<option value="account"', $context['field']['profile_area'] == 'account' ? ' selected="selected"' : '', '>', $txt['account'], '</option>
-									<option value="forumprofile"', $context['field']['profile_area'] == 'forumprofile' ? ' selected="selected"' : '', '>', $txt['forumprofile'], '</option>
-									<option value="theme"', $context['field']['profile_area'] == 'theme' ? ' selected="selected"' : '', '>', $txt['theme'], '</option>
-								</select>
-							</dd>
-							<dt>
-								<strong>', $txt['custom_edit_registration'], ':</strong>
-							</dt>
-							<dd>
-								<select name="reg" id="reg">
-									<option value="0"', $context['field']['reg'] == 0 ? ' selected="selected"' : '', '>', $txt['custom_edit_registration_disable'], '</option>
-									<option value="1"', $context['field']['reg'] == 1 ? ' selected="selected"' : '', '>', $txt['custom_edit_registration_allow'], '</option>
-									<option value="2"', $context['field']['reg'] == 2 ? ' selected="selected"' : '', '>', $txt['custom_edit_registration_require'], '</option>
-								</select>
-							</dd>
-							<dt>
-								<strong>', $txt['custom_edit_display'], ':</strong>
-							</dt>
-							<dd>
-								<input type="checkbox" name="display" id="display"', $context['field']['display'] ? ' checked="checked"' : '', ' class="input_check" />
-							</dd>
-
-							<dt>
-								<strong>', $txt['custom_edit_placement'], ':</strong>
-							</dt>
-							<dd>
-								<select name="placement" id="placement">
-									<option value="0"', $context['field']['placement'] == '0' ? ' selected="selected"' : '', '>', $txt['custom_edit_placement_standard'], '</option>
-									<option value="1"', $context['field']['placement'] == '1' ? ' selected="selected"' : '', '>', $txt['custom_edit_placement_withicons'], '</option>
-									<option value="2"', $context['field']['placement'] == '2' ? ' selected="selected"' : '', '>', $txt['custom_edit_placement_abovesignature'], '</option>
-								</select>
-							</dd>
-							<dt>
-								<a id="field_show_enclosed" href="', $scripturl, '?action=helpadmin;help=field_show_enclosed" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" class="icon" alt="', $txt['help'], '" align="top" /></a>
-								<strong>', $txt['custom_edit_enclose'], ':</strong><br />
-								<span class="smalltext">', $txt['custom_edit_enclose_desc'], '</span>
-							</dt>
-							<dd>
-								<textarea name="enclose" rows="10" cols="50">', @$context['field']['enclose'], '</textarea>
-							</dd>
-						</dl>
-					</fieldset>
-					<fieldset>
-						<legend>', $txt['custom_edit_input'], '</legend>
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['custom_edit_picktype'], ':</strong>
-							</dt>
-							<dd>
-								<select name="field_type" id="field_type" onchange="updateInputBoxes();">
-									<option value="text"', $context['field']['type'] == 'text' ? ' selected="selected"' : '', '>', $txt['custom_profile_type_text'], '</option>
-									<option value="textarea"', $context['field']['type'] == 'textarea' ? ' selected="selected"' : '', '>', $txt['custom_profile_type_textarea'], '</option>
-									<option value="select"', $context['field']['type'] == 'select' ? ' selected="selected"' : '', '>', $txt['custom_profile_type_select'], '</option>
-									<option value="radio"', $context['field']['type'] == 'radio' ? ' selected="selected"' : '', '>', $txt['custom_profile_type_radio'], '</option>
-									<option value="check"', $context['field']['type'] == 'check' ? ' selected="selected"' : '', '>', $txt['custom_profile_type_check'], '</option>
-								</select>
-							</dd>
-							<dt id="max_length_dt">
-								<strong>', $txt['custom_edit_max_length'], ':</strong><br />
-								<span class="smalltext">', $txt['custom_edit_max_length_desc'], '</span>
-							</dt>
-							<dd id="max_length_dd">
-								<input type="text" name="max_length" value="', $context['field']['max_length'], '" size="7" maxlength="6" class="input_text" />
-							</dd>
-							<dt id="dimension_dt">
-								<strong>', $txt['custom_edit_dimension'], ':</strong>
-							</dt>
-							<dd id="dimension_dd">
-								<strong>', $txt['custom_edit_dimension_row'], ':</strong> <input type="text" name="rows" value="', $context['field']['rows'], '" size="5" maxlength="3" class="input_text" />
-								<strong>', $txt['custom_edit_dimension_col'], ':</strong> <input type="text" name="cols" value="', $context['field']['cols'], '" size="5" maxlength="3" class="input_text" />
-							</dd>
-							<dt id="bbc_dt">
-								<strong>', $txt['custom_edit_bbc'], '</strong>
-							</dt>
-							<dd id="bbc_dd">
-								<input type="checkbox" name="bbc"', $context['field']['bbc'] ? ' checked="checked"' : '', ' class="input_check" />
-							</dd>
-							<dt id="options_dt">
-								<a href="', $scripturl, '?action=helpadmin;help=customoptions" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" class="icon" alt="', $txt['help'], '" /></a>
-								<strong>', $txt['custom_edit_options'], ':</strong><br />
-								<span class="smalltext">', $txt['custom_edit_options_desc'], '</span>
-							</dt>
-							<dd id="options_dd">
-								<div>';
+					<div id="admincenter">
+						<form action="', $scripturl, '?action=admin;area=featuresettings;sa=profileedit;fid=', $context['fid'], ';', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
+							<div id="section_header" class="cat_bar">
+								<h3 class="catbg">', $context['page_title'], '</h3>
+							</div>
+							<div class="windowbg">
+								<fieldset>
+									<legend>', $txt['custom_edit_general'], '</legend>
+
+									<dl class="settings">
+										<dt>
+											<strong><label for="field_name">', $txt['custom_edit_name'], ':</label></strong>
+										</dt>
+										<dd>
+											<input type="text" name="field_name" id="field_name" value="', $context['field']['name'], '" size="20" maxlength="40" class="input_text">
+										</dd>
+										<dt>
+											<strong><label for="field_desc">', $txt['custom_edit_desc'], ':</label></strong>
+										</dt>
+										<dd>
+											<textarea name="field_desc" id="field_desc" rows="3" cols="40">', $context['field']['desc'], '</textarea>
+										</dd>
+										<dt>
+											<strong><label for="profile_area">', $txt['custom_edit_profile'], ':</label></strong><br>
+											<span class="smalltext">', $txt['custom_edit_profile_desc'], '</span>
+										</dt>
+										<dd>
+											<select name="profile_area" id="profile_area">
+												<option value="none"', $context['field']['profile_area'] == 'none' ? ' selected' : '', '>', $txt['custom_edit_profile_none'], '</option>
+												<option value="account"', $context['field']['profile_area'] == 'account' ? ' selected' : '', '>', $txt['account'], '</option>
+												<option value="forumprofile"', $context['field']['profile_area'] == 'forumprofile' ? ' selected' : '', '>', $txt['forumprofile'], '</option>
+												<option value="theme"', $context['field']['profile_area'] == 'theme' ? ' selected' : '', '>', $txt['theme'], '</option>
+											</select>
+										</dd>
+										<dt>
+											<strong><label for="reg">', $txt['custom_edit_registration'], ':</label></strong>
+										</dt>
+										<dd>
+											<select name="reg" id="reg">
+												<option value="0"', $context['field']['reg'] == 0 ? ' selected' : '', '>', $txt['custom_edit_registration_disable'], '</option>
+												<option value="1"', $context['field']['reg'] == 1 ? ' selected' : '', '>', $txt['custom_edit_registration_allow'], '</option>
+												<option value="2"', $context['field']['reg'] == 2 ? ' selected' : '', '>', $txt['custom_edit_registration_require'], '</option>
+											</select>
+										</dd>
+										<dt>
+											<strong><label for="display">', $txt['custom_edit_display'], ':</label></strong>
+										</dt>
+										<dd>
+											<input type="checkbox" name="display" id="display"', $context['field']['display'] ? ' checked' : '', ' class="input_check">
+										</dd>
+										<dt>
+											<strong><label for="mlist">', $txt['custom_edit_mlist'], ':</label></strong>
+										</dt>
+										<dd>
+											<input type="checkbox" name="mlist" id="show_mlist"', $context['field']['mlist'] ? ' checked' : '', ' class="input_check">
+										</dd>
+										<dt>
+											<strong><label for="placement">', $txt['custom_edit_placement'], ':</label></strong>
+										</dt>
+										<dd>
+											<select name="placement" id="placement">';
+
+	foreach ($context['cust_profile_fields_placement'] as $order => $name)
+		echo '
+												<option value="', $order ,'"', $context['field']['placement'] == $order ? ' selected' : '', '>', $txt['custom_profile_placement_'. $name], '</option>';
+
+	echo '
+											</select>
+										</dd>
+										<dt>
+											<a id="field_show_enclosed" href="', $scripturl, '?action=helpadmin;help=field_show_enclosed" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a>
+											<strong><label for="enclose">', $txt['custom_edit_enclose'], ':</label></strong><br>
+											<span class="smalltext">', $txt['custom_edit_enclose_desc'], '</span>
+										</dt>
+										<dd>
+											<textarea name="enclose" id="enclose" rows="10" cols="50">', @$context['field']['enclose'], '</textarea>
+										</dd>
+									</dl>
+								</fieldset>
+								<fieldset>
+									<legend>', $txt['custom_edit_input'], '</legend>
+									<dl class="settings">
+										<dt>
+										<strong><label for="field_type">', $txt['custom_edit_picktype'], ':</label></strong>
+										</dt>
+										<dd>
+											<select name="field_type" id="field_type" onchange="updateInputBoxes();">';
+	foreach (array('text', 'textarea', 'select', 'radio', 'check') as $field_type)
+		echo '
+												<option value="', $field_type, '"', $context['field']['type'] == $field_type ? ' selected' : '', '>', $txt['custom_profile_type_' . $field_type], '</option>';
+
+	echo '
+											</select>
+										</dd>
+										<dt id="max_length_dt">
+											<strong><label for="max_length_dd">', $txt['custom_edit_max_length'], ':</label></strong><br>
+											<span class="smalltext">', $txt['custom_edit_max_length_desc'], '</span>
+										</dt>
+										<dd>
+											<input type="text" name="max_length" id="max_length_dd" value="', $context['field']['max_length'], '" size="7" maxlength="6" class="input_text">
+										</dd>
+										<dt id="dimension_dt">
+											<strong><label for="dimension_dd">', $txt['custom_edit_dimension'], ':</label></strong>
+										</dt>
+										<dd id="dimension_dd">
+											<strong>', $txt['custom_edit_dimension_row'], ':</strong> <input type="text" name="rows" value="', $context['field']['rows'], '" size="5" maxlength="3" class="input_text">
+											<strong>', $txt['custom_edit_dimension_col'], ':</strong> <input type="text" name="cols" value="', $context['field']['cols'], '" size="5" maxlength="3" class="input_text">
+										</dd>
+										<dt id="bbc_dt">
+											<strong><label for="bbc_dd">', $txt['custom_edit_bbc'], '</label></strong>
+										</dt>
+										<dd >
+											<input type="checkbox" name="bbc" id="bbc_dd"', $context['field']['bbc'] ? ' checked' : '', ' class="input_check">
+										</dd>
+										<dt id="options_dt">
+											<a href="', $scripturl, '?action=helpadmin;help=customoptions" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a>
+											<strong><label for="options_dd">', $txt['custom_edit_options'], ':</label></strong><br>
+											<span class="smalltext">', $txt['custom_edit_options_desc'], '</span>
+										</dt>
+										<dd id="options_dd">
+											<div>';
 
 	foreach ($context['field']['options'] as $k => $option)
 	{
 		echo '
-								', $k == 0 ? '' : '<br />', '<input type="radio" name="default_select" value="', $k, '"', $context['field']['default_select'] == $option ? ' checked="checked"' : '', ' class="input_radio" /><input type="text" name="select_option[', $k, ']" value="', $option, '" class="input_text" />';
+											', $k == 0 ? '' : '<br>', '<input type="radio" name="default_select" value="', $k, '"', $context['field']['default_select'] == $option ? ' checked' : '', ' class="input_radio"><input type="text" name="select_option[', $k, ']" value="', $option, '" class="input_text">';
 	}
 	echo '
-								<span id="addopt"></span>
-								[<a href="" onclick="addOption(); return false;">', $txt['custom_edit_options_more'], '</a>]
-								</div>
-							</dd>
-							<dt id="default_dt">
-								<strong>', $txt['custom_edit_default'], ':</strong>
-							</dt>
-							<dd id="default_dd">
-								<input type="checkbox" name="default_check"', $context['field']['default_check'] ? ' checked="checked"' : '', ' class="input_check" />
-							</dd>
-						</dl>
-					</fieldset>
-					<fieldset>
-						<legend>', $txt['custom_edit_advanced'], '</legend>
-						<dl class="settings">
-							<dt id="mask_dt">
-								<a id="custom_mask" href="', $scripturl, '?action=helpadmin;help=custom_mask" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" class="icon" alt="', $txt['help'], '" align="top" /></a>
-								<strong>', $txt['custom_edit_mask'], ':</strong><br />
-								<span class="smalltext">', $txt['custom_edit_mask_desc'], '</span>
-							</dt>
-							<dd>
-								<select name="mask" id="mask" onchange="updateInputBoxes();">
-									<option value="nohtml"', $context['field']['mask'] == 'nohtml' ? ' selected="selected"' : '', '>', $txt['custom_edit_mask_nohtml'], '</option>
-									<option value="email"', $context['field']['mask'] == 'email' ? ' selected="selected"' : '', '>', $txt['custom_edit_mask_email'], '</option>
-									<option value="number"', $context['field']['mask'] == 'number' ? ' selected="selected"' : '', '>', $txt['custom_edit_mask_number'], '</option>
-									<option value="regex"', substr($context['field']['mask'], 0, 5) == 'regex' ? ' selected="selected"' : '', '>', $txt['custom_edit_mask_regex'], '</option>
-								</select>
-								<br />
-								<span id="regex_div">
-									<input type="text" name="regex" value="', $context['field']['regex'], '" size="30" class="input_text" />
-								</span>
-							</dd>
-							<dt>
-								<strong>', $txt['custom_edit_privacy'], ':</strong>
-								<span class="smalltext">', $txt['custom_edit_privacy_desc'], '</span>
-							</dt>
-							<dd>
-								<select name="private" id="private" onchange="updateInputBoxes();" style="width: 100%">
-									<option value="0"', $context['field']['private'] == 0 ? ' selected="selected"' : '', '>', $txt['custom_edit_privacy_all'], '</option>
-									<option value="1"', $context['field']['private'] == 1 ? ' selected="selected"' : '', '>', $txt['custom_edit_privacy_see'], '</option>
-									<option value="2"', $context['field']['private'] == 2 ? ' selected="selected"' : '', '>', $txt['custom_edit_privacy_owner'], '</option>
-									<option value="3"', $context['field']['private'] == 3 ? ' selected="selected"' : '', '>', $txt['custom_edit_privacy_none'], '</option>
-								</select>
-							</dd>
-							<dt id="can_search_dt">
-								<strong>', $txt['custom_edit_can_search'], ':</strong><br />
-								<span class="smalltext">', $txt['custom_edit_can_search_desc'], '</span>
-							</dt>
-							<dd id="can_search_dd">
-								<input type="checkbox" name="can_search"', $context['field']['can_search'] ? ' checked="checked"' : '', ' class="input_check" />
-							</dd>
-							<dt>
-								<strong>', $txt['custom_edit_active'], ':</strong><br />
-								<span class="smalltext">', $txt['custom_edit_active_desc'], '</span>
-							</dt>
-							<dd>
-								<input type="checkbox" name="active"', $context['field']['active'] ? ' checked="checked"' : '', ' class="input_check" />
-							</dd>
-						</dl>
-					</fieldset>
-					<div class="righttext">
-						<input type="submit" name="save" value="', $txt['save'], '" class="button_submit" />';
+											<span id="addopt"></span>
+											[<a href="" onclick="addOption(); return false;">', $txt['custom_edit_options_more'], '</a>]
+											</div>
+										</dd>
+										<dt id="default_dt">
+											<strong><label for="default_dd">', $txt['custom_edit_default'], ':</label></strong>
+										</dt>
+										<dd>
+											<input type="checkbox" name="default_check" id="default_dd"', $context['field']['default_check'] ? ' checked' : '', ' class="input_check">
+										</dd>
+									</dl>
+								</fieldset>
+								<fieldset>
+									<legend>', $txt['custom_edit_advanced'], '</legend>
+									<dl class="settings">
+										<dt id="mask_dt">
+											<a id="custom_mask" href="', $scripturl, '?action=helpadmin;help=custom_mask" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a>
+											<strong><label for="mask">', $txt['custom_edit_mask'], ':</label></strong><br>
+											<span class="smalltext">', $txt['custom_edit_mask_desc'], '</span>
+										</dt>
+										<dd>
+											<select name="mask" id="mask" onchange="updateInputBoxes();">
+												<option value="nohtml"', $context['field']['mask'] == 'nohtml' ? ' selected' : '', '>', $txt['custom_edit_mask_nohtml'], '</option>
+												<option value="email"', $context['field']['mask'] == 'email' ? ' selected' : '', '>', $txt['custom_edit_mask_email'], '</option>
+												<option value="number"', $context['field']['mask'] == 'number' ? ' selected' : '', '>', $txt['custom_edit_mask_number'], '</option>
+												<option value="regex"', strpos($context['field']['mask'], 'regex') === 0 ? ' selected' : '', '>', $txt['custom_edit_mask_regex'], '</option>
+											</select>
+											<br>
+											<span id="regex_div">
+												<input type="text" name="regex" value="', $context['field']['regex'], '" size="30" class="input_text">
+											</span>
+										</dd>
+										<dt>
+											<strong><label for="private">', $txt['custom_edit_privacy'], ':</label></strong>
+											<span class="smalltext">', $txt['custom_edit_privacy_desc'], '</span>
+										</dt>
+										<dd>
+											<select name="private" id="private" onchange="updateInputBoxes();">
+												<option value="0"', $context['field']['private'] == 0 ? ' selected' : '', '>', $txt['custom_edit_privacy_all'], '</option>
+												<option value="1"', $context['field']['private'] == 1 ? ' selected' : '', '>', $txt['custom_edit_privacy_see'], '</option>
+												<option value="2"', $context['field']['private'] == 2 ? ' selected' : '', '>', $txt['custom_edit_privacy_owner'], '</option>
+												<option value="3"', $context['field']['private'] == 3 ? ' selected' : '', '>', $txt['custom_edit_privacy_none'], '</option>
+											</select>
+										</dd>
+										<dt id="can_search_dt">
+											<strong><label for="can_search_dd">', $txt['custom_edit_can_search'], ':</label></strong><br>
+											<span class="smalltext">', $txt['custom_edit_can_search_desc'], '</span>
+										</dt>
+										<dd>
+											<input type="checkbox" name="can_search" id="can_search_dd"', $context['field']['can_search'] ? ' checked' : '', ' class="input_check">
+										</dd>
+										<dt>
+											<strong><label for="can_search_check">', $txt['custom_edit_active'], ':</label></strong><br>
+											<span class="smalltext">', $txt['custom_edit_active_desc'], '</span>
+										</dt>
+										<dd>
+											<input type="checkbox" name="active" id="can_search_check"', $context['field']['active'] ? ' checked' : '', ' class="input_check">
+										</dd>
+									</dl>
+								</fieldset>
+									<input type="submit" name="save" value="', $txt['save'], '" class="button_submit">';
 
 	if ($context['fid'])
 		echo '
-						<input type="submit" name="delete" value="', $txt['delete'], '" onclick="return confirm(\'', $txt['custom_edit_delete_sure'], '\');" class="button_submit" />';
+									<input type="submit" name="delete" value="', $txt['delete'], '" data-confirm="', $txt['custom_edit_delete_sure'], '" class="button_submit you_sure">';
 
 	echo '
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
-	</div>
-	<br class="clear" />';
+							</div>
+							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+							<input type="hidden" name="', $context['admin-ecp_token_var'], '" value="', $context['admin-ecp_token'], '">
+						</form>
+					</div>';
 
 	// Get the javascript bits right!
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		updateInputBoxes();
-	// ]]></script>';
+					<script><!-- // --><![CDATA[
+						updateInputBoxes();
+					// ]]></script>';
 }
 
 // Results page for an admin search.
 function template_admin_search_results()
 {
-	global $context, $txt, $settings, $options, $scripturl;
+	global $context, $txt, $settings, $scripturl;
 
 	echo '
-		<div class="cat_bar">
-			<h3 class="catbg">
-				<object id="quick_search">
-					<form action="', $scripturl, '?action=admin;area=search" method="post" accept-charset="', $context['character_set'], '" class="floatright">
-						<input type="text" name="search_term" value="', $context['search_term'], '" class="input_text" />
-						<input type="hidden" name="search_type" value="', $context['search_type'], '" />
-						<input type="submit" name="search_go" value="', $txt['admin_search_results_again'], '" class="button_submit" />
-					</form>
-				</object>
-				<span class="ie6_header floatleft"><img src="' . $settings['images_url'] . '/buttons/search.gif" alt="" />&nbsp;', sprintf($txt['admin_search_results_desc'], $context['search_term']), '</span>
-			</h3>
-		</div>
-	<div class="windowbg nopadding">
-		<span class="topslice"><span></span></span>
-		<div class="content">';
+						<div id="section_header" class="cat_bar">
+							<h3 class="catbg">
+								<div id="quick_search">
+									<form action="', $scripturl, '?action=admin;area=search" method="post" accept-charset="', $context['character_set'], '" class="floatright">
+										<input type="search" name="search_term" value="', $context['search_term'], '" class="input_text">
+										<input type="hidden" name="search_type" value="', $context['search_type'], '">
+										<input type="submit" name="search_go" value="', $txt['admin_search_results_again'], '" class="button_submit">
+									</form>
+								</div>
+								<span class="generic_icons filter"></span>&nbsp;', sprintf($txt['admin_search_results_desc'], $context['search_term']), '
+							</h3>
+						</div>
+					<div class="windowbg2 generic_list_wrapper">';
 
 	if (empty($context['search_results']))
 	{
 		echo '
-			<p class="centertext"><strong>', $txt['admin_search_results_none'], '</strong></p>';
+						<p class="centertext"><strong>', $txt['admin_search_results_none'], '</strong></p>';
 	}
 	else
 	{
 		echo '
-			<ol class="search_results">';
+						<ol class="search_results">';
 		foreach ($context['search_results'] as $result)
 		{
 			// Is it a result from the online manual?
 			if ($context['search_type'] == 'online')
 			{
 				echo '
-				<li>
-					<p>
-						<a href="', $context['doc_scripturl'], '?topic=', $result['topic_id'], '.0" target="_blank" class="new_win"><strong>', $result['messages'][0]['subject'], '</strong></a>
-						<br /><span class="smalltext"><a href="', $result['category']['href'], '" target="_blank" class="new_win">', $result['category']['name'], '</a> &nbsp;/&nbsp;
-						<a href="', $result['board']['href'], '" target="_blank" class="new_win">', $result['board']['name'], '</a> /</span>
-					</p>
-					<p class="double_height">
-						', $result['messages'][0]['body'], '
-					</p>
-				</li>';
+							<li>
+								<p>
+									<a href="', $context['doc_scripturl'], str_replace(' ', '_', $result['title']), '" target="_blank" class="new_win"><strong>', $result['title'], '</strong></a>
+								</p>
+								<p class="double_height">
+									', $result['snippet'], '
+								</p>
+							</li>';
 			}
 			// Otherwise it's... not!
 			else
 			{
 				echo '
-				<li class="windowbg">
-					<a href="', $result['url'], '"><strong>', $result['name'], '</strong></a> [', isset($txt['admin_search_section_' . $result['type']]) ? $txt['admin_search_section_' . $result['type']] : $result['type'] , ']';
+							<li>
+								<a href="', $result['url'], '"><strong>', $result['name'], '</strong></a> [', isset($txt['admin_search_section_' . $result['type']]) ? $txt['admin_search_section_' . $result['type']] : $result['type'] , ']';
 
 				if ($result['help'])
 					echo '
-					<p class="double_height">', $result['help'], '</p>';
+								<p class="double_height">', $result['help'], '</p>';
 
 				echo '
-				</li>';
+							</li>';
 			}
 		}
 		echo '
-			</ol>';
+						</ol>';
 	}
 
 	echo '
-		</div>
-		<span class="botslice"><span></span></span>
-	</div>
-	<br class="clear" />';
+					</div>';
 }
 
-// Turn on and off certain key features.
-function template_core_features()
+// This little beauty shows questions and answer from the captcha type feature.
+function template_callback_question_answer_list()
 {
-	global $context, $txt, $settings, $options, $scripturl;
-
-	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function toggleItem(itemID)
-		{
-			// Toggle the hidden item.
-			var itemValueHandle = document.getElementById("feature_" + itemID);
-			itemValueHandle.value = itemValueHandle.value == 1 ? 0 : 1;
-
-			// Change the image, alternative text and the title.
-			document.getElementById("switch_" + itemID).src = \'', $settings['images_url'], '/admin/switch_\' + (itemValueHandle.value == 1 ? \'on\' : \'off\') + \'.png\';
-			document.getElementById("switch_" + itemID).alt = itemValueHandle.value == 1 ? \'', $txt['core_settings_switch_off'], '\' : \'', $txt['core_settings_switch_on'], '\';
-			document.getElementById("switch_" + itemID).title = itemValueHandle.value == 1 ? \'', $txt['core_settings_switch_off'], '\' : \'', $txt['core_settings_switch_on'], '\';
+	global $txt, $context;
 
-			// Don\'t reload.
-			return false;
-		}
-	// ]]></script>
-	<div id="admincenter">';
-	if ($context['is_new_install'])
+	foreach ($context['languages'] as $lang_id => $lang)
 	{
+		$lang_id = strtr($lang_id, array('-utf8' => ''));
+		$lang['name'] = strtr($lang['name'], array('-utf8' => ''));
+
 		echo '
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $txt['core_settings_welcome_msg'], '
-				</h3>
-			</div>
-			<div class="information">
-				', $txt['core_settings_welcome_msg_desc'], '
-			</div>';
-	}
+						<dt id="qa_dt_', $lang_id, '" class="qa_link">
+							<a href="javascript:void(0);">[ ', $lang['name'], ' ]</a>
+						</dt>
+						<fieldset id="qa_fs_', $lang_id, '" class="qa_fieldset">
+							<legend><a href="javascript:void(0);">', $lang['name'], '</a></legend>
+							<dl class="settings">
+								<dt>
+									<strong>', $txt['setup_verification_question'], '</strong>
+								</dt>
+								<dd>
+									<strong>', $txt['setup_verification_answer'], '</strong>
+								</dd>';
 
-	echo '
-		<form action="', $scripturl, '?action=admin;area=corefeatures;" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $txt['core_settings_title'], '
-				</h3>
-			</div>';
+		if (!empty($context['qa_by_lang'][$lang_id]))
+			foreach ($context['qa_by_lang'][$lang_id] as $q_id)
+			{
+				$question = $context['question_answers'][$q_id];
+				echo '
+								<dt>
+									<input type="text" name="question[', $lang_id, '][', $q_id, ']" value="', $question['question'], '" size="50" class="input_text verification_question">
+								</dt>
+								<dd>';
+				foreach ($question['answers'] as $answer)
+					echo '
+									<input type="text" name="answer[', $lang_id, '][', $q_id, '][]" value="', $answer, '" size="50" class="input_text verification_answer">';
 
-	$alternate = true;
-	foreach ($context['features'] as $id => $feature)
-	{
-		echo '
-			<div class="windowbg', $alternate ? '2' : '', '">
-				<span class="topslice"><span></span></span>
-				<div class="content features">
-					<img class="features_image png_fix" src="', $settings['default_images_url'], '/admin/feature_', $id, '.png" alt="', $feature['title'], '" />
-					<div class="features_switch" id="js_feature_', $id, '" style="display: none;">
-						<a href="', $scripturl, '?action=admin;area=featuresettings;sa=core;', $context['session_var'], '=', $context['session_id'], ';toggle=', $id, ';state=', $feature['enabled'] ? 0 : 1, '" onclick="return toggleItem(\'', $id, '\');">
-							<input type="hidden" name="feature_', $id, '" id="feature_', $id, '" value="', $feature['enabled'] ? 1 : 0, '" /><img src="', $settings['images_url'], '/admin/switch_', $feature['enabled'] ? 'on' : 'off', '.png" id="switch_', $id, '" style="margin-top: 1.3em;" alt="', $txt['core_settings_switch_' . ($feature['enabled'] ? 'off' : 'on')], '" title="', $txt['core_settings_switch_' . ($feature['enabled'] ? 'off' : 'on')], '" />
-						</a>
-					</div>
-					<h4>', ($feature['enabled'] && $feature['url'] ? '<a href="' . $feature['url'] . '">' . $feature['title'] . '</a>' : $feature['title']), '</h4>
-					<p>', $feature['desc'], '</p>
-					<div id="plain_feature_', $id, '">
-						<label for="plain_feature_', $id, '_radio_on"><input type="radio" name="feature_plain_', $id, '" id="plain_feature_', $id, '_radio_on" value="1"', $feature['enabled'] ? ' checked="checked"' : '', ' class="input_radio" />', $txt['core_settings_enabled'], '</label>
-						<label for="plain_feature_', $id, '_radio_off"><input type="radio" name="feature_plain_', $id, '" id="plain_feature_', $id, '_radio_off" value="0"', !$feature['enabled'] ? ' checked="checked"' : '', ' class="input_radio" />', $txt['core_settings_disabled'], '</label>
-					</div>
-				</div>
-				<span class="botslice clear_right"><span></span></span>
-			</div>';
+				echo '
+									<div class="qa_add_answer"><a href="javascript:void(0);" onclick="return addAnswer(this);">[ ', $txt['setup_verification_add_answer'], ' ]</a></div>
+								</dd>';
+			}
 
-		$alternate = !$alternate;
+		echo '
+								<dt class="qa_add_question"><a href="javascript:void(0);">[ ', $txt['setup_verification_add_more'], ' ]</a></dt>
+							</dl>
+						</fieldset>';
 	}
-
-	echo '
-			<div class="righttext">
-				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				<input type="hidden" value="0" name="js_worked" id="js_worked" />
-				<input type="submit" value="', $txt['save'], '" name="save" class="button_submit" />
-			</div>
-		</form>
-	</div>
-	<br class="clear" />';
-
-	// Turn on the pretty javascript if we can!
-	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		document.getElementById(\'js_worked\').value = "1";';
-		foreach ($context['features'] as $id => $feature)
-			echo '
-		document.getElementById(\'js_feature_', $id, '\').style.display = "";
-		document.getElementById(\'plain_feature_', $id, '\').style.display = "none";';
-	echo '
-	// ]]></script>';
 }
 
-// Add a new language
-function template_add_language()
+// Repairing boards.
+function template_repair_boards()
 {
-	global $context, $settings, $options, $txt, $scripturl;
-
-	echo '
-	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=languages;sa=add;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $txt['add_language'], '
-				</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<fieldset>
-						<legend>', $txt['add_language_smf'], '</legend>
-						<label class="smalltext">', $txt['add_language_smf_browse'], '</label>
-						<input type="text" name="smf_add" size="40" value="', !empty($context['smf_search_term']) ? $context['smf_search_term'] : '', '" class="input_text" />';
-
-	if (!empty($context['smf_error']))
-		echo '
-						<div class="smalltext error">', $txt['add_language_error_' . $context['smf_error']], '</div>';
+	global $context, $txt, $scripturl;
 
 	echo '
+					<div id="admincenter">
+						<div id="section_header" class="cat_bar">
+							<h3 class="catbg">',
+								$context['error_search'] ? $txt['errors_list'] : $txt['errors_fixing'] , '
+							</h3>
+						</div>
+						<div class="windowbg">';
 
-					</fieldset>
-					<div class="righttext">
-						', $context['browser']['is_ie'] ? '<input type="text" name="ie_fix" style="display: none;" class="input_text" /> ' : '', '
-						<input type="submit" name="smf_add_sub" value="', $txt['search'], '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-		';
-
-	// Had some results?
-	if (!empty($context['smf_languages']))
+	// Are we actually fixing them, or is this just a prompt?
+	if ($context['error_search'])
 	{
-		echo '
-			<div class="information">', $txt['add_language_smf_found'], '</div>
-
-				<table class="table_grid" cellspacing="0" width="100%">
-					<thead>
-						<tr class="catbg">
-							<th class="first_th" scope="col">', $txt['name'], '</th>
-							<th scope="col">', $txt['add_language_smf_desc'], '</th>
-							<th scope="col">', $txt['add_language_smf_version'], '</th>
-							<th scope="col">', $txt['add_language_smf_utf8'], '</th>
-							<th class="last_th" scope="col">', $txt['add_language_smf_install'], '</th>
-						</tr>
-					</thead>
-					<tbody>';
-
-		foreach ($context['smf_languages'] as $language)
+		if (!empty($context['to_fix']))
+		{
 			echo '
-						<tr class="windowbg2">
-							<td align="left">', $language['name'], '</td>
-							<td align="left">', $language['description'], '</td>
-							<td align="left">', $language['version'], '</td>
-							<td align="center">', $language['utf8'] ? $txt['yes'] : $txt['no'], '</td>
-							<td align="left"><a href="', $language['link'], '">', $txt['add_language_smf_install'], '</a></td>
-						</tr>';
+							', $txt['errors_found'], ':
+							<ul>';
 
-		echo '
-					</tbody>
-					</table>';
-	}
-
-	echo '
-		</form>
-	</div>
-	<br class="clear" />';
-}
+			foreach ($context['repair_errors'] as $error)
+				echo '
+								<li>
+									', $error, '
+								</li>';
 
-// Download a new language file?
-function template_download_language()
-{
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+			echo '
+							</ul>
+							<p>
+								', $txt['errors_fix'], '
+							</p>
+							<p class="padding">
+								<strong><a href="', $scripturl, '?action=admin;area=repairboards;fixErrors;', $context['session_var'], '=', $context['session_id'], '">', $txt['yes'], '</a> - <a href="', $scripturl, '?action=admin;area=maintain">', $txt['no'], '</a></strong>
+							</p>';
+		}
+		else
+			echo '
+							<p>', $txt['maintain_no_errors'], '</p>
+							<p class="padding">
+								<a href="', $scripturl, '?action=admin;area=maintain;sa=routine">', $txt['maintain_return'], '</a>
+							</p>';
 
-	// Actually finished?
-	if (!empty($context['install_complete']))
-	{
-		echo '
-	<div id="admincenter">
-		<div class="cat_bar">
-			<h3 class="catbg">
-				', $txt['languages_download_complete'], '
-			</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				', $context['install_complete'], '
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-	</div>
-	<br class="clear" />';
-		return;
 	}
-
-	// An error?
-	if (!empty($context['error_message']))
-		echo '
-	<div id="errorbox">
-		<p>', $context['error_message'], '</p>
-	</div>';
-
-	// Provide something of an introduction...
-	echo '
-	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=languages;sa=downloadlang;did=', $context['download_id'], ';', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $txt['languages_download'], '
-				</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>
-						', $txt['languages_download_note'], '
-					</p>
-					<div class="smalltext">
-						', $txt['languages_download_info'], '
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
-
-	// Show the main files.
-	template_show_list('lang_main_files_list');
-
-	// Now, all the images and the likes, hidden via javascript 'cause there are so fecking many.
-	echo '
-			<br />
-			<div class="title_bar">
-				<h3 class="titlebg">
-					', $txt['languages_download_theme_files'], '
-				</h3>
-			</div>
-			<table class="table_grid" cellspacing="0" width="100%">
-				<thead>
-					<tr class="catbg">
-						<th class="first_th" scope="col">
-							', $txt['languages_download_filename'], '
-						</th>
-						<th scope="col" width="100">
-							', $txt['languages_download_writable'], '
-						</th>
-						<th scope="col" width="100">
-							', $txt['languages_download_exists'], '
-						</th>
-						<th class="last_th" scope="col" width="50">
-							', $txt['languages_download_copy'], '
-						</th>
-					</tr>
-				</thead>
-				<tbody>';
-
-	foreach ($context['files']['images'] as $theme => $group)
+	else
 	{
-		$count = 0;
-		echo '
-				<tr class="titlebg">
-					<td colspan="4">
-						<img src="', $settings['images_url'], '/sort_down.gif" id="toggle_image_', $theme, '" alt="*" />&nbsp;', isset($context['theme_names'][$theme]) ? $context['theme_names'][$theme] : $theme, '
-					</td>
-				</tr>';
-
-		$alternate = false;
-		foreach ($group as $file)
+		if (!empty($context['redirect_to_recount']))
 		{
 			echo '
-				<tr class="windowbg', $alternate ? '2' : '', '" id="', $theme, '-', $count++, '">
-					<td>
-						<strong>', $file['name'], '</strong><br />
-						<span class="smalltext">', $txt['languages_download_dest'], ': ', $file['destination'], '</span>
-					</td>
-					<td>
-						<span style="color: ', ($file['writable'] ? 'green' : 'red'), ';">', ($file['writable'] ? $txt['yes'] : $txt['no']), '</span>
-					</td>
-					<td>
-						', $file['exists'] ? ($file['exists'] == 'same' ? $txt['languages_download_exists_same'] : $txt['languages_download_exists_different']) : $txt['no'], '
-					</td>
-					<td>
-						<input type="checkbox" name="copy_file[]" value="', $file['generaldest'], '"', ($file['default_copy'] ? ' checked="checked"' : ''), ' class="input_check" />
-					</td>
-				</tr>';
-			$alternate = !$alternate;
+							<p>
+								', $txt['errors_do_recount'], '
+							</p>
+							<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=recount" id="recount_form" method="post">
+								<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+								<input type="submit" name="recount" id="recount_now" value="', $txt['errors_recount_now'], '">
+							</form>';
+		}
+		else
+		{
+			echo '
+							<p>', $txt['errors_fixed'], '</p>
+							<p class="padding">
+								<a href="', $scripturl, '?action=admin;area=maintain;sa=routine">', $txt['maintain_return'], '</a>
+							</p>';
 		}
 	}
 
 	echo '
-			</tbody>
-			</table>';
+						</div>
+					</div>';
 
-	// Do we want some FTP baby?
-	if (!empty($context['still_not_writable']))
+	if (!empty($context['redirect_to_recount']))
 	{
-		if (!empty($context['package_ftp']['error']))
-			echo '
-			<div id="errorbox">
-				<tt>', $context['package_ftp']['error'], '</tt>
-			</div>';
-
-		echo '
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $txt['package_ftp_necessary'], '
-				</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>', $txt['package_ftp_why'],'</p>
-					<dl class="settings">
-						<dt
-							<label for="ftp_server">', $txt['package_ftp_server'], ':</label>
-						</dt>
-						<dd>
-							<div class="floatright" style="margin-right: 1px;"><label for="ftp_port" style="padding-top: 2px; padding-right: 2ex;">', $txt['package_ftp_port'], ':&nbsp;</label> <input type="text" size="3" name="ftp_port" id="ftp_port" value="', isset($context['package_ftp']['port']) ? $context['package_ftp']['port'] : (isset($modSettings['package_port']) ? $modSettings['package_port'] : '21'), '" class="input_text" /></div>
-							<input type="text" size="30" name="ftp_server" id="ftp_server" value="', isset($context['package_ftp']['server']) ? $context['package_ftp']['server'] : (isset($modSettings['package_server']) ? $modSettings['package_server'] : 'localhost'), '" style="width: 70%;" class="input_text" />
-						</dd>
-
-						<dt>
-							<label for="ftp_username">', $txt['package_ftp_username'], ':</label>
-						</dt>
-						<dd>
-							<input type="text" size="50" name="ftp_username" id="ftp_username" value="', isset($context['package_ftp']['username']) ? $context['package_ftp']['username'] : (isset($modSettings['package_username']) ? $modSettings['package_username'] : ''), '" style="width: 99%;" class="input_text" />
-						</dd>
-
-						<dt>
-							<label for="ftp_password">', $txt['package_ftp_password'], ':</label>
-						</dt>
-						<dd>
-							<input type="password" size="50" name="ftp_password" id="ftp_password" style="width: 99%;" class="input_text" />
-						</dd>
-
-						<dt>
-							<label for="ftp_path">', $txt['package_ftp_path'], ':</label>
-						</dt>
-						<dd>
-							<input type="text" size="50" name="ftp_path" id="ftp_path" value="', $context['package_ftp']['path'], '" style="width: 99%;" class="input_text" />
-						</dd>
-					</dl>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
-	}
+		echo '
+					<script><!-- // --><![CDATA[
+						var countdown = 5;
+						doAutoSubmit();
 
-	// Install?
-	echo '
-			<div class="righttext padding">
-				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				<input type="submit" name="do_install" value="', $txt['add_language_smf_install'], '" class="button_submit" />
-			</div>
-		</form>
-	</div>
-	<br class="clear" />';
+						function doAutoSubmit()
+						{
+							if (countdown == 0)
+								document.forms.recount_form.submit();
+							else if (countdown == -1)
+								return;
 
-	// The javascript for expand and collapse of sections.
-	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[';
+							document.forms.recount_form.recount_now.value = "', $txt['errors_recount_now'], ' (" + countdown + ")";
+							countdown--;
 
-	// Each theme gets its own handler.
-	foreach ($context['files']['images'] as $theme => $group)
-	{
-		$count = 0;
-		echo '
-			var oTogglePanel_', $theme, ' = new smc_Toggle({
-				bToggleEnabled: true,
-				bCurrentlyCollapsed: true,
-				aSwappableContainers: [';
-		foreach ($group as $file)
-			echo '
-					', JavaScriptEscape($theme . '-' . $count++), ',';
-		echo '
-					null
-				],
-				aSwapImages: [
-					{
-						sId: \'toggle_image_', $theme, '\',
-						srcExpanded: smf_images_url + \'/sort_down.gif\',
-						altExpanded: \'*\',
-						srcCollapsed: smf_images_url + \'/selected.gif\',
-						altCollapsed: \'*\'
-					}
-				]
-			});';
+							setTimeout("doAutoSubmit();", 1000);
+						}
+					// ]]></script>';
 	}
-
-	echo '
-	// ]]></script>';
 }
 
-// Edit some language entries?
-function template_modify_language_entries()
+// Retrieves info from the php_info function, scrubs and preps it for display
+function template_php_info()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt;
 
 	echo '
-	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=languages;sa=editlang;lid=', $context['lang_id'], '" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $txt['edit_languages'], '
-				</h3>
-			</div>';
-
-	// Not writable?
-	if ($context['lang_file_not_writable_message'])
-		echo '
-			<div id="errorbox">
-				<p class="alert">', $context['lang_file_not_writable_message'], '</p>
-			</div>';
-
-	echo '
-			<div class="information">
-				', $txt['edit_language_entries_primary'], '
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<fieldset>
-						<legend>', $context['primary_settings']['name'], '</legend>
-					<dl class="settings">
-						<dt>
-							', $txt['languages_character_set'], ':
-						</dt>
-						<dd>
-							<input type="text" name="character_set" size="20" value="', $context['primary_settings']['character_set'], '"', (empty($context['file_entries']) ? '' : ' disabled="disabled"'), ' class="input_text" />
-						</dd>
-						<dt>
-							', $txt['languages_locale'], ':
-						</dt>
-						<dd>
-							<input type="text" name="locale" size="20" value="', $context['primary_settings']['locale'], '"', (empty($context['file_entries']) ? '' : ' disabled="disabled"'), ' class="input_text" />
-						</dd>
-						<dt>
-							', $txt['languages_dictionary'], ':
-						</dt>
-						<dd>
-							<input type="text" name="dictionary" size="20" value="', $context['primary_settings']['dictionary'], '"', (empty($context['file_entries']) ? '' : ' disabled="disabled"'), ' class="input_text" />
-						</dd>
-						<dt>
-							', $txt['languages_spelling'], ':
-						</dt>
-						<dd>
-							<input type="text" name="spelling" size="20" value="', $context['primary_settings']['spelling'], '"', (empty($context['file_entries']) ? '' : ' disabled="disabled"'), ' class="input_text" />
-						</dd>
-						<dt>
-							', $txt['languages_rtl'], ':
-						</dt>
-						<dd>
-							<input type="checkbox" name="rtl"', $context['primary_settings']['rtl'] ? ' checked="checked"' : '', ' class="input_check"', (empty($context['file_entries']) ? '' : ' disabled="disabled"'), ' />
-						</dd>
-					</dl>
-					</fieldset>
-					<div class="righttext">
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="submit" name="save_main" value="', $txt['save'], '"', $context['lang_file_not_writable_message'] || !empty($context['file_entries']) ? ' disabled="disabled"' : '', ' class="button_submit" />';
-
-	// English can't be deleted.
-	if ($context['lang_id'] != 'english')
-		echo '
-						<input type="submit" name="delete_main" value="', $txt['delete'], '"', $context['lang_file_not_writable_message'] || !empty($context['file_entries']) ? ' disabled="disabled"' : '', ' onclick="confirm(\'', $txt['languages_delete_confirm'], '\');" class="button_submit" />';
+					<div id="admin_form_wrapper">
+						<div id="section_header" class="cat_bar">
+							<h3 class="catbg">',
+								$txt['phpinfo_settings'], '
+							</h3>
+						</div>';
 
-	echo '
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-		</form>
-
-		<form action="', $scripturl, '?action=admin;area=languages;sa=editlang;lid=', $context['lang_id'], ';entries" id="entry_form" method="post" accept-charset="', $context['character_set'], '">
-			<div class="title_bar">
-				<h3 class="titlebg">
-					', $txt['edit_language_entries'], '
-				</h3>
-			</div>
-			<div id="taskpad" class="floatright">
-				', $txt['edit_language_entries_file'], ':
-					<select name="tfid" onchange="if (this.value != -1) document.forms.entry_form.submit();">';
-	foreach ($context['possible_files'] as $id_theme => $theme)
+	// for each php info area
+	foreach ($context['pinfo'] as $area => $php_area)
 	{
 		echo '
-						<option value="-1">', $theme['name'], '</option>';
+						<table id="', str_replace(' ', '_', $area), '" class="table_grid">
+							<thead>
+								<tr class="title_bar">
+									<th class="equal_table" scope="col"></th>
+									<th class="centercol equal_table" scope="col"><strong>', $area, '</strong></th>
+									<th class="equal_table" scope="col"></th>
+								</tr>
+							</thead>
+							<tbody>';
 
-		foreach ($theme['files'] as $file)
-			echo '
-						<option value="', $id_theme, '+', $file['id'], '"', $file['selected'] ? ' selected="selected"' : '', '> =&gt; ', $file['name'], '</option>';
-	}
+		$localmaster = true;
 
-	echo '
-					</select>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="submit" value="', $txt['go'], '" class="button_submit" />
-			</div>';
-
-		// Is it not writable?
-	if (!empty($context['entries_not_writable_message']))
-		echo '
-			<div id="errorbox">
-				<span class="alert">', $context['entries_not_writable_message'], '</span>
-			</div>';
+		// and for each setting in this category
+		foreach ($php_area as $key => $setting)
+		{
+			// start of a local / master setting (3 col)
+			if (is_array($setting))
+			{
+				if ($localmaster)
+				{
+					// heading row for the settings section of this categorys settings
+					echo '
+								<tr class="title_bar">
+									<td class="equal_table"><strong>', $txt['phpinfo_itemsettings'], '</strong></td>
+									<td class="equal_table"><strong>', $txt['phpinfo_localsettings'], '</strong></td>
+									<td class="equal_table"><strong>', $txt['phpinfo_defaultsettings'], '</strong></td>
+								</tr>';
+					$localmaster = false;
+				}
 
-	// Already have some?
-	if (!empty($context['file_entries']))
-	{
-		echo '
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">';
+				echo '
+								<tr class="windowbg">
+									<td align="left" class="equal_table">', $key, '</td>';
 
-		$cached = array();
-		foreach ($context['file_entries'] as $entry)
-		{
-			// Do it in two's!
-			if (empty($cached))
+				foreach ($setting as $key_lm => $value)
+				{
+					echo '
+									<td align="left" class="equal_table">', $value, '</td>';
+				}
+				echo '
+								</tr>';
+			}
+			// just a single setting (2 col)
+			else
 			{
-				$cached = $entry;
-				continue;
+				echo '
+								<tr class="windowbg">
+									<td align="left" class="equal_table">', $key,  '</td>
+									<td align="left" colspan="2">', $setting, '</td>
+								</tr>';
 			}
-
-			echo '
-						<dt>
-							<span class="smalltext">', $cached['key'], '</span>
-						</dt>
-						<dd>
-							<span class="smalltext">', $entry['key'], '</span>
-						</dd>
-						<dt>
-							<input type="hidden" name="comp[', $cached['key'], ']" value="', $cached['value'], '" />
-							<textarea name="entry[', $cached['key'], ']" cols="40" rows="', $cached['rows'] < 2 ? 2 : $cached['rows'], '" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 96%; min-width: 96%' : 'width: 96%') . ';">', $cached['value'], '</textarea>
-						</dt>
-						<dd>
-							<input type="hidden" name="comp[', $entry['key'], ']" value="', $entry['value'], '" />
-							<textarea name="entry[', $entry['key'], ']" cols="40" rows="', $entry['rows'] < 2 ? 2 : $entry['rows'], '" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 96%; min-width: 96%' : 'width: 96%') . ';">', $entry['value'], '</textarea>
-						</dd>';
-			$cached = array();
 		}
-
-		// Odd number?
-		if (!empty($cached))
-			echo '
-
-						<dt>
-							<span class="smalltext">', $cached['key'], '</span>
-						</dt>
-						<dd>
-						</dd>
-						<dt>
-							<input type="hidden" name="comp[', $cached['key'], ']" value="', $cached['value'], '" />
-							<textarea name="entry[', $cached['key'], ']" cols="40" rows="2" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 96%; min-width: 96%' : 'width: 96%') . ';">', $cached['value'], '</textarea>
-						</dt>
-						<dd>
-						</dd>';
-
-		echo '
-					</dl>
-					<input type="submit" name="save_entries" value="', $txt['save'], '"', !empty($context['entries_not_writable_message']) ? ' disabled="disabled"' : '', ' class="button_submit" />';
-
 		echo '
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
+							</tbody>
+						</table>
+						<br>';
 	}
+
 	echo '
-		</form>
-	</div>
-	<br class="clear" />';
+					</div>';
 }
 
-// This little beauty shows questions and answer from the captcha type feature.
-function template_callback_question_answer_list()
+function template_clean_cache_button_above()
 {
-	global $txt, $context;
-
-	echo '
-			<dt>
-				<strong>', $txt['setup_verification_question'], '</strong>
-			</dt>
-			<dd>
-				<strong>', $txt['setup_verification_answer'], '</strong>
-			</dd>';
-
-	foreach ($context['question_answers'] as $data)
-		echo '
-
-			<dt>
-				<input type="text" name="question[', $data['id'], ']" value="', $data['question'], '" size="50" class="input_text verification_question" />
-			</dt>
-			<dd>
-				<input type="text" name="answer[', $data['id'], ']" value="', $data['answer'], '" size="50" class="input_text verification_answer" />
-			</dd>';
-
-	// Some blank ones.
-	for ($count = 0; $count < 3; $count++)
-		echo '
-			<dt>
-				<input type="text" name="question[]" size="50" class="input_text verification_question" />
-			</dt>
-			<dd>
-				<input type="text" name="answer[]" size="50" class="input_text verification_answer" />
-			</dd>';
-
-	echo '
-		<dt id="add_more_question_placeholder" style="display: none;"></dt><dd></dd>
-		<dt id="add_more_link_div" style="display: none;">
-			<a href="#" onclick="addAnotherQuestion(); return false;">&#171; ', $txt['setup_verification_add_more'], ' &#187;</a>
-
-		</dt><dd></dd>';
-
-	// The javascript needs to go at the end but we'll put it in this template for looks.
-	$context['settings_post_javascript'] .= '
-		// Create a named element dynamically - thanks to: http://www.thunderguy.com/semicolon/2005/05/23/setting-the-name-attribute-in-internet-explorer/
-		function createNamedElement(type, name, customFields)
-		{
-			var element = null;
-
-			if (!customFields)
-				customFields = "";
-
-			// Try the IE way; this fails on standards-compliant browsers
-			try
-			{
-				element = document.createElement("<" + type + \' name="\' + name + \'" \' + customFields + ">");
-			}
-			catch (e)
-			{
-			}
-			if (!element || element.nodeName != type.toUpperCase())
-			{
-				// Non-IE browser; use canonical method to create named element
-				element = document.createElement(type);
-				element.name = name;
-			}
-
-			return element;
-		}
-
-		var placeHolder = document.getElementById(\'add_more_question_placeholder\');
-
-		function addAnotherQuestion()
-		{
-			var newDT = document.createElement("dt");
-
-			var newInput = createNamedElement("input", "question[]");
-			newInput.type = "text";
-			newInput.className = "input_text";
-			newInput.size = "50";
-			newInput.setAttribute("class", "verification_question");
-			newDT.appendChild(newInput);
-
-			newDD = document.createElement("dd");
-
-			newInput = createNamedElement("input", "answer[]");
-			newInput.type = "text";
-			newInput.className = "input_text";
-			newInput.size = "50";
-			newInput.setAttribute("class", "verification_answer");
-			newDD.appendChild(newInput);
-
-			placeHolder.parentNode.insertBefore(newDT, placeHolder);
-			placeHolder.parentNode.insertBefore(newDD, placeHolder);
-		}
-		document.getElementById(\'add_more_link_div\').style.display = \'\';
-	';
 }
 
-// Repairing boards.
-function template_repair_boards()
+function template_clean_cache_button_below()
 {
-	global $context, $txt, $scripturl;
+	global $txt, $scripturl, $context;
 
 	echo '
-	<div id="admincenter">
-		<div class="cat_bar">
-			<h3 class="catbg">',
-				$context['error_search'] ? $txt['errors_list'] : $txt['errors_fixing'] , '
-			</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">';
-
-	// Are we actually fixing them, or is this just a prompt?
-	if ($context['error_search'])
-	{
-		if (!empty($context['to_fix']))
-		{
-			echo '
-				', $txt['errors_found'], ':
-				<ul>';
-
-			foreach ($context['repair_errors'] as $error)
-				echo '
-					<li>
-						', $error, '
-					</li>';
-
-			echo '
-				</ul>
-				<p>
-					', $txt['errors_fix'], '
-				</p>
-				<p class="padding">
-					<strong><a href="', $scripturl, '?action=admin;area=repairboards;fixErrors;', $context['session_var'], '=', $context['session_id'], '">', $txt['yes'], '</a> - <a href="', $scripturl, '?action=admin;area=maintain">', $txt['no'], '</a></strong>
-				</p>';
-		}
-		else
-			echo '
-				<p>', $txt['maintain_no_errors'], '</p>
-				<p class="padding">
-					<a href="', $scripturl, '?action=admin;area=maintain;sa=routine">', $txt['maintain_return'], '</a>
-				</p>';
-
-	}
-	else
-	{
-		if (!empty($context['redirect_to_recount']))
-		{
-			echo '
-				<p>
-					', $txt['errors_do_recount'], '
-				</p>
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=recount" id="recount_form" method="post">
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="submit" name="recount" id="recount_now" value="', $txt['errors_recount_now'], '" />
-				</form>';
-		}
-		else
-		{
-			echo '
-				<p>', $txt['errors_fixed'], '</p>
-				<p class="padding">
-					<a href="', $scripturl, '?action=admin;area=maintain;sa=routine">', $txt['maintain_return'], '</a>
-				</p>';
-		}
-	}
-
-	echo '
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-	</div>
-	<br class="clear" />';
+					<div class="cat_bar">
+						<h3 class="catbg">', $txt['maintain_cache'], '</h3>
+					</div>
+					<div class="windowbg">
+						<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=cleancache" method="post" accept-charset="', $context['character_set'], '">
+							<p>', $txt['maintain_cache_info'], '</p>
+							<span><input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit"></span>
+							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+							<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+						</form>
+					</div>';
+}
 
-	if (!empty($context['redirect_to_recount']))
-	{
+function template_admin_quick_search()
+{
+	global $context, $txt, $scripturl;
+	if ($context['user']['is_admin'])
 		echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		var countdown = 5;
-		doAutoSubmit();
-
-		function doAutoSubmit()
-		{
-			if (countdown == 0)
-				document.forms.recount_form.submit();
-			else if (countdown == -1)
-				return;
-
-			document.forms.recount_form.recount_now.value = "', $txt['errors_recount_now'], ' (" + countdown + ")";
-			countdown--;
-
-			setTimeout("doAutoSubmit();", 1000);
-		}
-	// ]]></script>';
-	}
+							<object id="quick_search">
+								<form action="', $scripturl, '?action=admin;area=search" method="post" accept-charset="', $context['character_set'], '" class="floatright">
+									<span class="generic_icons filter centericon"></span>
+									<input type="text" name="search_term" value="', $txt['admin_search'], '" onclick="if (this.value == \'', $txt['admin_search'], '\') this.value = \'\';" class="input_text">
+									<select name="search_type">
+										<option value="internal"', (empty($context['admin_preferences']['sb']) || $context['admin_preferences']['sb'] == 'internal' ? ' selected' : ''), '>', $txt['admin_search_type_internal'], '</option>
+										<option value="member"', (!empty($context['admin_preferences']['sb']) && $context['admin_preferences']['sb'] == 'member' ? ' selected' : ''), '>', $txt['admin_search_type_member'], '</option>
+										<option value="online"', (!empty($context['admin_preferences']['sb']) && $context['admin_preferences']['sb'] == 'online' ? ' selected' : ''), '>', $txt['admin_search_type_online'], '</option>
+									</select>
+									<input type="submit" name="search_go" id="search_go" value="', $txt['admin_search_go'], '" class="button_submit">
+								</form>
+							</object>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/BoardIndex.template.php b/Themes/default/BoardIndex.template.php
--- a/Themes/default/BoardIndex.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/BoardIndex.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,89 +3,53 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
-function template_main()
+function template_boardindex_outer_above()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	template_newsfader();
+}
 
-	// Show some statistics if stat info is off.
-	if (!$settings['show_stats_index'])
-		echo '
-	<div id="index_common_stats">
-		', $txt['members'], ': ', $context['common_stats']['total_members'], ' &nbsp;&#8226;&nbsp; ', $txt['posts_made'], ': ', $context['common_stats']['total_posts'], ' &nbsp;&#8226;&nbsp; ', $txt['topics'], ': ', $context['common_stats']['total_topics'], '
-		', ($settings['show_latest_member'] ? ' ' . $txt['welcome_member'] . ' <strong>' . $context['common_stats']['latest_member']['link'] . '</strong>' . $txt['newest_member'] : '') , '
-	</div>';
+function template_newsfader()
+{
+	global $context, $settings, $options, $txt;
 
 	// Show the news fader?  (assuming there are things to show...)
-	if ($settings['show_newsfader'] && !empty($context['fader_news_lines']))
+	if (!empty($settings['show_newsfader']) && !empty($context['news_lines']))
 	{
 		echo '
-	<div id="newsfader">
-		<div class="cat_bar">
-			<h3 class="catbg">
-				<img id="newsupshrink" src="', $settings['images_url'], '/collapse.gif" alt="*" title="', $txt['upshrink_description'], '" align="bottom" style="display: none;" />
-				', $txt['news'], '
-			</h3>
-		</div>
-		<ul class="reset" id="smfFadeScroller"', empty($options['collapse_news_fader']) ? '' : ' style="display: none;"', '>';
+		<ul id="smf_slider" class="roundframe">';
 
-			foreach ($context['news_lines'] as $news)
-				echo '
-			<li>', $news, '</li>';
+		foreach ($context['news_lines'] as $news)
+		{
+			echo '
+			<li>', $news,'</li>';
+		}
 
-	echo '
+		echo '
 		</ul>
-	</div>
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/fader.js"></script>
-	<script type="text/javascript"><!-- // --><![CDATA[
-
-		// Create a news fader object.
-		var oNewsFader = new smf_NewsFader({
-			sSelf: \'oNewsFader\',
-			sFaderControlId: \'smfFadeScroller\',
-			sItemTemplate: ', JavaScriptEscape('<strong>%1$s</strong>'), ',
-			iFadeDelay: ', empty($settings['newsfader_time']) ? 5000 : $settings['newsfader_time'], '
-		});
-
-		// Create the news fader toggle.
-		var smfNewsFadeToggle = new smc_Toggle({
-			bToggleEnabled: true,
-			bCurrentlyCollapsed: ', empty($options['collapse_news_fader']) ? 'false' : 'true', ',
-			aSwappableContainers: [
-				\'smfFadeScroller\'
-			],
-			aSwapImages: [
-				{
-					sId: \'newsupshrink\',
-					srcExpanded: smf_images_url + \'/collapse.gif\',
-					altExpanded: ', JavaScriptEscape($txt['upshrink_description']), ',
-					srcCollapsed: smf_images_url + \'/expand.gif\',
-					altCollapsed: ', JavaScriptEscape($txt['upshrink_description']), '
-				}
-			],
-			oThemeOptions: {
-				bUseThemeSettings: ', $context['user']['is_guest'] ? 'false' : 'true', ',
-				sOptionName: \'collapse_news_fader\',
-				sSessionVar: ', JavaScriptEscape($context['session_var']), ',
-				sSessionId: ', JavaScriptEscape($context['session_id']), '
-			},
-			oCookieOptions: {
-				bUseCookie: ', $context['user']['is_guest'] ? 'true' : 'false', ',
-				sCookieName: \'newsupshrink\'
-			}
-		});
-	// ]]></script>';
+		<script>
+			jQuery("#smf_slider").slippry({
+				pause: ', $settings['newsfader_time'],',
+				adaptiveHeight: 0,
+				captions: 0,
+				controls: 0,
+			});
+		</script>';
 	}
+}
+
+function template_main()
+{
+	global $context, $txt, $scripturl;
 
 	echo '
-	<div id="boardindex_table">
-		<table class="table_list">';
+	<div id="boardindex_table" class="boardindex_table">';
 
 	/* Each category in categories is made up of:
 	id, href, link, name, is_collapsed (is it collapsed?), can_collapse (is it okay if it is?),
@@ -98,35 +62,22 @@
 			continue;
 
 		echo '
-			<tbody class="header" id="category_', $category['id'], '">
-				<tr>
-					<td colspan="4">
-						<div class="cat_bar">
-							<h3 class="catbg">';
+		<div class="main_container">
+			<div class="cat_bar" id="category_', $category['id'], '">
+				<h3 class="catbg">';
 
 		// If this category even can collapse, show a link to collapse it.
 		if ($category['can_collapse'])
 			echo '
-								<a class="collapse" href="', $category['collapse_href'], '">', $category['collapse_image'], '</a>';
-
-		if (!$context['user']['is_guest'] && !empty($category['show_unread']))
-			echo '
-								<a class="unreadlink" href="', $scripturl, '?action=unread;c=', $category['id'], '">', $txt['view_unread_category'], '</a>';
+					<span id="category_', $category['id'], '_upshrink" class="', $category['is_collapsed'] ? 'toggle_down' : 'toggle_up', ' floatright" data-collapsed="', (int) $category['is_collapsed'], '" title="', !$category['is_collapsed'] ? $txt['hide_category'] : $txt['show_category'] ,'" style="display: none;"></span>';
 
 		echo '
-								', $category['link'], '
-							</h3>
-						</div>
-					</td>
-				</tr>
-			</tbody>';
-
-		// Assuming the category hasn't been collapsed...
-		if (!$category['is_collapsed'])
-		{
+					', $category['link'], '
+				</h3>', !empty($category['description']) ? '
+				<div class="desc">' . $category['description'] . '</div>' : '', '
+			</div>
+			<div id="category_', $category['id'], '_boards">';
 
-		echo '
-			<tbody class="content" id="category_', $category['id'], '_boards">';
 			/* Each board in each category's boards has:
 			new (is it new?), id, name, description, moderators (see below), link_moderators (just a list.),
 			children (see below.), link_children (easier to use.), children_new (are they new?),
@@ -134,28 +85,14 @@
 			foreach ($category['boards'] as $board)
 			{
 				echo '
-				<tr id="board_', $board['id'], '" class="windowbg2">
-					<td class="icon windowbg"', !empty($board['children']) ? ' rowspan="2"' : '', '>
-						<a href="', ($board['is_redirect'] || $context['user']['is_guest'] ? $board['href'] : $scripturl . '?action=unread;board=' . $board['id'] . '.0;children'), '">';
-
-				// If the board or children is new, show an indicator.
-				if ($board['new'] || $board['children_new'])
-					echo '
-							<img src="', $settings['images_url'], '/', $context['theme_variant_url'], 'on', $board['new'] ? '' : '2', '.png" alt="', $txt['new_posts'], '" title="', $txt['new_posts'], '" />';
-				// Is it a redirection board?
-				elseif ($board['is_redirect'])
-					echo '
-							<img src="', $settings['images_url'], '/', $context['theme_variant_url'], 'redirect.png" alt="*" title="*" />';
-				// No new posts at all! The agony!!
-				else
-					echo '
-							<img src="', $settings['images_url'], '/', $context['theme_variant_url'], 'off.png" alt="', $txt['old_posts'], '" title="', $txt['old_posts'], '" />';
-
-				echo '
+				<div id="board_', $board['id'], '" class="up_contain">
+					<div class="icon">
+						<a href="', ($board['is_redirect'] || $context['user']['is_guest'] ? $board['href'] : $scripturl . '?action=unread;board=' . $board['id'] . '.0;children'), '">
+							<span class="board_', $board['board_class'], '"', !empty($board['board_tooltip']) ? ' title="' . $board['board_tooltip'] . '"' : '', '></span>
 						</a>
-					</td>
-					<td class="info">
-						<a class="subject" href="', $board['href'], '" name="b', $board['id'], '">', $board['name'], '</a>';
+					</div>
+					<div class="info">
+						<a class="subject" href="', $board['href'], '" id="b', $board['id'], '">', $board['name'], '</a>';
 
 				// Has it outstanding posts for approval?
 				if ($board['can_approve_posts'] && ($board['unapproved_posts'] || $board['unapproved_topics']))
@@ -167,33 +104,25 @@
 						<p>', $board['description'] , '</p>';
 
 				// Show the "Moderators: ". Each has name, href, link, and id. (but we're gonna use link_moderators.)
-				if (!empty($board['moderators']))
+				if (!empty($board['link_moderators']))
 					echo '
-						<p class="moderators">', count($board['moderators']) == 1 ? $txt['moderator'] : $txt['moderators'], ': ', implode(', ', $board['link_moderators']), '</p>';
+						<p class="moderators">', count($board['link_moderators']) == 1 ? $txt['moderator'] : $txt['moderators'], ': ', implode(', ', $board['link_moderators']), '</p>';
 
 				// Show some basic information about the number of posts, etc.
 					echo '
-					</td>
-					<td class="stats windowbg">
-						<p>', comma_format($board['posts']), ' ', $board['is_redirect'] ? $txt['redirects'] : $txt['posts'], ' <br />
-						', $board['is_redirect'] ? '' : comma_format($board['topics']) . ' ' . $txt['board_topics'], '
+					</div>
+					<div class="stats">
+						<p>', comma_format($board['posts']), ' ', $board['is_redirect'] ? $txt['redirects'] : $txt['posts'], '
+						', $board['is_redirect'] ? '' : '<br> ' . comma_format($board['topics']) . ' ' . $txt['board_topics'], '
 						</p>
-					</td>
-					<td class="lastpost">';
+					</div>
+					<div class="lastpost">';
 
-				/* The board's and children's 'last_post's have:
-				time, timestamp (a number that represents the time.), id (of the post), topic (topic id.),
-				link, href, subject, start (where they should go for the first unread post.),
-				and member. (which has id, name, link, href, username in it.) */
 				if (!empty($board['last_post']['id']))
 					echo '
-						<p><strong>', $txt['last_post'], '</strong>  ', $txt['by'], ' ', $board['last_post']['member']['link'] , '<br />
-						', $txt['in'], ' ', $board['last_post']['link'], '<br />
-						', $txt['on'], ' ', $board['last_post']['time'],'
-						</p>';
+						<p>', $board['last_post']['last_post_message'], '</p>';
 				echo '
-					</td>
-				</tr>';
+					</div>';
 				// Show the "Child Boards: ". (there's a link_children but we're going to bold the new ones...)
 				if (!empty($board['children']))
 				{
@@ -204,9 +133,9 @@
 					foreach ($board['children'] as $child)
 					{
 						if (!$child['is_redirect'])
-							$child['link'] = '<a href="' . $child['href'] . '" ' . ($child['new'] ? 'class="new_posts" ' : '') . 'title="' . ($child['new'] ? $txt['new_posts'] : $txt['old_posts']) . ' (' . $txt['board_topics'] . ': ' . comma_format($child['topics']) . ', ' . $txt['posts'] . ': ' . comma_format($child['posts']) . ')">' . $child['name'] . ($child['new'] ? '</a> <a href="' . $scripturl . '?action=unread;board=' . $child['id'] . '" title="' . $txt['new_posts'] . ' (' . $txt['board_topics'] . ': ' . comma_format($child['topics']) . ', ' . $txt['posts'] . ': ' . comma_format($child['posts']) . ')"><img src="' . $settings['lang_images_url'] . '/new.gif" class="new_posts" alt="" />' : '') . '</a>';
+							$child['link'] = '<a href="' . $child['href'] . '" ' . ($child['new'] ? 'class="board_new_posts" ' : '') . 'title="' . ($child['new'] ? $txt['new_posts'] : $txt['old_posts']) . ' (' . $txt['board_topics'] . ': ' . comma_format($child['topics']) . ', ' . $txt['posts'] . ': ' . comma_format($child['posts']) . ')">' . $child['name'] . ($child['new'] ? '</a> <a href="' . $scripturl . '?action=unread;board=' . $child['id'] . '" title="' . $txt['new_posts'] . ' (' . $txt['board_topics'] . ': ' . comma_format($child['topics']) . ', ' . $txt['posts'] . ': ' . comma_format($child['posts']) . ')"><span class="new_posts">' . $txt['new'] . '</span>' : '') . '</a>';
 						else
-							$child['link'] = '<a href="' . $child['href'] . '" title="' . comma_format($child['posts']) . ' ' . $txt['redirects'] . '">' . $child['name'] . '</a>';
+							$child['link'] = '<a href="' . $child['href'] . '" title="' . comma_format($child['posts']) . ' ' . $txt['redirects'] . ' - ' . $child['short_description'] . '">' . $child['name'] . '</a>';
 
 						// Has it posts awaiting approval?
 						if ($child['can_approve_posts'] && ($child['unapproved_posts'] || $child['unapproved_topics']))
@@ -214,205 +143,231 @@
 
 						$children[] = $child['new'] ? '<strong>' . $child['link'] . '</strong>' : $child['link'];
 					}
-					echo '
-					<tr id="board_', $board['id'], '_children">
-						<td colspan="3" class="children windowbg">
-							<strong>', $txt['parent_boards'], '</strong>: ', implode(', ', $children), '
-						</td>
-					</tr>';
+
+				echo '
+					<div id="board_', $board['id'], '_children" class="children">
+						<p><strong>', $txt['sub_boards'], '</strong>: ', implode(', ', $children), '</p>
+					</div>';
 				}
+
+				echo '
+					</div>';
 			}
-		echo '
-			</tbody>';
-		}
-		echo '
-			<tbody class="divider">
-				<tr>
-					<td colspan="4"></td>
-				</tr>
-			</tbody>';
-	}
-	echo '
-		</table>
-	</div>';
 
-	if ($context['user']['is_logged'])
-	{
 		echo '
-	<div id="posting_icons" class="floatleft">';
-
-		// Mark read button.
-		$mark_read_button = array(
-			'markread' => array('text' => 'mark_as_read', 'image' => 'markread.gif', 'lang' => true, 'url' => $scripturl . '?action=markasread;sa=all;' . $context['session_var'] . '=' . $context['session_id']),
-		);
+			</div>
+		</div>';
+	}
 
-		echo '
-		<ul class="reset">
-			<li class="floatleft"><img src="', $settings['images_url'], '/', $context['theme_variant_url'], 'new_some.png" alt="" /> ', $txt['new_posts'], '</li>
-			<li class="floatleft"><img src="', $settings['images_url'], '/', $context['theme_variant_url'], 'new_none.png" alt="" /> ', $txt['old_posts'], '</li>
-			<li class="floatleft"><img src="', $settings['images_url'], '/', $context['theme_variant_url'], 'new_redirect.png" alt="" /> ', $txt['redirect_board'], '</li>
-		</ul>
+	echo '
 	</div>';
 
-		// Show the mark all as read button?
-		if ($settings['show_mark_read'] && !empty($context['categories']))
-			echo '<div class="mark_read">', template_button_strip($mark_read_button, 'right'), '</div>';
-	}
-	else
-	{
+	// Show the mark all as read button?
+	if ($context['user']['is_logged'] && !empty($context['categories']))
 		echo '
-	<div id="posting_icons" class="flow_hidden">
-		<ul class="reset">
-			<li class="floatleft"><img src="', $settings['images_url'], '/new_none.png" alt="" /> ', $txt['old_posts'], '</li>
-			<li class="floatleft"><img src="', $settings['images_url'], '/new_redirect.png" alt="" /> ', $txt['redirect_board'], '</li>
-		</ul>
-	</div>';
-	}
+		<div class="mark_read">', template_button_strip($context['mark_read_button'], 'right'), '</div>';
+}
 
+function template_boardindex_outer_below()
+{
 	template_info_center();
 }
 
 function template_info_center()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $options, $txt;
+
+	if (empty($context['info_center']))
+		return;
 
 	// Here's where the "Info Center" starts...
 	echo '
-	<span class="clear upperframe"><span></span></span>
-	<div class="roundframe"><div class="innerframe">
-		<div class="cat_bar">
-			<h3 class="catbg">
-				<img class="icon" id="upshrink_ic" src="', $settings['images_url'], '/collapse.gif" alt="*" title="', $txt['upshrink_description'], '" style="display: none;" />
-				', sprintf($txt['info_center_title'], $context['forum_name_html_safe']), '
+	<div class="roundframe" id="info_center">
+		<div class="title_bar">
+			<h3 class="titlebg">
+				<span class="toggle_up floatright" id="upshrink_ic" title="', $txt['hide_infocenter'], '" style="display: none;"></span>
+				<a href="#" id="upshrink_link">', sprintf($txt['info_center_title'], $context['forum_name_html_safe']), '</a>
 			</h3>
 		</div>
 		<div id="upshrinkHeaderIC"', empty($options['collapse_header_ic']) ? '' : ' style="display: none;"', '>';
 
-	// This is the "Recent Posts" bar.
-	if (!empty($settings['number_recent_posts']) && (!empty($context['latest_posts']) || !empty($context['latest_post'])))
+	foreach ($context['info_center'] as $block)
 	{
-		echo '
-			<div class="title_barIC">
-				<h4 class="titlebg">
-					<span class="ie6_header floatleft">
-						<a href="', $scripturl, '?action=recent"><img class="icon" src="', $settings['images_url'], '/post/xx.gif" alt="', $txt['recent_posts'], '" /></a>
-						', $txt['recent_posts'], '
-					</span>
+		$func = 'template_ic_block_' . $block;
+		$func();
+	}
+
+	echo '
+		</div>
+	</div>';
+
+	// Info center collapse object.
+	echo '
+	<script><!-- // --><![CDATA[
+		var oInfoCenterToggle = new smc_Toggle({
+			bToggleEnabled: true,
+			bCurrentlyCollapsed: ', empty($options['collapse_header_ic']) ? 'false' : 'true', ',
+			aSwappableContainers: [
+				\'upshrinkHeaderIC\'
+			],
+			aSwapImages: [
+				{
+					sId: \'upshrink_ic\',
+					altExpanded: ', JavaScriptEscape($txt['hide_infocenter']), ',
+					altCollapsed: ', JavaScriptEscape($txt['show_infocenter']), '
+				}
+			],
+			aSwapLinks: [
+				{
+					sId: \'upshrink_link\',
+					msgExpanded: ', JavaScriptEscape(sprintf($txt['info_center_title'], $context['forum_name_html_safe'])), ',
+					msgCollapsed: ', JavaScriptEscape(sprintf($txt['info_center_title'], $context['forum_name_html_safe'])), '
+				}
+			],
+			oThemeOptions: {
+				bUseThemeSettings: ', $context['user']['is_guest'] ? 'false' : 'true', ',
+				sOptionName: \'collapse_header_ic\',
+				sSessionId: smf_session_id,
+				sSessionVar: smf_session_var,
+			},
+			oCookieOptions: {
+				bUseCookie: ', $context['user']['is_guest'] ? 'true' : 'false', ',
+				sCookieName: \'upshrinkIC\'
+			}
+		});
+	// ]]></script>';
+}
+
+function template_ic_block_recent()
+{
+	global $context, $scripturl, $settings, $txt;
+
+	// This is the "Recent Posts" bar.
+	echo '
+			<div class="sub_bar">
+				<h4 class="subbg">
+					<a href="', $scripturl, '?action=recent"><span class="xx"></span>', $txt['recent_posts'], '</a>
 				</h4>
 			</div>
-			<div class="hslice" id="recent_posts_content">
-				<div class="entry-title" style="display: none;">', $context['forum_name_html_safe'], ' - ', $txt['recent_posts'], '</div>
-				<div class="entry-content" style="display: none;">
-					<a rel="feedurl" href="', $scripturl, '?action=.xml;type=webslice">', $txt['subscribe_webslice'], '</a>
-				</div>';
+			<div id="recent_posts_content">';
 
-		// Only show one post.
-		if ($settings['number_recent_posts'] == 1)
-		{
-			// latest_post has link, href, time, subject, short_subject (shortened with...), and topic. (its id.)
-			echo '
-				<strong><a href="', $scripturl, '?action=recent">', $txt['recent_posts'], '</a></strong>
-				<p id="infocenter_onepost" class="middletext">
-					', $txt['recent_view'], ' &quot;', $context['latest_post']['link'], '&quot; ', $txt['recent_updated'], ' (', $context['latest_post']['time'], ')<br />
+	// Only show one post.
+	if ($settings['number_recent_posts'] == 1)
+	{
+		// latest_post has link, href, time, subject, short_subject (shortened with...), and topic. (its id.)
+		echo '
+				<p id="infocenter_onepost" class="inline">
+					<a href="', $scripturl, '?action=recent">', $txt['recent_view'], '</a>&nbsp;&quot;', sprintf($txt['is_recent_updated'], '&quot;' . $context['latest_post']['link'], '&quot;'), ' (', $context['latest_post']['time'], ')<br>
 				</p>';
-		}
-		// Show lots of posts.
-		elseif (!empty($context['latest_posts']))
-		{
-			echo '
-				<dl id="ic_recentposts" class="middletext">';
+	}
+	// Show lots of posts.
+	elseif (!empty($context['latest_posts']))
+	{
+		echo '
+				<table id="ic_recentposts">
+					<tr class="windowbg">
+						<th class="recentpost">', $txt['message'], '</th>
+						<th class="recentposter">', $txt['author'], '</th>
+						<th class="recentboard">', $txt['board'], '</th>
+						<th class="recenttime">', $txt['date'], '</th>
+					</tr>';
 
-			/* Each post in latest_posts has:
-					board (with an id, name, and link.), topic (the topic's id.), poster (with id, name, and link.),
-					subject, short_subject (shortened with...), time, link, and href. */
-			foreach ($context['latest_posts'] as $post)
-				echo '
-					<dt><strong>', $post['link'], '</strong> ', $txt['by'], ' ', $post['poster']['link'], ' (', $post['board']['link'], ')</dt>
-					<dd>', $post['time'], '</dd>';
+		/* Each post in latest_posts has:
+				board (with an id, name, and link.), topic (the topic's id.), poster (with id, name, and link.),
+				subject, short_subject (shortened with...), time, link, and href. */
+		foreach ($context['latest_posts'] as $post)
 			echo '
-				</dl>';
-		}
+					<tr class="windowbg">
+						<td class="recentpost"><strong>', $post['link'], '</strong></td>
+						<td class="recentposter">', $post['poster']['link'], '</td>
+						<td class="recentboard">', $post['board']['link'], '</td>
+						<td class="recenttime">', $post['time'], '</td>
+					</tr>';
 		echo '
-			</div>';
+				</table>';
 	}
+	echo '
+			</div>';
+}
+
+function template_ic_block_calendar()
+{
+	global $context, $scripturl, $txt, $settings;
 
 	// Show information about events, birthdays, and holidays on the calendar.
-	if ($context['show_calendar'])
-	{
-		echo '
-			<div class="title_barIC">
-				<h4 class="titlebg">
-					<span class="ie6_header floatleft">
-						<a href="', $scripturl, '?action=calendar' . '"><img class="icon" src="', $settings['images_url'], '/icons/calendar.gif', '" alt="', $context['calendar_only_today'] ? $txt['calendar_today'] : $txt['calendar_upcoming'], '" /></a>
-						', $context['calendar_only_today'] ? $txt['calendar_today'] : $txt['calendar_upcoming'], '
-					</span>
+	echo '
+			<div class="sub_bar">
+				<h4 class="subbg">
+					<a href="', $scripturl, '?action=calendar' . '"><span class="generic_icons calendar"></span> ', $context['calendar_only_today'] ? $txt['calendar_today'] : $txt['calendar_upcoming'], '</a>
 				</h4>
-			</div>
-			<p class="smalltext">';
+			</div>';
 
-		// Holidays like "Christmas", "Chanukah", and "We Love [Unknown] Day" :P.
-		if (!empty($context['calendar_holidays']))
-				echo '
-				<span class="holiday">', $txt['calendar_prompt'], ' ', implode(', ', $context['calendar_holidays']), '</span><br />';
+	// Holidays like "Christmas", "Chanukah", and "We Love [Unknown] Day" :P.
+	if (!empty($context['calendar_holidays']))
+		echo '
+				<p class="inline holiday"><span>', $txt['calendar_prompt'], '</span> ', implode(', ', $context['calendar_holidays']), '</p>';
 
-		// People's birthdays. Like mine. And yours, I guess. Kidding.
-		if (!empty($context['calendar_birthdays']))
-		{
-				echo '
-				<span class="birthday">', $context['calendar_only_today'] ? $txt['birthdays'] : $txt['birthdays_upcoming'], '</span> ';
-		/* Each member in calendar_birthdays has:
-				id, name (person), age (if they have one set?), is_last. (last in list?), and is_today (birthday is today?) */
+	// People's birthdays. Like mine. And yours, I guess. Kidding.
+	if (!empty($context['calendar_birthdays']))
+	{
+		echo '
+				<p class="inline">
+					<span class="birthday">', $context['calendar_only_today'] ? $txt['birthdays'] : $txt['birthdays_upcoming'], '</span>';
+		// Each member in calendar_birthdays has: id, name (person), age (if they have one set?), is_last. (last in list?), and is_today (birthday is today?)
 		foreach ($context['calendar_birthdays'] as $member)
-				echo '
-				<a href="', $scripturl, '?action=profile;u=', $member['id'], '">', $member['is_today'] ? '<strong>' : '', $member['name'], $member['is_today'] ? '</strong>' : '', isset($member['age']) ? ' (' . $member['age'] . ')' : '', '</a>', $member['is_last'] ? '<br />' : ', ';
-		}
-		// Events like community get-togethers.
-		if (!empty($context['calendar_events']))
-		{
 			echo '
-				<span class="event">', $context['calendar_only_today'] ? $txt['events'] : $txt['events_upcoming'], '</span> ';
-			/* Each event in calendar_events should have:
-					title, href, is_last, can_edit (are they allowed?), modify_href, and is_today. */
-			foreach ($context['calendar_events'] as $event)
-				echo '
-					', $event['can_edit'] ? '<a href="' . $event['modify_href'] . '" title="' . $txt['calendar_edit'] . '"><img src="' . $settings['images_url'] . '/icons/modify_small.gif" alt="*" /></a> ' : '', $event['href'] == '' ? '' : '<a href="' . $event['href'] . '">', $event['is_today'] ? '<strong>' . $event['title'] . '</strong>' : $event['title'], $event['href'] == '' ? '' : '</a>', $event['is_last'] ? '<br />' : ', ';
-		}
+					<a href="', $scripturl, '?action=profile;u=', $member['id'], '">', $member['is_today'] ? '<strong class="fix_rtl_names">' : '', $member['name'], $member['is_today'] ? '</strong>' : '', isset($member['age']) ? ' (' . $member['age'] . ')' : '', '</a>', $member['is_last'] ? '' : ', ';
 		echo '
-			</p>';
+				</p>';
 	}
 
-	// Show statistical style information...
-	if ($settings['show_stats_index'])
+	// Events like community get-togethers.
+	if (!empty($context['calendar_events']))
 	{
 		echo '
-			<div class="title_barIC">
-				<h4 class="titlebg">
-					<span class="ie6_header floatleft">
-						<a href="', $scripturl, '?action=stats"><img class="icon" src="', $settings['images_url'], '/icons/info.gif" alt="', $txt['forum_stats'], '" /></a>
-						', $txt['forum_stats'], '
-					</span>
+				<p class="inline">
+					<span class="event">', $context['calendar_only_today'] ? $txt['events'] : $txt['events_upcoming'], '</span> ';
+
+		// Each event in calendar_events should have:
+		//		title, href, is_last, can_edit (are they allowed?), modify_href, and is_today.
+		foreach ($context['calendar_events'] as $event)
+			echo '
+					', $event['can_edit'] ? '<a href="' . $event['modify_href'] . '" title="' . $txt['calendar_edit'] . '"><span class="generic_icons calendar_modify"></span></a> ' : '', $event['href'] == '' ? '' : '<a href="' . $event['href'] . '">', $event['is_today'] ? '<strong>' . $event['title'] . '</strong>' : $event['title'], $event['href'] == '' ? '' : '</a>', $event['is_last'] ? '<br>' : ', ';
+		echo '
+				</p>';
+	}
+}
+
+function template_ic_block_stats()
+{
+	global $scripturl, $txt, $context, $settings;
+
+	// Show statistical style information...
+	echo '
+			<div class="sub_bar">
+				<h4 class="subbg">
+					<a href="', $scripturl, '?action=stats" title="', $txt['more_stats'], '"><span class="generic_icons stats"></span> ', $txt['forum_stats'], '</a>
 				</h4>
 			</div>
-			<p>
-				', $context['common_stats']['total_posts'], ' ', $txt['posts_made'], ' ', $txt['in'], ' ', $context['common_stats']['total_topics'], ' ', $txt['topics'], ' ', $txt['by'], ' ', $context['common_stats']['total_members'], ' ', $txt['members'], '. ', !empty($settings['show_latest_member']) ? $txt['latest_member'] . ': <strong> ' . $context['common_stats']['latest_member']['link'] . '</strong>' : '', '<br />
-				', (!empty($context['latest_post']) ? $txt['latest_post'] . ': <strong>&quot;' . $context['latest_post']['link'] . '&quot;</strong>  ( ' . $context['latest_post']['time'] . ' )<br />' : ''), '
-				<a href="', $scripturl, '?action=recent">', $txt['recent_view'], '</a>', $context['show_stats'] ? '<br />
-				<a href="' . $scripturl . '?action=stats">' . $txt['more_stats'] . '</a>' : '', '
+			<p class="inline">
+				', $context['common_stats']['boardindex_total_posts'], '', !empty($settings['show_latest_member']) ? ' - '. $txt['latest_member'] . ': <strong> ' . $context['common_stats']['latest_member']['link'] . '</strong>' : '', '<br>
+				', (!empty($context['latest_post']) ? $txt['latest_post'] . ': <strong>&quot;' . $context['latest_post']['link'] . '&quot;</strong>  (' . $context['latest_post']['time'] . ')<br>' : ''), '
+				<a href="', $scripturl, '?action=recent">', $txt['recent_view'], '</a>
 			</p>';
-	}
+}
 
+function template_ic_block_online()
+{
+	global $context, $scripturl, $txt, $modSettings, $settings;
 	// "Users online" - in order of activity.
 	echo '
-			<div class="title_barIC">
-				<h4 class="titlebg">
-					<span class="ie6_header floatleft">
-						', $context['show_who'] ? '<a href="' . $scripturl . '?action=who' . '">' : '', '<img class="icon" src="', $settings['images_url'], '/icons/online.gif', '" alt="', $txt['online_users'], '" />', $context['show_who'] ? '</a>' : '', '
-						', $txt['online_users'], '
-					</span>
+			<div class="sub_bar">
+				<h4 class="subbg">
+					', $context['show_who'] ? '<a href="' . $scripturl . '?action=who">' : '', '<span class="generic_icons people"></span> ', $txt['online_users'], '', $context['show_who'] ? '</a>' : '', '
 				</h4>
 			</div>
-			<p class="inline stats">
-				', $context['show_who'] ? '<a href="' . $scripturl . '?action=who">' : '', comma_format($context['num_guests']), ' ', $context['num_guests'] == 1 ? $txt['guest'] : $txt['guests'], ', ' . comma_format($context['num_users_online']), ' ', $context['num_users_online'] == 1 ? $txt['user'] : $txt['users'];
+			<p class="inline">
+				', $context['show_who'] ? '<a href="' . $scripturl . '?action=who">' : '', '<strong>', $txt['online'], ': </strong>', comma_format($context['num_guests']), ' ', $context['num_guests'] == 1 ? $txt['guest'] : $txt['guests'], ', ', comma_format($context['num_users_online']), ' ', $context['num_users_online'] == 1 ? $txt['user'] : $txt['users'];
 
 	// Handle hidden users and buddies.
 	$bracketList = array();
@@ -421,88 +376,30 @@
 	if (!empty($context['num_spiders']))
 		$bracketList[] = comma_format($context['num_spiders']) . ' ' . ($context['num_spiders'] == 1 ? $txt['spider'] : $txt['spiders']);
 	if (!empty($context['num_users_hidden']))
-		$bracketList[] = comma_format($context['num_users_hidden']) . ' ' . $txt['hidden'];
+		$bracketList[] = comma_format($context['num_users_hidden']) . ' ' . ($context['num_spiders'] == 1 ? $txt['hidden'] : $txt['hidden_s']);
 
 	if (!empty($bracketList))
 		echo ' (' . implode(', ', $bracketList) . ')';
 
 	echo $context['show_who'] ? '</a>' : '', '
-			</p>
-			<p class="inline smalltext">';
+
+				&nbsp;-&nbsp;', $txt['most_online_today'], ': <strong>', comma_format($modSettings['mostOnlineToday']), '</strong>&nbsp;-&nbsp;
+				', $txt['most_online_ever'], ': ', comma_format($modSettings['mostOnline']), ' (', timeformat($modSettings['mostDate']), ')<br>';
 
 	// Assuming there ARE users online... each user in users_online has an id, username, name, group, href, and link.
 	if (!empty($context['users_online']))
 	{
 		echo '
-				', sprintf($txt['users_active'], $modSettings['lastActive']), ':<br />', implode(', ', $context['list_users_online']);
+				', sprintf($txt['users_active'], $modSettings['lastActive']), ': ', implode(', ', $context['list_users_online']);
 
 		// Showing membergroups?
 		if (!empty($settings['show_group_key']) && !empty($context['membergroups']))
 			echo '
-				<br />[' . implode(']&nbsp;&nbsp;[', $context['membergroups']) . ']';
+				<span class="membergroups">' . implode(',&nbsp;', $context['membergroups']). '</span>';
 	}
 
 	echo '
-			</p>
-			<p class="last smalltext">
-				', $txt['most_online_today'], ': <strong>', comma_format($modSettings['mostOnlineToday']), '</strong>.
-				', $txt['most_online_ever'], ': ', comma_format($modSettings['mostOnline']), ' (', timeformat($modSettings['mostDate']), ')
-			</p>';
-
-	// If they are logged in, but statistical information is off... show a personal message bar.
-	if ($context['user']['is_logged'] && !$settings['show_stats_index'])
-	{
-		echo '
-			<div class="title_barIC">
-				<h4 class="titlebg">
-					<span class="ie6_header floatleft">
-						', $context['allow_pm'] ? '<a href="' . $scripturl . '?action=pm">' : '', '<img class="icon" src="', $settings['images_url'], '/message_sm.gif" alt="', $txt['personal_message'], '" />', $context['allow_pm'] ? '</a>' : '', '
-						<span>', $txt['personal_message'], '</span>
-					</span>
-				</h4>
-			</div>
-			<p class="pminfo">
-				<strong><a href="', $scripturl, '?action=pm">', $txt['personal_message'], '</a></strong>
-				<span class="smalltext">
-					', $txt['you_have'], ' ', comma_format($context['user']['messages']), ' ', $context['user']['messages'] == 1 ? $txt['message_lowercase'] : $txt['msg_alert_messages'], '.... ', $txt['click'], ' <a href="', $scripturl, '?action=pm">', $txt['here'], '</a> ', $txt['to_view'], '
-				</span>
 			</p>';
-	}
-
-	echo '
-		</div>
-	</div></div>
-	<span class="lowerframe"><span></span></span>';
-
-	// Info center collapse object.
-	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		var oInfoCenterToggle = new smc_Toggle({
-			bToggleEnabled: true,
-			bCurrentlyCollapsed: ', empty($options['collapse_header_ic']) ? 'false' : 'true', ',
-			aSwappableContainers: [
-				\'upshrinkHeaderIC\'
-			],
-			aSwapImages: [
-				{
-					sId: \'upshrink_ic\',
-					srcExpanded: smf_images_url + \'/collapse.gif\',
-					altExpanded: ', JavaScriptEscape($txt['upshrink_description']), ',
-					srcCollapsed: smf_images_url + \'/expand.gif\',
-					altCollapsed: ', JavaScriptEscape($txt['upshrink_description']), '
-				}
-			],
-			oThemeOptions: {
-				bUseThemeSettings: ', $context['user']['is_guest'] ? 'false' : 'true', ',
-				sOptionName: \'collapse_header_ic\',
-				sSessionVar: ', JavaScriptEscape($context['session_var']), ',
-				sSessionId: ', JavaScriptEscape($context['session_id']), '
-			},
-			oCookieOptions: {
-				bUseCookie: ', $context['user']['is_guest'] ? 'true' : 'false', ',
-				sCookieName: \'upshrinkIC\'
-			}
-		});
-	// ]]></script>';
 }
+
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Calendar.template.php b/Themes/default/Calendar.template.php
--- a/Themes/default/Calendar.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Calendar.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,562 +3,690 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
-// The main calendar - January, for example.
+// Our main calendar template, which encapsulates weeks and months.
 function template_main()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context;
 
-	echo '
-		<div id="calendar">
-			<div id="month_grid">
-				', template_show_month_grid('prev'), '
-				', template_show_month_grid('current'), '
-				', template_show_month_grid('next'), '
-			</div>
-			<div id="main_grid" style="', $context['browser']['is_ie'] && !$context['browser']['is_ie8'] ? 'float: ' . ($context['right_to_left'] ? 'right; padding-right' : 'left; padding-left') . ': 20px;' : 'margin-' . ($context['right_to_left'] ? 'right' : 'left') . ': 220px; ', '">
-				', $context['view_week'] ? template_show_week_grid('main') : template_show_month_grid('main');
-
-	// Build the calendar button array.
-	$calendar_buttons = array(
-		'post_event' => array('test' => 'can_post', 'text' => 'calendar_post_event', 'image' => 'calendarpe.gif', 'lang' => true, 'url' => $scripturl . '?action=calendar;sa=post;month=' . $context['current_month'] . ';year=' . $context['current_year'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-	);
-
-	template_button_strip($calendar_buttons, 'right');
-
-	// Show some controls to allow easy calendar navigation.
-	echo '
-				<form id="calendar_navigation" action="', $scripturl, '?action=calendar" method="post" accept-charset="', $context['character_set'], '">
-					<select name="month">';
-
-	// Show a select box with all the months.
-	foreach ($txt['months'] as $number => $month)
-		echo '
-						<option value="', $number, '"', $number == $context['current_month'] ? ' selected="selected"' : '', '>', $month, '</option>';
-	echo '
-					</select>
-					<select name="year">';
-
-	// Show a link for every year.....
-	for ($year = $modSettings['cal_minyear']; $year <= $modSettings['cal_maxyear']; $year++)
-		echo '
-						<option value="', $year, '"', $year == $context['current_year'] ? ' selected="selected"' : '', '>', $year, '</option>';
-	echo '
-					</select>
-					<input type="submit" class="button_submit" value="', $txt['view'], '" />';
-
-	echo '
-				</form>
-				<br class="clear" />
-			</div>
-		</div>';
-}
-
-// Template for posting a calendar event.
-function template_event_post()
-{
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
-
-	// Start the javascript for drop down boxes...
-	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
-
-			function generateDays()
-			{
-				var days = 0, selected = 0;
-				var dayElement = document.getElementById("day"), yearElement = document.getElementById("year"), monthElement = document.getElementById("month");
-
-				monthLength[1] = 28;
-				if (yearElement.options[yearElement.selectedIndex].value % 4 == 0)
-					monthLength[1] = 29;
-
-				selected = dayElement.selectedIndex;
-				while (dayElement.options.length)
-					dayElement.options[0] = null;
-
-				days = monthLength[monthElement.value - 1];
-
-				for (i = 1; i <= days; i++)
-					dayElement.options[dayElement.length] = new Option(i, i);
-
-				if (selected < days)
-					dayElement.selectedIndex = selected;
-			}
-
-			function toggleLinked(form)
-			{
-				form.board.disabled = !form.link_to_board.checked;
-			}
-		// ]]></script>
-
-		<form action="', $scripturl, '?action=calendar;sa=post" method="post" name="postevent" accept-charset="', $context['character_set'], '" onsubmit="submitonce(this);smc_saveEntities(\'postevent\', [\'evtitle\']);" style="margin: 0;">';
-
-	if (!empty($context['event']['new']))
-		echo '
-			<input type="hidden" name="eventid" value="', $context['event']['eventid'], '" />';
-
-	// Start the main table.
-	echo '
-			<div id="post_event">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', $context['page_title'], '
-				</h3>
-			</div>';
+	// The main calendar wrapper.
+	echo '<div id="calendar">';
 
-	if (!empty($context['post_error']['messages']))
+	// Show the mini-blocks if they're enabled.
+	if (empty($context['blocks_disabled']))
 	{
 		echo '
-			<div class="errorbox">
-				<dl class="event_error">
-					<dt>
-						', $context['error_type'] == 'serious' ? '<strong>' . $txt['error_while_submitting'] . '</strong>' : '', '
-					</dt>
-					<dt class="error">
-						', implode('<br />', $context['post_error']['messages']), '
-					</dt>
-				</dl>
-			</div>';
+			<div id="month_grid">
+				', template_show_month_grid('prev', true), '
+				', template_show_month_grid('current', true), '
+				', template_show_month_grid('next', true), '
+			</div>
+		';
 	}
 
-	echo '
-			<div class="windowbg">
-				<span class="upperframe"><span></span></span>
-				<div class="roundframe">
-					<fieldset id="event_main">
-						<legend><span', isset($context['post_error']['no_event']) ? ' class="error"' : '', '>', $txt['calendar_event_title'], '</span></legend>
-						<input type="text" name="evtitle" maxlength="255" size="70" value="', $context['event']['title'], '" class="input_text" />
-						<div class="smalltext">
-							<input type="hidden" name="calendar" value="1" />', $txt['calendar_year'], '
-							<select name="year" id="year" onchange="generateDays();">';
-
-	// Show a list of all the years we allow...
-	for ($year = $modSettings['cal_minyear']; $year <= $modSettings['cal_maxyear']; $year++)
-		echo '
-								<option value="', $year, '"', $year == $context['event']['year'] ? ' selected="selected"' : '', '>', $year, '&nbsp;</option>';
-
-	echo '
-							</select>
-							', $txt['calendar_month'], '
-							<select name="month" id="month" onchange="generateDays();">';
-
-	// There are 12 months per year - ensure that they all get listed.
-	for ($month = 1; $month <= 12; $month++)
-		echo '
-								<option value="', $month, '"', $month == $context['event']['month'] ? ' selected="selected"' : '', '>', $txt['months'][$month], '&nbsp;</option>';
-
-	echo '
-							</select>
-							', $txt['calendar_day'], '
-							<select name="day" id="day">';
-
-	// This prints out all the days in the current month - this changes dynamically as we switch months.
-	for ($day = 1; $day <= $context['event']['last_day']; $day++)
-		echo '
-								<option value="', $day, '"', $day == $context['event']['day'] ? ' selected="selected"' : '', '>', $day, '&nbsp;</option>';
-
-	echo '
-							</select>
-						</div>
-					</fieldset>';
-
-	if (!empty($modSettings['cal_allowspan']) || $context['event']['new'])
-		echo '
-					<fieldset id="event_options">
-						<legend>', $txt['calendar_event_options'], '</legend>
-						<div class="event_options smalltext">
-							<ul class="event_options">';
-
-	// If events can span more than one day then allow the user to select how long it should last.
-	if (!empty($modSettings['cal_allowspan']))
+	// Are we viewing a specific week or a specific month?
+	if (isset($_GET['viewweek']))
 	{
 		echo '
-								<li>
-									', $txt['calendar_numb_days'], '
-									<select name="span">';
-
-		for ($days = 1; $days <= $modSettings['cal_maxspan']; $days++)
-			echo '
-										<option value="', $days, '"', $context['event']['span'] == $days ? ' selected="selected"' : '', '>', $days, '&nbsp;</option>';
-
-		echo '
-									</select>
-								</li>';
+			<div id="main_grid">
+				', template_show_week_grid('main'), '
+			</div>
+		';
 	}
-
-	// If this is a new event let the user specify which board they want the linked post to be put into.
-	if ($context['event']['new'])
+	else
 	{
 		echo '
-								<li>
-									', $txt['calendar_link_event'], '
-									<input type="checkbox" style="vertical-align: middle;" class="input_check" name="link_to_board" checked="checked" onclick="toggleLinked(this.form);" />
-								</li>
-								<li>
-									', $txt['calendar_post_in'], '
-									<select id="board" name="board" onchange="this.form.submit();">';
-		foreach ($context['event']['categories'] as $category)
-		{
-			echo '
-										<optgroup label="', $category['name'], '">';
-			foreach ($category['boards'] as $board)
-				echo '
-											<option value="', $board['id'], '"', $board['selected'] ? ' selected="selected"' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level'] - 1) . '=&gt;' : '', ' ', $board['name'], '&nbsp;</option>';
-			echo '
-										</optgroup>';
-		}
-		echo '
-									</select>
-								</li>';
+			<div id="main_grid">
+				', template_show_month_grid('main'), '
+			</div>
+		';
 	}
 
-	if (!empty($modSettings['cal_allowspan']) || $context['event']['new'])
-		echo '
-							</ul>
-						</div>
-					</fieldset>';
-
-	echo '
-					<div class="righttext">
-						<input type="submit" value="', empty($context['event']['new']) ? $txt['save'] : $txt['post'], '" class="button_submit" />';
-	// Delete button?
-	if (empty($context['event']['new']))
-		echo '
-						<input type="submit" name="deleteevent" value="', $txt['event_delete'], '" onclick="return confirm(\'', $txt['calendar_confirm_delete'], '\');" class="button_submit" />';
-
-	echo '
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="hidden" name="eventid" value="', $context['event']['eventid'], '" />
-					</div>
-				</div>
-				<span class="lowerframe"><span></span></span>
-			</div>
-			</div>
-		</form>
-		<br class="clear" />';
+	// Close our wrapper.
+	echo '<br class="clear">
+	</div>';
 }
 
 // Display a monthly calendar grid.
-function template_show_month_grid($grid_name)
+function template_show_month_grid($grid_name, $is_mini = false)
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings, $smcFunc;
+	global $context, $settings, $txt, $scripturl, $modSettings;
 
+	// If the grid doesn't exist, no point in proceeding.
 	if (!isset($context['calendar_grid_' . $grid_name]))
 		return false;
 
+	// A handy little pointer variable.
 	$calendar_data = &$context['calendar_grid_' . $grid_name];
-	$colspan = !empty($calendar_data['show_week_links']) ? 8 : 7;
 
+	// Some conditions for whether or not we should show the week links *here*.
+	if (isset($calendar_data['show_week_links']) && ($calendar_data['show_week_links'] == 3 || (($calendar_data['show_week_links'] == 1 && $is_mini === true) || $calendar_data['show_week_links'] == 2 && $is_mini === false)))
+		$show_week_links = true;
+	else
+		$show_week_links = false;
+
+	// Assuming that we've not disabled it, show the title block!
 	if (empty($calendar_data['disable_title']))
 	{
 		echo '
 			<div class="cat_bar">
-				<h3 class="catbg centertext" style="font-size: ', $calendar_data['size'] == 'large' ? 'large' : 'small', ';">';
+				<h3 class="catbg centertext largetext">';
 
-		if (empty($calendar_data['previous_calendar']['disabled']) && $calendar_data['show_next_prev'])
-			echo '
-					<span class="floatleft"><a href="', $calendar_data['previous_calendar']['href'], '">&#171;</a></span>';
+				// Previous Link: If we're showing prev / next and it's not a mini-calendar.
+				if (empty($calendar_data['previous_calendar']['disabled']) && $calendar_data['show_next_prev'] && $is_mini === false)
+				{
+					echo '
+						<span class="floatleft xlarge_text">
+							<a href="', $calendar_data['previous_calendar']['href'], '">&#171;</a>
+						</span>
+					';
+				}
 
-		if (empty($calendar_data['next_calendar']['disabled']) && $calendar_data['show_next_prev'])
-			echo '
-					<span class="floatright"><a href="', $calendar_data['next_calendar']['href'], '">&#187;</a></span>';
+				// Arguably the most exciting part, the title!
+				echo '<a href="', $scripturl, '?action=calendar;year=', $calendar_data['current_year'], ';month=', $calendar_data['current_month'], '">', $txt['months_titles'][$calendar_data['current_month']], ' ', $calendar_data['current_year'], '</a>';
 
-		if ($calendar_data['show_next_prev'])
-			echo '
-					', $txt['months_titles'][$calendar_data['current_month']], ' ', $calendar_data['current_year'];
-		else
-			echo '
-					<a href="', $scripturl, '?action=calendar;year=', $calendar_data['current_year'], ';month=', $calendar_data['current_month'], '">', $txt['months_titles'][$calendar_data['current_month']], ' ', $calendar_data['current_year'], '</a>';
+				// Next Link: if we're showing prev / next and it's not a mini-calendar.
+				if (empty($calendar_data['next_calendar']['disabled']) && $calendar_data['show_next_prev'] && $is_mini === false)
+				{
+					echo '
+						<span class="floatright xlarge_text">
+							<a href="', $calendar_data['next_calendar']['href'], '">&#187;</a>
+						</span>
+					';
+				}
 
-		echo '
+				echo '
 				</h3>
-			</div>';
+			</div>
+		';
 	}
 
-	echo '
-				<table cellspacing="1" class="calendar_table">';
+	// Finally, the main calendar table.
+	echo '<table class="calendar_table">';
 
 	// Show each day of the week.
 	if (empty($calendar_data['disable_day_titles']))
 	{
-		echo '
-					<tr class="titlebg2">';
+		echo '<tr>';
 
-		if (!empty($calendar_data['show_week_links']))
-			echo '
-						<th>&nbsp;</th>';
+		// If we're showing week links, there's an extra column ahead of the week links, so let's think ahead and be prepared!
+		if ($show_week_links === true)
+			echo '<th>&nbsp;</th>';
 
+		// Now, loop through each actual day of the week.
 		foreach ($calendar_data['week_days'] as $day)
 		{
-			echo '
-						<th class="days" scope="col" ', $calendar_data['size'] == 'small' ? 'style="font-size: x-small;"' : '', '>', !empty($calendar_data['short_day_titles']) ? ($smcFunc['substr']($txt['days'][$day], 0, 1)) : $txt['days'][$day], '</th>';
+			echo '<th class="days" scope="col">', !empty($calendar_data['short_day_titles']) || $is_mini === true ? $txt['days_short'][$day] : $txt['days'][$day], '</th>';
 		}
-		echo '
-					</tr>';
+
+		echo '</tr>';
 	}
 
-	/* Each week in weeks contains the following:
-		days (a list of days), number (week # in the year.) */
+	// Our looping begins on a per-week basis.
 	foreach ($calendar_data['weeks'] as $week)
 	{
-		echo '
-					<tr>';
 
-		if (!empty($calendar_data['show_week_links']))
+		// Some useful looping variables.
+		$current_month_started = false;
+		$count = 1;
+		$final_count = 1;
+
+		echo '<tr class="days_wrapper">';
+
+		// This is where we add the actual week link, if enabled on this location.
+		if ($show_week_links === true)
+		{
 			echo '
-						<td class="windowbg2 weeks">
-							<a href="', $scripturl, '?action=calendar;viewweek;year=', $calendar_data['current_year'], ';month=', $calendar_data['current_month'], ';day=', $week['days'][0]['day'], '">&#187;</a>
-						</td>';
-
-		/* Every day has the following:
-			day (# in month), is_today (is this day *today*?), is_first_day (first day of the week?),
-			holidays, events, birthdays. (last three are lists.) */
+				<td class="windowbg2 weeks">
+					<a href="', $scripturl, '?action=calendar;viewweek;year=', $calendar_data['current_year'], ';month=', $calendar_data['current_month'], ';day=', $week['days'][0]['day'], '" title="', $txt['calendar_view_week'], '">&#187;</a>
+				</td>
+			';
+		}
+
+		// Now loop through each day in the week we're on.
 		foreach ($week['days'] as $day)
 		{
-			// If this is today, make it a different color and show a border.
-			echo '
-						<td style="height: ', $calendar_data['size'] == 'small' ? '20' : '100', 'px; padding: 2px;', $calendar_data['size'] == 'small' ? 'font-size: x-small;' : '', '" class="', $day['is_today'] ? 'calendar_today' : 'windowbg', ' days">';
+			// What classes should each day inherit? Day is default.
+			$classes = array('days');
+			if (!empty($day['day']))
+			{
 
-			// Skip it if it should be blank - it's not a day if it has no number.
+				// Default Classes (either compact or comfortable and either calendar_today or windowbg).
+				$classes[] = !empty($calendar_data['size']) && $calendar_data['size'] == 'small' ? 'compact' : 'comfortable';
+				$classes[] = !empty($day['is_today']) ? 'calendar_today' : 'windowbg';
+
+				// Additional classes are given for events, holidays, and birthdays.
+				if (!empty($day['events']) && !empty($calendar_data['highlight']['events']))
+				{
+					if ($is_mini === true && in_array($calendar_data['highlight']['events'], array(1,3)))
+						$classes[] = 'events';
+					elseif ($is_mini === false && in_array($calendar_data['highlight']['events'], array(2,3)))
+						$classes[] = 'events';
+				}
+				if (!empty($day['holidays']) && !empty($calendar_data['highlight']['holidays']))
+				{
+					if ($is_mini === true && in_array($calendar_data['highlight']['holidays'], array(1,3)))
+						$classes[] = 'holidays';
+					elseif ($is_mini === false && in_array($calendar_data['highlight']['holidays'], array(2,3)))
+						$classes[] = 'holidays';
+				}
+				if (!empty($day['birthdays']) && !empty($calendar_data['highlight']['birthdays']))
+				{
+					if ($is_mini === true && in_array($calendar_data['highlight']['birthdays'], array(1,3)))
+						$classes[] = 'birthdays';
+					elseif ($is_mini === false && in_array($calendar_data['highlight']['birthdays'], array(2,3)))
+						$classes[] = 'birthdays';
+				}
+			}
+			else
+				$classes[] = 'disabled';
+
+			// Now, implode the classes for each day.
+			echo '<td class="', implode(' ', $classes), '">';
+
+			// If it's within this current month, go ahead and begin.
 			if (!empty($day['day']))
 			{
-				// Should the day number be a link?
-				if (!empty($modSettings['cal_daysaslink']) && $context['can_post'])
-					echo '
-							<a href="', $scripturl, '?action=calendar;sa=post;month=', $calendar_data['current_month'], ';year=', $calendar_data['current_year'], ';day=', $day['day'], ';', $context['session_var'], '=', $context['session_id'], '">', $day['day'], '</a>';
-				else
-					echo '
-							', $day['day'];
 
-				// Is this the first day of the week? (and are we showing week numbers?)
-				if ($day['is_first_day'] && $calendar_data['size'] != 'small')
-					echo '<span class="smalltext"> - <a href="', $scripturl, '?action=calendar;viewweek;year=', $calendar_data['current_year'], ';month=', $calendar_data['current_month'], ';day=', $day['day'], '">', $txt['calendar_week'], ' ', $week['number'], '</a></span>';
+				// If it's the first day of this month and not a mini-calendar, we'll add the month title - whether short or full.
+				$title_prefix = !empty($day['is_first_of_month']) && $context['current_month'] == $calendar_data['current_month'] && $is_mini === false ? (!empty($calendar_data['short_month_titles']) ? $txt['months_short'][$calendar_data['current_month']] . ' ' : $txt['months_titles'][$calendar_data['current_month']] . ' ') : '';
 
-				// Are there any holidays?
-				if (!empty($day['holidays']))
-					echo '
-							<div class="smalltext holiday">', $txt['calendar_prompt'], ' ', implode(', ', $day['holidays']), '</div>';
+				// The actual day number - be it a link, or just plain old text!
+				if (!empty($modSettings['cal_daysaslink']) && $context['can_post'])
+					echo '<a href="', $scripturl, '?action=calendar;sa=post;year=', $calendar_data['current_year'], ';month=', $calendar_data['current_month'], ';day=', $day['day'], ';', $context['session_var'], '=', $context['session_id'], '"><span class="day_text">', $title_prefix, $day['day'], '</span></a>';
+				else
+					echo '<span class="day_text">', $title_prefix, $day['day'], '</span>';
 
-				// Show any birthdays...
-				if (!empty($day['birthdays']))
+				// A lot of stuff, we're not showing on mini-calendars to conserve space.
+				if ($is_mini === false)
 				{
-					echo '
-							<div class="smalltext">
-								<span class="birthday">', $txt['birthdays'], '</span>';
+					// Holidays are always fun, let's show them!
+					if (!empty($day['holidays']))
+						echo '<div class="smalltext holiday"><span>', $txt['calendar_prompt'], '</span> ', implode(', ', $day['holidays']), '</div>';
 
-					/* Each of the birthdays has:
-						id, name (person), age (if they have one set?), and is_last. (last in list?) */
-					$use_js_hide = empty($context['show_all_birthdays']) && count($day['birthdays']) > 15;
-					$count = 0;
-					foreach ($day['birthdays'] as $member)
+					// Happy Birthday Dear, Member!
+					if (!empty($day['birthdays']))
 					{
 						echo '
-									<a href="', $scripturl, '?action=profile;u=', $member['id'], '">', $member['name'], isset($member['age']) ? ' (' . $member['age'] . ')' : '', '</a>', $member['is_last'] || ($count == 10 && $use_js_hide)? '' : ', ';
+							<div class="smalltext">
+								<span class="birthday">', $txt['birthdays'], '</span>';
 
-						// Stop at ten?
-						if ($count == 10 && $use_js_hide)
-							echo '<span class="hidelink" id="bdhidelink_', $day['day'], '">...<br /><a href="', $scripturl, '?action=calendar;month=', $calendar_data['current_month'], ';year=', $calendar_data['current_year'], ';showbd" onclick="document.getElementById(\'bdhide_', $day['day'], '\').style.display = \'\'; document.getElementById(\'bdhidelink_', $day['day'], '\').style.display = \'none\'; return false;">(', sprintf($txt['calendar_click_all'], count($day['birthdays'])), ')</a></span><span id="bdhide_', $day['day'], '" style="display: none;">, ';
+						/* Each of the birthdays has:
+							id, name (person), age (if they have one set?), and is_last. (last in list?) */
+						$use_js_hide = empty($context['show_all_birthdays']) && count($day['birthdays']) > 15;
+						$birthday_count = 0;
+						foreach ($day['birthdays'] as $member)
+						{
+							echo '<a href="', $scripturl, '?action=profile;u=', $member['id'], '"><span class="fix_rtl_names">', $member['name'], '</span>', isset($member['age']) ? ' (' . $member['age'] . ')' : '', '</a>', $member['is_last'] || ($count == 10 && $use_js_hide) ? '' : ', ';
+
+							// 9...10! Let's stop there.
+							if ($birthday_count == 10 && $use_js_hide)
+								// !!TODO - Inline CSS and JavaScript should be moved.
+								echo '<span class="hidelink" id="bdhidelink_', $day['day'], '">...<br><a href="', $scripturl, '?action=calendar;month=', $calendar_data['current_month'], ';year=', $calendar_data['current_year'], ';showbd" onclick="document.getElementById(\'bdhide_', $day['day'], '\').style.display = \'\'; document.getElementById(\'bdhidelink_', $day['day'], '\').style.display = \'none\'; return false;">(', sprintf($txt['calendar_click_all'], count($day['birthdays'])), ')</a></span><span id="bdhide_', $day['day'], '" style="display: none;">, ';
+
+							++$birthday_count;
+						}
+						if ($use_js_hide)
+							echo '</span>';
 
-						$count++;
+						echo '</div>';
 					}
-					if ($use_js_hide)
-						echo '
-								</span>';
 
-					echo '
-							</div>';
-				}
-
-				// Any special posted events?
-				if (!empty($day['events']))
-				{
-					echo '
-							<div class="smalltext">
-								<span class="event">', $txt['events'], '</span>';
-
-					/* The events are made up of:
-						title, href, is_last, can_edit (are they allowed to?), and modify_href. */
-					foreach ($day['events'] as $event)
+					// Any special posted events?
+					if (!empty($day['events']))
 					{
-						// If they can edit the event, show a star they can click on....
-						if ($event['can_edit'])
-							echo '
-								<a class="modify_event" href="', $event['modify_href'], '"><img src="' . $settings['images_url'] . '/icons/modify_small.gif" alt="*" /></a>';
-
 						echo '
-								', $event['link'], $event['is_last'] ? '' : ', ';
-					}
+							<div class="smalltext lefttext">
+								<span class="event">', $txt['events'], '</span><br>';
 
-					echo '
-							</div>';
+						/* The events are made up of:
+							title, href, is_last, can_edit (are they allowed to?), and modify_href. */
+						foreach ($day['events'] as $event)
+						{
+							// If they can edit the event, show an icon they can click on....
+							if ($event['can_edit'])
+							{
+								echo '
+									<a class="modify_event" href="', $event['modify_href'], '">
+										<img src="', $settings['images_url'], '/icons/calendar_modify.png" alt="*" title="', $txt['calendar_edit'], '" class="calendar_icon">
+									</a>
+								';
+							}
+							// Exporting!
+							if ($event['can_export'])
+							{
+								echo '
+									<a class="modify_event" href="', $event['export_href'], '">
+										<img src="', $settings['images_url'], '/icons/calendar_export.png" alt=">" title="', $txt['calendar_export'], '" class="calendar_icon">
+									</a>
+								';
+							}
+							echo $event['is_selected'] ? '<div class="sel_event">' . $event['link'] . '</div>' : $event['link'], $event['is_last'] ? '' : '<br>';
+						}
+
+						echo '</div>';
+					}
 				}
+				$current_month_started = $count;
+			}
+			// Otherwise, assuming it's not a mini-calendar, we can show previous / next month days!
+			elseif ($is_mini === false)
+			{
+				if (empty($current_month_started) && !empty($context['calendar_grid_prev']))
+					echo '<a href="', $scripturl, '?action=calendar;year=', $context['calendar_grid_prev']['current_year'], ';month=', $context['calendar_grid_prev']['current_month'], '">', $context['calendar_grid_prev']['last_of_month'] - $calendar_data['shift']-- + 1, '</a>';
+				elseif (!empty($current_month_started) && !empty($context['calendar_grid_next']))
+					echo '<a href="', $scripturl, '?action=calendar;year=', $context['calendar_grid_next']['current_year'], ';month=', $context['calendar_grid_next']['current_month'], '">', $current_month_started + 1 == $count ? (!empty($calendar_data['short_month_titles']) ? $txt['months_short'][$context['calendar_grid_next']['current_month']] . ' ' : $txt['months_titles'][$context['calendar_grid_next']['current_month']] . ' ') : '', $final_count++, '</a>';
 			}
 
-			echo '
-						</td>';
+			// Close this day and increase var count.
+			echo '</td>';
+			++$count;
 		}
 
-		echo '
-					</tr>';
+		echo '</tr>';
 	}
 
-	echo '
-				</table>';
+	// Quick Month Navigation + Post Event Link on Main Grids!
+	if ($is_mini === false)
+		template_calendar_base($show_week_links === true ? 8 : 7);
+
+	// The end of our main table.
+	echo '</table>';
 }
 
 // Or show a weekly one?
 function template_show_week_grid($grid_name)
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $settings, $txt, $scripturl, $modSettings;
 
+	// We might have no reason to proceed, if the variable isn't there.
 	if (!isset($context['calendar_grid_' . $grid_name]))
 		return false;
 
+	// Handy pointer.
 	$calendar_data = &$context['calendar_grid_' . $grid_name];
 
-	// Loop through each month (At least one) and print out each day.
+	// At the very least, we have one month. Possibly two, though.
+	$iteration = 1;
+	$num_months = count($calendar_data['months']);
 	foreach ($calendar_data['months'] as $month_data)
 	{
-		echo '
-			<div class="cat_bar">
-				<h3 class="catbg weekly">';
-
-		if (empty($calendar_data['previous_calendar']['disabled']) && $calendar_data['show_next_prev'] && empty($done_title))
+		// For our first iteration, we'll add a nice header!
+		if ($iteration == 1)
+		{
 			echo '
-					<span class="floatleft"><a href="', $calendar_data['previous_week']['href'], '">&#171;</a></span>';
+				<div class="cat_bar">
+					<h3 class="catbg centertext largetext">';
+					// Previous Week Link...
+					if (empty($calendar_data['previous_calendar']['disabled']) && !empty($calendar_data['show_next_prev']))
+					{
+						echo '
+							<span class="floatleft xlarge_text">
+								<a href="', $calendar_data['previous_week']['href'], '">&#171;</a>
+							</span>
+						';
+					}
 
-		if (empty($calendar_data['next_calendar']['disabled']) && $calendar_data['show_next_prev'] && empty($done_title))
-			echo '
-					<span class="floatright"><a href="', $calendar_data['next_week']['href'], '">&#187;</a></span>';
+					// The Month Title + Week Number...
+					if (!empty($calendar_data['week_title']))
+							echo $calendar_data['week_title'];
 
-		echo '
-					<a href="', $scripturl, '?action=calendar;month=', $month_data['current_month'], ';year=', $month_data['current_year'], '">', $txt['months_titles'][$month_data['current_month']], ' ', $month_data['current_year'], '</a>', empty($done_title) && !empty($calendar_data['week_number']) ? (' - ' . $txt['calendar_week'] . ' ' . $calendar_data['week_number']) : '', '
-				</h3>
-			</div>';
+					// Next Week Link...
+					if (empty($calendar_data['next_calendar']['disabled']) && !empty($calendar_data['show_next_prev']))
+					{
+						echo '
+							<span class="floatright xlarge_text">
+								<a href="', $calendar_data['next_week']['href'], '">&#187;</a>
+							</span>
+						';
+					}
 
-		$done_title = true;
+					echo '
+					</h3>
+				</div>
+			';
+		}
 
+		// Our actual month...
 		echo '
-				<table width="100%" class="calendar_table weeklist" cellspacing="1" cellpadding="0">';
-
-		foreach ($month_data['days'] as $day)
-		{
-			echo '
-					<tr>
-						<td colspan="2">
-							<div class="title_bar">
-								<h4 class="titlebg">', $txt['days'][$day['day_of_week']], '</h4>
-							</div>
-						</td>
-					</tr>
-					<tr>
-						<td class="windowbg">';
+			<div class="week_month_title">
+				<a href="', $scripturl, '?action=calendar;month=', $month_data['current_month'], '">
+					', $txt['months_titles'][$month_data['current_month']], '
+				</a>
+			</div>
+		';
 
-			// Should the day number be a link?
-			if (!empty($modSettings['cal_daysaslink']) && $context['can_post'])
-				echo '
-							<a href="', $scripturl, '?action=calendar;sa=post;month=', $month_data['current_month'], ';year=', $month_data['current_year'], ';day=', $day['day'], ';', $context['session_var'], '=', $context['session_id'], '">', $day['day'], '</a>';
-			else
-				echo '
-							', $day['day'];
+		// The main table grid for $this week.
+		echo '
+			<table class="table_grid calendar_week">
+				<tr>
+					<th class="days" scope="col">', $txt['calendar_day'], '</th>
+					<th class="days" scope="col">', $txt['events'], '</th>
+					<th class="days" scope="col">', $txt['calendar_prompt'], '</th>
+					<th class="days" scope="col">', $txt['birthdays'], '</th>
+				</tr>';
+				// Each day of the week.
+				foreach ($month_data['days'] as $day)
+				{
+					// How should we be highlighted or otherwise not...?
+					$classes = array('days');
+					$classes[] = !empty($calendar_data['size']) && $calendar_data['size'] == 'small' ? 'compact' : 'comfortable';
+					$classes[] = !empty($day['is_today']) ? 'calendar_today' : 'windowbg';
 
-			echo '
-						</td>
-						<td class="', $day['is_today'] ? 'calendar_today' : 'windowbg2', ' weekdays">';
+					echo '
+						<tr class="days_wrapper">
+							<td class="', implode(' ', $classes), ' act_day">';
+							// Should the day number be a link?
+							if (!empty($modSettings['cal_daysaslink']) && $context['can_post'])
+								echo '<a href="', $scripturl, '?action=calendar;sa=post;month=', $month_data['current_month'], ';year=', $month_data['current_year'], ';day=', $day['day'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['days'][$day['day_of_week']], ' - ', $day['day'], '</a>';
+							else
+								echo $txt['days'][$day['day_of_week']], ' - ', $day['day'];
+
+							echo '</td>
+							<td class="', implode(' ', $classes), '', empty($day['events']) ? (' disabled' . ($context['can_post'] ? ' week_post' : '')) : ' events', '">';
+							// Show any events...
+							if (!empty($day['events']))
+							{
+								echo '<div class="event_cont floatleft">';
+								foreach ($day['events'] as $event)
+								{
+									// If they can edit the event, show a star they can click on....
+									if (!empty($event['can_edit']))
+									{
+										echo '
+											<a href="', $event['modify_href'], '">
+												<img src="', $settings['images_url'], '/icons/calendar_modify.png" alt="*" title="', $txt['calendar_edit'], '" class="calendar_icon">
+											</a>
+										';
+									}
+									// Can we export? Sweet.
+									if (!empty($event['can_export']))
+									{
+										echo '
+											<a class="modify_event" href="', $event['export_href'], '">
+												<img src="', $settings['images_url'], '/icons/calendar_export.png" alt=">" title="', $txt['calendar_export'], '" class="calendar_icon">
+											</a>
+										';
+									}
+									echo $event['link'], $event['is_last'] ? '' : '<br>';
+								}
+								echo '
+									</div>
+									<div class="active_post_event floatright">
+										<a href="', $scripturl, '?action=calendar;sa=post;month=', $month_data['current_month'], ';year=', $month_data['current_year'], ';day=', $day['day'], ';', $context['session_var'], '=', $context['session_id'], '">
+											<img src="', $settings['images_url'], '/icons/plus.png" alt="*" title="', $txt['calendar_post_event'], '">
+										</a>
+									</div>
+									<br class="clear">
+								';
+							}
+							else
+							{
+								if (!empty($context['can_post']))
+								{
+									echo '
+										<div class="week_add_event">
+											<a href="', $scripturl, '?action=calendar;sa=post;month=', $month_data['current_month'], ';year=', $month_data['current_year'], ';day=', $day['day'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['calendar_post_event'], '</a>
+										</div>
+									';
+								}
+							}
+							echo '</td>
+							<td class="', implode(' ', $classes), !empty($day['holidays']) ? ' holidays' : ' disabled', '">';
+							// Show any holidays!
+							if (!empty($day['holidays']))
+								echo implode('<br>', $day['holidays']);
+
+							echo '</td>
+							<td class="', implode(' ', $classes), '', !empty($day['birthdays']) ? ' birthdays' : ' disabled', '">';
+							// Show any birthdays...
+							if (!empty($day['birthdays']))
+							{
+								foreach ($day['birthdays'] as $member)
+								{
+									echo '
+										<a href="', $scripturl, '?action=profile;u=', $member['id'], '">', $member['name'], '</a>
+										', isset($member['age']) ? ' (' . $member['age'] . ')' : '', '
+									', $member['is_last'] ? '' : '<br>';
+								}
+							}
+							echo '</td>
+						</tr>
+					';
+				}
 
-			// Are there any holidays?
-			if (!empty($day['holidays']))
-				echo '
-							<div class="smalltext holiday">', $txt['calendar_prompt'], ' ', implode(', ', $day['holidays']), '</div>';
+				// We'll show the lower column after our last month is shown.
+				if ($iteration == $num_months)
+					template_calendar_base(4);
 
-			// Show any birthdays...
-			if (!empty($day['birthdays']))
-			{
-				echo '
-							<div class="smalltext">
-								<span class="birthday">', $txt['birthdays'], '</span>';
+				// Increase iteration for loop counting.
+				++$iteration;
 
-				/* Each of the birthdays has:
-					id, name (person), age (if they have one set?), and is_last. (last in list?) */
-				foreach ($day['birthdays'] as $member)
-					echo '
-								<a href="', $scripturl, '?action=profile;u=', $member['id'], '">', $member['name'], isset($member['age']) ? ' (' . $member['age'] . ')' : '', '</a>', $member['is_last'] ? '' : ', ';
 				echo '
-							</div>';
-			}
+			</table>
+		';
+	}
+}
 
-			// Any special posted events?
-			if (!empty($day['events']))
-			{
-				echo '
-							<div class="smalltext">
-								<span class="event">', $txt['events'], '</span>';
+/*
+ * Calendar Grid Base
+ *
+ * This function is ONLY designed for use
+ * within an existing table element.
+ *
+ * @param int $col_span = 1
+ */
+function template_calendar_base($col_span = 1)
+{
+	global $context, $scripturl, $txt;
+	echo '
+		<tr>
+			<td id="post_event" colspan="', $col_span, '">
+				', template_button_strip($context['calendar_buttons'], 'right'), '
+				<form action="', $scripturl, '?action=calendar" id="calendar_navigation" method="post" accept-charset="', $context['character_set'], '">
+					<select name="month" id="input_month">';
+					// Show a select box with all the months.
+					foreach ($txt['months'] as $number => $month)
+					{
+						echo '<option value="', $number, '"', $number == $context['current_month'] ? ' selected' : '', '>', $month, '</option>';
+					}
+					echo '</select>
+											<select name="year">';
+					// Show a link for every year.....
+					for ($year = $context['calendar_resources']['min_year']; $year <= $context['calendar_resources']['max_year']; $year++)
+					{
+						echo '<option value="', $year, '"', $year == $context['current_year'] ? ' selected' : '', '>', $year, '</option>';
+					}
+					echo '</select>
+					<input type="submit" class="button_submit" id="view_button" value="', $txt['view'], '">
+				</form>
+				<br class="clear">
+			</td>
+		</tr>
+	';
+}
 
-				/* The events are made up of:
-					title, href, is_last, can_edit (are they allowed to?), and modify_href. */
-				foreach ($day['events'] as $event)
-				{
-					// If they can edit the event, show a star they can click on....
-					if ($event['can_edit'])
-						echo '
-								<a href="', $event['modify_href'], '"><img src="' . $settings['images_url'] . '/icons/modify_small.gif" alt="*" /></a> ';
+// Template for posting a calendar event.
+function template_event_post()
+{
+	global $context, $txt, $scripturl, $modSettings;
 
-					echo '
-								', $event['link'], $event['is_last'] ? '' : ', ';
-				}
+	echo '
+		<form action="', $scripturl, '?action=calendar;sa=post" method="post" name="postevent" accept-charset="', $context['character_set'], '" onsubmit="submitonce(this);smc_saveEntities(\'postevent\', [\'evtitle\']);" style="margin: 0;">';
 
-				echo '
-							</div>';
-			}
+	if (!empty($context['event']['new']))
+		echo '<input type="hidden" name="eventid" value="', $context['event']['eventid'], '">';
 
-			echo '
-						</td>
-					</tr>';
-		}
+	// Start the main table.
+	echo '
+		<div id="post_event">
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $context['page_title'], '
+				</h3>
+			</div>';
 
+	if (!empty($context['post_error']['messages']))
+	{
 		echo '
-				</table>';
+			<div class="errorbox">
+				<dl class="event_error">
+					<dt>
+						', $context['error_type'] == 'serious' ? '<strong>' . $txt['error_while_submitting'] . '</strong>' : '', '
+					</dt>
+					<dt class="error">
+						', implode('<br>', $context['post_error']['messages']), '
+					</dt>
+				</dl>
+			</div>';
 	}
-}
 
-function template_bcd()
-{
-	global $context, $scripturl;
+	echo '
+			<div class="roundframe">
+				<fieldset id="event_main">
+					<legend><span', isset($context['post_error']['no_event']) ? ' class="error"' : '', '>', $txt['calendar_event_title'], '</span></legend>
+					<input type="text" name="evtitle" maxlength="255" size="70" value="', $context['event']['title'], '" class="input_text">
+					<div class="smalltext" style="white-space: nowrap;">
+						<input type="hidden" name="calendar" value="1">', $txt['calendar_year'], '
+						<select name="year" id="year" onchange="generateDays();">';
+
+	// Show a list of all the years we allow...
+	for ($year = $context['calendar_resources']['min_year']; $year <= $context['calendar_resources']['max_year']; $year++)
+		echo '
+							<option value="', $year, '"', $year == $context['event']['year'] ? ' selected' : '', '>', $year, '&nbsp;</option>';
 
 	echo '
-	<table cellpadding="0" cellspacing="1" align="center">
-		<caption class="titlebg">BCD Clock</caption>
-		<tr class="windowbg">';
+						</select>
+						', $txt['calendar_month'], '
+						<select name="month" id="month" onchange="generateDays();">';
 
-	$alt = false;
-	foreach ($context['clockicons'] as $t => $v)
+	// There are 12 months per year - ensure that they all get listed.
+	for ($month = 1; $month <= 12; $month++)
+		echo '
+							<option value="', $month, '"', $month == $context['event']['month'] ? ' selected' : '', '>', $txt['months'][$month], '&nbsp;</option>';
+
+	echo '
+						</select>
+						', $txt['calendar_day'], '
+						<select name="day" id="day">';
+
+	// This prints out all the days in the current month - this changes dynamically as we switch months.
+	for ($day = 1; $day <= $context['event']['last_day']; $day++)
+		echo '
+							<option value="', $day, '"', $day == $context['event']['day'] ? ' selected' : '', '>', $day, '&nbsp;</option>';
+
+	echo '
+						</select>
+					</div>
+				</fieldset>';
+
+	if (!empty($modSettings['cal_allowspan']) || $context['event']['new'])
+		echo '
+				<fieldset id="event_options">
+					<legend>', $txt['calendar_event_options'], '</legend>
+					<div class="event_options smalltext">
+						<ul class="event_options">';
+
+	// If events can span more than one day then allow the user to select how long it should last.
+	if (!empty($modSettings['cal_allowspan']))
 	{
 		echo '
-			<td style="padding-', $alt ? 'right' : 'left', ': 1.5em;" valign="bottom">';
+							<li>
+								', $txt['calendar_numb_days'], '
+								<select name="span">';
 
-		foreach ($v as $i)
+		for ($days = 1; $days <= $modSettings['cal_maxspan']; $days++)
 			echo '
-				<img src="', $context['offimg'], '" alt="" id="', $t, '_', $i, '" /><br />';
+									<option value="', $days, '"', $context['event']['span'] == $days ? ' selected' : '', '>', $days, '&nbsp;</option>';
 
 		echo '
-			</td>';
+								</select>
+							</li>';
+	}
 
-		$alt = !$alt;
+	// If this is a new event let the user specify which board they want the linked post to be put into.
+	if (!empty($context['event']['categories']))
+	{
+		echo '
+							<li>
+								', $txt['calendar_link_event'], '
+								<input type="checkbox" style="vertical-align: middle;" class="input_check" name="link_to_board"', ($context['event']['new'] ? ' checked' : ''), ' onclick="toggleLinked(this.form);">
+							</li>
+							<li>
+								', $txt['calendar_post_in'], '
+								<select id="board" name="board" onchange="this.form.submit();"', ($context['event']['new'] ? '' : ' disabled'), '>';
+		foreach ($context['event']['categories'] as $category)
+		{
+			echo '
+									<optgroup label="', $category['name'], '">';
+			foreach ($category['boards'] as $board)
+				echo '
+										<option value="', $board['id'], '"', $board['selected'] ? ' selected' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level'] - 1) . '=&gt;' : '', ' ', $board['name'], '&nbsp;</option>';
+			echo '
+									</optgroup>';
+		}
+		echo '
+								</select>
+							</li>';
 	}
 
+	if (!empty($modSettings['cal_allowspan']) || $context['event']['new'])
+		echo '
+						</ul>
+					</div>
+				</fieldset>';
+
 	echo '
-		</tr>
-	</table>
-	<p align="center"><a href="', $scripturl, '?action=clock;rb">Are you hardcore?</a></p>
+				<input type="submit" value="', empty($context['event']['new']) ? $txt['save'] : $txt['post'], '" class="button_submit">';
+	// Delete button?
+	if (empty($context['event']['new']))
+		echo '
+				<input type="submit" name="deleteevent" value="', $txt['event_delete'], '" data-confirm="', $txt['calendar_confirm_delete'], '" class="button_submit you_sure">';
+
+	echo '
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="eventid" value="', $context['event']['eventid'], '">
 
-		<script type="text/javascript"><!-- // --><![CDATA[
+			</div>
+		</div>
+		</form>';
+}
+
+function template_bcd()
+{
+	global $context, $scripturl;
+	$alt = false;
+	echo '
+		<table class="table_grid" style="margin: 0 auto 0 auto; border: 1px solid #ccc;">
+			<tr>
+				<th class="windowbg2" style="font-weight: bold; text-align: center; border-bottom: 1px solid #ccc;" colspan="6">BCD Clock</th>
+			</tr>
+			<tr class="windowbg">';
+			foreach ($context['clockicons'] as $t => $v)
+			{
+				echo '<td style="padding-', $alt ? 'right' : 'left', ': 1.5em;">';
+				foreach ($v as $i)
+				{
+					echo '<img src="', $context['offimg'], '" alt="" id="', $t, '_', $i, '"><br>';
+				}
+				echo '</td>';
+				$alt = !$alt;
+			}
+			echo '</tr>
+			<tr class="', $alt ? 'windowbg2' : 'windowbg', '" style="border-top: 1px solid #ccc; text-align: center;">
+				<td colspan="6">
+					<a href="', $scripturl, '?action=clock;rb">Are you hardcore?</a>
+				</td>
+			</tr>
+		</table>
+
+		<script><!-- // --><![CDATA[
 		var icons = new Object();';
 
 		foreach ($context['clockicons'] as $t => $v)
@@ -626,31 +754,37 @@
 function template_hms()
 {
 	global $context, $scripturl;
-
-	echo '
-<table cellpadding="0" cellspacing="1" align="center">
-	<caption class="titlebg">Binary Clock</caption>';
 	$alt = false;
-	foreach ($context['clockicons'] as $t => $v)
-	{
-		echo '
-	<tr class="', $alt ? 'windowbg2' : 'windowbg', '">
-		<td align="right">';
-		foreach ($v as $i)
-			echo '
-			<img src="', $context['offimg'], '" alt="" id="', $t, '_', $i, '" />';
-		echo '
-		</td>';
-		$alt = !$alt;
-	}
-
 	echo '
-	</tr>
-	<tr class="', $alt ? 'windowbg2' : 'windowbg', '"><td colspan="6" align="center"><a href="', $scripturl, '?action=clock">Too tough for you?</a></td></tr>
-</table>';
+		<table class="table_grid" style="margin: 0 auto 0 auto; border: 1px solid #ccc;">
+			<tr>
+				<th class="windowbg2" style="font-weight: bold; text-align: center; border-bottom: 1px solid #ccc;">Binary Clock</th>
+			</tr>';
+			foreach ($context['clockicons'] as $t => $v)
+			{
+				echo '
+					<tr class="', $alt ? 'windowbg2' : 'windowbg', '">
+						<td>';
+						foreach ($v as $i)
+						{
+							echo '<img src="', $context['offimg'], '" alt="" id="', $t, '_', $i, '" style="padding: 2px;">';
+						}
+						echo '</td>
+					</tr>
+				';
+				$alt = !$alt;
+			}
+			echo '</tr>
+			<tr class="', $alt ? 'windowbg2' : 'windowbg', '" style="border-top: 1px solid #ccc; text-align: center;">
+				<td>
+					<a href="', $scripturl, '?action=clock">Too tough for you?</a>
+				</td>
+			</tr>
+		</table>
+	';
 
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 	var icons = new Object();';
 
 	foreach ($context['clockicons'] as $t => $v)
@@ -709,31 +843,33 @@
 
 function template_omfg()
 {
-	global $context, $scripturl;
-
-	echo '
-<table cellpadding="0" cellspacing="1" align="center">
-	<caption class="titlebg">OMFG Binary Clock</caption>';
+	global $context;
 	$alt = false;
-	foreach ($context['clockicons'] as $t => $v)
-	{
-		echo '
-	<tr class="', $alt ? 'windowbg2' : 'windowbg', '">
-		<td align="right">';
-		foreach ($v as $i)
-			echo '
-			<img src="', $context['offimg'], '" alt="" id="', $t, '_', $i, '" />';
-		echo '
-		</td>';
-		$alt = !$alt;
-	}
-
 	echo '
-	</tr>
-</table>';
+		<table class="table_grid" style="margin: 0 auto 0 auto; border: 1px solid #ccc;">
+			<tr>
+				<th class="windowbg2" style="font-weight: bold; text-align: center; border-bottom: 1px solid #ccc;">OMFG Binary Clock</th>
+			</tr>';
+			foreach ($context['clockicons'] as $t => $v)
+			{
+				echo '
+					<tr class="', $alt ? 'windowbg2' : 'windowbg', '">
+						<td>';
+						foreach ($v as $i)
+						{
+							echo '<img src="', $context['offimg'], '" alt="" id="', $t, '_', $i, '" style="padding: 2px;">';
+						}
+						echo '</td>
+					</tr>
+				';
+				$alt = !$alt;
+			}
+		echo '</tr>
+		</table>
+	';
 
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 	var icons = new Object();';
 
 	foreach ($context['clockicons'] as $t => $v)
@@ -796,29 +932,30 @@
 
 function template_thetime()
 {
-	global $context, $scripturl;
-
-	echo '
-<table cellpadding="0" cellspacing="0" border="1" align="center">
-	<caption>The time you requested</caption>';
+	global $context;
 	$alt = false;
-	foreach ($context['clockicons'] as $t => $v)
-	{
-		echo '
-	<tr class="', $alt ? 'windowbg2' : 'windowbg', '">
-		<td align="right">';
-		foreach ($v as $i)
-			echo '
-			<img src="', $i ? $context['onimg'] : $context['offimg'], '" alt="" />';
-		echo '
-		</td>';
-		$alt = !$alt;
-	}
-
 	echo '
-	</tr>
-</table>';
-
+		<table class="table_grid" style="margin: 0 auto 0 auto; border: 1px solid #ccc;">
+			<tr>
+				<th class="windowbg2" style="font-weight: bold; text-align: center; border-bottom: 1px solid #ccc;">The time you requested</th>
+			</tr>';
+			foreach ($context['clockicons'] as $v)
+			{
+				echo '
+					<tr class="', $alt ? 'windowbg2' : 'windowbg', '">
+						<td>';
+						foreach ($v as $i)
+						{
+							echo '<img src="', $i ? $context['onimg'] : $context['offimg'], '" alt="" style="padding: 2px;">';
+						}
+						echo '</td>
+					</tr>
+				';
+				$alt = !$alt;
+			}
+			echo '
+		</table>
+	';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Compat.template.php b/Themes/default/Compat.template.php
--- a/Themes/default/Compat.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Compat.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,17 +3,17 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Generate a strip of buttons, out of buttons.
 function template_button_strip($button_strip, $direction = 'top', $strip_options = array())
 {
-	global $settings, $context, $txt, $scripturl;
+	global $context, $txt;
 
 	// Compatibility.
 	if (!is_array($strip_options))
@@ -25,7 +25,7 @@
 	{
 		if (!isset($value['test']) || !empty($context[$value['test']]))
 			$buttons[] = '
-				<li><a' . (isset($value['id']) ? ' id="button_strip_' . $value['id'] . '"' : '') . ' class="button_strip_' . $key . (isset($value['active']) ? ' active' : '') . '" href="' . $value['url'] . '"' . (isset($value['custom']) ? ' ' . $value['custom'] : '') . '><span>' . $txt[$value['text']] . '</span></a></li>';
+				<a class="button button_strip_' . $key . (isset($value['active']) ? ' active' : '') . '" href="' . $value['url'] . '"' . (isset($value['custom']) ? ' ' . $value['custom'] : '') . '>' . $txt[$value['text']] . '</a>';
 	}
 
 	// No buttons? No button strip either.
@@ -37,9 +37,7 @@
 
 	echo '
 		<div class="buttonlist', $direction != 'top' ? '_bottom' : '', '"', (empty($buttons) ? ' style="display: none;"' : ''), (!empty($strip_options['id']) ? ' id="' . $strip_options['id'] . '"': ''), '>
-			<ul class="reset clearfix">
-				', implode('', $buttons), '
-			</ul>
+			', implode('', $buttons), '
 		</div>';
 }
 
diff -ru a/Themes/default/css/admin.css b/Themes/default/css/admin.css
--- a/Themes/default/css/admin.css	2011-05-12 23:09:06.000000000 -0700
+++ b/Themes/default/css/admin.css	2015-03-05 23:30:06.004678068 -0800
@@ -1,627 +1,671 @@
-/* Styles for the admin quick search.
-------------------------------------------------------- */
-
-#quick_search form, h3.catbg #quick_search form
-{
-	padding: 7px;
-	line-height: 0.9em;
-	font-size: 0.8em !important;
+/* Start with most common */
+.action_admin .generic_list {
+	overflow: auto;
 }
-
-ol.search_results
-{
-	margin-top: 0;
-	padding-top: 0;
+#admin_content .windowbg {
+	margin: 5px 0 5px 0;
+	box-shadow: none;
 }
-ol.search_results li
-{
-	padding-top: 1em;
-	border-bottom: 1px solid #ccc;
+#admin_content .windowbg2 {
+	border-top-left-radius: 0;
+	border-top-right-radius: 0;
+	margin: 0 0 10px 0;
+	box-shadow: none;
+	background: #f0f4f7;
 }
 
-/* Styles for the core features screen.
-------------------------------------------------------- */
-.features
-{
-	padding: 0 1em !important;
-	overflow: auto;
+.action_admin .table_grid th {
+	padding: 6px 6px 5px 6px;
 }
-.features_image
-{
-	float: left;
-	margin: 0 2em 0.5em 1em;
+.action_admin .table_grid td {
+	border: 1px solid #ddd;
+	border-top: 0;
+}
+.action_admin .generic_list .flow_auto {
+	padding: 4px 2px;
+}
+.windowbg.nopadding {
+	margin: 0 !important;
+	padding: 0;
+}
+.windowbg ol {
+	margin-top: 0;
+	margin-bottom: 0;
 }
-.features_switch
-{
-	margin: 0.2em 1em 1em 1em;
-	float: right;
-}
-.features h4
-{
-	padding: 1em 0 0.5em 0.5em;
+a.help .icon {
 	margin: 0;
-	font-size: 1.1em;
+	padding: 0 4px 0 0;
 }
-.features p
-{
-	padding: 0 1em;
+.catbg a.help .icon {
+	margin: -4px 0 0 0;
+}
+.table_caption, tr.table_caption td {
+	color: #000;
+	font-size: 10px;
+	font-weight: bold;
+}
+.additional_row div.floatleft {
+	padding: 0 10px;
+}
+fieldset {
+	margin-bottom: 6px;
+	border: 1px solid #cacdd3;
+	padding: 6px;
+}
+fieldset dl {
 	margin: 0;
 }
+legend {
+	font-weight: bold;
+	color: #000;
+}
 
-/* Styles for the admin home screen bar.
+/* Styles for the admin home screen.
 ------------------------------------------------------- */
-#admin_main_section
-{
-	overflow: hidden;
-	margin: 1em 0;
-}
-#admincenter .content
-{
-	padding: 1em;
-}
-
-#live_news
-{
-	width: 64%;
-	font-size: 0.85em;
+/* Admin quick search bar, and results page. */
+h3.catbg #quick_search form {
+	padding-top: 2px;
+	font-size: 0.9em;
+}
+h3.catbg #quick_search form input, h3.catbg #quick_search form select, h3.catbg #quick_search form .button_submit {
+	margin: 0 3px !important;
+	padding: 4px 3px 3px 3px;
+	border-radius: 4px;
+	border: 1px solid #777;
+	vertical-align: top;
 }
-#live_news div.content
-{
-	padding: 0;
+h3.catbg #quick_search form select {
+	font-size: 0.9em;
+	margin: -1px 0 0 0;
+	padding: 2px;
 }
-#live_news div.content dl
-{
-	padding: 0.5em 0 0 0.5em;
+h3.catbg #quick_search form select option {
+	padding: 2px 4px;
+}
+h3.catbg #quick_search form .button_submit {
+	font-weight: bold;
+	padding: 3px 6px 2px 6px;
+}
+h3.catbg #quick_search form .button_submit:hover {
+	background: #fff;
 }
 
-#supportVersionsTable
-{
-	width: 34%;
+/* Browser tweaks. */
+body#chrome #quick_search form .input_text {
+	padding: 2px;
 }
-#version_details
-{
-	overflow: auto;
-	height: 9.5em;
+body#chrome #quick_search form input {
+	float: none;
 }
-#smfAnnouncements
-{
-	height: 13.5em;
-	padding: 0 0.5em;
+
+/* The welcome thingy. */
+#welcome {
+	border: 1px solid #ddd;
+	border-top: none;
+	border-radius: 0 0 7px 7px;
+	font-size: 0.9em;
+	padding: 12px 9px 8px 9px;
+}
+#welcome a {
+	font-weight: bold;
+}
+#welcome img {
+	vertical-align: middle;
+}
+.search_results {
+	margin: 0 -6px;
+}
+.search_results li {
+	margin: 0;
+	padding: 5px 0;
 	overflow: auto;
+	line-height: 1.7em;
+	border-bottom: double #ccc;
 }
-#smfAnnouncements dt
-{
-	border-bottom: 1px dashed #000;
+.search_results li:last-child {
+	border: none;
 }
-#smfAnnouncements dd
-{
-	padding: 0;
-	margin: 0 0 1em 1.5em;
+.search_results li a strong {
+	color: #346;
 }
-#update_section
-{
-	margin: 0.5em 0 0;
+.search_results li p {
+	padding: 0 20px;
+	line-height: 1.7em;
 }
 
-#quick_tasks, #quick_tasks ul
-{
-	margin: 0;
-	padding: 0;
+/* Cleaned this up a bit for less clutter.
+/* Admin and moderation could generally do with a clean up everywhere.
+/* Live news from smorg and support information. */
+#live_news, #supportVersionsTable {
+	width: 70%;
+	box-sizing: border-box;
 }
-#quick_tasks li
-{
-	float: left;
-	list-style-type: none;
-	margin: 0;
-	padding: 0.5em 0;
-	width: 49.5%;
-	height: 4.5em;
+#supportVersionsTable {
+	width: 30%;
+	padding-left: 6px;
+}
+#admin_main_section {
+	overflow: auto;
+}
+#admin_main_section .windowbg {
+	padding: 6px 0;
+	border-radius: 0;
+	height: 12em;
+	overflow: auto;
+}
+#smfAnnouncements dt {
+	padding: 4px 6px 2px 6px;
+	border-top: 1px solid #bf6900;
 }
-.quick_task
-{
+#smfAnnouncements dt a {
+	color: #bf6900;
+	font-weight: bold;
 	display: block;
-	width: 100%;
-	margin: 0 1em;
-	padding: 0;
 }
-.home_image
-{
-	float: left;
-	margin: 0 1em 1em 1em;
+#smfAnnouncements dd {
+	margin: 0;
+	padding: 6px 12px;
+	border-top: double #ddd;
 }
 
-/* Common admin center classes.
-------------------------------------------------------- */
-hr.hrcolor
-{
-	margin: 10px 0;
-}
-h3.titlebg form
-{
-	font-size: 80%;
-}
-.windowbg.nopadding
-{
-	margin: 0.3em 0 0 0;
-	padding: 0;
+fieldset.admin_group legend {
+	background: #eaf1f4;
+	border: 1px solid #cacdd3;
+	padding: 1px 5px;
+	border-radius: 3px;
 }
-.windowbg ol
-{
-	margin-top: 0;
-	margin-bottom: 0;
+fieldset.admin_group a {
+	display: inline-block;
+	width: 100px;
+	font-size: 85%;
+	text-align: center;
+	vertical-align: top;
+}
+fieldset.admin_group .inactive {
+	filter:Alpha(opacity=40);
+	-ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=40)";
+	opacity: 0.4;
 }
 
-.table_caption, tr.table_caption td
-{
-	color: #000;
-	font-size: 10px;
-	font-weight: bold;
+/* The update warning. */
+#update_section {
+	margin: 6px 0;
 }
-.additional_row div.floatleft
-{
-	padding: 0 0.8em;
-}
-fieldset
-{
-	margin-bottom: 0.5em;
-	border: 1px solid #cacdd3;
-	padding: 0.5em;
+
+/* The icons. */
+.large_admin_menu_icon_file {
+	margin: 0 auto;
+	display: block;
+	width: 32px;
+	height: 32px;
 }
-fieldset dl
-{
-	margin: 0;
+.large_admin_menu_icon {
+	background: url(../images/icons/admin_icons_hd.png) no-repeat  -5px -47px;
+	margin: 0 auto;
+	display: block;
+	content: '';
+	width: 32px;
+	height: 32px;
 }
-legend
-{
-	font-weight: bold;
-	color: #000;
+.large_admin_menu_icon.attachment {
+	background-position: -5px -5px;
 }
-.information a
-{
-	font-weight: bold;
+.large_admin_menu_icon.ban {
+	background-position: -47px -5px;
+}
+.large_admin_menu_icon.boards {
+	background-position: -89px -5px;
+}
+.large_admin_menu_icon.calendar {
+	background-position: -131px -5px;
+}
+.large_admin_menu_icon.current_theme {
+	background-position: -173px -5px;
+}
+.large_admin_menu_icon.default {
+	background-position: -5px -47px;
+}
+.large_admin_menu_icon.engines {
+	background-position: -47px -47px;
+}
+.large_admin_menu_icon.exit {
+	background-position: -89px -47px;
+}
+.large_admin_menu_icon.features {
+	background-position: -131px -47px;
+}
+.large_admin_menu_icon.languages {
+	background-position: -173px -47px;
+}
+.large_admin_menu_icon.logs {
+	background-position: -5px -89px;
+}
+.large_admin_menu_icon.mail {
+	background-position: -47px -89px;
+}
+.large_admin_menu_icon.maintain {
+	background-position: -89px -89px;
+}
+.large_admin_menu_icon.membergroups {
+	background-position: -131px -89px;
+}
+.large_admin_menu_icon.members {
+	background-position: -173px -89px;
+}
+.large_admin_menu_icon.modifications {
+	background-position: -5px -131px;
+}
+.large_admin_menu_icon.news {
+	background-position: -47px -131px;
+}
+.large_admin_menu_icon.packages {
+	background-position: -89px -131px;
+}
+.large_admin_menu_icon.paid {
+	background-position: -131px -131px;
+}
+.large_admin_menu_icon.permissions {
+	background-position: -173px -131px;
+}
+.large_admin_menu_icon.posts {
+	background-position: -5px -173px;
+}
+.large_admin_menu_icon.regcenter {
+	background-position: -47px -173px;
+}
+.large_admin_menu_icon.reports {
+	background-position: -89px -173px;
+}
+.large_admin_menu_icon.scheduled {
+	background-position: -131px -173px;
+}
+.large_admin_menu_icon.search {
+	background-position: -173px -173px;
+}
+.large_admin_menu_icon.security {
+	background-position: -215px -5px;
+}
+.large_admin_menu_icon.server {
+	background-position: -215px -47px;
+}
+.large_admin_menu_icon.smiley {
+	background-position: -215px -89px;
+}
+.large_admin_menu_icon.support {
+	background-position: -215px -131px;
+}
+.large_admin_menu_icon.themes {
+	background-position: -215px -173px;
+}
+.large_admin_menu_icon.warning {
+	background-position: -5px -215px;
+}
+
+/* Styles for the support and credits page.
+/* Hey, people might actually want to put their names on it now!
+/* Only a couple of trivial markup hacks that wont break any mods or themes.
+/* The older I get, the more devious I get. :D
+/* Nobody ever themes admin anyway. That's why it looked like crap. */
+#support_credits {
+	position: relative;
+	margin: -4px 0 0 0;
+	border-top-left-radius: 0;
+	border-top-right-radius: 0;
+}
+#credits_logo {
+	position: absolute;
+	right: 10px;
+	top: 9px;
+}
+#latestSupport {
+	padding: 0 25px 15px 25px;
+}
+#support_credits dl {
+	padding: 0 6px;
+}
+#support_credits dt {
+	float: left;
+	padding: 6px 0.8em 0 0;
+	text-indent: -4px;
+}
+#support_credits dd {
+	padding: 6px 0;
 }
 
 /* Styles for the package manager.
-------------------------------------------------- */
-#package_list .tborder
-{
+/* Haven't got here yet. :P */
+#package_list .tborder {
 	margin: .25em 0 .25em 26px;
 }
-#package_list ol, #package_list ol li
-{
+#package_list ol, #package_list ol li {
 	list-style: decimal;
 	margin-left: 50px;
 	border: none;
 }
-#package_list ol ul, #package_list ol ul li
-{
-	margin-left: 0;
-	list-style: none;
-}
-#package_list
-{
-	list-style-type: none;
-}
-#package_list li
-{
+#package_list li {
 	border: 1px solid #cacdd3;
 	padding: 0.2em;
 	margin: 1px;
 }
-.description
-{
-	max-height: 15em;
-	overflow: auto;
-	padding-bottom: .5em;
-}
-.information
-{
-	max-height: 15em;
-	overflow: auto;
-	padding-bottom: .5em;
-}
-.package_section
-{
+.package_section {
 	border: 1px solid #cacdd3;
 }
-ul.packages li
-{
-	border: none !important;
-	list-style-type: none;
-}
-code#find_code, code#replace_code
-{
-	display: block;
-	font-family: "dejavu sans mono", "monaco", "lucida console", "courier new", monospace;
-	font-size: x-small;
-	background: #eef;
-	line-height: 1.5em;
-	padding: 3px 1em;
-	overflow: auto;
-	white-space: pre;
-	/* Show a scrollbar after about 24 lines. */
-	max-height: 24em;
-}
-span.package_server
-{
+span.package_server {
 	padding: 0 3em;
 }
-ul.package_servers
-{
-	margin: 0;
-	padding: 0;
-}
-ul.package_servers li
-{
-	list-style-type: none;
-}
-pre.file_content
-{
+pre.file_content {
 	overflow: auto;
 	width: 100%;
 	padding-bottom: 1em;
 }
-.operation
-{
+.operation {
 	padding: 0 1em;
 }
 
-/* Styles for the file permissions section.
-------------------------------------------------- */
-.filepermissions
-{
+/* Styles for the file permissions section. */
+.filepermissions {
 	font-size: 0.8em;
 	white-space: nowrap;
 }
-.fperm
-{
+.fperm {
 	display: block;
 	width: 35%;
 	text-align: center;
 }
-.perm_read
-{
+.perm_read {
 	background-color: #d1f7bf;
+	width: 8%;
 }
-.perm_write
-{
+.perm_write {
 	background-color: #ffbbbb;
+	width: 8%;
 }
-.perm_execute
-{
+.perm_execute {
 	background-color: #fdd7af;
+	width: 8%;
 }
-.perm_custom
-{
+.perm_custom {
 	background-color: #c2c6c0;
+	width: 8%;
 }
-.perm_nochange
-{
+.perm_nochange {
 	background-color: #eee;
+	width: 8%;
 }
 
-/* Styles for the BBC permissions
-------------------------------------------------- */
-.list_bbc
-{
+.generic_icons.select_above {
+	background-position: -134px -30px;
+}
+.generic_icons.select_here {
+	background-position: -108px -30px;
+}
+.generic_icons.select_below {
+	background-position: -80px -30px;
+}
+
+/* Styles for the BBC permissions */
+.list_bbc {
 	width: 33%;
 }
 
-/* Styles for the manage boards section.
-------------------------------------------------- */
-#manage_boards ul
-{
-	padding: 0;
-	margin: 0 0 0.6em 0;
-	max-height: 30em;
+/* Styles for the manage boards section. */
+#manage_boards {
 	overflow: auto;
 }
-#manage_boards li
-{
-	list-style-type: none;
-	border: 1px solid #cacdd3;
-	padding: 0.2em;
-	margin: 1px;
-	clear: right;
+.roundframe .windowbg, .roundframe .windowbg2 {
+	border: 0;
+	padding: 0;
+	background: none;
 }
-#manage_boards li img
-{
-	vertical-align: middle;
-	padding-bottom: 3px;
+#manage_boards li.windowbg, #manage_boards li.windowbg2 {
+	padding: 8px 0;
+	margin: 0;
+	border-radius: 0;
+	border: 1px solid #ddd;
+	border-bottom: none;
+}
+#manage_boards li.windowbg:first-child, #manage_boards li.windowbg2:first-child {
+	border-top: none;
+}
+#manage_boards li.windowbg:last-child, #manage_boards li.windowbg2:last-child {
+	border-bottom: 1px solid #ddd;
 }
-#manage_boards li#recycle_board
-{
+#manage_boards li.windowbg:hover, #manage_boards li.windowbg2:hover {
+	background: #D0E7F8;
+}
+#manage_boards li .floatleft {
+	font-weight: bold;
+	padding: 0 6px;
+}
+#manage_boards li#recycle_board {
 	background-color: #dee;
 }
-.move_links
-{
+#manage_boards li.redirect_board, #manage_boards li.redirect_board:hover {
+	background-color: #eed;
+}
+.move_links {
 	padding: 0 13px 0 0;
 }
-.modify_boards
-{
-	padding: 0 0.5em;
+#manage_boards .button {
+	margin: 0 8px 0 0;
+}
+#manage_boards dl {
+	padding: 8px 6px 0 6px;
 }
-#manage_boards span.post_group, #manage_boards span.regular_members
-{
+#manage_boards dl textarea, #manage_boards dl table{
+	margin: 0 0 8px 0;
+}
+#manage_boards span.post_group, #manage_boards span.regular_members {
 	border-bottom: 1px dotted #000;
 	cursor: help;
 }
+#manage_boards .button_submit {
+	margin: 2px 2px 0px 12px;
+}
+.select_all_box {
+	display:none;
+}
 
-/* Styles for the manage members section.
-------------------------------------------------- */
-.msearch_details
-{
+/* Styles for the manage members section. */
+.msearch_details {
 	display: block;
 	width: 49%;
 }
-dl.right dt
-{
+dl.right dt {
 	padding-right: 10px;
 }
 
-/* Styles for the manage maintenance section.
-------------------------------------------------- */
-.maintenance_finished, #task_completed
-{
-	margin: 1ex;
-	padding: 1ex 2ex;
-	border: 1px dashed green;
-	color: green;
-	background: #efe;
-}
-/* Styles for the manage calendar section.
-------------------------------------------------- */
-dl.settings dt.small_caption
-{
-	width: 20%;
-}
-dl.settings dd.small_caption
-{
-	width: 79%;
-}
-/* Styles for the manage permissions section.
-------------------------------------------------- */
-dl.admin_permissions dt
-{
-	width: 35%;
-}
-dl.admin_permissions dd
-{
-	width: 64%;
+/* Styles for the question and answers */
+fieldset.qa_fieldset {
+	clear: both;
+	display: none;
 }
 
-/* Styles for the manage search section.
-------------------------------------------------- */
-dl.settings dt.large_caption
-{
-	width: 70%;
-}
-dl.settings dd.large_caption
-{
-	width: 29%;
-}
-span.search_weight
-{
+/* Styles for the manage search section. */
+span.search_weight {
 	width: 40px;
 	padding: 0 0.5em;
 	text-align: right;
-	display: inline-block;
 }
-.search_settings
-{
+.search_settings {
 	width: 47%;
 }
 
-/* Styles for the manage bans section.
-------------------------------------------------- */
-.ban_restriction
-{
+/* Styles for the manage bans section. */
+.ban_restriction {
 	margin: 0.2em 0 0.2em 2.2em;
 }
-.ban_settings
-{
+.ban_settings {
 	width: 46%;
 }
-#manage_bans dl
-{
+#manage_bans dl {
 	margin-bottom: 1em;
 }
-#manage_bans fieldset dl.settings
-{
+#manage_bans fieldset dl.settings {
 	margin-bottom: 0;
 }
 
-/* Styles for the manage subscriptions section.
-------------------------------------------------- */
-#fixed_area
-{
+/* Styles for the manage subscriptions section. */
+#fixed_area {
 	width: 97%;
 }
-ul.pending_payments
-{
-	margin: 0;
-	padding: 0;
-}
-ul.pending_payments li
-{
-	list-style-type: none;
-}
 
-/* Styles for the manage permissions section.
-------------------------------------------------- */
-.perm_name, .perm_profile, .perm_board
-{
+/* Styles for the manage permissions section. */
+.perm_name, .perm_profile, .perm_board {
 	display: block;
 	width: 40%;
 }
-.perm_boards
-{
+.perm_boards {
 	padding: 0;
 	margin: 0 0 0.6em 0;
 }
-.perm_boards li
-{
+.perm_boards li {
 	list-style-type: none;
 	border: 1px solid #cacdd3;
+	border-top: 0;
 	padding: 0.2em;
-	margin: 1px;
-}
-.perm_groups
-{
-	background-color: #fff;
 }
-.perm_classic
-{
-	margin: 0.2em;
-}
-.permission_groups
-{
-	padding: 0;
-	margin: 0;
+.perm_boards li:first-child {
+	border-top: 1px solid #cacdd3;
 }
-.permission_groups li
-{
-	list-style-type: none;
-	padding: 0.2em;
-	margin: 1px;
+.perm_groups {
+	background-color: #fff;
 }
-.perms
-{
+.perms {
 	width: 20px;
 	display: inline-block;
 	text-align: center;
 }
 
-/* Styles for the themes section.
-------------------------------------------------- */
-ul.theme_options
-{
+/* Styles for the themes section. */
+ul.theme_options {
 	padding: 0;
 	margin: 0;
 }
-ul.theme_options li
-{
+ul.theme_options li {
 	list-style: none;
 	padding: 0.4em;
 }
-.is_directory
-{
+.is_directory {
 	padding-left: 18px;
-	background: url(../images/admin/boards.gif) no-repeat;
+	background: url(../images/admin/boards.png) no-repeat;
 }
-.edit_file
-{
+.edit_file {
 	width: 96%;
 	font-family: monospace;
 	margin-top: 1ex;
 	white-space: pre;
 }
 
-dl.themes_list
-{
+dl.themes_list {
 	margin: 0;
 }
-dl.themes_list dt
-{
+dl.themes_list dt {
 	margin-bottom: 3px;
 }
-dl.themes_list dd
-{
+dl.themes_list dd {
 	font-style: italic;
 	white-space: nowrap;
 }
 
-/* Styles for the registration center.
-------------------------------------------------- */
-.agreement, .reserved_names
-{
+/* Styles for the registration center. */
+.agreement, .reserved_names {
 	padding: 0;
 }
-#agreement, #reserved
-{
+#agreement, #reserved {
 	width: 99%;
 }
 
-/* Styles for the moderation center.
-------------------------------------------------- */
-#modcenter
-{
+/* Styles for the moderation center. */
+#modcenter {
 	display: block;
 	width: 100%;
 }
-.modblock_left
-{
-	width: 49%;
-	float: left;
-	clear: right;
-	margin: 0 0 1em 0;
-}
-.modblock_right
-{
-	width: 49%;
-	float: right;
-	margin: 0 0 1em 0;
-}
 
-.modbox
-{
-	height: 150px;
-	overflow: auto;
-}
 /* Moderation Notes */
-ul.moderation_notes
-{
+ul.moderation_notes {
 	margin: 0;
 	padding: 0;
 	list-style: none;
 	overflow: auto;
-	height: 8.5em;
+	height: 10.2em;
 }
-ul.moderation_notes li
-{
-	padding: 4px 0 4px 4px;
+ul.moderation_notes li {
+	padding: 0.2em;
 	border-bottom: 1px solid #cccccc;
 }
-.notes
-{
-	margin: 0.5em 0;
+.notes {
+	margin-top: 0.4em;
 }
-.post_note
-{
+.post_note {
 	width: 85%;
 }
 
-/* Styles for the error log.
-------------------------------------------------- */
-
-h3.grid_header
-{
+/* Styles for the error log. */
+h3.grid_header {
 	height: 25px;
 }
-#error_log
-{
+#error_log {
 	width: 100%;
 }
-#error_log tr.windowbg td, #error_log tr.windowbg2 td
-{
+#error_log tr.windowbg td, #error_log tr.windowbg2 td {
 	padding: 8px;
 	line-height: 160%;
 }
-#error_log td.half_width
-{
-	width: 50%;
+#error_log td div {
+	box-sizing: border-box;
 }
-#error_log td.checkbox_column
-{
+#error_log td.checkbox_column {
 	width: 15px;
 	vertical-align: top;
 	text-align: center;
 }
-#error_log td div.marginleft
-{
-	margin: 0 0 0 1ex;
-}
-#manage_boards span.botslice, #manage_maintenance span.botslice, #manage_mail span.botslice
-{
-	margin-bottom: 4px;
+#error_log a img {
+	vertical-align: middle;
+	margin: 0 8px 0 0;
+}
+
+/* More error log stuff. Could still be cleaned up a bit. */
+#error_log {
+	margin: 4px 0;
+}
+#error_log tr:first-child td {
+	background: #fff;
+	padding: 8px;
+}
+
+/* Styles for the Report generation */
+#report_buttons {
+	min-height: 2.4em;
+	padding: 3px 0;
+}
+.report_results th {
+	border-left: 1px solid #ddd;
+	border-right: 1px solid #ddd;
+}
+
+#support_credits .sub_bar {
+	padding: 6px 0px 5px 0px;
+}
+#taskpad .button_submit, #admincenter, #admin_form_wrapper {
+	margin: 5px 0 5px 0;
+}
+h3.config_hd {
+	background: url(../images/icons/config_hd.png) no-repeat 12px;
+	padding: 8px 0 8px 45px;
+}
+.full_width {
+	width: 100%;
+}
+.winfo {
+	border-radius: 0;
+	border-bottom: 0;
+	margin: 0 !important;
+}
+
+#versions .table_grid {
+	margin: 0;
 }
+#Sources .half_table, #Default .half_table, #Languages .half_table {
+	padding-left: 20px;
+}
\ No newline at end of file
Only in b/Themes/default/css: calendar.css
Only in b/Themes/default/css: calendar.rtl.css
Only in a/Themes/default/css: compat.css
Only in a/Themes/default/css: editor.css
Only in a/Themes/default/css: editor_ie.css
Only in a/Themes/default/css: ie6.css
Only in a/Themes/default/css: ie7.css
diff -ru a/Themes/default/css/index.css b/Themes/default/css/index.css
--- a/Themes/default/css/index.css	2011-06-04 04:54:57.000000000 -0700
+++ b/Themes/default/css/index.css	2015-03-05 23:30:06.004678068 -0800
@@ -1,711 +1,610 @@
-/* Styles for the general looks for the Curve theme.
-------------------------------------------------------- */
-
-/* Normal, standard links. */
-a:link, a:visited
-{
-	color: #346;
-	text-decoration: none;
+/* You can find detailed information at http://wiki.simplemachines.org/smf/Curve2_CSS
+/* Index */
+html {
+	background: #3e5a78;
+}
+body {
+	background: #e9eef2;
+	font: 83.33%/150% "Segoe UI", "Helvetica Neue", "Nimbus Sans L", Arial, "Liberation Sans", sans-serif;
+	color: #222;
+	margin: 0 auto;
+	padding: 0;
+	position: relative;
+	float: left;
+	width: 100%;
 }
-a:hover
-{
-	text-decoration: underline;
-	cursor: pointer;
+/* <p> is a possible exception for margins. Must test that one a bit. */
+p, ul, ol, li, dl, dd ,dt, fieldset, form {
+	box-sizing: border-box;
+	padding: 0;
+	margin: 0;
 }
-
-/* Links that open in a new window. */
-a.new_win:link, a.new_win:visited
-{
-	color: #346;
-	text-decoration: none;
+ul, ol {
+	list-style: none;
 }
-a.new_win:hover
-{
-	text-decoration: underline;
+ul.normallist{
+	list-style-type: disc;
+	padding: 0 0 0 15px;
 }
-
-/* Tables should show empty cells. */
-table
-{
+table {
 	empty-cells: show;
 }
-
-/* Set a fontsize that will look the same in all browsers. */
-body
-{
-	background: #E9EEF2 url(../images/theme/backdrop.png) repeat-x;
-	font: 78%/130% "Verdana", "Arial", "Helvetica", sans-serif;
-	margin: 0 auto;
-	padding: 15px 0;
+input, button, select, textarea, textarea.editor {
+	color: #222;
+	box-sizing: border-box;
+	font: 83.33%/150% "Segoe UI", "Helvetica Neue", "Nimbus Sans L", Arial, "Liberation Sans", sans-serif;
+	background: #fff;
+	outline: none !important;
+	border: 1px solid #bbb;
+	vertical-align: middle;
+	border-radius: 3px;
+	box-shadow: 0 2px 5px rgba(0,0,0,0.05) inset;
+	padding: 3px;
 }
-
-/* Help popups require a different styling of the body element. */
-body#help_popup
-{
-	padding: 1em;
+/* The following is necessary. */
+textarea, textarea.editor {
+	font-size: 1em;
 }
-
-/* use dark grey for the text, leaving #000 for headers etc */
-body, td, th, tr
-{
-	color: #444;
+.sceditor-container textarea, .sceditor-container textarea:focus  {
+	box-shadow: none;
 }
-
-/* This division wraps the entire forum when a forum width is set. */
-div#wrapper
-{
-	margin: 0 auto;
-	min-width: 764px;
-	max-width: 2300px;
+#quick_edit_body_container textarea,
+.move_topic textarea {
+	width: 100%;
+	min-height: 100px;
 }
-
-/* lets give all forms zero padding/margins */
-form
-{
-	padding: 0;
-	margin: 0;
+/* Apply the font only to these elements. */
+input, button, select {
+	font-size: 0.9em;
 }
-
-/* We can style the different types of input buttons to be uniform throughout different browsers and their color themes.
-	.button_submit - covers input[type=submit], input[type=button], button[type=submit] and button[type=button] in all browsers
-	.button_reset  - covers input[type=reset] and button[type=reset] throughout all browsers
-	.input_check   - covers input[type=checkbox] throughout all browsers
-	.input_radio   - covers input[type=radio] throughout all browsers
-	.input_text    - covers input[type=text] throughout all browsers
-	.input_file    - covers input[type=file] throughout all browsers
-*/
-
-input, button, select, textarea
-{
-	font: 95%/115% verdana, Helvetica, sans-serif;
-	color: #000;
-	background: #fff;
-	border: 1px solid #7f9db9;
+select {
 	padding: 2px;
 }
-
-/* Select elements look horrible with the extra padding, so leave them unpadded. */
-select
-{
-	padding: 0;
+select option {
+	padding: 0 4px;
 }
-
-/* Add some padding to the options instead. */
-select option
-{
-	padding: 1px;
+input:hover, textarea:hover, button:hover, select:hover {
+	outline: none !important;
+	border: 1px solid #999;
+}
+textarea:hover, textarea.editor:hover {
+	background: #fbfbfb;
+}
+input:focus, textarea:focus, button:focus, select:focus, textarea.editor:focus {
+	outline:none !important;
+	border: 1px solid #999;
+	box-shadow: 0 2px 5px rgba(0,0,0,0.1) inset;
 }
-
-/* The font size of textareas should be just a little bit larger. */
-textarea
-{
-	font: 100%/130% verdana, Helvetica, sans-serif;
+/* Fieldsets are used to group elements. */
+fieldset {
+	padding: 18px;
+	margin: 0 0 6px 0;
+	border: 1px solid #ddd;
+	border-radius: 3px;
+}
+fieldset legend {
+	font-weight: bold;
+	color: #555;
+	box-shadow: none;
+	border: none;
 }
 
-/* Buttons should be styled a bit differently, in order to make them look more button'ish. */
-.button_submit, .button_reset
-{
-	background: #cde7ff url(../images/theme/submit_bg.png) no-repeat;
-	border: 1px solid #aaa;
-	cursor: pointer;
-	font-weight: normal;
+/* Define strong as bold, and em as italics */
+/* Note: in some particular places, strong has been redefined as font-weight: 600; */
+/* This gives a better effect for those areas, and will default to bold for fonts which do not support numerical font-weight. */
+strong {
+	font-weight: bold;
+	color: #444;
 }
-input:hover, textarea:hover, button:hover, select:hover
-{
-	border: 1px solid #454545;
+.cat_bar strong {
+	color: #FFF;
 }
-.button_submit:hover, .button_reset:hover
-{
-	border: 1px solid #aaa;
-	background: url(../images/theme/submit_bg.png) no-repeat 0 -140px #cde7ff;
+em {
+	font-style: italic;
 }
-input:focus, textarea:focus, button:focus, select:focus
-{
-	border: 1px solid #454545;
+/* Default <strong> color on these tags. */
+h1, h2, h3, h4, h5, h6 {
+	font-size: 1em;
+	margin: 0;
+	padding: 0;
+	color: #444;
 }
-
 /* All input elements that are checkboxes or radio buttons shouldn't have a border around them. */
-input.input_check, input.input_radio
-{
+input.input_check, input.input_radio {
 	border: none;
 	background: none;
+	vertical-align: top;
 }
-h3.catbg input.input_check
-{
-	margin: 9px 7px 0 7px;
+/* Give disabled text input elements a different background color. */
+input[disabled].input_text {
+	background: #eee;
+}
+/* Standard horizontal rule.. ([hr], etc.) */
+hr, hr.hrcolor {
+	border: none;
+	margin: 12px 0;
+	height: 2px;
+	background: #fff;
+	background-color: #fff;
+	box-shadow: 0 1px 0 #bbb inset;
+}
+/* This is about links */
+a:link, a:visited, a.new_win:link, a.new_win:visited {
+	color: #346;
+	text-decoration: none;
+}
+a:hover, a.new_win:hover {
+	text-decoration: underline;
+	cursor: pointer;
 }
 
-/* Give disabled text input elements a different background color. */
-input[disabled].input_text
-{
-	background-color: #eee;
+/* Help popups require a different styling of the body element. */
+/* Deprecated? */
+body#help_popup {
+	padding: 12px;
 }
 
-/* Standard horizontal rule.. ([hr], etc.) */
-hr, .hrcolor
-{
-	height: 1px;
-	border: 0;
-	color: #ccc;
-	background-color: #ccc;
+ul#likes li {
+	clear: both;
 }
 
-/* By default set the color on these tags as #000. */
-h1, h2, h3, h4, h5, h6
-{
-	color: #000;
-	font-size: 1em;
-	margin: 0;
+ul#likes span.avatar {
+	width: 45px;
+	height: 45px;
+	padding: 2px;
+}
+ul#likes span.avatar img {
+	max-height: 40px;
+}
+ul#likes li span.description {
+	font-style: italic;
+	opacity: 0.4;
+	padding: 0.4em 0.7em;
+	font-size: 0.9em;
+}
+
+/* I think the reset class can be deprecated. */
+/* Must test inheritance thoroughly to be sure. */
+/* A quick reset list class. */
+ul.reset, ul.reset li {
 	padding: 0;
+	margin: 0;
+	list-style: none;
 }
 
-/* Fieldsets are used to group elements. */
-fieldset
-{
-	border: 1px solid #c4c4c4;
-	padding: 1em;
-	margin: 0 0 0.5em 0;
+/* Buttons should be styled a bit differently, in order to make them look more button'ish. */
+#frmLogin input.button_submit, #guest_form input.button_submit, #calendar_navigation input.button_submit, #mergeSelectBoard input.button_submit {
+	float: none;
+	margin-left: inherit;
 }
-fieldset legend
-{
-	font-weight: bold;
-	color: #444;
+.button_submit, .button_reset, .button_link {
+	margin: 0 0 0 12px;
+	padding: 2px 4px;
+	float: right;
+	cursor: pointer;
+	border: 1px solid #ddd;
+	border-right: 1px solid #bbb;
+	border-bottom: 1px solid #aaa;
+	border-radius: 3px;
+	box-shadow: 1px 1px 1px rgba(0,0,0,0.1);
+}
+.button_submit:hover, .button_reset:hover, .button_link:hover {
+	color: #af6700;
+	border: 1px solid #ddd;
+	border-left: 1px solid #bbb;
+	border-top: 1px solid #aaa;
+	box-shadow: -1px -1px 2px rgba(0,0,0,0.07), -1px -2px 4px rgba(255,255,255,0.33) inset;
 }
-/* No image should have a border when linked. */
-a img
-{
-	border: 0;
+a.button_link {
+	color: #000;
+	padding: 1px 5px;
+	margin: 0 !important;
+	font-size: 0.9em;
 }
-
-/* Define strong as bold, and em as italics */
-strong
-{
+.button_link:hover {
+	text-decoration: none;
+}
+/* the new "button" */
+a.new_posts, span.new_posts {
+	color: #fff;
 	font-weight: bold;
+	line-height: 1.12px;
+	border-radius: 2px;
+	background: orange;
 }
-
-em
-{
-	font-style: italic;
+span.new_posts {
+	display: inline;
+	margin: 0 5px 0 -2px;
+	padding: 0 4px 1px 4px;
+	font-size: 9px;
+	font-family: verdana, sans-serif; /* @todo Might add extra fallbacks. Possibly monospace. */
+	box-shadow: 1px 2px 2px rgba(0,0,0,0.1), 0 -2px 4px rgba(0,0,0,0.1) inset;
 }
-/* Alternative for u tag */
-.underline
-{
+a span.new_posts:hover {
 	text-decoration: underline;
 }
 
 /* Common classes to easy styling.
 ------------------------------------------------------- */
-
-.floatright
-{
+.floatright {
 	float: right;
 }
-.floatleft
-{
+.floatleft {
 	float: left;
 }
-
-.flow_auto
-{
+.floatnone {
+	float: none;
+}
+.flow_auto {
 	overflow: auto;
 }
-.flow_hidden
-{
+.flow_hidden {
 	overflow: hidden;
 }
-.flow_hidden .windowbg, .flow_hidden .windowbg2
-{
-	margin-top: 2px;
-}
-.clear
-{
+.clear {
 	clear: both;
 }
-.clear_left
-{
+.clear_left {
 	clear: left;
 }
-.clear_right
-{
+.clear_right {
 	clear: right;
 }
 
 /* Default font sizes: small (8pt), normal (10pt), and large (14pt). */
-.smalltext, tr.smalltext th
-{
-	font-size: 0.85em;
-	font-family: verdana, sans-serif;
-}
-.middletext
-{
+.smalltext, tr.smalltext th {
 	font-size: 0.9em;
-	line-height: 1em;
-	font-family: verdana, sans-serif;
-}
-.normaltext
-{
-	font-size: 1em;
-	line-height: 1.2em;
 }
-.largetext
-{
+.largetext {
 	font-size: 1.4em;
 }
-.centertext
-{
+h3.largetext {
+	font-size: large;
+}
+.xlarge_text {
+	font-size: x-large;
+}
+.centertext, .centercol {
 	margin: 0 auto;
 	text-align: center;
 }
-.righttext
-{
+.righttext {
 	margin-left: auto;
 	margin-right: 0;
 	text-align: right;
 }
-.lefttext
-{
+.lefttext {
 	margin-left: 0;
 	margin-right: auto;
 	text-align: left;
 }
-.double_height
-{
+.double_height {
 	line-height: 2em;
 }
 /* some common padding styles */
-.padding
-{
-	padding: 0.7em;
+.padding {
+	padding: 8px;
 }
-.main_section, .lower_padding
-{
-	padding-bottom: 0.5em;
+.main_section, .lower_padding {
+	padding-bottom: 6px;
 }
-/* a quick reset list class. */
-ul.reset, ul.reset li
-{
-	padding: 0;
-	margin: 0;
-	list-style: none;
+.half_content {
+	box-sizing: border-box;
+	width: 50%;
+	display: inline-block;
+	vertical-align: top;
+}
+.half_content:nth-of-type(even) {
+	margin-right: -0.25em;
+	padding-right: 0.3%;
+}
+.half_content:nth-of-type(odd) {
+	margin-left: -0.2em;
+	padding-left: 0.3%;
 }
 
-/* Some BBC related styles.
-------------------------------------------------------- */
-
+/* BBC */
 /* A quote, perhaps from another post. */
-blockquote.bbc_standard_quote, blockquote.bbc_alternate_quote
-{
-	font-size: x-small;
-	color: #000;
-	line-height: 1.4em;
-	background: url(../images/theme/quote.png) 0.1em 0.1em no-repeat;
-	border-top: 2px solid #99A;
-	border-bottom: 2px solid #99A;
-	padding: 1.1em 1.4em;
-	margin: 0.1em 0 0.3em 0;
-	overflow: auto;
+.bbc_standard_quote::before, .bbc_alternate_quote::before {
+	color: #aaa;
+	font-size: 22px;
+	content: '\275D';
+	margin: -5px 5px 0 -5px;
+}
+/* Remove the difference IE/Opera/Chrome/Firefox etc... */
+#firefox .bbc_standard_quote::before, #firefox .bbc_alternate_quote::before {
+	font-size: 30px;
 }
-
-/* Alterate blockquote stylings */
-blockquote.bbc_standard_quote
-{
-	background-color: #d7daec;
+#firefox .bbc_standard_quote::before, #firefox .bbc_alternate_quote::before,
+#chrome .bbc_standard_quote::before, #chrome .bbc_alternate_quote::before {
+	vertical-align: middle;
+	margin: 0 5px 0 0;
 }
-blockquote.bbc_alternate_quote
-{
-	background-color: #e7eafc;
+.bbc_standard_quote, .bbc_alternate_quote {
+	margin: 0 0 8px 0;
+	padding: 6px 10px;
+	font-size: 0.9em;
+	border: 1px solid #d6dfe2;
+	border-left: 2px solid #aaa;
+	border-right: 2px solid #aaa;
+}
+/* Alternate blockquote stylings */
+.bbc_standard_quote {
+	background-color: #e0e6f6;
+}
+.bbc_alternate_quote {
+	background-color: #ebf4f8;
 }
-
 /* A code block - maybe PHP ;). */
-code.bbc_code
-{
+.bbc_code {
 	display: block;
-	font-family: "dejavu sans mono", "monaco", "lucida console", "courier new", monospace;
-	font-size: x-small;
-	background: #eef;
-	border-top: 2px solid #999;
-	border-bottom: 2px solid #999;
-	line-height: 1.5em;
-	padding: 3px 1em;
+	font-family: "DejaVu Sans Mono", Monaco, Consolas, monospace;
+	font-size: 0.9em;
+	background: #f3f3f3;
+	border: 1px solid #dfdfdf;
+	border-top: 2px solid #bbb;
+	border-bottom: 3px solid #aaa;
+	border-radius: 2px;
+	margin: 1px 0 6px 0;
+	padding: 3px 12px;
 	overflow: auto;
 	white-space: nowrap;
-	/* Show a scrollbar after about 24 lines. */
-	max-height: 24em;
+	/* Show a scrollbar after about 6 lines. */
+	resize: vertical;
 }
-
 /* The "Quote:" and "Code:" header parts... */
-.codeheader, .quoteheader
-{
+.codeheader, .quoteheader {
 	color: #666;
-	font-size: x-small;
-	font-weight: bold;
-	padding: 0 0.3em;
+	font-size: 0.9em;
+	padding: 0 2px;
 }
-
 /* For links to change the code stuff... */
-.codeoperation
-{
+.codeoperation {
 	font-weight: normal;
 }
-
+/* Let's get a bit more flexibility in font sizes for quotes and code. */
+/* We just need to stop em compounding when elements are nested. */
+.bbc_standard_quote .bbc_alternate_quote, .bbc_alternate_quote .bbc_standard_quote,
+.bbc_standard_quote .bbc_code, .bbc_alternate_quote .bbc_code, .bbc_standard_quote .codeheader,
+.bbc_alternate_quote .codeheader, .bbc_standard_quote .quoteheader, .bbc_alternate_quote .quoteheader {
+	font-size: 1em;
+}
 /* Styling for BBC tags */
-.bbc_link:link, .bbc_link:visited
-{
+.bbc_link:link, .bbc_link:visited {
 	border-bottom: 1px solid #A8B6CF;
 }
-.bbc_link:hover
-{
+.bbc_link:hover {
 	text-decoration: none;
 	border-bottom: 1px solid #346;
 }
-.bbc_size
-{
+.bbc_size {
 	line-height: 1.4em;
 }
-.bbc_color a
-{
+.bbc_color a {
 	color: inherit;
 }
-.bbc_img
-{
+.bbc_bold {
+	font-weight: bold;
+}
+.bbc_img {
 	border: 0;
 }
-.bbc_table
-{
+.bbc_table {
 	font: inherit;
 	color: inherit;
 }
-.bbc_table td
-{
+.bbc_table td {
 	font: inherit;
 	color: inherit;
 	vertical-align: top;
 }
-.bbc_u
-{
+.bbc_u {
 	text-decoration: underline;
 }
-.bbc_list
-{
+.bbc_list {
 	text-align: left;
+	padding: 0 0 0 35px;
+	list-style-type: inherit;
 }
-.bbc_tt
-{
+/* Everything is same except HTML5 valid */
+.bbc_tt {
 	font-family: "dejavu sans mono", "monaco", "lucida console", "courier new", monospace;
 }
+/* No image should have a border when linked. */
+a img {
+	border: 0;
+}
 
-/* Generally, those [?] icons.  This makes your cursor a help icon. */
-.help
-{
-	cursor: help;
+/* Those collapse and expand icons are wonderful. */
+.toggle_up::before, .toggle_down::before {
+	width: 17px;
+	height: 17px;
+	display: inline-block;
+	background: url(../images/toggle.png) no-repeat 0 0;
+	overflow: hidden;
+	content: '';
+	vertical-align: middle;
+	margin: -5px 5px 0 5px;
+}
+.toggle_down::before {
+	background-position: 0 -17px;
 }
 
+/* Generally, those [?] icons. This makes your cursor a help icon. */
+.help {
+	cursor: help;
+}
+.help .icon {
+	margin: 0;
+	cursor: help;
+	opacity: 0.8;
+}
+.help .icon:hover {
+	opacity: 1;
+}
 /* /me uses this a lot. (emote, try typing /me in a post.) */
-.meaction
-{
+.meaction {
 	color: red;
 }
 
 /* Highlighted text - such as search results. */
-.highlight
-{
+.highlight {
 	font-weight: bold;
 	color: #ff7200 !important;
 	font-size: 1.1em;
 }
 
-/* A more discreet highlight color, for selected membergroups etc. */
-.highlight2
-{
-	background-color: #D1E1EF;
-	color: #000 !important;
+/* the page navigation area */
+.pagesection {
+	font-size: 0.9em;
+	padding: 2px 4px;
+	overflow: hidden;
+	margin: 0;
+	clear: both;
 }
-
-/* Generic, mostly color-related, classes.
-------------------------------------------------------- */
-
-.titlebg, .titlebg2, tr.titlebg th, tr.titlebg td, tr.titlebg2 td
-{
-	color: #222;
-	font-family: arial, helvetica, sans-serif;
-	font-size: 1.1em;
-	font-weight: bold;
-	background: #e3e9ef url(../images/theme/main_block.png) no-repeat -10px -380px;
+.pages::after, .jump_to::after {
+	content: ": ";
 }
-.catbg, .catbg2, tr.catbg td, tr.catbg2 td, tr.catbg th, tr.catbg2 th
-{
-	color: #fff;
-	font-family: arial, helvetica, sans-serif;
-	font-size: 1.1em;
-	font-weight: bold;
-	background: #a7b9cd url(../images/theme/main_block.png) no-repeat -10px -280px;
-}
-
-/* adjust the table versions of headers */
-tr.titlebg th, tr.titlebg2 th, td.titlebg, td.titlebg2, tr.catbg th, tr.catbg2 th, td.catbg, td.catbg2
-{
-	padding: 0 6px;
-}
-tr.titlebg th a:link, tr.titlebg th a:visited, tr.titlebg2 td a:link, tr.titlebg2 td a:visited
-{
-	color: #222;
-}
-tr.catbg th a:link, tr.catbg th a:visited, tr.catbg2 td a:link, tr.catbg2 td a:visited
-{
-	color: #fff;
-}
-.catbg select
-{
-	height: 1.5em;
-	font-size: 0.85em;
-}
-
-/* Alternating backgrounds for posts, and several other sections of the forum. */
-.windowbg, #preview_body
-{
-	color: #000;
-	background-color: #e7eaef;
-}
-.windowbg2
-{
-	color: #000;
-	background-color: #f0f4f7;
-}
-.windowbg3
-{
-	color: #000;
-	background-color: #cacdd3;
-}
-
-/* the page navigation area */
-.pagesection
-{
-	font-size: 0.9em;
-	padding: 0.2em;
-	overflow: hidden;
-	margin-bottom: 1px;
+#main_content_section .pagesection {
+	margin: 4px 0 0 0;
 }
-div.pagesection div.floatright input
-{
+div.pagesection div.floatright input, div.pagesection div.floatright select {
 	margin-top: 3px;
 }
-
-.pagelinks
-{
-	padding: 0.6em 0 0.4em 0;
-}
-
-/* Colors for background of posts requiring approval */
-.approvebg
-{
-	color: #000;
-	background-color: #ffeaea;
-}
-.approvebg2
-{
-	color: #000;
-	background-color: #fff2f2;
+.pagelinks {
+	margin: 8px 0 0 0;
 }
-
-/* Color for background of *topics* requiring approval */
-.approvetbg
-{
-	color: #000;
-	background-color: #e4a17c;
+.pagelinks p {
+	display: inline;
 }
-.approvetbg2
-{
-	color: #000;
-	background-color: #f3bd9f;
+.navPages {
+	padding: 0 1px;
 }
-
-/* Sticky topics get a different background */
-.stickybg
-{
-	background: #e8d8cf;
+.expand_pages {
+	font-weight: bold;
+	cursor: pointer;
 }
-.stickybg2
-{
-	background: #f2e3d9;
+.current_page {
+	padding: 0 4px 0 2px;
+	color: #b46100;
+	font-family: verdana, sans-serif;
+	font-weight: bold;
 }
 
-/* Locked posts get a different shade, too! */
-.lockedbg
-{
-	background: #d4dce2;
-	font-style: italic;
+/* Go up and go down links. */
+.topbottom {
+	display: block;
+	cursor: pointer;
+	border: 1px solid #ddd;
+	border-right: 1px solid #bbb;
+	border-bottom: 1px solid #aaa;
+	border-radius: 3px;
+	box-shadow: 1px 1px 1px rgba(0,0,0,0.1);
+	padding: 2px 7px 1px 7px;
+	margin: 5px 8px 0 0;
+	color: #222;
 }
-.lockedbg2
-{
-	background: #d8e1e7;
-	font-style: italic;
+.topbottom:hover {
+	text-decoration: none;
+	color: #af6700;
+	border: 1px solid #ddd;
+	border-left: 1px solid #bbb;
+	border-top: 1px solid #aaa;
+	box-shadow: -1px -1px 2px rgba(0,0,0,0.07), -1px -2px 4px rgba(255,255,255,0.33) inset;
 }
 
 /* Posts and personal messages displayed throughout the forum. */
-.post, .personalmessage
-{
-	overflow: auto;
-	line-height: 1.4em;
-	padding: 0.1em 0;
-}
-
-/* All the signatures used in the forum.  If your forum users use Mozilla, Opera, or Safari, you might add max-height here ;). */
-.signature, .attachments
-{
-	width: 98%;
+.post {
 	overflow: auto;
-	clear: right;
-	padding: 1em 0 3px 0;
-	border-top: 1px solid #aaa;
-	line-height: 1.4em;
-	font-size: 0.85em;
-}
-.custom_fields_above_signature
-{
-	width: 98%;
-	clear: right;
-	padding: 1em 0 3px 0;
-	border-top: 1px solid #aaa;
 	line-height: 1.4em;
-	font-size: 0.85em;
+	padding: 1px 0;
 }
 
 /* Sometimes there will be an error when you post */
-.error
-{
-	color: red;
-}
-
 /* Messages that somehow need to attract the attention. */
-.alert
-{
+.error, .alert {
 	color: red;
 }
 
 /* Calendar colors for birthdays, events and holidays */
-.birthday
-{
+.birthday {
 	color: #920ac4;
 }
 
-.event
-{
+.event {
 	color: #078907;
 }
 
-.holiday
-{
-	color: #000080;
+.holiday > span {
+	color: rgb(0, 92, 255);
+}
+/* Events that are currently selected on the calendar. Won't see it much, probably. */
+.sel_event {
+	font-weight: bold;
 }
 
 /* Colors for warnings */
-.warn_mute
-{
+.warn_mute {
 	color: red;
 }
 
-.warn_moderate
-{
+.warn_moderate {
 	color: #ffa500;
 }
 
-.warn_watch, .success
-{
+.warn_watch, .success {
 	color: green;
 }
 
-a.moderation_link, a.moderation_link:visited
-{
+a.moderation_link, a.moderation_link:visited {
 	color: red;
 	font-weight: bold;
 }
 
-.openid_login
-{
-	background: white url(../images/openid.gif) no-repeat;
-	padding-left: 18px;
-}
-
-/* a descriptive style */
-.description, .description_board, .plainbox
-{
-	padding: 0.5em 1em;
-	font-size: 0.9em;
-	line-height: 1.4em;
-	border: 1px solid #bbb;
-	background: #f5f5f0;
-	margin: 0.2em 1px 1em 1px;
-}
-.description_board
-{
-	margin: 1em 1px 0 1px;
-}
-
-/* an informative style */
-.information
-{
-	padding: 0.5em 1em;
-	font-size: 0.9em;
-	line-height: 1.3em;
-	border: 1px solid #bbb;
-	background: #f0f6f0;
-	margin: 0.2em 1px 1em 1px;
-}
-.information p
-{
-	padding: 1em;
-	margin: 0;
-}
-p.para2
-{
-	padding: 1em 0 3.5em 0;
+p.para2 {
+	padding: 12px 0 44px 0;
 	margin: 0;
 }
 /* AJAX notification bar
 ------------------------------------------------------- */
-#ajax_in_progress
-{
-	background: url(../images/theme/loadingbar.png) repeat-x;
+#ajax_in_progress {
+	background: #fff;
+	border-bottom: 4px solid #f96f00;
 	color: #f96f00;
 	text-align: center;
-	font-size: 16pt;
+	font-size: 1.6em;
 	padding: 8px;
 	width: 100%;
-	height: 66px;
 	line-height: 25px;
 	position: fixed;
 	top: 0;
 	left: 0;
 }
 
-#ajax_in_progress a
-{
+#ajax_in_progress a {
 	color: orange;
 	text-decoration: underline;
-	font-size: smaller;
+	font-size: 0.9em;
 	float: right;
 	margin-right: 20px;
 }
 
 /* Lists with settings use these a lot.
 ------------------------------------------------------- */
-dl.settings
-{
+dl.settings {
 	clear: right;
 	overflow: auto;
 	margin: 0 0 10px 0;
-	padding: 0;
+	padding: 5px;
 }
-dl.settings dt
-{
+dl.settings dt {
 	width: 40%;
 	float: left;
 	margin: 0 0 10px 0;
 	padding: 0;
 	clear: both;
 }
-dl.settings dt.settings_title
-{
+dl.settings dt.settings_title {
 	width: 100%;
 	float: none;
 	margin: 0 0 10px 0;
@@ -713,2908 +612,3268 @@
 	font-weight: bold;
 	clear: both;
 }
-dl.settings dt.windowbg
-{
+dl.settings dt.windowbg {
 	width: 98%;
 	float: left;
 	margin: 0 0 3px 0;
 	padding: 0 0 5px 0;
 	clear: both;
 }
-dl.settings dd
-{
+dl.settings dd {
 	width: 56%;
 	float: right;
 	overflow: auto;
 	margin: 0 0 3px 0;
 	padding: 0;
 }
-dl.settings img
-{
+dl.settings img {
 	margin: 0 10px 0 0;
+	vertical-align: middle;
 }
 /* help icons */
-dl.settings dt a img
-{
+dl.settings dt a img {
 	position: relative;
-	top: 2px;
+	vertical-align: top;
 }
 
-/* Styles for rounded headers.
-------------------------------------------------------- */
-h3.catbg, h3.catbg2, h3.titlebg, h4.titlebg, h4.catbg
-{
-	overflow: hidden;
-	height: 31px;
-	line-height: 31px;
-	font-size: 1.2em;
-	font-weight: bold;
+/* a general table class */
+table.table_grid {
+	border-collapse: collapse;
+	margin: 1px 0 5px 0;
+	width: 100%;
 }
-h3.catbg a:link, h3.catbg a:visited, h4.catbg a:link, h4.catbg a:visited, h3.catbg, .table_list tbody.header td, .table_list tbody.header td a
-{
-	color: #fff;
+table.table_grid td {
+	padding: 3px;
 }
-h3.catbg2 a, h3.catbg2
-{
-	color: #feb;
+.table_grid.half_content {
+	width: 50%;
 }
-h3.catbg a:hover, h4.catbg a:hover, .table_list tbody.header td a:hover
-{
-	color: #fd9;
-	text-decoration: none;
+/* Some predefined widths (mostly for tables) */
+.half_table {
+	width: 50%;
 }
-h3.catbg2 a:hover
-{
-	color: #fff;
-	text-decoration: none;
+.equal_table {
+	width: 33%;
 }
-h3.titlebg a, h3.titlebg, h4.titlebg, h4.titlebg a
-{
-	color: #222;
+.quarter_table {
+	width: 25%;
 }
-h3.titlebg a:hover, h4.titlebg a:hover
-{
-	color: #53616f;
-	text-decoration: none;
+
+.title_bar th {
+	padding: 4px 3px 3px 8px;
 }
-h3.catbg img.icon, h4.titlebg img.icon
-{
-	vertical-align: middle;
-	margin: -2px 5px 0 0;
+.title_bar .sort_down, .title_bar .sort_up {
+	margin: -3px 0 0 2px;
 }
-h4.catbg a.toggle img
-{
-	vertical-align: middle;
-	margin: -2px 5px 0 5px;
+
+/* GenericList */
+.additional_row {
+	padding: 6px 0 6px 0;
 }
-h4.catbg, h4.catbg2 , h3.catbg , h3.catbg2 , .table_list tbody.header td.catbg
-{
-	background: url(../images/theme/main_block.png) no-repeat 100% -160px;
-	padding-right: 9px;
+img.sort, .sort {
+	margin-bottom: -4px;
+	margin-left: 4px;
 }
-h4.titlebg, h3.titlebg
-{
-	background: url(../images/theme/main_block.png) no-repeat 100% -200px;
-	padding-right: 9px;
+
+/* table_grid styles for Profile > Show Permissions. */
+#permissions table.table_grid td {
+	padding: 5px 10px;
+	cursor: default;
 }
-h4.titlebg img.icon
-{
-	float: left;
-	margin: 5px 8px 0 0;
+
+.postbg {
+	border-left: 1px solid #7f7f7f;
+	border-right: 1px solid #7f7f7f;
 }
-div.cat_bar
-{
-	background: #99abbf url(../images/theme/main_block.png) no-repeat 0 -160px;
-	padding-left: 9px;
-	height: 31px;
-	overflow: hidden;
-	margin-bottom: 1px;
+
+/* Styles used by the auto suggest control.
+------------------------------------------------------- */
+.auto_suggest_div {
+	position: absolute;
+	visibility: hidden;
+	border-radius: 3px;
+	outline: none !important;
+	border: 1px solid #bbb;
+	z-index: 100;
 }
-div.title_bar
-{
-	background: #e3e9ef url(../images/theme/main_block.png) no-repeat 0 -200px;
-	padding-left: 9px;
-	height: 31px;
-	overflow: hidden;
-	margin-bottom: 1px;
+.auto_suggest_item {
+	background: #ddd;
+	padding: 1px 4px;
+}
+.auto_suggest_item_hover {
+	background: #888;
+	cursor: pointer;
+	color: #eee;
+	padding: 1px 4px;
 }
 
-/* rounded bars needs a different background here */
-
-div.roundframe div.cat_bar
-{
-	background: #99abbf url(../images/theme/main_block.png) no-repeat 0 -240px;
-	margin-bottom: 0;
+/* Styles for the standard dropdown menus.
+------------------------------------------------------- */
+#main_menu {
+	margin: 0;
+	padding: 0;
+	float: left;
+	width: 100%;
 }
-div.roundframe div.cat_bar h3.catbg
-{
-	background: url(../images/theme/main_block.png) no-repeat 100% -240px;
+.dropmenu, #top_info {
+	width: 100%;
+	position: relative;
+	box-sizing: border-box;
 }
-div.title_barIC
-{
-	background: #dadfe6 url(../images/theme/main_block.png) no-repeat 0 -120px;
-	padding-left: 9px;
-	height: 31px;
-	overflow: hidden;
-	margin-bottom: 1px;
+#menu_nav {
+	padding: 0 40px 0 0;
 }
-div.title_barIC h4.titlebg
-{
-	background: url(../images/theme/main_block.png) no-repeat 100% -120px;
+/* Level 1 button background. */
+.dropmenu li, #top_info > li {
+	margin: 0 2px 0 1px;
+	padding: 0 0 0.3em 0;
+	float: left;
+	font-size: 0.9em;
+	line-height: 1.9em;
+	position: relative;
 }
-#upshrinkHeaderIC p.pminfo
-{
-	margin: 0;
-	padding: 0.5em;
+/* For cases where we want to spotlight something specific to an item, e.g. an amount */
+.amt {
+	margin-left: 3px;
+	padding: 0 5px;
+	color: white;
+	background: #6d90ad;
+	border-radius: 8px;
 }
-img#upshrink_ic, img#newsupshrink
-{
-	float: right;
-	margin: 10px 5px 0 0;
+.dropmenu li .active .amt, #top_info li .active .amt {
+	background: none;
+	color: inherit;
 }
-table.table_list a.unreadlink, table.table_list a.collapse
-{
-	float: right;
+#top_info .top_menu.visible {
+	display: block;
 }
-table.table_list a.collapse
-{
-	margin: 10px 5px 0 1em;
-	height: 31px;
-	line-height: 31px;
+/* Needed for new PM notifications. */
+.dropmenu li strong {
+	color: #333;
 }
-
-/* The half-round header bars for some tables. */
-.table_grid tr.catbg, .table_grid tr.titlebg
-{
-	font-size: 0.95em;
-	border-bottom: 1px solid #fff;
+/* For the upshrink button in the main menu bar. */
+#collapse_button {
+	position: absolute;
+	top: 0;
+	right: 0;
 }
-.table_grid tr.catbg th, .table_grid tr.titlebg th
-{
-	height: 28px;
-	line-height: 28px;
+.dropmenu li a, #top_info > li > a {
+	padding: 0 7px 0 7px;
+	margin: 0;
+	display: block;
+	border: 1px solid transparent;
+	border-radius: 4px;
 }
-tr.catbg th.first_th
-{
-	background: #a7b9cd url(../images/theme/main_block.png) no-repeat 0 -280px;
+/* Level 1 active button. */
+.dropmenu li a.active, #top_info li a.active {
+	background: orange;
+	color: #fff;
+	font-weight: bold;
+	border: 1px solid #f49a3a;
+	box-shadow: 0 5px 5px rgba(255,255,255,0.2) inset;
+	text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.6);
+}
+/* Level 1 hover effects. */
+.dropmenu li a:hover, .dropmenu li:hover a, .dropmenu li a:focus, #top_info > li > a:hover, #top_info > li:hover > a, #top_info > li > a.open {
+	background: #597b9f;
+	border: 1px solid #4a6b8c;
+	color: #fff;
+	cursor: pointer;
+	text-decoration: none;
+	box-shadow: 0 4px 4px rgba(255,255,255,0.1) inset;
+	text-shadow: 1px 1px 3px rgba(255, 255, 255, 0.5);
 }
-tr.catbg th.last_th
-{
-	background: #a7b9cd url(../images/theme/main_block.png) no-repeat 100% -280px;
+/* Level 1 active button. */
+.dropmenu li a.active:hover, .dropmenu li:hover a.active {
+	background: orange;
+	border: 1px solid #f49a3a;
+	color: #444;
+	box-shadow: 0 5px 5px rgba(255,255,255,0.2) inset;
+	text-shadow: none;
 }
-tr.titlebg th.first_th
-{
-	background: #e3e9ef url(../images/theme/main_block.png) no-repeat 0 -380px;
+/* User information. */
+#profile_menu a.avatar {
+	float: left;
+	margin: 0 20px 0 10px;
 }
-tr.titlebg th.last_th
-{
-	background: #e3e9ef url(../images/theme/main_block.png) no-repeat 100% -380px;
+#profile_menu a.avatar img {
+	height: 100%;
+	width: 100%;
+	max-width: 50px;
+	max-height: 50px;
 }
-.table_grid th.last_th input
-{
-	margin: 0 2px;
+#profile_menu .profile_user_info {
+	margin: 3px 0 5px 10px;
+	float: left;
 }
-.table_grid th.lefttext
-{
-	padding: 0 0.7em;
+#profile_menu .profile_user_avatar {
+	float: left;
 }
-
-/* a general table class */
-table.table_grid
-{
-	border-collapse: collapse;
-	margin-top: 0.1em;
+#profile_menu .profile_user_avatar img {
+	margin: 5px 0 0 10px;
 }
-table.table_grid td
-{
-	padding: 3px;
-	border-bottom: 1px solid #fff;
-	border-right: 1px solid #fff;
+#profile_menu .profile_username {
+	overflow: hidden;
+	font-size: 150%;
+	display: block;
 }
-
-/* GenericList */
-.additional_row
-{
-	padding: 0.5em 0 0.5em 0;
-}
-table.table_grid thead tr.catbg th
-{
-	white-space: nowrap;
-}
-
-/* table_grid styles for Profile > Show Permissions. */
-#permissions table.table_grid  td
-{
-	padding: 0.4em 0.8em;
-	cursor: default;
-} 
-
-/* Common styles used to add corners to divisions.
-------------------------------------------------------- */
-.windowbg span.topslice
-{
-	display: block;
-	padding-left: 20px;
-	background: url(../images/theme/main_block.png) 0 -30px no-repeat;
-}
-.windowbg span.topslice span
-{
-	display: block;
-	background: url(../images/theme/main_block.png) 100% -30px no-repeat;
-	height: 11px;
+#profile_menu .profile_user_links ol {
+	margin: 10px;
 }
-.windowbg span.botslice
-{
-	display: block;
-	padding-left: 20px;
-	background: url(../images/theme/main_block.png) 0 -40px no-repeat;
-	font-size: 5px;
-	line-height: 5px;
-	margin-bottom: 0.2em;
+#profile_menu .profile_user_links li {
+	float: left;
+	width: 50%;
 }
-.windowbg span.botslice span
-{
-	display: block;
-	background: url(../images/theme/main_block.png) 100% -40px no-repeat;
-	height: 11px;
+#profile_menu .profile_user_links li img {
+	margin-bottom: -1px;
 }
-
-.windowbg2 span.topslice
-{
-	display: block;
-	padding-left: 20px;
-	background: url(../images/theme/main_block.png) 0 -60px no-repeat;
+#pm_menu, #alerts_menu {
+	max-height: 30em;
 }
-.windowbg2 span.topslice span
-{
-	display: block;
-	background: url(../images/theme/main_block.png) 100% -60px no-repeat;
-	height: 11px;
+#pm_menu .pm_unread, #alerts_menu .alerts_unread {
+	margin-top: 2px;
+	padding-top: 3px;
+	border-top: 1px solid #ddd;
+	clear: both;
 }
-.windowbg2 span.botslice
-{
-	display: block;
-	padding-left: 20px;
-	background: url(../images/theme/main_block.png) 0 -71px no-repeat;
-	font-size: 5px;
-	line-height: 5px;
-	margin-bottom: 0.2em;
+#pm_menu .no_unread, #alerts_menu .no_unread {
+	padding-top: 3px;
+	text-align: center;
 }
-.windowbg2 span.botslice span
-{
-	display: block;
-	background: url(../images/theme/main_block.png) 100% -71px no-repeat;
-	height: 11px;
+#pm_menu .windowbg, #pm_menu .windowbg2, #alerts_menu .windowbg, #alerts_menu .windowbg2 {
+	clear: both;
+	padding: 2px;
 }
-.approvebg span.topslice
-{
-	display: block;
-	padding-left: 20px;
-	background: url(../images/theme/main_block.png) 0 0 no-repeat;
+#pm_menu .pm_unread div > .avatar, #alerts_menu .alerts_unread div > .avatar {
+	width: 40px;
+	height: 40px;
+	margin: 1px 6px 0 1px;
 }
-.approvebg span.topslice span
-{
-	display: block;
-	background: url(../images/theme/main_block.png) 100% 0 no-repeat;
-	height: 11px;
+#pm_menu .pm_unread .avatar img, #alerts_menu .alerts_unread .avatar img {
+	width: 100%;
+	height: 100%;
+	max-width: 40px;
+	max-height: 40px;
 }
-.approvebg span.botslice
-{
-	display: block;
-	padding-left: 20px;
-	background: url(../images/theme/main_block.png) 0 -11px no-repeat;
-	margin-bottom: 0.2em;
+#pm_menu .unread .subject {
+	font-weight: bold;
 }
-.approvebg span.botslice span
-{
-	display: block;
-	background: url(../images/theme/main_block.png) 100% -11px no-repeat;
-	height: 11px;
+#pm_menu .unread, #alerts_menu .unread {
+	border-bottom: 1px solid #ddd;
 }
-.postbg
-{
-	border-left: 1px solid #7f7f7f;
-	border-right: 1px solid #7f7f7f;
+#pm_menu .unread:hover, #alerts_menu .unread:hover {
+	background: #eee;
 }
-
-/* Used for sections that need somewhat larger corners.
------------------------------------------------------------ */
-.roundframe
-{
-	padding: 0 10px;
-	background: #f5f5f5;
-	border-left: 1px solid #c5c5c5;
-	border-right: 1px solid #c5c5c5;
+#pm_menu .unread:last-of-type, #alerts_menu .unread:last-of-type {
+	border-bottom: 1px solid transparent;
 }
-.roundframe dl, .roundframe dt, .roundframe p
-{
-	margin: 0;
+#pm_menu .details, #alerts_menu .details {
+	max-width: 80%;
 }
-.roundframe p
-{
+/* Levels 2 and 3 submenu wrapper. */
+.dropmenu li ul, .top_menu {
+	z-index: 90;
+	position: absolute;
+	top: 2.25em;
+	display: none;
+	width: 18.2em;
 	padding: 0.5em;
+	font-weight: normal;
+	border: solid 1px #999;
+	border-left: solid 1px #bbb;
+	border-top: solid 1px #ccc;
+	border-radius: 4px;
+	box-shadow: 3px 3px 4px rgba(0,0,0,0.3);
+	background: #FFFFFF;
 }
-span.upperframe
-{
-	padding: 0;
-	display: block;
-	background: url(../images/theme/main_block.png) 0 -90px no-repeat;
-	padding-left: 20px;
-}
-span.upperframe span
-{
+/* Level 2 link background. */
+.dropmenu li li {
+	margin: 0;
 	padding: 0;
-	height: 12px;
-	display: block;
-	background: url(../images/theme/main_block.png) 100% -90px no-repeat;
+	width: 17em;
+	position: relative;
+	float: none;
+	font-size: 1em;
+	border-radius: 3px;
+	border: 1px solid transparent;
 }
-span.lowerframe
-{
-	padding: 0;
+.dropmenu li li a {
+	position: relative;
+	line-height: 2.2em;
+	padding: 0 7px;
 	display: block;
-	background: url(../images/theme/main_block.png) 0 -102px no-repeat;
-	padding-left: 20px;
+	color: #346;
 }
-span.lowerframe span
-{
-	padding: 0;
-	height: 12px;
-	display: block;
-	background: url(../images/theme/main_block.png) 100% -102px no-repeat;
+.dropmenu li li a>img {
+	vertical-align: middle;
 }
-
-/* The main content area.
-------------------------------------------------------- */
-.content
-{
-	padding: 0.5em 1.2em;
-	margin: 0;
-	border: none;
+/* The profile/pm menus are declared off .dropmenu li ul for consistency but have other characteristics. */
+.top_menu {
+	width: 25em;
 }
-.content p
-{
-	margin: 0 0 0.5em 0;
+.top_menu .login {
+	width: 100%;
 }
-
-/* Styles used by the auto suggest control.
-------------------------------------------------------- */
-.auto_suggest_div
-{
-	border: 1px solid #000;
-	position: absolute;
-	visibility: hidden;
+.top_menu .login dt {
+	text-align: left;
+	width: 55%;
 }
-.auto_suggest_item
-{
-	background-color: #ddd;
+.top_menu .login dd {
+	width: 43%;
 }
-.auto_suggest_item_hover
-{
-	background-color: #888;
-	cursor: pointer;
-	color: #eee;
+.top_menu .login input {
+	width: 90%;
 }
-
-/* Styles for the standard dropdown menus.
-------------------------------------------------------- */
-#main_menu
-{
-	padding: 0 0.5em;
-	float: left;
-	margin: 0;
-	width: 98%;
+/* Note: The next declarations are for keyboard access with js disabled. */
+.dropmenu ul a:focus, .dropmenu ul ul a:focus {
+	margin-left: 9990px;
+	border: none;
+	width: 17em;
 }
-
-.dropmenu, .dropmenu ul
-{
-	list-style: none;
-	line-height: 1em;
-	padding: 0;
-	margin: 0;
+.dropmenu ul ul a:focus {
+	margin-left: 19950px;
 }
-.dropmenu
-{
-	padding: 0 0.5em;
+/* Cancel those for hover and/or js access. */
+.dropmenu ul li:hover a:focus, .dropmenu ul li a:focus {
+	margin-left: 0;
+	width: auto;
 }
-.dropmenu a
-{
-	display: block;
-	color: #000;
-	text-decoration: none;
+/* Necessary to allow highlighting of 1st level while hovering over submenu. */
+.dropmenu li:hover li a, .dropmenu li li a {
+	padding: 0 9px;
+	background: none;
+	color: #346;
+	border: none;
 }
-.dropmenu a span
-{
-	display: block;
-	padding: 0 0 0 5px;
-	font-size: 0.9em;
+/* Level 3 submenu wrapper positioning. */
+.dropmenu li ul ul {
+	margin: -2em 0 0 15.3em;
 }
-/* the background's first level only */
-.dropmenu li a.firstlevel
-{
-	margin-right: 8px;
+/* Level 3 maintains font-size the same as Level 2. */
+.dropmenu li li li a {
+	font-size: 1em;
 }
-.dropmenu li a.firstlevel span.firstlevel
-{
-	display: block;
-	position: relative;
-	left: -5px;
-	padding-left: 5px;
-	height: 22px;
-	line-height: 19px;
-	white-space: pre;
+/* Levels 2 and 3 hover effects. */
+.dropmenu li li:hover {
+	border: none;
 }
-.dropmenu li
-{
-	float: left;
-	padding: 0;
-	margin: 0;
-	position: relative;
+.dropmenu li li:hover>a, .dropmenu li li a:focus, .dropmenu li li a:hover {
+	color: #333;
+	text-decoration: none;
+	border: 1px solid #cfcfcf;
+	border-top: 1px solid #d4dee6;
 }
-.dropmenu li ul
-{
-	z-index: 90;
+/* Reposition Level 2 submenu as visible on hover. */
+.dropmenu li ul {
 	display: none;
-	position: absolute;
-	width: 19.2em;
-	font-weight: normal;
-	border-bottom: 1px solid #999;
-	background: url(../images/theme/menu_gfx.png) 0 -130px no-repeat;
-	padding: 7px 0 0 0;
-}
-.dropmenu li li
-{
-	width: 19em;
-	margin: 0;
-	border-left: 1px solid #999;
-	border-right: 1px solid #999;
 }
-.dropmenu li li a span
-{
+.dropmenu li:hover ul {
 	display: block;
-	padding: 8px;
-}
-.dropmenu li ul ul
-{
-	margin: -1.8em 0 0 13em;
-}
-
-/* the active button */
-.dropmenu li a.active
-{
-	background: url(../images/theme/menu_gfx.png) no-repeat 100% 0;
-	color: #fff;
-	font-weight: bold;
 }
-.dropmenu li a.active span.firstlevel
-{
-	background: url(../images/theme/menu_gfx.png) no-repeat 0 0;
-}
-/* the hover effects */
-.dropmenu li a.firstlevel:hover, .dropmenu li:hover a.firstlevel
-{
-	background: url(../images/theme/menu_gfx.png) no-repeat 100% -30px;
-	color: #fff;
-	cursor: pointer;
-	text-decoration: none;
-}
-.dropmenu li a.firstlevel:hover span.firstlevel, .dropmenu li:hover a.firstlevel span.firstlevel
-{
-	background: url(../images/theme/menu_gfx.png) no-repeat 0 -30px;
+/* Hiding Level 3 submenu off hover. */
+.dropmenu li:hover ul ul, .dropmenu li ul ul, .dropmenu li:hover ul ul ul, .dropmenu li ul ul ul {
+	left: -9999px;
 }
-/* the hover effects on level2 and 3 */
-.dropmenu li li a:hover, .dropmenu li li:hover>a
-{
-	background: #d4dbe4;
-	color: #000;
-	text-decoration: none;
-}
-.dropmenu li:hover ul ul, .dropmenu li:hover ul ul ul
-{
-	top: -999em;
-}
-.dropmenu li li:hover ul
-{
-	top: auto;
+/* Reposition as visible on hover. */
+.dropmenu li li:hover ul, .dropmenu li li ul {
+	left: -14px;
 }
-.dropmenu li:hover ul
-{
-	display: block;
+.dropmenu li li.subsections > a::after {
+	position: absolute;
+	top: 0.7em;
+	right: 2px;
+	font: 83.33%/150% Arial, sans-serif;
+	content: '\25ba';
 }
-.dropmenu li li.additional_items
-{
-	background-color: #fff;
+/* Highlighting of current section */
+.dropmenu li li a.chosen {
+	font-weight: bold;
 }
 
-/* The dropdown menu toggle image */
-#menu_toggle
-{
-	float: right;
-	margin-right: 10px;
-	padding-top: 3px;
-}
-#menu_toggle span
-{
-	position: relative;
-	right: 5000px;
+/* The extra menu rows for admin sections, etc. */
+#adm_submenus {
+	margin: 0 0 6px 0;
+	padding: 10px 15px 0 15px;
+	overflow: hidden;
 }
 
 /* Styles for the standard button lists.
 ------------------------------------------------------- */
-
-.buttonlist ul
-{
+.buttonlist {
 	z-index: 100;
-	padding: 5px;
-	margin: 0 0.2em 5px 0;
-}
-.buttonlist ul li
-{
-	margin: 0;
-	padding: 0;
-	list-style: none;
-	float: left;
+	padding: 5px 0 5px 0;
+	margin: 5px 0 5px 0;
 }
-.buttonlist ul li a
-{
-	display: block;
-	font-size: 0.8em;
-	color: #000;
-	background: #e8e8e8 url(../images/theme/menu_gfx.png) no-repeat 0 -60px;
-	padding: 0 0 0 8px;
-	margin-left: 12px;
+.button {
+	display: inline-block;
 	text-transform: uppercase;
 	cursor: pointer;
+	border: 1px solid #ddd;
+	border-right: 1px solid #bbb;
+	border-bottom: 1px solid #aaa;
+	border-radius: 3px;
+	box-shadow: 1px 1px 1px rgba(0,0,0,0.1);
+	padding: 0 8px;
+	margin: 0 0 0 5px;
+	overflow: visible;
+	color: #444;
+	font-size: 0.8em;
+	height: 2.2em;
+	line-height: 2.2em;
 }
-.buttonlist ul li a:hover
-{
-	background: url(../images/theme/menu_gfx.png) no-repeat 0 0;
-	color: #fff;
-	text-decoration: none;
-}
-.buttonlist ul li a span
-{
-	background: url(../images/theme/menu_gfx.png) no-repeat 100% -60px;
-	display: block;
-	height: 19px;
-	line-height: 19px;
-	padding: 0 8px 0 0;
+/* Keep a consistent size when wrapped in pagesection. */
+.pagesection .button {
+	font-size: 0.889em;
 }
-.buttonlist ul li a:hover span
-{
-	background: #fff url(../images/theme/menu_gfx.png) no-repeat 100% 0;
+.button:hover {
+	color: #af6700;
+	text-decoration: none;
+	border: 1px solid #ddd;
+	border-left: 1px solid #bbb;
+	border-top: 1px solid #aaa;
+	box-shadow: -1px -1px 2px rgba(0,0,0,0.07), -1px -2px 4px rgba(255,255,255,0.33) inset;
 }
 /* the active one */
-.buttonlist ul li a.active
-{
-	background: #5a6c85 url(../images/theme/menu_gfx.png) no-repeat 0 -90px;
+.button.active {
+	background: #557ea0;
 	color: #fff;
 	font-weight: bold;
+	border: 1px solid #558080;
+	text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.6);
 }
-.buttonlist ul li a.active span
-{
-	background: url(../images/theme/menu_gfx.png) no-repeat 100% -90px;
-}
-.buttonlist ul li a.active
-{
-	font-weight: bold;
+.button.active:hover {
+	color: #ffc187;
+	background: #557ea0;
 }
-.buttonlist ul li a.active:hover
-{
-	color: #ddf;
-}
-.align_top ul li a, .align_bottom ul li a
-{
+.align_top a, .align_bottom a {
 	margin: 0 12px 0 0;
 }
-
-/* the navigation list */
-ul#navigation
-{
-	margin: 0;
-	font-size: 0.9em;
-	padding: 1em 0.4em;
+.button.last {
+	margin-top: 9px;
 }
-ul#navigation li
-{
-	float: none;
-	font-size: 0.95em;
-	display: inline;
+
+/* Styles for the general looks of the theme.
+------------------------------------------------------- */
+/* Do all these here to save repetition. */
+#header, #header .frame, #top_section, #upper_wrap, #upper_section, #upper_section .user,
+#upper_section .news, .navigate_section, #content_section, #main_content_section,
+#lower_section, #lower_section .frame, #footer_section, #footer_section div.frame {
+	box-sizing: border-box;
 }
 
-#adm_submenus
-{
-	padding-left: 2em;
-	overflow: hidden;
+/* These divisions wrap the forum sections when a forum width is set. */
+#wrapper, .frame {
+	margin: 0 auto;
 }
 
-/* Styles for the general looks for the Curve theme.
-------------------------------------------------------- */
+/* Box-shadow only on this one. */
+#wrapper {
+	clear: both;
+	background: #fff;
+	border: 1px solid #b8b8b8;
+	border-radius: 8px;
+	box-shadow: 0 2px 3px rgba(0,0,0,0.14);
+}
 
-/* the framing graphics */
-#header
-{
-	background: url(../images/theme/main_block.png) #fefefe no-repeat 0 -480px;
-	padding-left: 20px;
+/* The framing graphics */
+/* The top bar. */
+#top_section {
+	margin: 0;
+	padding: 0 4px;
+	border-bottom: 1px solid #bbb;
+	box-shadow: 0 1px 4px rgba(0,0,0,0.16);
+	background: #FFFFFF;
 }
-#header div.frame
-{
-	background: url(../images/theme/main_block.png) no-repeat 100% -480px;
+#top_section .frame{
+	clear: both;
+}
+#top_section .frame::after {
+	content:"";
 	display: block;
-	padding: 5px 20px 1em 0;
+	clear: both;
 }
-/* the content section */
-#content_section
-{
-	background: #FFFFFF url(../images/theme/frame_repeat.png) repeat-y top left;
-	padding-left: 20px;
+#top_info {
+	margin: 0;
+	padding: 5px 9px 4px 9px;
+	line-height: 1.3em;
+	width: auto;
 }
-#content_section div.frame
-{
-	background: url(../images/theme/frame_repeat.png) repeat-y top right;
-	display: block;
-	padding: 0 20px 0 0;
+#profile_menu_top > img.avatar {
+	height: 18px;
+	width: 18px;
+	margin: 2px 5px 0 0;
+	float: left;
+	padding: 0;
 }
-#main_content_section
+/*#top_section ul li {
+	margin-bottom: 2px;
+	margin-right: 7px;
+	display: inline;
+	font-size: 0.9em;
+}*/
+.notice
 {
-	width: 100%;
-	min-height: 200px;
+	font-weight: bold;
 }
 
-/* the main title, always stay at 45 pixels in height! */
-h1.forumtitle
-{
-	line-height: 45px;
+#languages_form {
+	padding: 4px 0 0 0;
+}
+#search_form {
+	padding: 4px 0 0 0;
+	text-align: right;
+	min-width: 30em;
+}
+#search_form .input_text, #search_form select, #search_form .button_submit {
+	padding: 2px;
+	margin: 2px;
+	background: #fff;
+	border: 1px solid #ddd;
+	border-left: 1px solid #bbb;
+	border-top: 1px solid #aaa;
+	box-shadow: -1px -1px 2px rgba(0,0,0,0.07), -3px -3px 6px rgba(255,255,255,0.8) inset;
+}
+#search_form select, #language_select {
+	margin: 1px;
+}
+#search_form .button_submit {
+	margin: 2px 10px 2px 5px;
+	padding: 2px 5px;
+	border-radius: 3px;
+	color: #333;
+}
+#search_form .button_submit:hover {
+	color: #a85400;
+	text-decoration: none;
+}
+/* The logo and slogan. */
+#header {
+	padding: 2px 2px 12px 2px;
+}
+#header::after {
+	content:"";
+	display: block;
+	clear: both;
+}
+/* Resize the logo if we must, so we do not get an oversized forum. */
+#top > img {
+	max-width: 100%;
+}
+/* The main title. */
+h1.forumtitle {
 	font-size: 1.8em;
-	font-family: Geneva, verdana, sans-serif;
+	font-family: "Tahoma", sans-serif;
 	margin: 0;
-	padding: 0;
+	padding: 22px 12px 6px 10px;
 	float: left;
+	font-weight: normal;
 }
-/* float these items to the right */
-#siteslogan, img#smflogo
-{
-	margin: 0;
-	padding: 0;
-	float: right;
-	line-height: 3em;
-}
-h3, h4
-{
-	padding-bottom: 3px;
+h1.forumtitle a {
+	color: #a85400;
+	text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
 }
-/* the upshrink image needs some tweaking */
-img#upshrink
-{
+/* Float these items to the right */
+#siteslogan, img#smflogo {
+	margin: 0;
+	padding-right: 2px;
 	float: right;
-	margin: 1em;
-}
-/* ..so does the SMF logo */
-img#smflogo
-{
-	margin-left: 1em;
+	line-height: 50px;
+	font-size: 1.8em;
 }
-/* the upper_section, float the two each way */
-#upper_section
-{
-	padding: 5px;
-	margin-bottom: 1.5em;
+/* Tweak the SMF logo */
+img#smflogo {
+	margin: 16px 0 0 0;
 }
-#upper_section ul li.greeting
+/* Even guests need to be aligned */
+.welcome
 {
-	font-size: 1.3em;
-	font-weight: bold;
-	line-height: 1.5em;
+	padding-left: 10px;
+	padding-top: 5px;
 }
-#upper_section div.news
-{
-	width: 50%;
-	float: right;
-	text-align: right;
+/*
+/* The user info, news, etc.*/
+#upper_section {
+	padding: 2px 2px 0 2px;
+	margin: 0;
 }
-#guest_form
-{
-	overflow: hidden;
+#inner_section {
+	padding: 12px 10px 2px 10px;
+	border-radius: 6px 6px 0 0;
 }
-#guest_form .info
-{
-	padding: 4px 0 ;
-	line-height: 1.3em;
+#inner_section::after {
+	content:"";
+	display: block;
+	clear: both;
 }
-div#upper_section div.user
-{
+/* The upper_section, float the two each way */
+.user {
 	width: 50%;
 	float: left;
 	overflow: auto;
+	padding: 0 4px 6px 4px;
+	font-size: 0.9em;
 }
-div#upper_section div.user p
-{
-	float: left;
-	margin: 0 1em 1em 0;
-	padding: 0;
-}
-div#upper_section div.user ul
-{
-	margin: 0;
-	padding-left: 10px;
-}
-div#upper_section div.user ul li
-{
-	margin-bottom: 2px;
-}
-div#upper_section div.news p
-{
-	display: inline;
+.user ul{
+	padding: 0 0 5px 0;
+	font-size: 0.9em;
+	line-height: 1.8em;
 }
-div#upper_section div.news form
-{
-	padding-bottom: 10px;
+ul li.greeting {
+	font-weight: bold;
 }
-/* clearing the floats */
-#top_section
-{
-	min-height: 65px;
+/* The login form. */
+#guest_form {
 	overflow: hidden;
-	margin-bottom: 3px;
+	font-size: 0.9em;
+	margin-left: -2px;
 }
-#upper_section
-{
-	overflow: hidden;
+/* News section. */
+#inner_wrap .news {
+	max-width: 50%;
+	float: right;
+	padding: 0 0 6px 0;
+	font-size: 0.9em;
+}
+#inner_wrap .news h2, #inner_wrap .news p {
+	display: inline;
+	padding: 0 0 0 4px;
 }
 
 /* The navigation list (i.e. linktree) */
-.navigate_section
-{
-	padding: 0.5em;
-	margin: 0 0 0 0;
+.navigate_section {
+	padding: 3px 0 0 0;
+	float: left;
+	width: 100%;
 }
-.navigate_section ul
-{
-	display: block;
-	margin: 0;
+#main_content_section .navigate_section {
+	margin: 4px 0 0 0;
+	padding: 0;
+}
+.navigate_section ul {
+	margin: 4px 0 0 0;
+	padding: 0 10px;
 	font-size: 0.9em;
-	padding: 1em 0 0.5em 0;
-	border-top: 1px solid #ccc;
 	overflow: hidden;
-	list-style: none;
-	clear: both;
-	width: 100%;
+	border: 1px solid #ddd;
+	border-radius: 2px;
+	box-shadow: 0 -2px 2px rgba(0,0,0,0.08);
+	box-sizing: border-box;
 }
-.navigate_section ul li
-{
+.navigate_section ul li {
 	float: left;
-	padding: 0 0.5em 0 0;
-	font-size: 0.95em;
+	padding-bottom: 3px;
+	line-height: 1.1em;
+	color: #444;
+	text-shadow: 1px 1px 0 #fff;
 }
-.navigate_section ul li a
-{
-	white-space: pre;
+.navigate_section ul li a, .navigate_section ul li em {
+	padding: 4px 0 4px;
+	margin-top: -4px;
+	display: inline-block;
+}
+.navigate_section ul li span {
+	display: inline-block;
+	margin-top: 8px;
+}
+.navigate_section ul li .dividers {
+	color: #3f6b8c;
+	font: 83.33%/150% Arial, sans-serif;
+	padding: 0 2px 0 6px;
+}
+.navigate_section ul li .board_moderators a {
+	padding: 4px 0;
 }
 
-/* The footer wih copyright links etc. */
-#footer_section
-{
-	text-align: center;
-	background: url(../images/theme/main_block.png) no-repeat 0 -820px;
-	padding-left: 20px;
+/* "Unread posts" and "New replies" links, accessible with header collapsed. */
+.navigate_section .unread_links {
+	float: right;
 }
-#footer_section span.smalltext
-{
-	font-size: 100%;
+.navigate_section .unread_links a {
+	padding: 4px 0 4px 10px;
+	margin-top: 4px;
 }
-#footer_section div.frame
-{
-	background: url(../images/theme/main_block.png) no-repeat 100% -820px;
+/* The content section */
+#content_section {
+	margin: 0 auto;
+	padding: 0;
+	clear: both;
+}
+#main_content_section {
+	padding: 5px 12px 16px 12px;
+}
+#main_content_section::after {
+	content:"";
 	display: block;
-	padding: 60px 0 0 0;
+	clear: both;
 }
-#footer_section ul li, #footer_section p
-{
-	font-size: 0.8em;
+/* Footer is now full-width by default. Frame inside it will match theme wrapper width automatically. */
+/* The footer with copyright links etc. */
+#footer_section {
+	margin: 4em 0 0 0;
+	padding: 0;
+	background: #3e5a78;
+	border-top: 3px solid #b2b6bd;
+
 }
-#footer_section ul li
-{
+/* min-width should be equal to #wrapper min-width. */
+#footer_section div.frame {
+	padding: 10px 5px;
+}
+#footer_section ul li, #footer_section p,
+#footer_section ul li a, #footer_section p a {
+	font-size: 0.9em;
+	color: #fff;
+}
+#footer_section ul li {
 	display: inline;
 	padding-right: 5px;
 }
-#footer_section ul li.copyright
-{
+#footer_section ul li.copyright {
 	display: block;
 }
-select.qaction, input.qaction
-{
-	font-size: 0.85em;
+
+/* the posting icons */
+#postbuttons_upper ul li a span {
+	line-height: 19px;
+	padding: 0 0 0 6px;
+}
+.mark_read {
+	margin: -5px 0 16px 0;
 	padding: 0;
+	float: right;
 }
-#mlist table tbody td.windowbg2
-{
-	text-align: center;
+.mark_read .buttonlist {
+	margin: 0;
+	padding: 0;
 }
 
-/* Styles for a typical table.
-------------------------------------------------------- */
-table.table_list
-{
-	width: 100%;
+/* the small stats */
+#index_common_stats {
+	margin: -4px 8px 6px 8px;
+	padding: 4px 0 0 0;
+	font-size: 0.9em;
+	border-top: 1px solid #ddd;
 }
-table.table_list p
-{
-	padding: 0;
+
+.fix_rtl_names {
+	display: inline-block;
+}
+
+/* The quick buttons */
+.quickbuttons {
+	margin: 11px 0 0 0;
+	padding: 0 0 4px 0;
+	clear: right;
+	float: right;
+	text-align: right;
+}
+.quickbuttons li {
+	float: left;
+	display: inline;
 	margin: 0;
+	font-size: 0.9em;
 }
-table.table_list td, table.table_list th
-{
-	padding: 5px;
+.quickbuttons li a {
+	padding: 0 4px 0 5px;
+	display: block;
+	line-height: 1.9em;
+	float: left;
+	background: url(../images/quickbuttons.png) no-repeat 0 -1px;
 }
-table.table_list tbody.header td
-{
-	padding: 0;
+.quickbuttons li a img {
+	padding-bottom: 2px;
 }
-table.table_list tbody.content td.stats
-{
-	font-size: 90%;
-	width: 15%;
-	text-align: center;
+.quickbuttons li input {
+	margin-top: 4px;
 }
-table.table_list tbody.content td.lastpost
-{
-	line-height: 1.3em;
-	font-size: 85%;
-	width: 24%;
+.quickbuttons a:hover {
+	color: #a70;
 }
-table.table_list tbody.content td.icon
-{
-	text-align: center;
-	width: 6%;
+.quickbuttons li a.quote_button {
+	background-position: 0 -1px;
+	padding: 0 2px 0 20px;
+}
+/* Fix for quote on reply box */
+#post_modify {
+	border-radius: 4px;
+}
+.quickbuttons li a.modifybutton {
+	background-position: 0 -59px;
+	padding: 0 2px 0 20px;
+}
+.quickbuttons li a.remove_button {
+	background-position: 2px -29px;
+	padding: 0 2px 0 25px;
+}
+.quickbuttons li a.modify_button {
+	background-position: 2px -59px;
+}
+.quickbuttons li a.approve_button,
+.quickbuttons li a.read_button {
+	background-position: 2px -88px;
+}
+.quickbuttons li a.restore_button {
+	background-position: 0 -120px;
+}
+.quickbuttons li a.split_button {
+	background-position: 2px -149px;
+}
+.quickbuttons li a.reply_button {
+	background-position: 0 -180px;
+}
+.quickbuttons li a.reply_all_button {
+	background-position: 0 -180px;
+}
+.quickbuttons li a.notify_button {
+	background-position: 1px -210px;
+}
+.quickbuttons li a.unapprove_button,
+.quickbuttons li a.unread_button {
+	background-position: 2px -238px;
+}
+.quickbuttons li a.warn_button {
+	background-position: 2px -270px;
+}
+/* Some extra padding for some buttons */
+.quickbuttons li a.read_button, .quickbuttons li a.reply_button,
+.quickbuttons li a.reply_all_button, .quickbuttons li a.notify_button,
+.quickbuttons li a.unread_button {
+	padding: 0 4px 0 22px;
+}
+.quickbuttons li.inline_mod_check {
+	padding: 1px 1px 1px 1px;
+}
+.quickbuttons li {
+	border: 1px solid #ddd;
+	border-right: 1px solid #bbb;
+	border-bottom: 1px solid #aaa;
+	border-radius: 1px;
+	box-shadow: 1px 1px 1px rgba(0,0,0,0.1);
+	padding: 0 1px 0 1px;
+	color: #222;
+	overflow: visible;
 }
-
-/* Styles for the board index.
-------------------------------------------------- */
-
-/* the board title! */
-.table_list tbody.content td.info a.subject
-{
-	font-weight: bold;
-	font-size: 110%;
-	color: #d97b33;
+.quickbuttons li:first-child, .quickbuttons li:first-child:hover {
+	border-radius: 4px 1px 1px 4px;
+	padding-bottom: 0;
 }
-.table_list tbody.content td.children
-{
-	color: #555;
-	font-size: 85%;
+.quickbuttons li:last-child, .quickbuttons li:last-child:hover {
+	border-radius: 1px 4px 4px 1px;
+	padding-bottom: 0;
+	line-height: 1.9em;
 }
-p.moderators
-{
-	font-size: 0.8em;
-	font-family: verdana, sans-serif;
+.quickbuttons li:hover {
+	border: 1px solid #ddd;
+	border-right: 1px solid #bbb;
+	border-bottom: 1px solid #aaa;
+	border-radius: 1px;
+	box-shadow: 1px 1px 1px rgba(0,0,0,0.1);
 }
-/* hide the table header/footer parts - but its here for those needing to style it */
-#boardindex_table .table_list thead, #boardindex_table .table_list tfoot
-{
-	display: none;
+.quickbuttons li.quick_edit, .quickbuttons li.post_options {
+	line-height: 1.9em;
+	position: relative;
 }
-
-/* the posting icons */
-#posting_icons
-{
-	padding: 0 1em 0.5em 1em;
-	margin: 0 0 1em 0;
-	line-height: 1em;
+.quickbuttons li a, .quickbuttons li a:hover {
+	text-decoration: none;
+	color: #222;
 }
-#posting_icons ul
-{
-	font-size: 0.8em;
+.quickbuttons li.post_options {
+	padding: 0 4px 0 4px;
 }
-#posting_icons img
-{
-	vertical-align: middle;
-	margin: 0 0 0 4ex;
+.quickbuttons li.post_options>a {
+	padding: 0 4px 0 4px;
 }
-#postbuttons_upper ul li a span
-{
-	line-height: 19px;
-	padding: 0 0 0 6px;
+.quickbuttons li ul {
+	position: absolute;
+	top: 1.9em;
+	z-index: 90;
+	padding: 0.5em;
+	font-weight: normal;
+	text-align: left;
+	border: solid 1px #999;
+	border-left: solid 1px #aaa;
+	border-top: solid 1px #bbb;
+	border-radius: 4px 2px 4px 0;
+	box-shadow: 2px 3px 3px rgba(0,0,0,0.2);
 }
-.nextlinks
-{
-	text-align: right;
-	margin-top: -1px;
+.quickbuttons li ul {
+	display: none;
+	right: -1px;
 }
-.nextlinks_bottom
-{
-	clear: right;
-	text-align: right;
+.quickbuttons li:hover ul {
+	display: block;
 }
-.mark_read
-{
-	padding: 0 0.5em;
+.quickbuttons li ul li, .quickbuttons li:hover ul li {
+	display: block;
+	background: none;
+	box-shadow: none;
+	width: 12em;
+	border: 1px solid transparent;
+	border-radius: 3px;
+}
+.quickbuttons li ul li:hover {
+	border: 1px solid #cfcfcf;
+	border-top: 1px solid #d4dee6;
+	border-bottom: 1px solid #cbdae6;
+}
+.quickbuttons ul li a, .quickbuttons ul li a:focus {
+	padding: 0 6px 0 26px;
+	display: block;
+	line-height: 2.2em;
+	width: 12em;
+	box-sizing: border-box;
+}
+/* Sub buttons doesn't need to be effected by first-child/last-child */
+.quickbuttons li > ul > li {
+	border-radius: 3px !important;
+}
+/* Note: The next declarations are for keyboard access with js disabled. */
+.quickbuttons ul li a:focus {
+	margin: 0 -9910px 0 9910px;
+}
+/* Cancel for hover and/or js access. */
+.quickbuttons ul li:hover a:focus, .quickbuttons ul li a:focus {
+	margin: 0;
 }
 
-/* the newsfader */
-#newsfader
-{
-	margin: 0 2px;
+/* The jump to box */
+#display_jump_to {
+	padding: 11px 5px 5px 0;
+	margin: 0;
+	border: none;
+	float: right;
+	font-size: 1em;
+	background: none;
 }
-#smfFadeScroller
-{
-	text-align: center;
-	padding: 0 2em;
-	overflow: auto;
-	margin: 1em 0;
-	color: #575757; /* shouldn't be shorthand style due to a JS bug in IE! */
+#display_jump_to select {
+	margin: 0 -12px 0 0;
+	padding: 2px;
 }
 
-/* Styles for the info center on the board index.
+/* Styles for edit event section
 ---------------------------------------------------- */
-
-#upshrinkHeaderIC
-{
-	margin-top: 4px;
+#post_event .roundframe {
+	padding: 12px 12%;
+	overflow: auto;
 }
-dl#ic_recentposts
-{
-	margin: 0 0 0.5em 0;
-	padding: 0.5em;
-	line-height: 1.3em;
+#post_event fieldset {
+	padding: 6px;
+	clear: both;
 }
-dl#ic_recentposts dt
-{
+#post_event #event_main input {
+	margin: 0 0 12px 0;
 	float: left;
 }
-dl#ic_recentposts dd
-{
-	text-align: right;
+#post_event #event_main div.smalltext {
+	width: 34.6em;
+	float: right;
 }
-#upshrinkHeaderIC p
-{
-	margin: 0 0 0.5em 0;
-	padding: 0.5em;
+#post_event div.event_options {
+	float: right;
 }
-#upshrinkHeaderIC p.last
-{
+#post_event .event_main, .event_options {
+	padding: 0;
+	overflow: hidden;
+}
+#post_event ul.event_main li {
+	list-style-type: none;
+	margin: 2px 0;
+	width: 49%;
+	float: left;
+}
+#post_event ul.event_options {
 	margin: 0;
-	padding: 0.5em;
-	border-top: 2px dotted #bbb;
+	padding: 0 0 8px 8px;
 }
-#upshrinkHeaderIC p.inline
-{
-	border: none;
+#post_event ul.event_options li {
+	list-style-type: none;
 	margin: 0;
-	padding: 0.2em 0.5em 0.2em 0.5em;
+	float: left;
 }
-#upshrinkHeaderIC p.stats
-{
-	font-size: 1.1em;
-	padding-top: 8px;
+#post_event #event_main select, #post_event ul.event_options li select, #post_event ul.event_options li .input_check {
+	margin: 0 12px 0 0;
 }
-form#ic_login
-{
-	padding: 0.5em;
-	height: 2em;
+
+/* Styles for the recent messages section.
+---------------------------------------------------- */
+
+#readbuttons_top .pagelinks, #readbuttons .pagelinks {
+	padding-bottom: 12px;
+	width: 60%;
 }
-form#ic_login ul li
-{
-	margin: 0;
-	padding: 0;
-	float: left;
-	width: 20%;
-	text-align: center;
+#readbuttons .pagelinks {
+	padding-top: 12px;
 }
-form#ic_login ul li label
-{
-	display: block;
+#recent {
+	clear: both;
 }
 
-/* the small stats */
-#index_common_stats
-{
-	display: block;
-	margin: 0 0 0.5em 0;
-	text-align: right;
-	font-size: 0.9em;
-	position: relative;
-	top: -20px;
-	line-height: 1px;
+/* Styles for the move topic section. */
+.move_topic {
+	width: 710px;
+	margin: auto;
+	text-align: left;
 }
-
-img.new_posts
-{
-	padding: 0 0.1em;
+div.move_topic fieldset {
+	padding: 6px;
 }
-/* Styles for the message (topic) index.
----------------------------------------------------- */
-div.table_frame .table_list
-{
-	border-collapse: collapse;
-	margin: 2px 0;
+/* Styles for the report topic/user section. */
+#report_form dl.settings dt {
+	width: 20%;
 }
-.table_frame .table_list td.icon, .table_frame .table_list td.info, .table_frame .table_list td.stats
-{
-	border-right: 2px solid white;
+#report_form dl.settings dd {
+	width: 79%;
 }
-#messageindex
-{
-	clear: both;
+#report_comment {
+	width: 70%;
 }
-/* the page navigation area */
-.childboards
-{
-	margin-bottom: 0.2em;
+/* Styles for the split topic section. */
+div#selected, div#not_selected {
+	width: 49%;
 }
-#childboards h3
-{
-	padding-bottom: 0;
+ul.split_messages li a.split_icon {
+	padding: 0 6px;
 }
-#childboards .table_list thead
-{
-	display: none;
+/* Styles for the merge topic section. */
+ul.merge_topics li {
+	list-style-type: none;
 }
-#childboards .table_list
-{
-	margin-bottom: 1em;
+dl.merge_topic dt {
+	width: 25%;
 }
-.lastpost img
-{
-	float: right;
-	padding: 4px;
+dl.merge_topic dd {
+	width: 74%;
 }
-
-/* Styles for the display template (topic view).
----------------------------------------------------- */
-
-#postbuttons div.buttons
-{
-	padding: 0.5em;
-	width: 40%;
-	float: right;
+fieldset.merge_options {
+	clear: both;
 }
-#postbuttons div.middletext
-{
-	width: 60%;
+.custom_subject {
+	margin: 6px 0;
 }
-#postbuttons span
-{
-	display: block;
-	text-align: right;
+
+/* Styles for the login areas.
+------------------------------------------------------- */
+.login {
+	width: 540px;
+	margin: 0 auto;
 }
-#postbuttons span.lower
-{
+.popup_content .login {
+	width: 100%;
+}
+.login dl {
+	overflow: auto;
 	clear: right;
 }
-#postbuttons .buttonlist
-{
+.login dt, .login dd {
+	margin: 0 0 5px 0;
+	width: 44%;
+	padding: 1px;
+}
+.login dt {
+	float: left;
+	clear: both;
+	text-align: right;
+	font-weight: bold;
+}
+.login dd {
+	width: 54%;
 	float: right;
+	text-align: left;
 }
-#postbuttons #pagelinks
-{
-	padding-top: 1em;
+.login p {
+	text-align: center;
 }
-#moderationbuttons
-{
-	overflow: hidden;
+
+/* Additional register fields */
+#registration fieldset {
+	border: none;
+	padding: 0;
+	margin: 0;
 }
-/* Events */
-.linked_events
-{
-	padding: 1em 0;
+#registration .roundframe {
+	border-top: none;
 }
-.edit_event
-{
-	margin: 0 1em;
-	vertical-align: middle;
+dl.register_form {
+	margin: 0;
+	clear: right;
 }
-/* Poll question */
-#poll
-{
-	overflow: hidden;
+dl.register_form dt {
+	font-weight: normal;
+	float: left;
+	clear: both;
+	width: 50%;
+	margin: 6px 0 0 0;
 }
-#poll .content
-{
-	padding: 0 1em;
+dl.register_form dt span {
+	display: block;
 }
-h4#pollquestion
-{
-	padding: 0 0 0.5em 2em;
+dl.register_form dd {
+	float: left;
+	width: 49%;
+	margin: 6px 0 0 0;
 }
-
-/* Poll vote options */
-#poll_options ul.options
-{
-	border-top: 1px solid #9999aa;
-	padding: 1em 2.5em 0 2em;
-	margin: 0 0 1em 0;
+#confirm_buttons {
+	text-align: center;
+	padding: 12px 0;
 }
-#poll_options div.submitbutton
-{
-	border-bottom: 1px solid #9999aa;
-	clear: both;
-	padding: 0 0 1em 2em;
-	margin: 0 0 1em 0;
+.coppa_contact {
+	padding: 4px;
+	width: 32ex;
+	background: #fff;
+	color: #222;
+	margin-left: 5ex;
+	border: 1px solid #222;
+}
+.valid_input {
+	background: #f5fff0;
+}
+.invalid_input {
+	background: #fff0f0;
 }
 
-/* Poll results */
-#poll_options dl.options
-{
-	border: solid #9999aa;
-	border-width: 1px 0;
-	padding: 1em 2.5em 1em 2em;
-	margin: 0 1em 1em 0;
-	line-height: 1.1em !important;
+/* Styles for maintenance mode.
+------------------------------------------------------- */
+#maintenance_mode {
+	width: 75%;
+	min-width: 520px;
+	text-align: left;
+}
+#maintenance_mode img.floatleft {
+	margin-right: 12px;
 }
 
-#poll_options dl.options dt
-{
-	padding: 0.3em 0;
-	width: 30%;
-	float: left;
-	margin: 0;
+/* common for all admin sections */
+#admin_content {
 	clear: left;
+	padding-top: 6px;
 }
-
-#poll_options dl.options .voted
-{
-	font-weight: bold;
+/* Custom profile fields like to play with us some times. */
+#admin_content .custom_field {
+	margin-bottom: 15px;
 }
-
-#poll_options dl.options dd
-{
-	margin: 0 0 0 2em;
-	padding: 0.1em 0 0 0;
-	width: 60%;
-	max-width: 450px;
-	float: left;
+#admin_login .centertext {
+	padding: 12px;
 }
-
-#poll_options dl.options .percentage
-{
-	display: block;
-	float: right;
-	padding: 0.2em 0 0.3em 0;
+#admin_login .centertext .error {
+	padding: 0 0 12px 0;
 }
-
-/* Poll notices */
-#poll_options p
-{
-	margin: 0 1.5em 0.2em 1.5em;
-	padding: 0 0.5em 0.5em 0.5em;
+#admin_login .centertext a.help img {
+	vertical-align: middle;
 }
 
-div#pollmoderation
-{
+tr.windowbg td, tr.windowbg2 td, .table_grid tr td {
+	padding: 4px 8px;
+}
+#credits p {
+	font-style: italic;
 	margin: 0;
 	padding: 0;
-	overflow: auto;
+}
+#credits .windowbg, #credits .windowbg2, #preview_section .windowbg, #poll .windowbg,
+#registration .roundframe,
+#admin_login .roundframe, #frmLogin .roundframe, #post_area .roundframe, #memberlist_search .roundframe,
+#profileview, #coppa, #fatal_error .windowbg {
+	margin: 0 0 10px 0 !important;
+	border-top-left-radius: 0;
+	border-top-right-radius: 0;
 }
 
-/* onto the posts */
-#forumposts
-{
-	clear: both;
+.errorfile_table {
+	background: #f0f4f7;
+	border-spacing: 3px;
+	border-collapse: collapse;
 }
-#forumposts .cat_bar
-{
-	margin: 0 0 2px 0;
+.errorfile_table td.current {
+	font-weight: bold;
+	border: 1px solid black;
+	border-width: 1px 0 1px 1px;
 }
-/* author and topic information */
-#forumposts h3 span#author
-{
-	margin: 0 7.7em 0 0;
+
+#admin_menu .dropmenu {
+	margin: 5px 0 0 0;
 }
-#forumposts h3 img
-{
-	float: left;
-	margin: 4px 0.5em 0 0;
+/* Some lovely generic icons.
+------------------------------------------------- */
+.generic_icons {
+	width: 16px;
+	height: 16px;
+	display: inline-block;
+	background: url(../images/generic_icons.png) no-repeat -5px -5px;
+	vertical-align: middle;
 }
-#forumposts h3.catbg
-{
-	margin-bottom: 3px;
+.generic_icons.gender_None {
+	background: none;
 }
-p#whoisviewing
-{
-	margin: 0;
-	padding: 0.5em;
+/* This is a small fix for dropmenu icons */
+.dropmenu .generic_icons, #profile_menu .generic_icons, .dropmenu img {
+	margin: -3px 8px 0 0;
+	vertical-align: middle;
 }
-/* poster and postarea + moderation area underneath */
-.post_wrapper
-{
-	float:left;
-	width:100%;
+
+/* Top row */
+.generic_icons.help {
+	background-position: -5px -5px;
 }
-.poster
-{
-	float: left;
-	width: 15em;
+.generic_icons.gender_Male {
+	background-position: -31px -5px;
 }
-.postarea, .moderatorbar
-{
-	margin: 0 0 0 16em;
+.generic_icons.www {
+	background-position: -57px -5px;
 }
-.postarea div.flow_hidden
-{
-	width: 100%;
+.generic_icons.mail_new {
+	background-position: -83px -5px;
 }
-
-.moderatorbar
-{
-	clear: right;
+.generic_icons.unlike {
+	background-position: -109px -5px;
 }
-/* poster details and list of items */
-.poster h4, .poster ul
-{
-	padding: 0;
-	margin: 0 1em 0 1.5em;
+.generic_icons.sort_down {
+	background-position: -135px -5px;
 }
-.poster h4
-{
-	margin: 0.2em 0 0.4em 1.1em;
-	font-size: 120%;
+.generic_icons.filter {
+	background-position: -161px -5px;
+	margin: 0 5px 0 0;
 }
-.poster h4, .poster h4 a
-{
-	color: #c06002;
+.generic_icons.lock, .generic_icons.security {
+	background-position: -187px -5px;
 }
-.poster ul ul
-{
-	margin: 0.3em 1em 0 0;
-	padding: 0;
+.generic_icons.valid {
+	background-position: -213px -5px;
 }
-.poster ul ul li
-{
-	display: inline;
+.generic_icons.search, .generic_icons.engines {
+	background-position: -239px -5px;
 }
-.poster li.stars, .poster li.avatar, .poster li.blurb, li.postcount, li.im_icons ul
-{
-	margin-top: 0.5em;
+/* 2nd row */
+.generic_icons.check {
+	background-position: -5px -31px;
 }
-.poster li.avatar
-{
-	overflow: hidden;
+.generic_icons.invalid {
+	background-position: -31px -31px;
 }
-.poster li.warning
-{
-	line-height: 1.2em;
-	padding-top: 1em;
+.generic_icons.gender_Female {
+	background-position: -57px -31px;
 }
-.poster li.warning a img
-{
-	vertical-align: bottom;
-	padding: 0 0.2em;
+.generic_icons.watch {
+	background-position: -161px -31px;
 }
-.messageicon
-{
-	float: left;
-	margin: 0 0.5em 0 0;
+.generic_icons.move, .generic_icons.next_page {
+	background-position: -187px -31px;
 }
-.messageicon img
-{
-	padding: 6px 3px;
+.generic_icons.general, .generic_icons.boards, .generic_icons.topics_views {
+	background-position: -213px -31px;
 }
-.keyinfo
-{
-	float: left;
-	width: 50%;
+.generic_icons.features {
+	background-position: -239px -31px;
 }
-.modifybutton
-{
-	clear: right;
-	float: right;
-	margin: 6px 20px 10px 0;
-	text-align: right;
-	font: bold 0.85em arial, sans-serif;
-	color: #334466;	
+/* 3rd row */
+.generic_icons.posters {
+	background-position: -5px -57px;
 }
-
-/* The quick buttons */
-div.quickbuttons_wrap
-{
-	padding: 0.2em 0;
-	width: 100%;
-	float: left;
+.generic_icons.replies, .generic_icons.topics_replies {
+	background-position: -31px -57px;
 }
-
-ul.quickbuttons
-{
-	margin: 0.9em 11px 0 0;
-	clear: right;
-	float: right;
-	text-align: right;
-	font: bold 0.85em arial, sans-serif;
+.generic_icons.history, .generic_icons.time_online, .generic_icons.scheduled {
+	background-position: -57px -57px;
 }
-ul.quickbuttons li
-{
-	float: left;
-	display: inline;
-	margin: 0 0 0 11px;
+.generic_icons.views {
+	background-position: -83px -57px;
 }
-ul.quickbuttons li a
-{
-	padding: 0 0 0 20px;
-	display: block;
-	height: 20px;
-	line-height: 18px;
-	float: left;
+.generic_icons.last_post {
+	background-position: -109px -57px;
 }
-ul.quickbuttons a:hover
-{
-	color: #a70;
+.generic_icons.starters, .generic_icons.people, .generic_icons.membergroups, .generic_icons.mlist {
+	background-position: -135px -57px;
 }
-ul.quickbuttons li.quote_button
-{
-	background: url(../images/theme/quickbuttons.png) no-repeat 0 0;
+.generic_icons.poll {
+	background-position: -161px -57px;
 }
-ul.quickbuttons li.remove_button
-{
-	background: url(../images/theme/quickbuttons.png) no-repeat 0 -30px;
+.generic_icons.previous_page {
+	background-position: -187px -57px;
 }
-ul.quickbuttons li.modify_button
-{
-	background: url(../images/theme/quickbuttons.png) no-repeat 0 -60px;
+.generic_icons.inbox {
+	background-position: -213px -57px;
 }
-ul.quickbuttons li.approve_button
-{
-	background: url(../images/theme/quickbuttons.png) no-repeat 0 -90px;
+.generic_icons.exit, .generic_icons.logout {
+	background-position: -239px -57px;
 }
-ul.quickbuttons li.restore_button
-{
-	background: url(../images/theme/quickbuttons.png) no-repeat 0 -120px;
+/* 4th row */
+.generic_icons.switch {
+	background-position: -5px -83px;
 }
-ul.quickbuttons li.split_button
-{
-	background: url(../images/theme/quickbuttons.png) no-repeat 0 -150px;
+.generic_icons.replied, .generic_icons.send {
+	background-position: -31px -83px;
 }
-ul.quickbuttons li.reply_button
-{
-	background: url(../images/theme/quickbuttons.png) no-repeat 0 -180px;
+.generic_icons.im_on {
+	background-position: -57px -83px;
 }
-ul.quickbuttons li.reply_all_button
-{
-	background: url(../images/theme/quickbuttons.png) no-repeat 0 -180px;
+.generic_icons.im_off {
+	background-position: -83px -83px;
 }
-ul.quickbuttons li.notify_button
-{
-	background: url(../images/theme/quickbuttons.png) no-repeat 0 -210px;
+.generic_icons.split_desel {
+	background-position: -109px -83px;
 }
-ul.quickbuttons li.inline_mod_check
-{
-	margin: 0 0 0 5px;
+.generic_icons.split_sel {
+	background-position: -135px -83px;
 }
-
-.post
-{
-	margin-top: 0.5em;
-	clear: right;
+.generic_icons.mail {
+	background-position: -161px -83px;
 }
-.inner
-{
-	padding: 1em 1em 2px 0;
-	margin: 0 1em 0 0;
-	border-top: 1px solid #99a;
+.generic_icons.warning_mute {
+	background-position: -187px -83px;
 }
-img.smiley
-{
-	vertical-align: bottom;
+.generic_icons.alerts,
+.generic_icons.warning_moderate {
+	background-position: -213px -83px;
 }
-#forumposts .modified
-{
-	float: left;
+.generic_icons.drafts {
+	background-position: -239px -83px;
 }
-#forumposts .reportlinks
-{
-	margin-right: 1.5em;
-	text-align: right;
-	clear: right;
+/* 5th row */
+.generic_icons.warning_watch {
+	background-position: -5px -109px;
 }
-#forumposts .signature, .post .signature
-{
-	margin: 1em 0 0 0;
+.generic_icons.calendar_export {
+	background-position: -31px -109px;
 }
-#forumposts span.botslice
-{
-	clear: both;
+.generic_icons.calendar {
+	background-position: -57px -109px;
 }
-.attachments hr
-{
-	clear: both;
-	margin: 1em 0 1em 0;
+.generic_icons.calendar_modify {
+	background-position: -83px -109px;
 }
-.attachments
-{
-	padding: 1em 0 2em 0;
+.generic_icons.plus {
+	background-position: -109px -109px;
 }
-.attachments div
-{
-	padding: 0 0.5em;
+.generic_icons.warning, .generic_icons.moderate {
+	background-position: -135px -109px;
 }
-
-/* Styles for the quick reply area.
----------------------------------------------------- */
-
-#quickreplybox
-{
-	padding-bottom: 1px;
+.generic_icons.themes {
+	background-position: -161px -109px;
 }
-#quickReplyOptions .roundframe
-{
-	padding: 0 10%;
+.generic_icons.support {
+	background-position: -187px -109px;
 }
-#quickReplyOptions form textarea
-{
-	height: 100px;
-	width: 635px;
-	max-width: 100%;
-	min-width: 100%;
-	margin: 0.25em 0 1em 0;
+.generic_icons.liked_users, .generic_icons.liked_messages, .generic_icons.like {
+	background-position: -213px -109px;
 }
-/* The jump to box */
-#display_jump_to
-{
-	clear: both;
-	padding: 5px;
-	margin-top: 6px;
-	text-align: right;
+.generic_icons.current_theme {
+	background-position: -239px -109px;
 }
-
-/* Separator of posts. More useful in the print stylesheet. */
-#forumposts .post_separator
-{
-	display: none;
+/* 6th row */
+.generic_icons.stats {
+	background-position: -5px -135px;
 }
-
-/* Styles for edit post section
----------------------------------------------------- */
-form#postmodify .roundframe
-{
-	padding: 0 12%;
+.generic_icons.right_arrow {
+	background-position: -31px -135px;
 }
-#post_header, .postbox
-{
-	padding: 0.5em;
-	overflow: hidden;
+.generic_icons.left_arrow {
+	background-position: -53px -135px;
 }
-#post_header dt, .postbox dt
-{
-	float: left;
-	padding: 0;
-	width: 15%;
-	margin: .5em 0 0 0;
-	font-weight: bold;
+.generic_icons.smiley {
+	background-position: -75px -135px;
 }
-#post_header dd, .postbox dd
-{
-	float: left;
-	padding: 0;
-	width: 83%;
-	margin: .3em 0;
+.generic_icons.server {
+	background-position: -101px -135px;
 }
-#post_header img
-{
-	vertical-align: middle;
+.generic_icons.ban, .generic_icons.ignore {
+	background-position: -127px -135px;
 }
-ul.post_options
-{
-	margin: 0 0 0 1em;
-	padding: 0;
-	list-style: none;
-	overflow: hidden;
+.generic_icons.boards  {
+	background-position: -153px -135px;
 }
-ul.post_options li
-{
-	margin: 0.2em 0;
-	width: 49%;
-	float: left;
+.generic_icons.regcenter {
+	background-position: -179px -135px;
 }
-#postAdditionalOptionsHeader
-{
-	margin-top: 1em;
+.generic_icons.posts {
+	background-position: -205px -135px;
 }
-#postMoreOptions
-{
-	border-bottom: 1px solid #cacdd3;
-	padding: 0.5em;
+.generic_icons.change_menu2, .generic_icons.sent {
+	background-position: -231px -135px;
 }
-#postAttachment, #postAttachment2
-{
-	overflow: hidden;
-	margin: .5em 0;
-	padding: 0;
-	border-bottom: 1px solid #cacdd3;
-	padding: 0.5em;
+/* 7th row */
+.generic_icons.post_moderation_moderate {
+	background-position: -5px -161px;
 }
-#postAttachment dd, #postAttachment2 dd
-{
-	margin: .3em 0 .3em 1em;
+.generic_icons.sort_up {
+	background-position: -31px -161px;
 }
-#postAttachment dt, #postAttachment2 dt
-{
-	font-weight: bold;
+.generic_icons.post_moderation_deny {
+	background-position: -57px -161px;
 }
-#postAttachment3
-{
-	margin-left: 1em;
+.generic_icons.post_moderation_attach {
+	background-position: -83px -161px;
 }
-#post_confirm_strip, #shortcuts
-{
-	padding: 1em 0 0 0;
+.generic_icons.post_moderation_allow {
+	background-position: -109px -161px;
 }
-.post_verification
-{
-	margin-top: .5em;
+.generic_icons.personal_message {
+	background-position: -135px -161px;
 }
-.post_verification #verification_control
-{
-	margin: .3em 0 .3em 1em;
+.generic_icons.permissions, .generic_icons.signup {
+	background-position: -161px -161px;
 }
-/* The BBC buttons */
-#bbcBox_message
-{
-	margin: 0.75em 0.5em;
+.generic_icons.paid {
+	background-position: -187px -161px;
 }
-#bbcBox_message div
-{
-	margin: 0.2em 0;
-	vertical-align: top;
+.generic_icons.packages {
+	background-position: -213px -161px;
 }
-#bbcBox_message div img
-{
-	margin: 0 1px 0 0;
-	vertical-align: top;
+.generic_icons.change_menu {
+	background-position: -239px -161px;
 }
-#bbcBox_message select
-{
-	margin: 0 2px;
+/* 8th row */
+.generic_icons.package_ops {
+	background-position: -5px -187px;
 }
-/* The smiley strip */
-#smileyBox_message
-{
-	margin: 0.5em;
+.generic_icons.reports {
+	background-position: -31px -187px;
 }
-
-/* Styles for edit event section
----------------------------------------------------- */
-#post_event .roundframe
-{
-	padding: 0 12%;
+.generic_icons.news {
+	background-position: -57px -187px;
 }
-#post_event fieldset
-{
-	padding: 0.5em;
-	clear: both;
+.generic_icons.delete, .generic_icons.hide_popup, .generic_icons.prune {
+	background-position: -83px -187px;
 }
-#post_event #event_main input
-{
-	margin: 0 0 1em 0;
-	float: left;
+.generic_icons.modifications {
+	background-position: -109px -187px;
 }
-#post_event #event_main div.smalltext
-{
-	width: 33em;
-	float: right;
+.generic_icons.maintain, .generic_icons.admin {
+	background-position: -135px -187px;
 }
-#post_event div.event_options
-{
-	float: right;
+.generic_icons.administration, .generic_icons.home {
+	background-position: -161px -187px;
 }
-#post_event ul.event_main, ul.event_options
-{
-	padding: 0;
-	overflow: hidden;
+.generic_icons.frenemy {
+	background-position: -187px -187px;
 }
-#post_event ul.event_main li
-{
-	list-style-type: none;
-	margin: 0.2em 0;
-	width: 49%;
-	float: left;
+.generic_icons.attachment {
+	background-position: -213px -187px;
 }
-#post_event ul.event_options
-{
-	margin: 0;
-	padding: 0 0 .7em .7em;
+.generic_icons.error, .generic_icons.disable {
+	background-position: -239px -187px;
 }
-#post_event ul.event_options li
-{
-	list-style-type: none;
-	margin: 0;
-	float: left;
+/* 9th row */
+.generic_icons.languages {
+	background-position: -5px -213px;
 }
-#post_event #event_main select, #post_event ul.event_options li select, #post_event ul.event_options li .input_check
-{
-	margin: 0 1em 0 0;
+.generic_icons.members_request {
+	background-position: -31px -213px;
 }
-
-/* Styles for edit poll section.
----------------------------------------------------- */
-
-#edit_poll
-{
-	overflow: hidden;
+.generic_icons.members_delete {
+	background-position: -57px -213px;
 }
-#edit_poll fieldset
-{
-	padding: 0.5em;
-	clear: both;
-	overflow: hidden;
+.generic_icons.members {
+	background-position: -83px -213px;
 }
-#edit_poll fieldset input
-{
-	margin-left: 8.1em;
+.generic_icons.members_watched {
+	background-position: -109px -213px;
 }
-#edit_poll ul.poll_main li
-{
-	padding-left: 1em;
+.generic_icons.sticky {
+	background-position: -135px -213px;
 }
-#edit_poll ul.poll_main input
-{
-	margin-left: 1em;
+.generic_icons.corefeatures, .generic_icons.settings, .generic_icons.manrules, .generic_icons.manlabels {
+	background-position: -161px -213px;
 }
-#edit_poll ul.poll_main, dl.poll_options
-{
-	overflow: hidden;
-	padding: 0 0 .7em .7em;
-	list-style: none;
+.generic_icons.calendar {
+	background-position: -187px -213px;
 }
-#edit_poll ul.poll_main li
-{
-	margin: 0.2em 0;
+.generic_icons.logs {
+	background-position: -213px -213px;
 }
-#edit_poll dl.poll_options dt
-{
-	width: 33%;
-	padding: 0 0 0 1em;
+.generic_icons.approve, .generic_icons.enable {
+	background-position: -239px -213px;
 }
-#edit_poll dl.poll_options dd
-{
-	width: 65%;
+/* 10th row */
+.generic_icons.close {
+	background-position: -5px -239px;
 }
-#edit_poll dl.poll_options dd input
-{
-	margin-left: 0; 
+.generic_icons.details {
+	background-position: -31px -239px;
+}
+.generic_icons.merge {
+	background-position: -57px -239px;
 }
 
-/* Styles for the recent messages section.
----------------------------------------------------- */
+/* Styles for (fatal) errors.
+------------------------------------------------- */
 
-#readbuttons_top .pagelinks, #readbuttons .pagelinks
-{
-	padding-bottom: 1em;
-	width: 60%;
+#fatal_error {
+	width: 80%;
+	margin: auto;
 }
-#readbuttons .pagelinks
-{
-	padding-top: 1em;
+.errorbox::before, .noticebox::before, .infobox::before {
+	width: 16px;
+	height: 16px;
+	background: url(../images/generic_icons.png) no-repeat -187px -83px;
+	left: 10px;
+	content: '';
+	position: absolute;
+	top: 50%;
+	margin-top: -8px;
 }
-#recent
-{
-	clear: both;
+.errorbox, .noticebox, .infobox {
+	padding: 7px 10px 7px 35px;
+	margin-bottom: 12px;
+	position: relative;
 }
-
-/* Styles for the move topic section.
----------------------------------------------------- */
-
-#move_topic dl
-{
-	margin-bottom: 0;
+.errorbox {
+	background-color: #fee;
+	border-top: 2px solid #c34;
+	border-bottom: 2px solid #c34;
 }
-#move_topic dl.settings dt
-{
-	width: 40%;
+.errorbox h3 {
+	padding: 0;
+	margin: 0;
+	font-size: 1.1em;
+	text-decoration: underline;
 }
-#move_topic dl.settings dd
-{
-	width: 59%;
+.errorbox p {
+	margin: 12px 0 0 0;
 }
-.move_topic
-{
-	width: 710px;
-	margin: auto;
-	text-align: left;
+.errorbox p.alert {
+	padding: 0;
+	margin: 0 4px 0 0;
+	float: left;
+	width: 12px;
+	font-size: 1.5em;
 }
-div.move_topic fieldset
-{
-	padding: 0.5em;
+.errorbox span {
+	text-decoration: underline;
 }
 
-/* Styles for the send topic section.
----------------------------------------------------- */
+/* Styles for info boxes
+------------------------------------------------- */
 
-fieldset.send_topic
-{
-	border: none;
-	padding: 0.5em;
+.noticebox::before {
+	background-position: -213px -83px;
 }
-dl.send_topic
-{
-	margin-bottom: 0;
+.infobox::before {
+	background-position: -5px -108px;
 }
-dl.send_mail dt
-{
-	width: 35%;
+.noticebox {
+	color: #666;
+	background: #fff6ca;
+	border-top: 1px solid #ffd324;
+	border-bottom: 1px solid #ffd324;
 }
-dl.send_mail dd
-{
-	width: 64%;
+.infobox {
+	color: #222;
+	background: #cfc;
+	border-top: 1px solid green;
+	border-bottom: 1px solid green;
+}
+.descbox {
+	padding: 7px 10px 7px 10px;
+	border: 1px solid #c5c5c5;
+	margin: 6px 0;
 }
 
-/* Styles for the report topic section.
----------------------------------------------------- */
+/* Styles for the profile section.
+------------------------------------------------- */
 
-#report_topic dl
-{
-	margin-bottom: 0;
+dl {
+	overflow: auto;
+	margin: 0;
+	padding: 0;
 }
-#report_topic dl.settings dt
-{
+
+/* The basic user info on the left */
+#basicinfo {
 	width: 20%;
+	float: left;
 }
-#report_topic dl.settings dd
-{
-	width: 79%;
-}
-
-/* Styles for the split topic section.
----------------------------------------------------- */
-
-div#selected, div#not_selected
-{
-	width: 49%;
+#detailedinfo {
+	width: 79.5%;
+	float: right;
 }
-ul.split_messages li.windowbg, ul.split_messages li.windowbg2
-{
-	margin: 1px;
+#basicinfo h4 {
+	font-size: 1.4em;
+	font-weight: 100;
+	white-space: pre-wrap;
+	overflow: hidden;
 }
-ul.split_messages li a.split_icon
-{
-	padding: 0 0.5em;
+#basicinfo h4 span.position {
+	font-size: 0.8em;
+	font-weight: 100;
+	display: block;
 }
-ul.split_messages div.post
-{
-	padding: 1em 0 0 0;
-	border-top: 1px solid #fff;
+#basicinfo img.avatar {
+	display: block;
+	margin: 10px 0 0 0;
 }
-
-/* Styles for the merge topic section.
----------------------------------------------------- */
-ul.merge_topics li
-{
+#basicinfo ul {
 	list-style-type: none;
+	margin: 10px 0 0 0;
 }
-dl.merge_topic dt
-{
-	width: 25%;
-}
-dl.merge_topic dd
-{
-	width: 74%;
+#basicinfo ul li {
+	display: block;
+	float: left;
+	margin-right: 5px;
+	height: 20px;
 }
-fieldset.merge_options
-{
+#basicinfo #userstatus {
+	display: block;
 	clear: both;
+	margin-top: 6px;
 }
-.custom_subject
-{
-	margin: 0.5em 0;
-}
-
-/* Styles for the login areas.
-------------------------------------------------------- */
-.login
-{
-	width: 540px;
-	margin: 0 auto;
+#basicinfo #userstatus img {
+	vertical-align: middle;
 }
-.login dl
-{
-	overflow: auto;
+#detailedinfo dl, #tracking dl {
 	clear: right;
+	overflow: auto;
+	margin: 0 0 18px 0;
+	padding: 0 0 15px 0;
+	border-bottom: 1px #ccc solid;
 }
-.login dt, .login dd
-{
-	margin: 0 0 0.4em 0;
-	width: 44%;
-	padding: 0.1em;
-}
-.login dt
-{
+#detailedinfo dt, #tracking dt {
+	width: 35%;
 	float: left;
-	clear: both;
-	text-align: right;
+	margin: 0 0 3px 0;
+	padding: 0;
 	font-weight: bold;
+	color: #444;
+	clear: both;
 }
-.login dd
-{
-	width: 54%;
+#detailedinfo dd, #tracking dd {
+	width: 65%;
+	float: left;
+	margin: 0 0 3px 0;
+	padding: 0;
+}
+#detailedinfo .noborder {
+	border-bottom: 0;
+}
+#detailedinfo dt.clear {
+	width: 100%;
+}
+#personal_picture {
+	display: block;
+	margin-bottom: 4px;
+}
+#avatar_server_stored div {
+	float: left;
+}
+#avatar_upload {
+	overflow: auto;
+}
+
+/* Activity by time */
+#activitytime {
+	margin: 6px 0;
+}
+.activity_stats {
+	margin: 10px;
+	padding: 0;
+}
+.activity_stats li {
+	margin: 0;
+	padding: 0;
+	width: 4.16%;
+	float: left;
+}
+.activity_stats li span {
+	display: block;
+	border: solid #666;
+	border-width: 1px 1px 1px 1px;
+	border-left: none;
+	border-right: none;
+	background: #eee;
+	text-align: center;
+}
+.activity_stats li.last span {
+	border-right: none;
+}
+.activity_stats li div.bar {
+	margin: 0 auto;
+	width: 15px;
+	border: 1px solid #ddd;
+	border-bottom: none;
+	background: #fff;
+}
+.activity_stats li div.bar div {
+	background: orange;
+	box-shadow: 4px -4px 4px rgba(0,0,0,0.1) inset, 4px 4px 4px rgba(255,255,255,0.3) inset;
+}
+.activity_stats li div.bar span {
+	position: absolute;
+	top: -1000em;
+	left: -1000em;
+}
+
+.profile_pie {
+	background: url(../images/stats_pie.png);
+	float: left;
+	height: 20px;
+	width: 20px;
+	margin: 0 12px 0 0;
+	padding: 0;
+	text-indent: -1000em;
+}
+
+/* View posts */
+.topic .time {
 	float: right;
-	text-align: left;
 }
-.login p
-{
+.counter {
+	margin: 0;
+	padding: 5px 6px 1px 2px;
+	font-size: 2.2em;
+	font-weight: bold;
+	color: #3f3f3f;
+	float: left;
+}
+.topic_details {
+	padding: 0 4px 4px 4px;
+}
+.list_posts {
+	border-top: 1px solid #ddd;
+	box-shadow: 0 1px 0 #fff inset;
+	padding-top: 12px;
+	margin: 0;
+	overflow: auto;
+	word-break: hyphenate;
+	word-wrap: break-word;
+}
+.topic h4 {
+	margin: 3px 0;
+}
+.topic .post {
+	margin: 0 12px;
+	min-height: 80px;
+	height: auto !important;
+	height: 80px;
+}
+.topic .mod_icons {
+	text-align: right;
+	margin-right: 12px;
+}
+
+#creator dt {
+	width: 40%;
+	float: left;
+	clear: both;
+	margin: 0 0 10px 0;
+}
+#creator dd {
+	float: right;
+	width: 55%;
+	margin: 0 0 10px 2px;
+	overflow: auto;
+}
+.centericon {
+	vertical-align: middle;
+}
+.sizefix {
+	width: 16px;
+	height: 16px;
+}
+.ignoreboards {
+	margin: 0 2%;
+	padding: 0;
+	width: 45%;
+}
+.ignoreboards a {
+	font-weight: bold;
+	border-bottom: 1px solid #c4c4c4;
+	padding: 1px 0;
+}
+.ignoreboards a:hover {
+	text-decoration: none;
+	border-bottom: 1px solid #334466;
+}
+.ignoreboards ul {
+	margin: 0;
+	padding: 0;
+}
+.ignoreboards li {
+	float: left;
+	clear: both;
+}
+.ignoreboards li.category {
+	margin: 8px 0 0 0;
+	width: 100%;
+}
+.ignoreboards li ul {
+	margin: 2px 0 0 0;
+}
+.ignoreboards li.category ul li.board {
+	width: 93%;
+}
+
+#theme_settings {
+	overflow: auto;
+	margin: 0;
+	padding: 0;
+}
+
+#theme_settings li {
+	margin: 10px 0;
+	padding: 0;
+}
+/* Paid Subscriptions */
+#paid_subscription {
+	width: 100%;
+}
+#paid_subscription dl.settings {
+	margin-bottom: 0;
+}
+#paid_subscription dl.settings dd, #paid_subscription dl.settings dt {
+	margin-bottom: 4px;
+}
+/* Pick theme */
+#pick_theme {
+	width: 100%;
+	float: left;
+}
+/*Issue a warning*/
+#warn_body{
+	width: 80%;
+	font-size: 0.9em;
+}
+
+/* Styles for the statistics center.
+------------------------------------------------- */
+#statistics .roundframe {
+	margin: 0;
+	border-top-left-radius: 0;
+	border-top-right-radius: 0;
+}
+dl.stats dt {
+	width: 50%;
+	float: left;
+	margin: 0 0 4px 0;
+	padding: 0;
+	line-height: 1.5em;
+	clear: both;
+	font-size: 1em;
+}
+dl.stats dd {
+	width: 50%;
+	font-size: 1em;
+	float: left;
+	margin: 0 0 4px 0;
+	line-height: 1.4em;
+	min-height: 1.4em;
+	background: #fff;
+	border: 1px solid #aaa;
+	border-radius: 2px;
+	position: relative;
+}
+.statsbar div.bar {
+	float: left;
+	background: orange;
+	border-right: 1px solid #999;
+	border-radius: 1px 0 0 1px;
+	box-shadow: 4px -4px 8px rgba(0,0,0,0.1) inset, 4px 4px 8px rgba(255,255,255,0.3) inset;
+	display: block;
+	margin: 0 4px 0 0;
+	height: 1.4em;
+}
+.statsbar div.bar.empty {
+	width: 0;
+	border-right: none;
+}
+#profileview dd, .nobb, .nobb dd {
+	background: none !important;
+	border: none !important;
+}
+dl.stats {
+	padding: 5px;
+}
+/* Absolute positioning stops these breaking the bars on narrow screens. */
+dl.stats dd span {
+	padding: 0 5px;
+	position: absolute;
+	right: 0;
+	top: 0;
+	z-index: 2;
+	white-space: pre;
+}
+
+/* Forum history table. */
+#stats td, #stats th {
+	width: 15%;
+	padding: 4px;
 	text-align: center;
 }
+#stats tr.windowbg th.lefttext {
+	text-align: left;
+}
+#stats tr.windowbg th.stats_month {
+	width: 25%;
+	padding: 0 2em;
+	text-align: left;
+}
+#stats tr.windowbg td.stats_day {
+	padding: 0 3.5em;
+	text-align: left;
+}
+
+/* Styles for the personal messages section.
+------------------------------------------------- */
+
+#personal_messages h3 span#author, #personal_messages h3 span#topic_title {
+	float: left;
+}
+#personal_messages h3 span#author {
+	margin: 0 0 0 6px;
+}
+#personal_messages h3 span#topic_title {
+	margin: 0 0 0 9em;
+}
+#personal_messages div.labels {
+	padding: 0 12px 0 0;
+}
+#personal_messages .capacity_bar {
+	background: #f0f4f7;
+	display: block;
+	margin: 6px 0 0 12px;
+	height: 12px;
+	border: 1px solid #adadad;
+	width: 10em;
+}
+#personal_messages .capacity_bar span {
+	border-right: 1px solid #adadad;
+	display: block;
+	height: 12px;
+}
+#personal_messages .capacity_bar span.empty {
+	background: #a6d69d;
+}
+#personal_messages .capacity_bar span.filled {
+	background: #eea800;
+}
+#personal_messages .capacity_bar span.full {
+	background: #f10909;
+}
+#personal_messages .reportlinks {
+	padding: 6px 1.3em;
+}
+#searchLabelsExpand li {
+	padding: 4px 6px;
+}
+#manrules div.righttext {
+	padding: 4px 1px;
+}
+dl.addrules dt.floatleft {
+	width: 15em;
+	color: #333;
+	padding: 0 15px 6px 15px;
+}
+#addrule fieldset {
+	clear: both;
+}
+#to_item_list_container div, #bcc_item_list_container div {
+	float:left;
+	margin-right:10px;
+}
+
+/* Styles for the memberlist section.
+------------------------------------------------- */
+#mlist_search {
+	margin: auto;
+	width: 500px;
+}
+#mlist .selected {
+	white-space: nowrap;
+}
+#mlist .is_online {
+	width: 60px;
+}
+#mlist .email_address {
+	width: 25px;
+}
+#mlist .website_url {
+	width: 70px;
+}
+#mlist .icq, #mlist .aim, #mlist .yim, #mlist .skype {
+	width: 30px;
+}
+#mlist .posts {
+	width: 115px;
+}
+/* Styles for the search section.
+------------------------------------------------- */
+#searchform fieldset {
+	text-align: left;
+	padding: 0;
+	border: none;
+}
+#searchform .roundframe {
+	border-radius: 0;
+	margin: 0;
+	padding: 32px;
+	overflow: auto;
+}
+#searchform .alt {
+	border-top: 0;
+	border-bottom-left-radius: 7px;
+	border-bottom-right-radius: 7px;
+}
+#searchform p.clear {
+	clear: both;
+}
+#advanced_search {
+	text-align: center !important;
+	margin: 0;
+}
+#advanced_search dl#search_options {
+	margin: 0 auto;
+	width: 600px;
+	padding-top: 12px;
+	overflow: hidden;
+}
+#advanced_search dt {
+	clear: both;
+	float: left;
+	padding: 2px;
+	text-align: right;
+	width: 20%;
+}
+#advanced_search dd {
+	width: 75%;
+	float: left;
+	padding: 2px;
+	margin: 0 0 0 6px;
+	text-align: left;
+}
 
-/* Styles for the registration section.
+/* Styles for the help section.
+------------------------------------------------- */
+
+#help_container {
+	margin: 0;
+	padding: 0 0 8px 0;
+	overflow: auto;
+}
+#helpmain {
+	margin: 12px 0 0 0;
+	padding: 8px 20px 12px 20px;
+	border: 1px solid #ddd;
+	border-radius: 7px;
+	box-shadow: 0 -2px 2px rgba(0,0,0,0.1);
+	overflow: auto;
+}
+#helpmain p {
+	margin: 10px 0;
+	line-height: 1.5em;
+}
+#helpmain ul {
+	line-height: 2em;
+	margin: 0 0 0 25px;
+}
+#helpmain ul li{
+	list-style-type: disc;
+}
+#helpmain ul li a {
+	font-weight: bold;
+}
+
+/* Styles for the tooltips
 ------------------------------------------------------- */
-.register_error
-{
-	border: 1px dashed red;
-	padding: 5px;
-	margin: 0 1ex 1ex 1ex;
+.tooltip {
+	position: absolute;
+	z-index: 999;
+	left: -9999px;
+	word-wrap: break-word;
+	max-width: 350px;
+	padding: 6px 9px;
+	color: #333;
+	background: #fff;
+	border: 1px solid #aaa;
+	border-radius: 4px 4px 4px 4px;
+	box-shadow: 1px 2px 4px rgba(0,0,0,0.2), 0 0px 10px rgba(0,0,0,0.05) inset;
 }
-.register_error span
-{
-	text-decoration: underline;
+
+/* Styles for popup windows */
+.popup_container {
+	display: none;
+	position: fixed;
+	top: 0;
+	left: 0;
+	width: 100%;
+	height: 100%;
+	background: rgba(40,64,80,0.5);
+	z-index: 3;
+}
+.popup_window {
+	position: fixed;
+	width: 480px;
+	z-index: 99;
+	padding: 0 6px 6px 6px;
+	box-shadow: 0 3px 6px rgba(0,0,0,0.5);
+	border: 1px solid #777;
+	border-radius: 7px 7px 3px 3px;
+	max-height: none!important; /* Is this declaration necessary? None is the default anyway. */
+	overflow: visible!important;
+	background: #FFFFFF;
+	top: 25%;
+	left: 50%;
+	margin: -50px 0 0 -250px;
+}
+.popup_heading {
+	margin: 0;
+	padding: 10px 4px;
+	color: #bf6900;
+	background: none;
+}
+.popup_content {
+	color: #222;
+	line-height: 1.6em;
+	max-height: 30em;
+	overflow: auto;
+	margin: 0;
+	padding: 10px 8px;
+	border: 1px solid #bbb;
+	border-bottom: 1px solid #ddd;
+	border-radius: 6px 6px 2px 2px;
+	box-shadow: 0 -2px 3px rgba(0,0,0,0.15), 0 1px 1px rgba(255,255,255,0.2);
+}
+.generic_icons.hide_popup {
+	float: right;
+}
+.popup_heading .icon {
+	vertical-align: middle;
+	margin: -4px 4px 0 0;
 }
 
-/* Additional profile fields */
-dl.register_form
-{
+/* Styles for the progress bar */
+.progress_bar {
+	height: 15pt;
+	border: 1px solid #DDD;
+	background-color: #FFF;
+	width: 80%;
+	margin: 20px auto 0 auto; /* Top padding should get rid of the <br /> tags in admin for these bars. */
+	position: relative;
+	border-radius: 2px;
+	box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
+}
+.progress_bar .full_bar {
+	padding-top: 1pt;
+	width: 100%;
+	color: #222;
+	position: absolute;
+	text-align: center;
+	font-weight: bold;
+	border-radius: 2px;
+	z-index: 2;
+}
+.progress_bar .green_percent {
+	height: 15pt;
+	background-color: #c1ffc1;
+	background-image: linear-gradient(to bottom, #c1ffc1, green);
+	border-radius: 2px;
+	z-index: 1;
+}
+.progress_bar .blue_percent {
+	height: 15pt;
+	background-color: #98b8f4;
+	background-image: linear-gradient(to bottom, #98b8f4, blue);
+	border-radius: 2px;
+	z-index: 1;
+}
+
+.generic_list_wrapper, .windowbg, .windowbg2, #forumposts .approvebg, #forumposts .approvebg2 {
+	background: #f0f4f7;
+	margin: 12px 0 0 0;
+	padding: 12px 16px;
+	border: 1px solid #ddd;
+	border-radius: 6px;
+	box-shadow: 0 -2px 2px rgba(0,0,0,0.1);
+	overflow: auto;
+	box-sizing: border-box;
+}
+/* Here comes the glory... */
+.windowbg:nth-of-type(even) {
+	background: #f0f4f7;
+}
+.windowbg:nth-of-type(odd) {
+	background: #fdfdfd;
+}
+
+/* Special treatment for #forumposts area */
+#forumposts .windowbg, #forumposts .windowbg2, #forumposts .approvebg, #forumposts .approvebg2 {
+	overflow: visible;
+}
+/* Nobody wants locked topics to stand out much. */
+.windowbg.locked, .windowbg2.locked {
+	background: #e7eaef;
+}
+/* Sticky topics get a different background */
+.windowbg.sticky, .windowbg2.sticky {
+	background: #cfdce8;
+}
+/* Locked AND sticky are a bit more technical */
+.windowbg.sticky.locked, .windowbg2.sticky.locked {
+	background: #e8d8cf;
+}
+/* Awaiting approval is a bit special, topics first */
+.windowbg.approvetopic, .windowbg2.approvetopic {
+	background: #e4a17c;
+}
+/* Unapproved posts in approved topics */
+.windowbg.approvepost, .windowbg2.approvepost {
+	background: #ffeaea;
+}
+.generic_list_wrapper .additional_row {
 	margin: 0;
-	clear: right;
+	padding: 5px 0;
+	border-radius: 0;
+}
+.generic_list_wrapper table.table_grid {
+	border-bottom: 1px solid #aaa;
+}
+
+div#editlang_desc {
+	margin-bottom: 8px;
+}
+.topic_details .smalltext {
+	font-size: 0.9em;
+}
+.table_grid tr.windowbg2 td.centercol, .table_grid tr.windowbg td.centercol {
+	text-align: center;
+}
+tr.windowbg, tr.windowbg2 {
+	box-shadow: none;
+}
+#postmodify #message{
+	width: 100%;
+	box-sizing: border-box;
+}
+#postmodify .lastedit{
+	font-weight: bold;
+}
+
+/* Colors for background of posts requiring approval */
+#forumposts .approvebg {
+	color: #222;
+	background: #ffeaea;
+}
+#forumposts .approvebg2 {
+	color: #222;
+	background: #fff2f2;
+}
+
+div#manage_boards dl dd textarea[name=desc] {
+	margin-top: 1px;
+}
+
+.bold_text {
+	font-weight: bold;
+}
+
+/* Can i haz this? I think we need Illori here to say "nope" */
+.title_top {
+	margin-top: 10px !important;
+}
+
+/* Profile > This needed for responsive (get rid of <br>) */
+.infolinks {
+	display: block;
+}
+#groups .windowbg, #groups .windowbg2 {
+	box-shadow: none;
+	border-radius: 0;
+	border-top: 0;
+	margin: 0;
+}
+#groups .padding {
+	margin: 0 0 25px 0;
+}
+
+/* BoardIndex */
+/* This place covers board places (boardindex-messageindex) */
+h3 .collapse {
+	float: right;
+	margin: 4px 4px 0 0;
+}
+.cat_bar .desc {
+	color: #FFF;
+}
+div.icon span {
+	background: url(../images/boardicons.png) no-repeat 0 0;
+	display: inline-block;
+	width: 45px;
+	height: 45px;
+}
+div.icon span.board_on {
+	background-position: 0 0;
+}
+div.icon span.board_on2 {
+	background-position: -45px 0;
+}
+div.icon span.board_off {
+	background-position: 0 -45px;
+}
+div.icon span.board_redirect {
+	background-position: -45px -45px;
+}
+div.icon {
+	float: left;
+	width: 5%;
+	text-align: center;
+	padding: 8px 0 0 0;
+	min-width: 60px;
+}
+div.info {
+	float: left;
+	width: 50%;
+	margin: 10px 0 5px 0;
+}
+div.info .subject {
+	font-weight: 600;
+	font-size: 1.1em;
+	color: #A85400;
+}
+div.stats {
+	width: 14%;
+	float: left;
+	padding: 7px;
+	font-size: 0.9em;
+}
+div.stats p {
+	border-left: 1px solid #DDD;
+	border-right: 1px solid #DDD;
+	text-align: center;
+	min-height: 3em;
+	margin: 3px 0 0;
+}
+div.lastpost {
+	width: 25%;
+	float: left;
+	padding-top: 7px;
+	font-size: 0.9em;
+}
+div.lastpost p {
+	margin: 3px 0 0 0;
+}
+#boardindex_table .icon, #boardindex_table .info, #boardindex_table .stats, #boardindex_table .lastpost {
+	min-height: 4.5em;
+}
+.main_container {
+	margin-bottom: 20px;
+}
+.up_contain {
+	overflow: hidden;
+	box-sizing: border-box;
+	border: 1px solid #DDD;
+	margin-bottom: 3px;
+	margin-top: -1px;
 }
-
-dl.register_form dt
-{
-	font-weight: normal;
+/* Child boards */
+.children {
+	width: 100%;
 	float: left;
-	clear: both;
-	width: 50%;
-	margin: 0.5em 0 0 0;
+	border-top: 1px solid #DDD;
+	padding: 5px;
 }
-
-dl.register_form dt strong
-{
-	font-weight: bold;
+.children p {
+	font-size: 0.9em;
 }
-
-dl.register_form dt span
-{
-	display: block;
+p.moderators {
+	font-size: 0.9em;
+	font-weight: bold;
 }
-
-dl.register_form dd
-{
+span.postby {
+	width: 100%;
 	float: left;
-	width: 49%;
-	margin: 0.5em 0 0 0;
 }
-
-#confirm_buttons
-{
-	text-align: center;
-	padding: 1em 0;
+/* Info Center */
+#info_center {
+	clear: both;
 }
-
-.coppa_contact
-{
-	padding: 4px;
-	width: 32ex;
-	background-color: #fff;
-	color: #000;
-	margin-left: 5ex;
-	border: 1px solid #000;
+#info_center .sub_bar {
+	border-top: 1px solid #ddd;
 }
-
-.valid_input
-{
-	background-color: #f5fff0;
+#info_center .sub_bar:first-child {
+	border-top: none;
 }
-.invalid_input
-{
-	background-color: #fff0f0;
+#upshrinkHeaderIC {
+	margin-top: 4px;
 }
-
-/* Styles for maintenance mode.
-------------------------------------------------------- */
-#maintenance_mode
-{
-	width: 75%;
-	min-width: 520px;
-	text-align: left;
+#ic_recentposts {
+	line-height: 1.6em;
+	width: 98%;
+	margin: -2px 0 0 23px;
+	font-size: 0.9em;
 }
-#maintenance_mode img.floatleft
-{
-	margin-right: 1em;
+#ic_recentposts td {
+	border-top: 1px solid #eaeaea;
+	padding: 0 4px;
+	vertical-align: top;
 }
-
-/* common for all admin sections */
-h3.titlebg img
-{
-	vertical-align: middle;
-	margin-right: 0.5em;
-	margin-top: -1px;
+#ic_recentposts tr:first-child td {
+	border-top: none;
 }
-tr.titlebg td
-{
-	padding-left: 0.7em;
+#ic_recentposts .recentpost strong {
+	width: 40%;
 }
-#admin_menu
-{
-	min-height: 2em;
-	padding-left: 0;
+#ic_recentposts .recentposter {
+	width: 15%;
 }
-#admin_content
-{
-	clear: left;
-	padding-top: 0.5em;
+#ic_recentposts .recentboard {
+	width: 20%;
 }
-/* Custom profile fields like to play with us some times. */
-#admin_content .custom_field
-{
-	margin-bottom: 15px;
+#ic_recentposts .recenttime {
+	width: 25%;
 }
-#admin_login .centertext
-{
-	padding: 1em;
+#ic_recentposts .recenttime strong {
+	color: #555;
 }
-#admin_login .centertext .error
-{
-	padding: 0 0 1em 0;
+#ic_recentposts .windowbg {
+	background: none;
 }
-
-/* Styles for sidebar menus.
-------------------------------------------------------- */
-.left_admmenu, .left_admmenu ul, .left_admmenu li
-{
-	padding: 0;
+#upshrinkHeaderIC p.inline {
+	border: none;
 	margin: 0;
-	list-style: none;
+	padding: 2px 29px;
+	line-height: 1.6em;
+	font-size: 0.9em;
 }
-#left_admsection
-{
-	width: 160px;
-	float: left;
-	padding-right: 10px;
+#upshrinkHeaderIC p.inline span {
+	margin: 0;
+	padding: 4px 0 0 0;
 }
-.adm_section h4.titlebg
-{
-	font-size: 95%;
-	margin-bottom: 5px;
+#upshrinkHeaderIC span.membergroups {
+	display: block;
 }
-#main_container
-{
-	position: relative;
+
+/* MessageIndex */
+/* Topic list */
+#topic_container .windowbg, #topic_container .windowbg2 {
+	height: 4em;
+	border: 1px solid #ddd;
+	border-top: none;
 }
-.left_admmenu li
-{
-	padding: 0 0 0 0.5em;
+#topic_header {
+	height: 2em;
 }
-.left_admmenu
-{
-	margin-bottom: 0.5em;
+#topic_header .icon, #topic_header .info, #topic_header .stats, #topic_header .lastpost, #topic_header .moderation {
+	height: 1.5em !important;
+	font-weight: bold;
+	font-size: 1em;
+	margin-top: 3px;
+	margin-bottom: 0;
+	padding: 0;
 }
-#main_admsection
-{
-	position: relative;
-	left: 0;
-	right: 0;
-	overflow: hidden;
+#topic_header.title_bar {
+	margin: 0px;
+	border-radius: 0;
 }
-
-tr.windowbg td, tr.windowbg2 td, tr.approvebg td, tr.highlight2 td
-{
-	padding: 0.3em 0.7em;
+#messageindex .stats, #recent .stats {
+	text-align: center;
 }
-#credits p
-{
+#topic_header input {
+	margin-top: 5px !important;
+}
+.moderation {
+	float: right;
+	width: 35px;
+	margin: 5px 0 0 0;
+}
+#topic_container .icon, #topic_container .info, #topic_container .windowbg2, #topic_container .windowbg, #topic_container .stats, #topic_container .lastpost {
+	box-shadow: none;
+	border-radius: 0;
 	padding: 0;
-	font-style: italic;
 	margin: 0;
+	overflow: hidden;
+	height: 3.5em;
 }
-
-/* Styles for generic tables.
-------------------------------------------------------- */
-.topic_table table
-{
-	width: 100%;
-}
-.topic_table .icon1, .topic_table .icon2, .topic_table .stats
-{
-	text-align: center;
+#topic_container .icons span {
+	margin: 2px 0 0 5px;
 }
-#topic_icons
-{
-	margin: 1em 0 0 0;
+.icon img, .moderation input {
+	margin-top: 15px;
 }
-#topic_icons .description
-{
-	margin: 0;
+.info .icons, #messageindex .stats p, .lastpost p, #unread .stats p, #unreadreplies .stats p {
+	margin-top: 5px;
+	border: none;
 }
-.topic_table table thead
-{
-	border-bottom: 1px solid #fff;
+/* Start with description and other things */
+#description_board {
+	padding: 8px 10px 8px 10px;
+	border-bottom-left-radius: 0;
+	border-bottom-right-radius: 0;
+	border-bottom: 0;
+	box-shadow: none;
 }
-/* the subject column */
-.topic_table td
-{
-	font-size: 1em;
+.lastpost span.last_post {
+	float: right;
+	margin: 4px;
 }
-.topic_table td.subject p, .topic_table td.stats
-{
-	font-size: 0.85em;
+select.qaction {
 	padding: 0;
-	margin: 0;
 }
-.topic_table td.lastpost
-{
-	font-size: 0.85em;
-	line-height: 1.3em;
-	padding: 4px;
+#quick_actions {
+	padding-right: 4px;
+	margin-top: 5px;
 }
-.topic_table td.stickybg2
-{
-	background-image: url(../images/icons/quick_sticky.gif);
-	background-repeat: no-repeat;
-	background-position: 98% 4px;
+.qaction_cell .button_submit {
+	margin: 2px 4px 0 4px;
 }
-.topic_table td.lockedbg2
-{
-	background-image: url(../images/icons/quick_lock.gif);
-	background-repeat: no-repeat;
-	background-position: 98% 4px;
+#topic_icons {
+	margin-top: 10px;
+	float: left;
+	width: 100%;
 }
-.topic_table td.locked_sticky2
-{
-	background-image: url(../images/icons/quick_sticky_lock.gif);
-	background-repeat: no-repeat;
-	background-position: 98% 4px;
+#topic_icons .information {
+	border-radius: 7px;
 }
-.topic_table td.lastpost
-{
-	background-image: none;
+#topic_icons p {
+	line-height: 2em;
+}
+#topic_icons p.floatleft {
+	padding: 0 12px 2px 0;
+}
+/* Just to correct Fred there without requiring an extra image. Should make a new Fred with clear padding. */
+#topic_icons p.floatleft img:first-child {
+	padding: 0 2px;
+}
+#message_index_jump_to_select {
+	font-size: 1em;
+	padding: 2px;
+}
+#message_index_jump_to .button_submit {
+	padding: 4px 6px 2px 6px;
 }
 
-/* Styles for (fatal) errors.
-------------------------------------------------- */
+/* Display */
+/* Poll question */
+#poll {
+	overflow: hidden;
+}
 
-#fatal_error
-{
-	width: 80%;
-	margin: auto;
+/* Poll vote options */
+#poll_options ul.options {
+	padding: 12px 30px 0 25px;
+}
+#poll_options div.submitbutton {
+	clear: both;
+	padding: 0 0 12px 0;
 }
 
-.errorbox
-{
-	padding: 1em;
-	border: 1px solid #cc3344;
-	color: #000;
-	background-color: #ffe4e9;
-	margin-bottom: 1em;
+/* Poll results */
+#poll_options dl.options {
+	padding: 12px 0 12px 25px;
+	line-height: 1.4em;
 }
-.errorbox h3
-{
-	padding: 0;
+#poll_options dl.options dt {
+	padding: 4px 0;
+	width: 30%;
+	max-width: 30em;
+	float: left;
 	margin: 0;
-	font-size: 1.1em;
-	text-decoration: underline;
+	clear: left;
 }
-.errorbox p
-{
-	margin: 1em 0 0 0;
+#poll_options dl.options .voted {
+	font-weight: bold;
 }
-.errorbox p.alert
-{
-	padding: 0;
-	margin: 0;
+#poll_options dl.options dd {
+	width: 60%;
+	max-width: 45em;
 	float: left;
-	width: 1em;
-	font-size: 1.5em;
+	margin: 0 0 4px 0;
+	padding: 0;
+	line-height: 1.4em;
+	min-height: 1.4em;
+	background: #fff;
+	border: 1px solid #aaa;
+	border-radius: 2px;
+	position: relative;
+}
+/* Absolute positioning stops these breaking the bars on narrow screens. */
+#poll_options dl.options .percentage {
+	display: block;
+	float: right;
+	margin: -2px;
+	padding: 0 2px;
+	position: absolute;
+	right: 0;
+	top: 0;
+	z-index: 2;
+	background: none;
+	white-space: pre;
 }
 
-/* Styles for the profile section.
-------------------------------------------------- */
+/* Poll notices */
+#poll_options p {
+	margin: 0 18px 2px 18px;
+	padding: 0 6px 6px 6px;
+}
 
-dl
-{
-	overflow: auto;
+div#pollmoderation {
 	margin: 0;
 	padding: 0;
+	overflow: auto;
 }
 
-/* The basic user info on the left */
-#basicinfo
-{
-	width: 20%;
-	float: left;
+#poll_options .submitbutton {
+	float: right;
+	width: 100%;
 }
-#basicinfo .windowbg .content
-{
-	padding-left: 20px;
+/* Styles for edit poll section. */
+#edit_poll {
+	overflow: hidden;
 }
-#detailedinfo
-{
-	width: 79.5%;
-	float: right;
+#edit_poll fieldset {
+	padding: 6px;
+	clear: both;
+	overflow: hidden;
 }
-#basicinfo h4
-{
-	font-size: 135%;
-	font-weight: 100;
-	line-height: 105%;
-	white-space: pre-wrap;
+#edit_poll fieldset input {
+	margin-left: 7.5em;
+}
+#edit_poll ul.poll_main li {
+	padding-left: 12px;
+}
+#edit_poll ul.poll_main input {
+	margin-left: 12px;
+}
+#edit_poll ul.poll_main, dl.poll_options {
 	overflow: hidden;
+	padding: 0 0 8px 8px;
 }
-#basicinfo h4 span.position
-{
-	font-size: 80%;
-	font-weight: 100;
-	display: block;
+#edit_poll ul.poll_main li {
+	margin: 2px 0;
 }
-#basicinfo img.avatar
-{
-	display: block;
-	margin: 10px 0 0 0;
+#edit_poll dl.poll_options dt {
+	width: 33%;
+	padding: 0 0 0 12px;
 }
-#basicinfo ul
-{
-	list-style-type: none;
-	margin: 10px 0 0 0;
+#edit_poll dl.poll_options dd {
+	width: 65%;
 }
-#basicinfo ul li
-{
-	display: block;
-	float: left;
-	margin-right: 5px;
-	height: 20px;
+#edit_poll dl.poll_options dd input {
+	margin-left: 0;
 }
-#basicinfo span#userstatus
-{
-	display: block;
+/* On to the posts */
+#forumposts {
 	clear: both;
+	margin: 8px 0 0 0;
 }
-#basicinfo span#userstatus img
-{
-	vertical-align: middle;
+#forumposts .cat_bar {
+	margin: 0 0 -4px 0;
 }
-#detailedinfo div.content dl, #tracking div.content dl
-{
-	clear: right;
-	overflow: auto;
-	margin: 0 0 18px 0;
-	padding: 0 0 15px 0;
-	border-bottom: 1px #ccc solid;
+/* Topic information */
+#forumposts .catbg img {
+	margin: 0 4px -2px 0;
 }
-#detailedinfo div.content dt, #tracking div.content dt
-{
-	width: 35%;
-	float: left;
-	margin: 0 0 3px 0;
-	padding: 0;
-	font-weight: bold;
+#forumposts .catbg span {
+	white-space: pre;
+	/* Specific sizing for clarity without ClearType. */
+	font-size: 0.818em;
+	font-weight: normal;
+	padding: 2px 0;
+}
+/* poster and postarea + moderation area underneath */
+.post_wrapper::after {
+	content:"";
+	display: block;
 	clear: both;
 }
-#detailedinfo div.content dd, #tracking div.content dd
-{
-	width: 65%;
+/* poster details and list of items */
+.poster {
 	float: left;
-	margin: 0 0 3px 0;
+	/* Don't set this in em.It will eat too much space if people need to set large text sizes. */
+	/* Better to just break the few words here, and leave more space for actual topic content. */
+	width: 160px;
+	word-break: hyphenate;
+	word-wrap: break-word;
+}
+.poster h4 {
+	font-size: 1.2em;
+}
+.poster h4, .poster h4 a, .poster li:hover h4 a, .poster h4 a:hover .poster li h4 a, .poster h4 a:focus {
+	margin: 0;
 	padding: 0;
+	color: #c06002;
 }
-#detailedinfo div.content dl.noborder
-{
-	border-bottom: 0;
+
+.poster .profile .profile_icons li, .poster .im_icons li {
+	display: table-cell;
+	padding-right: 5px;
 }
-#detailedinfo div.content dt.clear
-{
-	width: 100%;
+
+/* The visible stuff below the avatar. */
+.user_info > li {
+	margin: 3px 0 0 0;
 }
-.signature, .custom_fields_above_signature
-{
-	border-top: 1px #ccc solid;
+.poster li.membergroup {
+	font-weight: bold;
 }
-.signature h5
-{
-	font-size: 0.85em;
-	margin-bottom: 10px;
+/* @todo Re-code this a bit to give background on anchor. */
+.poster li.poster_online, .poster li.poster_online:hover {
+	padding: 1px 1px 1px 1px;
+	margin: 3px 10px;
 }
-#personal_picture
-{
-	display: block;
-	margin-bottom: 0.3em;
+.poster li.poster_online a {
+	color: #C06002;
+	line-height: 1.6em;
 }
-#avatar_server_stored div
-{
-	float: left;
+.poster li.poster_online:hover, .poster li.poster_online:hover a {
+	text-decoration: underline;
 }
-#avatar_upload
-{
-	overflow: auto;
+.poster li.warning a img {
+	vertical-align: bottom;
+	padding: 0 2px;
 }
-#main_admsection #basicinfo, #main_admsection #detailedinfo
-{
-	width: 100%;
+.poster img {
+	vertical-align: middle;
 }
-#main_admsection #basicinfo h4
-{
-	float: left;
-	width: 35%;
+.postarea, .moderatorbar {
+	margin: 0 0 0 175px;
 }
-#main_admsection #basicinfo img.avatar
-{
-	float: right;
-	vertical-align: top;
+.postarea div.flow_hidden {
+	width: 100%;
 }
-#main_admsection #basicinfo ul
-{
-	clear: left;
+.moderatorbar {
+	clear: right;
 }
-#main_admsection #basicinfo span#userstatus
-{
-	clear: left;
+.messageicon {
+	float: left;
+	margin: -5px 6px -6px 0;
 }
-#main_admsection #basicinfo p#infolinks
-{
-	display: none;
-	clear: both;
+.messageicon img {
+	padding: 0 3px 0 3px;
 }
-#main_admsection #basicinfo .botslice
-{
-	clear: both;
+.keyinfo h5 {
+	padding: 1px 0 5px 0;
+	line-height: 1.5em;
+	font-size: 0.9em;
 }
-
-/* Simple feedback messages */
-div#profile_error, div#profile_success
-{
-	margin: 0 0 1em 0;
-	padding: 1em 2em;
-	border: 1px solid;
+.keyinfo h5 a, .keyinfo h5 a strong {
+	color: #ad6825;
 }
-div#profile_error
-{
-	border-color: red;
-	color: red;
-	background: #fee;
+.keyinfo h5 a.floatright {
+	padding: 0 12px 0 0; /* Deprecated? */
 }
-
-div#profile_error span
-{
-	text-decoration: underline;
+.keyinfo h5 .modified {
+	float: right;
+	color: #333;
+	font-weight: normal;
+	padding: 2px 4px 0 4px;
 }
-
-div#profile_success
-{
-	border-color: green;
-	color: green;
-	background: #efe;
+.subject_title a {
+	font-size: 0.9em;
+	color: #333;
+	font-weight: bold;
 }
-
-/* Profile statistics */
-#generalstats div.content dt
-{
-	width: 50%;
-	float: left;
-	margin: 0 0 3px 0;
-	padding: 0;
+.page_number {
+	color: #ad6825;
 	font-weight: bold;
-	clear: both;
+	opacity: 0.4;
 }
-#generalstats div.content dd
-{
-	width: 50%;
-	float: left;
-	margin: 0 0 3px 0;
-	padding: 0;
+.inner {
+	padding: 7px 8px 2px 2px;
+	margin: 0;
+	border-top: 1px solid #bfbfbf;
+	box-shadow: 0 1px 0 #fff inset;
+	min-height: 85px;
+	word-break: hyphenate;
+	word-wrap: break-word;
 }
-
-/* Activity by time */
-#activitytime
-{
-	margin: 6px 0;
+img.smiley {
+	vertical-align: bottom;
 }
-.activity_stats
-{
-	margin: 0;
-	padding: 0;
-	list-style: none;
+.attachments {
+	padding: 12px 0 0 0;
 }
-.activity_stats li
-{
-	margin: 0;
-	padding: 0;
-	width: 4.16%;
-	float: left;
+.attachments .floatleft {
+	padding: 0 6px 8px 6px;
 }
-.activity_stats li span
-{
-	display: block;
-	border: solid #000;
-	border-width: 1px 1px 0 0;
+.attachments_top {
+	margin: 0 auto;
 	text-align: center;
 }
-.activity_stats li.last span
-{
-	border-right: none;
+.attachments hr {
+	clear: both;
+	margin: 12px 0;
 }
-.activity_stats li div.bar
-{
-	margin: 0 auto;
-	width: 15px;
+/* Separator of posts. More useful in the print stylesheet. */
+#forumposts .post_separator {
+	display: none;
 }
-.activity_stats li div.bar div
-{
-	background: #6294CE;
+/* Next and previous topic links */
+.nextlinks {
+	text-transform: capitalize;
 }
-.activity_stats li div.bar span
-{
-	position: absolute;
-	top: -1000em;
-	left: -1000em;
+/* Styles for the quick reply area. */
+#quickreplybox {
+	clear: both;
 }
-
-/* Most popular boards by posts and activity */
-#popularposts
-{
-	width: 49.5%;
-	float: left;
+#quickReplyOptions .roundframe {
+	margin: 0;
+	padding: 8px 10% 12px 10%;
+	overflow: auto;
+	border-top-left-radius: 0;
+	border-top-right-radius: 0;
 }
-#popularactivity
-{
-	width: 49.5%;
+#quickReplyExpand {
 	float: right;
+	margin: 2px 2px 0 2px;
 }
-
-#popularposts div.content dt, #popularactivity div.content dt
-{
-	width: 65%;
+/* Styles for edit post section */
+form#postmodify .roundframe {
+	padding: 12px 12%;
+	margin: 12px 0 0 0;
+}
+#post_header {
+	padding: 6px;
+	overflow: hidden;
+}
+#post_header dt {
 	float: left;
-	margin: 0 0 3px 0;
 	padding: 0;
+	width: 15%;
+	margin: 6px 0 0 0;
 	font-weight: bold;
-	clear: both;
 }
-#popularposts div.content dd, #popularactivity div.content dd
-{
-	width: 35%;
+#post_header dd {
 	float: left;
-	margin: 0 0 3px 0;
 	padding: 0;
+	width: 83%;
+	margin: 4px 0;
 }
-
-.profile_pie
-{
-	background-image: url(../images/stats_pie.png);
-	float: left;
-	height: 20px;
-	width: 20px;
-	margin: 0 1em 0 0;
-	padding: 0;
-	text-indent: -1000em;
+#post_header img {
+	vertical-align: middle;
 }
-
-/* View posts */
-.topic .time
-{
-	float: right;
+ul.post_options {
+	margin: 0 0 0 12px;
+	padding: 0;
+	overflow: hidden;
 }
-
-.counter
-{
-	margin: 0 0 0 0;
-	padding: 0.2em 0.5em 0.1em 0.2em;
-	font-size: 2.2em;
-	font-weight: bold;
-	color: #3f3f3f;
+ul.post_options li {
+	margin: 2px 0;
+	width: 49%;
 	float: left;
 }
-.list_posts
-{
-	border-top: 2px solid #b3b3bf;
-	padding-top: 12px;
-	margin-top: 6px;
-	overflow: auto;
-}
-
-.core_posts
-{
-	margin-bottom: 3px;
-}
-
-.topic h4
-{
-	margin: 3px 0;
-}
-
-.topic .post
-{
-	margin: 0 1em;
-	min-height: 80px;
-	height: auto !important;
-	height: 80px;
-}
-
-.topic .mod_icons
-{
-	text-align: right;
-	margin-right: 1em;
+#postAdditionalOptionsHeader {
+	margin-top: 0.5em;
 }
-
-#tracking div.content dl
-{
-	border-bottom: 0;
-	margin: 0;
-	padding: 0;
+#postAdditionalOptions {
+	overflow: hidden;
 }
-
-#creator dl
-{
-	margin: 0;
+#postMoreOptions, #postAttachment, #postAttachment2 {
+	border-top: 1px solid #ddd;
+	margin: -1px 0 0 0;
+	padding: 10px;
 }
-#creator dt
-{
-	width: 40%;
-	float: left;
-	clear: both;
-	margin: 0 0 10px 0;
+#postAttachment dd {
+	margin: 2px 12px;
 }
-#creator dd
-{
-	float: right;
-	width: 55%;
-	margin: 0 0 10px 2px;
-	overflow: auto;
+#postAttachment2 dd {
+	margin: 4px 12px;
 }
-
-.ignoreboards
-{
-	margin: 0 2%;
-	padding: 0;
+#postAttachment dd {
 	width: 45%;
+	float: left;
 }
-.ignoreboards a
-{
+#postAttachment dt, #postAttachment2 dt {
 	font-weight: bold;
-	border-bottom: 1px solid #c4c4c4;
-	padding: 0.1em 0;
 }
-.ignoreboards a:hover
-{
-	text-decoration: none;
-	border-bottom: 1px solid #334466;
+#postDraftOptions {
+	background: #fdfdfd;
+	border: 1px solid #aaa;
+	border-left: 1px solid #bbb;
+	border-top: none;
+	border-radius: 0 0 4px 4px;
 }
-.ignoreboards ul
-{
+#postDraftOptions .settings dd, #postDraftOptions .settings dt{
+	width: 50%;
+	border-top: 1px solid #e4e4e4;
+	padding: 5px 10px;
 	margin: 0;
-	padding: 0;
-}
-.ignoreboards li
-{
-	list-style: none;
-	float: left;
-	clear: both;
 }
-.ignoreboards li.category
-{
-	margin: 0.7em 0 0 0;
-	width: 100%;
+#postDraftOptions .settings dd:first-of-type, #postDraftOptions .settings dt:first-child{
+	border-top: none; /* Some people are OCD, like me. :P */
 }
-.ignoreboards li ul
-{
-	margin: 0.2em 0 0 0;
+#postDraftOptions .settings strong{
+	color: #555;
 }
-.ignoreboards li.category ul li.board
-{
-	width: 93%;
+#post_confirm_strip /* < That may be deprecated. */, #shortcuts {
+	padding: 12px 0;
 }
-
-#theme_settings
-{
-	overflow: auto;
-	margin: 0;
-	padding: 0;
+#post_confirm_buttons .smalltext {
+	padding: 0 10px;
 }
-
-#theme_settings li
-{
-	list-style: none;
-	margin: 10px 0;
-	padding: 0;
+.post_verification {
+	margin-top: 6px;
 }
-/* Paid Subscriptions */
-#paid_subscription
-{
-	width: 100%;
+.post_verification #verification_control {
+	margin: 4px 0 4px 12px;
 }
-#paid_subscription dl.settings
-{
-	margin-bottom: 0;
+/* The BBC buttons */
+#bbcBox_message {
+	margin: 10px 6px;
 }
-#paid_subscription dl.settings dd, #paid_subscription dl.settings dt
-{
-	margin-bottom: 4px;
+#bbcBox_message div {
+	margin: 2px 0;
+	vertical-align: top;
 }
-/* Pick theme */
-#pick_theme
-{
-	width: 100%;
-	float: left;
+#bbcBox_message div img {
+	margin: 0 1px 0 0;
+	vertical-align: top;
 }
-/*Issue a warning*/
-#warn_body{
-	width: 80%;
-	font-size: 0.9em;
+#bbcBox_message select {
+	margin: 0 2px;
 }
-
-/* Styles for the statistics center.
-------------------------------------------------- */
-#statistics
-{
-	padding: 0.5em 0;
+/* The smiley strip */
+#smileyBox_message {
+	margin: 6px;
 }
-#statistics div.title_bar
-{
-	margin: 4px 0 -2px 0;
+/* All the signatures used in the forum. If your forum users use Mozilla, Opera, or Safari, you might add max-height here ;). */
+.signature, .attachments, .under_message, .custom_fields_above_signature {
+	width: 100%;
+	overflow: auto;
+	clear: right;
+	padding: 12px 0 3px 0;
+	border-top: 1px solid #bfbfbf;
+	box-shadow: 0 1px 0 #fff inset;
+	line-height: 1.4em;
+	font-size: 0.9em;
+	box-sizing: border-box;
 }
-#statistics h3.catbg
-{
-	text-align: center;
+.under_message {
+	overflow: visible;
 }
-#statistics div.content
-{
-	min-height: 210px;
+.under_message::after {
+	clear: both;
+	content: "";
+	display: block;
 }
-#statistics div.top_row
-{
-	min-height: 150px;
+/* Events */
+.edit_event {
+	margin: 0 10px;
+	vertical-align: top;
 }
-#stats_left, #top_posters, #top_topics_replies, #top_topics_starter
-{
+/* ModerationButtons */
+#moderationbuttons {
 	float: left;
-	width: 49.5%;
 }
-#stats_right, #top_boards, #top_topics_views, #most_online
-{
-	float: right;
-	width: 49.5%;
+#moderationbuttons_strip {
+	float: left;
+	margin: 4px 0 4px -4px;
 }
-dl.stats
-{
-	clear: both;
-	overflow: hidden;
+#moderationbuttons ul li {
+	padding: 0 6px 4px 0;
 	margin: 0;
-	padding: 0;
 }
-dl.stats dt
-{
-	width: 49%;
-	float: left;
-	margin: 0 0 4px 0;
-	line-height: 16px;
+
+/* General Classes */
+/* Cat_bar / catbg */
+div.cat_bar {
+	background: #557ea0;
+	border-bottom: 1px solid #777;
 	padding: 0;
-	clear: both;
-	font-size: 1em;
+	border-radius: 6px 6px 0 0;
+	box-shadow: 0 16px 20px rgba(255,255,255,0.15) inset;
+	text-shadow: -1px -1px 1px rgba(0,0,0,0.2);
+	box-sizing: border-box;
+	margin-bottom: 1px;
 }
-dl.stats dd
-{
-	text-align: right;
-	width: 50%;
-	font-size: 1em;
-	float: right;
-	margin: 0 0 4px 0;
-	line-height: 16px;
-	padding: 0;
+.cat_bar h3 {
+	padding: 8px 12px 6px 12px;
 }
-.statsbar div.bar
+/* Styles for rounded headers. */
+.cat_bar .desc
 {
-	float: left;
-	background: url(../images/bar_stats.png) no-repeat;
-	display: block;
-	margin: 0 4px;
-	height: 16px;
+	font-size: 10px;
+	line-height: 1.5em;
+	font-weight: normal;
+	margin: -8px 0 4px 12px;
 }
-.statsbar div.bar div
-{
-	position: relative;
-	right: -4px;
-	padding: 0 4px 0 0;
-	background: url(../images/bar_stats.png) no-repeat 100%;
-	height: 16px;
+h3.catbg {
+	overflow: hidden;
+	font-size: 1.1em;
+	font-family: "Tahoma", sans-serif;
+	font-weight: bold;
+	line-height: 1.5em;
+	padding: 8px;
+	background: none;
 }
-tr.windowbg2 th.stats_month
-{
-	width: 25%;
-	padding: 0 2em;
-	text-align: left;
+h3.catbg, h3.catbg a:link, h3.catbg a:visited, h3.catbg a:hover {
+	color: #fff;
 }
-tr.windowbg2 td.stats_day
-{
-	padding: 0 3.5em;
-	text-align: left;
+h3.catbg a:hover {
+	text-shadow: -1px -1px 0 rgba(0, 0, 0, 0.4);
+	text-decoration: none;
 }
-
-/* Styles for the personal messages section.
-------------------------------------------------- */
-
-#personal_messages h3 span#author, #personal_messages h3 span#topic_title
-{
-	float: left;
+h3.catbg .icon {
+	vertical-align: middle;
+	margin: 0 5px 0 0;
 }
-#personal_messages h3 span#author
-{
-	margin: 0 0 0 0.5em;
+/* Roundframe */
+.roundframe {
+	box-sizing: border-box;
+	margin: 10px 0 0 0;
+	padding: 12px 16px;
+	background: #F8F8F8;
+	border: 1px solid #c5c5c5;
+	border-radius: 7px;
+	box-shadow: 0 -2px 2px rgba(0,0,0,0.1);
+	overflow: hidden;
 }
-#personal_messages h3 span#topic_title
-{
-	margin: 0 0 0 9em;
+/* TitleBar & SubBar */
+.title_bar {
+	border-right: 1px solid #ddd;
+	border-left: 1px solid #ddd;
+	border-top: 2px solid #ff9400;
+	border-bottom: 2px solid #bf6900;
+	background: #fff;
+	color: #666;
+	border-radius: 2px 2px 0 0;
+	text-align: left;
+	margin: 5px 0 0 0;
 }
-#personal_messages div.labels
-{
-	padding: 0 1em 0 0;
+.sub_bar {
+	border-bottom: 1px solid #ddd;
+	text-shadow: none;
+	background: none;
+	box-shadow: 0 -1px 0 #999 inset;
+	clear: both;
 }
-#personal_messages .capacity_bar
-{
-	background: #f0f4f7;
-	display: block;
-	margin: 0.5em 0 0 1em;
-	height: 1em;
-	border: 1px solid #adadad;
-	width: 10em;
+h3.titlebg, h4.titlebg, .titlebg, h3.subbg, h4.subbg, .subbg {
+	background: none;
+	color: #555;
+	font-family: "Tahoma", sans-serif;
+	font-weight: bold;
+	overflow: hidden;
+	padding: 6px 12px 5px 12px;
+	text-shadow: none;
 }
-#personal_messages .capacity_bar span
-{
-	border-right: 1px solid #adadad;
-	display: block;
-	height: 1em;
+.titlebg a, .subbg a {
+	background: none;
+	color: #555;
+	text-decoration: none;
 }
-#personal_messages .capacity_bar span.empty
-{
-	background: #a6d69d;
+
+/* Other */
+/* Information */
+.information {
+	background: #F8F8F8;
+	overflow: auto;
+	padding-bottom: .5em;
+	border: 1px solid #ddd;
+	border-top: none;
+	border-radius: 0 0 7px 7px;
+	margin: 0 0 10px 0;
+	padding: 12px 9px 8px 9px;
+	box-sizing: border-box;
 }
-#personal_messages .capacity_bar span.filled
-{
-	background: #eea800;
+.generic_list_wrapper .information div {
+	background: none;
 }
-#personal_messages .capacity_bar span.full
-{
-	background: #f10909;
+.information a {
+	font-weight: bold;
 }
-#personal_messages .reportlinks
-{
-	padding: 0.5em 1.3em;
+p.information img {
+	vertical-align: middle;
 }
-#searchLabelsExpand li
-{
-	padding: 0.3em 0.5em;
+#messageindex .information, #topic_container .info {
+	border-radius: 0;
+	margin: 0;
 }
-#manrules div.righttext
-{
-	padding: 0.3em 0.1em;
+#topic_icons .information,
+#messageindex .information {
+	border-top: 1px solid #ddd;
 }
-dl.addrules dt.floatleft
-{
-	width: 15em;
-	color: #333;
-	padding: 0 1.25em 0.5em 1.25em;
+/* Mentions */
+.atwho-view {
+	position:absolute;
+	top: 0;
+	left: 0;
+	display: none;
+	margin-top: 18px;
+	background: white;
+	border: 1px solid #DDD;
+	border-radius: 3px;
+	box-shadow: 0 0 5px rgba(0,0,0,0.1);
+	min-width: 120px;
+	z-index: 11110 !important;
 }
-#addrule fieldset
-{
-	clear: both;
+.atwho-view .cur {
+	background: #3366FF;
+	color: white;
 }
-
-/* Styles for the calendar section.
-------------------------------------------------- */
-.calendar_table
-{
-	margin-bottom: 0.7em;
+.atwho-view .cur small {
+	color: white;
 }
-
-/* Used to indicate the current day in the grid. */
-.calendar_today
-{
-	background-color: #fff;
+.atwho-view strong {
+	color: #3366FF;
 }
-
-#month_grid
-{
-	width: 200px;
-	text-align: center;
-	float: left;
+.atwho-view .cur strong {
+	color: white;
+	font-weight: bold;
 }
-#month_grid div.cat_bar
-{
-	height: 25px;
+.atwho-view ul {
+	list-style:none;
+	padding:0;
+	margin:auto;
 }
-#month_grid h3.catbg
-{
-	height: 25px;
-	line-height: 27px;
+.atwho-view ul li {
+	display: block;
+	padding: 5px 10px;
+	border-bottom: 1px solid #DDD;
+	cursor: pointer;
 }
-#month_grid table
-{
-	width: 200px;
+.atwho-view small {
+	font-size: smaller;
+	color: #777;
+	font-weight: normal;
 }
-#main_grid table
-{
-	width: 100%;
-	padding-bottom: 4px;
+/* On/Off Icons (User) */
+.on, .off {
+	width: 14px;
+	height: 14px;
+	border-radius: 12px;
+	border: 1px solid none;
+	position: absolute;
+	margin: 4px 0 0 0;
 }
-#main_grid table h3.catbg
-{
-	text-align: center;
-	height: 29px;
-	border-top: 2px solid #fff;
-	border-bottom: none;
+.on {
+	background: #99FF66;
 }
-#main_grid table.weeklist td.windowbg
-{
-	text-align: center;
-	height: 49px;
-	width: 25px;
-	font-size: large;
-	padding: 0 7px;
-	border-bottom: 2px solid #fff;
+.off {
+	background: grey;
 }
-#main_grid table.weeklist td.weekdays
-{
-	height: 49px;
-	width: 100%;
-	padding: 4px;
-	text-align: left;
-	vertical-align: middle;
-	border-bottom: 2px solid #fff;
+#whoFilter span.on, #whoFilter span.off {
+	margin: 3px 0 0 -5px !important;
 }
-#main_grid h3.weekly
-{
-	text-align: center;
-	padding-left: 0;
-	font-size: large;
-	height: 29px;
+#mlist span.on, #mlist span.off, #edit_buddies .on, #edit_buddies .off {
+	margin: -5px 0 0 10px;
 }
-#main_grid h3 span.floatleft, #main_grid h3 span.floatright
-{
-	display: block;
-	font-weight: bold;
+#mlist .pm_icon, #edit_buddies .pm_icon {
+	margin: 0 !important;
 }
-#main_grid table th.days
-{
-	width: 14%;
-	padding: 4px 0;
+#userstatus .smalltext, .pm_icon {
+	margin: 0 0 0 20px !important;
 }
-#main_grid table.weeklist h4.titlebg
-{
-	margin: 0 0 0 0;
-	height: 23px;
-	line-height: 27px;
+
+/* Styles for print media. */
+@media print {
+	#headerarea
+	{
+		display: none;
+	}
+
+	.tborder
+	{
+		border: none;
+	}
 }
-#main_grid table td.weeks
-{
-	vertical-align: middle;
-	text-align: center;
-	font-weight: bold;
-	font-size: large;
+/* Who */
+.action_who #upper_show {
+	margin-top: 6px;
 }
-#main_grid table td.days
-{
-	vertical-align: top;
-	text-align: center;
+.action_who #lower_pagesection {
+	margin-top: 4px;
 }
-
-a.modify_event
-{
-	color: red;
+.action_who #lower_pagelinks {
+	margin-top: -4px;
 }
-
-span.hidelink
-{
-	font-style: italic;
+.action_who select {
+	margin-top: -1px !important;
 }
 
-#calendar_navigation
-{
-	text-align: center;
+/* Icons (converted from img to css) */
+/* Stay here till I find a better place for you guys */
+h3.profile_hd {
+	background: url(../images/icons/profile_hd.png) 15px no-repeat;
+	padding: 8px 0 8px 50px;
+}
+.xx {
+	background: url(../images/post/xx.png) 2px no-repeat;
+	padding: 25px 6px 25px 18px;
+}
+
+/* Those classes are sharing exact same gradient. */
+/* Background of buttons */
+.button_submit, .button_reset, .button_link, .topbottom,
+.dropmenu li ul, .top_menu, .dropmenu li li:hover, .button,
+.dropmenu li li:hover>a, .dropmenu li li a:focus, .dropmenu li li a:hover,
+#top_section, #search_form .button_submit, .quickbuttons li,
+.quickbuttons li ul, .quickbuttons li ul li:hover, .quickbuttons ul li a:focus,
+.popup_window, #inner_section {
+	background: #FFFFFF; /* fallback for some browsers */
+	background-image: linear-gradient(to bottom, #E2E9F3 0%, #FFFFFF 70%);
+}
+/* Well some of them has different gradient effect on hover */
+.button:hover, .button_submit:hover, .button_reset:hover, .button_link:hover,
+.topbottom:hover,#search_form .button_submit:hover, .quickbuttons li:hover {
+	background: #FFFFFF;
+	background-image: linear-gradient(to bottom, #FFFFFF 0%, #E2E9F3 70%);
+}
+/* If it fits I sits... */
+.navigate_section ul, .popup_content, .up_contain {
+	background: #FFFFFF;
+	background-image: linear-gradient(to bottom, #FFFFFF 0%, #F1F3F5 95%);
 }
 
-/* Styles for the memberlist section.
-------------------------------------------------- */
-#mlist_search
-{
-	margin: auto;
-	width: 500px;
+/* Topic/Board follow-alert menu */
+.notify_dropdown strong {
+	font-size: 1.1em;
 }
-
-/* Styles for the basic search section.
-------------------------------------------------- */
-#searchform, #simple_search p
-{
+.notify_dropdown a {
+	display: block;
 	padding: 0.5em;
-	margin: 0;
-}
-#simple_search, #simple_search p, #advanced_search
-{
-	text-align: center !important;
-	margin: 0;
 }
-#search_error
-{
-	font-style: italic;
-	padding: 0.3em 1em;
+.notify_dropdown a:hover {
+	text-decoration: none;
+	background: #eee;
 }
-#search_term_input
-{
-	font-size: 115%;
-	margin: 0 0 1em;
+.notify_dropdown span {
+	font-size: 0.9em;
 }
 
-/* Styles for the advanced search section.
-------------------------------------------------- */
-#searchform fieldset
-{
-	text-align: left;
-	padding: 0;
-	border: none;
-}
-#advanced_search dl#search_options
-{
-	margin: 0 auto;
-	width: 600px;
-	padding-top: 1em;
-	overflow: hidden;
-}
-#advanced_search dt
-{
+/* Some new stuff */
+#display_head {
 	clear: both;
-	float: left;
-	padding: 0.2em;
-	text-align: right;
-	width: 20%;
+	margin: -7px 0 15px 0;
 }
-#advanced_search dd
-{
-	width: 75%;
-	float: left;
-	padding: 0.2em;
-	margin: 0 0 0 0.5em;
-	text-align: left;
+#display_head p {
+	color: #959595;
 }
-#searchform p.clear
-{
-	clear: both;
+#display_head span {
+	margin: -4px 0 0 0;
+}
+.display_title {
+	font-weight: normal;
+	font-size: 26px;
+	margin-bottom: 0.25em;
 }
 
-/* Styles for the search results page.
-------------------------------------------------- */
-.topic_table td blockquote, .topic_table td .quoteheader
-{
-	margin: 0.5em;
+#reported_posts .generic_icons {
+	margin: -3px 3px 0 0;
 }
-.search_results_posts
-{
-	overflow: hidden;
+#reported_posts .quickbuttons li a {
+	background: none;
 }
-.search_results_posts .buttons
-{
-	padding: 5px 1em 0 0;
+#modcenter .generic_icons {
+	margin: -3px -3px 0 0;
 }
 
-/* Styles for the help section.
-------------------------------------------------- */
-
-#help_container
-{
-	margin: 4px 0 0 0;
-	padding: 0 0 8px 0;
+/* Some colors for generic usage */
+.red {
+	color: red;
 }
-#helpmain
-{
-	padding: 0 1em;
+.blue {
+	color: blue;
 }
-#helpmain p
-{
-	margin: 0 0 1.5em 0;
-	line-height: 1.5em;
+.green {
+	color: green;
 }
-#helpmain ul
-{
-	line-height: 1.5em;
+.block {
+	display: block;
+	margin: 0 0 5px 0;
 }
 
-/* Styles for print media.
-------------------------------------------------------- */
-@media print
-{
-	#headerarea
-	{
-		display: none;
-	}
+/* Alternating colors */
+.stripes:nth-of-type(even) { background-color:#F2F2F2; }
+.stripes:nth-of-type(odd) { background-color:#f0f4f7; }
+.alternative { background-color:#F2F2F2; }
+.alternative2{ background-color:#E8EDF0; }
 
-	.tborder
-	{
-		border: none;
-	}
-}
\ No newline at end of file
+#alerts tr.windowbg td,
+#alerts tr.windowbg2 td {
+	border-right: 1px solid #DDD;
+}
diff -ru a/Themes/default/css/install.css b/Themes/default/css/install.css
--- a/Themes/default/css/install.css	2010-10-20 01:23:07.000000000 -0700
+++ b/Themes/default/css/install.css	2015-03-05 23:30:06.004678068 -0800
@@ -1,91 +1,184 @@
-body
-{
+a:link, a:hover, a:visited {
+	text-decoration: underline;
+}
+/* These divisions wrap the forum sections when a forum width is set. */
+#wrapper, .frame {
 	width: 90%;
+	max-width: 1140px;
 }
-#top_section
-{
-	height: 70px;
-	min-height: 65px;
-}
-#upper_section
-{
-	margin-bottom: 0;
-	padding: 0;
-}
-#upper_section .user
-{
-	height: 4em;
+h1.forumtitle {
+	font-size: 2em;
+	font-family: tahoma;
+	margin: 0;
+	padding: 32px 12px 16px 12px;
+	float: left;
+	font-weight: normal;
+	color: #a85400;
+	text-shadow: -1px -1px 0 rgba(0,0,0,0.5), 1px 1px 0 #fff;
 }
-#upper_section .news
-{
-	height: 80px;
+/* Tweak the SMF logo */
+img#smflogo {
+	margin: 26px 0 0 0;
 }
-#main_screen
-{
-	padding: 0 40px;
-}
-#main_screen h2
-{
-	font-size: 1.5em;
-	border-bottom: 1px solid #d05800;
-	line-height: 1.5em;
-	margin: 0 0 0.5em 0;
-	color: #d05800;
+#inner_wrap {
+	min-height: 80px;
+}
+#inner_wrap .news {
+	height: 80px;
+	text-align: right;
+	width: 100%;
+	max-width: 100%;
+	float: left;
 }
-#main-steps
-{
+#main_steps {
 	float: right;
 	width: 50%;
-	margin-top: -60px;
+	padding: 0 0 1em 0;
 }
-#main-steps h2
-{
-	font-size: 1.1em;
+#main_steps h2 {
+	font-size: 1.2em;
 	border-bottom: 1px solid #d05800;
-	line-height: 1.1em;
-	margin: 0 0 0.5em 0;
+	line-height: 1.6em;
+	margin: 0 1em 0.5em 0;
 	color: #d05800;
-	margin-right: 40px;
 }
-#main-steps ul
-{
+#main_steps ul {
 	list-style: none;
-	padding-left: 0;
+	padding: 0 0.5em;
 	margin: 0;
+	line-height: 1.8em;
 }
-#main-steps ul li
-{
-	padding: 1px 0;
-	font-size: 0.9em;
-}
-#main-steps ul li.stepdone
-{
+#main_steps ul li.stepdone {
 	color: #aaa;
 }
-#main-steps ul li.stepcurrent
-{
-	color: #000;
+#main_steps ul li.stepcurrent {
+	color: #222;
 	font-weight: bold;
 }
-#main-steps ul li.stepwaiting
-{
+#main_steps ul li.stepwaiting {
 	color: #666;
 }
-.panel
-{
-	font-weight: normal;
+#progress_bar {
+	position: relative;
+	font-size: 1.2em;
+	height: 2.3em;
+	border: 1px solid black;
+	border-radius: 2px;
+	background: #fff;
+	float: left;
+	margin: 0.6em 0 0 4em;
+	width: 33%;
+}
+#overall_text, #step_text {
+	z-index: 2;
+	color: #111;
+	font-weight: bold;
+	position: absolute;
+	top: 0.5em;
+	left: -3.3em;
+}
+
+#overall_text_upgrade, #step_text_upgrade {
+	z-index: 2;
+	color: #111;
+	font-weight: bold;
+	position: absolute;
+	top: .5em;
+	left: -3.3em;
+}
+#overall_progress, #step_progress {
+	height: 2.3em;
+	z-index: 1;
+	background-color: #6BB247;
+}
+
+#overall_progress_upgrade, #step_progress_upgrade {
+	height: 2.5em;
+	z-index: 1;
+	background: #6BB247;
+	margin: 0px 3px 0px 0px;
+}
+.over_progress {
+
+margin: -33px 5px 0 10px;
+}
+
+#step_progress {
+	background: #ffd000;
+}
+#substep_progress {
+	height: 2.3em;
+	z-index: 1;
+	background: #eebaf4;
 }
-a:link, a:hover, a:visited
-{
-	text-decoration: underline;
+#main_screen {
+	padding: 1em 1em 0.5em 1em;
 }
-.progress
-{
-	position: relative;
-	margin: -16px 3px 0 3px;
+#main_screen h2 {
+	font-size: 1.2em;
+	border-bottom: 1px solid #d05800;
+	line-height: 1.6em;
+	margin: 0 0 0.5em 0;
+	color: #d05800;
+}
+.panel form div{
+	max-height: 560px;
+	overflow: auto;
+}
+.panel p, .panel h3 {
+	margin: 0 0.5em 1em 0.5em;
+}
+.panel ul {
+	margin: 0 0.5em 1em 0.5em;
+}
+.error_message {
+	color: red;
+	padding: 0.5em;
 }
-.overall_progress
-{
+.panel .button_submit, .panel .button_link {
+	font-size: 1em;
+	font-weight: bold;
+	color: #333;
+	padding: 3px 6px;
+	text-decoration: none;
+}
+.panel .button_submit:hover, .panel .button_link:hover {
+	color: #af6700;
+	text-decoration: none;
+}
+.panel .clear {
+	padding: 1em 0 0 0;
+	overflow: auto;
+}
+/* [WIP] Warning: this next bit may cause trouble. */
+/* It's just to hide an empty div when the submits are not shown. */
+.panel .clear:nth-child(3) {
+	border: 1px solid green;
+	display: none;
+}
+/* End [WIP] */
+#time_elapsed {
+	clear: both;
+	padding: 1em 1em 0 1em;
+	border: 1px solid green;
+	/* [WIP] */
+	background: /*#f0f4f7*/ #fcfcfc;
+	margin: 1em 0.9em 0 0.9em;
+	padding: 6px 8px 8px 8px;
+	border: 1px solid #ddd;
+	border-radius: 5px;
+	box-shadow: 0 -2px 2px rgba(0,0,0,0.1);
+	/* End [WIP] */
+}
+
+#progress {
 	position: relative;
-	margin: -25px 3px 0 3px;
-}
\ No newline at end of file
+	font-size: 1.2em;
+	height: 2.5em;
+	border: 1px solid black;
+	border-radius: 2px;
+	background: #fff;
+	float: left;
+	margin: 0.6em 0 0 4em;
+	width: 33%;
+}
Only in b/Themes/default/css: jquery.custom-scrollbar.css
Only in b/Themes/default/css: jquery.sceditor.css
Only in b/Themes/default/css: jquery.sceditor.default.css
diff -ru a/Themes/default/css/report.css b/Themes/default/css/report.css
--- a/Themes/default/css/report.css	2010-09-24 08:04:08.000000000 -0700
+++ b/Themes/default/css/report.css	2015-03-05 23:30:06.008011490 -0800
@@ -1,59 +1,47 @@
-body
-{
+body {
 	color: #000;
 	background-color: #fff;
 	zoom: 1;
 }
-body, td, .normaltext
-{
+body, td, .normaltext {
 	font-family: Verdana, arial, helvetica, serif;
 	font-size: small;
 }
-*, a:link, a:visited, a:hover, a:active
-{
+*, a:link, a:visited, a:hover, a:active {
 	color: #000 !important;
 }
-.smalltext, .quoteheader, .codeheader
-{
+.smalltext, .quoteheader, .codeheader {
 	font-size: x-small;
 }
-.largetext
-{
+.largetext {
 	font-size: large;
 }
-hr
-{
+hr {
 	height: 1px;
 	border: 0;
 	color: #000;
 	background-color: #000;
 }
-.catbg
-{
+.catbg {
 	background-color: #d6d6d6;
 	font-weight: bold;
 }
-.titlebg, tr.titlebg td, .titlebg a:link, .titlebg a:visited
-{
+.titlebg, tr.titlebg td, .titlebg a:link, .titlebg a:visited {
 	font-style: normal;
 	background-color: #f0f4f7;
 }
-.bordercolor
-{
+.bordercolor {
 	background-color: #333;
 }
-.windowbg
-{
+.windowbg {
 	color: #000;
 	background-color: #fff;
 }
-.windowbg2
-{
+.windowbg2 {
 	color: #000;
 	background-color: #f1f1f1;
 }
-.copyright
-{
+.copyright {
 	font-size: x-small;
 	text-align: center;
 }
\ No newline at end of file
Only in b/Themes/default/css: responsive.css
diff -ru a/Themes/default/css/rtl.css b/Themes/default/css/rtl.css
--- a/Themes/default/css/rtl.css	2011-05-12 23:09:06.000000000 -0700
+++ b/Themes/default/css/rtl.css	2015-03-05 23:30:06.008011490 -0800
@@ -1,1082 +1,725 @@
-/* Common classes to ease styling.
+/* Common classes to easy styling.
 ------------------------------------------------------- */
 
-.floatright
-{
+.floatright {
 	float: left;
 }
-.floatleft
-{
+.floatleft {
 	float: right;
 }
-.clear_left
-{
+.clear_left {
 	clear: right;
 }
-.clear_right
-{
+.clear_right {
 	clear: left;
 }
-.righttext
-{
-	margin-left: auto;
-	margin-right: 0;
+.righttext {
 	text-align: left;
 }
-.lefttext
-{
-	margin-left: 0;
-	margin-right: auto;
+.lefttext {
 	text-align: right;
 }
 
+/* This place covers board places (boardindex-messageindex) */
+div.icon, div.info, div.stats, div.lastpost {
+	float: right !important;
+}
+
 /* Styling for BBC tags */
-.bbc_list
-{
+.bbc_list {
 	text-align: right;
 }
+/* A quote, perhaps from another post. */
+.bbc_standard_quote:before, .bbc_alternate_quote:before {
+	content: '\275E';
+	margin-left: 0.25em;
+}
 
 /* GenericList */
-.additional_row input
-{
+.additional_row {
 	margin-left: 0;
 	margin-right: 1em;
 }
-/* All the signatures used in the forum.  If your forum users use Mozilla, Opera, or Safari, you might add max-height here ;). */
-.signature, .attachments
-{
+/* All the signatures used in the forum. If your forum users use Mozilla, Opera, or Safari, you might add max-height here ;). */
+.signature, .attachments, .custom_fields_above_signature {
 	clear: left;
 }
-.custom_fields_above_signature
-{
-	clear: left;
+
+/* Globally accessible "go up" link. */
+#bot {
+	float: left;
 }
-.openid_login
-{
-	padding-right: 18px;
-	padding-left: 0;
+
+/* Buttons should be styled a bit differently, in order to make them look more button'ish. */
+.button_submit, .button_reset, .button_link {
+	margin: 0 2x;
+}
+
+/* the page navigation area */
+.previous_page {
+	background-position: -113px -33px;
+}
+.next_page {
+	background-position: -113px -49px;
 }
 
 /* Lists with settings use these a lot.
 ------------------------------------------------------- */
-dl.settings
-{
+dl.settings {
 	clear: left;
 }
-dl.settings dt
-{
+dl.settings dt {
 	float: right;
 	clear: both;
 }
-dl.settings dt.windowbg
-{
+dl.settings dt.windowbg {
 	float: right;
 }
-dl.settings dd
-{
+dl.settings dd {
 	float: left;
 }
-dl.settings img
-{
+dl.settings img {
 	margin: 0 0 0 10px;
 }
 
+/* Styles for popup windows
+------------------------------------------------------- */
+.popup_heading .hide_popup {
+	float: left;
+}
+
 /* Styles for rounded headers.
 ------------------------------------------------------- */
 
-h3.catbg img.icon, h4.titlebg img.icon
-{
-	vertical-align: middle;
+h3.catbg .icon {
 	margin: -2px 0 0 5px;
 }
-h4.titlebg, h3.titlebg
-{
-	padding-right: 9px;
-	padding-left: 0;
-}
-h4.titlebg img.icon
-{
-	float: right;
-	margin: 5px 0 0 8px;
+.cat_bar .desc {
+	margin: -8px 13px 4px 0;
 }
 
-table.table_list a.unreadlink, table.table_list a.collapse
-{
-	float: left;
-}
-table.table_list a.collapse
-{
-	margin: 10px 1em 0 5px;
-}
-.table_grid th.first_th, tr.catbg th.first_th
-{
-	background: #a8bace url(../images/theme/main_block.png) no-repeat 100% -240px;
-}
-.table_grid th.last_th, tr.catbg th.last_th
-{
-	background: #a8bace url(../images/theme/main_block.png) no-repeat 0 -240px;
-}
-tr.titlebg th.first_th
-{
-	background: #e3e9ef url(../images/theme/main_block.png) no-repeat 100% -340px;
-}
-tr.titlebg th.last_th
-{
-	background: #e3e9ef url(../images/theme/main_block.png) no-repeat 0 -340px;
+/* Introduce New Title Bar */
+h3.titlebg, h4.titlebg, .titlebg, h3.subbg, h4.subbg, .subbg {
+	padding-right: 9px;
+	padding-left: 9px;
 }
 
+
 /* Styles for the standard dropdown menus.
 ------------------------------------------------------- */
-#main_menu
-{
-	padding: 0 0.5em;
+#main_menu {
 	float: right;
-	text-align: right;
 }
-.dropmenu li
-{
+#menu_nav {
+	padding: 0;
+}
+.dropmenu {
 	float: right;
-	margin: 0 0 0 8px;
+	padding: 0;
 }
-.dropmenu li ul ul
-{
-	right: 15em;
+
+/* Level 3 submenu wrapper positioning. */
+.dropmenu li ul ul {
+	margin: -2em 3.1em 0 0;
 }
-.dropmenu li ul
-{
-	background: url(../images/theme/menu_gfx.png) 100% -130px no-repeat;
-	right: 5px;
+/* This is a small fix for dropmenu icons */
+.dropmenu .generic_icons, #profile_menu .generic_icons, .dropmenu img {
+	margin: 0 -4px 0 8px;
 }
 
-/* The dropdown menu toggle image */
-#menu_toggle
-{
-	float: left;
-	margin-right: 0;
-	margin-left: 10px;
-	padding-top: 3px;
+/* Hiding Level 3 submenu off hover. */
+.dropmenu li:hover ul ul, .dropmenu li ul ul, .dropmenu li:hover ul ul ul, .dropmenu li ul ul ul {
+	right: -9999px;
 }
-#menu_toggle span
-{
-	position: relative;
-	left: 0;
+/* Reposition as visible on hover. */
+.dropmenu li li:hover ul, .dropmenu li li ul {
+	right: 11em;
 }
 
-/* Styles for the standard button lists.
-------------------------------------------------------- */
-.buttonlist ul
-{
-	margin: 0 0 0 0.2em;
+/* Indicator for additional levels. Best in the anchor so it stays visible on hover. */
+.dropmenu li li.subsections > a:after {
+	left: 2px;
+	right: auto;
+	content: '\25c4';
 }
-.buttonlist ul li a
-{
-	margin-left: 0;
-	margin-right: 12px;
+
+/* The upper_section, float the two each way */
+.user {
+	width: 12%;
+	float: left;
+	padding-left: 0;
 }
-.buttonlist ul li a span
-{
-	left: 8px;
+
+/* News section. */
+#inner_wrap .news {
+	max-width: 50%;
+	float: right;
+	overflow: auto;
+	padding: 0 5px 10px 0;
+	font-size: 0.9em;
 }
-.align_top ul li a, .align_bottom ul li a
-{
+
+/* the active one */
+.align_top a, .align_bottom a {
 	margin: 0 0 0 12px;
 }
-#adm_submenus
-{
+
+/* The extra menu rows for admin sections, etc. */
+#adm_submenus {
 	padding-left: 0;
 	padding-right: 2em;
 }
-/* the main title, always stay at 45 pixels in height! */
-h1.forumtitle
-{
+
+/* the main title. */
+h1.forumtitle {
 	float: right;
 }
 /* float these items to the left */
-#siteslogan, img#smflogo
-{
-	float: left;
-}
-/* the upshrink image needs some tweaking */
-img#upshrink
-{
+#siteslogan, img#smflogo {
 	float: left;
 }
-/* ..so does the SMF logo */
-img#smflogo
-{
+/* Tweak the SMF logo */
+img#smflogo {
 	margin-right: 1em;
 }
-#upper_section div.news
-{
+
+/* Styles for the general looks of the theme.
+------------------------------------------------------- */
+#upper_section .user {
 	float: left;
-	text-align: left;
 }
-div#upper_section div.user
-{
+#upper_section .news {
 	float: right;
 }
-div#upper_section div.user p
-{
-	float: right;
-	margin: 0 0 1em 1em;
+
+/* Buttons should be styled a bit differently, in order to make them look more button'ish. */
+.button_submit, .button_reset, .button_link {
+	float: left;
 }
-div#upper_section div.user ul
-{
-	padding-left: 0;
-	padding-right: 10px;
+/* The framing graphics */
+#search_form {
+	text-align: left;
 }
 
 /* The navigation list (i.e. linktree) */
-.navigate_section ul li
-{
+.navigate_section ul li {
 	float: right;
-	padding: 0 0 0 0.5em;
+	padding: 0 3px 5px 1px;
 }
 
-/* Styles for the board index.
-------------------------------------------------- */
-
 /* the posting icons */
-#posting_icons
-{
-	padding: 0 1em 0.5em 1em;
-}
-#posting_icons img
-{
-	margin: 0 4ex 0 0;
-}
-#posting_icons .buttonlist
-{
-	float: left;
-}
-#postbuttons_upper ul li a span
-{
+#postbuttons_upper ul li a span {
 	line-height: 19px;
 	padding: 0 6px 0 0;
 }
 
-dl#ic_recentposts dt
-{
-	float: right;
-}
-dl#ic_recentposts dd
-{
-	text-align: left;
-}
-form#ic_login ul li
-{
-	float: right;
-	width: 20%;
-}
-
-/* the small stats */
-#index_common_stats
-{
-	text-align: left;
-}
-img#upshrink_ic, img#newsupshrink
-{
-	float: right;
-	margin: 10px 0 0 5px;
-}
-
-/* Styles for the message (topic) index.
----------------------------------------------------- */
-.table_frame .table_list td.icon, .table_frame .table_list td.info, .table_frame .table_list td.stats
-{
-	border-right: none;
-	border-left: 2px solid white;
-}
-.lastpost img
-{
+.mark_read {
 	float: left;
 }
 
-/* Styles for the display template (topic view).
----------------------------------------------------- */
-#postbuttons div.buttons
-{
-	float: right;
-}
-#postbuttons span
-{
+/* the small stats */
+#index_common_stats {
 	text-align: left;
 }
-#postbuttons span.lower
-{
-	clear: left;
-}
-#postbuttons .buttonlist
-{
-	float: left;
-}
-
-h4#pollquestion
-{
-	padding: 0.5em 2em 0.5em 0;
-}
-/* Poll vote options */
-#poll_options ul.options
-{
-	padding: 1em 2em 0 2.5em;
-	margin: 0 0 1em 0;
-}
-#poll_options div.submitbutton
-{
-	clear: both;
-	padding: 0 2em 1em 0;
-	margin: 0 0 1em 0;
-}
 
 /* Poll results */
-#poll_options dl.options
-{
+#poll_options dl.options {
 	padding: 1em 2em 1em 2.5em;
 	margin: 0 0 1em 1em;
 }
-#poll_options dl.options dt
-{
+#poll_options dl.options dt {
 	float: right;
 	clear: right;
 }
-#poll_options dl.options dd
-{
-	margin: 0 2em 0 0;
+#poll_options dl.options dd {
 	float: right;
 }
-span.percent
-{
-	float: left;
-}
 
-/* author and topic information */
-#forumposts h3 span#author
-{
-	margin: 0 0 0 7.7em;
-}
-#forumposts h3 img
-{
-	float: right;
-	margin: 4px 0 0 0.5em;
-}
 /* poster and postarea + moderation area underneath */
-.poster
-{
+.poster {
 	float: right;
-	width: 15em;
 }
-.postarea, .moderatorbar
-{
+.postarea, .moderatorbar {
 	margin: 0 16em 0 0;
 }
-.moderatorbar
-{
+.moderatorbar {
 	clear: left;
 }
 /* poster details and list of items */
-.poster h4, .poster ul
-{
+.poster h4, .poster ul {
 	padding: 0;
 	margin: 0 1.5em 0 1em;
 }
-.poster h4
-{
-	margin: 0.2em 1.1em 0.4em 0;
-}
-.poster ul ul
-{
-	margin: 0.3em 0 0 1em;
-}
-.messageicon
-{
+
+.messageicon {
 	float: right;
 	margin: 0 0 0 0.5em;
 }
 
-.keyinfo
-{
-	float: right;
-}
-.modifybutton
-{
-	clear: left;
-	float: left;
-	margin: 8px 0 10px 20px;
-	text-align: left;
-}
 
 /* The quick buttons */
-ul.quickbuttons
-{
-	margin: 0.9em 0 0 11px;
-	clear: left;
+ul.quickbuttons {
 	float: left;
-	text-align: left;
 }
-ul.quickbuttons li
-{
-	float: left;
-	margin: 0 11px 0 0;
-}
-ul.quickbuttons li a
-{
-	padding: 0 20px 0 0;
-	float: left;
+.quickbuttons li.quick_edit, .quickbuttons li.post_options {
+	line-height: 1.9em;
+	position: relative;
 }
-ul.quickbuttons li.quote_button
-{
-	background-position: 100% 0;
-}
-ul.quickbuttons li.remove_button
-{
-	background-position: 100% -30px;
-}
-ul.quickbuttons li.modify_button
-{
-	background-position: 100% -60px;
-}
-ul.quickbuttons li.approve_button
-{
-	background-position: 100% -90px;
-}
-ul.quickbuttons li.restore_button
-{
-	background-position: 100% -120px;
-}
-ul.quickbuttons li.split_button
-{
-	background-position: 100% -150px;
-}
-ul.quickbuttons li.reply_button
-{
-	background-position: 100% -180px;
-}
-ul.quickbuttons li.reply_all_button
-{
-	background-position: 100% -180px;
-}
-ul.quickbuttons li.notify_button
-{
-	background-position: 100% -210px;
+.quickbuttons li ul {
+	text-align: right;
 }
-ul.quickbuttons li.inline_mod_check
-{
-	margin: 0 5px 0 0;
+
+.post_verification #verification_control {
+	margin: .3em 1em .3em 0;
 }
-.post
-{
+.post {
 	clear: left;
 }
-.inner
-{
+.inner {
 	padding: 1em 0 0 1em;
 	margin: 0 0 0 1em;
 }
-#forumposts .modified
-{
+#forumposts .modified {
 	float: right;
 }
-#forumposts .reportlinks
-{
+#forumposts .reportlinks {
 	margin-left: 1.5em;
 	text-align: left;
 	clear: left;
 }
 
-#moderationbuttons_strip
-{
+#moderationbuttons_strip {
 	float: right;
 }
-#moderationbuttons_strip ul
-{
+#moderationbuttons_strip ul {
 	margin: 0 0.2em 0 0;
 	padding: 0 1em 0 0;
 }
 /* The jump to box */
-#display_jump_to
-{
+#display_jump_to {
 	text-align: left;
 }
+#display_jump_to select {
+	margin: 0 5px 0 0;
+}
 
 /* Styles for edit post section
 ---------------------------------------------------- */
-#post_header dt
-{
+#post_header dt {
 	float: right;
 }
-#post_header dd
-{
+#post_header dd {
 	float: right;
 }
-ul.post_options
-{
+ul.post_options {
 	margin: 0 1em 0 0;
 }
-ul.post_options li
-{
+ul.post_options li {
 	float: right;
-}
-#postAttachment dd, #postAttachment2 dd
-{
-	margin: .3em 1em .3em 0;
-}
-#postAttachment dt, #postAttachment2 dt
-{
-	font-weight: bold;
-}
-#postAttachment3
-{
-	margin-left: 0;
-	margin-left: 1em;
-}
-.post_verification #verification_control
-{
-	margin: .3em 1em .3em 0;
+	margin: 0 2px ;
 }
 
 /* Styles for edit event section
 ---------------------------------------------------- */
-#post_event div.event_options
-{
+#post_event div.event_options {
 	float: left;
 }
-#post_event #event_main input
-{
+#post_event #event_main input {
 	margin: 0 0 1em 0;
 	float: right;
 }
-#post_event #event_main div.smalltext
-{
+#post_event #event_main div.smalltext {
 	float: left;
 }
-#post_event ul.event_main li
-{
+#post_event ul.event_main li {
 	float: left;
 }
-#post_event ul.event_options
-{
+#post_event ul.event_options {
 	padding: 0 .7em .7em 0;
 }
-#post_event #event_main select, #post_event ul.event_options li select, #post_event ul.event_options li .input_check
-{
+#post_event #event_main select, #post_event ul.event_options li select, #post_event ul.event_options li .input_check {
 	margin: 0 0 0 1em;
 }
 
 /* Styles for edit poll section.
 ---------------------------------------------------- */
-
-#edit_poll fieldset input
-{
-	margin-right: 7em;	
+#edit_poll fieldset input {
+	margin-right: 7em;
 }
-#edit_poll ul.poll_main li
-{
+#edit_poll ul.poll_main li {
 	padding-right: 1em;
 }
-#edit_poll ul.poll_main input
-{
+#edit_poll ul.poll_main input {
 	margin-right: 1em;
 }
-#edit_poll div.poll_options
-{
+#edit_poll div.poll_options {
 	float: right;
 }
-#edit_poll ul.poll_main, dl.poll_options
-{
+#edit_poll ul.poll_main, dl.poll_options {
 	padding: 0 .7em 0 0;
 }
-#edit_poll dl.poll_options dt
-{
+#edit_poll dl.poll_options dt {
 	padding: 0 1em 0 0;
 }
-#edit_poll dl.poll_options dd input
-{
-	margin-right: 0; 
+#edit_poll dl.poll_options dd input {
+	margin-right: 0;
 }
 
 /* Styles for the personal messages section.
 ------------------------------------------------- */
-
-#personal_messages h3 span#author, #personal_messages h3 span#topic_title
-{
+#personal_messages h3 span#author, #personal_messages h3 span#topic_title {
 	float: right;
 }
-#personal_messages h3 span#author
-{
+#personal_messages h3 span#author {
 	margin: 0 0.5em 0 0;
 }
-#personal_messages h3 span#topic_title
-{
+#personal_messages h3 span#topic_title {
 	margin: 0 9em 0 0;
 }
-#personal_messages .labels
-{
+#personal_messages .labels {
 	padding: 0 0 0 1em;
 }
 
 /* Styles for the move topic section.
 ---------------------------------------------------- */
-.move_topic
-{
+.move_topic {
 	text-align: right;
 }
+
 /* Styles for the login areas.
 ------------------------------------------------------- */
-.login dt
-{
+.login dt {
 	float: right;
 }
-.login dd
-{
+.login dd {
 	float: right;
 	text-align: right;
 }
-.login h3 img
-{
+.login h3 img {
 	margin: 0 0 0.5em;
 }
 
 /* Additional profile fields */
-dl.register_form
-{
+dl.register_form {
 	clear: left;
 }
 
-dl.register_form dt
-{
+dl.register_form dt {
 	float: right;
 }
+
 /* Styles for maintenance mode.
 ------------------------------------------------------- */
-#maintenance_mode
-{
+#maintenance_mode {
 	text-align: right;
 }
-#maintenance_mode img.floatleft
-{
+#maintenance_mode img.floatleft {
 	margin-left: 1em;
 }
 /* common for all admin sections */
-h3.titlebg img
-{
+h3.titlebg img {
 	margin-left: 0.5em;
 }
-tr.titlebg td
-{
+tr.titlebg td {
 	padding-right: 0.7em;
 }
-#admin_menu
-{
+div#admin_menu {
 	padding-right: 0;
 }
-#admin_content
-{
+#admin_content {
 	clear: right;
 }
-/* Styles for sidebar menus.
-------------------------------------------------------- */
-#left_admsection
-{
-	float: right;
-	padding-right: 0;
-	padding-left: 10px;
-}
-.left_admmenu li
-{
-	padding: 0 0.5em 0 0;
-}
+
 /* Styles for generic tables.
 ------------------------------------------------------- */
-.topic_table td.stickybg2
-{
-	background-image: url(../images/icons/quick_sticky.gif);
-	background-repeat: no-repeat;
-	background-position: 2% 4px;
-}
-.topic_table td.lockedbg2
-{
-	background-image: url(../images/icons/quick_lock.gif);
-	background-repeat: no-repeat;
-	background-position: 2% 4px;
-}
-.topic_table td.locked_sticky2
-{
-	background-image: url(../images/icons/quick_sticky_lock.gif);
-	background-repeat: no-repeat;
-	background-position: 2% 4px;
-}
-.topic_table td.lastpost
-{
-	background-image: none;
+#info_center .cat_bar, .table_grid tr.catbg th {
+	text-align: right;
 }
-/* Styles for (fatal) errors.
-------------------------------------------------- */
-.errorbox p.alert
-{
-	float: right;
+.message_index_title {
+	margin-left: 40px;
 }
-/* Styles for the profile section.
+
+/* Styles for info boxes.
 ------------------------------------------------- */
-#basicinfo
-{
+.errorbox:before, .noticebox:before, .infobox:before {
+	right: 10px;
+}
+.errorbox p.alert {
+	margin: 0 0 0 4px;
 	float: right;
 }
-#detailedinfo
-{
-	float: left;
+.errorbox, .noticebox, .infobox {
+	padding: 7px 35px 7px 10px;
 }
-#basicinfo ul li
-{
+
+/* Level 1 button background. */
+.dropmenu li, #top_info > li {
 	float: right;
-	margin-right: 0;
-	margin-left: 5px;
-}
-#detailedinfo div.content dl, #tracking div.content dl
-{
-	clear: left;
 }
-#detailedinfo div.content dt, #tracking div.content dt
-{
+
+/* User information. */
+#profile_menu a.avatar {
 	float: right;
+	margin: 0 10px 0 20px;
 }
-#detailedinfo div.content dd, #tracking div.content dd
-{
+#profile_menu .profile_user_info ol {
 	float: right;
 }
-#avatar_server_stored div
-{
+#profile_menu .profile_user_links li {
 	float: right;
 }
 
-#main_admsection #basicinfo h4
-{
+/* Styles for the profile section.
+------------------------------------------------- */
+#basicinfo {
 	float: right;
 }
-#main_admsection #basicinfo img.avatar
-{
+#detailedinfo {
 	float: left;
 }
-#main_admsection #basicinfo ul
-{
-	clear: right;
-}
-#main_admsection #basicinfo span#userstatus
-{
-	clear: right;
+#basicinfo ul li {
+	float: right;
+	margin-right: 0;
+	margin-left: 5px;
 }
-
-/* Profile statistics */
-#generalstats div.content dt
-{
+#avatar_server_stored div {
 	float: right;
 }
-#generalstats div.content dd
-{
+#detailedinfo dt, #tracking dt {
 	float: right;
 }
 
+/* h3 HD Icons */
+h3.search_hd {
+	padding: 8px 45px 6px;
+	background-position : 99% 50%;
+}
+h3.profile_hd {
+	padding: 8px 50px 8px 0;
+	background-position : 99% 50%;
+}
+
 /* Activity by time */
-#activitytime
-{
+#activitytime {
 	clear: right;
 }
-.activity_stats li
-{
+.activity_stats li {
 	float: right;
 }
-.activity_stats li span
-{
+.activity_stats li span {
 	border-width: 1px 0 0 1px;
 }
-.activity_stats li.last span
-{
+.activity_stats li.last span {
 	border-left: none;
 }
 
 /* Most popular boards by posts and activity */
-#popularposts
-{
+#popularposts {
 	float: right;
 }
-#popularactivity
-{
+#popularactivity {
 	float: left;
 }
 
-#popularposts div.content dt, #popularactivity div.content dt
-{
-	float: right;
-}
-#popularposts div.content dd, #popularactivity div.content dd
-{
-	float: right;
-}
-
-.profile_pie
-{
-	background-image: url(../images/stats_pie_rtl.png);
+.profile_pie {
+	background: url(../images/stats_pie_rtl.png);
 	float: right;
 	margin-right: 0;
 	margin-left: 1em;
 }
 
 /* View posts */
-.topic .time
-{
+.topic .time {
 	float: left;
 }
-.counter
-{
+.counter {
 	padding: 0.2em 0.2em 0.1em 0.5em;
 	float: right;
 }
-.topic .mod_icons
-{
+.topic .mod_icons {
 	text-align: left;
 	margin-right: 0;
 	margin-left: 1em;
 }
-#permissions div.permission_name
-{
+#permissions div.permission_name {
 	margin: 0 0 0 1%;
 }
 
-#ip_list li.header, #ip_list li.ip
-{
+#ip_list li.header, #ip_list li.ip {
 	float: right;
 }
-#creator dt
-{
+#creator dt {
 	float: right;
 }
-#creator dd
-{
+#creator dd {
 	float: right;
 }
 
-.ignoreboards ul
-{
+.ignoreboards ul {
 	margin: 0 1em 0 0;
 }
-.ignoreboards li
-{
+.ignoreboards li {
 	float: right;
 }
 
-#pick_theme
-{
+#pick_theme {
 	float: right;
 }
-/* Styles for the statistics center.
-------------------------------------------------- */
-#stats_left, #top_posters, #top_topics_replies, #top_topics_starter
-{
+.infolinks {
+	min-width: 95%;
 	float: right;
 }
-#stats_right, #top_boards, #top_topics_views, #most_online
-{
-	float: left;
-}
-dl.stats dt
-{
-	float: right;
-}
-dl.stats dd
-{
-	text-align: left;
-}
-.statsbar div.bar
-{
-	float: right;
-}
-.statsbar div.bar div
-{
-	right: -6px;
-	padding: 0 0 0 6px;
-}
-tr.windowbg2 th.stats_month, tr.windowbg2 td.stats_day
-{
+/* Introduce New Title Bar */
+.title_bar {
 	text-align: right;
 }
 
-/* Styles for the calendar section.
+/* Styles for the statistics center.
 ------------------------------------------------- */
-#month_grid
-{
+.stats_icon {
+	margin: 2px 3px -1px 6px;
+}
+dl.stats dt {
 	float: right;
 }
-
-#main_grid table.weeklist td.windowbg
-{
-
-	border-left: 2px solid #fff;
-	border-bottom: 2px solid #fff;
+dl.stats dd {
+	text-align: right;
 }
 
-#main_grid table.weeklist td.weekdays
-{
-	text-align: left;
-	vertical-align: middle;
-	border-right: 2px solid #fff;
-	border-bottom: 2px solid #fff;
+tr.windowbg2 th.stats_month, tr.windowbg2 td.stats_day {
+	text-align: right;
+}
+#stats tr.windowbg2 th.lefttext, #stats tr.titlebg th.lefttext {
+	text-align: right;
 }
 
 /* Styles for the advanced search section.
 ------------------------------------------------- */
-#searchform fieldset
-{
+#searchform fieldset {
 	text-align: right;
 }
-#advanced_search dt
-{
+#advanced_search dt {
 	float: right;
 	text-align: left;
 }
-#advanced_search dd
-{
+#advanced_search dd {
 	float: right;
 	margin: 0 0.5em 0 0;
 	text-align: right;
 }
 /* Boards picker */
-#searchform fieldset div#searchBoardsExpand ul
-{
-	margin: 0 1em 0 0;
-}
-#searchform fieldset div#searchBoardsExpand li
-{
-	float: right;
-}
-#searchform fieldset p
-{
+#searchform fieldset p {
 	text-align: right;
 }
 
-.search_results_posts .buttons
-{
+.search_results_posts .buttons {
 	padding: 5px 0 0 1em;
 }
 
+/* Some icons need slight tweaks
+------------------------------------------------- */
+.generic_icons.move {
+	background-position: -112px -48px;
+}
+
 /* Styles for the help section.
 ------------------------------------------------- */
-#helpmain h3.section
-{
+#helpmain h3.section {
 	padding: 0 0.5em 0.5em 0;
 }
 /* put back the bullets please */
-#helpmain ul
-{
+#helpmain ul {
 	margin: 0 2em 1em 0;
 	padding-left: 0;
 	padding-right: 1em;
 }
-#helpmain #messageindex
-{
+#helpmain #messageindex {
 	clear: left;
 }
 
 /* Styles for the admincenter (reverse admin.css).
 ------------------------------------------------- */
-#quick_search
-{
+#quick_search {
 	margin-left: 5px;
 }
-.features_image
-{
-	float: right;
-	margin: 0 1em 0.5em 2em;
-}
-.features_switch
-{
-	float: left;
-}
-.features h4
-{
-	padding: 1em 0.5em 0.5em 0;
-}
+
 /* admin home */
-#live_news div.content dl
-{
-	padding: 0.5em 0.5em 0 0;
-}
-#smfAnnouncements dd
-{
+#smfAnnouncements dd {
 	padding: 0;
 	margin: 0 1.5em 1em 0;
 }
-#quick_tasks li
-{
-	float: right;
-	list-style-type: none;
-}
-.home_image
-{
-	float: right;
-}
+
 /* common admin classes */
-.additional_row input
-{
+.additional_row input {
 	margin-left: 0;
 	margin-right: 2em;
 }
-#error_log td div.marginleft
-{
+#error_log td div.marginleft {
 	margin: 0 1ex 0 0 !important;
 }
 
 /* Styles for the package manager.
 ------------------------------------------------- */
-#package_list .tborder
-{
+#package_list .tborder {
 	margin: .25em 26px .25em 0;
 }
-#package_list ol, #package_list ol li
-{
+#package_list ol, #package_list ol li {
 	margin-left: 0;
 	margin-right: 50px;
 }
+
 /* ManageBoards */
-#manage_boards ul
-{
+#manage_boards ul {
 	overflow: hidden;
 }
-#manage_boards li
-{
+#manage_boards li {
 	overflow: hidden;
 }
-.move_links
-{
+.move_links {
 	padding: 0 0 0 13px;
 }
 
-span.search_weight
-{
+span.search_weight {
 	text-align: left;
 }
+
 /* Manage Bans */
-.ban_restriction
-{
+.ban_restriction {
 	margin: 0.2em 2.2em 0.2em 0;
 }
+
 /* Themes */
-.is_directory
-{
+.is_directory {
 	padding-right: 18px;
-	background: url(../images/admin/boards.gif) no-repeat;
-	background-position: 100% 0;
+	background: url(../images/admin/boards.png) no-repeat 100% 0;
 }
+
 /* Styles for the moderation center.
 ------------------------------------------------- */
-.modblock_left
-{
+ul.moderation_notes li {
+	padding: 4px 4px 4px 0;
+}
+
+#inner_wrap a.avatar {
 	float: right;
-	clear: left;
+	width: 46px;
+}
+
+.unread_links {
+	float: left !important;
+	padding-left: 0;
 }
-.modblock_right
-{
+.children p {
+	margin-right: 18px;
+}
+h3 .collapse {
 	float: left;
 }
-ul.moderation_notes li
-{
-	padding: 4px 4px 4px 0;
-}
\ No newline at end of file
+
+.pagelinks {
+	margin: 8px 5px 0 0;
+}
+span.pages {
+	float: right;
+	margin: 0 5px 0 5px;
+}
Only in b/Themes/default/css: slider.min.css
Only in a/Themes/default/css: webkit.css
diff -ru a/Themes/default/css/wireless.css b/Themes/default/css/wireless.css
--- a/Themes/default/css/wireless.css	2010-09-24 08:04:08.000000000 -0700
+++ b/Themes/default/css/wireless.css	2015-03-05 23:30:06.008011490 -0800
@@ -1,35 +1,28 @@
-.catbg, tr.catbg td
-{
+.catbg, tr.catbg td {
 	background-color: #6d92aa;
 	color: #fff;
 }
-.titlebg, .titlebg a, .titlebg a:link, .titlebg a:visited
-{
+.titlebg, .titlebg a, .titlebg a:link, .titlebg a:visited {
 	background-color: #b6dbff;
 	color: #000;
 	text-decoration: none;
 }
-.windowbg, tr.windowbg td
-{
+.windowbg, tr.windowbg td {
 	background-color: #fff;
 	color: #000;
 }
-.windowbg2, tr.windowbg2 td
-{
+.windowbg2, tr.windowbg2 td {
 	background-color: #c0c0c0;
 	color: #000;
 }
-.new, a:link.new, a:visited.new
-{
+.new, a:link.new, a:visited.new {
 	background-color: #2f2fc0;
 	color: #fff;
 }
-.updated
-{
+.updated {
 	color: red;
 }
 /* Resize our post area as needed */
-#message
-{
+#message {
 	width: 98%;
 }
\ No newline at end of file
diff -ru a/Themes/default/Display.template.php b/Themes/default/Display.template.php
--- a/Themes/default/Display.template.php	2011-06-10 03:42:24.000000000 -0700
+++ b/Themes/default/Display.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,11 +3,11 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_main()
@@ -18,14 +18,41 @@
 	if ($context['report_sent'])
 	{
 		echo '
-			<div class="windowbg" id="profile_success">
+			<div class="infobox">
 				', $txt['report_sent'], '
 			</div>';
 	}
 
+	// Show new topic info here?
+	echo '
+		<div id="display_head" class="information">
+			<h2 class="display_title">', $context['subject'], ($context['is_locked']) ? ' <span class="generic_icons lock"></span>' : '', ($context['is_sticky']) ? ' <span class="generic_icons sticky"></span>' : '', '</h2>
+			<p>',$txt['started_by'],' ', $context['topic_poster_name'],', ', $context['topic_started_time'],'</p>';
+
+	// Next - Prev
+	echo '
+		<span class="nextlinks floatright">', $context['previous_next'], '</span>';
+
+	if (!empty($settings['display_who_viewing']))
+	{
+		echo '
+				<p>';
+
+		// Show just numbers...?
+		if ($settings['display_who_viewing'] == 1)
+				echo count($context['view_members']), ' ', count($context['view_members']) == 1 ? $txt['who_member'] : $txt['members'];
+		// Or show the actual people viewing the topic?
+		else
+			echo empty($context['view_members_list']) ? '0 ' . $txt['members'] : implode(', ', $context['view_members_list']) . ((empty($context['view_num_hidden']) || $context['can_moderate_forum']) ? '' : ' (+ ' . $context['view_num_hidden'] . ' ' . $txt['hidden'] . ')');
+
+		// Now show how many guests are here too.
+		echo $txt['who_and'], $context['view_num_guests'], ' ', $context['view_num_guests'] == 1 ? $txt['guest'] : $txt['guests'], $txt['who_viewing_topic'], '
+				</p>';
+	}
+
 	// Show the anchor for the top and for the first message. If the first message is new, say so.
 	echo '
-			<a id="top"></a>
+		</div>
 			<a id="msg', $context['first_message'], '"></a>', $context['first_new_message'] ? '<a id="new"></a>' : '';
 
 	// Is this topic also a poll?
@@ -35,15 +62,11 @@
 			<div id="poll">
 				<div class="cat_bar">
 					<h3 class="catbg">
-						<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/topic/', $context['poll']['is_locked'] ? 'normal_poll_locked' : 'normal_poll', '.gif" alt="" class="icon" /> ', $txt['poll'], '</span>
+						<span class="generic_icons poll"></span>', $context['poll']['is_locked'] ? '<span class="generic_icons lock"></span>' : '' ,' ', $context['poll']['question'], '
 					</h3>
 				</div>
 				<div class="windowbg">
-					<span class="topslice"><span></span></span>
-					<div class="content" id="poll_options">
-						<h4 id="pollquestion">
-							', $context['poll']['question'], '
-						</h4>';
+					<div id="poll_options">';
 
 		// Are they not allowed to vote but allowed to view the options?
 		if ($context['poll']['show_results'] || !$context['allow_vote'])
@@ -55,10 +78,10 @@
 			foreach ($context['poll']['options'] as $option)
 			{
 				echo '
-						<dt class="middletext', $option['voted_this'] ? ' voted' : '', '">', $option['option'], '</dt>
-						<dd class="middletext statsbar', $option['voted_this'] ? ' voted' : '', '">';
+						<dt class="', $option['voted_this'] ? ' voted' : '', '">', $option['option'], '</dt>
+						<dd class="statsbar', $option['voted_this'] ? ' voted' : '', '">';
 
-				if ($context['allow_poll_view'])
+				if ($context['allow_results_view'])
 					echo '
 							', $option['bar_ndt'], '
 							<span class="percentage">', $option['votes'], ' (', $option['percent'], '%)</span>';
@@ -70,7 +93,7 @@
 			echo '
 					</dl>';
 
-			if ($context['allow_poll_view'])
+			if ($context['allow_results_view'])
 				echo '
 						<p><strong>', $txt['poll_total_voters'], ':</strong> ', $context['poll']['total_votes'], '</p>';
 		}
@@ -91,13 +114,13 @@
 			// Show each option with its button - a radio likely.
 			foreach ($context['poll']['options'] as $option)
 				echo '
-								<li class="middletext">', $option['vote_button'], ' <label for="', $option['id'], '">', $option['option'], '</label></li>';
+								<li>', $option['vote_button'], ' <label for="', $option['id'], '">', $option['option'], '</label></li>';
 
 			echo '
 							</ul>
 							<div class="submitbutton">
-								<input type="submit" value="', $txt['poll_vote'], '" class="button_submit" />
-								<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+								<input type="submit" value="', $txt['poll_vote'], '" class="button_submit">
+								<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 							</div>
 						</form>';
 		}
@@ -109,22 +132,11 @@
 
 		echo '
 					</div>
-					<span class="botslice"><span></span></span>
 				</div>
 			</div>
 			<div id="pollmoderation">';
 
-		// Build the poll moderation button array.
-		$poll_buttons = array(
-			'vote' => array('test' => 'allow_return_vote', 'text' => 'poll_return_vote', 'image' => 'poll_options.gif', 'lang' => true, 'url' => $scripturl . '?topic=' . $context['current_topic'] . '.' . $context['start']),
-			'results' => array('test' => 'show_view_results_button', 'text' => 'poll_results', 'image' => 'poll_results.gif', 'lang' => true, 'url' => $scripturl . '?topic=' . $context['current_topic'] . '.' . $context['start'] . ';viewresults'),
-			'change_vote' => array('test' => 'allow_change_vote', 'text' => 'poll_change_vote', 'image' => 'poll_change_vote.gif', 'lang' => true, 'url' => $scripturl . '?action=vote;topic=' . $context['current_topic'] . '.' . $context['start'] . ';poll=' . $context['poll']['id'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-			'lock' => array('test' => 'allow_lock_poll', 'text' => (!$context['poll']['is_locked'] ? 'poll_lock' : 'poll_unlock'), 'image' => 'poll_lock.gif', 'lang' => true, 'url' => $scripturl . '?action=lockvoting;topic=' . $context['current_topic'] . '.' . $context['start'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-			'edit' => array('test' => 'allow_edit_poll', 'text' => 'poll_edit', 'image' => 'poll_edit.gif', 'lang' => true, 'url' => $scripturl . '?action=editpoll;topic=' . $context['current_topic'] . '.' . $context['start']),
-			'remove_poll' => array('test' => 'can_remove_poll', 'text' => 'poll_remove', 'image' => 'admin_remove_poll.gif', 'lang' => true, 'custom' => 'onclick="return confirm(\'' . $txt['poll_remove_warn'] . '\');"', 'url' => $scripturl . '?action=removepoll;topic=' . $context['current_topic'] . '.' . $context['start'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-		);
-
-		template_button_strip($poll_buttons);
+		template_button_strip($context['poll_buttons']);
 
 		echo '
 			</div>';
@@ -134,750 +146,806 @@
 	if (!empty($context['linked_calendar_events']))
 	{
 		echo '
-			<div class="linked_events">
-				<div class="title_bar">
-					<h3 class="titlebg headerpadding">', $txt['calendar_linked_events'], '</h3>
-				</div>
-				<div class="windowbg">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<ul class="reset">';
+			<div class="title_bar">
+				<h3 class="titlebg">', $txt['calendar_linked_events'], '</h3>
+			</div>
+			<div class="information">
+				<ul class="reset">';
 
 		foreach ($context['linked_calendar_events'] as $event)
 			echo '
-							<li>
-								', ($event['can_edit'] ? '<a href="' . $event['modify_href'] . '"> <img src="' . $settings['images_url'] . '/icons/modify_small.gif" alt="" title="' . $txt['modify'] . '" class="edit_event" /></a> ' : ''), '<strong>', $event['title'], '</strong>: ', $event['start_date'], ($event['start_date'] != $event['end_date'] ? ' - ' . $event['end_date'] : ''), '
-							</li>';
+					<li>
+						', ($event['can_edit'] ? '<a href="' . $event['modify_href'] . '"><span class="generic_icons calendar_modify"></span></a> ' : ''), '<strong>', $event['title'], '</strong>: ', $event['start_date'], ($event['start_date'] != $event['end_date'] ? ' - ' . $event['end_date'] : ''), '
+					</li>';
 
 		echo '
-						</ul>
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
+				</ul>
 			</div>';
 	}
 
-	// Build the normal button array.
-	$normal_buttons = array(
-		'reply' => array('test' => 'can_reply', 'text' => 'reply', 'image' => 'reply.gif', 'lang' => true, 'url' => $scripturl . '?action=post;topic=' . $context['current_topic'] . '.' . $context['start'] . ';last_msg=' . $context['topic_last_message'], 'active' => true),
-		'add_poll' => array('test' => 'can_add_poll', 'text' => 'add_poll', 'image' => 'add_poll.gif', 'lang' => true, 'url' => $scripturl . '?action=editpoll;add;topic=' . $context['current_topic'] . '.' . $context['start']),
-		'notify' => array('test' => 'can_mark_notify', 'text' => $context['is_marked_notify'] ? 'unnotify' : 'notify', 'image' => ($context['is_marked_notify'] ? 'un' : '') . 'notify.gif', 'lang' => true, 'custom' => 'onclick="return confirm(\'' . ($context['is_marked_notify'] ? $txt['notification_disable_topic'] : $txt['notification_enable_topic']) . '\');"', 'url' => $scripturl . '?action=notify;sa=' . ($context['is_marked_notify'] ? 'off' : 'on') . ';topic=' . $context['current_topic'] . '.' . $context['start'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-		'mark_unread' => array('test' => 'can_mark_unread', 'text' => 'mark_unread', 'image' => 'markunread.gif', 'lang' => true, 'url' => $scripturl . '?action=markasread;sa=topic;t=' . $context['mark_unread_time'] . ';topic=' . $context['current_topic'] . '.' . $context['start'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-		'send' => array('test' => 'can_send_topic', 'text' => 'send_topic', 'image' => 'sendtopic.gif', 'lang' => true, 'url' => $scripturl . '?action=emailuser;sa=sendtopic;topic=' . $context['current_topic'] . '.0'),
-		'print' => array('text' => 'print', 'image' => 'print.gif', 'lang' => true, 'custom' => 'rel="new_win nofollow"', 'url' => $scripturl . '?action=printpage;topic=' . $context['current_topic'] . '.0'),
-	);
+	// Show the page index... "Pages: [1]".
+	echo '
+			<div class="pagesection top">
+				', template_button_strip($context['normal_buttons'], 'right'), '
+				', $context['menu_separator'], '<a href="#bot" class="topbottom floatleft">', $txt['go_down'], '</a>
+				<div class="pagelinks floatleft">
+					', $context['page_index'], '
+				</div>
+			</div>';
+
+	// Show the topic information - icon, subject, etc.
+	echo '
+			<div id="forumposts">';
+
+	echo '
+				<form action="', $scripturl, '?action=quickmod2;topic=', $context['current_topic'], '.', $context['start'], '" method="post" accept-charset="', $context['character_set'], '" name="quickModForm" id="quickModForm" onsubmit="return oQuickModify.bInEditMode ? oQuickModify.modifySave(\'' . $context['session_id'] . '\', \'' . $context['session_var'] . '\') : false">';
+
+	$context['ignoredMsgs'] = array();
+	$context['removableMessageIDs'] = array();
 
-	// Allow adding new buttons easily.
-	call_integration_hook('integrate_display_buttons', array(&$normal_buttons));
+	// Get all the messages...
+	while ($message = $context['get_message']())
+		template_single_post($message);
+
+	echo '
+				</form>
+			</div>';
 
 	// Show the page index... "Pages: [1]".
 	echo '
 			<div class="pagesection">
-				<div class="nextlinks">', $context['previous_next'], '</div>', template_button_strip($normal_buttons, 'right'), '
-				<div class="pagelinks floatleft">', $txt['pages'], ': ', $context['page_index'], !empty($modSettings['topbottomEnable']) ? $context['menu_separator'] . ' &nbsp;&nbsp;<a href="#lastPost"><strong>' . $txt['go_down'] . '</strong></a>' : '', '</div>
+				', template_button_strip($context['normal_buttons'], 'right'), '
+				', $context['menu_separator'], '<a href="#main_content_section" class="topbottom floatleft" id="bot">', $txt['go_up'], '</a>
+				<div class="pagelinks floatleft">
+					', $context['page_index'], '
+				</div>
 			</div>';
 
-	// Show the topic information - icon, subject, etc.
+	// Show the lower breadcrumbs.
+	theme_linktree();
+
 	echo '
-			<div id="forumposts">
-				<div class="cat_bar">
-					<h3 class="catbg">
-						<img src="', $settings['images_url'], '/topic/', $context['class'], '.gif" align="bottom" alt="" />
-						<span id="author">', $txt['author'], '</span>
-						', $txt['topic'], ': ', $context['subject'], ' &nbsp;(', $txt['read'], ' ', $context['num_views'], ' ', $txt['times'], ')
-					</h3>
-				</div>';
+			<div id="moderationbuttons">
+				', template_button_strip($context['mod_buttons'], 'bottom', array('id' => 'moderationbuttons_strip')), '
+			</div>';
+
+	// Show the jumpto box, or actually...let Javascript do it.
+	echo '
+			<div id="display_jump_to">&nbsp;</div>';
+
+	// Show quickreply
+	if ($context['can_reply'])
+	template_quickreply();
 
-	if (!empty($settings['display_who_viewing']))
-	{
 		echo '
-				<p id="whoisviewing" class="smalltext">';
+				<script><!-- // --><![CDATA[';
 
-		// Show just numbers...?
-		if ($settings['display_who_viewing'] == 1)
-				echo count($context['view_members']), ' ', count($context['view_members']) == 1 ? $txt['who_member'] : $txt['members'];
-		// Or show the actual people viewing the topic?
-		else
-			echo empty($context['view_members_list']) ? '0 ' . $txt['members'] : implode(', ', $context['view_members_list']) . ((empty($context['view_num_hidden']) || $context['can_moderate_forum']) ? '' : ' (+ ' . $context['view_num_hidden'] . ' ' . $txt['hidden'] . ')');
+	if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1 && $context['can_remove_post'])
+		echo '
+					var oInTopicModeration = new InTopicModeration({
+						sSelf: \'oInTopicModeration\',
+						sCheckboxContainerMask: \'in_topic_mod_check_\',
+						aMessageIds: [\'', implode('\', \'', $context['removableMessageIDs']), '\'],
+						sSessionId: smf_session_id,
+						sSessionVar: smf_session_var,
+						sButtonStrip: \'moderationbuttons\',
+						sButtonStripDisplay: \'moderationbuttons_strip\',
+						bUseImageButton: false,
+						bCanRemove: ', $context['can_remove_post'] ? 'true' : 'false', ',
+						sRemoveButtonLabel: \'', $txt['quickmod_delete_selected'], '\',
+						sRemoveButtonImage: \'delete_selected.png\',
+						sRemoveButtonConfirm: \'', $txt['quickmod_confirm'], '\',
+						bCanRestore: ', $context['can_restore_msg'] ? 'true' : 'false', ',
+						sRestoreButtonLabel: \'', $txt['quick_mod_restore'], '\',
+						sRestoreButtonImage: \'restore_selected.png\',
+						sRestoreButtonConfirm: \'', $txt['quickmod_confirm'], '\',
+						bCanSplit: ', $context['can_split'] ? 'true' : 'false', ',
+						sSplitButtonLabel: \'', $txt['quickmod_split_selected'], '\',
+						sSplitButtonImage: \'split_selected.png\',
+						sSplitButtonConfirm: \'', $txt['quickmod_confirm'], '\',
+						sFormId: \'quickModForm\'
+					});';
 
-		// Now show how many guests are here too.
-		echo $txt['who_and'], $context['view_num_guests'], ' ', $context['view_num_guests'] == 1 ? $txt['guest'] : $txt['guests'], $txt['who_viewing_topic'], '
-				</p>';
-	}
+	echo '
+					if (\'XMLHttpRequest\' in window)
+					{
+						var oQuickModify = new QuickModify({
+							sScriptUrl: smf_scripturl,
+							sClassName: \'quick_edit\',
+							bShowModify: ', $modSettings['show_modify'] ? 'true' : 'false', ',
+							iTopicId: ', $context['current_topic'], ',
+							sTemplateBodyEdit: ', JavaScriptEscape('
+								<div id="quick_edit_body_container">
+									<div id="error_box" class="error"></div>
+									<textarea class="editor" name="message" rows="12" style="margin-bottom: 10px;" tabindex="' . $context['tabindex']++ . '">%body%</textarea><br>
+									<input type="hidden" name="' . $context['session_var']  . '" value="' . $context['session_id'] . '">
+									<input type="hidden" name="topic" value="' . $context['current_topic'] . '">
+									<input type="hidden" name="msg" value="%msg_id%">
+									<div class="righttext">
+										<input type="submit" name="post" value="' . $txt['save'] . '" tabindex="' . $context['tabindex']++ . '" onclick="return oQuickModify.modifySave(\'' . $context['session_id'] . '\', \'' . $context['session_var'] . '\');" accesskey="s" class="button_submit">&nbsp;&nbsp;' . ($context['show_spellchecking'] ? '<input type="button" value="' . $txt['spell_check'] . '" tabindex="' . $context['tabindex']++ . '" onclick="spellCheck(\'quickModForm\', \'message\');" class="button_submit">&nbsp;&nbsp;' : '') . '<input type="submit" name="cancel" value="' . $txt['modify_cancel'] . '" tabindex="' . $context['tabindex']++ . '" onclick="return oQuickModify.modifyCancel();" class="button_submit">
+									</div>
+								</div>'), ',
+							sTemplateSubjectEdit: ', JavaScriptEscape('<input type="text" name="subject" value="%subject%" size="80" maxlength="80" tabindex="' . $context['tabindex']++ . '" class="input_text">'), ',
+							sTemplateBodyNormal: ', JavaScriptEscape('%body%'), ',
+							sTemplateSubjectNormal: ', JavaScriptEscape('<a href="' . $scripturl . '?topic=' . $context['current_topic'] . '.msg%msg_id%#msg%msg_id%" rel="nofollow">%subject%</a>'), ',
+							sTemplateTopSubject: ', JavaScriptEscape($txt['topic'] . ': %subject% &nbsp;(' . $context['num_views_text'] . ')'), ',
+							sTemplateReasonEdit: ', JavaScriptEscape('<input type="text" name="modify_reason" value="%modify_reason%" size="80" maxlength="80" tabindex="' . $context['tabindex']++ . '" class="input_text">)'), ',
+							sTemplateReasonNormal: ', JavaScriptEscape('%modify_text'), ',
+							sErrorBorderStyle: ', JavaScriptEscape('1px solid red'), ($context['can_reply']) ? ',
+							sFormRemoveAccessKeys: \'postmodify\'' : '', '
+						});
+
+						aJumpTo[aJumpTo.length] = new JumpTo({
+							sContainerId: "display_jump_to",
+							sJumpToTemplate: "<label class=\"smalltext jump_to\" for=\"%select_id%\">', $context['jump_to']['label'], '<" + "/label> %dropdown_list%",
+							iCurBoardId: ', $context['current_board'], ',
+							iCurBoardChildLevel: ', $context['jump_to']['child_level'], ',
+							sCurBoardName: "', $context['jump_to']['board_name'], '",
+							sBoardChildLevelIndicator: "==",
+							sBoardPrefix: "=> ",
+							sCatSeparator: "-----------------------------",
+							sCatPrefix: "",
+							sGoButtonLabel: "', $txt['go'], '"
+						});
+
+						aIconLists[aIconLists.length] = new IconList({
+							sBackReference: "aIconLists[" + aIconLists.length + "]",
+							sIconIdPrefix: "msg_icon_",
+							sScriptUrl: smf_scripturl,
+							bShowModify: ', !empty($modSettings['show_modify']) ? 'true' : 'false', ',
+							iBoardId: ', $context['current_board'], ',
+							iTopicId: ', $context['current_topic'], ',
+							sSessionId: smf_session_id,
+							sSessionVar: smf_session_var,
+							sLabelIconList: "', $txt['message_icon'], '",
+							sBoxBackground: "transparent",
+							sBoxBackgroundHover: "#ffffff",
+							iBoxBorderWidthHover: 1,
+							sBoxBorderColorHover: "#adadad" ,
+							sContainerBackground: "#ffffff",
+							sContainerBorder: "1px solid #adadad",
+							sItemBorder: "1px solid #ffffff",
+							sItemBorderHover: "1px dotted gray",
+							sItemBackground: "transparent",
+							sItemBackgroundHover: "#e0e0f0"
+						});
+					}';
+
+	if (!empty($context['ignoredMsgs']))
+		echo '
+					ignore_toggles([', implode(', ', $context['ignoredMsgs']), '], ', JavaScriptEscape($txt['show_ignore_user_post']), ');';
 
 	echo '
-				<form action="', $scripturl, '?action=quickmod2;topic=', $context['current_topic'], '.', $context['start'], '" method="post" accept-charset="', $context['character_set'], '" name="quickModForm" id="quickModForm" style="margin: 0;" onsubmit="return oQuickModify.bInEditMode ? oQuickModify.modifySave(\'' . $context['session_id'] . '\', \'' . $context['session_var'] . '\') : false">';
+				// ]]></script>';
 
-	$ignoredMsgs = array();
-	$removableMessageIDs = array();
-	$alternate = false;
+}
 
-	// Get all the messages...
-	while ($message = $context['get_message']())
-	{
-		$ignoring = false;
-		$alternate = !$alternate;
-		if ($message['can_remove'])
-			$removableMessageIDs[] = $message['id'];
+function template_single_post($message)
+{
+	global $context, $settings, $options, $txt, $scripturl, $modSettings;
 
-		// Are we ignoring this message?
-		if (!empty($message['is_ignored']))
-		{
-			$ignoring = true;
-			$ignoredMsgs[] = $message['id'];
-		}
+	$ignoring = false;
 
-		// Show the message anchor and a "new" anchor if this message is new.
-		if ($message['id'] != $context['first_message'])
-			echo '
-				<a id="msg', $message['id'], '"></a>', $message['first_new'] ? '<a id="new"></a>' : '';
+	if ($message['can_remove'])
+		$context['removableMessageIDs'][] = $message['id'];
 
-		echo '
-				<div class="', $message['approved'] ? ($message['alternate'] == 0 ? 'windowbg' : 'windowbg2') : 'approvebg', '">
-					<span class="topslice"><span></span></span>
+	// Are we ignoring this message?
+	if (!empty($message['is_ignored']))
+	{
+		$ignoring = true;
+		$context['ignoredMsgs'][] = $message['id'];
+	}
+
+	// Show the message anchor and a "new" anchor if this message is new.
+	echo '
+				<div class="', $message['approved'] ? 'windowbg' : 'approvebg', '">', $message['id'] != $context['first_message'] ? '
+					<a id="msg' . $message['id'] . '"></a>' . ($message['first_new'] ? '<a id="new"></a>' : '') : '', '
 					<div class="post_wrapper">';
 
-		// Show information about the poster of this message.
+	// Show information about the poster of this message.
+	echo '
+						<div class="poster">';
+
+	// Are there any custom fields above the member name?
+	if (!empty($message['custom_fields']['above_member']))
+	{
 		echo '
-						<div class="poster">
-							<h4>';
+							<div class="custom_fields_above_member">
+								<ul class="reset nolist">';
 
-		// Show online and offline buttons?
-		if (!empty($modSettings['onlineEnable']) && !$message['member']['is_guest'])
+		foreach ($message['custom_fields']['above_member'] as $custom)
 			echo '
-								', $context['can_send_pm'] ? '<a href="' . $message['member']['online']['href'] . '" title="' . $message['member']['online']['label'] . '">' : '', '<img src="', $message['member']['online']['image_href'], '" alt="', $message['member']['online']['text'], '" />', $context['can_send_pm'] ? '</a>' : '';
+									<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
+
+		echo '
+								</ul>
+							</div>';
+	}
+
+	echo '
+									<h4>';
 
-		// Show a link to the member's profile.
+	// Show online and offline buttons?
+	if (!empty($modSettings['onlineEnable']) && !$message['member']['is_guest'])
 		echo '
+								', $context['can_send_pm'] ? '<a href="' . $message['member']['online']['href'] . '" title="' . $message['member']['online']['label'] . '">' : '', '<span class="' . ($message['member']['online']['is_online'] == 1 ? 'on' : 'off') . '" title="' . $message['member']['online']['text'] . '"></span>', $context['can_send_pm'] ? '</a>' : '';
+
+
+	// Show a link to the member's profile.
+	echo '
 								', $message['member']['link'], '
-							</h4>
-							<ul class="reset smalltext" id="msg_', $message['id'], '_extra_info">';
+									</h4>';
 
-		// Show the member's custom title, if they have one.
-		if (!empty($message['member']['title']))
+	echo '
+							<ul class="user_info">';
+
+
+	// Show the user's avatar.
+	if (!empty($modSettings['show_user_images']) && empty($options['show_no_avatars']) && !empty($message['member']['avatar']['image']))
+		echo '
+								<li class="avatar">
+									<a href="', $scripturl, '?action=profile;u=', $message['member']['id'], '">', $message['member']['avatar']['image'], '</a>
+								</li>';
+
+	// Are there any custom fields below the avatar?
+	if (!empty($message['custom_fields']['below_avatar']))
+		foreach ($message['custom_fields']['below_avatar'] as $custom)
 			echo '
+								<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
+
+	// Show the post group icons, but not for guests.
+	if (!$message['member']['is_guest'])
+		echo '
+								<li class="icons">', $message['member']['group_icons'], '</li>';
+
+	// Show the member's primary group (like 'Administrator') if they have one.
+	if (!empty($message['member']['group']))
+		echo '
+								<li class="membergroup">', $message['member']['group'], '</li>';
+
+	// Show the member's custom title, if they have one.
+	if (!empty($message['member']['title']))
+		echo '
 								<li class="title">', $message['member']['title'], '</li>';
 
-		// Show the member's primary group (like 'Administrator') if they have one.
-		if (!empty($message['member']['group']))
+	// Don't show these things for guests.
+	if (!$message['member']['is_guest'])
+	{
+
+		// Show the post group if and only if they have no other group or the option is on, and they are in a post group.
+		if ((empty($modSettings['hide_post_group']) || $message['member']['group'] == '') && $message['member']['post_group'] != '')
 			echo '
-								<li class="membergroup">', $message['member']['group'], '</li>';
+								<li class="postgroup">', $message['member']['post_group'], '</li>';
+
+		// Show how many posts they have made.
+		if (!isset($context['disabled_fields']['posts']))
+			echo '
+								<li class="postcount">', $txt['member_postcount'], ': ', $message['member']['posts'], '</li>';
+
+		// Show their personal text?
+		if (!empty($modSettings['show_blurb']) && $message['member']['blurb'] != '')
+			echo '
+								<li class="blurb">', $message['member']['blurb'], '</li>';
 
-		// Don't show these things for guests.
-		if (!$message['member']['is_guest'])
+		// Any custom fields to show as icons?
+		if (!empty($message['custom_fields']['icons']))
 		{
-			// Show the post group if and only if they have no other group or the option is on, and they are in a post group.
-			if ((empty($settings['hide_post_group']) || $message['member']['group'] == '') && $message['member']['post_group'] != '')
-				echo '
-								<li class="postgroup">', $message['member']['post_group'], '</li>';
 			echo '
-								<li class="stars">', $message['member']['group_stars'], '</li>';
+								<li class="im_icons">
+									<ol>';
 
-			// Show avatars, images, etc.?
-			if (!empty($settings['show_user_images']) && empty($options['show_no_avatars']) && !empty($message['member']['avatar']['image']))
+			foreach ($message['custom_fields']['icons'] as $custom)
 				echo '
-								<li class="avatar">
-									<a href="', $scripturl, '?action=profile;u=', $message['member']['id'], '">
-										', $message['member']['avatar']['image'], '
-									</a>
+										<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
+
+			echo '
+									</ol>
 								</li>';
+		}
 
-			// Show how many posts they have made.
-			if (!isset($context['disabled_fields']['posts']))
-				echo '
-								<li class="postcount">', $txt['member_postcount'], ': ', $message['member']['posts'], '</li>';
+		// Show the website and email address buttons.
+		if ($message['member']['show_profile_buttons'])
+		{
+			echo '
+								<li class="profile">
+									<ol class="profile_icons">';
 
-			// Is karma display enabled?  Total or +/-?
-			if ($modSettings['karmaMode'] == '1')
+			// Don't show an icon if they haven't specified a website.
+			if ($message['member']['website']['url'] != '' && !isset($context['disabled_fields']['website']))
 				echo '
-								<li class="karma">', $modSettings['karmaLabel'], ' ', $message['member']['karma']['good'] - $message['member']['karma']['bad'], '</li>';
-			elseif ($modSettings['karmaMode'] == '2')
-				echo '
-								<li class="karma">', $modSettings['karmaLabel'], ' +', $message['member']['karma']['good'], '/-', $message['member']['karma']['bad'], '</li>';
+										<li><a href="', $message['member']['website']['url'], '" title="' . $message['member']['website']['title'] . '" target="_blank" class="new_win">', ($settings['use_image_buttons'] ? '<span class="generic_icons www centericon" title="' . $message['member']['website']['title'] . '"></span>' : $txt['www']), '</a></li>';
 
-			// Is this user allowed to modify this member's karma?
-			if ($message['member']['karma']['allow'])
+			// Since we know this person isn't a guest, you *can* message them.
+			if ($context['can_send_pm'])
 				echo '
-								<li class="karma_allow">
-									<a href="', $scripturl, '?action=modifykarma;sa=applaud;uid=', $message['member']['id'], ';topic=', $context['current_topic'], '.' . $context['start'], ';m=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $modSettings['karmaApplaudLabel'], '</a>
-									<a href="', $scripturl, '?action=modifykarma;sa=smite;uid=', $message['member']['id'], ';topic=', $context['current_topic'], '.', $context['start'], ';m=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $modSettings['karmaSmiteLabel'], '</a>
-								</li>';
+										<li><a href="', $scripturl, '?action=pm;sa=send;u=', $message['member']['id'], '" title="', $message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline'], '">', $settings['use_image_buttons'] ? '<span class="generic_icons im_' . ($message['member']['online']['is_online'] ? 'on' : 'off') . ' centericon" title="' . ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']) . '"></span> ' : ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']), '</a></li>';
 
-			// Show the member's gender icon?
-			if (!empty($settings['show_gender']) && $message['member']['gender']['image'] != '' && !isset($context['disabled_fields']['gender']))
+			// Show the email if necessary
+			if (!empty($message['member']['email']) && $message['member']['show_email'])
 				echo '
-								<li class="gender">', $txt['gender'], ': ', $message['member']['gender']['image'], '</li>';
+										<li class="email"><a href="mailto:' . $message['member']['email'] . '" rel="nofollow">', ($settings['use_image_buttons'] ? '<span class="generic_icons mail centericon" title="' . $txt['email'] . '"></span>' : $txt['email']), '</a></li>';
 
-			// Show their personal text?
-			if (!empty($settings['show_blurb']) && $message['member']['blurb'] != '')
 				echo '
-								<li class="blurb">', $message['member']['blurb'], '</li>';
-
-			// Any custom fields to show as icons?
-			if (!empty($message['member']['custom_fields']))
-			{
-				$shown = false;
-				foreach ($message['member']['custom_fields'] as $custom)
-				{
-					if ($custom['placement'] != 1 || empty($custom['value']))
-						continue;
-					if (empty($shown))
-					{
-						$shown = true;
-						echo '
-								<li class="im_icons">
-									<ul>';
-					}
-					echo '
-										<li>', $custom['value'], '</li>';
-				}
-				if ($shown)
-					echo '
-									</ul>
+									</ol>
 								</li>';
-			}
+		}
 
-			// This shows the popular messaging icons.
-			if ($message['member']['has_messenger'] && $message['member']['can_view_profile'])
+		// Any custom fields for standard placement?
+		if (!empty($message['custom_fields']['standard']))
+			foreach ($message['custom_fields']['standard'] as $custom)
 				echo '
-								<li class="im_icons">
-									<ul>
-										', !empty($message['member']['icq']['link']) ? '<li>' . $message['member']['icq']['link'] . '</li>' : '', '
-										', !empty($message['member']['msn']['link']) ? '<li>' . $message['member']['msn']['link'] . '</li>' : '', '
-										', !empty($message['member']['aim']['link']) ? '<li>' . $message['member']['aim']['link'] . '</li>' : '', '
-										', !empty($message['member']['yim']['link']) ? '<li>' . $message['member']['yim']['link'] . '</li>' : '', '
-									</ul>
-								</li>';
+								<li class="custom ', $custom['col_name'] ,'">', $custom['title'], ': ', $custom['value'], '</li>';
 
-			// Show the profile, website, email address, and personal message buttons.
-			if ($settings['show_profile_buttons'])
-			{
-				echo '
-								<li class="profile">
-									<ul>';
-				// Don't show the profile button if you're not allowed to view the profile.
-				if ($message['member']['can_view_profile'])
-					echo '
-										<li><a href="', $message['member']['href'], '">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/icons/profile_sm.gif" alt="' . $txt['view_profile'] . '" title="' . $txt['view_profile'] . '" />' : $txt['view_profile']), '</a></li>';
+	}
+	// Otherwise, show the guest's email.
+	elseif (!empty($message['member']['email']) && $message['member']['show_email'])
+		echo '
+								<li class="email"><a href="mailto:' . $message['member']['email'] . '" rel="nofollow">', ($settings['use_image_buttons'] ? '<span class="generic_icons mail centericon" title="' . $txt['email'] . '"></span>' : $txt['email']), '</a></li>';
 
-				// Don't show an icon if they haven't specified a website.
-				if ($message['member']['website']['url'] != '' && !isset($context['disabled_fields']['website']))
-					echo '
-										<li><a href="', $message['member']['website']['url'], '" title="' . $message['member']['website']['title'] . '" target="_blank" class="new_win">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/www_sm.gif" alt="' . $message['member']['website']['title'] . '" />' : $txt['www']), '</a></li>';
+	// Show the IP to this user for this post - because you can moderate?
+	if (!empty($context['can_moderate_forum']) && !empty($message['member']['ip']))
+		echo '
+								<li class="poster_ip"><a href="', $scripturl, '?action=', !empty($message['member']['is_guest']) ? 'trackip' : 'profile;area=tracking;sa=ip;u=' . $message['member']['id'], ';searchip=', $message['member']['ip'], '">', $message['member']['ip'], '</a> <a href="', $scripturl, '?action=helpadmin;help=see_admin_ip" onclick="return reqOverlayDiv(this.href);" class="help">(?)</a></li>';
 
-				// Don't show the email address if they want it hidden.
-				if (in_array($message['member']['show_email'], array('yes', 'yes_permission_override', 'no_through_forum')))
-					echo '
-										<li><a href="', $scripturl, '?action=emailuser;sa=email;msg=', $message['id'], '" rel="nofollow">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/email_sm.gif" alt="' . $txt['email'] . '" title="' . $txt['email'] . '" />' : $txt['email']), '</a></li>';
+	// Or, should we show it because this is you?
+	elseif ($message['can_see_ip'])
+		echo '
+								<li class="poster_ip"><a href="', $scripturl, '?action=helpadmin;help=see_member_ip" onclick="return reqOverlayDiv(this.href);" class="help">', $message['member']['ip'], '</a></li>';
 
-				// Since we know this person isn't a guest, you *can* message them.
-				if ($context['can_send_pm'])
-					echo '
-										<li><a href="', $scripturl, '?action=pm;sa=send;u=', $message['member']['id'], '" title="', $message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline'], '">', $settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/im_' . ($message['member']['online']['is_online'] ? 'on' : 'off') . '.gif" alt="' . ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']) . '" />' : ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']), '</a></li>';
+	// Okay, are you at least logged in?  Then we can show something about why IPs are logged...
+	elseif (!$context['user']['is_guest'])
+		echo '
+								<li class="poster_ip"><a href="', $scripturl, '?action=helpadmin;help=see_member_ip" onclick="return reqOverlayDiv(this.href);" class="help">', $txt['logged'], '</a></li>';
 
-				echo '
-									</ul>
-								</li>';
-			}
+	// Otherwise, you see NOTHING!
+	else
+		echo '
+								<li class="poster_ip">', $txt['logged'], '</li>';
 
-			// Any custom fields for standard placement?
-			if (!empty($message['member']['custom_fields']))
-			{
-				foreach ($message['member']['custom_fields'] as $custom)
-					if (empty($custom['placement']) || empty($custom['value']))
-						echo '
-								<li class="custom">', $custom['title'], ': ', $custom['value'], '</li>';
-			}
+	// Are we showing the warning status?
+	// Don't show these things for guests.
+	if (!$message['member']['is_guest'] && $message['member']['can_see_warning'])
+		echo '
+								<li class="warning">', $context['can_issue_warning'] ? '<a href="' . $scripturl . '?action=profile;area=issuewarning;u=' . $message['member']['id'] . '">' : '', '<span class="generic_icons warning_', $message['member']['warning_status'], '"></span> ', $context['can_issue_warning'] ? '</a>' : '', '<span class="warn_', $message['member']['warning_status'], '">', $txt['warn_' . $message['member']['warning_status']], '</span></li>';
 
-			// Are we showing the warning status?
-			if ($message['member']['can_see_warning'])
-				echo '
-								<li class="warning">', $context['can_issue_warning'] ? '<a href="' . $scripturl . '?action=profile;area=issuewarning;u=' . $message['member']['id'] . '">' : '', '<img src="', $settings['images_url'], '/warning_', $message['member']['warning_status'], '.gif" alt="', $txt['user_warn_' . $message['member']['warning_status']], '" />', $context['can_issue_warning'] ? '</a>' : '', '<span class="warn_', $message['member']['warning_status'], '">', $txt['warn_' . $message['member']['warning_status']], '</span></li>';
-		}
-		// Otherwise, show the guest's email.
-		elseif (!empty($message['member']['email']) && in_array($message['member']['show_email'], array('yes', 'yes_permission_override', 'no_through_forum')))
+	// Are there any custom fields to show at the bottom of the poster info?
+	if (!empty($message['custom_fields']['bottom_poster']))
+		foreach ($message['custom_fields']['bottom_poster'] as $custom)
 			echo '
-								<li class="email"><a href="', $scripturl, '?action=emailuser;sa=email;msg=', $message['id'], '" rel="nofollow">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/email_sm.gif" alt="' . $txt['email'] . '" title="' . $txt['email'] . '" />' : $txt['email']), '</a></li>';
+									<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
 
-		// Done with the information about the poster... on to the post itself.
-		echo '
-							</ul>
+	// Poster info ends.
+	echo '
+							</ul>';
+	echo '
 						</div>
 						<div class="postarea">
-							<div class="flow_hidden">
-								<div class="keyinfo">
-									<div class="messageicon">
-										<img src="', $message['icon_url'] . '" alt=""', $message['can_modify'] ? ' id="msg_icon_' . $message['id'] . '"' : '', ' />
-									</div>
-									<h5 id="subject_', $message['id'], '">
-										<a href="', $message['href'], '" rel="nofollow">', $message['subject'], '</a>
-									</h5>
-									<div class="smalltext">&#171; <strong>', !empty($message['counter']) ? $txt['reply_noun'] . ' #' . $message['counter'] : '', ' ', $txt['on'], ':</strong> ', $message['time'], ' &#187;</div>
-									<div id="msg_', $message['id'], '_quick_mod"></div>
+							<div class="keyinfo">
+								<div class="messageicon" ', ($message['icon_url'] !== $settings['images_url'] . '/post/xx.png') ? '' : 'style="position: absolute; z-index: -1;"', '>
+									<img src="', $message['icon_url'] . '" alt=""', $message['can_modify'] ? ' id="msg_icon_' . $message['id'] . '"' : '', '>
 								</div>';
 
-		// If this is the first post, (#0) just say when it was posted - otherwise give the reply #.
-		if ($message['can_approve'] || $context['can_reply'] || $message['can_modify'] || $message['can_remove'] || $context['can_split'] || $context['can_restore_msg'])
-			echo '
-								<ul class="reset smalltext quickbuttons">';
-
-		// Maybe we can approve it, maybe we should?
-		if ($message['can_approve'])
-			echo '
-									<li class="approve_button"><a href="', $scripturl, '?action=moderate;area=postmod;sa=approve;topic=', $context['current_topic'], '.', $context['start'], ';msg=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['approve'], '</a></li>';
+	//Some people don't want subject ... The div is still required or quick edit breaks...
+	echo '
+								<div id="subject_', $message['id'], '" class="subject_title">', (empty($modSettings['subject_toggle']) ? '' : '<a href="' . $message['href'] . '" rel="nofollow">' . $message['subject'] . '</a>'), '</div>';
 
-		// Can they reply? Have they turned on quick reply?
-		if ($context['can_quote'] && !empty($options['display_quick_reply']))
-			echo '
-									<li class="quote_button"><a href="', $scripturl, '?action=post;quote=', $message['id'], ';topic=', $context['current_topic'], '.', $context['start'], ';last_msg=', $context['topic_last_message'], '" onclick="return oQuickReply.quote(', $message['id'], ');">', $txt['quote'], '</a></li>';
+	echo '
+								<div class="page_number floatright">
+									', !empty($message['counter']) ? ' #' . $message['counter'] : '', ' ', '
+								</div>
+								<h5>
+									<a href="', $message['href'], '" rel="nofollow" title="', !empty($message['counter']) ? sprintf($txt['reply_number'], $message['counter']) : '', ' - ', $message['subject'], '" class="smalltext">', $message['time'], '</a>';
 
-		// So... quick reply is off, but they *can* reply?
-		elseif ($context['can_quote'])
-			echo '
-									<li class="quote_button"><a href="', $scripturl, '?action=post;quote=', $message['id'], ';topic=', $context['current_topic'], '.', $context['start'], ';last_msg=', $context['topic_last_message'], '">', $txt['quote'], '</a></li>';
+	// Show "<< Last Edit: Time by Person >>" if this post was edited. But we need the div even if it wasn't modified!
+	// Because we insert into it through AJAX and we don't want to stop themers moving it around if they so wish so they can put it where they want it.
+	echo '
+									<span class="smalltext modified" id="modified_', $message['id'], '">';
 
-		// Can the user modify the contents of this post?
-		if ($message['can_modify'])
-			echo '
-									<li class="modify_button"><a href="', $scripturl, '?action=post;msg=', $message['id'], ';topic=', $context['current_topic'], '.', $context['start'], '">', $txt['modify'], '</a></li>';
+	if (!empty($modSettings['show_modify']) && !empty($message['modified']['name']))
+		echo $message['modified']['last_edit_text'];
+	echo '</span>';
 
-		// How about... even... remove it entirely?!
-		if ($message['can_remove'])
-			echo '
-									<li class="remove_button"><a href="', $scripturl, '?action=deletemsg;topic=', $context['current_topic'], '.', $context['start'], ';msg=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['remove_message'], '?\');">', $txt['remove'], '</a></li>';
-
-		// What about splitting it off the rest of the topic?
-		if ($context['can_split'] && !empty($context['real_num_replies']))
-			echo '
-									<li class="split_button"><a href="', $scripturl, '?action=splittopics;topic=', $context['current_topic'], '.0;at=', $message['id'], '">', $txt['split'], '</a></li>';
-
-		// Can we restore topics?
-		if ($context['can_restore_msg'])
-			echo '
-									<li class="restore_button"><a href="', $scripturl, '?action=restoretopic;msgs=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['restore_message'], '</a></li>';
-
-		// Show a checkbox for quick moderation?
-		if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1 && $message['can_remove'])
-			echo '
-									<li class="inline_mod_check" style="display: none;" id="in_topic_mod_check_', $message['id'], '"></li>';
-
-		if ($message['can_approve'] || $context['can_reply'] || $message['can_modify'] || $message['can_remove'] || $context['can_split'] || $context['can_restore_msg'])
-			echo '
-								</ul>';
+	echo '
+								</h5>
+								<div id="msg_', $message['id'], '_quick_mod"', $ignoring ? ' style="display:none;"' : '', '></div>
+							</div>';
 
+	// Ignoring this user? Hide the post.
+	if ($ignoring)
 		echo '
-							</div>';
-
-		// Ignoring this user? Hide the post.
-		if ($ignoring)
-			echo '
 							<div id="msg_', $message['id'], '_ignored_prompt">
 								', $txt['ignoring_user'], '
 								<a href="#" id="msg_', $message['id'], '_ignored_link" style="display: none;">', $txt['show_ignore_user_post'], '</a>
 							</div>';
 
-		// Show the post itself, finally!
-		echo '
+	// Show the post itself, finally!
+	echo '
 							<div class="post">';
 
-		if (!$message['approved'] && $message['member']['id'] != 0 && $message['member']['id'] == $context['user']['id'])
-			echo '
+	if (!$message['approved'] && $message['member']['id'] != 0 && $message['member']['id'] == $context['user']['id'])
+		echo '
 								<div class="approve_post">
 									', $txt['post_awaiting_approval'], '
 								</div>';
-		echo '
-								<div class="inner" id="msg_', $message['id'], '"', '>', $message['body'], '</div>
+	echo '
+								<div class="inner" id="msg_', $message['id'], '"', $ignoring ? ' style="display:none;"' : '', '>', $message['body'], '</div>
 							</div>';
 
-		// Can the user modify the contents of this post?  Show the modify inline image.
-		if ($message['can_modify'])
-			echo '
-							<img src="', $settings['images_url'], '/icons/modify_inline.gif" alt="', $txt['modify_msg'], '" title="', $txt['modify_msg'], '" class="modifybutton" id="modify_button_', $message['id'], '" style="cursor: ', ($context['browser']['is_ie5'] || $context['browser']['is_ie5.5'] ? 'hand' : 'pointer'), '; display: none;" onclick="oQuickModify.modifyMsg(\'', $message['id'], '\')" />';
+	// Assuming there are attachments...
+	if (!empty($message['attachment']))
+	{
+		echo '
+							<div id="msg_', $message['id'], '_footer" class="attachments"', $ignoring ? ' style="display:none;"' : '', '>';
 
-		// Assuming there are attachments...
-		if (!empty($message['attachment']))
-		{
-			echo '
-							<div id="msg_', $message['id'], '_footer" class="attachments smalltext">
-								<div style="overflow: ', $context['browser']['is_firefox'] ? 'visible' : 'auto', ';">';
+		$last_approved_state = 1;
+		$attachments_per_line = 5;
+		$i = 0;
 
-			$last_approved_state = 1;
-			foreach ($message['attachment'] as $attachment)
+		foreach ($message['attachment'] as $attachment)
+		{
+			// Show a special box for unapproved attachments...
+			if ($attachment['is_approved'] != $last_approved_state)
 			{
-				// Show a special box for unapproved attachments...
-				if ($attachment['is_approved'] != $last_approved_state)
-				{
-					$last_approved_state = 0;
+				$last_approved_state = 0;
+				echo '
+								<fieldset>
+									<legend>', $txt['attach_awaiting_approve'];
+
+				if ($context['can_approve'])
 					echo '
-									<fieldset>
-										<legend>', $txt['attach_awaiting_approve'];
+										&nbsp;[<a href="', $scripturl, '?action=attachapprove;sa=all;mid=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['approve_all'], '</a>]';
 
-					if ($context['can_approve'])
-						echo '&nbsp;[<a href="', $scripturl, '?action=attachapprove;sa=all;mid=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['approve_all'], '</a>]';
+				echo '
+									</legend>';
+			}
 
-					echo '</legend>';
-				}
+			echo '
+									<div class="floatleft">';
 
-				if ($attachment['is_image'])
-				{
-					if ($attachment['thumbnail']['has_thumb'])
-						echo '
-										<a href="', $attachment['href'], ';image" id="link_', $attachment['id'], '" onclick="', $attachment['thumbnail']['javascript'], '"><img src="', $attachment['thumbnail']['href'], '" alt="" id="thumb_', $attachment['id'], '" /></a><br />';
-					else
-						echo '
-										<img src="' . $attachment['href'] . ';image" alt="" width="' . $attachment['width'] . '" height="' . $attachment['height'] . '"/><br />';
-				}
+			if ($attachment['is_image'])
+			{
 				echo '
-										<a href="' . $attachment['href'] . '"><img src="' . $settings['images_url'] . '/icons/clip.gif" align="middle" alt="*" />&nbsp;' . $attachment['name'] . '</a> ';
+										<div class="attachments_top">';
 
-				if (!$attachment['is_approved'] && $context['can_approve'])
+				if ($attachment['thumbnail']['has_thumb'])
+					echo '
+											<a href="', $attachment['href'], ';image" id="link_', $attachment['id'], '" onclick="', $attachment['thumbnail']['javascript'], '"><img src="', $attachment['thumbnail']['href'], '" alt="" id="thumb_', $attachment['id'], '"></a>';
+				else
 					echo '
-										[<a href="', $scripturl, '?action=attachapprove;sa=approve;aid=', $attachment['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['approve'], '</a>]&nbsp;|&nbsp;[<a href="', $scripturl, '?action=attachapprove;sa=reject;aid=', $attachment['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['delete'], '</a>] ';
+											<img src="' . $attachment['href'] . ';image" alt="" width="' . $attachment['width'] . '" height="' . $attachment['height'] . '"/>';
+
 				echo '
-										(', $attachment['size'], ($attachment['is_image'] ? ', ' . $attachment['real_width'] . 'x' . $attachment['real_height'] . ' - ' . $txt['attach_viewed'] : ' - ' . $txt['attach_downloaded']) . ' ' . $attachment['downloads'] . ' ' . $txt['attach_times'] . '.)<br />';
+										</div>';
 			}
 
-			// If we had unapproved attachments clean up.
-			if ($last_approved_state == 0)
+			echo '
+										<div class="attachments_bot">
+											<a href="' . $attachment['href'] . '"><img src="' . $settings['images_url'] . '/icons/clip.png" class="centericon" alt="*">&nbsp;' . $attachment['name'] . '</a> ';
+
+			if (!$attachment['is_approved'] && $context['can_approve'])
 				echo '
-									</fieldset>';
+											[<a href="', $scripturl, '?action=attachapprove;sa=approve;aid=', $attachment['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['approve'], '</a>]&nbsp;|&nbsp;[<a href="', $scripturl, '?action=attachapprove;sa=reject;aid=', $attachment['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['delete'], '</a>] ';
+			echo '
+											<br>', $attachment['size'], ($attachment['is_image'] ? ', ' . $attachment['real_width'] . 'x' . $attachment['real_height'] . '<br>' . sprintf($txt['attach_viewed'], $attachment['downloads']) : '<br>' . sprintf($txt['attach_downloaded'], $attachment['downloads'])), '
+										</div>';
 
 			echo '
-								</div>
-							</div>';
+									</div>';
+
+			// Next attachment line ?
+			if (++$i % $attachments_per_line === 0)
+				echo '
+									<br>';
 		}
 
+		// If we had unapproved attachments clean up.
+		if ($last_approved_state == 0)
+			echo '
+								</fieldset>';
+
 		echo '
-						</div>
-						<div class="moderatorbar">
-							<div class="smalltext modified" id="modified_', $message['id'], '">';
+							</div>';
+	}
 
-		// Show " Last Edit: Time by Person " if this post was edited.
-		if ($settings['show_modify'] && !empty($message['modified']['name']))
-			echo '
-								&#171; <em>', $txt['last_edit'], ': ', $message['modified']['time'], ' ', $txt['by'], ' ', $message['modified']['name'], '</em> &#187;';
+	// And stuff below the attachments.
+	if ($context['can_report_moderator'] || !empty($context['can_see_likes']) || !empty($context['can_like']) || $message['can_approve'] || $message['can_unapprove'] || $context['can_reply'] || $message['can_modify'] || $message['can_remove'] || $context['can_split'] || $context['can_restore_msg'] || $context['can_quote'])
+	echo '
+							<div class="under_message">';
 
+	// Maybe they want to report this post to the moderator(s)?
+	if ($context['can_report_moderator'])
 		echo '
-							</div>
-							<div class="smalltext reportlinks">';
+								<ul class="floatright smalltext">
+									<li class="report_link"><a href="', $scripturl, '?action=reporttm;topic=', $context['current_topic'], '.', $message['counter'], ';msg=', $message['id'], '">', $txt['report_to_mod'], '</a></li>
+								</ul>';
+
+	// What about likes?
+	if (!empty($modSettings['enable_likes']))
+	{
+		echo '
+								<ul class="floatleft">';
 
-		// Maybe they want to report this post to the moderator(s)?
-		if ($context['can_report_moderator'])
+		if (!empty($message['likes']['can_like']))
+		{
 			echo '
-								<a href="', $scripturl, '?action=reporttm;topic=', $context['current_topic'], '.', $message['counter'], ';msg=', $message['id'], '">', $txt['report_to_mod'], '</a> &nbsp;';
+									<li class="like_button" id="msg_', $message['id'], '_likes"', $ignoring ? ' style="display:none;"' : '', '><a href="', $scripturl, '?action=likes;ltype=msg;sa=like;like=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '" class="msg_like"><span class="generic_icons ', $message['likes']['you'] ? 'unlike' : 'like', '"></span> ', $message['likes']['you'] ? $txt['unlike'] : $txt['like'], '</a></li>';
+		}
+
+		if (!empty($message['likes']['count']) && !empty($context['can_see_likes']))
+		{
+			$context['some_likes'] = true;
+			$count = $message['likes']['count'];
+			$base = 'likes_';
+			if ($message['likes']['you'])
+			{
+				$base = 'you_' . $base;
+				$count--;
+			}
+			$base .= (isset($txt[$base . $count])) ? $count : 'n';
 
-		// Can we issue a warning because of this post?  Remember, we can't give guests warnings.
-		if ($context['can_issue_warning'] && !$message['is_message_author'] && !$message['member']['is_guest'])
 			echo '
-								<a href="', $scripturl, '?action=profile;area=issuewarning;u=', $message['member']['id'], ';msg=', $message['id'], '"><img src="', $settings['images_url'], '/warn.gif" alt="', $txt['issue_warning_post'], '" title="', $txt['issue_warning_post'], '" /></a>';
+									<li class="like_count smalltext">', sprintf($txt[$base], $scripturl . '?action=likes;sa=view;ltype=msg;like=' . $message['id'] .';'. $context['session_var'] .'='. $context['session_id'], comma_format($count)), '</li>';
+		}
+
 		echo '
-								<img src="', $settings['images_url'], '/ip.gif" alt="" />';
+								</ul>';
+	}
 
-		// Show the IP to this user for this post - because you can moderate?
-		if ($context['can_moderate_forum'] && !empty($message['member']['ip']))
-			echo '
-								<a href="', $scripturl, '?action=', !empty($message['member']['is_guest']) ? 'trackip' : 'profile;area=tracking;sa=ip;u=' . $message['member']['id'], ';searchip=', $message['member']['ip'], '">', $message['member']['ip'], '</a> <a href="', $scripturl, '?action=helpadmin;help=see_admin_ip" onclick="return reqWin(this.href);" class="help">(?)</a>';
-		// Or, should we show it because this is you?
-		elseif ($message['can_see_ip'])
+	// Show the quickbuttons, for various operations on posts.
+	if ($message['can_approve'] || $message['can_unapprove'] || $context['can_reply'] || $message['can_modify'] || $message['can_remove'] || $context['can_split'] || $context['can_restore_msg'] || $context['can_quote'])
+	{
+		echo '
+								<ul class="quickbuttons">';
+
+		// Can they reply?
+		if ($context['can_quote'])
 			echo '
-								<a href="', $scripturl, '?action=helpadmin;help=see_member_ip" onclick="return reqWin(this.href);" class="help">', $message['member']['ip'], '</a>';
-		// Okay, are you at least logged in?  Then we can show something about why IPs are logged...
-		elseif (!$context['user']['is_guest'])
+									<li><a href="', $scripturl, '?action=post;quote=', $message['id'], ';topic=', $context['current_topic'], '.', $context['start'], ';last_msg=', $context['topic_last_message'], '" onclick="return oQuickReply.quote(', $message['id'], ');" class="quote_button">', $txt['quote_action'], '</a></li>';
+
+		// Can the user modify the contents of this post?  Show the modify inline image.
+		if ($message['can_modify'])
 			echo '
-								<a href="', $scripturl, '?action=helpadmin;help=see_member_ip" onclick="return reqWin(this.href);" class="help">', $txt['logged'], '</a>';
-		// Otherwise, you see NOTHING!
-		else
+									<li class="quick_edit"><a title="', $txt['modify_msg'], '" class="modifybutton" id="modify_button_', $message['id'], '" onclick="oQuickModify.modifyMsg(\'', $message['id'], '\', \'', !empty($modSettings['toggle_subject']), '\')">', $txt['quick_edit'], '</a></li>';
+
+		if ($message['can_approve'] || $message['can_unapprove'] || $message['can_modify'] || $message['can_remove'] || $context['can_split'] || $context['can_restore_msg'])
 			echo '
-								', $txt['logged'];
+									<li class="post_options">', $txt['post_options'];
 
 		echo '
-							</div>';
+										<ul>';
 
-		// Are there any custom profile fields for above the signature?
-		if (!empty($message['member']['custom_fields']))
-		{
-			$shown = false;
-			foreach ($message['member']['custom_fields'] as $custom)
-			{
-				if ($custom['placement'] != 2 || empty($custom['value']))
-					continue;
-				if (empty($shown))
-				{
-					$shown = true;
-					echo '
-							<div class="custom_fields_above_signature">
-								<ul class="reset nolist">';
-				}
-				echo '
-									<li>', $custom['value'], '</li>';
-			}
-			if ($shown)
-				echo '
-								</ul>
-							</div>';
-		}
+		// Can the user modify the contents of this post?
+		if ($message['can_modify'])
+			echo '
+											<li><a href="', $scripturl, '?action=post;msg=', $message['id'], ';topic=', $context['current_topic'], '.', $context['start'], '" class="modify_button">', $txt['modify'], '</a></li>';
 
-		// Show the member's signature?
-		if (!empty($message['member']['signature']) && empty($options['show_no_signatures']) && $context['signature_enabled'])
+		// How about... even... remove it entirely?!
+		if ($context['can_delete'] && ($context['topic_first_message'] == $message['id']))
 			echo '
-							<div class="signature" id="msg_', $message['id'], '_signature">', $message['member']['signature'], '</div>';
+											<li><a href="', $scripturl, '?action=removetopic2;topic=', $context['current_topic'], '.', $context['start'], ';', $context['session_var'], '=', $context['session_id'], '" data-confirm="', $txt['are_sure_remove_topic'], '" class="remove_button you_sure">', $txt['remove_topic'],'</a></li>';
+		elseif ($message['can_remove'] && ($context['topic_first_message'] != $message['id']))
+			echo '
+											<li><a href="', $scripturl, '?action=deletemsg;topic=', $context['current_topic'], '.', $context['start'], ';msg=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '" data-confirm="', $txt['remove_message_question'] ,'" class="remove_button you_sure">', $txt['remove'], '</a></li>';
 
-		echo '
-						</div>
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
-				<hr class="post_separator" />';
-	}
+		// What about splitting it off the rest of the topic?
+		if ($context['can_split'] && !empty($context['real_num_replies']))
+			echo '
+											<li><a href="', $scripturl, '?action=splittopics;topic=', $context['current_topic'], '.0;at=', $message['id'], '" class="split_button">', $txt['split'], '</a></li>';
 
-	echo '
-				</form>
-			</div>
-			<a id="lastPost"></a>';
+		// Can we issue a warning because of this post?  Remember, we can't give guests warnings.
+		if ($context['can_issue_warning'] && !$message['is_message_author'] && !$message['member']['is_guest'])
+			echo '
+											<li><a href="', $scripturl, '?action=profile;area=issuewarning;u=', $message['member']['id'], ';msg=', $message['id'], '" class="warn_button">', $txt['issue_warning'], '</a></li>';
 
-	// Show the page index... "Pages: [1]".
-	echo '
-			<div class="pagesection">
-				', template_button_strip($normal_buttons, 'right'), '
-				<div class="pagelinks floatleft">', $txt['pages'], ': ', $context['page_index'], !empty($modSettings['topbottomEnable']) ? $context['menu_separator'] . ' &nbsp;&nbsp;<a href="#top"><strong>' . $txt['go_up'] . '</strong></a>' : '', '</div>
-				<div class="nextlinks_bottom">', $context['previous_next'], '</div>
-			</div>';
+		// Can we restore topics?
+		if ($context['can_restore_msg'])
+			echo '
+											<li><a href="', $scripturl, '?action=restoretopic;msgs=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '" class="restore_button">', $txt['restore_message'], '</a></li>';
 
-	// Show the lower breadcrumbs.
-	theme_linktree();
+		// Maybe we can approve it, maybe we should?
+		if ($message['can_approve'])
+			echo '
+											<li><a href="', $scripturl, '?action=moderate;area=postmod;sa=approve;topic=', $context['current_topic'], '.', $context['start'], ';msg=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '"  class="approve_button">', $txt['approve'], '</a></li>';
+
+		// Maybe we can unapprove it?
+		if ($message['can_unapprove'])
+			echo '
+											<li><a href="', $scripturl, '?action=moderate;area=postmod;sa=approve;topic=', $context['current_topic'], '.', $context['start'], ';msg=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '"  class="unapprove_button">', $txt['unapprove'], '</a></li>';
 
-	$mod_buttons = array(
-		'move' => array('test' => 'can_move', 'text' => 'move_topic', 'image' => 'admin_move.gif', 'lang' => true, 'url' => $scripturl . '?action=movetopic;topic=' . $context['current_topic'] . '.0'),
-		'delete' => array('test' => 'can_delete', 'text' => 'remove_topic', 'image' => 'admin_rem.gif', 'lang' => true, 'custom' => 'onclick="return confirm(\'' . $txt['are_sure_remove_topic'] . '\');"', 'url' => $scripturl . '?action=removetopic2;topic=' . $context['current_topic'] . '.0;' . $context['session_var'] . '=' . $context['session_id']),
-		'lock' => array('test' => 'can_lock', 'text' => empty($context['is_locked']) ? 'set_lock' : 'set_unlock', 'image' => 'admin_lock.gif', 'lang' => true, 'url' => $scripturl . '?action=lock;topic=' . $context['current_topic'] . '.' . $context['start'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-		'sticky' => array('test' => 'can_sticky', 'text' => empty($context['is_sticky']) ? 'set_sticky' : 'set_nonsticky', 'image' => 'admin_sticky.gif', 'lang' => true, 'url' => $scripturl . '?action=sticky;topic=' . $context['current_topic'] . '.' . $context['start'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-		'merge' => array('test' => 'can_merge', 'text' => 'merge', 'image' => 'merge.gif', 'lang' => true, 'url' => $scripturl . '?action=mergetopics;board=' . $context['current_board'] . '.0;from=' . $context['current_topic']),
-		'calendar' => array('test' => 'calendar_post', 'text' => 'calendar_link', 'image' => 'linktocal.gif', 'lang' => true, 'url' => $scripturl . '?action=post;calendar;msg=' . $context['topic_first_message'] . ';topic=' . $context['current_topic'] . '.0'),
-	);
-
-	// Restore topic. eh?  No monkey business.
-	if ($context['can_restore_topic'])
-		$mod_buttons[] = array('text' => 'restore_topic', 'image' => '', 'lang' => true, 'url' => $scripturl . '?action=restoretopic;topics=' . $context['current_topic'] . ';' . $context['session_var'] . '=' . $context['session_id']);
+		echo '
+										</ul>
+									</li>';
+
+		// Show a checkbox for quick moderation?
+		if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1 && $message['can_remove'])
+			echo '
+									<li style="display: none;" id="in_topic_mod_check_', $message['id'], '"></li>';
 
-	// Allow adding new mod buttons easily.
-	call_integration_hook('integrate_mod_buttons', array(&$mod_buttons));
+		if ($message['can_approve'] || $context['can_reply'] || $message['can_modify'] || $message['can_remove'] || $context['can_split'] || $context['can_restore_msg'])
+			echo '
+								</ul>';
+	}
 
+	if ($context['can_report_moderator'] || !empty($context['can_see_likes']) || !empty($context['can_like']) || $message['can_approve'] || $message['can_unapprove'] || $context['can_reply'] || $message['can_modify'] || $message['can_remove'] || $context['can_split'] || $context['can_restore_msg'] || $context['can_quote'])
 	echo '
-			<div id="moderationbuttons">', template_button_strip($mod_buttons, 'bottom', array('id' => 'moderationbuttons_strip')), '</div>';
+							</div>';
 
-	// Show the jumpto box, or actually...let Javascript do it.
 	echo '
-			<div class="plainbox" id="display_jump_to">&nbsp;</div>';
+						</div>
+						<div class="moderatorbar">';
 
-	if ($context['can_reply'] && !empty($options['display_quick_reply']))
+	// Are there any custom profile fields for above the signature?
+	if (!empty($message['custom_fields']['above_signature']))
 	{
 		echo '
-			<a id="quickreply"></a>
-			<div class="tborder" id="quickreplybox">
-				<div class="cat_bar">
-					<h3 class="catbg">
-						<span class="ie6_header floatleft"><a href="javascript:oQuickReply.swap();">
-							<img src="', $settings['images_url'], '/', $options['display_quick_reply'] == 2 ? 'collapse' : 'expand', '.gif" alt="+" id="quickReplyExpand" class="icon" />
-						</a>
-						<a href="javascript:oQuickReply.swap();">', $txt['quick_reply'], '</a>
-						</span>
-					</h3>
-				</div>
-				<div id="quickReplyOptions"', $options['display_quick_reply'] == 2 ? '' : ' style="display: none"', '>
-					<span class="upperframe"><span></span></span>
-					<div class="roundframe">
-						<p class="smalltext lefttext">', $txt['quick_reply_desc'], '</p>
-						', $context['is_locked'] ? '<p class="alert smalltext">' . $txt['quick_reply_warning'] . '</p>' : '',
-						$context['oldTopicError'] ? '<p class="alert smalltext">' . sprintf($txt['error_old_topic'], $modSettings['oldTopicDays']) . '</p>' : '', '
-						', $context['can_reply_approved'] ? '' : '<em>' . $txt['wait_for_approval'] . '</em>', '
-						', !$context['can_reply_approved'] && $context['require_verification'] ? '<br />' : '', '
-						<form action="', $scripturl, '?board=', $context['current_board'], ';action=post2" method="post" accept-charset="', $context['character_set'], '" name="postmodify" id="postmodify" onsubmit="submitonce(this);" style="margin: 0;">
-							<input type="hidden" name="topic" value="', $context['current_topic'], '" />
-							<input type="hidden" name="subject" value="', $context['response_prefix'], $context['subject'], '" />
-							<input type="hidden" name="icon" value="xx" />
-							<input type="hidden" name="from_qr" value="1" />
-							<input type="hidden" name="notify" value="', $context['is_marked_notify'] || !empty($options['auto_notify']) ? '1' : '0', '" />
-							<input type="hidden" name="not_approved" value="', !$context['can_reply_approved'], '" />
-							<input type="hidden" name="goback" value="', empty($options['return_to_post']) ? '0' : '1', '" />
-							<input type="hidden" name="last_msg" value="', $context['topic_last_message'], '" />
-							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-							<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '" />';
-
-			// Guests just need more.
-			if ($context['user']['is_guest'])
-				echo '
-							<strong>', $txt['name'], ':</strong> <input type="text" name="guestname" value="', $context['name'], '" size="25" class="input_text" tabindex="', $context['tabindex']++, '" />
-							<strong>', $txt['email'], ':</strong> <input type="text" name="email" value="', $context['email'], '" size="25" class="input_text" tabindex="', $context['tabindex']++, '" /><br />';
-
-			// Is visual verification enabled?
-			if ($context['require_verification'])
-				echo '
-							<strong>', $txt['verification'], ':</strong>', template_control_verification($context['visual_verification_id'], 'quick_reply'), '<br />';
+							<div class="custom_fields_above_signature">
+								<ul class="reset nolist">';
 
+		foreach ($message['custom_fields']['above_signature'] as $custom)
 			echo '
-							<div class="quickReplyContent">
-								<textarea cols="600" rows="7" name="message" tabindex="', $context['tabindex']++, '"></textarea>
-							</div>
-							<div class="righttext padding">
-								<input type="submit" name="post" value="', $txt['post'], '" onclick="return submitThisOnce(this);" accesskey="s" tabindex="', $context['tabindex']++, '" class="button_submit" />
-								<input type="submit" name="preview" value="', $txt['preview'], '" onclick="return submitThisOnce(this);" accesskey="p" tabindex="', $context['tabindex']++, '" class="button_submit" />';
+									<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
 
-			if ($context['show_spellchecking'])
-				echo '
-								<input type="button" value="', $txt['spell_check'], '" onclick="spellCheck(\'postmodify\', \'message\');" tabindex="', $context['tabindex']++, '" class="button_submit" />';
-
-			echo '
-							</div>
-						</form>
-					</div>
-					<span class="lowerframe"><span></span></span>
-				</div>
-			</div>';
-	}
-	else
 		echo '
-		<br class="clear" />';
+								</ul>
+							</div>';
+	}
 
-	if ($context['show_spellchecking'])
+	// Show the member's signature?
+	if (!empty($message['member']['signature']) && empty($options['show_no_signatures']) && $context['signature_enabled'])
 		echo '
-			<form action="', $scripturl, '?action=spellcheck" method="post" accept-charset="', $context['character_set'], '" name="spell_form" id="spell_form" target="spellWindow"><input type="hidden" name="spellstring" value="" /></form>
-				<script type="text/javascript" src="' . $settings['default_theme_url'] . '/scripts/spellcheck.js"></script>';
+							<div class="signature" id="msg_', $message['id'], '_signature"', $ignoring ? ' style="display:none;"' : '', '>', $message['member']['signature'], '</div>';
 
-	echo '
-				<script type="text/javascript" src="' . $settings['default_theme_url'] . '/scripts/topic.js"></script>
-				<script type="text/javascript"><!-- // --><![CDATA[';
 
-	if (!empty($options['display_quick_reply']))
+	// Are there any custom profile fields for below the signature?
+	if (!empty($message['custom_fields']['below_signature']))
+	{
 		echo '
-					var oQuickReply = new QuickReply({
-						bDefaultCollapsed: ', !empty($options['display_quick_reply']) && $options['display_quick_reply'] == 2 ? 'false' : 'true', ',
-						iTopicId: ', $context['current_topic'], ',
-						iStart: ', $context['start'], ',
-						sScriptUrl: smf_scripturl,
-						sImagesUrl: "', $settings['images_url'], '",
-						sContainerId: "quickReplyOptions",
-						sImageId: "quickReplyExpand",
-						sImageCollapsed: "collapse.gif",
-						sImageExpanded: "expand.gif",
-						sJumpAnchor: "quickreply"
-					});';
+							<div class="custom_fields_below_signature">
+								<ul class="reset nolist">';
+
+		foreach ($message['custom_fields']['below_signature'] as $custom)
+			echo '
+									<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
 
-	if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1 && $context['can_remove_post'])
 		echo '
-					var oInTopicModeration = new InTopicModeration({
-						sSelf: \'oInTopicModeration\',
-						sCheckboxContainerMask: \'in_topic_mod_check_\',
-						aMessageIds: [\'', implode('\', \'', $removableMessageIDs), '\'],
-						sSessionId: \'', $context['session_id'], '\',
-						sSessionVar: \'', $context['session_var'], '\',
-						sButtonStrip: \'moderationbuttons\',
-						sButtonStripDisplay: \'moderationbuttons_strip\',
-						bUseImageButton: false,
-						bCanRemove: ', $context['can_remove_post'] ? 'true' : 'false', ',
-						sRemoveButtonLabel: \'', $txt['quickmod_delete_selected'], '\',
-						sRemoveButtonImage: \'delete_selected.gif\',
-						sRemoveButtonConfirm: \'', $txt['quickmod_confirm'], '\',
-						bCanRestore: ', $context['can_restore_msg'] ? 'true' : 'false', ',
-						sRestoreButtonLabel: \'', $txt['quick_mod_restore'], '\',
-						sRestoreButtonImage: \'restore_selected.gif\',
-						sRestoreButtonConfirm: \'', $txt['quickmod_confirm'], '\',
-						sFormId: \'quickModForm\'
-					});';
+								</ul>
+							</div>';
+	}
 
 	echo '
-					if (\'XMLHttpRequest\' in window)
-					{
-						var oQuickModify = new QuickModify({
-							sScriptUrl: smf_scripturl,
-							bShowModify: ', $settings['show_modify'] ? 'true' : 'false', ',
-							iTopicId: ', $context['current_topic'], ',
-							sTemplateBodyEdit: ', JavaScriptEscape('
-								<div id="quick_edit_body_container" style="width: 90%">
-									<div id="error_box" style="padding: 4px;" class="error"></div>
-									<textarea class="editor" name="message" rows="12" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 100%; min-width: 100%' : 'width: 100%') . '; margin-bottom: 10px;" tabindex="' . $context['tabindex']++ . '">%body%</textarea><br />
-									<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '" />
-									<input type="hidden" name="topic" value="' . $context['current_topic'] . '" />
-									<input type="hidden" name="msg" value="%msg_id%" />
-									<div class="righttext">
-										<input type="submit" name="post" value="' . $txt['save'] . '" tabindex="' . $context['tabindex']++ . '" onclick="return oQuickModify.modifySave(\'' . $context['session_id'] . '\', \'' . $context['session_var'] . '\');" accesskey="s" class="button_submit" />&nbsp;&nbsp;' . ($context['show_spellchecking'] ? '<input type="button" value="' . $txt['spell_check'] . '" tabindex="' . $context['tabindex']++ . '" onclick="spellCheck(\'quickModForm\', \'message\');" class="button_submit" />&nbsp;&nbsp;' : '') . '<input type="submit" name="cancel" value="' . $txt['modify_cancel'] . '" tabindex="' . $context['tabindex']++ . '" onclick="return oQuickModify.modifyCancel();" class="button_submit" />
-									</div>
-								</div>'), ',
-							sTemplateSubjectEdit: ', JavaScriptEscape('<input type="text" style="width: 90%;" name="subject" value="%subject%" size="80" maxlength="80" tabindex="' . $context['tabindex']++ . '" class="input_text" />'), ',
-							sTemplateBodyNormal: ', JavaScriptEscape('%body%'), ',
-							sTemplateSubjectNormal: ', JavaScriptEscape('<a href="' . $scripturl . '?topic=' . $context['current_topic'] . '.msg%msg_id%#msg%msg_id%" rel="nofollow">%subject%</a>'), ',
-							sTemplateTopSubject: ', JavaScriptEscape($txt['topic'] . ': %subject% &nbsp;(' . $txt['read'] . ' ' . $context['num_views'] . ' ' . $txt['times'] . ')'), ',
-							sErrorBorderStyle: ', JavaScriptEscape('1px solid red'), '
-						});
+						</div>
+					</div>
+				</div>
+				<hr class="post_separator">';
+}
 
-						aJumpTo[aJumpTo.length] = new JumpTo({
-							sContainerId: "display_jump_to",
-							sJumpToTemplate: "<label class=\"smalltext\" for=\"%select_id%\">', $context['jump_to']['label'], ':<" + "/label> %dropdown_list%",
-							iCurBoardId: ', $context['current_board'], ',
-							iCurBoardChildLevel: ', $context['jump_to']['child_level'], ',
-							sCurBoardName: "', $context['jump_to']['board_name'], '",
-							sBoardChildLevelIndicator: "==",
-							sBoardPrefix: "=> ",
-							sCatSeparator: "-----------------------------",
-							sCatPrefix: "",
-							sGoButtonLabel: "', $txt['go'], '"
-						});
+function template_quickreply()
+{
+	global $context, $modSettings, $scripturl, $options, $txt;
+	echo '
+		<a id="quickreply"></a>
+		<div class="tborder" id="quickreplybox">
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $txt['quick_reply'], '
+				</h3>
+			</div>
+			<div id="quickReplyOptions">
+				<div class="roundframe">', empty($options['use_editor_quick_reply']) ? '
+					<p class="smalltext lefttext">' . $txt['quick_reply_desc'] . '</p>' : '', '
+					', $context['is_locked'] ? '<p class="alert smalltext">' . $txt['quick_reply_warning'] . '</p>' : '',
+					!empty($context['oldTopicError']) ? '<p class="alert smalltext">' . sprintf($txt['error_old_topic'], $modSettings['oldTopicDays']) . '</p>' : '', '
+					', $context['can_reply_approved'] ? '' : '<em>' . $txt['wait_for_approval'] . '</em>', '
+					', !$context['can_reply_approved'] && $context['require_verification'] ? '<br>' : '', '
+					<form action="', $scripturl, '?board=', $context['current_board'], ';action=post2" method="post" accept-charset="', $context['character_set'], '" name="postmodify" id="postmodify" onsubmit="submitonce(this);">
+						<input type="hidden" name="topic" value="', $context['current_topic'], '">
+						<input type="hidden" name="subject" value="', $context['response_prefix'], $context['subject'], '">
+						<input type="hidden" name="icon" value="xx">
+						<input type="hidden" name="from_qr" value="1">
+						<input type="hidden" name="notify" value="', $context['is_marked_notify'] || !empty($options['auto_notify']) ? '1' : '0', '">
+						<input type="hidden" name="not_approved" value="', !$context['can_reply_approved'], '">
+						<input type="hidden" name="goback" value="', empty($options['return_to_post']) ? '0' : '1', '">
+						<input type="hidden" name="last_msg" value="', $context['topic_last_message'], '">
+						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+						<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '">';
+
+		// Guests just need more.
+		if ($context['user']['is_guest'])
+			echo '
+						<dl id="post_header">
+							<dt>
+								', $txt['name'], ':
+							</dt>
+							<dd>
+								<input type="text" name="guestname" size="25" value="', $context['name'], '" tabindex="', $context['tabindex']++, '" class="input_text">
+							</dd>
+							<dt>
+								', $txt['email'], ':
+							</dt>
+							<dd>
+								<input type="email" name="email" size="25" value="', $context['email'], '" tabindex="', $context['tabindex']++, '" class="input_text" required>
+							</dd>
+						</dl>';
+
+		echo '
+						', template_control_richedit($context['post_box_name'], 'smileyBox_message', 'bbcBox_message'), '
+						<script><!-- // --><![CDATA[
+							function insertQuoteFast(messageid)
+							{
+								if (window.XMLHttpRequest)
+									getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + \'action=quotefast;quote=\' + messageid + \';xml;pb=', $context['post_box_name'], ';mode=\' + (oEditorHandle_', $context['post_box_name'], '.bRichTextEnabled ? 1 : 0), onDocReceived);
+								else
+									reqWin(smf_prepareScriptUrl(smf_scripturl) + \'action=quotefast;quote=\' + messageid + \';pb=', $context['post_box_name'], ';mode=\' + (oEditorHandle_', $context['post_box_name'], '.bRichTextEnabled ? 1 : 0), 240, 90);
+								return false;
+							}
+							function onDocReceived(XMLDoc)
+							{
+								var text = \'\';
+								for (var i = 0, n = XMLDoc.getElementsByTagName(\'quote\')[0].childNodes.length; i < n; i++)
+									text += XMLDoc.getElementsByTagName(\'quote\')[0].childNodes[i].nodeValue;
+								$("#', $context['post_box_name'], '").data("sceditor").InsertText(text);
 
-						aIconLists[aIconLists.length] = new IconList({
-							sBackReference: "aIconLists[" + aIconLists.length + "]",
-							sIconIdPrefix: "msg_icon_",
-							sScriptUrl: smf_scripturl,
-							bShowModify: ', $settings['show_modify'] ? 'true' : 'false', ',
-							iBoardId: ', $context['current_board'], ',
-							iTopicId: ', $context['current_topic'], ',
-							sSessionId: "', $context['session_id'], '",
-							sSessionVar: "', $context['session_var'], '",
-							sLabelIconList: "', $txt['message_icon'], '",
-							sBoxBackground: "transparent",
-							sBoxBackgroundHover: "#ffffff",
-							iBoxBorderWidthHover: 1,
-							sBoxBorderColorHover: "#adadad" ,
-							sContainerBackground: "#ffffff",
-							sContainerBorder: "1px solid #adadad",
-							sItemBorder: "1px solid #ffffff",
-							sItemBorderHover: "1px dotted gray",
-							sItemBackground: "transparent",
-							sItemBackgroundHover: "#e0e0f0"
-						});
-					}';
+								ajax_indicator(false);
+							}
+						// ]]></script>';
 
-	if (!empty($ignoredMsgs))
+	// Is visual verification enabled?
+	if ($context['require_verification'])
 	{
 		echo '
-					var aIgnoreToggles = new Array();';
+				<div class="post_verification">
+					<strong>', $txt['verification'], ':</strong>
+					', template_control_verification($context['visual_verification_id'], 'all'), '
+				</div>';
+	}
 
-		foreach ($ignoredMsgs as $msgid)
-		{
-			echo '
-					aIgnoreToggles[', $msgid, '] = new smc_Toggle({
-						bToggleEnabled: true,
-						bCurrentlyCollapsed: true,
-						aSwappableContainers: [
-							\'msg_', $msgid, '_extra_info\',
-							\'msg_', $msgid, '\',
-							\'msg_', $msgid, '_footer\',
-							\'msg_', $msgid, '_quick_mod\',
-							\'modify_button_', $msgid, '\',
-							\'msg_', $msgid, '_signature\'
+	// Finally, the submit buttons.
+	echo '
+				<br class="clear_right">
+				<span id="post_confirm_buttons">
+					', template_control_richedit_buttons($context['post_box_name']) ,'
+				</span>';
+		echo '
+					</form>
+				</div>
+			</div>
+		</div>
+		<br class="clear">';
 
-						],
-						aSwapLinks: [
-							{
-								sId: \'msg_', $msgid, '_ignored_link\',
-								msgExpanded: \'\',
-								msgCollapsed: ', JavaScriptEscape($txt['show_ignore_user_post']), '
-							}
-						]
-					});';
-		}
-	}
+	// draft autosave available and the user has it enabled?
+	if (!empty($context['drafts_autosave']))
+		echo '
+			<script><!-- // --><![CDATA[
+				var oDraftAutoSave = new smf_DraftAutoSave({
+					sSelf: \'oDraftAutoSave\',
+					sLastNote: \'draft_lastautosave\',
+					sLastID: \'id_draft\',', !empty($context['post_box_name']) ? '
+					sSceditorID: \'' . $context['post_box_name'] . '\',' : '', '
+					sType: \'', 'quick', '\',
+					iBoard: ', (empty($context['current_board']) ? 0 : $context['current_board']), ',
+					iFreq: ', (empty($modSettings['masterAutoSaveDraftsDelay']) ? 60000 : $modSettings['masterAutoSaveDraftsDelay'] * 1000), '
+				});
+			// ]]></script>';
+
+	if ($context['show_spellchecking'])
+		echo '
+			<form action="', $scripturl, '?action=spellcheck" method="post" accept-charset="', $context['character_set'], '" name="spell_form" id="spell_form" target="spellWindow"><input type="hidden" name="spellstring" value=""></form>';
 
 	echo '
+				<script><!-- // --><![CDATA[
+					var oQuickReply = new QuickReply({
+						bDefaultCollapsed: false,
+						iTopicId: ', $context['current_topic'], ',
+						iStart: ', $context['start'], ',
+						sScriptUrl: smf_scripturl,
+						sImagesUrl: smf_images_url,
+						sContainerId: "quickReplyOptions",
+						sImageId: "quickReplyExpand",
+						sClassCollapsed: "toggle_up",
+						sClassExpanded: "toggle_down",
+						sJumpAnchor: "quickreply",
+						bIsFull: true
+					});
 				// ]]></script>';
 }
-
-?>
\ No newline at end of file
+?>
diff -ru a/Themes/default/Errors.template.php b/Themes/default/Errors.template.php
--- a/Themes/default/Errors.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Errors.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,14 +3,14 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
-// !!!
+// @todo
 /*	This template file contains only the sub template fatal_error. It is
 	shown when an error occurs, and should show at least a back button and
 	$context['error_message'].
@@ -19,9 +19,17 @@
 // Show an error message.....
 function template_fatal_error()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 
-	echo '
+	if (SIMPLE_ACTION)
+		echo '
+		<strong>
+			', $context['error_title'], '
+		</strong><br>
+		<div ', $context['error_code'], 'class="padding">', $context['error_message'], '</div>';
+	else
+	{
+		echo '
 	<div id="fatal_error">
 		<div class="cat_bar">
 			<h3 class="catbg">
@@ -29,168 +37,187 @@
 			</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="padding">', $context['error_message'], '</div>
-			<span class="botslice"><span></span></span>
+			<div ', $context['error_code'], 'class="padding">', $context['error_message'], '</div>
 		</div>
 	</div>';
 
-	// Show a back button (using javascript.)
-	echo '
-	<div class="centertext"><a href="javascript:history.go(-1)">', $txt['back'], '</a></div>';
+		// Show a back button (using javascript.)
+		echo '
+	<div class="centertext">
+		<a class="button_link" style="float:none" href="javascript:document.location=document.referrer">', $txt['back'], '</a>
+	</div>';
+	}
 }
 
 function template_error_log()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt;
+
+	echo '
+		<form action="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';start=', $context['start'], $context['has_filter'] ? $context['filter']['href'] : '', '" method="post" accept-charset="', $context['character_set'], '">';
 
 	echo '
-		<form action="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';start=', $context['start'], $context['has_filter'] ? $context['filter']['href'] : '', '" method="post" accept-charset="', $context['character_set'], '" onsubmit="if (lastClicked == \'remove_all\' &amp;&amp; !confirm(\'', $txt['sure_about_errorlog_remove'], '\')) return false; else return true;">
-			<script type="text/javascript"><!-- // --><![CDATA[
-				var lastClicked = "";
-			// ]]></script>
-			<div class="title_bar clear_right">
-				<h3 class="titlebg">
-					<span class="ie6_header floatleft">
-						<a href="', $scripturl, '?action=helpadmin;help=error_log" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" align="top" /></a> ', $txt['errlog'], '
-					</span>
+			<div class="cat_bar clear_right">
+				<h3 class="catbg">
+					<a href="', $scripturl, '?action=helpadmin;help=error_log" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a> ', $txt['errlog'], '
 				</h3>
 			</div>
-			<table border="0" cellspacing="1" class="table_grid" id="error_log">
-				<tr>
-					<td colspan="3" class="windowbg">
+			<div class="pagesection">
+				<div class="floatleft">
+					', $context['page_index'], '
+				</div>
+				<div class="floatright" style="margin-top: 1ex">
+					<input type="submit" name="removeSelection" value="', $txt['remove_selection'] ,'" data-confirm="', $txt['remove_selection_confirm'] ,'" class="button_submit you_sure">
+					<input type="submit" name="delall" value="', ($context['has_filter'] ? $txt['remove_filtered_results'] : $txt['remove_all']) ,'" data-confirm="', ($context['has_filter'] ? $txt['remove_filtered_results_confirm'] : $txt['sure_about_errorlog_remove']) ,'" class="button_submit you_sure">
+				</div>
+			</div>
+			<table class="table_grid" id="error_log">
+				<tr class="title_bar">
+					<td colspan="3">
 						&nbsp;&nbsp;', $txt['apply_filter_of_type'], ':';
 
 	$error_types = array();
 	foreach ($context['error_types'] as $type => $details)
-		$error_types[] = ($details['is_selected'] ? '<img src="' . $settings['images_url'] . '/selected.gif" alt="" /> ' : '') . '<a href="' . $details['url'] . '" ' . ($details['is_selected'] ? 'style="font-weight: bold;"' : '') . ' title="' . $details['description'] . '">' . $details['label'] . '</a>';
+		$error_types[] = ($details['is_selected'] ? '<img src="' . $settings['images_url'] . '/selected.png" alt=""> ' : '') . '<a href="' . $details['url'] . '" ' . ($details['is_selected'] ? 'style="font-weight: bold;"' : '') . ' title="' . $details['description'] . '">' . $details['label'] . '</a>';
 
 	echo '
 						', implode('&nbsp;|&nbsp;', $error_types), '
 					</td>
-				</tr>
-				<tr>
-					<td colspan="3" class="windowbg">
-						&nbsp;&nbsp;', $txt['pages'], ': ', $context['page_index'], '
-					</td>
 				</tr>';
 
 	if ($context['has_filter'])
 		echo '
 				<tr>
 					<td colspan="3" class="windowbg">
-						<strong>', $txt['applying_filter'], ':</strong> ', $context['filter']['entity'], ' ', $context['filter']['value']['html'], ' (<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', '">', $txt['clear_filter'], '</a>)
+						<strong>&nbsp;&nbsp;', $txt['applying_filter'], ':</strong> ', $context['filter']['entity'], ' ', $context['filter']['value']['html'], '&nbsp;&nbsp;[<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', '">', $txt['clear_filter'], '</a>]
 					</td>
 				</tr>';
 
-	if (!empty($context['errors']))
-		echo '
-				<tr class="titlebg">
-					<td colspan="3" class="lefttext">
-						<div class="floatright"><input type="submit" value="', $txt['remove_selection'], '" onclick="lastClicked = \'remove_selection\';" class="button_submit" /> <input type="submit" name="delall" value="', $context['has_filter'] ? $txt['remove_filtered_results'] : $txt['remove_all'], '" onclick="lastClicked = \'remove_all\';" class="button_submit" /></div>
-						<label for="check_all1"><input type="checkbox" id="check_all1" onclick="invertAll(this, this.form, \'delete[]\'); this.form.check_all2.checked = this.checked;" class="input_check" /><strong>', $txt['check_all'], '</strong></label>
+	echo '
+				<tr>
+					<td colspan="3" class="righttext" style="padding: 4px 8px;">
+						<label for="check_all1"><strong>', $txt['check_all'], '</strong></label>&nbsp;
+						<input type="checkbox" id="check_all1" onclick="invertAll(this, this.form, \'delete[]\'); this.form.check_all2.checked = this.checked;" class="input_check">
 					</td>
 				</tr>';
 
+	// No errors, then show a message
+	if (count($context['errors']) == 0)
+		echo '
+				<tr class="windowbg">
+					<td class="centertext" colspan="2">', $txt['errlog_no_entries'], '</td>
+				</tr>';
+
+	// we have some errors, must be some mods installed :P
 	foreach ($context['errors'] as $error)
 	{
 		echo '
-				<tr class="windowbg', $error['alternate'] ? '2' : '', '">
-					<td rowspan="2" class="checkbox_column">
-						<input type="checkbox" name="delete[]" value="', $error['id'], '" class="input_check" />
-					</td>
-					<td class="half_width">
-						<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=id_member;value=', $error['member']['id'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_member'], '"><img src="', $settings['images_url'], '/filter.gif" alt="', $txt['apply_filter'], ': ', $txt['filter_only_member'], '" /></a>
-						<strong>', $error['member']['link'], '</strong><br />
-						<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=ip;value=', $error['member']['ip'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_ip'], '"><img src="', $settings['images_url'], '/filter.gif" alt="', $txt['apply_filter'], ': ', $txt['filter_only_ip'], '" /></a>
-						<strong><a href="', $scripturl, '?action=trackip;searchip=', $error['member']['ip'], '">', $error['member']['ip'], '</a></strong>&nbsp;&nbsp;
-						<br />&nbsp;
-					</td>
-					<td class="half_width">
-						<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? '' : ';desc', $context['has_filter'] ? $context['filter']['href'] : '', '" title="', $txt['reverse_direction'], '"><img src="', $settings['images_url'], '/sort_', $context['sort_direction'], '.gif" alt="', $txt['reverse_direction'], '" /></a>
-						', $error['time'], '
-						<br />';
+				<tr class="windowbg">
+					<td>
+
+						<div style="float: left; width: 50%; line-height: 1.8em; padding: 0 4px 4px 4px; vertical-align: bottom;">
+							<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=id_member;value=', $error['member']['id'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_member'], '"><span class="generic_icons filter centericon"></span></a>
+							<strong>', $error['member']['link'], '</strong><br>
+							<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? '' : ';desc', $context['has_filter'] ? $context['filter']['href'] : '', '" title="', $txt['reverse_direction'], '"><span class="generic_icons sort_' . $context['sort_direction'] . '"></span></a>
+							', $error['time'], '<br>';
+
+		if (!empty($error['member']['ip']))
+			echo '
+							<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=ip;value=', $error['member']['ip'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_ip'], '"><span class="generic_icons filter centericon"></span></a>
+							<strong><a href="', $scripturl, '?action=trackip;searchip=', $error['member']['ip'], '">', $error['member']['ip'], '</a></strong>&nbsp;&nbsp;<br>';
+
+		echo '
+						</div>
+
+						<div style="float: left; width: 50%; line-height: 1.8em; padding: 0 4px;">';
 
 		if ($error['member']['session'] != '')
 			echo '
-						<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=session;value=', $error['member']['session'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_session'], '"><img src="', $settings['images_url'], '/filter.gif" alt="', $txt['apply_filter'], ': ', $txt['filter_only_session'], '" /></a>
-						', $error['member']['session'], '
-						<br />';
+							<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=session;value=', $error['member']['session'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_session'], '"><span class="generic_icons filter centericon"></span></a>
+							', $error['member']['session'], '<br>';
 
 		echo '
-						<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=error_type;value=', $error['error_type']['type'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_type'], '"><img src="', $settings['images_url'], '/filter.gif" alt="', $txt['apply_filter'], ': ', $txt['filter_only_type'], '" /></a>
-						', $txt['error_type'], ': ', $error['error_type']['name'], '
-					</td>
-				</tr>
-				<tr class="windowbg', $error['alternate'] ? '2' : '', '">
-					<td colspan="2">
-						<div class="clear_left floatleft"><a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=url;value=', $error['url']['href'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_url'], '"><img src="', $settings['images_url'], '/filter.gif" alt="', $txt['apply_filter'], ': ', $txt['filter_only_url'], '" /></a></div>
-						<div class="floatleft marginleft"><a href="', $error['url']['html'], '">', $error['url']['html'], '</a></div>
-						<div class="clear_left floatleft"><a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=message;value=', $error['message']['href'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_message'], '"><img src="', $settings['images_url'], '/filter.gif" alt="', $txt['apply_filter'], ': ', $txt['filter_only_message'], '" /></a></div>
-						<div class="floatleft marginleft">', $error['message']['html'], '</div>';
+							<a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=error_type;value=', $error['error_type']['type'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_type'], '"><span class="generic_icons filter centericon"></span></a>
+							', $txt['error_type'], ': ', $error['error_type']['name'], '<br>
+							<a style="display: table-cell; padding: 4px 0; width: 20px; vertical-align: top;" href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=message;value=', $error['message']['href'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_message'], '"><span class="generic_icons filter"></span></a>
+							<span style="display: table-cell;">', $error['message']['html'], '</span>
+						</div>
+
+						<div style="float: left; width: 100%; padding: 4px 0; line-height: 1.6em; border-top: 1px solid #e3e3e3;">
+							<a style="display: table-cell; padding: 4px; width: 20px; vertical-align: top;" href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=url;value=', $error['url']['href'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_url'], '"><span class="generic_icons filter"></span></a>
+							<a style="display: table-cell;" href="', $error['url']['html'], '">', $error['url']['html'], '</a>
+						</div>';
 
 		if (!empty($error['file']))
 			echo '
-						<div class="clear_left floatleft"><a href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=file;value=', $error['file']['search'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_file'], '"><img src="', $settings['images_url'], '/filter.gif" alt="', $txt['apply_filter'], ': ', $txt['filter_only_file'], '" /></a></div>
-						<div class="floatleft marginleft">
-							', $txt['file'], ': ', $error['file']['link'], '<br />
-							', $txt['line'], ': ', $error['file']['line'], '
+						<div style="float: left; width: 100%; padding: 4px 0; line-height: 1.6em; border-top: 1px solid #e3e3e3;">
+							<a style="display: table-cell; padding: 4px; width: 20px; vertical-align: top;" href="', $scripturl, '?action=admin;area=logs;sa=errorlog', $context['sort_direction'] == 'down' ? ';desc' : '', ';filter=file;value=', $error['file']['search'], '" title="', $txt['apply_filter'], ': ', $txt['filter_only_file'], '"><span class="generic_icons filter"></span></a>
+							<div>
+								', $txt['file'], ': ', $error['file']['link'], '<br>
+								', $txt['line'], ': ', $error['file']['line'], '
+							</div>
 						</div>';
 
 		echo '
 					</td>
-				</tr>';
-	}
-
-	if (!empty($context['errors']))
-		echo '
-				<tr class="titlebg">
-					<td colspan="3" class="lefttext">
-						<div class="floatright"><input type="submit" value="', $txt['remove_selection'], '" onclick="lastClicked = \'remove_selection\';" class="button_submit" /> <input type="submit" name="delall" value="', $context['has_filter'] ? $txt['remove_filtered_results'] : $txt['remove_all'], '" onclick="lastClicked = \'remove_all\';" class="button_submit" /></div>
-						&nbsp;<label for="check_all2"><input type="checkbox" id="check_all2" onclick="invertAll(this, this.form, \'delete[]\'); this.form.check_all1.checked = this.checked;" class="input_check" /><strong>', $txt['check_all'], '</strong></label>
+					<td class="checkbox_column">
+						<input type="checkbox" name="delete[]" value="', $error['id'], '" class="input_check">
 					</td>
 				</tr>';
-	else
-		echo '
-				<tr>
-					<td colspan="3" class="windowbg2">', $txt['errlog_no_entries'], '</td>
-				</tr>';
+	}
 
 	echo '
 				<tr>
-					<td colspan="3" class="windowbg">
-						&nbsp;&nbsp;', $txt['pages'], ': ', $context['page_index'], '
+					<td colspan="3" class="righttext" style="padding-right: 1.2ex">
+						<label for="check_all2"><strong>', $txt['check_all'], '</strong></label>&nbsp;
+						<input type="checkbox" id="check_all2" onclick="invertAll(this, this.form, \'delete[]\'); this.form.check_all1.checked = this.checked;" class="input_check">
 					</td>
 				</tr>
-			</table><br />';
+			</table>
+			<div class="pagesection floatleft">
+				&nbsp;&nbsp;', $context['page_index'], '
+			</div>';
+
+	echo '
+			<div class="floatright" style="margin-top: 1ex">
+				<input type="submit" name="removeSelection" value="', $txt['remove_selection'] ,'" data-confirm="', $txt['remove_selection_confirm'] ,'" class="button_submit you_sure">
+				<input type="submit" name="delall" value="', ($context['has_filter'] ? $txt['remove_filtered_results'] : $txt['remove_all']) ,'" data-confirm="', ($context['has_filter'] ? $txt['remove_filtered_results_confirm'] : $txt['sure_about_errorlog_remove']) ,'" class="button_submit you_sure">
+			</div>
+			<br>';
+
 	if ($context['sort_direction'] == 'down')
 		echo '
-			<input type="hidden" name="desc" value="1" />';
+			<input type="hidden" name="desc" value="1">';
+
 	echo '
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">';
+
+	echo '
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['admin-el_token_var'], '" value="', $context['admin-el_token'], '">
 		</form>';
 }
 
 function template_show_file()
 {
-	global $context, $settings;
+	global $context, $settings, $modSettings;
 
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
+		<meta charset="', $context['character_set'], '">
 		<title>', $context['file_data']['file'], '</title>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
-		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index.css" />
+		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index', $context['theme_variant'], '.css', $modSettings['browser_cache'] ,'">
 	</head>
 	<body>
-		<table border="0" cellpadding="0" cellspacing="3">';
+		<table class="errorfile_table">';
 	foreach ($context['file_data']['contents'] as $index => $line)
 	{
-		$line_num = $index+$context['file_data']['min'];
+		$line_num = $index + $context['file_data']['min'];
 		$is_target = $line_num == $context['file_data']['target'];
 		echo '
 			<tr>
-				<td align="right"', $is_target ? ' style="font-weight: bold; border: 1px solid black;border-width: 1px 0 1px 1px;">==&gt;' : '>', $line_num , ':</td>
+				<td align="right"', $is_target ? ' class="current">==&gt;' : '>', $line_num , ':</td>
 				<td style="white-space: nowrap;', $is_target ? ' border: 1px solid black;border-width: 1px 1px 1px 0;':'','">', $line, '</td>
 			</tr>';
 	}
@@ -200,4 +227,28 @@
 </html>';
 }
 
+function template_attachment_errors()
+{
+	global $context, $scripturl, $txt;
+
+	echo '
+	<div>
+		<div class="cat_bar">
+			<h3 class="catbg">
+				', $context['error_title'], '
+			</h3>
+		</div>
+		<div class="windowbg">
+			<div class="padding">
+				<div class="noticebox">',
+					$context['error_message'], '
+				</div>',
+				!empty($context['back_link']) ? ('<a class="button_link" href="' . $scripturl . $context['back_link'] . '">' . $txt['back'] . '</a>') : '',
+				'<span style="float: right; margin:.5em;"></span>
+				<a class="button_link" href="', $scripturl, $context['redirect_link'], '">', $txt['continue'], '</a>
+			</div>
+		</div>
+	</div>';
+}
+
 ?>
\ No newline at end of file
Only in b/Themes/default/fonts: anon
Only in b/Themes/default/fonts: AnonymousPro_end.gdf
Only in b/Themes/default/fonts: AnonymousPro.gdf
Only in b/Themes/default/fonts: AnonymousPro - License.txt
Only in b/Themes/default/fonts: AnonymousPro.ttf
Only in a/Themes/default/fonts: Candice
Only in a/Themes/default/fonts: Candice.gdf
Only in b/Themes/default/fonts: consola
Only in b/Themes/default/fonts: ConsolaMono_end.gdf
Only in b/Themes/default/fonts: ConsolaMono.gdf
Only in b/Themes/default/fonts: ConsolaMono - License.txt
Only in b/Themes/default/fonts: ConsolaMono.ttf
Only in a/Themes/default/fonts: Forgottb.ttf
Only in a/Themes/default/fonts: Hootie
Only in a/Themes/default/fonts: Hootie.gdf
Only in a/Themes/default/fonts: Kimbalt.ttf
Only in b/Themes/default/fonts: Pfennig_end.gdf
Only in b/Themes/default/fonts: Pfennig.gdf
Only in b/Themes/default/fonts: Pfennig - License.txt
Only in b/Themes/default/fonts: Pfennig.ttf
Only in a/Themes/default/fonts: President
Only in a/Themes/default/fonts: President.gdf
Only in a/Themes/default/fonts: Screenge.ttf
Only in a/Themes/default/fonts: Venusris.ttf
Only in a/Themes/default/fonts: Walshes.ttf
diff -ru a/Themes/default/GenericControls.template.php b/Themes/default/GenericControls.template.php
--- a/Themes/default/GenericControls.template.php	2011-06-06 10:06:37.000000000 -0700
+++ b/Themes/default/GenericControls.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,279 +3,223 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // This function displays all the stuff you get with a richedit box - BBC, smileys etc.
 function template_control_richedit($editor_id, $smileyContainer = null, $bbcContainer = null)
 {
-	global $context, $settings, $options, $txt, $modSettings, $scripturl;
+	global $context, $settings, $modSettings;
 
 	$editor_context = &$context['controls']['richedit'][$editor_id];
 
 	echo '
-		<div>
-			<div style="width: 98.8%;">
-				<div>
-					<textarea class="editor" name="', $editor_id, '" id="', $editor_id, '" rows="', $editor_context['rows'], '" cols="600" onselect="storeCaret(this);" onclick="storeCaret(this);" onkeyup="storeCaret(this);" onchange="storeCaret(this);" tabindex="', $context['tabindex']++, '" style="height: ', $editor_context['height'], '; ', isset($context['post_error']['no_message']) || isset($context['post_error']['long_message']) ? 'border: 1px solid red;' : '', '">', $editor_context['value'], '</textarea>
-				</div>
-				<div id="', $editor_id, '_resizer" class="richedit_resize"></div>
-			</div>
-		</div>
-		<input type="hidden" name="', $editor_id, '_mode" id="', $editor_id, '_mode" value="0" />
-		<script type="text/javascript"><!-- // --><![CDATA[';
+		<textarea class="editor" name="', $editor_id, '" id="', $editor_id, '" cols="600" onselect="storeCaret(this);" onclick="storeCaret(this);" onkeyup="storeCaret(this);" onchange="storeCaret(this);" tabindex="', $context['tabindex']++, '" style="width: ', $editor_context['width'], '; height: ', $editor_context['height'], ';', isset($context['post_error']['no_message']) || isset($context['post_error']['long_message']) ? 'border: 1px solid red;' : '', '"', !empty($context['editor']['required']) ? ' required' : '', '>', $editor_context['value'], '</textarea>
+		<div id="', $editor_id, '_resizer" class="richedit_resize"></div>
+		<input type="hidden" name="', $editor_id, '_mode" id="', $editor_id, '_mode" value="0">
+		<script><!-- // --><![CDATA[
+			$(document).ready(function() {
+				', !empty($context['bbcodes_handlers']) ? $context['bbcodes_handlers'] : '', '
+
+				$("#', $editor_id, '").sceditor({
+					',( $editor_id != 'quickReply' ? 'autofocus : true,' : '' ),'
+					style: "', $settings['default_theme_url'], '/css/jquery.sceditor.default.css",
+					emoticonsCompat: true,',
+					!empty($editor_context['locale']) ? '
+					locale: \'' . $editor_context['locale'] . '\',' : '', '
+					colors: "black,red,yellow,pink,green,orange,purple,blue,beige,brown,teal,navy,maroon,limegreen,white",
+					plugins: "bbcode",
+					parserOptions: {
+						quoteType: $.sceditor.BBCodeParser.QuoteType.auto
+					}';
 
 		// Show the smileys.
 		if ((!empty($context['smileys']['postform']) || !empty($context['smileys']['popup'])) && !$editor_context['disable_smiley_box'] && $smileyContainer !== null)
 		{
-			echo '
-				var oSmileyBox_', $editor_id, ' = new smc_SmileyBox({
-					sUniqueId: ', JavaScriptEscape('smileyBox_' . $editor_id), ',
-					sContainerDiv: ', JavaScriptEscape($smileyContainer), ',
-					sClickHandler: ', JavaScriptEscape('oEditorHandle_' . $editor_id . '.insertSmiley'), ',
-					oSmileyLocations: {';
-
+			echo ',
+					emoticons:
+					{';
+			$countLocations = count($context['smileys']);
 			foreach ($context['smileys'] as $location => $smileyRows)
 			{
-				echo '
-						', $location, ': [';
+				$countLocations--;
+				if ($location == 'postform')
+					echo '
+						dropdown:
+						{';
+				elseif ($location == 'popup')
+					echo '
+						popup:
+						{';
+
+				$numRows = count($smileyRows);
+				// This is needed because otherwise the editor will remove all the duplicate (empty) keys and leave only 1 additional line
+				$emptyPlaceholder = 0;
 				foreach ($smileyRows as $smileyRow)
 				{
-					echo '
-							[';
 					foreach ($smileyRow['smileys'] as $smiley)
+					{
 						echo '
-								{
-									sCode: ', JavaScriptEscape($smiley['code']), ',
-									sSrc: ', JavaScriptEscape($settings['smileys_url'] . '/' . $smiley['filename']), ',
-									sDescription: ', JavaScriptEscape($smiley['description']), '
-								}', empty($smiley['isLast']) ? ',' : '';
-
-				echo '
-							]', empty($smileyRow['isLast']) ? ',' : '';
+								', JavaScriptEscape($smiley['code']), ': ', JavaScriptEscape($settings['smileys_url'] . '/' . $smiley['filename']), empty($smiley['isLast']) ? ',' : '';
+					}
+					if (empty($smileyRow['isLast']) && $numRows != 1)
+						echo ',
+						\'-', $emptyPlaceholder++, '\': \'\',';
 				}
 				echo '
-						]', $location === 'postform' ? ',' : '';
+						}', $countLocations != 0 ? ',' : '';
 			}
 			echo '
-					},
-					sSmileyBoxTemplate: ', JavaScriptEscape('
-						%smileyRows% %moreSmileys%
-					'), ',
-					sSmileyRowTemplate: ', JavaScriptEscape('
-						<div>%smileyRow%</div>
-					'), ',
-					sSmileyTemplate: ', JavaScriptEscape('
-						<img src="%smileySource%" align="bottom" alt="%smileyDescription%" title="%smileyDescription%" id="%smileyId%" />
-					'), ',
-					sMoreSmileysTemplate: ', JavaScriptEscape('
-						<a href="#" id="%moreSmileysId%">[' . (!empty($context['smileys']['postform']) ? $txt['more_smileys'] : $txt['more_smileys_pick']) . ']</a>
-					'), ',
-					sMoreSmileysLinkId: ', JavaScriptEscape('moreSmileys_' . $editor_id), ',
-					sMoreSmileysPopupTemplate: ', JavaScriptEscape('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-						<html>
-							<head>
-								<title>' . $txt['more_smileys_title'] . '</title>
-								<link rel="stylesheet" type="text/css" href="' . $settings['theme_url'] . '/css/index' . $context['theme_variant'] . '.css?fin20" />
-							</head>
-							<body id="help_popup">
-								<div class="padding windowbg">
-									<div class="cat_bar">
-										<h3 class="catbg">
-											' . $txt['more_smileys_pick'] . '
-										</h3>
-									</div>
-									<div class="padding">
-										%smileyRows%
-									</div>
-									<div class="smalltext centertext">
-										<a href="#" id="%moreSmileysCloseLinkId%">' . $txt['more_smileys_close_window'] . '</a>
-									</div>
-								</div>
-							</body>
-						</html>'), '
-				});';
+					}';
 		}
+		else
+			echo ',
+					emoticons:
+					{}';
 
 		if ($context['show_bbc'] && $bbcContainer !== null)
 		{
-			echo '
-				var oBBCBox_', $editor_id, ' = new smc_BBCButtonBox({
-					sUniqueId: ', JavaScriptEscape('BBCBox_' . $editor_id), ',
-					sContainerDiv: ', JavaScriptEscape($bbcContainer), ',
-					sButtonClickHandler: ', JavaScriptEscape('oEditorHandle_' . $editor_id . '.handleButtonClick'), ',
-					sSelectChangeHandler: ', JavaScriptEscape('oEditorHandle_' . $editor_id . '.handleSelectChange'), ',
-					aButtonRows: [';
-
-			// Here loop through the array, printing the images/rows/separators!
-			foreach ($context['bbc_tags'] as $i => $buttonRow)
+			echo ',
+					toolbar: "emoticon,';
+			$count_tags = count($context['bbc_tags']);
+			foreach ($context['bbc_toolbar'] as $i => $buttonRow)
 			{
-				echo '
-						[';
-				foreach ($buttonRow as $tag)
-				{
-					// Is there a "before" part for this bbc button? If not, it can't be a button!!
-					if (isset($tag['before']))
-						echo '
-							{
-								sType: \'button\',
-								bEnabled: ', empty($context['disabled_tags'][$tag['code']]) ? 'true' : 'false', ',
-								sImage: ', JavaScriptEscape($settings['images_url'] . '/bbc/' . $tag['image'] . '.gif'), ',
-								sCode: ', JavaScriptEscape($tag['code']), ',
-								sBefore: ', JavaScriptEscape($tag['before']), ',
-								sAfter: ', isset($tag['after']) ? JavaScriptEscape($tag['after']) : 'null', ',
-								sDescription: ', JavaScriptEscape($tag['description']), '
-							}', empty($tag['isLast']) ? ',' : '';
+				echo implode('|', $buttonRow);
+				$count_tags--;
+				if (!empty($count_tags))
+					echo '||';
+			}
 
-					// Must be a divider then.
-					else
-						echo '
-							{
-								sType: \'divider\'
-							}', empty($tag['isLast']) ? ',' : '';
-				}
+			echo '",';
+		}
+		else
+			echo ',
+					toolbar: "",';
 
-				// Add the select boxes to the first row.
-				if ($i == 0)
+		echo '
+				});
+				$("#', $editor_id, '").data("sceditor").createPermanentDropDown();',
+				$editor_context['rich_active'] ? '' : '
+				$("#' . $editor_id . '").data("sceditor").setTextMode();', '
+				if (!(is_ie || is_ie11 || is_ff || is_opera || is_safari || is_chrome))
 				{
-					// Show the font drop down...
-					if (!isset($context['disabled_tags']['font']))
-						echo ',
-							{
-								sType: \'select\',
-								sName: \'sel_face\',
-								oOptions: {
-									\'\': ', JavaScriptEscape($txt['font_face']), ',
-									\'courier\': \'Courier\',
-									\'arial\': \'Arial\',
-									\'arial black\': \'Arial Black\',
-									\'impact\': \'Impact\',
-									\'verdana\': \'Verdana\',
-									\'times new roman\': \'Times New Roman\',
-									\'georgia\': \'Georgia\',
-									\'andale mono\': \'Andale Mono\',
-									\'trebuchet ms\': \'Trebuchet MS\',
-									\'comic sans ms\': \'Comic Sans MS\'
-								}
-							}';
-
-					// Font sizes anyone?
-					if (!isset($context['disabled_tags']['size']))
-						echo ',
-							{
-								sType: \'select\',
-								sName: \'sel_size\',
-								oOptions: {
-									\'\': ', JavaScriptEscape($txt['font_size']), ',
-									\'1\': \'8pt\',
-									\'2\': \'10pt\',
-									\'3\': \'12pt\',
-									\'4\': \'14pt\',
-									\'5\': \'18pt\',
-									\'6\': \'24pt\',
-									\'7\': \'36pt\'
-								}
-							}';
+					$("#' . $editor_id . '").data("sceditor").setTextMode();
+					$(".sceditor-button-source").hide();
+				}', isset($context['post_error']['no_message']) || isset($context['post_error']['long_message']) ? '
+				$(".sceditor-container").find("textarea").each(function() {$(this).css({border: "1px solid red"})});
+				$(".sceditor-container").find("iframe").each(function() {$(this).css({border: "1px solid red"})});' : '', '
+			});';
 
-					// Print a drop down list for all the colors we allow!
-					if (!isset($context['disabled_tags']['color']))
-						echo ',
-							{
-								sType: \'select\',
-								sName: \'sel_color\',
-								oOptions: {
-									\'\': ', JavaScriptEscape($txt['change_color']), ',
-									\'black\': ', JavaScriptEscape($txt['black']), ',
-									\'red\': ', JavaScriptEscape($txt['red']), ',
-									\'yellow\': ', JavaScriptEscape($txt['yellow']), ',
-									\'pink\': ', JavaScriptEscape($txt['pink']), ',
-									\'green\': ', JavaScriptEscape($txt['green']), ',
-									\'orange\': ', JavaScriptEscape($txt['orange']), ',
-									\'purple\': ', JavaScriptEscape($txt['purple']), ',
-									\'blue\': ', JavaScriptEscape($txt['blue']), ',
-									\'beige\': ', JavaScriptEscape($txt['beige']), ',
-									\'brown\': ', JavaScriptEscape($txt['brown']), ',
-									\'teal\': ', JavaScriptEscape($txt['teal']), ',
-									\'navy\': ', JavaScriptEscape($txt['navy']), ',
-									\'maroon\': ', JavaScriptEscape($txt['maroon']), ',
-									\'limegreen\': ', JavaScriptEscape($txt['lime_green']), ',
-									\'white\': ', JavaScriptEscape($txt['white']), '
-								}
-							}';
-				}
-				echo '
-						]', $i == count($context['bbc_tags']) - 1 ? '' : ',';
-			}
-			echo '
-					],
-					sButtonTemplate: ', JavaScriptEscape('
-						<img id="%buttonId%" src="%buttonSrc%" align="bottom" width="23" height="22" alt="%buttonDescription%" title="%buttonDescription%" />
-					'), ',
-					sButtonBackgroundImage: ', JavaScriptEscape($settings['images_url'] . '/bbc/bbc_bg.gif'), ',
-					sButtonBackgroundImageHover: ', JavaScriptEscape($settings['images_url'] . '/bbc/bbc_hoverbg.gif'), ',
-					sActiveButtonBackgroundImage: ', JavaScriptEscape($settings['images_url'] . '/bbc/bbc_hoverbg.gif'), ',
-					sDividerTemplate: ', JavaScriptEscape('
-						<img src="' . $settings['images_url'] . '/bbc/divider.gif" alt="|" style="margin: 0 3px 0 3px;" />
-					'), ',
-					sSelectTemplate: ', JavaScriptEscape('
-						<select name="%selectName%" id="%selectId%" style="margin-bottom: 1ex; font-size: x-small;">
-							%selectOptions%
-						</select>
-					'), ',
-					sButtonRowTemplate: ', JavaScriptEscape('
-						<div>%buttonRow%</div>
-					'), '
-				});';
-		}
-
-		// Now it's all drawn out we'll actually setup the box.
+		// Now for backward compatibility let's collect few infos in the good ol' style
 		echo '
 				var oEditorHandle_', $editor_id, ' = new smc_Editor({
-					sSessionId: ', JavaScriptEscape($context['session_id']), ',
-					sSessionVar: ', JavaScriptEscape($context['session_var']), ',
-					sFormId: ', JavaScriptEscape($editor_context['form']), ',
 					sUniqueId: ', JavaScriptEscape($editor_id), ',
-					bRTL: ', $txt['lang_rtl'] ? 'true' : 'false', ',
-					bWysiwyg: ', $editor_context['rich_active'] ? 'true' : 'false', ',
-					sText: ', JavaScriptEscape($editor_context['rich_active'] ? $editor_context['rich_value'] : ''), ',
 					sEditWidth: ', JavaScriptEscape($editor_context['width']), ',
 					sEditHeight: ', JavaScriptEscape($editor_context['height']), ',
 					bRichEditOff: ', empty($modSettings['disable_wysiwyg']) ? 'false' : 'true', ',
-					oSmileyBox: ', !empty($context['smileys']['postform']) && !$editor_context['disable_smiley_box'] && $smileyContainer !== null ? 'oSmileyBox_' . $editor_id : 'null', ',
-					oBBCBox: ', $context['show_bbc'] && $bbcContainer !== null ? 'oBBCBox_' . $editor_id : 'null', '
+					oSmileyBox: null,
+					oBBCBox: null
 				});
-				smf_editorArray[smf_editorArray.length] = oEditorHandle_', $editor_id, ';';
-
-		echo '
+				smf_editorArray[smf_editorArray.length] = oEditorHandle_', $editor_id, ';
 			// ]]></script>';
 }
 
 function template_control_richedit_buttons($editor_id)
 {
-	global $context, $settings, $options, $txt, $modSettings, $scripturl;
+	global $context, $settings, $txt, $modSettings;
 
 	$editor_context = &$context['controls']['richedit'][$editor_id];
 
 	echo '
-		<input type="submit" value="', isset($editor_context['labels']['post_button']) ? $editor_context['labels']['post_button'] : $txt['post'], '" tabindex="', $context['tabindex']++, '" onclick="return submitThisOnce(this);" accesskey="s" class="button_submit" />';
+		<span class="smalltext">
+			', $context['shortcuts_text'], '
+		</span>';
+
+	$tempTab = $context['tabindex'];
+	if (!empty($context['drafts_pm_save']))
+		$tempTab++;
+	elseif (!empty($context['drafts_save']))
+		$tempTab++;
+	elseif ($editor_context['preview_type'])
+		$tempTab++;
+	elseif ($context['show_spellchecking'])
+		$tempTab++;
 
-	if ($editor_context['preview_type'])
+	$tempTab++;
+	$context['tabindex'] = $tempTab;
+
+	if (!empty($context['drafts_pm_save']))
+		echo '
+		<input type="submit" name="save_draft" value="', $txt['draft_save'], '" tabindex="',  --$tempTab, '" onclick="submitThisOnce(this);" accesskey="d" class="button_submit">
+		<input type="hidden" id="id_pm_draft" name="id_pm_draft" value="', empty($context['id_pm_draft']) ? 0 : $context['id_pm_draft'], '">';
+
+	if (!empty($context['drafts_save']))
 		echo '
-		<input type="submit" name="preview" value="', isset($editor_context['labels']['preview_button']) ? $editor_context['labels']['preview_button'] : $txt['preview'], '" tabindex="', $context['tabindex']++, '" onclick="', $editor_context['preview_type'] == 2 ? 'return event.ctrlKey || previewPost();' : 'return submitThisOnce(this);', '" accesskey="p" class="button_submit" />';
+		<input type="submit" name="save_draft" value="', $txt['draft_save'], '" tabindex="', --$tempTab, '" onclick="return confirm(' . JavaScriptEscape($txt['draft_save_note']) . ') && submitThisOnce(this);" accesskey="d" class="button_submit">
+		<input type="hidden" id="id_draft" name="id_draft" value="', empty($context['id_draft']) ? 0 : $context['id_draft'], '">';
 
 	if ($context['show_spellchecking'])
 		echo '
-		<input type="button" value="', $txt['spell_check'], '" tabindex="', $context['tabindex']++, '" onclick="oEditorHandle_', $editor_id, '.spellCheckStart();" class="button_submit" />';
+		<input type="button" value="', $txt['spell_check'], '" tabindex="', --$tempTab, '" onclick="oEditorHandle_', $editor_id, '.spellCheckStart();" class="button_submit">';
+
+	if ($editor_context['preview_type'])
+		echo '
+		<input type="submit" name="preview" value="', isset($editor_context['labels']['preview_button']) ? $editor_context['labels']['preview_button'] : $txt['preview'], '" tabindex="', --$tempTab, '" onclick="', $editor_context['preview_type'] == 2 ? 'return event.ctrlKey || previewPost();' : 'return submitThisOnce(this);', '" accesskey="p" class="button_submit">';
+
+
+	echo '
+		<input type="submit" value="', isset($editor_context['labels']['post_button']) ? $editor_context['labels']['post_button'] : $txt['post'], '" tabindex="', --$tempTab, '" onclick="return submitThisOnce(this);" accesskey="s" class="button_submit">';
+
+	// Load in the PM autosaver if it's enabled
+	if (!empty($context['drafts_pm_save']) && !empty($context['drafts_autosave']))
+		echo '
+		<span class="righttext padding" style="display: block">
+			<span id="throbber" style="display:none"><img src="' . $settings['images_url'] . '/loading_sm.gif" alt="" class="centericon">&nbsp;</span>
+			<span id="draft_lastautosave" ></span>
+		</span>
+		<script src="', $settings['default_theme_url'], '/scripts/drafts.js', $modSettings['browser_cache'] ,'"></script>
+		<script><!-- // --><![CDATA[
+			var oDraftAutoSave = new smf_DraftAutoSave({
+				sSelf: \'oDraftAutoSave\',
+				sLastNote: \'draft_lastautosave\',
+				sLastID: \'id_pm_draft\',
+				sSceditorID: \'', $editor_id, '\',
+				sType: \'post\',
+				bPM: true,
+				iBoard: 0,
+				iFreq: ', (empty($modSettings['drafts_autosave_frequency']) ? 60000 : $modSettings['drafts_autosave_frequency'] * 1000), '
+			});
+		// ]]></script>';
+
+	// Start an instance of the auto saver if its enabled
+	if (!empty($context['drafts_save']) && !empty($context['drafts_autosave']))
+		echo '
+		<span class="righttext padding" style="display: block">
+			<span id="throbber" style="display:none"><img src="' . $settings['images_url'] . '/loading_sm.gif" alt="" class="centericon">&nbsp;</span>
+			<span id="draft_lastautosave" ></span>
+		</span>
+		<script src="', $settings['default_theme_url'], '/scripts/drafts.js', $modSettings['browser_cache'] ,'"></script>
+		<script><!-- // --><![CDATA[
+			var oDraftAutoSave = new smf_DraftAutoSave({
+				sSelf: \'oDraftAutoSave\',
+				sLastNote: \'draft_lastautosave\',
+				sLastID: \'id_draft\',
+				sSceditorID: \'', $editor_id, '\',
+				sType: \'post\',
+				iBoard: ', (empty($context['current_board']) ? 0 : $context['current_board']), ',
+				iFreq: ', $context['drafts_autosave_frequency'], '
+			});
+		// ]]></script>';
 }
 
 // What's this, verification?!
 function template_control_verification($verify_id, $display_type = 'all', $reset = false)
 {
-	global $context, $settings, $options, $txt, $modSettings;
+	global $context, $txt;
 
 	$verify_context = &$context['controls']['verification'][$verify_id];
 
@@ -301,30 +245,39 @@
 			echo '
 			<div id="verification_control_', $i, '" class="verification_control">';
 
+		// Display empty field, but only if we have one, and it's the first time.
+		if ($verify_context['empty_field'] && empty($i))
+			echo '
+				<div class="smalltext vv_special">
+					', $txt['visual_verification_hidden'], ':
+					<input type="text" name="', $_SESSION[$verify_id . '_vv']['empty_field'], '" autocomplete="off" size="30" value="">
+				</div>
+				<br>';
+
 		// Do the actual stuff - image first?
 		if ($i == 0 && $verify_context['show_visual'])
 		{
 			if ($context['use_graphic_library'])
 				echo '
-				<img src="', $verify_context['image_href'], '" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '" />';
+				<img src="', $verify_context['image_href'], '" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '">';
 			else
 				echo '
-				<img src="', $verify_context['image_href'], ';letter=1" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_1" />
-				<img src="', $verify_context['image_href'], ';letter=2" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_2" />
-				<img src="', $verify_context['image_href'], ';letter=3" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_3" />
-				<img src="', $verify_context['image_href'], ';letter=4" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_4" />
-				<img src="', $verify_context['image_href'], ';letter=5" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_5" />
-				<img src="', $verify_context['image_href'], ';letter=6" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_6" />';
+				<img src="', $verify_context['image_href'], ';letter=1" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_1">
+				<img src="', $verify_context['image_href'], ';letter=2" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_2">
+				<img src="', $verify_context['image_href'], ';letter=3" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_3">
+				<img src="', $verify_context['image_href'], ';letter=4" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_4">
+				<img src="', $verify_context['image_href'], ';letter=5" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_5">
+				<img src="', $verify_context['image_href'], ';letter=6" alt="', $txt['visual_verification_description'], '" id="verification_image_', $verify_id, '_6">';
 
 			if (WIRELESS)
-				echo '<br />
-				<input type="text" name="', $verify_id, '_vv[code]" value="', !empty($verify_context['text_value']) ? $verify_context['text_value'] : '', '" size="30" tabindex="', $context['tabindex']++, '" class="input_text" />';
+				echo '<br>
+				<input type="text" name="', $verify_id, '_vv[code]" value="', !empty($verify_context['text_value']) ? $verify_context['text_value'] : '', '" size="30" tabindex="', $context['tabindex']++, '" class="input_text" required>';
 			else
 				echo '
 				<div class="smalltext" style="margin: 4px 0 8px 0;">
-					<a href="', $verify_context['image_href'], ';sound" id="visual_verification_', $verify_id, '_sound" rel="nofollow">', $txt['visual_verification_sound'], '</a> / <a href="#" id="visual_verification_', $verify_id, '_refresh">', $txt['visual_verification_request_new'], '</a>', $display_type != 'quick_reply' ? '<br />' : '', '<br />
-					', $txt['visual_verification_description'], ':', $display_type != 'quick_reply' ? '<br />' : '', '
-					<input type="text" name="', $verify_id, '_vv[code]" value="', !empty($verify_context['text_value']) ? $verify_context['text_value'] : '', '" size="30" tabindex="', $context['tabindex']++, '" class="input_text" />
+					<a href="', $verify_context['image_href'], ';sound" id="visual_verification_', $verify_id, '_sound" rel="nofollow">', $txt['visual_verification_sound'], '</a> / <a href="#visual_verification_', $verify_id, '_refresh" id="visual_verification_', $verify_id, '_refresh">', $txt['visual_verification_request_new'], '</a>', $display_type != 'quick_reply' ? '<br>' : '', '<br>
+					', $txt['visual_verification_description'], ':', $display_type != 'quick_reply' ? '<br>' : '', '
+					<input type="text" name="', $verify_id, '_vv[code]" value="', !empty($verify_context['text_value']) ? $verify_context['text_value'] : '', '" size="30" tabindex="', $context['tabindex']++, '" class="input_text" required>
 				</div>';
 		}
 		else
@@ -334,8 +287,8 @@
 
 			echo '
 				<div class="smalltext">
-					', $verify_context['questions'][$qIndex]['q'], ':<br />
-					<input type="text" name="', $verify_id, '_vv[q][', $verify_context['questions'][$qIndex]['id'], ']" size="30" value="', $verify_context['questions'][$qIndex]['a'], '" ', $verify_context['questions'][$qIndex]['is_error'] ? 'style="border: 1px red solid;"' : '', ' tabindex="', $context['tabindex']++, '" class="input_text" />
+					', $verify_context['questions'][$qIndex]['q'], ':<br>
+					<input type="text" name="', $verify_id, '_vv[q][', $verify_context['questions'][$qIndex]['id'], ']" size="30" value="', $verify_context['questions'][$qIndex]['a'], '" ', $verify_context['questions'][$qIndex]['is_error'] ? 'style="border: 1px red solid;"' : '', ' tabindex="', $context['tabindex']++, '" class="input_text" required>
 				</div>';
 		}
 
diff -ru a/Themes/default/GenericList.template.php b/Themes/default/GenericList.template.php
--- a/Themes/default/GenericList.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/GenericList.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,44 +3,39 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_show_list($list_id = null)
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context;
 
 	// Get a shortcut to the current list.
-	$list_id = $list_id === null ? $context['default_list'] : $list_id;
+	$list_id = $list_id === null ? (!empty($context['default_list']) ? $context['default_list'] : '') : $list_id;
+	if (empty($list_id) || empty($context[$list_id]))
+		return;
 	$cur_list = &$context[$list_id];
 
 	// These are the main tabs that is used all around the template.
-	if (!empty($settings['use_tabs']) && isset($cur_list['list_menu'], $cur_list['list_menu']['show_on']) && ($cur_list['list_menu']['show_on'] == 'both' || $cur_list['list_menu']['show_on'] == 'top'))
+	if (isset($cur_list['list_menu'], $cur_list['list_menu']['show_on']) && ($cur_list['list_menu']['show_on'] == 'both' || $cur_list['list_menu']['show_on'] == 'top'))
 		template_create_list_menu($cur_list['list_menu'], 'top');
 
 	if (isset($cur_list['form']))
 		echo '
-	<form action="', $cur_list['form']['href'], '" method="post"', empty($cur_list['form']['name']) ? '' : ' name="' . $cur_list['form']['name'] . '" id="' . $cur_list['form']['name'] . '"', ' accept-charset="', $context['character_set'], '">
-		<div class="generic_list">';
+	<form action="', $cur_list['form']['href'], '" method="post"', empty($cur_list['form']['name']) ? '' : ' name="' . $cur_list['form']['name'] . '" id="' . $cur_list['form']['name'] . '"', ' accept-charset="', $context['character_set'], '">';
 
 	// Show the title of the table (if any).
 	if (!empty($cur_list['title']))
 		echo '
-			<div class="title_bar clear_right">
-				<h3 class="titlebg">
+			<div class="cat_bar clear_right">
+				<h3 class="catbg">
 					', $cur_list['title'], '
 				</h3>
 			</div>';
-	// This is for the old style menu with the arrows "> Test | Test 1"
-	if (empty($settings['use_tabs']) && isset($cur_list['list_menu'], $cur_list['list_menu']['show_on']) && ($cur_list['list_menu']['show_on'] == 'both' || $cur_list['list_menu']['show_on'] == 'top'))
-		template_create_list_menu($cur_list['list_menu'], 'top');
-
-	if (isset($cur_list['additional_rows']['top_of_list']))
-		template_additional_rows('top_of_list', $cur_list);
 
 	if (isset($cur_list['additional_rows']['after_title']))
 	{
@@ -51,35 +46,24 @@
 			</div>';
 	}
 
-	if (!empty($cur_list['items_per_page']) || isset($cur_list['additional_rows']['bottom_of_list']))
-	{
-		echo '
-			<div class="flow_auto">';
+	if (isset($cur_list['additional_rows']['top_of_list']))
+		template_additional_rows('top_of_list', $cur_list);
 
+	if ((!empty($cur_list['items_per_page']) && !empty($cur_list['page_index'])) || isset($cur_list['additional_rows']['above_column_headers']))
+	{
 		// Show the page index (if this list doesn't intend to show all items).
-		if (!empty($cur_list['items_per_page']))
+		if (!empty($cur_list['items_per_page']) && !empty($cur_list['page_index']))
 			echo '
 				<div class="floatleft">
-					<div class="pagesection">', $txt['pages'], ': ', $cur_list['page_index'], '</div>
+					<div class="pagesection">', $cur_list['page_index'], '</div>
 				</div>';
 
 		if (isset($cur_list['additional_rows']['above_column_headers']))
-		{
-			echo '
-				<div class="floatright">';
-
 			template_additional_rows('above_column_headers', $cur_list);
-
-			echo '
-				</div>';
-		}
-
-		echo '
-			</div>';
 	}
 
 	echo '
-			<table class="table_grid" cellspacing="0" width="', !empty($cur_list['width']) ? $cur_list['width'] : '100%', '">';
+			<table class="table_grid clear" ', !empty($cur_list['width']) ? ' style="width:' . $cur_list['width'] . '"' : '', '>';
 
 	// Show the column headers.
 	$header_count = count($cur_list['headers']);
@@ -87,52 +71,45 @@
 	{
 		echo '
 			<thead>
-				<tr class="catbg">';
+				<tr class="title_bar">';
 
 		// Loop through each column and add a table header.
-		$i = 0;
 		foreach ($cur_list['headers'] as $col_header)
 		{
-			$i ++;
-			if (empty($col_header['class']) && $i == 1)
-				$col_header['class'] = 'first_th';
-			elseif (empty($col_header['class']) && $i == $header_count)
-				$col_header['class'] = 'last_th';
-
 			echo '
-					<th scope="col"', empty($col_header['class']) ? '' : ' class="' . $col_header['class'] . '"', empty($col_header['style']) ? '' : ' style="' . $col_header['style'] . '"', empty($col_header['colspan']) ? '' : ' colspan="' . $col_header['colspan'] . '"', '>', empty($col_header['href']) ? '' : '<a href="' . $col_header['href'] . '" rel="nofollow">', empty($col_header['label']) ? '&nbsp;' : $col_header['label'], empty($col_header['href']) ? '' : '</a>', empty($col_header['sort_image']) ? '' : ' <img src="' . $settings['images_url'] . '/sort_' . $col_header['sort_image'] . '.gif" alt="" />', '</th>';
+					<th scope="col" id="header_', $list_id, '_', $col_header['id'], '"', empty($col_header['class']) ? '' : ' class="' . $col_header['class'] . '"', empty($col_header['style']) ? '' : ' style="' . $col_header['style'] . '"', empty($col_header['colspan']) ? '' : ' colspan="' . $col_header['colspan'] . '"', '>', empty($col_header['href']) ? '' : '<a href="' . $col_header['href'] . '" rel="nofollow">', empty($col_header['label']) ? '&nbsp;' : $col_header['label'], empty($col_header['href']) ? '' : (empty($col_header['sort_image']) ? '</a>' : ' <span class="generic_icons sort_' . $col_header['sort_image'] . '"></span></a>'), '</th>';
 		}
 
 		echo '
 				</tr>
-			</thead>
-			<tbody>';
+			</thead>';
 	}
 
+		echo '
+			<tbody>';
+
 	// Show a nice message informing there are no items in this list.
 	if (empty($cur_list['rows']) && !empty($cur_list['no_items_label']))
 		echo '
-				<tr>
-					<td class="windowbg" colspan="', $cur_list['num_columns'], '" align="', !empty($cur_list['no_items_align']) ? $cur_list['no_items_align'] : 'center', '"><div class="padding">', $cur_list['no_items_label'], '</div></td>
+				<tr class="windowbg">
+					<td colspan="', $cur_list['num_columns'], '" align="', !empty($cur_list['no_items_align']) ? $cur_list['no_items_align'] : 'center', '"><div class="padding">', $cur_list['no_items_label'], '</div></td>
 				</tr>';
 
 	// Show the list rows.
 	elseif (!empty($cur_list['rows']))
 	{
-		$alternate = false;
 		foreach ($cur_list['rows'] as $id => $row)
 		{
 			echo '
-				<tr class="windowbg', $alternate ? '2' : '', '" id="list_', $list_id, '_', $id, '">';
+				<tr class="windowbg', empty($row['class']) ? '' : ' ' . $row['class'], '"', empty($row['style']) ? '' : ' style="' . $row['style'] . '"', ' id="list_', $list_id, '_', $id, '">';
 
-			foreach ($row as $row_data)
-				echo '
+			if (!empty($row['data']))
+				foreach ($row['data'] as $row_data)
+					echo '
 					<td', empty($row_data['class']) ? '' : ' class="' . $row_data['class'] . '"', empty($row_data['style']) ? '' : ' style="' . $row_data['style'] . '"', '>', $row_data['value'], '</td>';
 
 			echo '
 				</tr>';
-
-			$alternate = !$alternate;
 		}
 	}
 
@@ -140,70 +117,55 @@
 			</tbody>
 			</table>';
 
-	if (!empty($cur_list['items_per_page']) || isset($cur_list['additional_rows']['below_table_data']) || isset($cur_list['additional_rows']['bottom_of_list']))
+	if ((!empty($cur_list['items_per_page']) && !empty($cur_list['page_index'])) || isset($cur_list['additional_rows']['below_table_data']))
 	{
 		echo '
 			<div class="flow_auto">';
 
 		// Show the page index (if this list doesn't intend to show all items).
-		if (!empty($cur_list['items_per_page']))
+		if (!empty($cur_list['items_per_page']) && !empty($cur_list['page_index']))
 			echo '
 				<div class="floatleft">
-					<div class="pagesection">', $txt['pages'], ': ', $cur_list['page_index'], '</div>
+					<div class="pagesection">', $cur_list['page_index'], '</div>
 				</div>';
 
 		if (isset($cur_list['additional_rows']['below_table_data']))
-		{
-			echo '
-				<div class="floatright">';
-
 			template_additional_rows('below_table_data', $cur_list);
 
-			echo '
-				</div>';
-		}
-
-		if (isset($cur_list['additional_rows']['bottom_of_list']))
-		{
-			echo '
-				<div class="floatright">';
-
-			template_additional_rows('bottom_of_list', $cur_list);
-
-			echo '
-				</div>';
-		}
-
 		echo '
 			</div>';
 	}
 
+	if (isset($cur_list['additional_rows']['bottom_of_list']))
+		template_additional_rows('bottom_of_list', $cur_list);
+
 	if (isset($cur_list['form']))
 	{
 		foreach ($cur_list['form']['hidden_fields'] as $name => $value)
 			echo '
-			<input type="hidden" name="', $name, '" value="', $value, '" />';
+			<input type="hidden" name="', $name, '" value="', $value, '">';
+
+		if (isset($cur_list['form']['token']))
+			echo '
+			<input type="hidden" name="', $context[$cur_list['form']['token'] . '_token_var'], '" value="', $context[$cur_list['form']['token'] . '_token'], '">';
 
 		echo '
-		</div>
 	</form>';
 	}
 
-	// Tabs at the bottom.  Usually bottom alligned.
-	if (!empty($settings['use_tabs']) && isset($cur_list['list_menu'], $cur_list['list_menu']['show_on']) && ($cur_list['list_menu']['show_on'] == 'both' || $cur_list['list_menu']['show_on'] == 'bottom'))
+	// Tabs at the bottom.  Usually bottom aligned.
+	if (isset($cur_list['list_menu'], $cur_list['list_menu']['show_on']) && ($cur_list['list_menu']['show_on'] == 'both' || $cur_list['list_menu']['show_on'] == 'bottom'))
 		template_create_list_menu($cur_list['list_menu'], 'bottom');
 
 	if (isset($cur_list['javascript']))
 		echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		', $cur_list['javascript'], '
 	// ]]></script>';
 }
 
 function template_additional_rows($row_position, $cur_list)
 {
-	global $context, $settings, $options;
-
 	foreach ($cur_list['additional_rows'][$row_position] as $row)
 		echo '
 			<div class="additional_row', empty($row['class']) ? '' : ' ' . $row['class'], '"', empty($row['style']) ? '' : ' style="' . $row['style'] . '"', '>', $row['value'], '</div>';
@@ -211,7 +173,7 @@
 
 function template_create_list_menu($list_menu, $direction = 'top')
 {
-	global $context, $settings;
+	global $context;
 
 	/**
 		// This is use if you want your generic lists to have tabs.
@@ -219,9 +181,9 @@
 			// This is the style to use.  Tabs or Buttons (Text 1 | Text 2).
 			// By default tabs are selected if not set.
 			// The main difference between tabs and buttons is that tabs get highlighted if selected.
-			// If style is set to buttons and use tabs is diabled then we change the style to old styled tabs.
+			// If style is set to buttons and use tabs is disabled then we change the style to old styled tabs.
 			'style' => 'tabs',
-			// The posisiton of the tabs/buttons.  Left or Right.  By default is set to left.
+			// The position of the tabs/buttons.  Left or Right.  By default is set to left.
 			'position' => 'left',
 			// This is used by the old styled menu.  We *need* to know the total number of columns to span.
 			'columns' => 0,
@@ -247,40 +209,34 @@
 	$first = $context['right_to_left'] ? 'last' : 'first';
 	$last = $context['right_to_left'] ? 'first' : 'last';
 
-	// Tabs take preference over buttons in certain cases.
-	if (empty($settings['use_tabs']) && $list_menu['style'] == 'button')
-		$list_menu['style'] = 'tabs';
-
 	if (!isset($list_menu['style']) || isset($list_menu['style']) && $list_menu['style'] == 'tabs')
 	{
-		if (!empty($settings['use_tabs']))
-		{
-			echo '
-		<table cellpadding="0" cellspacing="0" style="margin-', $list_menu['position'], ': 10px; width: 100%;">
+		echo '
+		<table style="margin-', $list_menu['position'], ': 10px; width: 100%;">
 			<tr>', $list_menu['position'] == 'right' ? '
 				<td>&nbsp;</td>' : '', '
 				<td align="', $list_menu['position'], '">
-					<table cellspacing="0" cellpadding="0">
+					<table>
 						<tr>
 							<td class="', $direction == 'top' ? 'mirror' : 'main', 'tab_', $first, '">&nbsp;</td>';
 
-			foreach ($list_menu['links'] as $link)
-			{
-				if ($link['is_selected'])
-					echo '
+		foreach ($list_menu['links'] as $link)
+		{
+			if ($link['is_selected'])
+				echo '
 							<td class="', $direction == 'top' ? 'mirror' : 'main', 'tab_active_', $first, '">&nbsp;</td>
-							<td valign="top" class="', $direction == 'top' ? 'mirrortab' : 'maintab', '_active_back">
+							<td class="', $direction == 'top' ? 'mirrortab' : 'maintab', '_active_back">
 								<a href="', $link['href'], '">', $link['label'], '</a>
 							</td>
 							<td class="', $direction == 'top' ? 'mirror' : 'main', 'tab_active_', $last, '">&nbsp;</td>';
-				else
-					echo '
-							<td valign="top" class="', $direction == 'top' ? 'mirror' : 'main', 'tab_back">
+			else
+				echo '
+							<td class="', $direction == 'top' ? 'mirror' : 'main', 'tab_back">
 								<a href="', $link['href'], '">', $link['label'], '</a>
 							</td>';
-			}
+		}
 
-			echo '
+		echo '
 							<td class="', $direction == 'top' ? 'mirror' : 'main', 'tab_', $last, '">&nbsp;</td>
 						</tr>
 					</table>
@@ -288,22 +244,6 @@
 				<td>&nbsp;</td>' : '', '
 			</tr>
 		</table>';
-		}
-		else
-		{
-			echo '
-			<tr class="titlebg">
-				<td colspan="', $context['colspan'], '">';
-
-			$links = array();
-			foreach ($list_menu['links'] as $link)
-				$links[] = ($link['is_selected'] ? '<img src="' . $settings['images_url'] . '/selected.gif" alt="&gt;" /> ' : '') . '<a href="' . $link['href'] . '">' . $link['label'] . '</a>';
-
-			echo '
-				', implode(' | ', $links), '
-				</td>
-			</tr>';
-		}
 	}
 	elseif (isset($list_menu['style']) && $list_menu['style'] == 'buttons')
 	{
@@ -312,11 +252,11 @@
 			$links[] = '<a href="' . $link['href'] . '">' . $link['label'] . '</a>';
 
 		echo '
-		<table cellpadding="0" cellspacing="0" style="margin-', $list_menu['position'], ': 10px; width: 100%;">
+		<table style="margin-', $list_menu['position'], ': 10px; width: 100%;">
 			<tr>', $list_menu['position'] == 'right' ? '
 				<td>&nbsp;</td>' : '', '
 				<td align="', $list_menu['position'], '">
-					<table cellspacing="0" cellpadding="0">
+					<table>
 						<tr>
 							<td class="', $direction == 'top' ? 'mirror' : 'main', 'tab_', $first, '">&nbsp;</td>
 							<td class="', $direction == 'top' ? 'mirror' : 'main', 'tab_back">', implode(' &nbsp;|&nbsp; ', $links), '</td>
diff -ru a/Themes/default/GenericMenu.template.php b/Themes/default/GenericMenu.template.php
--- a/Themes/default/GenericMenu.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/GenericMenu.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,142 +3,37 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // This contains the html for the side bar of the admin center, which is used for all admin pages.
-function template_generic_menu_sidebar_above()
-{
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
-
-	// This is the main table - we need it so we can keep the content to the right of it.
-	echo '
-	<div id="main_container">
-		<div id="left_admsection"><span id="admin_menu"></span>';
-
-	// What one are we rendering?
-	$context['cur_menu_id'] = isset($context['cur_menu_id']) ? $context['cur_menu_id'] + 1 : 1;
-	$menu_context = &$context['menu_data_' . $context['cur_menu_id']];
-
-	// For every section that appears on the sidebar...
-	$firstSection = true;
-	foreach ($menu_context['sections'] as $section)
-	{
-		// Show the section header - and pump up the line spacing for readability.
-		echo '
-			<div class="adm_section">
-				<div class="cat_bar">
-					<h4 class="catbg">';
-
-		if ($firstSection && !empty($menu_context['can_toggle_drop_down']))
-		{
-			echo '
-						<span class="ie6_header floatleft">
-							<a href="', $menu_context['toggle_url'], '">', $section['title'],'<img style="margin: 0 5px; vertical-align: middle;" src="', $context['menu_image_path'], '/change_menu', $context['right_to_left'] ? '' : '2', '.png" alt="!" /></a>
-						</span>';
-		}
-		else
-		{
-			echo '
-						', $section['title'];
-		}
-
-		echo '
-					</h4>
-				</div>
-				<ul class="smalltext left_admmenu">';
-
-		// For every area of this section show a link to that area (bold if it's currently selected.)
-		foreach ($section['areas'] as $i => $area)
-		{
-			// Not supposed to be printed?
-			if (empty($area['label']))
-				continue;
-
-			echo '
-					<li>';
-
-			// Is this the current area, or just some area?
-			if ($i == $menu_context['current_area'])
-			{
-				echo '
-						<strong><a href="', isset($area['url']) ? $area['url'] : $menu_context['base_url'] . ';area=' . $i, $menu_context['extra_parameters'], '">', $area['label'], '</a></strong>';
-
-				if (empty($context['tabs']))
-					$context['tabs'] = isset($area['subsections']) ? $area['subsections'] : array();
-			}
-			else
-				echo '
-						<a href="', isset($area['url']) ? $area['url'] : $menu_context['base_url'] . ';area=' . $i, $menu_context['extra_parameters'], '">', $area['label'], '</a>';
-
-			echo '
-					</li>';
-		}
-
-		echo '
-				</ul>
-			</div>';
-
-		$firstSection = false;
-	}
-
-	// This is where the actual "main content" area for the admin section starts.
-	echo '
-		</div>
-		<div id="main_admsection">';
-
-	// If there are any "tabs" setup, this is the place to shown them.
-	if (!empty($context['tabs']) && empty($context['force_disable_tabs']))
-		template_generic_menu_tabs($menu_context);
-}
-
-// Part of the sidebar layer - closes off the main bit.
-function template_generic_menu_sidebar_below()
-{
-	global $context, $settings, $options;
-
-	echo '
-		</div>
-	</div><br class="clear" />';
-}
-
-// This contains the html for the side bar of the admin center, which is used for all admin pages.
 function template_generic_menu_dropdown_above()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context;
 
 	// Which menu are we rendering?
 	$context['cur_menu_id'] = isset($context['cur_menu_id']) ? $context['cur_menu_id'] + 1 : 1;
 	$menu_context = &$context['menu_data_' . $context['cur_menu_id']];
 
-	if (!empty($menu_context['can_toggle_drop_down']))
-		echo '
-	<a href="', $menu_context['toggle_url'], '"><img id="menu_toggle" src="', $context['menu_image_path'], '/change_menu', $context['right_to_left'] ? '2' : '', '.png" alt="*" /></a>';
+	echo '
+				<div id="admin_menu">';
 
 	echo '
-<div id="admin_menu">
-	<ul class="dropmenu" id="dropdown_menu_', $context['cur_menu_id'], '">';
+					<ul class="dropmenu" id="dropdown_menu_', $context['cur_menu_id'], '">';
 
 	// Main areas first.
 	foreach ($menu_context['sections'] as $section)
 	{
-		if ($section['id'] == $menu_context['current_section'])
-		{
-			echo '
-			<li><a class="active firstlevel" href="#"><span class="firstlevel">', $section['title'] , '</span></a>
-				<ul>';
-		}
-		else
-			echo '
-			<li><a class="firstlevel" href="#"><span class="firstlevel">', $section['title'] , '</span></a>
-				<ul>';
+		echo '
+						<li ', !empty($section['areas']) ? 'class="subsections"' : '', '><a class="', !empty($section['selected']) ? 'active ' : '', '" href="', $section['url'], $menu_context['extra_parameters'], '">', $section['title'] , '</a>
+							<ul>';
 
 		// For every area of this section show a link to that area (bold if it's currently selected.)
-		$additional_items = 0;
+		// @todo Code for additional_items class was deprecated and has been removed. Suggest following up in Sources if required.
 		foreach ($section['areas'] as $i => $area)
 		{
 			// Not supposed to be printed?
@@ -146,27 +41,20 @@
 				continue;
 
 			echo '
-					<li', (++$additional_items > 6) ? ' class="additional_items"' : '' ,'>';
+								<li', !empty($area['subsections']) ? ' class="subsections"' : '', '>';
 
-			// Is this the current area, or just some area?
-			if ($i == $menu_context['current_area'])
-			{
-				echo '
-						<a class="chosen" href="', (isset($area['url']) ? $area['url'] : $menu_context['base_url'] . ';area=' . $i), $menu_context['extra_parameters'], '"><span>', $area['icon'], $area['label'], !empty($area['subsections']) ? '...' : '', '</span></a>';
+			echo '
+									<a class="', $area['icon_class'], !empty($area['selected']) ? ' chosen ' : '', '" href="', (isset($area['url']) ? $area['url'] : $menu_context['base_url'] . ';area=' . $i), $menu_context['extra_parameters'], '">', $area['icon'], $area['label'], '</a>';
 
-				if (empty($context['tabs']))
+			// Is this the current area, or just some area?
+			if (!empty($area['selected']) && empty($context['tabs']))
 					$context['tabs'] = isset($area['subsections']) ? $area['subsections'] : array();
-			}
-			else
-				echo '
-						<a href="', (isset($area['url']) ? $area['url'] : $menu_context['base_url'] . ';area=' . $i), $menu_context['extra_parameters'], '"><span>', $area['icon'], $area['label'], !empty($area['subsections']) ? '...' : '', '</span></a>';
 
-			// Is there any subsections?
-			$additional_items_sub = 0;
+			// Are there any subsections?
 			if (!empty($area['subsections']))
 			{
 				echo '
-						<ul>';
+									<ul>';
 
 				foreach ($area['subsections'] as $sa => $sub)
 				{
@@ -176,139 +64,150 @@
 					$url = isset($sub['url']) ? $sub['url'] : (isset($area['url']) ? $area['url'] : $menu_context['base_url'] . ';area=' . $i) . ';sa=' . $sa;
 
 					echo '
-							<li', (++$additional_items_sub > 6) ? ' class="additional_items"' : '' ,'>
-								<a ', !empty($sub['selected']) ? 'class="active" ' : '', 'href="', $url, $menu_context['extra_parameters'], '"><span>', $sub['label'], '</span></a>
-							</li>';
+										<li>
+											<a ', !empty($sub['selected']) ? 'class="chosen" ' : '', ' href="', $url, $menu_context['extra_parameters'], '">', $sub['label'], '</a>
+										</li>';
 				}
 
 				echo '
-						</ul>';
+									</ul>';
 			}
 
 			echo '
-					</li>';
+								</li>';
 		}
 		echo '
-				</ul>
-			</li>';
+							</ul>
+						</li>';
 	}
 
 	echo '
-	</ul>
-</div>';
+					</ul>
+				</div>';
 
 	// This is the main table - we need it so we can keep the content to the right of it.
 	echo '
-<div id="admin_content">';
+				<div id="admin_content">';
 
 	// It's possible that some pages have their own tabs they wanna force...
-	if (!empty($context['tabs']))
+// 	if (!empty($context['tabs']))
 		template_generic_menu_tabs($menu_context);
 }
 
 // Part of the admin layer - used with admin_above to close the table started in it.
 function template_generic_menu_dropdown_below()
 {
-	global $context, $settings, $options;
-
 	echo '
-</div>';
+				</div>';
 }
 
 // Some code for showing a tabbed view.
 function template_generic_menu_tabs(&$menu_context)
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt;
 
 	// Handy shortcut.
 	$tab_context = &$menu_context['tab_data'];
 
-	echo '
-	<div class="cat_bar">
-		<h3 class="catbg">';
-
-	// Exactly how many tabs do we have?
-	foreach ($context['tabs'] as $id => $tab)
+	if (!empty($tab_context['title']))
 	{
-		// Can this not be accessed?
-		if (!empty($tab['disabled']))
-		{
-			$tab_context['tabs'][$id]['disabled'] = true;
-			continue;
-		}
+		echo '
+					<div class="cat_bar">
+						<h3 class="catbg">';
 
-		// Did this not even exist - or do we not have a label?
-		if (!isset($tab_context['tabs'][$id]))
-			$tab_context['tabs'][$id] = array('label' => $tab['label']);
-		elseif (!isset($tab_context['tabs'][$id]['label']))
-			$tab_context['tabs'][$id]['label'] = $tab['label'];
-
-		// Has a custom URL defined in the main admin structure?
-		if (isset($tab['url']) && !isset($tab_context['tabs'][$id]['url']))
-			$tab_context['tabs'][$id]['url'] = $tab['url'];
-		// Any additional paramaters for the url?
-		if (isset($tab['add_params']) && !isset($tab_context['tabs'][$id]['add_params']))
-			$tab_context['tabs'][$id]['add_params'] = $tab['add_params'];
-		// Has it been deemed selected?
-		if (!empty($tab['is_selected']))
-			$tab_context['tabs'][$id]['is_selected'] = true;
-		// Does it have its own help?
-		if (!empty($tab['help']))
-			$tab_context['tabs'][$id]['help'] = $tab['help'];
-		// Is this the last one?
-		if (!empty($tab['is_last']) && !isset($tab_context['override_last']))
-			$tab_context['tabs'][$id]['is_last'] = true;
-	}
+		// The function is in Admin.template.php, but since this template is used elsewhere too better check if the function is available
+		if (function_exists('template_admin_quick_search'))
+			template_admin_quick_search();
 
-	// Find the selected tab
-	foreach ($tab_context['tabs'] as $sa => $tab)
-	{
-		if (!empty($tab['is_selected']) || (isset($menu_context['current_subsection']) && $menu_context['current_subsection'] == $sa))
+		// Exactly how many tabs do we have?
+		if (!empty($context['tabs']))
 		{
-			$selected_tab = $tab;
-			$tab_context['tabs'][$sa]['is_selected'] = true;
+			foreach ($context['tabs'] as $id => $tab)
+			{
+				// Can this not be accessed?
+				if (!empty($tab['disabled']))
+				{
+					$tab_context['tabs'][$id]['disabled'] = true;
+					continue;
+				}
+
+				// Did this not even exist - or do we not have a label?
+				if (!isset($tab_context['tabs'][$id]))
+					$tab_context['tabs'][$id] = array('label' => $tab['label']);
+				elseif (!isset($tab_context['tabs'][$id]['label']))
+					$tab_context['tabs'][$id]['label'] = $tab['label'];
+
+				// Has a custom URL defined in the main admin structure?
+				if (isset($tab['url']) && !isset($tab_context['tabs'][$id]['url']))
+					$tab_context['tabs'][$id]['url'] = $tab['url'];
+
+				// Any additional paramaters for the url?
+				if (isset($tab['add_params']) && !isset($tab_context['tabs'][$id]['add_params']))
+					$tab_context['tabs'][$id]['add_params'] = $tab['add_params'];
+
+				// Has it been deemed selected?
+				if (!empty($tab['is_selected']))
+					$tab_context['tabs'][$id]['is_selected'] = true;
+
+				// Does it have its own help?
+				if (!empty($tab['help']))
+					$tab_context['tabs'][$id]['help'] = $tab['help'];
+
+				// Is this the last one?
+				if (!empty($tab['is_last']) && !isset($tab_context['override_last']))
+					$tab_context['tabs'][$id]['is_last'] = true;
+			}
+
+			// Find the selected tab
+			foreach ($tab_context['tabs'] as $sa => $tab)
+			{
+				if (!empty($tab['is_selected']) || (isset($menu_context['current_subsection']) && $menu_context['current_subsection'] == $sa))
+				{
+					$selected_tab = $tab;
+					$tab_context['tabs'][$sa]['is_selected'] = true;
+				}
+			}
 		}
-	}
 
-	// Show an icon and/or a help item?
-	if (!empty($selected_tab['icon']) || !empty($tab_context['icon']) || !empty($selected_tab['help']) || !empty($tab_context['help']))
-	{
-		echo '
-			<span class="ie6_header floatleft">';
+		// Show an icon and/or a help item?
+		if (!empty($selected_tab['icon_class']) || !empty($tab_context['icon_class']) || !empty($selected_tab['icon']) || !empty($tab_context['icon']) || !empty($selected_tab['help']) || !empty($tab_context['help']))
+		{
+			if (!empty($selected_tab['icon_class']) || !empty($tab_context['icon_class']))
+				echo '<span class="', !empty($selected_tab['icon_class']) ? $selected_tab['icon_class'] : $tab_context['icon_class'], ' icon"></span>';
+			elseif (!empty($selected_tab['icon']) || !empty($tab_context['icon']))
+				echo '<img src="', $settings['images_url'], '/icons/', !empty($selected_tab['icon']) ? $selected_tab['icon'] : $tab_context['icon'], '" alt="" class="icon">';
 
-		if (!empty($selected_tab['icon']) || !empty($tab_context['icon']))
-			echo '<img src="', $settings['images_url'], '/icons/', !empty($selected_tab['icon']) ? $selected_tab['icon'] : $tab_context['icon'], '" alt="" class="icon" />';
+			if (!empty($selected_tab['help']) || !empty($tab_context['help']))
+				echo '<a href="', $scripturl, '?action=helpadmin;help=', !empty($selected_tab['help']) ? $selected_tab['help'] : $tab_context['help'], '" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a>';
 
-		if (!empty($selected_tab['help']) || !empty($tab_context['help']))
-			echo '<a href="', $scripturl, '?action=helpadmin;help=', !empty($selected_tab['help']) ? $selected_tab['help'] : $tab_context['help'], '" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" class="icon" /></a>';
+			echo $tab_context['title'];
+		}
+		else
+		{
+			echo '
+							', $tab_context['title'];
+		}
 
-		echo $tab_context['title'], '
-			</span>';
-	}
-	else
-	{
 		echo '
-			', $tab_context['title'];
+						</h3>
+					</div>';
 	}
 
-	echo '
-		</h3>
-	</div>';
-
-	// Shall we use the tabs?
-	if (!empty($settings['use_tabs']))
-	{
+	// Shall we use the tabs? Yes, it's the only known way!
+	if (!empty($selected_tab['description']) || !empty($tab_context['description']))
 		echo '
-	<p class="windowbg description">
-		', !empty($selected_tab['description']) ? $selected_tab['description'] : $tab_context['description'], '
-	</p>';
+					<p class="information">
+						', !empty($selected_tab['description']) ? $selected_tab['description'] : $tab_context['description'], '
+					</p>';
 
+	// Print out all the items in this tab (if any).
+	if (!empty($context['tabs']))
+	{
 		// The admin tabs.
 		echo '
-	<div id="adm_submenus">
-		<ul class="dropmenu">';
+					<div id="adm_submenus">
+						<ul class="dropmenu">';
 
-		// Print out all the items in this tab.
 		foreach ($tab_context['tabs'] as $sa => $tab)
 		{
 			if (!empty($tab['disabled']))
@@ -317,50 +216,22 @@
 			if (!empty($tab['is_selected']))
 			{
 				echo '
-			<li>
-				<a class="active firstlevel" href="', isset($tab['url']) ? $tab['url'] : $menu_context['base_url'] . ';area=' . $menu_context['current_area'] . ';sa=' . $sa, $menu_context['extra_parameters'], isset($tab['add_params']) ? $tab['add_params'] : '', '"><span class="firstlevel">', $tab['label'], '</span></a>
-			</li>';
+							<li>
+								<a class="active" href="', isset($tab['url']) ? $tab['url'] : $menu_context['base_url'] . ';area=' . $menu_context['current_area'] . ';sa=' . $sa, $menu_context['extra_parameters'], isset($tab['add_params']) ? $tab['add_params'] : '', '">', $tab['label'], '</a>
+							</li>';
 			}
 			else
 				echo '
-			<li>
-				<a class="firstlevel" href="', isset($tab['url']) ? $tab['url'] : $menu_context['base_url'] . ';area=' . $menu_context['current_area'] . ';sa=' . $sa, $menu_context['extra_parameters'], isset($tab['add_params']) ? $tab['add_params'] : '', '"><span class="firstlevel">', $tab['label'], '</span></a>
-			</li>';
+							<li>
+								<a href="', isset($tab['url']) ? $tab['url'] : $menu_context['base_url'] . ';area=' . $menu_context['current_area'] . ';sa=' . $sa, $menu_context['extra_parameters'], isset($tab['add_params']) ? $tab['add_params'] : '', '">', $tab['label'], '</a>
+							</li>';
 		}
 
 		// the end of tabs
 		echo '
-		</ul>
-	</div><br class="clear" />';
-	}
-	// ...if not use the old style
-	else
-	{
-		echo '
-	<p class="tabs">';
-
-		// Print out all the items in this tab.
-		foreach ($tab_context['tabs'] as $sa => $tab)
-		{
-			if (!empty($tab['disabled']))
-				continue;
-
-			if (!empty($tab['is_selected']))
-			{
-				echo '
-		<img src="', $settings['images_url'], '/selected.gif" alt="*" /> <strong><a href="', isset($tab['url']) ? $tab['url'] : $menu_context['base_url'] . ';area=' . $menu_context['current_area'] . ';sa=' . $sa, $menu_context['extra_parameters'], '">', $tab['label'], '</a></strong>';
-			}
-			else
-				echo '
-		<a href="', isset($tab['url']) ? $tab['url'] : $menu_context['base_url'] . ';area=' . $menu_context['current_area'] . ';sa=' . $sa, $menu_context['extra_parameters'], '">', $tab['label'], '</a>';
-
-			if (empty($tab['is_last']))
-				echo ' | ';
-		}
+						</ul>
+					</div>';
 
-		echo '
-	</p>
-	<p class="windowbg description">', isset($selected_tab['description']) ? $selected_tab['description'] : $tab_context['description'], '</p>';
 	}
 }
 
diff -ru a/Themes/default/Help.template.php b/Themes/default/Help.template.php
--- a/Themes/default/Help.template.php	2013-10-21 14:00:28.000000000 -0700
+++ b/Themes/default/Help.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,31 +3,31 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0.6
+ * @version 2.1 Beta 1
  */
 
 function template_popup()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $settings, $txt, $modSettings;
 
 	// Since this is a popup of its own we need to start the html, etc.
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
-		<meta name="robots" content="noindex" />
+		<meta charset="', $context['character_set'], '">
+		<meta name="robots" content="noindex">
 		<title>', $context['page_title'], '</title>
-		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index.css" />
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/script.js"></script>
+		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index', $context['theme_variant'], '.css', $modSettings['browser_cache'] ,'">
+		<script src="', $settings['default_theme_url'], '/scripts/script.js', $modSettings['browser_cache'] ,'"></script>
 	</head>
 	<body id="help_popup">
 		<div class="windowbg description">
-			', $context['help_text'], '<br />
-			<br />
+			', $context['help_text'], '<br>
+			<br>
 			<a href="javascript:self.close();">', $txt['close_window'], '</a>
 		</div>
 	</body>
@@ -36,17 +36,17 @@
 
 function template_find_members()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $settings, $scripturl, $modSettings, $txt;
 
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
 		<title>', $txt['find_members'], '</title>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
-		<meta name="robots" content="noindex" />
-		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index.css" />
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/script.js"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<meta charset="', $context['character_set'], '">
+		<meta name="robots" content="noindex">
+		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index', $context['theme_variant'], '.css', $modSettings['browser_cache'] ,'">
+		<script src="', $settings['default_theme_url'], '/scripts/script.js', $modSettings['browser_cache'] ,'"></script>
+		<script><!-- // --><![CDATA[
 			var membersAdded = [];
 			function addMember(name)
 			{
@@ -70,78 +70,68 @@
 	</head>
 	<body id="help_popup">
 		<form action="', $scripturl, '?action=findmember;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '" class="padding description">
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
-				<div class="innerframe">
-					<div class="cat_bar">
-						<h3 class="catbg">', $txt['find_members'], '</h3>
-					</div>
-					<div class="padding">
-						<strong>', $txt['find_username'], ':</strong><br />
-						<input type="text" name="search" id="search" value="', isset($context['last_search']) ? $context['last_search'] : '', '" style="margin-top: 4px; width: 96%;" class="input_text" /><br />
-						<span class="smalltext"><em>', $txt['find_wildcards'], '</em></span><br />';
+				<div class="cat_bar">
+					<h3 class="catbg">', $txt['find_members'], '</h3>
+				</div>
+				<div class="padding">
+					<strong>', $txt['find_username'], ':</strong><br>
+					<input type="text" name="search" id="search" value="', isset($context['last_search']) ? $context['last_search'] : '', '" style="margin-top: 4px; width: 96%;" class="input_text"><br>
+					<span class="smalltext"><em>', $txt['find_wildcards'], '</em></span><br>';
 
 	// Only offer to search for buddies if we have some!
 	if (!empty($context['show_buddies']))
 		echo '
-						<span class="smalltext"><label for="buddies"><input type="checkbox" class="input_check" name="buddies" id="buddies"', !empty($context['buddy_search']) ? ' checked="checked"' : '', ' /> ', $txt['find_buddies'], '</label></span><br />';
+					<span class="smalltext"><label for="buddies"><input type="checkbox" class="input_check" name="buddies" id="buddies"', !empty($context['buddy_search']) ? ' checked' : '', '> ', $txt['find_buddies'], '</label></span><br>';
 
 	echo '
-						<div class="padding righttext">
-							<input type="submit" value="', $txt['search'], '" class="button_submit" />
-							<input type="button" value="', $txt['find_close'], '" onclick="window.close();" class="button_submit" />
-						</div>
+					<div class="padding righttext">
+						<input type="submit" value="', $txt['search'], '" class="button_submit">
+						<input type="button" value="', $txt['find_close'], '" onclick="window.close();" class="button_submit">
 					</div>
 				</div>
 			</div>
-			<span class="lowerframe"><span></span></span>
-			<br />
-			<span class="upperframe"><span></span></span>
+			<br>
 			<div class="roundframe">
-				<div class="innerframe">
-					<div class="cat_bar">
-						<h3 class="catbg">', $txt['find_results'], '</h3>
-					</div>';
+				<div class="cat_bar">
+					<h3 class="catbg">', $txt['find_results'], '</h3>
+				</div>';
 
 	if (empty($context['results']))
 		echo '
-					<p class="error">', $txt['find_no_results'], '</p>';
+				<p class="error">', $txt['find_no_results'], '</p>';
 	else
 	{
 		echo '
-					<ul class="reset padding">';
+				<ul class="reset padding">';
 
-		$alternate = true;
 		foreach ($context['results'] as $result)
 		{
 			echo '
-						<li class="', $alternate ? 'windowbg2' : 'windowbg', '">
-							<a href="', $result['href'], '" target="_blank" class="new_win"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="', $txt['view_profile'], '" title="', $txt['view_profile'], '" /></a>
-							<a href="javascript:void(0);" onclick="addMember(this.innerHTML); return false;">', $result['name'], '</a>
-						</li>';
-
-			$alternate = !$alternate;
+					<li class="windowbg">
+						<a href="', $result['href'], '" target="_blank" class="new_win"> <span class="generic_icons profile_sm"></span>
+						<a href="javascript:void(0);" onclick="addMember(this.innerHTML); return false;">', $result['name'], '</a>
+					</li>';
 		}
 
 		echo '
-					</ul>
-					<div class="pagesection">
-						', $txt['pages'], ': ', $context['page_index'], '
-					</div>';
+				</ul>
+				<div class="pagesection">
+					', $context['page_index'], '
+				</div>';
 	}
 
 	echo '
-				</div>
+
 			</div>
-			<span class="lowerframe"><span></span></span>
-			<input type="hidden" name="input" value="', $context['input_box_name'], '" />
-			<input type="hidden" name="delim" value="', $context['delimiter'], '" />
-			<input type="hidden" name="quote" value="', $context['quote_results'] ? '1' : '0', '" />
+			<input type="hidden" name="input" value="', $context['input_box_name'], '">
+			<input type="hidden" name="delim" value="', $context['delimiter'], '">
+			<input type="hidden" name="quote" value="', $context['quote_results'] ? '1' : '0', '">
 		</form>';
 
 	if (empty($context['results']))
 		echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			document.getElementById("search").focus();
 		// ]]></script>';
 
@@ -160,26 +150,43 @@
 				<h3 class="catbg">', $txt['manual_smf_user_help'], '</h3>
 			</div>
 			<div id="help_container">
-				<div class="windowbg2">
-					<span class="topslice"><span></span></span>
-					<div id="helpmain">
-						<p>', sprintf($txt['manual_welcome'], $context['forum_name']), '</p>
-						<p>', $txt['manual_introduction'], '</p>
-						<ul>';
+				<div id="helpmain" class="windowbg2">
+					<p>', sprintf($txt['manual_welcome'], $context['forum_name_html_safe']), '</p>
+					<p>', $txt['manual_introduction'], '</p>
+					<ul>';
 
 	foreach ($context['manual_sections'] as $section_id => $wiki_id)
 	{
 		echo '
-							<li><a href="', $context['wiki_url'], '/', $wiki_id, ($txt['lang_dictionary'] != 'en' && $txt['lang_dictionary'] != 'english' ? '/' . $txt['lang_dictionary'] : ''), '" target="_blank" class="new_win">', $txt['manual_section_' . $section_id . '_title'], '</a> - ', $txt['manual_section_' . $section_id . '_desc'], '</li>';
+						<li><a href="', $context['wiki_url'], '/', $context['wiki_prefix'], $wiki_id, ($txt['lang_dictionary'] != 'en' ? '/' . $txt['lang_dictionary'] : ''), '" target="_blank" class="new_win">', $txt['manual_section_' . $section_id . '_title'], '</a> - ', $txt['manual_section_' . $section_id . '_desc'], '</li>';
 	}
 
 	echo '
-						</ul>
-						<p>', sprintf($txt['manual_docs_and_credits'], $context['wiki_url'], $scripturl . '?action=credits'), '</p>
-					</div>
-					<span class="botslice"><span></span></span>
+					</ul>
+					<p>', sprintf($txt['manual_docs_and_credits'], $context['wiki_url'], $scripturl . '?action=credits'), '</p>
 				</div>
 			</div>';
 }
 
+function template_terms()
+{
+	global $txt, $context, $modSettings;
+
+	if (!empty($modSettings['requireAgreement']))
+		echo '
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $txt['terms_and_rules'], ' - ', $context['forum_name_html_safe'], '
+				</h3>
+			</div>
+			<div class="roundframe">
+				', $context['agreement'], '
+			</div>';
+	else
+		echo '
+			<div class="noticebox">
+				', $txt['agreement_disabled'], '
+			</div>';
+}
+
 ?>
\ No newline at end of file
Only in a/Themes/default/images: admin
Only in a/Themes/default/images: aim.gif
Only in b/Themes/default/images: aim.png
Binary files a/Themes/default/images/bar_stats.png and b/Themes/default/images/bar_stats.png differ
Only in a/Themes/default/images/bbc: bbc_bg.gif
Only in b/Themes/default/images/bbc: bbc_bg.png
Only in a/Themes/default/images/bbc: bbc_hoverbg.gif
Only in b/Themes/default/images/bbc: bbc_hoverbg.png
Only in a/Themes/default/images/bbc: bold.gif
Only in a/Themes/default/images/bbc: center.gif
Only in a/Themes/default/images/bbc: code.gif
Only in a/Themes/default/images/bbc: divider.gif
Only in a/Themes/default/images/bbc: email.gif
Only in a/Themes/default/images/bbc: flash.gif
Only in a/Themes/default/images/bbc: ftp.gif
Only in b/Themes/default/images/bbc: ftp.png
Only in a/Themes/default/images/bbc: glow.gif
Only in b/Themes/default/images/bbc: glow.png
Only in a/Themes/default/images/bbc: hr.gif
Only in a/Themes/default/images/bbc: img.gif
Only in a/Themes/default/images/bbc: italicize.gif
Only in a/Themes/default/images/bbc: left.gif
Only in a/Themes/default/images/bbc: list.gif
Binary files a/Themes/default/images/bbc/move.gif and b/Themes/default/images/bbc/move.gif differ
Only in a/Themes/default/images/bbc: orderlist.gif
Only in a/Themes/default/images/bbc: pre.gif
Only in b/Themes/default/images/bbc: pre.png
Only in a/Themes/default/images/bbc: quote.gif
Only in a/Themes/default/images/bbc: resize-handle.gif
Only in a/Themes/default/images/bbc: right.gif
Only in a/Themes/default/images/bbc: shadow.gif
Only in b/Themes/default/images/bbc: shadow.png
Only in a/Themes/default/images/bbc: strike.gif
Only in a/Themes/default/images/bbc: sub.gif
Only in a/Themes/default/images/bbc: sup.gif
Only in a/Themes/default/images/bbc: table.gif
Only in a/Themes/default/images/bbc: tele.gif
Only in b/Themes/default/images/bbc: tele.png
Only in a/Themes/default/images/bbc: toggle.gif
Only in a/Themes/default/images/bbc: underline.gif
Only in a/Themes/default/images/bbc: unformat.gif
Only in a/Themes/default/images/bbc: url.gif
Only in a/Themes/default/images: blank.gif
Only in b/Themes/default/images: blank.png
Only in a/Themes/default/images: board.gif
Only in b/Themes/default/images: boardicons.png
Only in b/Themes/default/images: board.png
Only in a/Themes/default/images: board_select_spot_child.gif
Only in a/Themes/default/images: board_select_spot.gif
Only in a/Themes/default/images: buddy_useroff.gif
Only in b/Themes/default/images: buddy_useroff.png
Only in a/Themes/default/images: buddy_useron.gif
Only in b/Themes/default/images: buddy_useron.png
Only in a/Themes/default/images: buttons
Binary files a/Themes/default/images/cake.png and b/Themes/default/images/cake.png differ
Only in a/Themes/default/images: collapse.gif
Binary files a/Themes/default/images/construction.png and b/Themes/default/images/construction.png differ
Only in b/Themes/default/images: editor_icons.png
Only in a/Themes/default/images: email_sm.gif
Only in a/Themes/default/images: english
Only in a/Themes/default/images: expand.gif
Only in a/Themes/default/images: Female.gif
Only in a/Themes/default/images: filter.gif
Only in b/Themes/default/images: generic_icons.png
Only in a/Themes/default/images: helptopics.gif
Only in b/Themes/default/images: helptopics_hd.png
Only in b/Themes/default/images: helptopics.png
Only in b/Themes/default/images/icons: admin_icons_hd.png
Only in a/Themes/default/images/icons: assist.gif
Only in a/Themes/default/images/icons: calendar.gif
Only in a/Themes/default/images/icons: clip.gif
Only in b/Themes/default/images/icons: clip.png
Only in b/Themes/default/images/icons: config_hd.png
Only in a/Themes/default/images/icons: config_sm.gif
Only in a/Themes/default/images/icons: delete.gif
Only in b/Themes/default/images/icons: delete.png
Only in a/Themes/default/images/icons: field_check.gif
Only in a/Themes/default/images/icons: field_invalid.gif
Only in a/Themes/default/images/icons: field_valid.gif
Only in a/Themes/default/images/icons: im_newmsg.gif
Only in a/Themes/default/images/icons: info.gif
Only in a/Themes/default/images/icons: last_post.gif
Only in a/Themes/default/images/icons: login.gif
Only in b/Themes/default/images/icons: login_hd.png
Only in b/Themes/default/images/icons: login.png
Only in a/Themes/default/images/icons: login_sm.gif
Only in a/Themes/default/images/icons: members.gif
Only in b/Themes/default/images/icons: members.png
Only in a/Themes/default/images/icons: modify_inline.gif
Only in b/Themes/default/images/icons: modify_inline.png
Only in a/Themes/default/images/icons: modify_small.gif
Only in a/Themes/default/images/icons: notify_sm.gif
Only in a/Themes/default/images/icons: online.gif
Only in a/Themes/default/images/icons: package_installed.gif
Only in a/Themes/default/images/icons: package_old.gif
Only in a/Themes/default/images/icons: pm_read.gif
Only in a/Themes/default/images/icons: pm_replied.gif
Only in b/Themes/default/images/icons: profile_hd.png
Only in a/Themes/default/images/icons: profile_sm.gif
Only in b/Themes/default/images/icons: profile_sm.png
Only in a/Themes/default/images/icons: quick_lock.gif
Only in a/Themes/default/images/icons: quick_move.gif
Only in a/Themes/default/images/icons: quick_remove.gif
Only in a/Themes/default/images/icons: quick_sticky.gif
Only in a/Themes/default/images/icons: quick_sticky_lock.gif
Only in a/Themes/default/images/icons: show_sticky.gif
Only in b/Themes/default/images/icons: stats_info_hd.png
Only in b/Themes/default/images: icq.png
Only in a/Themes/default/images: im_off.gif
Only in a/Themes/default/images: im_on.gif
Only in a/Themes/default/images: im_sm_newmsg.gif
Only in a/Themes/default/images: im_sm_prefs.gif
Only in a/Themes/default/images: im_switch.gif
Only in a/Themes/default/images: ip.gif
Only in b/Themes/default/images: ip.png
Only in a/Themes/default/images: loading.gif
Only in b/Themes/default/images: loading_sm.gif
Only in a/Themes/default/images: Male.gif
Only in b/Themes/default/images: membericons
Only in a/Themes/default/images: message_sm.gif
Only in a/Themes/default/images: msntalk.gif
Only in a/Themes/default/images: new_none.png
Binary files a/Themes/default/images/new_redirect.png and b/Themes/default/images/new_redirect.png differ
Only in a/Themes/default/images: new_some.png
Only in a/Themes/default/images: off.png
Only in a/Themes/default/images: on2.png
Only in a/Themes/default/images: on.png
Only in a/Themes/default/images: openid.gif
Only in a/Themes/default/images: pm_recipient_delete.gif
Only in a/Themes/default/images/post: angry.gif
Only in b/Themes/default/images/post: angry.png
Only in a/Themes/default/images/post: cheesy.gif
Only in b/Themes/default/images/post: cheesy.png
Only in a/Themes/default/images/post: clip.gif
Only in b/Themes/default/images/post: clip.png
Only in a/Themes/default/images/post: exclamation.gif
Only in b/Themes/default/images/post: exclamation.png
Only in a/Themes/default/images/post: grin.gif
Only in b/Themes/default/images/post: grin.png
Only in a/Themes/default/images/post: lamp.gif
Only in b/Themes/default/images/post: lamp.png
Only in a/Themes/default/images/post: moved.gif
Only in b/Themes/default/images/post: moved.png
Only in b/Themes/default/images/post: poll.png
Only in a/Themes/default/images/post: question.gif
Only in b/Themes/default/images/post: question.png
Only in a/Themes/default/images/post: recycled.gif
Only in b/Themes/default/images/post: recycled.png
Only in a/Themes/default/images/post: sad.gif
Only in b/Themes/default/images/post: sad.png
Only in a/Themes/default/images/post: smiley.gif
Only in b/Themes/default/images/post: smiley.png
Only in a/Themes/default/images/post: thumbdown.gif
Only in b/Themes/default/images/post: thumbdown.png
Only in a/Themes/default/images/post: thumbup.gif
Only in b/Themes/default/images/post: thumbup.png
Only in a/Themes/default/images/post: wink.gif
Only in b/Themes/default/images/post: wink.png
Only in a/Themes/default/images/post: wireless.gif
Only in b/Themes/default/images/post: wireless.png
Only in a/Themes/default/images/post: xx.gif
Only in b/Themes/default/images/post: xx.png
Only in b/Themes/default/images: quickbuttons.png
Only in a/Themes/default/images: redirect.png
Only in a/Themes/default/images: selected.gif
Only in b/Themes/default/images: selected_open.png
Only in b/Themes/default/images: selected.png
Only in b/Themes/default/images: skype.png
Binary files a/Themes/default/images/smflogo.png and b/Themes/default/images/smflogo.png differ
Only in a/Themes/default/images: smiley_select_spot.gif
Only in a/Themes/default/images: sort_down.gif
Only in a/Themes/default/images: sort_up.gif
Only in a/Themes/default/images: split_deselect.gif
Only in a/Themes/default/images: split_select.gif
Only in a/Themes/default/images: staradmin.gif
Only in a/Themes/default/images: star.gif
Only in a/Themes/default/images: stargmod.gif
Only in a/Themes/default/images: starmod.gif
Only in a/Themes/default/images: stats_board.gif
Only in a/Themes/default/images: stats_boards.gif
Only in a/Themes/default/images: stats_history.gif
Only in a/Themes/default/images: stats_info.gif
Binary files a/Themes/default/images/stats_pie.png and b/Themes/default/images/stats_pie.png differ
Binary files a/Themes/default/images/stats_pie_rtl.png and b/Themes/default/images/stats_pie_rtl.png differ
Only in a/Themes/default/images: stats_posters.gif
Only in a/Themes/default/images: stats_replies.gif
Only in a/Themes/default/images: stats_views.gif
Only in a/Themes/default/images: theme
Only in a/Themes/default/images: thumbnail.gif
Only in b/Themes/default/images: thumbnail.png
Only in b/Themes/default/images: toggle.png
Only in a/Themes/default/images/topic: hot_poll.gif
Only in a/Themes/default/images/topic: hot_poll_locked.gif
Only in a/Themes/default/images/topic: hot_poll_locked_sticky.gif
Only in a/Themes/default/images/topic: hot_poll_sticky.gif
Only in a/Themes/default/images/topic: hot_post.gif
Only in a/Themes/default/images/topic: hot_post_locked.gif
Only in a/Themes/default/images/topic: hot_post_locked_sticky.gif
Only in a/Themes/default/images/topic: hot_post_sticky.gif
Only in a/Themes/default/images/topic: my_hot_poll.gif
Only in a/Themes/default/images/topic: my_hot_poll_locked.gif
Only in a/Themes/default/images/topic: my_hot_poll_locked_sticky.gif
Only in a/Themes/default/images/topic: my_hot_poll_sticky.gif
Only in a/Themes/default/images/topic: my_hot_post.gif
Only in a/Themes/default/images/topic: my_hot_post_locked.gif
Only in a/Themes/default/images/topic: my_hot_post_locked_sticky.gif
Only in a/Themes/default/images/topic: my_hot_post_sticky.gif
Only in a/Themes/default/images/topic: my_normal_poll.gif
Only in a/Themes/default/images/topic: my_normal_poll_locked.gif
Only in a/Themes/default/images/topic: my_normal_poll_locked_sticky.gif
Only in a/Themes/default/images/topic: my_normal_poll_sticky.gif
Only in a/Themes/default/images/topic: my_normal_post.gif
Only in a/Themes/default/images/topic: my_normal_post_locked.gif
Only in a/Themes/default/images/topic: my_normal_post_locked_sticky.gif
Only in a/Themes/default/images/topic: my_normal_post_sticky.gif
Only in a/Themes/default/images/topic: my_veryhot_poll.gif
Only in a/Themes/default/images/topic: my_veryhot_poll_locked.gif
Only in a/Themes/default/images/topic: my_veryhot_poll_locked_sticky.gif
Only in a/Themes/default/images/topic: my_veryhot_poll_sticky.gif
Only in a/Themes/default/images/topic: my_veryhot_post.gif
Only in a/Themes/default/images/topic: my_veryhot_post_locked.gif
Only in a/Themes/default/images/topic: my_veryhot_post_locked_sticky.gif
Only in a/Themes/default/images/topic: my_veryhot_post_sticky.gif
Only in a/Themes/default/images/topic: normal_poll.gif
Only in a/Themes/default/images/topic: normal_poll_locked.gif
Only in a/Themes/default/images/topic: normal_poll_locked_sticky.gif
Only in a/Themes/default/images/topic: normal_poll_sticky.gif
Only in a/Themes/default/images/topic: normal_post.gif
Only in a/Themes/default/images/topic: normal_post_locked.gif
Only in b/Themes/default/images/topic: normal_post_locked.png
Only in a/Themes/default/images/topic: normal_post_locked_sticky.gif
Only in b/Themes/default/images/topic: normal_post_locked_sticky.png
Only in b/Themes/default/images/topic: normal_post.png
Only in a/Themes/default/images/topic: normal_post_sticky.gif
Only in b/Themes/default/images/topic: normal_post_sticky.png
Only in a/Themes/default/images/topic: veryhot_poll.gif
Only in a/Themes/default/images/topic: veryhot_poll_locked.gif
Only in a/Themes/default/images/topic: veryhot_poll_locked_sticky.gif
Only in a/Themes/default/images/topic: veryhot_poll_sticky.gif
Only in a/Themes/default/images/topic: veryhot_post.gif
Only in a/Themes/default/images/topic: veryhot_post_locked.gif
Only in a/Themes/default/images/topic: veryhot_post_locked_sticky.gif
Only in a/Themes/default/images/topic: veryhot_post_sticky.gif
Only in a/Themes/default/images: upshrink2.png
Only in a/Themes/default/images: upshrink.png
Only in a/Themes/default/images: useroff.gif
Only in a/Themes/default/images: useron.gif
Only in a/Themes/default/images: warn.gif
Only in a/Themes/default/images: warning_moderate.gif
Only in a/Themes/default/images: warning_mute.gif
Only in a/Themes/default/images: warning_watch.gif
Only in b/Themes/default/images: warn.png
Only in a/Themes/default/images: www.gif
Only in a/Themes/default/images: www_sm.gif
Only in b/Themes/default/images: yahoo.png
diff -ru a/Themes/default/index.template.php b/Themes/default/index.template.php
--- a/Themes/default/index.template.php	2011-06-06 10:06:37.000000000 -0700
+++ b/Themes/default/index.template.php	2015-03-05 23:30:06.024678600 -0800
@@ -3,11 +3,11 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 /*	This template is, perhaps, the most important template in the theme. It
@@ -35,471 +35,555 @@
 	http://www.simplemachines.org/
 */
 
-// Initialize the template... mainly little settings.
+/**
+ * Initialize the template... mainly little settings.
+ */
 function template_init()
 {
-	global $context, $settings, $options, $txt;
+	global $settings, $txt;
 
-	/* Use images from default theme when using templates from the default theme?
-		if this is 'always', images from the default theme will be used.
-		if this is 'defaults', images from the default theme will only be used with default templates.
-		if this is 'never' or isn't set at all, images from the default theme will not be used. */
-	$settings['use_default_images'] = 'never';
-
-	/* What document type definition is being used? (for font size and other issues.)
-		'xhtml' for an XHTML 1.0 document type definition.
-		'html' for an HTML 4.01 document type definition. */
-	$settings['doctype'] = 'xhtml';
-
-	/* The version this template/theme is for.
-		This should probably be the version of SMF it was created for. */
-	$settings['theme_version'] = '2.0';
+	/* $context, $options and $txt may be available for use, but may not be fully populated yet. */
 
-	/* Set a setting that tells the theme that it can render the tabs. */
-	$settings['use_tabs'] = true;
+	// The version this template/theme is for. This should probably be the version of SMF it was created for.
+	$settings['theme_version'] = '2.1';
 
-	/* Use plain buttons - as opposed to text buttons? */
+	// Use plain buttons - as opposed to text buttons?
 	$settings['use_buttons'] = true;
 
-	/* Show sticky and lock status separate from topic icons? */
-	$settings['separate_sticky_lock'] = true;
-
-	/* Does this theme use the strict doctype? */
-	$settings['strict_doctype'] = false;
+	// Set the following variable to true if this theme requires the optional theme strings file to be loaded.
+	$settings['require_theme_strings'] = false;
 
-	/* Does this theme use post previews on the message index? */
-	$settings['message_index_preview'] = false;
+	// Set the following variable to true is this theme wants to display the avatar of the user that posted the last post on the board index and message index.
+	$settings['avatars_on_indexes'] = false;
 
-	/* Set the following variable to true if this theme requires the optional theme strings file to be loaded. */
-	$settings['require_theme_strings'] = false;
+	// This defines the formatting for the page indexes used throughout the forum.
+	$settings['page_index'] = array(
+		'extra_before' => '<span class="pages">' . $txt['pages'] . '</span>',
+		'previous_page' => '<span class="generic_icons previous_page"></span>',
+		'current_page' => '<span class="current_page">[%1$d]</span> ',
+		'page' => '<a class="navPages" href="{URL}">%2$s</a> ',
+		'expand_pages' => '<span class="expand_pages" onclick="expandPages(this, {LINK}, {FIRST_PAGE}, {LAST_PAGE}, {PER_PAGE});"> ... </span>',
+		'next_page' => '<span class="generic_icons next_page"></span>',
+		'extra_after' => '',
+	);
 }
 
-// The main sub template above the content.
+/**
+ * The main sub template above the content.
+ */
 function template_html_above()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt, $modSettings, $mbname;
 
 	// Show right to left and the character set for ease of translating.
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
-<head>';
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+<head>
+	<meta charset="', $context['character_set'], '">';
 
-	// The ?fin20 part of this link is just here to make sure browsers don't cache it wrongly.
-	echo '
-	<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index', $context['theme_variant'], '.css?fin20" />';
+	// You don't need to manually load index.css, this will be set up for you. You can, of course, add
+	// any other files you want, after template_css() has been run. Note that RTL will also be loaded for you.
 
-	// Some browsers need an extra stylesheet due to bugs/compatibility issues.
-	foreach (array('ie7', 'ie6', 'webkit') as $cssfix)
-		if ($context['browser']['is_' . $cssfix])
-			echo '
-	<link rel="stylesheet" type="text/css" href="', $settings['default_theme_url'], '/css/', $cssfix, '.css" />';
+	// The most efficient way of writing multi themes is to use a master index.css plus variant.css files.
+	// If you've set them up properly (through $settings['theme_variants'], loadCSSFile will load the variant files for you.
 
-	// RTL languages require an additional stylesheet.
-	if ($context['right_to_left'])
+	// load in any css from mods or themes so they can overwrite if wanted
+	template_css();
+
+	// Save some database hits, if a width for multiple wrappers is set in admin.
+	if (!empty($settings['forum_width']))
 		echo '
-	<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/rtl.css" />';
+	<style type="text/css">#wrapper, .frame {width: ', $settings['forum_width'], ';}</style>';
+
+	// load in any javascript files from mods and themes
+	template_javascript();
 
-	// Here comes the JavaScript bits!
 	echo '
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/script.js?fin20"></script>
-	<script type="text/javascript" src="', $settings['theme_url'], '/scripts/theme.js?fin20"></script>
-	<script type="text/javascript"><!-- // --><![CDATA[
-		var smf_theme_url = "', $settings['theme_url'], '";
-		var smf_default_theme_url = "', $settings['default_theme_url'], '";
-		var smf_images_url = "', $settings['images_url'], '";
-		var smf_scripturl = "', $scripturl, '";
-		var smf_iso_case_folding = ', $context['server']['iso_case_folding'] ? 'true' : 'false', ';
-		var smf_charset = "', $context['character_set'], '";', $context['show_pm_popup'] ? '
-		var fPmPopup = function ()
-		{
-			if (confirm("' . $txt['show_personal_messages'] . '"))
-				window.open(smf_prepareScriptUrl(smf_scripturl) + "action=pm");
-		}
-		addLoadEvent(fPmPopup);' : '', '
-		var ajax_notification_text = "', $txt['ajax_in_progress'], '";
-		var ajax_notification_cancel_text = "', $txt['modify_cancel'], '";
-	// ]]></script>';
+	<meta name="description" content="', !empty($context['meta_description']) ? $context['meta_description'] : $context['page_title_html_safe'], '">', !empty($context['meta_keywords']) ? '
+	<meta name="keywords" content="' . $context['meta_keywords'] . '">' : '', '
+	<title>', $context['page_title_html_safe'], '</title>
+	<meta name="viewport" content="width=device-width, initial-scale=1">';
+
+	// Some Open Graph?
+	echo '
+	<meta property="og:site_name" content="', $mbname,'">
+	<meta property="og:title" content="', $context['page_title_html_safe'],'">
+	', !empty($context['canonical_url']) ? '<meta property="og:url" content="'. $context['canonical_url'].'">' : '',
+	!empty($settings['og_image']) ? '<meta property="og:image" content="'. $settings['og_image'].'">' : '','
+	<meta property="og:description" content="',!empty($context['meta_description']) ? $context['meta_description'] : $context['page_title_html_safe'],'">';
 
+	/* What is your Lollipop's color?
+	Theme Authors you can change here to make sure your theme's main color got visible on tab */
 	echo '
-	<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
-	<meta name="description" content="', $context['page_title_html_safe'], '" />', !empty($context['meta_keywords']) ? '
-	<meta name="keywords" content="' . $context['meta_keywords'] . '" />' : '', '
-	<title>', $context['page_title_html_safe'], '</title>';
+	<meta name="theme-color" content="#557EA0">';
 
 	// Please don't index these Mr Robot.
 	if (!empty($context['robot_no_index']))
 		echo '
-	<meta name="robots" content="noindex" />';
+	<meta name="robots" content="noindex">';
 
 	// Present a canonical url for search engines to prevent duplicate content in their indices.
 	if (!empty($context['canonical_url']))
 		echo '
-	<link rel="canonical" href="', $context['canonical_url'], '" />';
+	<link rel="canonical" href="', $context['canonical_url'], '">';
 
 	// Show all the relative links, such as help, search, contents, and the like.
 	echo '
-	<link rel="help" href="', $scripturl, '?action=help" />
-	<link rel="search" href="', $scripturl, '?action=search" />
-	<link rel="contents" href="', $scripturl, '" />';
+	<link rel="help" href="', $scripturl, '?action=help">
+	<link rel="contents" href="', $scripturl, '">', ($context['allow_search'] ? '
+	<link rel="search" href="' . $scripturl . '?action=search">' : '');
 
 	// If RSS feeds are enabled, advertise the presence of one.
 	if (!empty($modSettings['xmlnews_enable']) && (!empty($modSettings['allow_guestAccess']) || $context['user']['is_logged']))
 		echo '
-	<link rel="alternate" type="application/rss+xml" title="', $context['forum_name_html_safe'], ' - ', $txt['rss'], '" href="', $scripturl, '?type=rss;action=.xml" />';
+	<link rel="alternate" type="application/rss+xml" title="', $context['forum_name_html_safe'], ' - ', $txt['rss'], '" href="', $scripturl, '?type=rss2;action=.xml">
+	<link rel="alternate" type="application/rss+xml" title="', $context['forum_name_html_safe'], ' - ', $txt['atom'], '" href="', $scripturl, '?type=atom;action=.xml">';
 
 	// If we're viewing a topic, these should be the previous and next topics, respectively.
-	if (!empty($context['current_topic']))
+	if (!empty($context['links']['next']))
+	{
+		echo '
+	<link rel="next" href="', $context['links']['next'], '">';
+	}
+
+	if (!empty($context['links']['prev']))
+	{
 		echo '
-	<link rel="prev" href="', $scripturl, '?topic=', $context['current_topic'], '.0;prev_next=prev" />
-	<link rel="next" href="', $scripturl, '?topic=', $context['current_topic'], '.0;prev_next=next" />';
+	<link rel="prev" href="', $context['links']['prev'], '">';
+	}
 
 	// If we're in a board, or a topic for that matter, the index will be the board's index.
 	if (!empty($context['current_board']))
 		echo '
-	<link rel="index" href="', $scripturl, '?board=', $context['current_board'], '.0" />';
+	<link rel="index" href="', $scripturl, '?board=', $context['current_board'], '.0">';
 
 	// Output any remaining HTML headers. (from mods, maybe?)
 	echo $context['html_headers'];
 
 	echo '
 </head>
-<body>';
+<body id="', $context['browser_body_id'], '" class="action_', !empty($context['current_action']) ? $context['current_action'] : (!empty($context['current_board']) ?
+		'messageindex' : (!empty($context['current_topic']) ? 'display' : 'home')), !empty($context['current_board']) ? ' board_' . $context['current_board'] : '', '">';
 }
 
 function template_body_above()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
-
-	echo !empty($settings['forum_width']) ? '
-<div id="wrapper" style="width: ' . $settings['forum_width'] . '">' : '', '
-	<div id="header"><div class="frame">
-		<div id="top_section">
-			<h1 class="forumtitle">
-				<a href="', $scripturl, '">', empty($context['header_logo_url_html_safe']) ? $context['forum_name'] : '<img src="' . $context['header_logo_url_html_safe'] . '" alt="' . $context['forum_name'] . '" />', '</a>
-			</h1>';
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
-	// the upshrink image, right-floated
+	// Wrapper div now echoes permanently for better layout options. h1 a is now target for "Go up" links.
 	echo '
-			<img id="upshrink" src="', $settings['images_url'], '/upshrink.png" alt="*" title="', $txt['upshrink_description'], '" style="display: none;" />';
-	echo '
-			', empty($settings['site_slogan']) ? '<img id="smflogo" src="' . $settings['images_url'] . '/smflogo.png" alt="Simple Machines Forum" title="Simple Machines Forum" />' : '<div id="siteslogan" class="floatright">' . $settings['site_slogan'] . '</div>', '
-		</div>
-		<div id="upper_section" class="middletext"', empty($options['collapse_header']) ? '' : ' style="display: none;"', '>
-			<div class="user">';
+	<div id="top_section">
+		<div class="frame">';
 
-	// If the user is logged in, display stuff like their name, new messages, etc.
+	// If the user is logged in, display some things that might be useful.
 	if ($context['user']['is_logged'])
 	{
-		if (!empty($context['user']['avatar']))
-			echo '
-				<p class="avatar">', $context['user']['avatar']['image'], '</p>';
+		// Firstly, the user's menu
 		echo '
-				<ul class="reset">
-					<li class="greeting">', $txt['hello_member_ndt'], ' <span>', $context['user']['name'], '</span></li>
-					<li><a href="', $scripturl, '?action=unread">', $txt['unread_since_visit'], '</a></li>
-					<li><a href="', $scripturl, '?action=unreadreplies">', $txt['show_unread_replies'], '</a></li>';
-
-		// Is the forum in maintenance mode?
-		if ($context['in_maintenance'] && $context['user']['is_admin'])
-			echo '
-					<li class="notice">', $txt['maintain_mode_on'], '</li>';
+			<ul class="floatleft" id="top_info">
+				<li>
+					<a href="', $scripturl, '?action=profile"', !empty($context['self_profile']) ? ' class="active"' : '', ' id="profile_menu_top" onclick="return false;">';
+						if (!empty($context['user']['avatar']))
+							echo $context['user']['avatar']['image'];
+						echo $context['user']['name'], ' &#9660;</a>
+					<div id="profile_menu" class="top_menu"></div>
+				</li>';
 
-		// Are there any members waiting for approval?
-		if (!empty($context['unapproved_members']))
+		// Secondly, PMs if we're doing them
+		if ($context['allow_pm'])
+		{
 			echo '
-					<li>', $context['unapproved_members'] == 1 ? $txt['approve_thereis'] : $txt['approve_thereare'], ' <a href="', $scripturl, '?action=admin;area=viewmembers;sa=browse;type=approve">', $context['unapproved_members'] == 1 ? $txt['approve_member'] : $context['unapproved_members'] . ' ' . $txt['approve_members'], '</a> ', $txt['approve_members_waiting'], '</li>';
+				<li>
+					<a href="', $scripturl, '?action=pm"', !empty($context['self_pm']) ? ' class="active"' : '', ' id="pm_menu_top">', $txt['pm_short'], !empty($context['user']['unread_messages']) ? ' <span class="amt">' . $context['user']['unread_messages'] . '</span>' : '', '</a>
+					<div id="pm_menu" class="top_menu scrollable"></div>
+				</li>';
+		}
 
-		if (!empty($context['open_mod_reports']) && $context['show_open_reports'])
-			echo '
-					<li><a href="', $scripturl, '?action=moderate;area=reports">', sprintf($txt['mod_reports_waiting'], $context['open_mod_reports']), '</a></li>';
+		// Thirdly, alerts
+		echo '
+				<li>
+					<a href="', $scripturl, '?action=profile;area=showalerts;u=', $context['user']['id'] ,'"', !empty($context['self_alerts']) ? ' class="active"' : '', ' id="alerts_menu_top">', $txt['alerts'], !empty($context['user']['alerts']) ? ' <span class="amt">' . $context['user']['alerts'] . '</span>' : '', '</a>
+					<div id="alerts_menu" class="top_menu scrollable"></div>
+				</li>';
 
+		// And now we're done.
 		echo '
-					<li>', $context['current_time'], '</li>
-				</ul>';
+			</ul>';
 	}
-	// Otherwise they're a guest - this time ask them to either register or login - lazy bums...
-	elseif (!empty($context['show_login_bar']))
+	// Otherwise they're a guest. Ask them to either register or login.
+	else
+		echo '
+			<ul class="floatleft welcome">
+				<li>', sprintf($txt[$context['can_register'] ? 'welcome_guest_register' : 'welcome_guest'], $txt['guest_title'], $context['forum_name_html_safe'], $scripturl . '?action=login', 'return reqOverlayDiv(this.href, ' . JavaScriptEscape($txt['login']) . ');', $scripturl . '?action=signup'), '</li>
+			</ul>';
+
+	if (!empty($context['languages']))
 	{
 		echo '
-				<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/sha1.js"></script>
-				<form id="guest_form" action="', $scripturl, '?action=login2" method="post" accept-charset="', $context['character_set'], '" ', empty($context['disable_login_hashing']) ? ' onsubmit="hashLoginPassword(this, \'' . $context['session_id'] . '\');"' : '', '>
-					<div class="info">', sprintf($txt['welcome_guest'], $txt['guest_title']), '</div>
-					<input type="text" name="user" size="10" class="input_text" />
-					<input type="password" name="passwrd" size="10" class="input_password" />
-					<select name="cookielength">
-						<option value="60">', $txt['one_hour'], '</option>
-						<option value="1440">', $txt['one_day'], '</option>
-						<option value="10080">', $txt['one_week'], '</option>
-						<option value="43200">', $txt['one_month'], '</option>
-						<option value="-1" selected="selected">', $txt['forever'], '</option>
-					</select>
-					<input type="submit" value="', $txt['login'], '" class="button_submit" /><br />
-					<div class="info">', $txt['quick_login_dec'], '</div>';
+			<form id="languages_form" action="" method="get" class="floatright">
+				<select id="language_select" name="language" onchange="this.form.submit()">';
 
-		if (!empty($modSettings['enableOpenID']))
+		foreach ($context['languages'] as $language)
 			echo '
-					<br /><input type="text" name="openid_identifier" id="openid_url" size="25" class="input_text openid_login" />';
+					<option value="', $language['filename'], '"', isset($context['user']['language']) && $context['user']['language'] == $language['filename'] ? ' selected="selected"' : '', '>', str_replace('-utf8', '', $language['name']), '</option>';
 
 		echo '
-					<input type="hidden" name="hash_passwrd" value="" />
-				</form>';
+				</select>
+				<noscript>
+					<input type="submit" value="', $txt['quick_mod_go'], '" />
+				</noscript>
+			</form>';
 	}
 
-	echo '
-			</div>
-			<div class="news normaltext">
-				<form id="search_form" action="', $scripturl, '?action=search2" method="post" accept-charset="', $context['character_set'], '">
-					<input type="text" name="search" value="" class="input_text" />&nbsp;
-					<input type="submit" name="submit" value="', $txt['search'], '" class="button_submit" />
-					<input type="hidden" name="advanced" value="0" />';
-
-	// Search within current topic?
-	if (!empty($context['current_topic']))
-		echo '
-					<input type="hidden" name="topic" value="', $context['current_topic'], '" />';
-	// If we're on a certain board, limit it to this board ;).
-	elseif (!empty($context['current_board']))
+	if ($context['allow_search'])
+	{
 		echo '
-					<input type="hidden" name="brd[', $context['current_board'], ']" value="', $context['current_board'], '" />';
+			<form id="search_form" class="floatright" action="', $scripturl, '?action=search2" method="post" accept-charset="', $context['character_set'], '">
+				<input type="search" name="search" value="" class="input_text">&nbsp;';
 
-	echo '</form>';
+		// Using the quick search dropdown?
+		$selected = !empty($context['current_topic']) ? 'current_topic' : (!empty($context['current_board']) ? 'current_board' : 'all');
 
-	// Show a random news item? (or you could pick one from news_lines...)
-	if (!empty($settings['enable_news']))
 		echo '
-				<h2>', $txt['news'], ': </h2>
-				<p>', $context['random_news_line'], '</p>';
+			<select name="search_selection">
+				<option value="all"', ($selected == 'all' ? ' selected' : ''), '>', $txt['search_entireforum'], ' </option>';
+
+		// Can't limit it to a specific topic if we are not in one
+		if (!empty($context['current_topic']))
+			echo '
+				<option value="topic"', ($selected == 'current_topic' ? ' selected' : ''), '>', $txt['search_thistopic'], '</option>';
+
+		// Can't limit it to a specific board if we are not in one
+		if (!empty($context['current_board']))
+			echo '
+					<option value="board"', ($selected == 'current_board' ? ' selected' : ''), '>', $txt['search_thisbrd'], '</option>';
+			echo '
+					<option value="members"', ($selected == 'members' ? ' selected' : ''), '>', $txt['search_members'], ' </option>
+				</select>';
+
+		// Search within current topic?
+		if (!empty($context['current_topic']))
+			echo '
+				<input type="hidden" name="sd_topic" value="', $context['current_topic'], '">';
+		// If we're on a certain board, limit it to this board ;).
+		elseif (!empty($context['current_board']))
+			echo '
+				<input type="hidden" name="sd_brd[', $context['current_board'], ']" value="', $context['current_board'], '">';
+
+		echo '
+				<input type="submit" name="search2" value="', $txt['search'], '" class="button_submit">
+				<input type="hidden" name="advanced" value="0">
+			</form>';
+	}
 
 	echo '
-			</div>
 		</div>
-		<br class="clear" />';
+	</div>';
 
-	// Define the upper_section toggle in JavaScript.
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var oMainHeaderToggle = new smc_Toggle({
-				bToggleEnabled: true,
-				bCurrentlyCollapsed: ', empty($options['collapse_header']) ? 'false' : 'true', ',
-				aSwappableContainers: [
-					\'upper_section\'
-				],
-				aSwapImages: [
-					{
-						sId: \'upshrink\',
-						srcExpanded: smf_images_url + \'/upshrink.png\',
-						altExpanded: ', JavaScriptEscape($txt['upshrink_description']), ',
-						srcCollapsed: smf_images_url + \'/upshrink2.png\',
-						altCollapsed: ', JavaScriptEscape($txt['upshrink_description']), '
-					}
-				],
-				oThemeOptions: {
-					bUseThemeSettings: ', $context['user']['is_guest'] ? 'false' : 'true', ',
-					sOptionName: \'collapse_header\',
-					sSessionVar: ', JavaScriptEscape($context['session_var']), ',
-					sSessionId: ', JavaScriptEscape($context['session_id']), '
-				},
-				oCookieOptions: {
-					bUseCookie: ', $context['user']['is_guest'] ? 'true' : 'false', ',
-					sCookieName: \'upshrink\'
-				}
-			});
-		// ]]></script>';
-
-	// Show the menu here, according to the menu sub template.
-	template_menu();
+	<div id="header">
+		<div class="frame">
+			<h1 class="forumtitle">
+				<a id="top" href="', $scripturl, '">', empty($context['header_logo_url_html_safe']) ? $context['forum_name_html_safe'] : '<img src="' . $context['header_logo_url_html_safe'] . '" alt="' . $context['forum_name_html_safe'] . '">', '</a>
+			</h1>';
 
 	echo '
-		<br class="clear" />
-	</div></div>';
+			', empty($settings['site_slogan']) ? '<img id="smflogo" src="' . $settings['images_url'] . '/smflogo.png" alt="Simple Machines Forum" title="Simple Machines Forum">' : '<div id="siteslogan" class="floatright">' . $settings['site_slogan'] . '</div>', '';
+
+	echo'
+		</div>
+	</div>
+	<div id="wrapper">
+		<div id="upper_section">
+			<div id="inner_section">
+				<div id="inner_wrap">
+					<div class="user">
+						', $context['current_time'], '
+					</div>';
+	// Show a random news item? (or you could pick one from news_lines...)
+	if (!empty($settings['enable_news']) && !empty($context['random_news_line']))
+		echo '
+					<div class="news">
+						<h2>', $txt['news'], ': </h2>
+						<p>', $context['random_news_line'], '</p>
+					</div>';
 
-	// The main content should go here.
 	echo '
-	<div id="content_section"><div class="frame">
-		<div id="main_content_section">';
+					<hr class="clear">
+				</div>';
 
-	// Custom banners and shoutboxes should be placed here, before the linktree.
+	// Show the menu here, according to the menu sub template, followed by the navigation tree.
+	template_menu();
 
-	// Show the navigation tree.
 	theme_linktree();
+
+	echo '
+			</div>
+		</div>';
+
+	// The main content should go here.
+	echo '
+		<div id="content_section">
+			<div id="main_content_section">';
 }
 
 function template_body_below()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $txt, $scripturl, $modSettings;
 
 	echo '
+			</div>
 		</div>
-	</div></div>';
+	</div>';
 
-	// Show the "Powered by" and "Valid" logos, as well as the copyright. Remember, the copyright must be somewhere!
+	// Show the XHTML, RSS and WAP2 links, as well as the copyright.
+	// Footer is now full-width by default. Frame inside it will match theme wrapper width automatically.
 	echo '
-	<div id="footer_section"><div class="frame">
-		<ul class="reset">
-			<li class="copyright">', theme_copyright(), '</li>
-			<li><a id="button_xhtml" href="http://validator.w3.org/check?uri=referer" target="_blank" class="new_win" title="', $txt['valid_xhtml'], '"><span>', $txt['xhtml'], '</span></a></li>
-			', !empty($modSettings['xmlnews_enable']) && (!empty($modSettings['allow_guestAccess']) || $context['user']['is_logged']) ? '<li><a id="button_rss" href="' . $scripturl . '?action=.xml;type=rss" class="new_win"><span>' . $txt['rss'] . '</span></a></li>' : '', '
-			<li class="last"><a id="button_wap2" href="', $scripturl , '?wap2" class="new_win"><span>', $txt['wap2'], '</span></a></li>
-		</ul>';
+	<div id="footer_section">
+		<div class="frame">';
+
+	// There is now a global "Go to top" link at the right.
+		echo '
+			<ul class="floatright">
+				<li><a href="', $scripturl, '?action=help">', $txt['help'], '</a> ', (!empty($modSettings['requireAgreement'])) ? '| <a href="'. $scripturl. '?action=help;sa=rules">'. $txt['terms_and_rules']. '</a>' : '', ' | <a href="#top_section">', $txt['go_up'], ' &#9650;</a></li>
+			</ul>
+			<ul class="reset">
+				<li class="copyright">', theme_copyright(), '</li>
+			</ul>';
 
 	// Show the load time?
 	if ($context['show_load_time'])
 		echo '
-		<p>', $txt['page_created'], $context['load_time'], $txt['seconds_with'], $context['load_queries'], $txt['queries'], '</p>';
+			<p>', sprintf($txt['page_created_full'], $context['load_time'], $context['load_queries']), '</p>';
 
 	echo '
-	</div></div>', !empty($settings['forum_width']) ? '
-</div>' : '';
+		</div>
+	</div>';
+
 }
 
 function template_html_below()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	// load in any javascipt that could be deferred to the end of the page
+	template_javascript(true);
 
 	echo '
-</body></html>';
+</body>
+</html>';
 }
 
-// Show a linktree. This is that thing that shows "My Community | General Category | General Discussion"..
+/**
+ * Show a linktree. This is that thing that shows "My Community | General Category | General Discussion"..
+ * @param bool $force_show = false
+ */
 function theme_linktree($force_show = false)
 {
-	global $context, $settings, $options, $shown_linktree;
+	global $context, $shown_linktree, $scripturl, $txt;
 
 	// If linktree is empty, just return - also allow an override.
 	if (empty($context['linktree']) || (!empty($context['dont_default_linktree']) && !$force_show))
 		return;
 
 	echo '
-	<div class="navigate_section">
-		<ul>';
+				<div class="navigate_section">
+					<ul>';
+
+	if ($context['user']['is_logged'])
+	echo '
+						<li class="unread_links">
+							<a href="', $scripturl, '?action=unread" title="', $txt['unread_since_visit'], '">', $txt['view_unread_category'], '</a>
+							<a href="', $scripturl, '?action=unreadreplies" title="', $txt['show_unread_replies'], '">', $txt['unread_replies'], '</a>
+						</li>';
 
 	// Each tree item has a URL and name. Some may have extra_before and extra_after.
 	foreach ($context['linktree'] as $link_num => $tree)
 	{
 		echo '
-			<li', ($link_num == count($context['linktree']) - 1) ? ' class="last"' : '', '>';
+						<li', ($link_num == count($context['linktree']) - 1) ? ' class="last"' : '', '>';
+
+		// Don't show a separator for the first one.
+		// Better here. Always points to the next level when the linktree breaks to a second line.
+		// Picked a better looking HTML entity, and added support for RTL plus a span for styling.
+		if ($link_num != 0)
+			echo '
+							<span class="dividers">', $context['right_to_left'] ? ' &#9668; ' : ' &#9658; ', '</span>';
 
 		// Show something before the link?
 		if (isset($tree['extra_before']))
-			echo $tree['extra_before'];
+			echo $tree['extra_before'], ' ';
 
 		// Show the link, including a URL if it should have one.
-		echo $settings['linktree_link'] && isset($tree['url']) ? '
-				<a href="' . $tree['url'] . '"><span>' . $tree['name'] . '</span></a>' : '<span>' . $tree['name'] . '</span>';
+		if (isset($tree['url']))
+			echo '
+					<a href="' . $tree['url'] . '"><span>' . $tree['name'] . '</span></a>';
+		else
+			echo '
+					<span>' . $tree['name'] . '</span>';
 
 		// Show something after the link...?
 		if (isset($tree['extra_after']))
-			echo $tree['extra_after'];
-
-		// Don't show a separator for the last one.
-		if ($link_num != count($context['linktree']) - 1)
-			echo ' &#187;';
+			echo ' ', $tree['extra_after'];
 
 		echo '
-			</li>';
+						</li>';
 	}
+
 	echo '
-		</ul>
-	</div>';
+					</ul>
+				</div>';
 
 	$shown_linktree = true;
 }
 
-// Show the menu up top. Something like [home] [help] [profile] [logout]...
+/**
+ * Show the menu up top. Something like [home] [help] [profile] [logout]...
+ */
 function template_menu()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context;
 
 	echo '
-		<div id="main_menu">
-			<ul class="dropmenu" id="menu_nav">';
+				<div id="main_menu">
+					<ul class="dropmenu" id="menu_nav">';
 
+	// Note: Menu markup has been cleaned up to remove unnecessary spans and classes.
 	foreach ($context['menu_buttons'] as $act => $button)
 	{
 		echo '
-				<li id="button_', $act, '">
-					<a class="', $button['active_button'] ? 'active ' : '', 'firstlevel" href="', $button['href'], '"', isset($button['target']) ? ' target="' . $button['target'] . '"' : '', '>
-						<span class="', isset($button['is_last']) ? 'last ' : '', 'firstlevel">', $button['title'], '</span>
-					</a>';
+						<li id="button_', $act, '"', !empty($button['sub_buttons']) ? ' class="subsections"' :'', '>
+							<a', $button['active_button'] ? ' class="active"' : '', ' href="', $button['href'], '"', isset($button['target']) ? ' target="' . $button['target'] . '"' : '', '>
+								', $button['icon'], $button['title'], '
+							</a>';
+
 		if (!empty($button['sub_buttons']))
 		{
 			echo '
-					<ul>';
+							<ul>';
 
 			foreach ($button['sub_buttons'] as $childbutton)
 			{
 				echo '
-						<li>
-							<a href="', $childbutton['href'], '"', isset($childbutton['target']) ? ' target="' . $childbutton['target'] . '"' : '', '>
-								<span', isset($childbutton['is_last']) ? ' class="last"' : '', '>', $childbutton['title'], !empty($childbutton['sub_buttons']) ? '...' : '', '</span>
-							</a>';
+								<li', !empty($childbutton['sub_buttons']) ? ' class="subsections"' :'', '>
+									<a href="', $childbutton['href'], '"' , isset($childbutton['target']) ? ' target="' . $childbutton['target'] . '"' : '', '>
+										', $childbutton['title'], '
+									</a>';
 				// 3rd level menus :)
 				if (!empty($childbutton['sub_buttons']))
 				{
 					echo '
-							<ul>';
+									<ul>';
 
 					foreach ($childbutton['sub_buttons'] as $grandchildbutton)
 						echo '
-								<li>
-									<a href="', $grandchildbutton['href'], '"', isset($grandchildbutton['target']) ? ' target="' . $grandchildbutton['target'] . '"' : '', '>
-										<span', isset($grandchildbutton['is_last']) ? ' class="last"' : '', '>', $grandchildbutton['title'], '</span>
-									</a>
-								</li>';
+										<li>
+											<a href="', $grandchildbutton['href'], '"' , isset($grandchildbutton['target']) ? ' target="' . $grandchildbutton['target'] . '"' : '', '>
+												', $grandchildbutton['title'], '
+											</a>
+										</li>';
 
 					echo '
-							</ul>';
+									</ul>';
 				}
 
 				echo '
-						</li>';
+								</li>';
 			}
 				echo '
-					</ul>';
+							</ul>';
 		}
 		echo '
-				</li>';
+						</li>';
 	}
 
 	echo '
-			</ul>
-		</div>';
+					</ul>
+				</div>';
 }
 
-// Generate a strip of buttons.
-function template_button_strip($button_strip, $direction = 'top', $strip_options = array())
+/**
+ * Generate a strip of buttons.
+ * @param array $button_strip
+ * @param string $direction = ''
+ * @param array $strip_options = array()
+ */
+function template_button_strip($button_strip, $direction = '', $strip_options = array())
 {
-	global $settings, $context, $txt, $scripturl;
+	global $context, $txt;
 
 	if (!is_array($strip_options))
 		$strip_options = array();
 
-	// List the buttons in reverse order for RTL languages.
-	if ($context['right_to_left'])
-		$button_strip = array_reverse($button_strip, true);
-
 	// Create the buttons...
 	$buttons = array();
 	foreach ($button_strip as $key => $value)
 	{
+		// @todo this check here doesn't make much sense now (from 2.1 on), it should be moved to where the button array is generated
+		// Kept for backward compatibility
 		if (!isset($value['test']) || !empty($context[$value['test']]))
-			$buttons[] = '
-				<li><a' . (isset($value['id']) ? ' id="button_strip_' . $value['id'] . '"' : '') . ' class="button_strip_' . $key . (isset($value['active']) ? ' active' : '') . '" href="' . $value['url'] . '"' . (isset($value['custom']) ? ' ' . $value['custom'] : '') . '><span>' . $txt[$value['text']] . '</span></a></li>';
+		{
+			if (!isset($value['id']))
+				$value['id'] = $key;
+
+			$button = '
+				<a class="button button_strip_' . $key . (!empty($value['active']) ? ' active' : '') . '" href="' . (!empty($value['url']) ? $value['url'] : '') . '"' . (isset($value['custom']) ? ' ' . $value['custom'] : '') . '>' . $txt[$value['text']] . '</a>';
+
+			if (!empty($value['sub_buttons']))
+			{
+				$button .= '
+					<div class="top_menu dropmenu ' . $key . '_dropdown">
+						<div class="viewport">
+							<div class="overview">';
+				foreach ($value['sub_buttons'] as $element)
+				{
+					if (isset($element['test']) && empty($context[$element['test']]))
+						continue;
+
+					$button .= '
+								<a href="' . $element['url'] . '"><strong>' . $txt[$element['text']] . '</strong>';
+					if (isset($txt[$element['text'] . '_desc']))
+						$button .= '<br /><span>' . $txt[$element['text'] . '_desc'] . '</span>';
+					$button .= '</a>';
+				}
+				$button .= '
+							</div>
+						</div>
+					</div>';
+			}
+
+			$buttons[] = $button;
+		}
 	}
 
 	// No buttons? No button strip either.
 	if (empty($buttons))
 		return;
 
-	// Make the last one, as easy as possible.
-	$buttons[count($buttons) - 1] = str_replace('<span>', '<span class="last">', $buttons[count($buttons) - 1]);
-
 	echo '
 		<div class="buttonlist', !empty($direction) ? ' float' . $direction : '', '"', (empty($buttons) ? ' style="display: none;"' : ''), (!empty($strip_options['id']) ? ' id="' . $strip_options['id'] . '"': ''), '>
-			<ul>',
-				implode('', $buttons), '
-			</ul>
+			',implode('', $buttons), '
 		</div>';
 }
 
-?>
\ No newline at end of file
+function template_maint_warning_above()
+{
+	global $txt, $context, $scripturl;
+
+	echo '
+	<div class="errorbox" id="errors">
+		<dl>
+			<dt>
+				<strong id="error_serious">', $txt['forum_in_maintainence'], '</strong>
+			</dt>
+			<dd class="error" id="error_list">
+				', sprintf($txt['maintenance_page'], $scripturl . '?action=admin;area=serversettings;' . $context['session_var'] . '=' . $context['session_id']), '
+			</dd>
+		</dl>
+	</div>';
+}
+
+function template_maint_warning_below()
+{
+
+}
+
+?>
diff -ru a/Themes/default/languages/Admin.english.php b/Themes/default/languages/Admin.english.php
--- a/Themes/default/languages/Admin.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Admin.english.php	2015-03-05 23:30:06.024678600 -0800
@@ -1,9 +1,12 @@
 <?php
-// Version: 2.0; Admin
+// Version: 2.1 Beta 1; Admin
 
 global $settings, $scripturl;
 
-$txt['admin_boards'] = 'Boards';
+$txt['settings_saved'] = 'The settings were successfully saved';
+$txt['settings_not_saved'] = 'Your changes were not saved because: %1$s';
+
+$txt['admin_boards'] = 'Boards and Categories';
 $txt['admin_users'] = 'Members';
 $txt['admin_newsletters'] = 'Newsletters';
 $txt['admin_edit_news'] = 'News';
@@ -13,31 +16,28 @@
 $txt['admin_next'] = 'Next';
 $txt['admin_censored_words'] = 'Censored Words';
 $txt['admin_censored_where'] = 'Put the word to be censored on the left, and what to change it to on the right.';
-$txt['admin_censored_desc'] = 'Due to the public nature of forums there may be some words that you wish to prohibit being posted by users of your forum. You can enter any words below that you wish to be censored whenever used by a member.<br />Blank a box to remove that word.';
+$txt['admin_censored_desc'] = 'Due to the public nature of forums there may be some words that you wish to prohibit being posted by users of your forum. You can enter any words below that you wish to be censored whenever used by a member.<br>Clear a box to remove that word from the censor.';
 $txt['admin_reserved_names'] = 'Reserved Names';
-$txt['admin_template_edit'] = 'Edit Your Forum Template';
+$txt['admin_template_edit'] = 'Edit your forum template';
 $txt['admin_modifications'] = 'Modification Settings';
-$txt['admin_security_moderation'] = 'Security and Moderation';
 $txt['admin_server_settings'] = 'Server Settings';
-$txt['admin_reserved_set'] = 'Set Reserved Names';
+$txt['admin_reserved_set'] = 'Set reserved names';
 $txt['admin_reserved_line'] = 'One reserved word per line.';
-$txt['admin_basic_settings'] = 'This page allows you to change the basic settings for your forum.  Be very careful with these settings, as they may render the forum dysfunctional.';
+$txt['admin_basic_settings'] = 'This page allows you to change the basic settings for your forum. Be very careful with these settings, as they may render the forum dysfunctional.';
 $txt['admin_maintain'] = 'Enable Maintenance Mode';
 $txt['admin_title'] = 'Forum Title';
-$txt['admin_url'] = 'Forum URL';
-$txt['cookie_name'] = 'Cookie Name';
-$txt['admin_webmaster_email'] = 'Webmaster Email Address';
-$txt['boarddir'] = 'SMF Directory';
-$txt['sourcesdir'] = 'Sources Directory';
+$txt['cookie_name'] = 'Cookie name';
+$txt['admin_webmaster_email'] = 'Webmaster email address';
 $txt['cachedir'] = 'Cache Directory';
 $txt['admin_news'] = 'Enable News';
-$txt['admin_guest_post'] = 'Enable Guest Posting';
+$txt['admin_guest_post'] = 'Enable guest posting';
 $txt['admin_manage_members'] = 'Members';
 $txt['admin_main'] = 'Main';
 $txt['admin_config'] = 'Configuration';
-$txt['admin_version_check'] = 'Detailed Version Check';
+$txt['admin_version_check'] = 'Detailed version check';
 $txt['admin_smffile'] = 'SMF File';
 $txt['admin_smfpackage'] = 'SMF Package';
+$txt['admin_logoff'] = 'End Admin Session';
 $txt['admin_maintenance'] = 'Maintenance';
 $txt['admin_image_text'] = 'Show buttons as images instead of text';
 $txt['admin_credits'] = 'Credits';
@@ -45,9 +45,10 @@
 $txt['admin_agreement_default'] = 'Default';
 $txt['admin_agreement_select_language'] = 'Language to edit';
 $txt['admin_agreement_select_language_change'] = 'Change';
+$txt['admin_agreement_not_saved'] = 'The agreement changes have not been saved. Perhaps the file permissions on the file were not set correctly.';
 $txt['admin_delete_members'] = 'Delete Selected Members';
-$txt['admin_repair'] = 'Repair All Boards and Topics';
-$txt['admin_main_welcome'] = 'This is your &quot;%1$s&quot;.  From here, you can edit settings, maintain your forum, view logs, install packages, manage themes, and many other things.<div style="margin-top: 1ex;">If you have any trouble, please look at the &quot;Support &amp; Credits&quot; page.  If the information there doesn\'t help you, feel free to <a href="http://www.simplemachines.org/community/index.php" target="_blank" class="new_win">look to us for help</a> with the problem.</div>You may also find answers to your questions or problems by clicking the <img src="' . $settings['images_url'] . '/helptopics.gif" alt="%2$s" title="%3$s" /> symbols for more information on the related functions.';
+$txt['admin_repair'] = 'Repair All boards and topics';
+$txt['admin_main_welcome'] = 'This is your &quot;%1$s&quot;. From here, you can edit settings, maintain your forum, view logs, install packages, manage themes, and many other things.<br><br>If you have any trouble, please look at the &quot;Support &amp; Credits&quot; page. If the information there doesn\'t help you, feel free to <a href="http://www.simplemachines.org/community/index.php" target="_blank" class="new_win">look to us for help</a> with the problem.<br>You may also find answers to your questions or problems by clicking the <span class="generic_icons help" title="%3$s"></span> symbols for more information on the related functions.';
 $txt['admin_news_desc'] = 'Please place one news item per box. BBC tags, such as <span title="Are you bold?">[b]</span>, <span title="I tall icks!!">[i]</span> and <span title="Brackets are great, no?">[u]</span> are allowed in your news, as well as smileys. Clear a news item\'s text box to remove it.';
 $txt['administrators'] = 'Forum Administrators';
 $txt['admin_reserved_desc'] = 'Reserved names will keep members from registering certain usernames or using these words in their displayed names. Choose the options you wish to use from the bottom before submitting.';
@@ -58,48 +59,48 @@
 $txt['admin_check_display'] = 'Check display name.';
 $txt['admin_newsletter_send'] = 'You can email anyone from this page. The email addresses of the selected membergroups should appear below, but you may remove or add any email addresses you wish. Be sure that each address is separated in this fashion: \'address1; address2\'.';
 $txt['admin_fader_delay'] = 'Fading delay between items for the news fader';
-$txt['admin_bbc'] = 'Show BBC Buttons on Posting and PM Send Pages';
+$txt['additional_options_collapsable'] = 'Enable collapsible additional post options';
+$txt['zero_for_no_limit'] = '(0 for no limit)';
+$txt['zero_to_disable'] = '(Set to 0 to disable.)';
 
 $txt['admin_backup_fail'] = 'Failed to make backup of Settings.php - make sure Settings_bak.php exists and is writable.';
-$txt['modSettings_info'] = 'Change or set options that control how this forum operates.';
-$txt['database_server'] = 'Database Server';
-$txt['database_user'] = 'Database Username';
-$txt['database_password'] = 'Database Password';
-$txt['database_name'] = 'Database Name';
 $txt['registration_agreement'] = 'Registration Agreement';
 $txt['registration_agreement_desc'] = 'This agreement is shown when a user registers an account on this forum and has to be accepted before users can continue registration.';
-$txt['database_prefix'] = 'Database Tables Prefix';
 $txt['errors_list'] = 'Listing of forum errors';
 $txt['errors_found'] = 'The following errors are fouling up your forum';
 $txt['errors_fix'] = 'Would you like to attempt to fix these errors?';
-$txt['errors_do_recount'] = 'All errors fixed - a salvage area has been created! Please click the button below to recount some key statistics.';
+$txt['errors_do_recount'] = 'All errors have been fixed and a salvage area has been created. Please click the button below to recount some key statistics.';
 $txt['errors_recount_now'] = 'Recount Statistics';
 $txt['errors_fixing'] = 'Fixing forum errors';
-$txt['errors_fixed'] = 'All errors fixed! Please check on any categories, boards, or topics created to decide what to do with them.';
+$txt['errors_fixed'] = 'All errors fixed. Please check on any categories, boards, or topics created to decide what to do with them.';
 $txt['attachments_avatars'] = 'Attachments and Avatars';
 $txt['attachments_desc'] = 'From here you can administer the attached files on your system. You can delete attachments by size and by date from your system. Statistics on attachments are also displayed below.';
-$txt['attachment_stats'] = 'File Attachment Statistics';
-$txt['attachment_integrity_check'] = 'Attachment Integrity Check';
+$txt['attachment_stats'] = 'File attachment statistics';
+$txt['attachment_integrity_check'] = 'Attachment integrity check';
 $txt['attachment_integrity_check_desc'] = 'This function will check the integrity and sizes of attachments and filenames listed in the database and, if necessary, fix errors it encounters.';
 $txt['attachment_check_now'] = 'Run check now';
 $txt['attachment_pruning'] = 'Attachment Pruning';
 $txt['attachment_pruning_message'] = 'Message to add to post';
 $txt['attachment_pruning_warning'] = 'Are you sure you want to delete these attachments?\\nThis cannot be undone!';
-$txt['attachment_total'] = 'Total Attachments';
-$txt['attachmentdir_size'] = 'Total Size of Attachment Directory';
-$txt['attachmentdir_size_current'] = 'Total Size of Current Attachment Directory';
-$txt['attachment_space'] = 'Total Space Available in Attachment Directory';
-$txt['attachment_space_current'] = 'Total Space Available in Current Attachment Directory';
+
+$txt['attachment_total'] = 'Total attachments';
+$txt['attachmentdir_size'] = 'Total size of all attachment directories';
+$txt['attachmentdir_size_current'] = 'Total size of current attachment directory';
+$txt['attachmentdir_files_current'] = 'Total files in current attachment directory';
+$txt['attachment_space'] = 'Total space available';
+$txt['attachment_files'] = 'Total files remaining';
+
 $txt['attachment_options'] = 'File Attachment Options';
 $txt['attachment_log'] = 'Attachment Log';
 $txt['attachment_remove_old'] = 'Remove attachments older than';
 $txt['attachment_remove_size'] = 'Remove attachments larger than';
-$txt['attachment_name'] = 'Attachment Name';
+$txt['attachment_name'] = 'Attachment name';
 $txt['attachment_file_size'] = 'File Size';
 $txt['attachmentdir_size_not_set'] = 'No maximum directory size is currently set';
+$txt['attachmentdir_files_not_set'] = 'No directory file limit is currently set';
 $txt['attachment_delete_admin'] = '[attachment deleted by admin]';
 $txt['live'] = 'Live from Simple Machines...';
-$txt['remove_all'] = 'Remove All';
+$txt['remove_all'] = 'Clear Log';
 $txt['approve_new_members'] = 'Admin must approve all new members';
 $txt['agreement_not_writable'] = 'Warning - agreement.txt is not writable, any changes you make will NOT be saved.';
 
@@ -112,12 +113,8 @@
 $txt['manage_search'] = 'Search';
 
 $txt['smileys_manage'] = 'Smileys and Message Icons';
-$txt['smileys_manage_info'] = 'Install new smiley sets, add smileys to existing ones, or manage your message icons.';
-$txt['package_info'] = 'Install new features or modify existing ones with this interface.';
 $txt['theme_admin'] = 'Themes and Layout';
-$txt['theme_admin_info'] = 'Setup and manage your themes and set or reset theme options.';
 $txt['registration_center'] = 'Registration';
-$txt['member_center_info'] = 'View the member list, search for members and manage not-yet-approved members and members who haven\'t activated their account yet.';
 
 $txt['viewmembers_name'] = 'Username (display name)';
 $txt['viewmembers_online'] = 'Last Online';
@@ -133,21 +130,26 @@
 $txt['unknown'] = 'unknown';
 $txt['security_wrong'] = 'Administration login attempt!' . "\n" . 'Referer: %1$s' . "\n" . 'User agent: %2$s' . "\n" . 'IP: %3$s';
 
-$txt['email_as_html'] = 'Send in HTML format.  (with this you can put normal HTML in the email.)';
+$txt['email_preview_warning'] = 'The preview is not 100% accurate. In order to preserve the functionality of the page only the basic html tags are represented';
+$txt['email_as_html'] = 'Send in HTML format. (with this you can put normal HTML in the email.)';
 $txt['email_parsed_html'] = 'Add &lt;br /&gt;s and &amp;nbsp;s to this message.';
-$txt['email_variables'] = 'In this message you can use a few &quot;variables&quot;.  Click <a href="' . $scripturl . '?action=helpadmin;help=emailmembers" onclick="return reqWin(this.href);" class="help">here</a> for more information.';
+$txt['email_variables'] = 'In this message you can use a few &quot;variables&quot;. Click <a href="' . $scripturl . '?action=helpadmin;help=email_members" onclick="return reqOverlayDiv(this.href);" class="help">here</a> for more information.';
 $txt['email_force'] = 'Send this to members even if they have chosen not to receive announcements.';
 $txt['email_as_pms'] = 'Send this to these groups using personal messages.';
 $txt['email_continue'] = 'Continue';
 $txt['email_done'] = 'done.';
 
+$txt['warnings'] = 'Warnings';
+$txt['warnings_desc'] = 'This system allows administrators and moderators to issue warnings to users, and can automatically remove user rights as their warning level increases. To take full advantage of this system, &quot;Post Moderation&quot; should be enabled.';
+
 $txt['ban_title'] = 'Ban List';
 $txt['ban_ip'] = 'IP banning: (e.g. 192.168.12.213 or 128.0.*.*) - one entry per line';
 $txt['ban_email'] = 'Email banning: (e.g. badguy@somewhere.com) - one entry per line';
 $txt['ban_username'] = 'User name banning: (e.g. l33tuser) - one entry per line';
 
+$txt['ban_errors_detected'] = 'The following error or errors occurred while saving or editing the ban';
 $txt['ban_description'] = 'Here you can ban troublesome people either by IP, hostname, username, or email.';
-$txt['ban_add_new'] = 'Add New Ban';
+$txt['ban_add_new'] = 'Add new ban';
 $txt['ban_banned_entity'] = 'Banned entity';
 $txt['ban_on_ip'] = 'Ban on IP (e.g. 192.168.10-20.*)';
 $txt['ban_on_hostname'] = 'Ban on Hostname (e.g. *.mil)';
@@ -205,7 +207,7 @@
 $txt['ban_log_email'] = 'Email address';
 $txt['ban_log_member'] = 'Member';
 $txt['ban_log_date'] = 'Date';
-$txt['ban_log_remove_all'] = 'Remove all';
+$txt['ban_log_remove_all'] = 'Clear Log';
 $txt['ban_log_remove_all_confirm'] = 'Are you sure you want to delete all ban log entries?';
 $txt['ban_log_remove_selected'] = 'Remove selected';
 $txt['ban_log_remove_selected_confirm'] = 'Are you sure you want to delete all selected ban log entries?';
@@ -220,19 +222,22 @@
 $txt['maintain_sub_members'] = 'Members';
 $txt['maintain_sub_topics'] = 'Topics';
 $txt['maintain_done'] = 'The maintenance task \'%1$s\' was executed successfully.';
-$txt['maintain_no_errors'] = 'Congratulations, no errors found!  Thanks for checking.';
+$txt['maintain_no_errors'] = 'Congratulations, no errors were found. Thanks for checking.';
 
 $txt['maintain_tasks'] = 'Scheduled Tasks';
 $txt['maintain_tasks_desc'] = 'Manage all the tasks scheduled by SMF.';
 
 $txt['scheduled_log'] = 'Task Log';
-$txt['scheduled_log_desc'] = 'Lists logs of the tasks that have be ran.';
+$txt['scheduled_log_desc'] = 'This log shows all the scheduled tasks that have been run on your forum.';
 $txt['admin_log'] = 'Administration Log';
 $txt['admin_log_desc'] = 'Lists administrative tasks that have been performed by admins of your forum.';
 $txt['moderation_log'] = 'Moderation Log';
 $txt['moderation_log_desc'] = 'Lists moderation activities that have been performed by moderators on your forum.';
 $txt['spider_log_desc'] = 'Review the entries related to search engine spider activity on your forum.';
-$txt['pruning_log_desc'] = 'Use these tools to prune older entries in the various logs.';
+$txt['log_settings_desc'] = 'Use these options to configure how logging works on your forum.';
+$txt['modlog_enabled'] = 'Enable the moderation log';
+$txt['adminlog_enabled'] = 'Enable the administration log';
+$txt['userlog_enabled'] = 'Enable the profile edits log';
 
 $txt['mailqueue_title'] = 'Mail';
 
@@ -241,12 +246,12 @@
 $txt['ssi_db_user'] = 'Database username to use in SSI mode';
 $txt['ssi_db_passwd'] = 'Database password to use in SSI mode';
 
-$txt['default_language'] = 'Default Forum Language';
+$txt['default_language'] = 'Default forum language';
 
 $txt['maintenance_subject'] = 'Subject for display';
 $txt['maintenance_message'] = 'Message for display';
 
-$txt['errlog_desc'] = 'The error log tracks every error encountered by your forum.  To delete any errors from the database, mark the checkbox, and click the %1$s button at the bottom of the page.';
+$txt['errlog_desc'] = 'The error log tracks every error encountered by your forum. To delete any errors from the database, mark the checkbox, and click the %1$s button at the bottom of the page.';
 $txt['errlog_no_entries'] = 'There are currently no error log entries.';
 
 $txt['theme_settings'] = 'Theme Settings';
@@ -258,11 +263,12 @@
 $txt['dvc_default'] = 'Default Templates';
 $txt['dvc_templates'] = 'Current Templates';
 $txt['dvc_languages'] = 'Language Files';
+$txt['dvc_tasks'] = 'Background Tasks';
 
 $txt['smileys_default_set_for_theme'] = 'Select default smiley set for this theme';
 $txt['smileys_no_default'] = '(use global default smiley set)';
 
-$txt['censor_test'] = 'Test Censored Words';
+$txt['censor_test'] = 'Test censored words';
 $txt['censor_test_save'] = 'Test';
 $txt['censor_case'] = 'Ignore case when censoring';
 $txt['censor_whole_words'] = 'Check only whole words';
@@ -278,15 +284,14 @@
 $txt['not_activated'] = 'Not activated';
 $txt['primary'] = 'Primary';
 $txt['additional'] = 'Additional';
-$txt['messenger_address'] = 'Messenger Address';
 $txt['wild_cards_allowed'] = 'wildcard characters * and ? are allowed';
 $txt['search_for'] = 'Search for';
+$txt['search_match'] = 'Match';
 $txt['member_part_of_these_membergroups'] = 'Member is part of these membergroups';
 $txt['membergroups'] = 'Membergroups';
 $txt['confirm_delete_members'] = 'Are you sure you want to delete the selected members?';
 
 $txt['support_credits_title'] = 'Support and Credits';
-$txt['support_credits_info'] = 'Get support on common issues and version information to give if you have problems.';
 $txt['support_title'] = 'Support Information';
 $txt['support_versions_current'] = 'Current SMF version';
 $txt['support_versions_forum'] = 'Forum version';
@@ -294,18 +299,14 @@
 $txt['support_versions_db'] = '%1$s version';
 $txt['support_versions_server'] = 'Server version';
 $txt['support_versions_gd'] = 'GD version';
+$txt['support_versions_imagemagick'] = 'ImageMagick version';
 $txt['support_versions'] = 'Version Information';
 $txt['support_resources'] = 'Support Resources';
 $txt['support_resources_p1'] = 'Our <a href="%1$s">Online Manual</a> provides the main documentation for SMF. The SMF Online Manual has many documents to help answer support questions and explain <a href="%2$s">Features</a>, <a href="%3$s">Settings</a>, <a href="%4$s">Themes</a>, <a href="%5$s">Packages</a>, etc. The Online Manual documents each area of SMF thoroughly and should answer most questions quickly.';
 $txt['support_resources_p2'] = 'If you can\'t find the answers to your questions in the Online Manual, you may want to search our <a href="%1$s">Support Community</a> or ask for assistance in either our <a href="%2$s">English</a> or one of our many <a href="%3$s">international support boards</a>. The SMF Support Community can be used for <a href="%4$s">support</a>, <a href="%5$s">customization</a>, and many other things such as discussing SMF, finding a host, and discussing administrative issues with other forum administrators.';
 
-$txt['support_latest'] = 'Common Support &amp; Issues';
-$txt['support_latest_fetch'] = 'Retrieving support information...';
-
-$txt['edit_permissions_info'] = 'Change restrictions and available features globally or to specific boards.';
 $txt['membergroups_members'] = 'Regular Members';
 $txt['membergroups_guests'] = 'Guests';
-$txt['membergroups_guests_na'] = 'n/a';
 $txt['membergroups_add_group'] = 'Add group';
 $txt['membergroups_permissions'] = 'Permissions';
 
@@ -325,7 +326,7 @@
 $txt['attachment_manager_last_active'] = 'Last Active';
 $txt['attachment_manager_member'] = 'Member';
 $txt['attachment_manager_avatars_older'] = 'Remove avatars from members not active for more than';
-$txt['attachment_manager_total_avatars'] = 'Total Avatars';
+$txt['attachment_manager_total_avatars'] = 'Total avatars';
 
 $txt['attachment_manager_avatars_no_entries'] = 'There are currently no avatars.';
 $txt['attachment_manager_attachments_no_entries'] = 'There are currently no attachments.';
@@ -343,59 +344,120 @@
 $txt['attachmentEnable_disable_new'] = 'Disable new attachments';
 $txt['attachmentCheckExtensions'] = 'Check attachment\'s extension';
 $txt['attachmentExtensions'] = 'Allowed attachment extensions';
-$txt['attachmentRecodeLineEndings'] = 'Recode line endings in textual attachments';
 $txt['attachmentShowImages'] = 'Display image attachments as pictures under post';
-$txt['attachmentEncryptFilenames'] = 'Encrypt stored filenames';
-$txt['attachmentUploadDir'] = 'Attachments directory<div class="smalltext"><a href="' . $scripturl . '?action=admin;area=manageattachments;sa=attachpaths">Configure multiple attachment directories</a></div>';
-$txt['attachmentUploadDir_multiple'] = 'Attachments directory';
-$txt['attachmentUploadDir_multiple_configure'] = '<a href="' . $scripturl . '?action=admin;area=manageattachments;sa=attachpaths">[Configure multiple attachment directories]</a>';
-$txt['attachmentDirSizeLimit'] = 'Max attachment folder space<div class="smalltext">(0 for no limit)</div>';
-$txt['attachmentPostLimit'] = 'Max attachment size per post<div class="smalltext">(0 for no limit)</div>';
-$txt['attachmentSizeLimit'] = 'Max size per attachment<div class="smalltext">(0 for no limit)</div>';
-$txt['attachmentNumPerPostLimit'] = 'Max number of attachments per post<div class="smalltext">(0 for no limit)</div>';
-$txt['attachment_gd_warning'] = 'The GD module is currently not installed. Image re-encoding is not possible.';
+$txt['attachmentUploadDir'] = 'Attachments directory';
+$txt['attachmentUploadDir_multiple_configure'] = 'Manage attachment directories';
+$txt['attachmentDirSizeLimit'] = 'Max attachment directory space';
+$txt['attachmentPostLimit'] = 'Max attachment size per post';
+$txt['attachmentSizeLimit'] = 'Max size per attachment';
+$txt['attachmentNumPerPostLimit'] = 'Max number of attachments per post';
+$txt['attachment_img_enc_warning'] = 'Neither the GD module nor the IMagick or MagickWand extensions are currently installed. Image re-encoding is not possible.';
+$txt['attachment_postsize_warning'] = 'The current php.ini setting \'post_max_size\' may not support this.';
+$txt['attachment_filesize_warning'] = 'The current php.ini setting \'upload_max_filesize\' may not support this.';
 $txt['attachment_image_reencode'] = 'Re-encode potentially dangerous image attachments';
-$txt['attachment_image_reencode_note'] = '(requires GD module)';
+$txt['attachment_image_reencode_note'] = '(requires GD module or ImageMagick with IMagick or MagickWand extension)';
 $txt['attachment_image_paranoid_warning'] = 'The extensive security checks can result in a large number of rejected attachments.';
 $txt['attachment_image_paranoid'] = 'Perform extensive security checks on uploaded image attachments';
 $txt['attachmentThumbnails'] = 'Resize images when showing under posts';
 $txt['attachment_thumb_png'] = 'Save thumbnails as PNG';
+$txt['attachment_thumb_memory'] = 'Adaptive thumbnail memory';
 $txt['attachmentThumbWidth'] = 'Maximum width of thumbnails';
 $txt['attachmentThumbHeight'] = 'Maximum height of thumbnails';
+$txt['attachment_thumbnail_settings'] = 'Thumbnail Settings';
+$txt['attachment_security_settings'] = 'Attachment security settings';
 
 $txt['attach_dir_does_not_exist'] = 'Does Not Exist';
 $txt['attach_dir_not_writable'] = 'Not Writable';
 $txt['attach_dir_files_missing'] = 'Files Missing (<a href="' . $scripturl . '?action=admin;area=manageattachments;sa=repair;%2$s=%1$s">Repair</a>)';
 $txt['attach_dir_unused'] = 'Unused';
+$txt['attach_dir_empty'] = 'Empty';
 $txt['attach_dir_ok'] = 'OK';
-
-$txt['attach_path_manage'] = 'Manage Attachment Paths';
-$txt['attach_paths'] = 'Attachment Paths';
-$txt['attach_current_dir'] = 'Current Directory';
+$txt['attach_dir_basedir'] = 'Base directory';
+$txt['attach_dir_desc'] = 'Create new directories or change the current directory below. <br>To create a new directory within the forum directory structure, use just the directory name. <br>To remove a directory, blank the path input field. Only empty directories can be removed. To see if a directory is empty, check for files or sub-directories in brackets next to the file count. <br> To rename a directory, simply change its name in the input field. Only directories without sub-directories may be renamed. Directories can be renamed as long as they do not contain a sub-directory.';
+$txt['attach_dir_base_desc'] = 'You may use below to change the current base directory or create a new one. New base directories are also added to the Attachment Directory list. You may also designate an existing directory to be a base directory.';
+$txt['attach_dir_save_problem'] = 'Oops, there seems to be a problem.';
+$txt['attachments_no_create'] = 'Unable to create a new attachment directory. Please do so using a FTP client or your site file manager.';
+$txt['attachments_no_write'] = 'This directory has been created but is not writable. Please attempt to do so using a FTP client or your site file manager.';
+$txt['attach_dir_duplicate_msg'] = 'Unable to add. This directory already exists.';
+$txt['attach_dir_exists_msg'] = 'Unable to move. A directory already exists at that path.';
+$txt['attach_dir_base_dupe_msg'] = 'Unable to add. This base directory has already been created.';
+$txt['attach_dir_base_no_create'] = 'Unable to create. Please verify the path input. Or create this directory using an FTP client or site file manager and re-try.';
+$txt['attach_dir_no_rename'] = 'Unable to move or rename. Please verify that the path is correct or that this directory does not contain any sub-directories.';
+$txt['attach_dir_no_delete'] = 'Is not empty and can not be deleted. Please do so using a FTP client or site file manager.';
+$txt['attach_dir_no_remove'] = 'Still contains files or is a base directory and can not be deleted.';
+$txt['attach_dir_is_current'] = 'Unable to remove while it is selected as the current directory.';
+$txt['attach_dir_is_current_bd'] = 'Unable to remove while it is selected as the current base directory.';
+$txt['attach_dir_invalid'] = 'Invalid directory';
+$txt['attach_last_dir'] = 'Last active attachment directory';
+$txt['attach_current_dir'] = 'Current attachment directory';
+$txt['attach_current'] = 'Current';
+$txt['attach_path_manage'] = 'Manage attachment paths';
+$txt['attach_directories'] = 'Attachment Directories';
+$txt['attach_paths'] = 'Attachment directory paths';
 $txt['attach_path'] = 'Path';
-$txt['attach_current_size'] = 'Current Size (KB)';
+$txt['attach_current_size'] = 'Size (KB)';
 $txt['attach_num_files'] = 'Files';
 $txt['attach_dir_status'] = 'Status';
 $txt['attach_add_path'] = 'Add Path';
 $txt['attach_path_current_bad'] = 'Invalid current attachment path.';
+$txt['attachmentDirFileLimit'] = 'Maximum number of files per directory';
+
+$txt['attach_base_paths'] = 'Base directory paths';
+$txt['attach_num_dirs'] = 'Directories';
+$txt['max_image_width'] = 'Max display width of posted or attached images';
+$txt['max_image_height'] = 'Max display height of posted or attached images';
+
+$txt['automanage_attachments'] = 'Choose the method for the management of the attachment directories';
+$txt['attachments_normal'] = '(Manual) SMF default behavior';
+$txt['attachments_auto_years'] = '(Auto) Subdivide by years';
+$txt['attachments_auto_months'] = '(Auto) Subdivide by years and months';
+$txt['attachments_auto_days'] = '(Auto) Subdivide by years, months and days';
+$txt['attachments_auto_16'] = '(Auto) 16 random directories';
+$txt['attachments_auto_16x16'] = '(Auto) 16 random directories with 16 random sub-directories';
+$txt['attachments_auto_space'] = '(Auto) When either directory space limit is reached';
+
+$txt['use_subdirectories_for_attachments'] = 'Create new directories within a base directory';
+$txt['use_subdirectories_for_attachments_note'] = 'Otherwise any new directories will be created within the forum\'s main directory.';
+$txt['basedirectory_for_attachments'] = 'Set a base directory for attachments';
+$txt['basedirectory_for_attachments_current'] = 'Current base directory';
+$txt['basedirectory_for_attachments_warning'] = '<div class="smalltext">Please note that the directory is wrong. <br>(<a href="' . $scripturl . '?action=admin;area=manageattachments;sa=attachpaths">Attempt to correct</a>)</div>';
+$txt['attach_current_dir_warning'] = '<div class="smalltext">There seems to be a problem with this directory. <br>(<a href="' . $scripturl . '?action=admin;area=manageattachments;sa=attachpaths">Attempt to correct</a>)</div>';
+
+$txt['attachment_transfer'] = 'Transfer Attachments';
+$txt['attachment_transfer_desc'] = 'Transfer files betwen directories.';
+$txt['attachment_transfer_select'] = 'Select directory';
+$txt['attachment_transfer_now'] = 'Transfer';
+$txt['attachment_transfer_from'] = 'Transfer files from';
+$txt['attachment_transfer_auto'] = 'Automatically by space or file count';
+$txt['attachment_transfer_auto_select'] = 'Select base directory';
+$txt['attachment_transfer_to'] = 'Or to a specific directory.';
+$txt['attachment_transfer_empty'] = 'Empty the source directory';
+$txt['attachment_transfer_no_base'] = 'No base directories available.';
+$txt['attachment_transfer_forum_root'] = 'Forum root directory.';
+$txt['attachment_transfer_no_room'] = 'Directory size or file count limit reached.';
+$txt['attachment_transfer_no_find'] = 'No files were found to transfer.';
+$txt['attachments_transferred'] = '%1$d files were transferred to %2$s';
+$txt['attachments_not_transferred'] = '%1$d files were not transferred.';
+$txt['attachment_transfer_no_dir'] = 'Either the source directory or one of the target options were not selected.';
+$txt['attachment_transfer_same_dir'] = 'You cannot select the same directory as both the source and target.';
+$txt['attachment_transfer_progress'] = 'Please wait. Transfer in progress.';
 
 $txt['mods_cat_avatars'] = 'Avatars';
 $txt['avatar_directory'] = 'Avatars directory';
+$txt['avatar_directory_wrong'] = 'The Avatars directory is not valid. This will cause several issues with your forum.';
 $txt['avatar_url'] = 'Avatars URL';
-$txt['avatar_dimension_note'] = '(0 = no limit)';
-$txt['avatar_max_width_external'] = 'Maximum width of external avatar<div class="smalltext">(0 for no limit)</div>';
-$txt['avatar_max_height_external'] = 'Maximum height of external avatar<div class="smalltext">(0 for no limit)</div>';
+$txt['avatar_max_width_external'] = 'Maximum width of external avatar';
+$txt['avatar_max_height_external'] = 'Maximum height of external avatar';
 $txt['avatar_action_too_large'] = 'If the avatar is too large...';
 $txt['option_refuse'] = 'Refuse it';
-$txt['option_html_resize'] = 'Let the HTML resize it';
-$txt['option_js_resize'] = 'Resize it with JavaScript';
-$txt['option_download_and_resize'] = 'Download and resize it (requires GD module)';
-$txt['avatar_max_width_upload'] = 'Maximum width of uploaded avatar<div class="smalltext">(0 for no limit)</div>';
-$txt['avatar_max_height_upload'] = 'Maximum height of uploaded avatar<div class="smalltext">(0 for no limit)</div>';
+$txt['option_css_resize'] = 'Resize it in the users\' browser';
+$txt['option_download_and_resize'] = 'Download and resize it on the server';
+$txt['avatar_max_width_upload'] = 'Maximum width of uploaded avatar';
+$txt['avatar_max_height_upload'] = 'Maximum height of uploaded avatar';
 $txt['avatar_resize_upload'] = 'Resize oversized large avatars';
-$txt['avatar_resize_upload_note'] = '(requires GD module)';
+$txt['avatar_resize_upload_note'] = '(requires GD module or ImageMagick with IMagick or MagickWand extension)';
 $txt['avatar_download_png'] = 'Use PNG for resized avatars';
-$txt['avatar_gd_warning'] = 'The GD module is currently not installed. Some avatar features are disabled.';
+$txt['avatar_img_enc_warning'] = 'Neither the GD module nor the Imagick or MagickWand extensions are currently installed. Some avatar features are disabled.';
 $txt['avatar_external'] = 'External avatars';
 $txt['avatar_upload'] = 'Uploadable avatars';
 $txt['avatar_server_stored'] = 'Server-stored avatars';
@@ -404,22 +466,38 @@
 $txt['avatar_external_url_groups'] = 'Membergroups allowed to select an external URL';
 $txt['avatar_select_permission'] = 'Select permissions for each group';
 $txt['avatar_download_external'] = 'Download avatar at given URL';
-$txt['custom_avatar_enabled'] = 'Upload avatars to...';
 $txt['option_attachment_dir'] = 'Attachment directory';
 $txt['option_specified_dir'] = 'Specific directory...';
+$txt['custom_avatar_dir_wrong'] = 'The Attachments directory is not valid. This will prevent attachments from working properly.';
 $txt['custom_avatar_dir'] = 'Upload directory';
-$txt['custom_avatar_dir_desc'] = 'This should not be the same as the server-stored directory.';
+$txt['custom_avatar_dir_desc'] = 'This should be a valid and writable directory, different than the server-stored directory.';
 $txt['custom_avatar_url'] = 'Upload URL';
 $txt['custom_avatar_check_empty'] = 'The custom avatar directory you have specified may be empty or invalid. Please ensure these settings are correct.';
 $txt['avatar_reencode'] = 'Re-encode potentially dangerous avatars';
-$txt['avatar_reencode_note'] = '(requires GD module)';
+$txt['avatar_reencode_note'] = '(requires GD module or ImageMagick with IMagick or MagickWand extension)';
 $txt['avatar_paranoid_warning'] = 'The extensive security checks can result in a large number of rejected avatars.';
 $txt['avatar_paranoid'] = 'Perform extensive security checks on uploaded avatars';
+$txt['gravatar_settings'] = 'Gravatars (Globally Recognized Avatars)';
+$txt['gravatarEnabled'] = 'Enable Gravatars for forum users?';
+$txt['gravatarOverride'] = 'Force Gravatars to be used instead of normal avatars?';
+$txt['gravatarAllowExtraEmail'] = 'Allow storing an extra email address for Gravatars?';
+$txt['gravatarMaxRating'] = 'Maximum allowed rating?';
+$txt['gravatar_maxG'] = 'G rated (Generally acceptable)';
+$txt['gravatar_maxPG'] = 'PG rated (Parental Guidance)';
+$txt['gravatar_maxR'] = 'R rated (Restricted)';
+$txt['gravatar_maxX'] = 'X rated (Explicit)';
+$txt['gravatarDefault'] = 'Default image to show when an email address has no matching Gravatar ';
+$txt['gravatar_mm'] = 'A simple, cartoon-style silhouetted outline of a person';
+$txt['gravatar_identicon'] = 'A geometric pattern based on an email hash';
+$txt['gravatar_monsterid'] = 'A generated \'monster\' with different colors, faces, etc';
+$txt['gravatar_wavatar'] = 'Generated faces with differing features and backgrounds';
+$txt['gravatar_retro'] = 'Awesome generated, 8-bit arcade-style pixelated faces';
+$txt['gravatar_blank'] = 'A transparent PNG image';
 
 $txt['repair_attachments'] = 'Maintain Attachments';
 $txt['repair_attachments_complete'] = 'Maintenance Complete';
 $txt['repair_attachments_complete_desc'] = 'All selected errors have now been corrected';
-$txt['repair_attachments_no_errors'] = 'No errors were found!';
+$txt['repair_attachments_no_errors'] = 'No errors were found';
 $txt['repair_attachments_error_desc'] = 'The follow errors were found during maintenance. Check the box next to the errors you wish to fix and hit continue.';
 $txt['repair_attachments_continue'] = 'Continue';
 $txt['repair_attachments_cancel'] = 'Cancel';
@@ -430,26 +508,29 @@
 $txt['attach_repair_file_size_of_zero'] = '%1$d attachments/avatars have a size of zero on disk. (These will be deleted)';
 $txt['attach_repair_attachment_no_msg'] = '%1$d attachments no longer have a message associated with them';
 $txt['attach_repair_avatar_no_member'] = '%1$d avatars no longer have a member associated with them';
-$txt['attach_repair_wrong_folder'] = '%1$d attachments are in the wrong folder';
+$txt['attach_repair_wrong_folder'] = '%1$d attachments are in the wrong directory';
+$txt['attach_repair_files_without_attachment'] = '%1$d files do not have a corresponding entry in the database. (These will be deleted)';
 
 $txt['news_title'] = 'News and Newsletters';
 $txt['news_settings_desc'] = 'Here you can change the settings and permissions related to news and newsletters.';
 $txt['news_settings_submit'] = 'Save';
 $txt['news_mailing_desc'] = 'From this menu you can send messages to all members who\'ve registered and entered their email addresses. You may edit the distribution list, or send messages to all. Useful for important update/news information.';
+$txt['news_error_no_news'] = 'Nothing written';
 $txt['groups_edit_news'] = 'Groups allowed to edit news items';
 $txt['groups_send_mail'] = 'Groups allowed to send out forum newsletters';
 $txt['xmlnews_enable'] = 'Enable XML/RSS news';
-$txt['xmlnews_maxlen'] = 'Maximum message length:<div class="smalltext">(0 to disable, bad idea.)</div>';
-$txt['editnews_clickadd'] = 'Click here to add another item.';
+$txt['xmlnews_maxlen'] = 'Maximum message length';
+$txt['xmlnews_maxlen_note'] = '(0 to disable, bad idea.)';
+$txt['editnews_clickadd'] = 'Add another item';
 $txt['editnews_remove_selected'] = 'Remove selected';
 $txt['editnews_remove_confirm'] = 'Are you sure you want to delete the selected news items?';
-$txt['censor_clickadd'] = 'Click here to add another word.';
+$txt['censor_clickadd'] = 'Add another word';
 
 $txt['layout_controls'] = 'Forum';
 $txt['logs'] = 'Logs';
 $txt['generate_reports'] = 'Reports';
 
-$txt['update_available'] = 'Update Available!';
+$txt['update_available'] = 'Update Available';
 $txt['update_message'] = 'You\'re using an outdated version of SMF, which contains some bugs which have since been fixed.
 	It is recommended that you <a href="#" id="update-link">update your forum</a> to the latest version as soon as possible. It only takes a minute!';
 
@@ -470,29 +551,42 @@
 
 $txt['manageposts_bbc_settings'] = 'Bulletin Board Code';
 $txt['manageposts_bbc_settings_description'] = 'Bulletin board code can be used to add markup to forum messages. For example, to highlight the word \'house\' you can type [b]house[/b]. All Bulletin board code tags are surrounded by square brackets (\'[\' and \']\').';
-$txt['manageposts_bbc_settings_title'] = 'Bulletin Board Code Settings';
+$txt['manageposts_bbc_settings_title'] = 'Bulletin Board Code settings';
 $txt['manageposts_bbc_settings_submit'] = 'Save';
 
 $txt['manageposts_topic_settings'] = 'Topic Settings';
 $txt['manageposts_topic_settings_description'] = 'Here you can set all settings involving topics.';
 $txt['manageposts_topic_settings_submit'] = 'Save';
 
+$txt['managedrafts_settings'] = 'Draft Settings';
+$txt['managedrafts_settings_description'] = 'Here you can set all settings involving drafts.';
+$txt['managedrafts_submit'] = 'Save';
+$txt['manage_drafts'] = 'Drafts';
+
 $txt['removeNestedQuotes'] = 'Remove nested quotes when quoting';
 $txt['enableEmbeddedFlash'] = 'Embed flash into posts';
 $txt['enableEmbeddedFlash_warning'] = 'may be a security risk!';
 $txt['enableSpellChecking'] = 'Enable spell checking';
-$txt['enableSpellChecking_warning'] = 'this does not work on all servers!';
+$txt['enableSpellChecking_warning'] = 'this does not work on all servers.';
 $txt['disable_wysiwyg'] = 'Disable WYSIWYG editor';
 $txt['max_messageLength'] = 'Maximum allowed post size';
 $txt['max_messageLength_zero'] = '0 for no max.';
-$txt['fixLongWords'] = 'Break up words with more letters than';
-$txt['fixLongWords_zero'] = '0 to disable.';
-$txt['fixLongWords_warning'] = 'this does not work on all servers!';
+$txt['convert_to_mediumtext'] = 'Your database is not setup to accept messages longer than 65535 characters. Please use the <a href="%1$s">database maintenance</a> page to convert the database and then came back to increase the maximum allowed post size.';
 $txt['topicSummaryPosts'] = 'Posts to show on topic summary';
 $txt['spamWaitTime'] = 'Time required between posts from the same IP';
 $txt['edit_wait_time'] = 'Courtesy edit wait time';
 $txt['edit_disable_time'] = 'Maximum time after posting to allow edit';
-$txt['edit_disable_time_zero'] = '0 to disable';
+$txt['preview_characters'] = 'Maximum length of last/first post preview';
+$txt['preview_characters_units'] = 'characters';
+$txt['message_index_preview_first'] = 'When using post previews, show the text of the first post';
+$txt['message_index_preview_first_desc'] = 'Leave un-checked to show the text of the last post instead';
+$txt['show_user_images'] = 'Show user avatars in message view';
+$txt['show_blurb'] = 'Show personal text in message view';
+$txt['hide_post_group'] = 'Hide post group titles for grouped members';
+$txt['hide_post_group_desc'] = 'Enabling this will not display a member\'s post group title on the message view if they are assigned to a non-post based group.';
+$txt['subject_toggle'] = 'Show subjects in topics.';
+$txt['show_profile_buttons'] = 'Show view profile button under post';
+$txt['show_modify'] = 'Show last modification date on modified posts';
 
 $txt['enableBBC'] = 'Enable bulletin board code (BBC)';
 $txt['enablePostHTML'] = 'Enable <em>basic</em> HTML in posts';
@@ -502,38 +596,42 @@
 $txt['bbcTagsToUse_select'] = 'Select the tags allowed to be used';
 $txt['bbcTagsToUse_select_all'] = 'Select all tags';
 
-$txt['enableStickyTopics'] = 'Enable sticky topics';
 $txt['enableParticipation'] = 'Enable participation icons';
 $txt['oldTopicDays'] = 'Time before topic is warned as old on reply';
-$txt['oldTopicDays_zero'] = '0 to disable';
 $txt['defaultMaxTopics'] = 'Number of topics per page in the message index';
 $txt['defaultMaxMessages'] = 'Number of posts per page in a topic page';
-$txt['hotTopicPosts'] = 'Number of posts for a hot topic';
-$txt['hotTopicVeryPosts'] = 'Number of posts for a very hot topic';
+$txt['disable_print_topic'] = 'Disable print topic feature';
 $txt['enableAllMessages'] = 'Max topic size to show &quot;All&quot; posts';
 $txt['enableAllMessages_zero'] = '0 to never show &quot;All&quot;';
 $txt['disableCustomPerPage'] = 'Disable user defined topic/message count per page';
 $txt['enablePreviousNext'] = 'Enable previous/next topic links';
 
-$txt['not_done_title'] = 'Not done yet!';
-$txt['not_done_reason'] = 'To avoid overloading your server, the process has been temporarily paused.  It should automatically continue in a few seconds.  If it doesn\'t, please click continue below.';
+$txt['not_done_title'] = 'Not done yet';
+$txt['not_done_reason'] = 'To avoid overloading your server, the process has been temporarily paused. It should automatically continue in a few seconds. If it doesn\'t, please click continue below.';
 $txt['not_done_continue'] = 'Continue';
 
 $txt['general_settings'] = 'General';
 $txt['database_paths_settings'] = 'Database and Paths';
 $txt['cookies_sessions_settings'] = 'Cookies and Sessions';
+$txt['security_settings'] = 'Security';
 $txt['caching_settings'] = 'Caching';
 $txt['load_balancing_settings'] = 'Load Balancing';
+$txt['phpinfo_settings'] = 'PHP Info';
+$txt['phpinfo_localsettings'] = 'Local Settings';
+$txt['phpinfo_defaultsettings'] = 'Default Settings';
+$txt['phpinfo_itemsettings'] = 'Settings';
 
 $txt['language_configuration'] = 'Languages';
 $txt['language_description'] = 'This section allows you to edit languages installed on your forum, download new ones from the Simple Machines website. You may also edit language-related settings here.';
 $txt['language_edit'] = 'Edit Languages';
 $txt['language_add'] = 'Add Language';
 $txt['language_settings'] = 'Settings';
+$txt['could_not_language_backup'] = 'A backup could not be made before removing this language pack. No changes have been made at this time as a result (either change the permissions so Packages/backup can be written to, or turn off backups - not recommended)';
 
 $txt['advanced'] = 'Advanced';
 $txt['simple'] = 'Simple';
 
+$txt['admin_news_newsletter_queue_done'] = 'The newsletter has been added to the mail queue successfully.';
 $txt['admin_news_select_recipients'] = 'Please select who should receive a copy of the newsletter';
 $txt['admin_news_select_group'] = 'Membergroups';
 $txt['admin_news_select_group_desc'] = 'Select the groups to receive this newsletter.';
@@ -544,8 +642,8 @@
 $txt['admin_news_select_excluded_groups'] = 'Excluded Groups';
 $txt['admin_news_select_excluded_groups_desc'] = 'Select groups who should definitely not receive the newsletter.';
 $txt['admin_news_select_email'] = 'Email Addresses';
-$txt['admin_news_select_email_desc'] = 'A semi-colon separated list of email addresses which should be sent newsletter. (i.e. address1; address2)';
-$txt['admin_news_select_override_notify'] = 'Override Notification Settings';
+$txt['admin_news_select_email_desc'] = 'A semi-colon separated list of email addresses which should be sent a newsletter. (i.e. address1; address2) This is additional to the groups listed above.';
+$txt['admin_news_select_override_notify'] = 'Override notification settings';
 // Use entities in below.
 $txt['admin_news_cannot_pm_emails_js'] = 'You cannot send a personal message to an email address. If you continue all entered email addresses will be ignored.\\n\\nAre you sure you wish to do this?';
 
@@ -560,25 +658,25 @@
 $txt['admin_search_results'] = 'Search Results';
 $txt['admin_search_results_desc'] = 'Results for search: &quot;%1$s&quot;';
 $txt['admin_search_results_again'] = 'Search again';
-$txt['admin_search_results_none'] = 'No results found!';
+$txt['admin_search_results_none'] = 'No results found.';
 
 $txt['admin_search_section_sections'] = 'Section';
 $txt['admin_search_section_settings'] = 'Setting';
 
-$txt['core_settings_title'] = 'Core Features';
 $txt['mods_cat_features'] = 'General';
-$txt['mods_cat_security_general'] = 'General';
 $txt['antispam_title'] = 'Anti-Spam';
 $txt['mods_cat_modifications_misc'] = 'Miscellaneous';
 $txt['mods_cat_layout'] = 'Layout';
-$txt['karma'] = 'Karma';
 $txt['moderation_settings_short'] = 'Moderation';
 $txt['signature_settings_short'] = 'Signatures';
 $txt['custom_profile_shorttitle'] = 'Profile Fields';
 $txt['pruning_title'] = 'Log Pruning';
+$txt['pruning_desc'] = 'The following options are useful for keeping your logs from growing too big, because most of the time older entries are not really of that much use.';
+$txt['log_settings'] = 'Log Settings';
+$txt['log_ban_hits'] = 'Log ban hits in the error log?';
 
 $txt['boardsEdit'] = 'Modify Boards';
-$txt['mboards_new_cat'] = 'Create New Category';
+$txt['mboards_new_cat'] = 'Create new category';
 $txt['manage_holidays'] = 'Manage Holidays';
 $txt['calendar_settings'] = 'Calendar Settings';
 $txt['search_weights'] = 'Weights';
@@ -587,8 +685,8 @@
 $txt['smiley_sets'] = 'Smiley Sets';
 $txt['smileys_add'] = 'Add Smiley';
 $txt['smileys_edit'] = 'Edit Smileys';
-$txt['smileys_set_order'] = 'Set Smiley Order';
-$txt['icons_edit_message_icons'] = 'Edit Message Icons';
+$txt['smileys_set_order'] = 'Set Smiley order';
+$txt['icons_edit_message_icons'] = 'Message Icons';
 
 $txt['membergroups_new_group'] = 'Add Membergroup';
 $txt['membergroups_edit_groups'] = 'Edit Membergroups';
@@ -598,7 +696,7 @@
 $txt['permissions_post_moderation'] = 'Post Moderation';
 
 $txt['browse_packages'] = 'Browse Packages';
-$txt['download_packages'] = 'Download Packages';
+$txt['download_packages'] = 'Add Packages';
 $txt['installed_packages'] = 'Installed Packages';
 $txt['package_file_perms'] = 'File Permissions';
 $txt['package_settings'] = 'Options';
@@ -606,7 +704,7 @@
 $txt['themeadmin_list_title'] = 'Theme Settings';
 $txt['themeadmin_reset_title'] = 'Member Options';
 $txt['themeadmin_edit_title'] = 'Modify Themes';
-$txt['admin_browse_register_new'] = 'Register New Member';
+$txt['admin_browse_register_new'] = 'Register new member';
 
 $txt['search_engines'] = 'Search Engines';
 $txt['spiders'] = 'Spiders';
@@ -616,4 +714,38 @@
 $txt['paid_subscriptions'] = 'Paid Subscriptions';
 $txt['paid_subs_view'] = 'View Subscriptions';
 
+$txt['hooks_title_list'] = 'Integration Hooks';
+$txt['hooks_field_hook_name'] = 'Hook Name';
+$txt['hooks_field_function_name'] = 'Function Name';
+$txt['hooks_field_function_method'] = 'Function is a method and its class is instantiated';
+$txt['hooks_field_function'] = 'Function';
+$txt['hooks_field_included_file'] = 'Included file';
+$txt['hooks_field_file_name'] = 'File Name';
+$txt['hooks_field_hook_exists'] = 'Status';
+$txt['hooks_active'] = 'Exists';
+$txt['hooks_disabled'] = 'Disabled';
+$txt['hooks_missing'] = 'Not found';
+$txt['hooks_no_hooks'] = 'There are currently no hooks in the system.';
+$txt['hooks_button_remove'] = 'Remove';
+$txt['hooks_disable_instructions'] = 'Click on the status icon to enable or disable the hook';
+$txt['hooks_disable_legend'] = 'Legend';
+$txt['hooks_disable_legend_exists'] = 'the hook exists and is active';
+$txt['hooks_disable_legend_disabled'] = 'the hook exists but has been disabled';
+$txt['hooks_disable_legend_missing'] = 'the hook has not been found';
+$txt['hooks_reset_filter'] = 'No filter';
+
+$txt['board_perms_allow'] = 'Allow';
+$txt['board_perms_ignore'] = 'Ignore';
+$txt['board_perms_deny'] = 'Deny';
+$txt['all_boards_in_cat'] = 'All boards in this category';
+
+$txt['likes_like'] = 'Membergroups allowed to like posts';
+$txt['likes_view'] = 'Membergroups allowed to view likes';
+
+$txt['mention'] = 'Membergroups allowed to mention users';
+
+$txt['notifications'] = 'Notifications';
+$txt['notify_settings'] = 'Notification Settings';
+$txt['notifications_desc'] = 'This page allows you to set the default notification options for users.';
+
 ?>
\ No newline at end of file
Only in b/Themes/default/languages: Alerts.english.php
Only in b/Themes/default/languages: Drafts.english.php
Only in b/Themes/default/languages: Editor.english.php
diff -ru a/Themes/default/languages/EmailTemplates.english.php b/Themes/default/languages/EmailTemplates.english.php
--- a/Themes/default/languages/EmailTemplates.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/EmailTemplates.english.php	2015-03-05 23:30:06.024678600 -0800
@@ -1,35 +1,33 @@
 <?php
-// Version: 2.0; EmailTemplates
+// Version: 2.1 Beta 1; EmailTemplates
 
 // Since all of these strings are being used in emails, numeric entities should be used.
 
 // Do not translate anything that is between {}, they are used as replacement variables and MUST remain exactly how they are.
-//   Additionally do not translate the @additioinal_parmas: line or the variable names in the lines that follow it.  You may
-//   translate the description of the variable.  Do not translate @description:, however you may translate the rest of that line.
+//   Additionally do not translate the @additioinal_parmas: line or the variable names in the lines that follow it. You may
+//   translate the description of the variable. Do not translate @description:, however you may translate the rest of that line.
 
 // Do not use block comments in this file, they will have special meaning.
 
-global $context, $birthdayEmails;
+global $txtBirthdayEmails;
 
 $txt['scheduled_approval_email_topic'] = 'The following topics are awaiting approval:';
 $txt['scheduled_approval_email_msg'] = 'The following posts are awaiting approval:';
 $txt['scheduled_approval_email_attach'] = 'The following attachments are awaiting approval:';
 $txt['scheduled_approval_email_event'] = 'The following events are awaiting approval:';
 
-$txt['emails'] = array(
-	'resend_activate_message' => array(
-		/*
-			@additional_params: resend_activate_message
-				REALNAME: The display name for the member receiving the email.
-				USERNAME:  The user name for the member receiving the email.
-				ACTIVATIONLINK:  The url link to activate the member's account.
-				ACTIVATIONCODE:  The code needed to activate the member's account.
-				ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
-				FORGOTPASSWORDLINK: The url to the "forgot password" page.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}. If you forget your password, you can reset it by visiting {FORGOTPASSWORDLINK}.
+/**
+	@additional_params: resend_activate_message
+		REALNAME: The display name for the member receiving the email.
+		USERNAME:  The user name for the member receiving the email.
+		ACTIVATIONLINK:  The url link to activate the member's account.
+		ACTIVATIONCODE:  The code needed to activate the member's account.
+		ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
+		FORGOTPASSWORDLINK: The url to the "forgot password" page.
+	@description:
+*/
+$txt['resend_activate_message_subject'] = 'Welcome to {FORUMNAME}';
+$txt['resend_activate_message_body'] = 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}. If you forget your password, you can reset it by visiting {FORGOTPASSWORDLINK}.
 
 Before you can login, you must first activate your account by selecting the following link:
 
@@ -37,97 +35,90 @@
 
 Should you have any problems with the activation, please visit {ACTIVATIONLINKWITHOUTCODE} and enter the code "{ACTIVATIONCODE}".
 
-{REGARDS}',
-	),
+{REGARDS}';
 
-	'resend_pending_message' => array(
-		/*
-			@additional_params: resend_pending_message
-				REALNAME: The display name for the member receiving the email.
-				USERNAME:  The user name for the member receiving the email.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Your registration request at {FORUMNAME} has been received, {REALNAME}.
+/**
+	@additional_params: resend_pending_message
+		REALNAME: The display name for the member receiving the email.
+		USERNAME:  The user name for the member receiving the email.
+	@description:
+*/
+$txt['resend_pending_message_subject'] = 'Welcome to {FORUMNAME}';
+$txt['resend_pending_message_body'] = 'Hello {REALNAME}, your registration request at {FORUMNAME} has been received.
 
 The username you registered with was {USERNAME}.
 
-Before you can login and start using the forum, your request will be reviewed and approved.  When this happens, you will receive another email from this address.
+Before you can login and start using the forum, your request will be reviewed and approved. When this happens, you will receive another email from this address.
+
+{REGARDS}';
 
-{REGARDS}',
-	),
-	'mc_group_approve' => array(
-		/*
-			@additional_params: mc_group_approve
-				USERNAME: The user name for the member receiving the email.
-				GROUPNAME: The name of the membergroup that the user was accepted into.
-			@description: The request to join a particular membergroup has been accepted.
-		*/
-		'subject' => 'Group Membership Approval',
-		'body' => '{USERNAME},
+/**
+	@additional_params: mc_group_approve
+		USERNAME: The user name for the member receiving the email.
+		GROUPNAME: The name of the membergroup that the user was accepted into.
+	@description: The request to join a particular membergroup has been accepted.
+*/
+$txt['mc_group_approve_subject'] = 'Group Membership Approval';
+$txt['mc_group_approve_body'] = '{USERNAME},
 
 We\'re pleased to notify you that your application to join the "{GROUPNAME}" group at {FORUMNAME} has been accepted, and your account has been updated to include this new membergroup.
 
-{REGARDS}',
-	),
-	'mc_group_reject' => array(
-		/*
-			@additional_params: mc_group_reject
-				USERNAME: The user name for the member receiving the email.
-				GROUPNAME: The name of the membergroup that the user was rejected from.
-			@description: The request to join a particular membergroup has been rejected.
-		*/
-		'subject' => 'Group Membership Rejection',
-		'body' => '{USERNAME},
+{REGARDS}';
+
+/**
+	@additional_params: mc_group_reject
+		USERNAME: The user name for the member receiving the email.
+		GROUPNAME: The name of the membergroup that the user was rejected from.
+	@description: The request to join a particular membergroup has been rejected.
+*/
+$txt['mc_group_reject_subject'] = 'Group Membership Rejection';
+$txt['mc_group_reject_body'] = '{USERNAME},
 
 We\'re sorry to notify you that your application to join the "{GROUPNAME}" group at {FORUMNAME} has been rejected.
 
-{REGARDS}',
-	),
-	'mc_group_reject_reason' => array(
-		/*
-			@additional_params: mc_group_reject_reason
-				USERNAME: The user name for the member receiving the email.
-				GROUPNAME: The name of the membergroup that the user was rejected from.
-				REASON: Reason for the rejection.
-			@description: The request to join a particular membergroup has been rejected with a reason given.
-		*/
-		'subject' => 'Group Membership Rejection',
-		'body' => '{USERNAME},
+{REGARDS}';
+
+/**
+	@additional_params: mc_group_reject_reason
+		USERNAME: The user name for the member receiving the email.
+		GROUPNAME: The name of the membergroup that the user was rejected from.
+		REASON: Reason for the rejection.
+	@description: The request to join a particular membergroup has been rejected with a reason given.
+*/
+$txt['mc_group_reject_reason_subject'] = 'Group Membership Rejection';
+$txt['mc_group_reject_reason_body'] = '{USERNAME},
 
 We\'re sorry to notify you that your application to join the "{GROUPNAME}" group at {FORUMNAME} has been rejected.
 
 This is due to the following reason: {REASON}
 
-{REGARDS}',
-	),
-	'admin_approve_accept' => array(
-		/*
-			@additional_params: admin_approve_accept
-				NAME: The display name of the member.
-				USERNAME: The user name for the member receiving the email.
-				PROFILELINK: The URL of the profile page.
-				FORGOTPASSWORDLINK: The URL of the "forgot password" page.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Welcome, {NAME}!
+{REGARDS}';
+
+/**
+	@additional_params: admin_approve_accept
+		NAME: The display name of the member.
+		USERNAME: The user name for the member receiving the email.
+		PROFILELINK: The URL of the profile page.
+		FORGOTPASSWORDLINK: The URL of the "forgot password" page.
+	@description:
+*/
+$txt['admin_approve_accept_subject'] = 'Welcome to {FORUMNAME}';
+$txt['admin_approve_accept_body'] = 'Welcome, {NAME}
 
 Your account has been activated manually by the admin and you can now login and post. Your username is: {USERNAME}. If you forget your password, you can change it at {FORGOTPASSWORDLINK}.
 
-{REGARDS}',
-	),
-	'admin_approve_activation' => array(
-		/*
-			@additional_params: admin_approve_activation
-				USERNAME: The user name for the member receiving the email.
-				ACTIVATIONLINK:  The url link to activate the member's account.
-				ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
-				ACTIVATIONCODE: The activation code.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Welcome, {USERNAME}!
+{REGARDS}';
+
+/**
+	@additional_params: admin_approve_activation
+		USERNAME: The user name for the member receiving the email.
+		ACTIVATIONLINK:  The url link to activate the member's account.
+		ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
+		ACTIVATIONCODE: The activation code.
+	@description:
+*/
+$txt['admin_approve_activation_subject'] = 'Welcome to {FORUMNAME}';
+$txt['admin_approve_activation_body'] = 'Welcome, {USERNAME}!
 
 Your account on {FORUMNAME} has been approved by the forum administrator. Before you can login, you must first activate your account by selecting the following link:
 
@@ -135,45 +126,42 @@
 
 Should you have any problems with the activation, please visit {ACTIVATIONLINKWITHOUTCODE} and enter the code "{ACTIVATIONCODE}".
 
-{REGARDS}',
-	),
-	'admin_approve_reject' => array(
-		/*
-			@additional_params: admin_approve_reject
-				USERNAME: The user name for the member receiving the email.
-			@description:
-		*/
-		'subject' => 'Registration Rejected',
-		'body' => '{USERNAME},
+{REGARDS}';
+
+/**
+	@additional_params: admin_approve_reject
+		USERNAME: The user name for the member receiving the email.
+	@description:
+*/
+$txt['admin_approve_reject_subject'] = 'Registration Rejected';
+$txt['admin_approve_reject_body'] = '{USERNAME},
 
 Regrettably, your application to join {FORUMNAME} has been rejected.
 
-{REGARDS}',
-	),
-	'admin_approve_delete' => array(
-		/*
-			@additional_params: admin_approve_delete
-				USERNAME: The user name for the member receiving the email.
-			@description:
-		*/
-		'subject' => 'Account Deleted',
-		'body' => '{USERNAME},
-
-Your account on {FORUMNAME} has been deleted.  This may be because you never activated your account, in which case you should be able to register again.
-
-{REGARDS}',
-	),
-	'admin_approve_remind' => array(
-		/*
-			@additional_params: admin_approve_remind
-				USERNAME: The user name for the member receiving the email.
-				ACTIVATIONLINK:  The url link to activate the member's account.
-				ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
-				ACTIVATIONCODE: The activation code.
-			@description:
-		*/
-		'subject' => 'Registration Reminder',
-		'body' => '{USERNAME},
+{REGARDS}';
+
+/**
+	@additional_params: admin_approve_delete
+		USERNAME: The user name for the member receiving the email.
+	@description:
+*/
+$txt['admin_approve_delete_subject'] = 'Account Deleted';
+$txt['admin_approve_delete_body'] = '{USERNAME},
+
+Your account on {FORUMNAME} has been deleted. This may be because you never activated your account, in which case you should be able to register again.
+
+{REGARDS}';
+
+/**
+	@additional_params: admin_approve_remind
+		USERNAME: The user name for the member receiving the email.
+		ACTIVATIONLINK:  The url link to activate the member's account.
+		ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
+		ACTIVATIONCODE: The activation code.
+	@description:
+*/
+$txt['admin_approve_remind_subject'] = 'Registration Reminder';
+$txt['admin_approve_remind_body'] = '{USERNAME},
 You still have not activated your account at {FORUMNAME}.
 
 Please use the link below to activate your account:
@@ -181,19 +169,18 @@
 
 Should you have any problems with the activation, please visit {ACTIVATIONLINKWITHOUTCODE} and enter the code "{ACTIVATIONCODE}".
 
-{REGARDS}',
-	),
-	'admin_register_activate' => array(
-		/*
-			@additional_params:
-				USERNAME: The user name for the member receiving the email.
-				ACTIVATIONLINK:  The url link to activate the member's account.
-				ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
-				ACTIVATIONCODE: The activation code.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME} and your password is {PASSWORD}.
+{REGARDS}';
+
+/**
+	@additional_params:
+		USERNAME: The user name for the member receiving the email.
+		ACTIVATIONLINK:  The url link to activate the member's account.
+		ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
+		ACTIVATIONCODE: The activation code.
+	@description:
+*/
+$txt['admin_register_activate_subject'] = 'Welcome to {FORUMNAME}';
+$txt['admin_register_activate_body'] = 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME} and your password is {PASSWORD}.
 
 Before you can login, you must first activate your account by selecting the following link:
 
@@ -201,44 +188,40 @@
 
 Should you have any problems with the activation, please visit {ACTIVATIONLINKWITHOUTCODE} and enter the code "{ACTIVATIONCODE}".
 
-{REGARDS}',
-	),
-	'admin_register_immediate' => array(
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME} and your password is {PASSWORD}.
-
-{REGARDS}',
-	),
-	'new_announcement' => array(
-		/*
-			@additional_params: new_announcement
-				TOPICSUBJECT: The subject of the topic being announced.
-				MESSAGE: The message body of the first post of the announced topic.
-				TOPICLINK: A link to the topic being announced.
-			@description:
-
-		*/
-		'subject' => 'New announcement: {TOPICSUBJECT}',
-		'body' => '{MESSAGE}
+{REGARDS}';
+
+$txt['admin_register_immediate_subject'] = 'Welcome to {FORUMNAME}';
+$txt['admin_register_immediate_body'] = 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME} and your password is {PASSWORD}.
+
+{REGARDS}';
+
+/**
+	@additional_params: new_announcement
+		TOPICSUBJECT: The subject of the topic being announced.
+		MESSAGE: The message body of the first post of the announced topic.
+		TOPICLINK: A link to the topic being announced.
+	@description:
+*/
+$txt['new_announcement_subject'] = 'New announcement: {TOPICSUBJECT}';
+$txt['new_announcement_body'] = '{MESSAGE}
 
 To unsubscribe from these announcements, login to the forum and uncheck "Receive forum announcements and important notifications by email." in your profile.
 
 You can view the full announcement by following this link:
 {TOPICLINK}
 
-{REGARDS}',
-	),
-	'notify_boards_once_body' => array(
-		/*
-			@additional_params: notify_boards_once_body
-				TOPICSUBJECT: The subject of the topic causing the notification
-				TOPICLINK: A link to the topic.
-				MESSAGE: This is the body of the message.
-				UNSUBSCRIBELINK: Link to unsubscribe from notifications.
-			@description:
-		*/
-		'subject' => 'New Topic: {TOPICSUBJECT}',
-		'body' => 'A new topic, \'{TOPICSUBJECT}\', has been made on a board you are watching.
+{REGARDS}';
+
+/**
+	@additional_params: notify_boards_once_body
+		TOPICSUBJECT: The subject of the topic causing the notification
+		TOPICLINK: A link to the topic.
+		MESSAGE: This is the body of the message.
+		UNSUBSCRIBELINK: Link to unsubscribe from notifications.
+	@description:
+*/
+$txt['notify_boards_once_body_subject'] = 'New Topic: {TOPICSUBJECT}';
+$txt['notify_boards_once_body_body'] = 'A new topic, \'{TOPICSUBJECT}\', has been made on a board you are watching.
 
 You can see it at
 {TOPICLINK}
@@ -251,18 +234,17 @@
 Unsubscribe to new topics from this board by using this link:
 {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'notify_boards_once' => array(
-		/*
-			@additional_params: notify_boards_once
-				TOPICSUBJECT: The subject of the topic causing the notification
-				TOPICLINK: A link to the topic.
-				UNSUBSCRIBELINK: Link to unsubscribe from notifications.
-			@description:
-		*/
-		'subject' => 'New Topic: {TOPICSUBJECT}',
-		'body' => 'A new topic, \'{TOPICSUBJECT}\', has been made on a board you are watching.
+{REGARDS}';
+
+/**
+	@additional_params: notify_boards_once
+		TOPICSUBJECT: The subject of the topic causing the notification
+		TOPICLINK: A link to the topic.
+		UNSUBSCRIBELINK: Link to unsubscribe from notifications.
+	@description:
+*/
+$txt['notify_boards_once_subject'] = 'New Topic: {TOPICSUBJECT}';
+$txt['notify_boards_once_body'] = 'A new topic, \'{TOPICSUBJECT}\', has been made on a board you are watching.
 
 You can see it at
 {TOPICLINK}
@@ -272,19 +254,18 @@
 Unsubscribe to new topics from this board by using this link:
 {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'notify_boards_body' => array(
-		/*
-			@additional_params: notify_boards_body
-				TOPICSUBJECT: The subject of the topic causing the notification
-				TOPICLINK: A link to the topic.
-				MESSAGE: This is the body of the message.
-				UNSUBSCRIBELINK: Link to unsubscribe from notifications.
-			@description:
-		*/
-		'subject' => 'New Topic: {TOPICSUBJECT}',
-		'body' => 'A new topic, \'{TOPICSUBJECT}\', has been made on a board you are watching.
+{REGARDS}';
+
+/**
+	@additional_params: notify_boards_body
+		TOPICSUBJECT: The subject of the topic causing the notification
+		TOPICLINK: A link to the topic.
+		MESSAGE: This is the body of the message.
+		UNSUBSCRIBELINK: Link to unsubscribe from notifications.
+	@description:
+*/
+$txt['notify_boards_body_subject'] = 'New Topic: {TOPICSUBJECT}';
+$txt['notify_boards_body_body'] = 'A new topic, \'{TOPICSUBJECT}\', has been made on a board you are watching.
 
 You can see it at
 {TOPICLINK}
@@ -295,18 +276,17 @@
 Unsubscribe to new topics from this board by using this link:
 {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'notify_boards' => array(
-		/*
-			@additional_params: notify_boards
-				TOPICSUBJECT: The subject of the topic causing the notification
-				TOPICLINK: A link to the topic.
-				UNSUBSCRIBELINK: Link to unsubscribe from notifications.
-			@description:
-		*/
-		'subject' => 'New Topic: {TOPICSUBJECT}',
-		'body' => 'A new topic, \'{TOPICSUBJECT}\', has been made on a board you are watching.
+{REGARDS}';
+
+/**
+	@additional_params: notify_boards
+		TOPICSUBJECT: The subject of the topic causing the notification
+		TOPICLINK: A link to the topic.
+		UNSUBSCRIBELINK: Link to unsubscribe from notifications.
+	@description:
+*/
+$txt['notify_boards_subject'] = 'New Topic: {TOPICSUBJECT}';
+$txt['notify_boards_body'] = 'A new topic, \'{TOPICSUBJECT}\', has been made on a board you are watching.
 
 You can see it at
 {TOPICLINK}
@@ -314,20 +294,48 @@
 Unsubscribe to new topics from this board by using this link:
 {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'request_membership' => array(
-		/*
-			@additional_params: request_membership
-				RECPNAME: The name of the person recieving the email
-				APPYNAME: The name of the person applying for group membership
-				GROUPNAME: The name of the group being applied to.
-				REASON: The reason given by the applicant for wanting to join the group.
-				MODLINK: Link to the group moderation page.
-			@description:
-		*/
-		'subject' => 'New Group Application',
-		'body' => '{RECPNAME},
+{REGARDS}';
+
+/**
+	@additional_params: alert_unapproved_reply
+		SUBJECT: The subject of the topic causing the notification
+		LINK: A link to the topic.
+	@description:
+*/
+$txt['alert_unapproved_reply_subject'] = 'Topic reply: {SUBJECT}';
+$txt['alert_unapproved_reply_body'] = 'A reply has been posted to \'{SUBJECT}\' by {POSTERNAME}.
+
+You can see it at
+{LINK}
+
+{REGARDS}';
+
+/**
+	@additional_params: alert_unapproved_post
+		SUBJECT: The subject of the topic causing the notification
+		LINK: A link to the topic.
+	@description:
+*/
+$txt['alert_unapproved_post_subject'] = 'New Unapproved Post: {SUBJECT}';
+$txt['alert_unapproved_post_body'] = 'A new post, \'{SUBJECT}\', has been made which needs approved.
+
+You can approve or reject this post by clicking the link below:
+
+{LINK}
+
+{REGARDS}';
+
+/**
+	@additional_params: request_membership
+		RECPNAME: The name of the person recieving the email
+		APPYNAME: The name of the person applying for group membership
+		GROUPNAME: The name of the group being applied to.
+		REASON: The reason given by the applicant for wanting to join the group.
+		MODLINK: Link to the group moderation page.
+	@description:
+*/
+$txt['request_membership_subject'] = 'New Group Application';
+$txt['request_membership_body'] = '{RECPNAME},
 
 {APPYNAME} has requested membership to the "{GROUPNAME}" group. The user has given the following reason:
 
@@ -337,19 +345,18 @@
 
 {MODLINK}
 
-{REGARDS}',
-	),
-	'paid_subscription_reminder' => array(
-		/*
-			@additional_params: scheduled_approval
-				REALNAME: The real (display) name of the person receiving the email.
-				PROFILE_LINK: Link to profile of member receiving email where can renew.
-				SUBSCRIPTION: Name of the subscription.
-				END_DATE: Date it expires.
-			@description:
-		*/
-		'subject' => 'Subscription about to expire at {FORUMNAME}',
-		'body' => '{REALNAME},
+{REGARDS}';
+
+/**
+	@additional_params: scheduled_approval
+		REALNAME: The real (display) name of the person receiving the email.
+		PROFILE_LINK: Link to profile of member receiving email where can renew.
+		SUBSCRIPTION: Name of the subscription.
+		END_DATE: Date it expires.
+	@description:
+*/
+$txt['paid_subscription_reminder_subject'] = 'Subscription about to expire at {FORUMNAME}';
+$txt['paid_subscription_reminder_body'] = '{REALNAME},
 
 A subscription you are subscribed to at {FORUMNAME} is about to expire. If when you took out the subscription you selected to auto-renew you need take no action - otherwise you may wish to consider subscribing once more. Details are below:
 
@@ -359,70 +366,49 @@
 To edit your subscriptions visit the following URL:
 {PROFILE_LINK}
 
-{REGARDS}',
-	),
-	'activate_reactivate' => array(
-		/*
-			@additional_params: activate_reactivate
-				ACTIVATIONLINK:  The url link to reactivate the member's account.
-				ACTIVATIONCODE:  The code needed to reactivate the member's account.
-				ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
-			@description:
-		*/
-		'subject' => 'Welcome back to {FORUMNAME}',
-		'body' => 'In order to re-validate your email address, your account has been deactivated.  Click the following link to activate it again:
+{REGARDS}';
+
+/**
+	@additional_params: activate_reactivate
+		ACTIVATIONLINK:  The url link to reactivate the member's account.
+		ACTIVATIONCODE:  The code needed to reactivate the member's account.
+		ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
+	@description:
+*/
+$txt['activate_reactivate_subject'] = 'Welcome back to {FORUMNAME}';
+$txt['activate_reactivate_body'] = 'In order to re-validate your email address, your account has been deactivated. Click the following link to activate it again:
 {ACTIVATIONLINK}
 
 Should you have any problems with activation, please visit {ACTIVATIONLINKWITHOUTCODE} and use the code "{ACTIVATIONCODE}".
 
-{REGARDS}',
-	),
-	'forgot_password' => array(
-		/*
-			@additional_params: forgot_password
-				REALNAME: The real (display) name of the person receiving the reminder.
-				REMINDLINK: The link to reset the password.
-				IP: The IP address of the requester.
-				MEMBERNAME:
-			@description:
-		*/
-		'subject' => 'New password for {FORUMNAME}',
-		'body' => 'Dear {REALNAME},
+{REGARDS}';
+
+/**
+	@additional_params: forgot_password
+		REALNAME: The real (display) name of the person receiving the reminder.
+		REMINDLINK: The link to reset the password.
+		IP: The IP address of the requester.
+		MEMBERNAME:
+	@description:
+*/
+$txt['forgot_password_subject'] = 'New password for {FORUMNAME}';
+$txt['forgot_password_body'] = 'Dear {REALNAME},
 This mail was sent because the \'forgot password\' function has been applied to your account. To set a new password, click the following link:
 {REMINDLINK}
 
 IP: {IP}
 Username: {MEMBERNAME}
 
-{REGARDS}',
-	),
-	'forgot_openid' => array(
-		/*
-			@additional_params: forgot_password
-				REALNAME: The real (display) name of the person receiving the reminder.
-				IP: The IP address of the requester.
-				OPENID: The members OpenID identity.
-			@description:
-		*/
-		'subject' => 'OpenID reminder for {FORUMNAME}',
-		'body' => 'Dear {REALNAME},
-This mail was sent because the \'forgot OpenID\' function has been applied to your account. Below is the OpenID that your account is associated with:
-{OPENID}
-
-IP: {IP}
-Username: {MEMBERNAME}
+{REGARDS}';
 
-{REGARDS}',
-	),
-	'scheduled_approval' => array(
-		/*
-			@additional_params: scheduled_approval
-				REALNAME: The real (display) name of the person receiving the email.
-				BODY: The generated body of the mail.
-			@description:
-		*/
-		'subject' => 'Summary of posts awaiting approval at {FORUMNAME}',
-		'body' => '{REALNAME},
+/**
+	@additional_params: scheduled_approval
+		REALNAME: The real (display) name of the person receiving the email.
+		BODY: The generated body of the mail.
+	@description:
+*/
+$txt['scheduled_approval_subject'] = 'Summary of posts awaiting approval at {FORUMNAME}';
+$txt['scheduled_approval_body'] = '{REALNAME},
 
 This email contains a summary of all items awaiting approval at {FORUMNAME}.
 
@@ -431,93 +417,103 @@
 Please log in to the forum to review these items.
 {SCRIPTURL}
 
-{REGARDS}',
-	),
-	'send_topic' => array(
-		/*
-			@additional_params: send_topic
-				TOPICSUBJECT: The subject of the topic being sent.
-				SENDERNAME: The name of the member sending the topic.
-				RECPNAME: The name of the person receiving the email.
-				TOPICLINK: A link to the topic being sent.
-			@description:
-		*/
-		'subject' => 'Topic: {TOPICSUBJECT} (From: {SENDERNAME})',
-		'body' => 'Dear {RECPNAME},
-I want you to check out "{TOPICSUBJECT}" on {FORUMNAME}.  To view it, please click this link:
-
-{TOPICLINK}
+{REGARDS}';
 
-Thanks,
+/**
+	@additional_params: send_email
+		EMAILSUBJECT: The subject the user wants to email.
+		EMAILBODY: The body the user wants to email.
+		SENDERNAME: The name of the member sending the email.
+		RECPNAME: The name of the person receiving the email.
+	@description:
+*/
+$txt['send_email_subject'] = '{EMAILSUBJECT}';
+$txt['send_email_body'] = '{EMAILBODY}';
 
-{SENDERNAME}',
-	),
-	'send_topic_comment' => array(
-		/*
-			@additional_params: send_topic_comment
-				TOPICSUBJECT: The subject of the topic being sent.
-				SENDERNAME: The name of the member sending the topic.
-				RECPNAME: The name of the person receiving the email.
-				TOPICLINK: A link to the topic being sent.
-				COMMENT: A comment left by the sender.
-			@description:
-		*/
-		'subject' => 'Topic: {TOPICSUBJECT} (From: {SENDERNAME})',
-		'body' => 'Dear {RECPNAME},
-I want you to check out "{TOPICSUBJECT}" on {FORUMNAME}.  To view it, please click this link:
+/**
+	@additional_params: report_to_moderator
+		TOPICSUBJECT: The subject of the reported post.
+		POSTERNAME: The reported post's author's name.
+		REPORTERNAME: The name of the person reporting the post.
+		TOPICLINK: The url of the post that is being reported.
+		REPORTLINK: The url of the moderation center report.
+		COMMENT: The comment left by the reporter, hopefully to explain why they are reporting the post.
+	@description: When a user reports a post this email is sent out to moderators and admins of that board.
+*/
+$txt['report_to_moderator_subject'] = 'Reported post: {TOPICSUBJECT} by {POSTERNAME}';
+$txt['report_to_moderator_body'] = 'The following post, "{TOPICSUBJECT}" by {POSTERNAME} has been reported by {REPORTERNAME} on a board you moderate:
 
-{TOPICLINK}
+The topic: {TOPICLINK}
+Moderation center: {REPORTLINK}
 
-A comment has also been added regarding this topic:
+The reporter has made the following comment:
 {COMMENT}
 
-Thanks,
+{REGARDS}';
+
+/**
+	@additional_params: report_to_moderator
+		TOPICSUBJECT: The subject of the reported post.
+		POSTERNAME: The reported post's author's name.
+		COMMENTERNAME: The name of the person who replied to the report.
+		TOPICLINK: The url of the post that is being reported.
+		REPORTLINK: The url of the moderation center report.
+	@description: When a moderator replies to a moderation report, this can be sent to the other moderators who previously replied.
+*/
+$txt['reply_to_moderator_subject'] = 'Follow-up to reported post: {TOPICSUBJECT} by {POSTERNAME}';
+$txt['reply_to_moderator_body'] = 'Previously, "{TOPICSUBJECT}" was reported to moderators.
 
-{SENDERNAME}',
-	),
-	'send_email' => array(
-		/*
-			@additional_params: send_email
-				EMAILSUBJECT: The subject the user wants to email.
-				EMAILBODY: The body the user wants to email.
-				SENDERNAME: The name of the member sending the email.
-				RECPNAME: The name of the person receiving the email.
-			@description:
-		*/
-		'subject' => '{EMAILSUBJECT}',
-		'body' => '{EMAILBODY}',
-	),
-	'report_to_moderator' => array(
-		/*
-			@additional_params: report_to_moderator
-				TOPICSUBJECT: The subject of the reported post.
-				POSTERNAME: The report post's author's name.
-				REPORTERNAME: The name of the person reporting the post.
-				TOPICLINK: The url of the post that is being reported.
-				REPORTLINK: The url of the moderation center report.
-				COMMENT: The comment left by the reporter, hopefully to explain why they are reporting the post.
-			@description: When a user reports a post this email is sent out to moderators and admins of that board.
-		*/
-		'subject' => 'Reported post: {TOPICSUBJECT} by {POSTERNAME}',
-		'body' => 'The following post, "{TOPICSUBJECT}" by {POSTERNAME} has been reported by {REPORTERNAME} on a board you moderate:
+Since then, {COMMENTERNAME} has added a comment to the report. More information can be found in the forum.
 
 The topic: {TOPICLINK}
 Moderation center: {REPORTLINK}
 
+{REGARDS}';
+
+/**
+	@additional_params: report_user_profile
+		MEMBERNAME: The display name of the reported user
+		REPORTERNAME: The name of the person reporting the profile
+		PROFILELINK: The link to the profile that was reported
+		COMMENT: The comment left by the reporter.
+ 	@description: When a user's profile is reported
+*/
+$txt['report_member_profile_subject'] = 'Reported profile: {MEMBERNAME}';
+$txt['report_member_profile_body'] = 'The profile of "{MEMBERNAME}" has been reported by {REPORTERNAME}.
+
+The profile: {PROFILELINK}
+Moderation center: {REPORTLINK}
+
 The reporter has made the following comment:
 {COMMENT}
 
-{REGARDS}',
-	),
-	'change_password' => array(
-		/*
-			@additional_params: change_password
-				USERNAME: The user name for the member receiving the email.
-				PASSWORD: The password for the member.
-			@description:
-		*/
-		'subject' => 'New Password Details',
-		'body' => 'Hey, {USERNAME}!
+{REGARDS}';
+
+/**
+	@additional_params: report_user_profile
+		MEMBERNAME: The display name of the reported user
+		COMMENTERNAME: The name of the person who added the comment
+		PROFILELINK: The link to the profile that was reported
+ 	@description: When someone replies to a report about a profile, this can be sent to others who replied
+*/
+$txt['reply_to_member_report_subject'] = 'Follow-up to reported profile: {MEMBERNAME}';
+$txt['reply_to_member_report_body'] = 'Previously, the profile of {MEMBERNAME} was reported.
+
+Since then, {COMMENTERNAME} has added a comment to the report. More information can be found in the forum.
+
+The profile: {PROFILELINK}
+Moderation center: {REPORTLINK}
+
+{REGARDS}';
+
+/**
+	@additional_params: change_password
+		USERNAME: The user name for the member receiving the email.
+		PASSWORD: The password for the member.
+	@description:
+*/
+$txt['change_password_subject'] = 'New Password Details';
+$txt['change_password_body'] = 'Dear, {USERNAME}
 
 Your login details at {FORUMNAME} have been changed and your password reset. Below are your new login details.
 
@@ -526,196 +522,106 @@
 You may change it after you login by going to the profile page, or by visiting this page after you login:
 {SCRIPTURL}?action=profile
 
-{REGARDS}',
-	),
-	'register_activate' => array(
-		/*
-			@additional_params: register_activate
-				REALNAME: The display name for the member receiving the email.
-				USERNAME: The user name for the member receiving the email.
-				PASSWORD: The password for the member.
-				ACTIVATIONLINK:  The url link to reactivate the member's account.
-				ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
-				ACTIVATIONCODE:  The code needed to reactivate the member's account.
-				FORGOTPASSWORDLINK: The url to the "forgot password" page.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}. If you forget your password, you can reset it by visiting {FORGOTPASSWORDLINK}.
-
-Before you can login, you first need to activate your account. To do so, please follow this link:
-
-{ACTIVATIONLINK}
+{REGARDS}';
 
-Should you have any problems with activation, please visit {ACTIVATIONLINKWITHOUTCODE} use the code "{ACTIVATIONCODE}".
-
-{REGARDS}',
-	),
-	'register_openid_activate' => array(
-		/*
-			@additional_params: register_activate
-				REALNAME: The display name for the member receiving the email.
-				USERNAME: The user name for the member receiving the email.
-				OPENID: The openID identity for the member.
-				ACTIVATIONLINK:  The url link to reactivate the member's account.
-				ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
-				ACTIVATIONCODE:  The code needed to reactivate the member's account.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}. You have chosen to authenticate using the following OpenID identity:
-{OPENID}
+/**
+	@additional_params: register_activate
+		REALNAME: The display name for the member receiving the email.
+		USERNAME: The user name for the member receiving the email.
+		PASSWORD: The password for the member.
+		ACTIVATIONLINK:  The url link to reactivate the member's account.
+		ACTIVATIONLINKWITHOUTCODE: The url to the page where the activation code can be entered.
+		ACTIVATIONCODE:  The code needed to reactivate the member's account.
+		FORGOTPASSWORDLINK: The url to the "forgot password" page.
+	@description:
+*/
+$txt['register_activate_subject'] = 'Welcome to {FORUMNAME}';
+$txt['register_activate_body'] = 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}. If you forget your password, you can reset it by visiting {FORGOTPASSWORDLINK}.
 
 Before you can login, you first need to activate your account. To do so, please follow this link:
 
 {ACTIVATIONLINK}
 
-Should you have any problems with activation, please visit {ACTIVATIONLINKWITHOUTCODE} and use the code "{ACTIVATIONCODE}".
-
-{REGARDS}',
-	),
-	'register_coppa' => array(
-		/*
-			@additional_params: register_coppa
-				REALNAME: The display name for the member receiving the email.
-				USERNAME: The user name for the member receiving the email.
-				PASSWORD: The password for the member.
-				COPPALINK:  The url link to the coppa form.
-				FORGOTPASSWORDLINK: The url to the "forgot password" page.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}. If you forget your password, you can change it at {FORGOTPASSWORDLINK}
-
-Before you can login, the admin requires consent from your parent/guardian for you to join the community. You can obtain more information at the link below:
-
-{COPPALINK}
+Should you have any problems with activation, please visit {ACTIVATIONLINKWITHOUTCODE} use the code "{ACTIVATIONCODE}".
 
-{REGARDS}',
-	),
-	'register_openid_coppa' => array(
-		/*
-			@additional_params: register_coppa
-				REALNAME: The display name for the member receiving the email.
-				USERNAME: The user name for the member receiving the email.
-				OPENID: The openID identity for the member.
-				COPPALINK:  The url link to the coppa form.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}.
+{REGARDS}';
 
-You have chosen to authenticate using the following OpenID identity:
-{OPENID}
+/**
+	@additional_params: register_coppa
+		REALNAME: The display name for the member receiving the email.
+		USERNAME: The user name for the member receiving the email.
+		PASSWORD: The password for the member.
+		COPPALINK:  The url link to the coppa form.
+		FORGOTPASSWORDLINK: The url to the "forgot password" page.
+	@description:
+*/
+$txt['register_coppa_subject'] = 'Welcome to {FORUMNAME}';
+$txt['register_coppa_body'] = 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}. If you forget your password, you can change it at {FORGOTPASSWORDLINK}
 
 Before you can login, the admin requires consent from your parent/guardian for you to join the community. You can obtain more information at the link below:
 
 {COPPALINK}
 
-{REGARDS}',
-	),
-	'register_immediate' => array(
-		/*
-			@additional_params: register_immediate
-				REALNAME: The display name for the member receiving the email.
-				USERNAME: The user name for the member receiving the email.
-				PASSWORD: The password for the member.
-				FORGOTPASSWORDLINK: The url to the "forgot password" page.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}. If you forget your password, you may change it at {FORGOTPASSWORDLINK}.
-
-{REGARDS}',
-	),
-	'register_openid_immediate' => array(
-		/*
-			@additional_params: register_immediate
-				REALNAME: The display name for the member receiving the email.
-				USERNAME: The user name for the member receiving the email.
-				OPENID: The openID identity for the member.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}.
+{REGARDS}';
 
-You have chosen to authenticate using the following OpenID identity:
-{OPENID}
-
-You may update your profile by visiting this page after you login:
+/**
+	@additional_params: register_immediate
+		REALNAME: The display name for the member receiving the email.
+		USERNAME: The user name for the member receiving the email.
+		PASSWORD: The password for the member.
+		FORGOTPASSWORDLINK: The url to the "forgot password" page.
+	@description:
+*/
+$txt['register_immediate_subject'] = 'Welcome to {FORUMNAME}';
+$txt['register_immediate_body'] = 'Thank you for registering at {FORUMNAME}. Your username is {USERNAME}. If you forget your password, you may change it at {FORGOTPASSWORDLINK}.
 
-{SCRIPTURL}?action=profile
+{REGARDS}';
 
-{REGARDS}',
-	),
-	'register_pending' => array(
-		/*
-			@additional_params: register_pending
-				REALNAME: The display name for the member receiving the email.
-				USERNAME: The user name for the member receiving the email.
-				PASSWORD: The password for the member.
-				FORGOTPASSWORDLINK: The url to the "forgot password" page.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Your registration request at {FORUMNAME} has been received, {REALNAME}.
+/**
+	@additional_params: register_pending
+		REALNAME: The display name for the member receiving the email.
+		USERNAME: The user name for the member receiving the email.
+		PASSWORD: The password for the member.
+		FORGOTPASSWORDLINK: The url to the "forgot password" page.
+	@description:
+*/
+$txt['register_pending_subject'] = 'Welcome to {FORUMNAME}';
+$txt['register_pending_body'] = 'Hello {REALNAME}, your registration request at {FORUMNAME} has been received.
 
 The username you registered with was {USERNAME}. If you forget your password, you can change it at {FORGOTPASSWORDLINK}.
 
-Before you can login and start using the forum, your request will be reviewed and approved.  When this happens, you will receive another email from this address.
-
-{REGARDS}',
-	),
-	'register_openid_pending' => array(
-		/*
-			@additional_params: register_pending
-				REALNAME: The display name for the member receiving the email.
-				USERNAME: The user name for the member receiving the email.
-				OPENID: The openID identity for the member.
-			@description:
-		*/
-		'subject' => 'Welcome to {FORUMNAME}',
-		'body' => 'Your registration request at {FORUMNAME} has been received, {REALNAME}.
+Before you can login and start using the forum, your request will be reviewed and approved. When this happens, you will receive another email from this address.
 
-The username you registered with was {USERNAME}.
-
-You have chosen to authenticate using the following OpenID identity:
-{OPENID}
-
-Before you can login and start using the forum, your request will be reviewed and approved.  When this happens, you will receive another email from this address.
+{REGARDS}';
 
-{REGARDS}',
-	),
-	'notification_reply' => array(
-		/*
-			@additional_params: notification_reply
-				TOPICSUBJECT:
-				POSTERNAME:
-				TOPICLINK:
-				UNSUBSCRIBELINK:
-			@description:
-		*/
-		'subject' => 'Topic reply: {TOPICSUBJECT}',
-		'body' => 'A reply has been posted to a topic you are watching by {POSTERNAME}.
+/**
+	@additional_params: notification_reply
+		TOPICSUBJECT:
+		POSTERNAME:
+		TOPICLINK:
+		UNSUBSCRIBELINK:
+	@description:
+*/
+$txt['notification_reply_subject'] = 'Topic reply: {TOPICSUBJECT}';
+$txt['notification_reply_body'] = 'A reply has been posted to a topic you are watching by {POSTERNAME}.
 
 View the reply at: {TOPICLINK}
 
 Unsubscribe to this topic by using this link: {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'notification_reply_body' => array(
-		/*
-			@additional_params: notification_reply_body
-				TOPICSUBJECT:
-				POSTERNAME:
-				TOPICLINK:
-				UNSUBSCRIBELINK:
-				MESSAGE:
-			@description:
-		*/
-		'subject' => 'Topic reply: {TOPICSUBJECT}',
-		'body' => 'A reply has been posted to a topic you are watching by {POSTERNAME}.
+{REGARDS}';
+
+/**
+	@additional_params: notification_reply_body
+		TOPICSUBJECT:
+		POSTERNAME:
+		TOPICLINK:
+		UNSUBSCRIBELINK:
+		MESSAGE:
+	@description:
+*/
+$txt['notification_reply_body_subject'] = 'Topic reply: {TOPICSUBJECT}';
+$txt['notification_reply_body_body'] = 'A reply has been posted to a topic you are watching by {POSTERNAME}.
 
 View the reply at: {TOPICLINK}
 
@@ -724,19 +630,18 @@
 The text of the reply is shown below:
 {MESSAGE}
 
-{REGARDS}',
-	),
-	'notification_reply_once' => array(
-		/*
-			@additional_params: notification_reply_once
-				TOPICSUBJECT:
-				POSTERNAME:
-				TOPICLINK:
-				UNSUBSCRIBELINK:
-			@description:
-		*/
-		'subject' => 'Topic reply: {TOPICSUBJECT}',
-		'body' => 'A reply has been posted to a topic you are watching by {POSTERNAME}.
+{REGARDS}';
+
+/**
+	@additional_params: notification_reply_once
+		TOPICSUBJECT:
+		POSTERNAME:
+		TOPICLINK:
+		UNSUBSCRIBELINK:
+	@description:
+*/
+$txt['notification_reply_once_subject'] = 'Topic reply: {TOPICSUBJECT}';
+$txt['notification_reply_once_body'] = 'A reply has been posted to a topic you are watching by {POSTERNAME}.
 
 View the reply at: {TOPICLINK}
 
@@ -744,20 +649,19 @@
 
 More replies may be posted, but you won\'t receive any more notifications until you read the topic.
 
-{REGARDS}',
-	),
-	'notification_reply_body_once' => array(
-		/*
-			@additional_params: notification_reply_body_once
-				TOPICSUBJECT:
-				POSTERNAME:
-				TOPICLINK:
-				UNSUBSCRIBELINK:
-				MESSAGE:
-			@description:
-		*/
-		'subject' => 'Topic reply: {TOPICSUBJECT}',
-		'body' => 'A reply has been posted to a topic you are watching by {POSTERNAME}.
+{REGARDS}';
+
+/**
+	@additional_params: notification_reply_body_once
+		TOPICSUBJECT:
+		POSTERNAME:
+		TOPICLINK:
+		UNSUBSCRIBELINK:
+		MESSAGE:
+	@description:
+*/
+$txt['notification_reply_body_once_subject'] = 'Topic reply: {TOPICSUBJECT}';
+$txt['notification_reply_body_once_body'] = 'A reply has been posted to a topic you are watching by {POSTERNAME}.
 
 View the reply at: {TOPICLINK}
 
@@ -768,160 +672,149 @@
 
 More replies may be posted, but you won\'t receive any more notifications until you read the topic.
 
-{REGARDS}',
-	),
-	'notification_sticky' => array(
-		/*
-			@additional_params: notification_sticky
-			@description:
-		*/
-		'subject' => 'Topic stickied: {TOPICSUBJECT}',
-		'body' => 'A topic you are watching has been marked as a sticky topic by {POSTERNAME}.
+{REGARDS}';
+
+/**
+	@additional_params: notification_sticky
+	@description:
+*/
+$txt['notification_sticky_subject'] = 'Topic stickied: {TOPICSUBJECT}';
+$txt['notification_sticky_body'] = 'A topic you are watching has been marked as a sticky topic.
 
 View the topic at: {TOPICLINK}
 
 Unsubscribe to this topic by using this link: {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'notification_lock' => array(
-		/*
-			@additional_params: notification_lock
-			@description:
-		*/
-		'subject' => 'Topic locked: {TOPICSUBJECT}',
-		'body' => 'A topic you are watching has been locked by {POSTERNAME}.
+{REGARDS}';
+
+/**
+	@additional_params: notification_lock
+	@description:
+*/
+$txt['notification_lock_subject'] = 'Topic locked: {TOPICSUBJECT}';
+$txt['notification_lock_body'] = 'A topic you are watching has been locked.
 
 View the topic at: {TOPICLINK}
 
 Unsubscribe to this topic by using this link: {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'notification_unlock' => array(
-		/*
-			@additional_params: notification_unlock
-			@description:
-		*/
-		'subject' => 'Topic unlocked: {TOPICSUBJECT}',
-		'body' => 'A topic you are watching has been unlocked by {POSTERNAME}.
+{REGARDS}';
+
+/**
+	@additional_params: notification_unlock
+	@description:
+*/
+$txt['notification_unlock_subject'] = 'Topic unlocked: {TOPICSUBJECT}';
+$txt['notification_unlock_body'] = 'A topic you are watching has been unlocked.
 
 View the topic at: {TOPICLINK}
 
 Unsubscribe to this topic by using this link: {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'notification_remove' => array(
-		/*
-			@additional_params: notification_remove
-			@description:
-		*/
-		'subject' => 'Topic removed: {TOPICSUBJECT}',
-		'body' => 'A topic you are watching has been removed by {POSTERNAME}.
-
-{REGARDS}',
-	),
-	'notification_move' => array(
-		/*
-			@additional_params: notification_move
-			@description:
-		*/
-		'subject' => 'Topic moved: {TOPICSUBJECT}',
-		'body' => 'A topic you are watching has been moved to another board by {POSTERNAME}.
+{REGARDS}';
+
+/**
+	@additional_params: notification_remove
+	@description:
+*/
+$txt['notification_remove_subject'] = 'Topic removed: {TOPICSUBJECT}';
+$txt['notification_remove_body'] = 'A topic you are watching has been removed.
+
+{REGARDS}';
+
+/**
+	@additional_params: notification_move
+	@description:
+*/
+$txt['notification_move_subject'] = 'Topic moved: {TOPICSUBJECT}';
+$txt['notification_move_body'] = 'A topic you are watching has been moved to another board.
 
 View the topic at: {TOPICLINK}
 
 Unsubscribe to this topic by using this link: {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'notification_merge' => array(
-		/*
-			@additional_params: notification_merged
-			@description:
-		*/
-		'subject' => 'Topic merged: {TOPICSUBJECT}',
-		'body' => 'A topic you are watching has been merged with another topic by {POSTERNAME}.
+{REGARDS}';
+
+/**
+	@additional_params: notification_merged
+	@description:
+*/
+$txt['notification_merge_subject'] = 'Topic merged: {TOPICSUBJECT}';
+$txt['notification_merge_body'] = 'A topic you are watching has been merged with another topic.
 
 View the new merged topic at: {TOPICLINK}
 
 Unsubscribe to this topic by using this link: {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'notification_split' => array(
-		/*
-			@additional_params: notification_split
-			@description:
-		*/
-		'subject' => 'Topic split: {TOPICSUBJECT}',
-		'body' => 'A topic you are watching has been split into two or more topics by {POSTERNAME}.
+{REGARDS}';
+
+/**
+	@additional_params: notification_split
+	@description:
+*/
+$txt['notification_split_subject'] = 'Topic split: {TOPICSUBJECT}';
+$txt['notification_split_body'] = 'A topic you are watching has been split into two or more topics.
 
 View what remains of this topic at: {TOPICLINK}
 
 Unsubscribe to this topic by using this link: {UNSUBSCRIBELINK}
 
-{REGARDS}',
-	),
-	'admin_notify' => array(
-		/*
-			@additional_params: admin_notify
-				USERNAME:
-				PROFILELINK:
-			@description:
-		*/
-		'subject' => 'A new member has joined',
-		'body' => '{USERNAME} has just signed up as a new member of your forum. Click the link below to view their profile.
+{REGARDS}';
+
+/**
+	@additional_params: admin_notify
+		USERNAME:
+		PROFILELINK:
+	@description:
+*/
+$txt['admin_notify_subject'] = 'A new member has joined';
+$txt['admin_notify_body'] = '{USERNAME} has just signed up as a new member of your forum. Click the link below to view their profile.
 {PROFILELINK}
 
-{REGARDS}',
-	),
-	'admin_notify_approval' => array(
-		/*
-			@additional_params: admin_notify_approval
-				USERNAME:
-				PROFILELINK:
-				APPROVALLINK:
-			@description:
-		*/
-		'subject' => 'A new member has joined',
-		'body' => '{USERNAME} has just signed up as a new member of your forum. Click the link below to view their profile.
+{REGARDS}';
+
+/**
+	@additional_params: admin_notify_approval
+		USERNAME:
+		PROFILELINK:
+		APPROVALLINK:
+	@description:
+*/
+$txt['admin_notify_approval_subject'] = 'A new member has joined';
+$txt['admin_notify_approval_body'] = '{USERNAME} has just signed up as a new member of your forum. Click the link below to view their profile.
 {PROFILELINK}
 
 Before this member can begin posting they must first have their account approved. Click the link below to go to the approval screen.
 {APPROVALLINK}
 
-{REGARDS}',
-	),
-	'admin_attachments_full' => array(
-		/*
-			@additional_params: admin_attachments_full
-				REALNAME:
-			@description:
-		*/
-		'subject' => 'Urgent! Attachments folder almost full',
-		'body' => '{REALNAME},
-
-The attachments folder at {FORUMNAME} is almost full. Please visit the forum to resolve this problem.
-
-Once the attachments folder reaches it\'s maximum permitted size users will not be able to continue to post attachments or upload custom avatars (If enabled).
-
-{REGARDS}',
-	),
-	'paid_subscription_refund' => array(
-		/*
-			@additional_params: paid_subscription_refund
-				NAME: Subscription title.
-				REALNAME: Recipients name
-				REFUNDUSER: Username who took out the subscription.
-				REFUNDNAME: User's display name who took out the subscription.
-				DATE: Today's date.
-				PROFILELINK: Link to members profile.
-			@description:
-		*/
-		'subject' => 'Refunded Paid Subscription',
-		'body' => '{REALNAME},
+{REGARDS}';
+
+/**
+	@additional_params: admin_attachments_full
+		REALNAME:
+	@description:
+*/
+$txt['admin_attachments_full_subject'] = 'Urgent! Attachments directory almost full';
+$txt['admin_attachments_full_body'] = '{REALNAME},
+
+The attachments directory at {FORUMNAME} is almost full. Please visit the forum to resolve this problem.
+
+Once the attachments directory reaches it\'s maximum permitted size users will not be able to continue to post attachments or upload custom avatars (If enabled).
+
+{REGARDS}';
+
+/**
+	@additional_params: paid_subscription_refund
+		NAME: Subscription title.
+		REALNAME: Recipients name
+		REFUNDUSER: Username who took out the subscription.
+		REFUNDNAME: User's display name who took out the subscription.
+		DATE: Today's date.
+		PROFILELINK: Link to members profile.
+	@description:
+*/
+$txt['paid_subscription_refund_subject'] = 'Refunded Paid Subscription';
+$txt['paid_subscription_refund_body'] = '{REALNAME},
 
 A member has received a refund on a paid subscription. Below are the details of this subscription:
 
@@ -932,22 +825,21 @@
 You can view this members profile by clicking the link below:
 {PROFILELINK}
 
-{REGARDS}',
-	),
-	'paid_subscription_new' => array(
-		/*
-			@additional_params: paid_subscription_new
-				NAME: Subscription title.
-				REALNAME: Recipients name
-				SUBEMAIL: Email address of the user who took out the subscription
-				SUBUSER: Username who took out the subscription.
-				SUBNAME: User's display name who took out the subscription.
-				DATE: Today's date.
-				PROFILELINK: Link to members profile.
-			@description:
-		*/
-		'subject' => 'New Paid Subscription',
-		'body' => '{REALNAME},
+{REGARDS}';
+
+/**
+	@additional_params: paid_subscription_new
+		NAME: Subscription title.
+		REALNAME: Recipients name
+		SUBEMAIL: Email address of the user who took out the subscription
+		SUBUSER: Username who took out the subscription.
+		SUBNAME: User's display name who took out the subscription.
+		DATE: Today's date.
+		PROFILELINK: Link to members profile.
+	@description:
+*/
+$txt['paid_subscription_new_subject'] = 'New Paid Subscription';
+$txt['paid_subscription_new_body'] = '{REALNAME},
 
 A member has taken out a new paid subscription. Below are the details of this subscription:
 
@@ -960,44 +852,144 @@
 You can view this members profile by clicking the link below:
 {PROFILELINK}
 
-{REGARDS}',
-	),
-	'paid_subscription_error' => array(
-		/*
-			@additional_params: paid_subscription_error
-				ERROR: Error message.
-				REALNAME: Recipients name
-			@description:
-		*/
-		'subject' => 'Paid Subscription Error Occurred',
-		'body' => '{REALNAME},
+{REGARDS}';
+
+/**
+	@additional_params: paid_subscription_error
+		ERROR: Error message.
+		REALNAME: Recipients name
+	@description:
+*/
+$txt['paid_subscription_error_subject'] = 'Paid Subscription Error Occurred';
+$txt['paid_subscription_error_body'] = 'Dear, {REALNAME},
 
 The following error occurred when processing a paid subscription
 ---------------------------------------------------------------
 {ERROR}
 
-{REGARDS}',
-	),
-);
+{REGARDS}';
+
+/**
+	@additional_params: new_pm
+		SUBJECT: The personal message subject.
+		SENDER:  The user name for the member sending the personal message.
+		READLINK:  The link to directly access the read page.
+		REPLYLINK:  The link to directly access the reply page.
+	@description: A notification email sent to the receivers of a personal message
+*/
+$txt['new_pm_subject'] = 'New Personal Message: {SUBJECT}';
+$txt['new_pm_body'] = 'You have just been sent a personal message by {SENDER} on {FORUMNAME}
+
+IMPORTANT: Remember, this is just a notification. Please do not reply to this email.
+
+Read this Personal Message here: {READLINK}
+
+Reply to this Personal Message here: {REPLYLINK}';
+
+/**
+	@additional_params: new_pm_body
+		SUBJECT: The personal message subject.
+		SENDER:  The user name for the member sending the personal message.
+		MESSAGE:  The text of the personal message.
+		REPLYLINK:  The link to directly access the reply page.
+	@description: A notification email sent to the receivers of a personal message
+*/
+$txt['new_pm_body_subject'] = 'New Personal Message: {SUBJECT}';
+$txt['new_pm_body_body'] = 'You have just been sent a personal message by {SENDER} on {FORUMNAME}
+
+IMPORTANT: Remember, this is just a notification. Please do not reply to this email.
+
+The message they sent you was:
+
+{MESSAGE}
+
+Reply to this Personal Message here: {REPLYLINK}';
+
+/**
+	@additional_params: new_pm_tolist
+		SUBJECT: The personal message subject.
+		SENDER:  The user name for the member sending the personal message.
+		READLINK:  The link to directly access the read page.
+		REPLYLINK:  The link to directly access the reply page.
+		TOLIST:  The list of users that will receive the personal message.
+	@description: A notification email sent to the receivers of a personal message
+*/
+$txt['new_pm_tolist_subject'] = 'New Personal Message: {SUBJECT}';
+$txt['new_pm_tolist_body'] = 'You and {TOLIST} have just been sent a personal message by {SENDER} on {FORUMNAME}
+
+IMPORTANT: Remember, this is just a notification. Please do not reply to this email.
 
-/*
+Read this Personal Message here: {READLINK}
+
+Reply to this Personal Message (to the sender only) here: {REPLYLINK}';
+
+/**
+	@additional_params: new_pm_body_tolist
+		SUBJECT: The personal message subject.
+		SENDER:  The user name for the member sending the personal message.
+		MESSAGE:  The text of the personal message.
+		REPLYLINK:  The link to directly access the reply page.
+		TOLIST:  The list of users that will receive the personal message.
+	@description: A notification email sent to the receivers of a personal message
+*/
+$txt['new_pm_body_tolist_subject'] = 'New Personal Message: {SUBJECT}';
+$txt['new_pm_body_tolist_body'] = 'You and {TOLIST} have just been sent a personal message by {SENDER} on {FORUMNAME}
+
+IMPORTANT: Remember, this is just a notification. Please do not reply to this email.
+
+The message they sent you was:
+
+{MESSAGE}
+
+Reply to this Personal Message (to the sender only) here: {REPLYLINK}';
+
+/**
+	@additional_params: msg_quote
+		CONTENTSUBJECT: The post subject.
+		QUOTENAME:  The user name for the member creating the quote
+		MEMBERNAME:  The user name for the member being quoted
+		CONTENTLINK:  The post's link
+	@description: A notification email sent to the members who've been quoted in a post
+ */
+$txt['msg_quote_subject'] = 'You have been quoted in the post: {CONTENTSUBJECT}';
+$txt['msg_quote_body'] = 'Hello {MEMBERNAME},
+
+You have been quoted in the post titled "{CONTENTSUBJECT}" by {QUOTENAME}, you can see the post here:
+{CONTENTLINK}
+
+{REGARDS}';
+
+/**
+	@additional_params: msg_mention
+		CONTENTSUBJECT: The post subject.
+		MENTIONNAME:  The user name for the member creating the mention
+		MEMBERNAME:  The user name for the member being mentioned
+		CONTENTLINK:  The post's link
+	@description: A notification email sent to the members who've been mentioned in a post
+ */
+$txt['msg_mention_subject'] = 'You have been mentioned in the post: {CONTENTSUBJECT}';
+$txt['msg_mention_body'] = 'Hello {MEMBERNAME},
+
+You have been mentioned in the post titled "{CONTENTSUBJECT}" by {MENTIONNAME}, you can see the post here:
+{CONTENTLINK}
+
+{REGARDS}';
+
+/**
 	@additional_params: happy_birthday
 		REALNAME: The real (display) name of the person receiving the birthday message.
 	@description: A message sent to members on their birthday.
 */
-$birthdayEmails = array(
-	'happy_birthday' => array(
-		'subject' => 'Happy birthday from {FORUMNAME}.',
-		'body' => 'Dear {REALNAME},
-
-We here at {FORUMNAME} would like to wish you a happy birthday.  May this day and the year to follow be full of joy.
-
-{REGARDS}',
-		'author' => '<a href="http://www.simplemachines.org/community/?action=profile;u=2676">Thantos</a>',
-	),
-	'karlbenson1' => array(
-		'subject' => 'On your Birthday...',
-		'body' => 'We could have sent you a birthday card.  We could have sent you some flowers or a cake.
+$txtBirthdayEmails['happy_birthday_subject'] = 'Happy birthday from {FORUMNAME}.';
+$txtBirthdayEmails['happy_birthday_body'] = 'Dear {REALNAME},
+
+We here at {FORUMNAME} would like to wish you a happy birthday. May this day and the year to follow be full of joy.
+
+{REGARDS}';
+$txtBirthdayEmails['happy_birthday_author'] = '<a href="http://www.simplemachines.org/community/?action=profile;u=2676">Thantos</a>';
+
+$txtBirthdayEmails['karlbenson1_subject'] = 'On your Birthday...';
+$txtBirthdayEmails['karlbenson1_body'] = 'We could have sent you a birthday card. We could have sent you some flowers or a cake.
 
 But we didn\'t.
 
@@ -1011,31 +1003,28 @@
 
 {REGARDS}
 
-//:: This message was automatically generated :://',
-		'author' => '<a href="http://www.simplemachines.org/community/?action=profile;u=63186">karlbenson</a>',
-	),
-	'nite0859' => array(
-		'subject' => 'Happy Birthday!',
-		'body' => 'Your friends at {FORUMNAME} would like to take a moment of your time to wish you a happy birthday, {REALNAME}. If you have not done so recently, please visit our community in order for others to have the opportunity to pass along their warm regards.
+//:: This message was automatically generated :://';
+$txtBirthdayEmails['karlbenson1_author'] = '<a href="http://www.simplemachines.org/community/?action=profile;u=63186">karlbenson</a>';
+
+$txtBirthdayEmails['nite0859_subject'] = 'Happy Birthday!';
+$txtBirthdayEmails['nite0859_body'] = 'Your friends at {FORUMNAME} would like to take a moment of your time to wish you a happy birthday, {REALNAME}. If you have not done so recently, please visit our community in order for others to have the opportunity to pass along their warm regards.
 
 Even though today is your birthday, {REALNAME}, we would like to remind you that your membership in our community has been the best gift to us thus far.
 
 Best Wishes,
-The Staff of {FORUMNAME}',
-		'author' => '<a href="http://www.simplemachines.org/community/?action=profile;u=46625">nite0859</a>',
-	),
-	'zwaldowski' => array(
-		'subject' => 'Birthday Wishes to {REALNAME}',
-		'body' => 'Dear {REALNAME},
-
-Another year in your life has passed.  We at {FORUMNAME} hope it has been filled with happiness, and wish you luck in the coming one.
-
-{REGARDS}',
-		'author' => '<a href="http://www.simplemachines.org/community/?action=profile;u=72038">zwaldowski</a>',
-	),
-	'geezmo' => array(
-		'subject' => 'Happy birthday, {REALNAME}!',
-		'body' => 'Do you know who\'s having a birthday today, {REALNAME}?
+The Staff of {FORUMNAME}';
+$txtBirthdayEmails['nite0859_author'] = '<a href="http://www.simplemachines.org/community/?action=profile;u=46625">nite0859</a>';
+
+$txtBirthdayEmails['zwaldowski_subject'] = 'Birthday Wishes to {REALNAME}';
+$txtBirthdayEmails['zwaldowski_body'] = 'Dear {REALNAME},
+
+Another year in your life has passed. We at {FORUMNAME} hope it has been filled with happiness, and wish you luck in the coming one.
+
+{REGARDS}';
+$txtBirthdayEmails['zwaldowski_author'] = '<a href="http://www.simplemachines.org/community/?action=profile;u=72038">zwaldowski</a>';
+
+$txtBirthdayEmails['geezmo_subject'] = 'Happy birthday, {REALNAME}!';
+$txtBirthdayEmails['geezmo_body'] = 'Do you know who\'s having a birthday today, {REALNAME}?
 
 We know... YOU!
 
@@ -1045,18 +1034,15 @@
 
 Enjoy your day today, {REALNAME}!
 
-- From your {FORUMNAME} family',
-		'author' => '<a href="http://www.simplemachines.org/community/?action=profile;u=48671">geezmo</a>',
-	),
-	'karlbenson2' => array(
-		'subject' => 'Your Birthday Greeting',
-		'body' => 'We hope your birthday is the best ever cloudy, sunny or whatever the weather.
+- From your {FORUMNAME} family';
+$txtBirthdayEmails['geezmo_author'] = '<a href="http://www.simplemachines.org/community/?action=profile;u=48671">geezmo</a>';
+
+$txtBirthdayEmails['karlbenson2_subject'] = 'Your Birthday Greeting';
+$txtBirthdayEmails['karlbenson2_body'] = 'We hope your birthday is the best ever cloudy, sunny or whatever the weather.
 Have lots of birthday cake and fun, and tell us what you have done.
 
 We hope this message brought you cheer, and make it last, until same time same place, next year.
 
-{REGARDS}',
-		'author' => '<a href="http://www.simplemachines.org/community/?action=profile;u=63186">karlbenson</a>',
-	),
-);
+{REGARDS}';
+$txtBirthdayEmails['karlbenson2_author'] = '<a href="http://www.simplemachines.org/community/?action=profile;u=63186">karlbenson</a>';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Errors.english.php b/Themes/default/languages/Errors.english.php
--- a/Themes/default/languages/Errors.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Errors.english.php	2015-03-05 23:30:06.024678600 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; Errors
+// Version: 2.1 Beta 1; Errors
 
 global $scripturl, $modSettings;
 
@@ -7,15 +7,15 @@
 $txt['wireless_error_notyet'] = 'Sorry, this section isn\'t available for wireless users at this time.';
 
 $txt['mods_only'] = 'Only Moderators can use the direct remove function, please remove this message through the modify feature.';
-$txt['no_name'] = 'You didn\'t fill the name field out.  It is required.';
-$txt['no_email'] = 'You didn\'t fill the email field out.  It is required.';
+$txt['no_name'] = 'You didn\'t fill the name field out. It is required.';
+$txt['no_email'] = 'You didn\'t fill the email field out. It is required.';
 $txt['topic_locked'] = 'This topic is locked, you are not allowed to post or modify messages...';
 $txt['no_password'] = 'Password field empty';
 $txt['already_a_user'] = 'The username you tried to use already exists.';
 $txt['cant_move'] = 'You are not allowed to move topics...';
-$txt['login_to_post'] = 'To post you must be logged in. If you don\'t have an account yet, please <a href="' . $scripturl . '?action=register">register</a>.';
+$txt['login_to_post'] = 'To post you must be logged in. If you don\'t have an account yet, please <a href="' . $scripturl . '?action=signup">sign up</a>.';
 $txt['passwords_dont_match'] = 'Passwords aren\'t the same.';
-$txt['register_to_use'] = 'Sorry, you must register before using this feature.';
+$txt['register_to_use'] = 'Sorry, you must sign up before using this feature.';
 $txt['password_invalid_character'] = 'Invalid character used in password.';
 $txt['name_invalid_character'] = 'Invalid character used in name.';
 $txt['email_invalid_character'] = 'Invalid character used in email.';
@@ -23,25 +23,18 @@
 $txt['numbers_one_to_nine'] = 'This field only accepts numbers from 0-9';
 $txt['not_a_user'] = 'The user whose profile you are trying to view does not exist.';
 $txt['not_a_topic'] = 'This topic doesn\'t exist on this board.';
-$txt['not_approved_topic'] = 'This topic has not been approved yet.';
 $txt['email_in_use'] = 'That email address (%1$s) is being used by a registered member already. If you feel this is a mistake, go to the login page and use the password reminder with that address.';
+$txt['attachments_no_write'] = 'The attachments directory is not writable';
 
 $txt['didnt_select_vote'] = 'You didn\'t select a vote option.';
 $txt['poll_error'] = 'Either that poll doesn\'t exist, the poll has been locked, or you tried to vote twice.';
 $txt['members_only'] = 'This option is only available to registered members.';
-$txt['locked_by_admin'] = 'This was locked by an administrator.  You cannot unlock it.';
-$txt['not_enough_posts_karma'] = 'Sorry, you don\'t have enough posts to modify karma - you need at least %1$d.';
-$txt['cant_change_own_karma'] = 'Sorry, you are not permitted to modify your own karma.';
-$txt['karma_wait_time'] = 'Sorry, you can\'t repeat a karma action without waiting %1$s %2$s.';
+$txt['locked_by_admin'] = 'This was locked by an administrator. You cannot unlock it.';
 $txt['feature_disabled'] = 'Sorry, this feature is disabled.';
-$txt['cant_access_upload_path'] = 'Cannot access attachments upload path!';
-$txt['file_too_big'] = 'Your file is too large. The maximum attachment size allowed is %1$d KB.';
-$txt['attach_timeout'] = 'Your attachment couldn\'t be saved. This might happen because it took too long to upload or the file is bigger than the server will allow.<br /><br />Please consult your server administrator for more information.';
-$txt['filename_exists'] = 'Sorry! There is already an attachment with the same filename as the one you tried to upload. Please rename the file and try again.';
-$txt['bad_attachment'] = 'Your attachment has failed security checks and cannot be uploaded. Please consult the forum administrator.';
-$txt['ran_out_of_space'] = 'The upload folder is full. Please try a smaller file and/or contact an administrator.';
+$txt['feature_no_exists'] = 'Sorry, this feature doesn\'t exist.';
 $txt['couldnt_connect'] = 'Could not connect to server or could not find file';
 $txt['no_board'] = 'The board you specified doesn\'t exist';
+$txt['no_message'] = 'The message is no longer available';
 $txt['cant_split'] = 'You are not allowed to split topics';
 $txt['cant_merge'] = 'You are not allowed to merge topics';
 $txt['no_topic_id'] = 'You specified an invalid topic ID.';
@@ -53,11 +46,14 @@
 $txt['cant_find_user_email'] = 'Unable to find user\'s email address.';
 $txt['cant_insert_topic'] = 'Unable to insert topic';
 $txt['already_a_mod'] = 'You have chosen a username of an already existing moderator. Please choose another username';
-$txt['session_timeout'] = 'Your session timed out while posting.  Please go back and try again.';
-$txt['session_verify_fail'] = 'Session verification failed.  Please try logging out and back in again, and then try again.';
-$txt['verify_url_fail'] = 'Unable to verify referring url.  Please go back and try again.';
+$txt['session_timeout'] = 'Your session timed out while posting. Please go back and try again.';
+$txt['session_verify_fail'] = 'Session verification failed. Please try logging out and back in again, and then try again.';
+$txt['verify_url_fail'] = 'Unable to verify referring URL. Please go back and try again.';
+$txt['token_verify_fail'] = 'Token verification failed. Please go back and try again.';
 $txt['guest_vote_disabled'] = 'Guests cannot vote in this poll.';
 
+$txt['cannot_like_content'] = 'You are not able to like that content.';
+$txt['cannot_view_likes'] = 'You are not able to view who liked that content.';
 $txt['cannot_access_mod_center'] = 'You do not have permission to access the moderation center.';
 $txt['cannot_admin_forum'] = 'You are not allowed to administrate this forum.';
 $txt['cannot_announce_topic'] = 'You are not allowed to announce topics on this board.';
@@ -70,12 +66,11 @@
 $txt['cannot_calendar_edit_own'] = 'You don\'t have the privileges necessary to edit your own events.';
 $txt['cannot_calendar_post'] = 'Event posting isn\'t allowed - sorry.';
 $txt['cannot_calendar_view'] = 'Sorry, but you are not allowed to view the calendar.';
-$txt['cannot_remove_any'] = 'Sorry, but you don\'t have the privilege to remove just any topic.  Check to make sure this topic wasn\'t just moved to another board.';
-$txt['cannot_remove_own'] = 'You cannot delete your own topics in this board.  Check to make sure this topic wasn\'t just moved to another board.';
+$txt['cannot_remove_any'] = 'Sorry, but you don\'t have the privilege to remove just any topic. Check to make sure this topic wasn\'t just moved to another board.';
+$txt['cannot_remove_own'] = 'You cannot delete your own topics in this board. Check to make sure this topic wasn\'t just moved to another board.';
 $txt['cannot_edit_news'] = 'You are not allowed to edit news items on this forum.';
 $txt['cannot_pm_read'] = 'Sorry, you can\'t read your personal messages.';
 $txt['cannot_pm_send'] = 'You are not allowed to send personal messages.';
-$txt['cannot_karma_edit'] = 'You aren\'t permitted to modify other people\'s karma.';
 $txt['cannot_lock_any'] = 'You are not allowed to lock just any topic here.';
 $txt['cannot_lock_own'] = 'Apologies, but you cannot lock your own topics here.';
 $txt['cannot_make_sticky'] = 'You don\'t have permission to sticky this topic.';
@@ -85,9 +80,8 @@
 $txt['cannot_manage_membergroups'] = 'You don\'t have permission to modify or assign membergroups.';
 $txt['cannot_manage_permissions'] = 'You don\'t have permission to manage permissions.';
 $txt['cannot_manage_smileys'] = 'You\'re not allowed to manage smileys and message icons.';
-$txt['cannot_mark_any_notify'] = 'You don\'t have the permissions necessary to get notifications from this topic.';
-$txt['cannot_mark_notify'] = 'Sorry, but you are not permitted to request notifications from this board.';
 $txt['cannot_merge_any'] = 'You aren\'t allowed to merge topics on one of the selected board(s).';
+$txt['cannot_merge_redirect'] = 'One or more of the topics you have selected is a redirect topic and cannot be merged.';
 $txt['cannot_moderate_forum'] = 'You are not allowed to moderate this forum.';
 $txt['cannot_moderate_board'] = 'You are not allowed to moderate this board.';
 $txt['cannot_modify_any'] = 'You aren\'t allowed to modify just any post.';
@@ -110,8 +104,9 @@
 $txt['cannot_post_new'] = 'Sorry, you cannot post new topics in this board.';
 $txt['cannot_post_reply_any'] = 'You are not permitted to post replies to topics on this board.';
 $txt['cannot_post_reply_own'] = 'You are not allowed to post replies even to your own topics in this board.';
+$txt['cannot_post_redirect'] = 'You cannot post in redirection boards.';
 $txt['cannot_profile_remove_own'] = 'Sorry, but you aren\'t allowed to delete your own account.';
-$txt['cannot_profile_remove_any'] = 'You don\'t have the permissions to go about removing people\'s accounts!';
+$txt['cannot_profile_remove_any'] = 'You don\'t have the appropriate permissions to remove accounts.';
 $txt['cannot_profile_extra_any'] = 'You are not permitted to modify profile settings.';
 $txt['cannot_profile_identity_any'] = 'You aren\'t allowed to edit account settings.';
 $txt['cannot_profile_title_any'] = 'You cannot edit people\'s custom titles.';
@@ -121,8 +116,7 @@
 $txt['cannot_profile_server_avatar'] = 'You are not permitted to use a server stored avatar.';
 $txt['cannot_profile_upload_avatar'] = 'You do not have permission to upload an avatar.';
 $txt['cannot_profile_remote_avatar'] = 'You don\'t have the privilege of using a remote avatar.';
-$txt['cannot_profile_view_own'] = 'Many apologies, but you can\'t view your own profile.';
-$txt['cannot_profile_view_any'] = 'Many apologies, but you can\'t view just any profile.';
+$txt['cannot_profile_view'] = 'Many apologies, but you can\'t view just any profile.';
 $txt['cannot_delete_own'] = 'You are not, on this board, allowed to delete your own posts.';
 $txt['cannot_delete_replies'] = 'Sorry, but you cannot remove these posts, even though they are replies to your topic.';
 $txt['cannot_delete_any'] = 'Deleting just any posts in this board is not allowed.';
@@ -130,7 +124,7 @@
 $txt['cannot_search_posts'] = 'You are not allowed to search for posts in this forum.';
 $txt['cannot_send_mail'] = 'You don\'t have the privilege of sending out emails to everyone.';
 $txt['cannot_issue_warning'] = 'Sorry, you do not have permission to issue warnings to members.';
-$txt['cannot_send_topic'] = 'Sorry, but the administrator has disallowed sending topics on this board.';
+$txt['cannot_send_email_to_members'] = 'Sorry, but the administrator has disallowed sending emails on this board.';
 $txt['cannot_split_any'] = 'Splitting just any topic is not allowed in this board.';
 $txt['cannot_view_attachments'] = 'It seems that you are not allowed to download or view attachments on this board.';
 $txt['cannot_view_mlist'] = 'You can\'t view the memberlist because you don\'t have permission to.';
@@ -140,17 +134,21 @@
 $txt['no_theme'] = 'That theme does not exist.';
 $txt['theme_dir_wrong'] = 'The default theme\'s directory is wrong, please correct it by clicking this text.';
 $txt['registration_disabled'] = 'Sorry, registration is currently disabled.';
+$txt['registration_agreement_missing'] = 'The registration agreement file, agreement.txt, is either missing or empty. Registrations have been disable until this is fixed';
 $txt['registration_no_secret_question'] = 'Sorry, there is no secret question set for this member.';
 $txt['poll_range_error'] = 'Sorry, the poll must run for more than 0 days.';
 $txt['delFirstPost'] = 'You are not allowed to delete the first post in a topic.<p>If you want to delete this topic, click on the Remove Topic link, or ask a moderator/administrator to do it for you.</p>';
 $txt['parent_error'] = 'Unable to create board!';
-$txt['login_cookie_error'] = 'You were unable to login.  Please check your cookie settings.';
-$txt['incorrect_answer'] = 'Sorry, but you did not answer your question correctly.  Please click back to try again, or click back twice to use the default method of obtaining your password.';
+$txt['login_cookie_error'] = 'You were unable to login. Please check your cookie settings.';
+$txt['login_ssl_required'] = 'You can only login via HTTPS';
+$txt['register_ssl_required'] = 'You can only register via HTTPS';
+$txt['incorrect_answer'] = 'Sorry, but you did not answer your question correctly. Please click back to try again, or click back twice to use the default method of obtaining your password.';
 $txt['no_mods'] = 'No moderators found!';
 $txt['parent_not_found'] = 'Board structure corrupt: unable to find parent board';
 $txt['modify_post_time_passed'] = 'You may not modify this post as the time limit for edits has passed.';
 
 $txt['calendar_off'] = 'You cannot access the calendar right now because it is disabled.';
+$txt['calendar_export_off'] = 'You cannot export calendar events because that feature is currently disabled.';
 $txt['invalid_month'] = 'Invalid month value.';
 $txt['invalid_year'] = 'Invalid year value.';
 $txt['invalid_day'] = 'Invalid day value.';
@@ -171,57 +169,63 @@
 $txt['invalid_days_numb'] = 'Invalid number of days to span.';
 
 $txt['moveto_noboards'] = 'There are no boards to move this topic to!';
+$txt['topic_already_moved'] = 'This topic %1$s has been moved to the board %2$s, please check its new location before moving it again.';
 
 $txt['already_activated'] = 'Your account has already been activated.';
 $txt['still_awaiting_approval'] = 'Your account is still awaiting admin approval.';
 
-$txt['invalid_email'] = 'Invalid email address / email address range.<br />Example of a valid email address: evil.user@badsite.com.<br />Example of a valid email address range: *@*.badsite.com';
+$txt['invalid_email'] = 'Invalid email address / email address range.<br>Example of a valid email address: evil.user@badsite.com.<br>Example of a valid email address range: *@*.badsite.com';
 $txt['invalid_expiration_date'] = 'Expiration date is not valid';
-$txt['invalid_hostname'] = 'Invalid host name / host name range.<br />Example of a valid host name: proxy4.badhost.com<br />Example of a valid host name range: *.badhost.com';
-$txt['invalid_ip'] = 'Invalid IP / IP range.<br />Example of a valid IP address: 127.0.0.1<br />Example of a valid IP range: 127.0.0-20.*';
-$txt['invalid_tracking_ip'] = 'Invalid IP / IP range.<br />Example of a valid IP address: 127.0.0.1<br />Example of a valid IP range: 127.0.0.*';
+$txt['invalid_hostname'] = 'Invalid host name / host name range.<br>Example of a valid host name: proxy4.badhost.com<br>Example of a valid host name range: *.badhost.com';
+$txt['invalid_ip'] = 'Invalid IP / IP range.<br>Example of a valid IP address: 127.0.0.1<br>Example of a valid IP range: 127.0.0-20.*';
+$txt['invalid_tracking_ip'] = 'Invalid IP / IP range.<br>Example of a valid IP address: 127.0.0.1<br>Example of a valid IP range: 127.0.0.*';
 $txt['invalid_username'] = 'Member name not found';
+$txt['no_user_selected'] = 'Member not found';
 $txt['no_ban_admin'] = 'You may not ban an admin - You must demote them first!';
 $txt['no_bantype_selected'] = 'No ban type was selected';
 $txt['ban_not_found'] = 'Ban not found';
 $txt['ban_unknown_restriction_type'] = 'Restriction type unknown';
 $txt['ban_name_empty'] = 'The name of the ban was left empty';
+$txt['ban_id_empty'] = 'Ban id not found';
+$txt['ban_no_triggers'] = 'No ban triggers specified';
+$txt['ban_ban_item_empty'] = 'Ban trigger not found';
+$txt['impossible_insert_new_bangroup'] = 'An error occurred while inserting the new ban';
+
 $txt['ban_name_exists'] = 'The name of this ban (%1$s) already exists. Please choose a different name.';
 $txt['ban_trigger_already_exists'] = 'This ban trigger (%1$s) already exists in %2$s.';
 
 $txt['recycle_no_valid_board'] = 'No valid board selected for recycled topics';
+$txt['post_already_deleted'] = 'The topic or message has already been moved to the recycle board. Are you sure you want to delete it completely?<br>If so follow <a href="%1$s">this link</a>';
 
-$txt['login_threshold_fail'] = 'Sorry, you are out of login chances.  Please come back and try again later.';
-$txt['login_threshold_brute_fail'] = 'Sorry, but you\'ve reached your login attempts threshold.  Please wait 30 seconds and try again later.';
+$txt['login_threshold_fail'] = 'Sorry, you are out of login chances. Please come back and try again later.';
+$txt['login_threshold_brute_fail'] = 'Sorry, but you\'ve reached your login attempts threshold. Please wait 30 seconds and try again later.';
 
 $txt['who_off'] = 'You cannot access Who\'s Online right now because it is disabled.';
 
 $txt['merge_create_topic_failed'] = 'Error creating a new topic.';
 $txt['merge_need_more_topics'] = 'Merge topics require at least two topics to merge.';
 
-$txt['postWaitTime_broken'] = 'The last posting from your IP was less than %1$d seconds ago. Please try again later.';
-$txt['registerWaitTime_broken'] = 'You already registered just %1$d seconds ago!';
-$txt['loginWaitTime_broken'] = 'You will have to wait about %1$d seconds to login again, sorry.';
-$txt['pmWaitTime_broken'] = 'The last personal message from your IP was less than %1$d seconds ago. Please try again later.';
-$txt['reporttmWaitTime_broken'] = 'The last topic report from your IP was less than %1$d seconds ago. Please try again later.';
-$txt['sendtopcWaitTime_broken'] = 'The last topic sent from your IP was less than %1$d seconds ago. Please try again later.';
-$txt['sendmailWaitTime_broken'] = 'The last email sent from your IP was less than %1$d seconds ago. Please try again later.';
-$txt['searchWaitTime_broken'] = 'Your last search was less than %1$d seconds ago. Please try again later.';
+$txt['post_WaitTime_broken'] = 'The last posting from your IP was less than %1$d seconds ago. Please try again later.';
+$txt['register_WaitTime_broken'] = 'You already registered just %1$d seconds ago!';
+$txt['login_WaitTime_broken'] = 'You will have to wait about %1$d seconds to login again, sorry.';
+$txt['pm_WaitTime_broken'] = 'The last personal message from your IP was less than %1$d seconds ago. Please try again later.';
+$txt['reporttm_WaitTime_broken'] = 'The last topic report from your IP was less than %1$d seconds ago. Please try again later.';
+$txt['sendmail_WaitTime_broken'] = 'The last email sent from your IP was less than %1$d seconds ago. Please try again later.';
+$txt['search_WaitTime_broken'] = 'Your last search was less than %1$d seconds ago. Please try again later.';
+$txt['remind_WaitTime_broken'] = 'Your last reminder was less than %1$d seconds ago. Please try again later.';
 
 $txt['email_missing_data'] = 'You must enter something in both the subject and message boxes.';
 
 $txt['topic_gone'] = 'The topic or board you are looking for appears to be either missing or off limits to you.';
-$txt['theme_edit_missing'] = 'The file you are trying to edit... can\'t even be found!';
-
-$txt['attachments_no_write'] = 'The attachments upload directory is not writable.  Your attachment or avatar cannot be saved.';
-$txt['attachments_limit_per_post'] = 'You may not upload more than %1$d attachments per post';
+$txt['theme_edit_missing'] = 'The file you are trying to edit can\'t be found.';
 
-$txt['no_dump_database'] = 'Only administrators can make database backups!';
+$txt['no_dump_database'] = 'Only administrators can make database backups.';
 $txt['pm_not_yours'] = 'The personal message you\'re trying to quote is not your own or does not exist, please go back and try again.';
 $txt['mangled_post'] = 'Mangled form data - please go back and try again.';
+$txt['too_many_groups'] = 'Sorry, you selected too many groups, please remove some.';
+$txt['post_upload_error'] = 'The post data is missing. This error is can be caused by trying to submit a file larger than allowed by the server. Please contact your administrator if this problem continues.';
 $txt['quoted_post_deleted'] = 'The post you are trying to quote either does not exist, was deleted, or is no longer viewable by you.';
 $txt['pm_too_many_per_hour'] = 'You have exceeded the limit of %1$d personal messages per hour.';
-$txt['labels_too_many'] = 'Sorry, %1$s messages already had the maximum amount of labels allowed!';
 
 $txt['register_only_once'] = 'Sorry, but you\'re not allowed to register multiple accounts at the same time from the same computer.';
 $txt['admin_setting_coppa_require_contact'] = 'You must enter either a postal or fax contact if parent/guardian approval is required.';
@@ -237,18 +241,22 @@
 $txt['error_no_message'] = 'The message body was left empty.';
 $txt['error_long_message'] = 'The message exceeds the maximum allowed length (%1$d characters).';
 $txt['error_no_comment'] = 'The comment field was left empty.';
+// duplicate of post_too_long in Post.{language}.php
+$txt['error_post_too_long'] = 'Your message is too long. Please go back and shorten it, then try again.';
 $txt['error_session_timeout'] = 'Your session timed out while posting. Please try to re-submit your message.';
 $txt['error_no_to'] = 'No recipients specified.';
 $txt['error_bad_to'] = 'One or more \'to\'-recipients could not be found.';
 $txt['error_bad_bcc'] = 'One or more \'bcc\'-recipients could not be found.';
 $txt['error_form_already_submitted'] = 'You already submitted this post!  You might have accidentally double clicked or tried to refresh the page.';
 $txt['error_poll_few'] = 'You must have at least two choices!';
+$txt['error_poll_many'] = 'You must have no more than 256 choices.';
 $txt['error_need_qr_verification'] = 'Please complete the verification section below to complete your post.';
 $txt['error_wrong_verification_code'] = 'The letters you typed don\'t match the letters that were shown in the picture.';
 $txt['error_wrong_verification_answer'] = 'You did not answer the verification questions correctly.';
 $txt['error_need_verification_code'] = 'Please enter the verification code below to continue to the results.';
 $txt['error_bad_file'] = 'Sorry but the file specified could not be opened: %1$s';
 $txt['error_bad_line'] = 'The line you specified is invalid.';
+$txt['error_draft_not_saved'] = 'There was an error saving the draft';
 
 $txt['smiley_not_found'] = 'Smiley not found.';
 $txt['smiley_has_no_code'] = 'No code for this smiley was given.';
@@ -256,19 +264,20 @@
 $txt['smiley_not_unique'] = 'A smiley with that code already exists.';
 $txt['smiley_set_already_exists'] = 'A smiley set with that URL already exists';
 $txt['smiley_set_not_found'] = 'Smiley set not found';
+$txt['smiley_set_dir_not_found'] = 'The directory of the smiley set %1$s is either invalid or cannot be accessed';
 $txt['smiley_set_path_already_used'] = 'The URL of the smiley set is already being used by another smiley set.';
 $txt['smiley_set_unable_to_import'] = 'Unable to import smiley set. Either the directory is invalid or cannot be accessed.';
 
 $txt['smileys_upload_error'] = 'Failed to upload file.';
-$txt['smileys_upload_error_blank'] = 'All smiley sets must have an image!';
-$txt['smileys_upload_error_name'] = 'All smileys must have the same filename!';
+$txt['smileys_upload_error_blank'] = 'All smiley sets must have an image.';
+$txt['smileys_upload_error_name'] = 'All smileys must have the same filename.';
 $txt['smileys_upload_error_illegal'] = 'Illegal Type.';
 
 $txt['search_invalid_weights'] = 'Search weights are not properly configured. At least one weight should be configure to be non-zero. Please report this error to an administrator.';
-$txt['unable_to_create_temporary'] = 'The search function was unable to create temporary tables.  Please try again.';
+$txt['unable_to_create_temporary'] = 'The search function was unable to create temporary tables. Please try again.';
 
 $txt['package_no_file'] = 'Unable to find package file!';
-$txt['packageget_unable'] = 'Unable to connect to the server.  Please try using <a href="%1$s" target="_blank" class="new_win">this URL</a> instead.';
+$txt['packageget_unable'] = 'Unable to connect to the server. Please try using <a href="%1$s" target="_blank" class="new_win">this URL</a> instead.';
 $txt['not_on_simplemachines'] = 'Sorry, packages can only be downloaded like this from the simplemachines.org server.';
 $txt['package_cant_uninstall'] = 'This package was either never installed or was already uninstalled - you can\'t uninstall it now.';
 $txt['package_cant_download'] = 'You cannot download or install new packages because the Packages directory or one of the files in it are not writable!';
@@ -276,12 +285,18 @@
 $txt['package_upload_error_failed'] = 'Could not upload package, please check directory permissions!';
 $txt['package_upload_error_exists'] = 'The file you are uploading already exists on the server. Please delete it first then try again.';
 $txt['package_upload_error_supports'] = 'The package manager currently allows only these file types: %1$s.';
-$txt['package_upload_error_broken'] = 'Package upload failed due to the following error:<br />&quot;%1$s&quot;';
+$txt['package_upload_error_broken'] = 'Package upload failed due to the following error:<br>&quot;%1$s&quot;';
+$txt['package_theme_upload_error_broken'] = 'Theme upload failed due to the following error:<br>&quot;%1$s&quot;';
 
 $txt['package_get_error_not_found'] = 'The package you are trying to install cannot be located. You may want to manually upload the package to your Packages directory.';
 $txt['package_get_error_missing_xml'] = 'The package you are attempting to install is missing the package-info.xml that must be in the root package directory.';
-$txt['package_get_error_is_zero'] = 'Although the package was downloaded to the server it appears to be empty. Please check the Packages directory, and the &quot;temp&quot; sub-directory are both writable. If you continue to experience this problem you should try extracting the package on your PC and uploading the extracted files into a subdirectory in your Packages directory and try again. For example, if the package was called shout.tar.gz you should:<br />1) Download the package to your local PC and extract it into files.<br />2) Using an FTP client create a new directory in your &quot;Packages&quot; folder, in this example you may call it "shout".<br />3) Upload all the files from the extracted package to this directory.<br />4) Go back to the package manager browse page and the package will be automatically found by SMF.';
+$txt['package_get_error_is_zero'] = 'Although the package was downloaded to the server it appears to be empty. Please check the Packages directory, and the &quot;temp&quot; sub-directory are both writable. If you continue to experience this problem you should try extracting the package on your PC and uploading the extracted files into a subdirectory in your Packages directory and try again. For example, if the package was called shout.tar.gz you should:<br>1) Download the package to your local PC and extract it into files.<br>2) Using an FTP client create a new directory in your &quot;Packages&quot; folder, in this example you may call it "shout".<br>3) Upload all the files from the extracted package to this directory.<br>4) Go back to the package manager browse page and the package will be automatically found by SMF.';
 $txt['package_get_error_packageinfo_corrupt'] = 'SMF was unable to find any valid information within the package-info.xml file included within the Package. There may be an error with the modification, or the package may be corrupt.';
+$txt['package_get_error_is_theme'] = 'You can\'t install a Theme from this section, please use the <a href="{MANAGETHEMEURL}">Themes and Layout</a> management page to upload it';
+$txt['package_get_error_is_mod'] = 'You can\'t install a mod from this section, please use the <a href="{MANAGEMODURL}">Package manager</a> page to upload it';
+$txt['package_get_error_theme_not_compatible'] = 'Your theme does not show it has compatibility with %1$s. Please contact the theme author.';
+$txt['package_get_error_theme_no_based_on_found'] = 'The theme you\'re trying to install depends on another theme: %1$s, you need to install that theme first.';
+$txt['package_get_error_theme_no_new_version'] = 'The theme you\'re trying to install is already installed or is an outdated version of it. The version you\'re trying to install is: %1$s and the version already installed is: %2$s.';
 
 $txt['no_membergroup_selected'] = 'No membergroup selected';
 $txt['membergroup_does_not_exist'] = 'The membergroup doesn\'t exist or is invalid.';
@@ -293,18 +308,21 @@
 // Don't use entities in the below string.
 $txt['attachment_not_found'] = 'Attachment Not Found';
 
-$txt['error_no_boards_selected'] = 'No valid boards were selected!';
+$txt['error_no_boards_selected'] = 'No valid boards were selected.';
+$txt['error_no_boards_available'] = 'Sorry, there are no boards available to you at this time.';
 $txt['error_invalid_search_string'] = 'Did you forget to put something to search for?';
 $txt['error_invalid_search_string_blacklist'] = 'Your search query contained too trivial words. Please try again with a different query.';
 $txt['error_search_string_small_words'] = 'Each word must be at least two characters long.';
 $txt['error_query_not_specific_enough'] = 'Your search query didn\'t return any matches.';
-$txt['error_no_messages_in_time_frame'] = 'No messages found in selected time frame.';
-$txt['error_no_labels_selected'] = 'No labels were selected!';
+$txt['error_no_messages_in_time_frame'] = 'No posts found in selected time frame.';
+$txt['error_no_labels_selected'] = 'No labels were selected.';
 $txt['error_no_search_daemon'] = 'Unable to access the search daemon';
 
 $txt['profile_errors_occurred'] = 'The following errors occurred when trying to save your profile';
 $txt['profile_error_bad_offset'] = 'The time offset is out of range';
+$txt['profile_error_bad_timezone'] = 'The timezone specified is invalid';
 $txt['profile_error_no_name'] = 'The name field was left blank';
+$txt['profile_error_digits_only'] = 'The \'number of posts\' box can only contain digits.';
 $txt['profile_error_name_taken'] = 'The selected username/display name has already been taken';
 $txt['profile_error_name_too_long'] = 'The selected name is too long. It should be no greater than 60 characters long';
 $txt['profile_error_no_email'] = 'The email field was left blank';
@@ -313,33 +331,44 @@
 $txt['profile_error_no_password'] = 'You did not enter your password';
 $txt['profile_error_bad_new_password'] = 'The new passwords you entered do not match';
 $txt['profile_error_bad_password'] = 'The password you entered was not correct';
-$txt['profile_error_bad_avatar'] = 'The avatar you have selected is either too large or not an avatar';
+$txt['profile_error_bad_avatar'] = 'The avatar you have selected is not a valid image';
+$txt['profile_error_bad_avatar_invalid_url'] = 'The url you specified is invalid, please check it.';
+$txt['profile_error_bad_avatar_too_large'] = 'The image you\'re trying to use surpasses the max width/height settings, please use a smaller one.';
+$txt['profile_error_bad_avatar_fail_reencode'] = 'The image you uploaded was corrupted and the attempt to recover it failed.';
 $txt['profile_error_password_short'] = 'Your password must be at least ' . (empty($modSettings['password_strength']) ? 4 : 8) . ' characters long.';
 $txt['profile_error_password_restricted_words'] = 'Your password must not contain your username, email address or other commonly used words.';
 $txt['profile_error_password_chars'] = 'Your password must contain a mix of upper and lower case letters, as well as digits.';
 $txt['profile_error_already_requested_group'] = 'You already have an outstanding request for this group!';
-$txt['profile_error_openid_in_use'] = 'Another user is already using that OpenID authentication URL';
-
+$txt['profile_error_signature_not_yet_saved'] = 'The signature has not been saved.';
+$txt['profile_error_personal_text_too_long'] = 'The personal text is too long.';
+$txt['profile_error_user_title_too_long'] = 'The custom title is too long.';
+$txt['profile_error_custom_field_mail_fail'] = 'The mail validation check returned an error, you need to enter a valid email format (user@domain).';
+$txt['profile_error_custom_field_regex_fail'] = 'The regex verification returned an error, if you are unsure about what to type here, please contact the forum administrator.';
+
+// Registration form.
+$txt['under_age_registration_prohibited'] = 'Sorry, but users under the age of %1$d are not allowed to register on this forum.';
+$txt['error_too_quickly'] = 'You went through registration a bit too quickly, faster than should normally be possible. Please give it a moment and try again.';
 $txt['mysql_error_space'] = ' - check database storage space or contact the server administrator.';
 
 $txt['icon_not_found'] = 'The icon image could not be found in the default theme - please ensure the image has been uploaded and try again.';
-$txt['icon_after_itself'] = 'The icon cannot be positioned after itself!';
+$txt['icon_after_itself'] = 'The icon cannot be positioned after itself.';
 $txt['icon_name_too_long'] = 'Icon filenames cannot be more than 16 characters long';
 
-$txt['name_censored'] = 'Sorry, the name you tried to use, %1$s, contains words which have been censored.  Please try another name.';
+$txt['name_censored'] = 'Sorry, the name you tried to use, %1$s, contains words which have been censored. Please try another name.';
 
-$txt['poll_already_exists'] = 'A topic can only have one poll associated with it!';
+$txt['poll_already_exists'] = 'A topic can only have one poll associated with it.';
 $txt['poll_not_found'] = 'There is no poll associated with this topic!';
 
 $txt['error_while_adding_poll'] = 'The following error or errors occurred while adding this poll';
 $txt['error_while_editing_poll'] = 'The following error or errors occurred while editing this poll';
 
-$txt['loadavg_search_disabled'] = 'Due to high stress on the server, the search function has been automatically and temporarily disabled.  Please try again in a short while.';
+$txt['loadavg_search_disabled'] = 'Due to high stress on the server, the search function has been automatically and temporarily disabled. Please try again in a short while.';
 $txt['loadavg_generic_disabled'] = 'Sorry, because of high stress on the server, this feature is currently unavailable.';
 $txt['loadavg_allunread_disabled'] = 'The server\'s resources are temporarily under too high a demand to find all the topics you have not read.';
-$txt['loadavg_unreadreplies_disabled'] = 'The server is currently under high stress.  Please try again shortly.';
-$txt['loadavg_show_posts_disabled'] = 'Please try again later.  This member\'s posts are not currently available due to high load on the server.';
+$txt['loadavg_unreadreplies_disabled'] = 'The server is currently under high stress. Please try again shortly.';
+$txt['loadavg_show_posts_disabled'] = 'Please try again later. This member\'s posts are not currently available due to high load on the server.';
 $txt['loadavg_unread_disabled'] = 'The server\'s resources are temporarily under too high a demand to list out the topics you have not read.';
+$txt['loadavg_userstats_disabled'] = 'Please try again later. This member\'s statistics are not currently available due to high load on the server.';
 
 $txt['cannot_edit_permissions_inherited'] = 'You cannot edit inherited permissions directly, you must either edit the parent group or edit the membergroup inheritance.';
 
@@ -353,11 +382,11 @@
 $txt['themes_default_selectable'] = 'The overall forum default theme must be a selectable theme.';
 $txt['ignoreboards_disallowed'] = 'The option to ignore boards has not been enabled.';
 
-$txt['mboards_delete_error'] = 'No category selected!';
-$txt['mboards_delete_board_error'] = 'No board selected!';
+$txt['mboards_delete_error'] = 'No category selected.';
+$txt['mboards_delete_board_error'] = 'No board selected.';
 
-$txt['mboards_parent_own_child_error'] = 'Unable to make a parent its own child!';
-$txt['mboards_board_own_child_error'] = 'Unable to make a board its own child!';
+$txt['mboards_parent_own_child_error'] = 'You can not make a board into a sub-board of itself.';
+$txt['mboards_board_own_child_error'] = 'You can not make a board into its own sub-board.';
 
 $txt['smileys_upload_error_notwritable'] = 'The following smiley directories are not writable: %1$s';
 $txt['smileys_upload_error_types'] = 'Smiley images can only have the following extensions: %1$s.';
@@ -365,8 +394,9 @@
 $txt['change_email_success'] = 'Your email address has been changed, and a new activation email has been sent to it.';
 $txt['resend_email_success'] = 'A new activation email has successfully been sent.';
 
-$txt['custom_option_need_name'] = 'The profile option must have a name!';
-$txt['custom_option_not_unique'] = 'Field name is not unique!';
+$txt['custom_option_need_name'] = 'The profile option must have a name.';
+$txt['custom_option_not_unique'] = 'Field name is not unique.';
+$txt['custom_option_regex_error'] = 'The regex you entered is not valid';
 
 $txt['warning_no_reason'] = 'You must enter a reason for altering the warning state of a member';
 $txt['warning_notify_blank'] = 'You selected to notify the user but did not fill in the subject/message fields';
@@ -375,15 +405,6 @@
 
 $txt['movetopic_no_reason'] = 'You must enter a reason for moving the topic, or uncheck the option to \'post a redirection topic\'.';
 
-// OpenID error strings
-$txt['openid_server_bad_response'] = 'The requested identifier did not return the proper information.';
-$txt['openid_return_no_mode'] = 'The identity provider did not respond with the OpenID mode.';
-$txt['openid_not_resolved'] = 'The identity provider did not approve your request.';
-$txt['openid_no_assoc'] = 'Could not find the requested association with the identity provider.';
-$txt['openid_sig_invalid'] = 'The signature from the identity provider is invalid.';
-$txt['openid_load_data'] = 'Could not load the data from your login request.  Please try again.';
-$txt['openid_not_verified'] = 'The OpenID address given has not been verified yet.  Please log in to verify.';
-
 $txt['error_custom_field_too_long'] = 'The &quot;%1$s&quot; field cannot be greater than %2$d characters in length.';
 $txt['error_custom_field_invalid_email'] = 'The &quot;%1$s&quot; field must be a valid email address.';
 $txt['error_custom_field_not_number'] = 'The &quot;%1$s&quot; field must be numeric.';
@@ -392,9 +413,16 @@
 
 $txt['email_no_template'] = 'The email template &quot;%1$s&quot; could not be found.';
 
-$txt['search_api_missing'] = 'The search API could not be found! Please contact the admin to check they have uploaded the correct files.';
+$txt['search_api_missing'] = 'The search API could not be found. Please contact the admin to check they have uploaded the correct files.';
 $txt['search_api_not_compatible'] = 'The selected search API the forum is using is out of date - falling back to standard search. Please check file %1$s.';
 
+// Handling hook calls
+$txt['hook_fail_loading_file'] = 'Hook call: The file at path: %s could not be loaded.';
+$txt['hook_fail_call_to'] = 'Hook call: function "%1$s" in file %2$s could not be called.';
+
+// SubActions failed attempt.
+$txt['subAction_fail'] = 'The callable %s could not be called.';
+
 // Restore topic/posts
 $txt['cannot_restore_first_post'] = 'You cannot restore the first post in a topic.';
 $txt['parent_topic_missing'] = 'The parent topic of the post you are trying to restore has been deleted.';
@@ -403,5 +431,4 @@
 
 $txt['error_invalid_dir'] = 'The directory you entered is invalid.';
 
-$txt['error_sqlite_optimizing'] = 'Sqlite is optimizing the database, the forum can not be accessed until it has finished.  Please try refreshing this page momentarily.';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Help.english.php b/Themes/default/languages/Help.english.php
--- a/Themes/default/languages/Help.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Help.english.php	2015-03-05 23:33:03.409394841 -0800
@@ -1,342 +1,340 @@
 <?php
-// Version: 2.0; Help
+// Version: 2.1 Beta 1; Help
 
 global $helptxt;
 
 $txt['close_window'] = 'Close window';
 
 $helptxt['manage_boards'] = '
-	<strong>Edit Boards</strong><br />
-	In this menu you can create/reorder/remove boards, and the categories
+	<strong>Edit Boards</strong><br>
+	On this page you can create/reorder/remove boards, and the categories
 	above them. For example, if you had a wide-ranging
 	site that offered information on &quot;Sports&quot; and &quot;Cars&quot; and &quot;Music&quot;, these
 	would be the top-level Categories you\'d create. Under each of these
-	categories you\'d likely want to create hierarchical &quot;sub-categories&quot;,
-	or &quot;Boards&quot; for topics within each. It\'s a simple hierarchy, with this structure: <br />
+	categories you\'d likely want to create &quot;Boards&quot; for topics within each. It\'s a simple hierarchy, with this structure: <br>
 	<ul class="normallist">
 		<li>
 			<strong>Sports</strong>
 			&nbsp;- A &quot;category&quot;
-		</li>
-		<ul class="normallist">
-			<li>
-				<strong>Baseball</strong>
-				&nbsp;- A board under the category of &quot;Sports&quot;
-			</li>
 			<ul class="normallist">
 				<li>
-					<strong>Stats</strong>
-					&nbsp;- A child board under the board of &quot;Baseball&quot;
+					<strong>Baseball</strong>
+					&nbsp;- A board under the category of &quot;Sports&quot;
+					<ul class="normallist">
+						<li>
+							<strong>Stats</strong>
+							&nbsp;- A sub-board under the board of &quot;Baseball&quot;
+						</li>
+					</ul>
 				</li>
+				<li><strong>Football</strong>
+				&nbsp;- A board under the category of &quot;Sports&quot;</li>
 			</ul>
-			<li><strong>Football</strong>
-			&nbsp;- A board under the category of &quot;Sports&quot;</li>
-		</ul>
+		</li>
 	</ul>
-	Categories allow you to break down the board into broad topics (&quot;Cars,
-	Sports&quot;), and the &quot;Boards&quot; under them are the actual topics under which
-	members can post. A user interested in Pintos
-	would post a message under &quot;Cars->Pinto&quot;. Categories allow people to
-	quickly find what their interests are: Instead of a &quot;Store&quot; you have
-	&quot;Hardware&quot; and &quot;Clothing&quot; stores you can go to. This simplifies your
-	search for &quot;pipe joint compound&quot; because you can go to the Hardware
-	Store &quot;category&quot; instead of the Clothing Store (where you\'re unlikely
-	to find pipe joint compound).<br />
-	As noted above, a Board is a key topic underneath a broad category.
-	If you want to discuss &quot;Pintos&quot; you\'d go to the &quot;Auto&quot; category and
-	jump into the &quot;Pinto&quot; board to post your thoughts in that board.<br />
-	Administrative functions for this menu item are to create new boards
-	under each category, to reorder them (put &quot;Pinto&quot; behind &quot;Chevy&quot;), or
+	Categories allow you to break down the boards into broad topics (&quot;Cars,
+	Sports&quot;), and the &quot;Boards&quot; under them allow users to post actual topics.
+	A user interested in Pintos	would post a message under &quot;Cars->Pinto&quot;.
+	Administrative functions for this page are to create new boards
+	under each category, to reorder them (put &quot;Pinto&quot; below &quot;Chevy&quot;), or
 	to delete the board entirely.';
 
 $helptxt['edit_news'] = '
 	<ul class="normallist">
 		<li>
-			<strong>News</strong><br />
-			This section allows you to set the text for news items displayed on the Board Index page.
+			<strong>News</strong><br>
+			This page allows you to set the text for news items displayed on the Board Index page.
 			Add any item you want (e.g., &quot;Don\'t miss the conference this Tuesday&quot;). Each news item is displayed randomly and should be placed in a separate box.
 		</li>
 		<li>
-			<strong>Newsletters</strong><br />
-			This section allows you to send out newsletters to the members of the forum via personal message or email. First select the groups that you want to receive the newsletter, and those you don\'t want to receive the newsletter. If you wish, you can add additional members and email addresses that will receive the newsletter. Finally, input the message you want to send and select whether you want it to be sent to members as a personal message or as an email.
+			<strong>Newsletters</strong><br>
+			This page allows you to send out newsletters to the members of the forum via personal message or email. First select the groups that you want to receive the newsletter, and those you don\'t want to receive the newsletter. If you wish, you can add additional members and email addresses that will receive the newsletter. Finally, input the message you want to send and select whether you want it to be sent to members as a personal message or as an email.
 		</li>
 		<li>
-			<strong>Settings</strong><br />
-				This section contains a few settings that relate to news and newsletters, including selecting what groups can edit forum news or send newsletters. There is also an setting to configure whether you want news feeds enabled on the forum, as well as a setting to configure the length (how many characters are displayed) for each news post from a news feed.
+			<strong>Settings</strong><br>
+				This page contains a few settings that relate to news and newsletters, including selecting which groups can edit forum news or send newsletters. There is also a setting to configure whether you want news feeds enabled on the forum, as well as a setting to configure the length (how many characters are displayed) for each news post from a news feed.
 		</li>
 	</ul>';
 
 $helptxt['view_members'] = '
 	<ul class="normallist">
 		<li>
-			<strong>View all Members</strong><br />
+			<strong>View all Members</strong><br>
 			View all members in the board. You are presented with a hyperlinked list of member names. You may click
 			on any of the names to find details of the members (homepage, age, etc.), and as Administrator
 			you are able to modify these parameters. You have complete control over members, including the
-			ability to delete them from the forum.<br /><br />
+			ability to delete them from the forum.<br><br>
 		</li>
 		<li>
-			<strong>Awaiting Approval</strong><br />
-			This section is only shown if you have enabled admin approval of all new registrations. Anyone who registers to join your
-			forum will only become a full member once they have been approved by an admin. The section lists all those members who
+			<strong>Awaiting Approval</strong><br>
+			This page is only shown if you have enabled admin approval of all new registrations. Anyone who registers to join your
+			forum will only become a full member once they have been approved by an admin. The page lists all those members who
 			are still awaiting approval, along with their email and IP address. You can choose to either accept or reject (delete)
 			any member on the list by checking the box next to the member and choosing the action from the drop-down box at the bottom
-			of the screen. When rejecting a member you can choose to delete the member either with or without notifying them of your decision.<br /><br />
+			of the page. When rejecting a member you can choose to delete the member either with or without notifying them of your decision.<br><br>
 		</li>
 		<li>
-			<strong>Awaiting Activation</strong><br />
-			This section will only be visible if you have activation of member accounts enabled on the forum. This section will list all
-			members who have still not activated their new accounts. From this screen you can choose to either accept, reject or remind
+			<strong>Awaiting Activation</strong><br>
+			This page will only be visible if you have email activation of new member accounts enabled on the forum. This page will list all
+			members who have still not activated their new accounts. From this page you can choose to either accept, reject or remind
 			members with outstanding registrations. As above you can also choose to email the member to inform them of the
-			action you have taken.<br /><br />
+			action you have taken.<br><br>
 		</li>
 	</ul>';
 
-$helptxt['ban_members'] = '<strong>Ban Members</strong><br />
-	SMF provides the ability to &quot;ban&quot; users, to prevent people who have violated the trust of the board
-	by spamming, trolling, etc. This allows you to those users who are detrimental to your forum. As an admin,
-	when you view messages, you can see each user\'s IP address used to post at that time. In the ban list,
-	you simply type that IP address in, save, and they can no longer post from that location.<br />You can also
+$helptxt['ban_members'] = '<strong>Ban Members</strong><br>
+	SMF provides the ability to &quot;ban&quot; users, which can be a useful course of action against users that have
+	violated the trust of the forum	by spamming or trolling, etc. This allows you to exclude users that are detrimental
+	to your forum. As an admin, when you view posts made on your forum, you can see the IP address that the user had at the time of posting.
+	In the ban list, you simply type that IP address in, save, and they can no longer post from that location.<br>You can also
 	ban people through their email address.';
 
-$helptxt['featuresettings'] = '<strong>Features and Options</strong><br />
-	There are several features in this section that can be changed to your preference.';
+$helptxt['featuresettings'] = '<strong>Features and Options</strong><br>
+	There are several features in this page that can be changed to your preference.';
 
-$helptxt['securitysettings'] = '<strong>Security and Moderation</strong><br />
-	This section contains settings relating to the security and moderation of your forum.';
+$helptxt['modsettings'] = '<strong>Modification Settings</strong><br>
+	This page contains any settings added by modifications installed on your forum.';
 
-$helptxt['modsettings'] = '<strong>Modification Settings</strong><br />
-	This section should contain any settings added by modifications installed on your forum.';
-
-$helptxt['number_format'] = '<strong>Number Format</strong><br />
-	You can use this setting to format the way in which numbers on your forum will be displayed to the user. The format of this setting is:<br />
-	<div style="margin-left: 2ex;">1,234.00</div><br />
-	Where \',\' is the character used to split up groups of thousands, \'.\' is the character used as the decimal point and the number of zeros dictate the accuracy of rounding.';
-
-$helptxt['time_format'] = '<strong>Time Format</strong><br />
-	You have the power to adjust how the time and date look for yourself. There are a lot of little letters, but it\'s quite simple.
-	The conventions follow PHP\'s strftime function and are described as below (more details can be found at <a href="http://www.php.net/manual/function.strftime.php" target="_blank" class="new_win">php.net</a>).<br />
-	<br />
-	The following characters are recognized in the format string: <br />
+$helptxt['time_format'] = '<strong>Time Format</strong><br>
+	You have the ability to adjust how the time and date look for yourself. There are a lot of little letters, but it\'s quite simple.
+	The conventions follow PHP\'s strftime function and are described as below (more details can be found at <a href="http://www.php.net/manual/function.strftime.php" target="_blank" class="new_win">php.net</a>).<br>
+	<br>
+	The following characters are recognized in the format string: <br>
 	<span class="smalltext">
-	&nbsp;&nbsp;%a - abbreviated weekday name<br />
-	&nbsp;&nbsp;%A - full weekday name<br />
-	&nbsp;&nbsp;%b - abbreviated month name<br />
-	&nbsp;&nbsp;%B - full month name<br />
-	&nbsp;&nbsp;%d - day of the month (01 to 31) <br />
-	&nbsp;&nbsp;%D<strong>*</strong> - same as %m/%d/%y <br />
-	&nbsp;&nbsp;%e<strong>*</strong> - day of the month (1 to 31) <br />
-	&nbsp;&nbsp;%H - hour using a 24-hour clock (range 00 to 23) <br />
-	&nbsp;&nbsp;%I - hour using a 12-hour clock (range 01 to 12) <br />
-	&nbsp;&nbsp;%m - month as a number (01 to 12) <br />
-	&nbsp;&nbsp;%M - minute as a number <br />
-	&nbsp;&nbsp;%p - either &quot;am&quot; or &quot;pm&quot; according to the given time<br />
-	&nbsp;&nbsp;%R<strong>*</strong> - time in 24 hour notation <br />
-	&nbsp;&nbsp;%S - second as a decimal number <br />
-	&nbsp;&nbsp;%T<strong>*</strong> - current time, equal to %H:%M:%S <br />
-	&nbsp;&nbsp;%y - 2 digit year (00 to 99) <br />
-	&nbsp;&nbsp;%Y - 4 digit year<br />
-	&nbsp;&nbsp;%% - a literal \'%\' character <br />
-	<br />
+	&nbsp;&nbsp;%a - abbreviated weekday name<br>
+	&nbsp;&nbsp;%A - full weekday name<br>
+	&nbsp;&nbsp;%b - abbreviated month name<br>
+	&nbsp;&nbsp;%B - full month name<br>
+	&nbsp;&nbsp;%d - day of the month (01 to 31) <br>
+	&nbsp;&nbsp;%D<strong>*</strong> - same as %m/%d/%y <br>
+	&nbsp;&nbsp;%e<strong>*</strong> - day of the month (1 to 31) <br>
+	&nbsp;&nbsp;%H - hour using a 24-hour clock (range 00 to 23) <br>
+	&nbsp;&nbsp;%I - hour using a 12-hour clock (range 01 to 12) <br>
+	&nbsp;&nbsp;%m - month as a number (01 to 12) <br>
+	&nbsp;&nbsp;%M - minute as a number <br>
+	&nbsp;&nbsp;%p - either &quot;am&quot; or &quot;pm&quot; according to the given time<br>
+	&nbsp;&nbsp;%R<strong>*</strong> - time in 24 hour notation <br>
+	&nbsp;&nbsp;%S - second as a decimal number <br>
+	&nbsp;&nbsp;%T<strong>*</strong> - current time, equal to %H:%M:%S <br>
+	&nbsp;&nbsp;%y - 2 digit year (00 to 99) <br>
+	&nbsp;&nbsp;%Y - 4 digit year<br>
+	&nbsp;&nbsp;%% - a literal \'%\' character <br>
+	<br>
 	<em>* Does not work on Windows-based servers.</em></span>';
 
-$helptxt['live_news'] = '<strong>Live announcements</strong><br />
+$helptxt['live_news'] = '<strong>Live announcements</strong><br>
 	This box shows recently updated announcements from <a href="http://www.simplemachines.org/" target="_blank" class="new_win">www.simplemachines.org</a>.
 	You should check here every now and then for updates, new releases, and important information from Simple Machines.';
 
-$helptxt['registrations'] = '<strong>Registration Management</strong><br />
-	This section contains all the functions that could be necessary to manage new registrations on the forum. It contains up to four
-	sections which are visible depending on your forum settings. These are:<br /><br />
+$helptxt['registrations'] = '<strong>Registration Management</strong><br>
+	This page contains all the functions that could be necessary to manage new registrations on the forum. It contains up to four
+	pages which are visible depending on your forum settings. These are:<br><br>
 	<ul class="normallist">
 		<li>
-			<strong>Register new member</strong><br />
-			From this screen you can choose to register accounts for new members on their behalf. This can be useful in forums where registration is closed
-			to new members, or in cases where the admin wishes to create a test account. If the option to require activation of the account
-			is selected the member will be emailed a activation link which must be clicked before they can use the account. Similarly you can
-			select to email the users new password to the stated email address.<br /><br />
+			<strong>Register new member</strong><br>
+			From this page you can choose to register accounts for new members on their behalf. This can be useful in forums where registration is closed
+			to new members, or in cases where the admin wishes to create a test account. If the setting to require activation of the account
+			is selected the member will be emailed an activation link which must be clicked before they can use the account. Similarly you can
+			select to email the user\'s new password to the stated email address.<br><br>
 		</li>
 		<li>
-			<strong>Edit Registration Agreement</strong><br />
-			This allows you to set the text for the registration agreement displayed when members sign up for your forum.
-			You can add or remove anything from the default registration agreement, which is included in SMF.<br /><br />
+			<strong>Edit Registration Agreement</strong><br>
+			This page allows you to set the text for the registration agreement displayed when members sign up for your forum.
+			You can add or remove anything from the default registration agreement, which is included in SMF.<br><br>
 		</li>
 		<li>
-			<strong>Set Reserved Names</strong><br />
-			Using this interface you can specify words or names which may not be used by your users.<br /><br />
+			<strong>Set Reserved Names</strong><br>
+			Using this page you can specify words or names which may not be used by your users.<br><br>
 		</li>
 		<li>
-			<strong>Settings</strong><br />
-			This section will only be visible if you have permission to administrate the forum. From this screen you can decide on the registration method
-			is use on your forum, as well as other registration related settings.
+			<strong>Settings</strong><br>
+			This page will only be visible if you have permission to administrate the forum. From this page you can decide on the registration method
+			to use on your forum, as well as other registration related settings.
 		</li>
 	</ul>';
 
-$helptxt['modlog'] = '<strong>Moderation Log</strong><br />
-	This section allows members of the moderation team to track all the moderation actions that the forum moderators have performed. To ensure that
-	moderators cannot remove references to the actions they have performed, entries may not be deleted until 24 hours after the action was taken.';
-$helptxt['adminlog'] = '<strong>Administration Log</strong><br />
-	This section allows members of the admin team to track some of the administrative actions that have occurred on the forum. To ensure that
-	admins cannot remove references to the actions they have performed, entries may not be deleted until 24 hours after the action was taken.';
-$helptxt['warning_enable'] = '<strong>User Warning System</strong><br />
+$helptxt['modlog'] = '<strong>Moderation Log</strong><br>
+	This page allows members of the moderation team to track all the moderation actions that the forum moderators have performed. Note that
+	clearing the log will be logged to prevent abuse.';
+$helptxt['adminlog'] = '<strong>Administration Log</strong><br>
+	This page allows members of the admin team to track some of the administrative actions that have occurred on the forum. Note that
+	clearing the log will be logged to prevent abuse.';
+$helptxt['userlog'] = '<strong>Profile Edits Log</strong><br>
+	This page allows members of the admin team to view changes users make to their profiles, and is available from inside a user\'s profile area.';
+$helptxt['warning_enable'] = '<strong>User Warning System</strong><br>
 	This feature enables members of the admin and moderation team to issue warnings to members - and to use a members warning level to determine the
-	actions available to them on the forum. Upon enabling this feature a permission will be available within the permissions section to define
-	which groups may assign warnings to members. Warning levels can be adjusted from a members profile. The following additional options are available:
-	<ul class="normallist">
-		<li>
-			<strong>Warning Level for Member Watch</strong><br />
-			This setting defines the percentage warning level a member must reach to automatically assign a &quot;watch&quot; to the member.
-			Any member who is being &quot;watched&quot; will appear in the relevant area of the moderation center.
-		</li>
-		<li>
-			<strong>Warning Level for Post Moderation</strong><br />
-			Any member passing the value of this setting will find all their posts require moderator approval before they appear to the forum
-			community. This will override any local board permissions which may exist related to post moderation.
-		</li>
-		<li>
-			<strong>Warning Level for Member Muting</strong><br />
-			If this warning level is passed by a member they will find themselves under a post ban. The member will lose all posting rights.
-		</li>
-		<li>
-			<strong>Maximum Member Warning Point per Day</strong><br />
-			This setting limits the amount of points a moderator may add/remove to any particular member in a twenty four hour period. This will
-			can be used to limit what a moderator can do in a small period of time. This setting can be disabled by setting to a value of zero. Note that
-			any member with administrator permissions are not affected by this value.
-		</li>
-	</ul>';
-$helptxt['error_log'] = '<strong>Error Log</strong><br />
-	The error log tracks logs every serious error encountered by users using your forum. It lists all of these errors by date which can be sorted
+	actions available to them on the forum. Upon enabling this feature a permission will be available within the permissions page to define
+	which groups may assign warnings to members. Warning levels can be adjusted from a member\'s profile.';
+$helptxt['warning_watch'] = 'This setting defines the percentage warning level a member must reach to automatically assign a &quot;watch&quot; to the member. Any member who is being &quot;watched&quot; will appear in the watched members list in the moderation center.';
+$helptxt['warning_moderate'] = 'Any member passing the value of this setting will find all their posts require moderator approval before they appear to the forum community. This will override any local board permissions which may exist related to post moderation.';
+$helptxt['warning_mute'] = 'If this warning level is passed by a member they will find themselves under a post ban. The member will lose all posting rights.';
+$helptxt['user_limit'] = 'This setting limits the amount of points a moderator may add/remove to any particular member in a twenty four hour period. This
+			can be used to limit what a moderator can do in a small period of time. This can be disabled by setting it to a value of zero. Note that
+			any members with administrator permissions are not affected by this value.';
+
+$helptxt['error_log'] = '<strong>Error Log</strong><br>
+	The error log tracks every serious error encountered by users of your forum. It lists all of these errors by date, which can be sorted
 	by clicking the black arrow next to each date. Additionally you can filter the errors by clicking the picture next to each error statistic. This
 	allows you to filter, for example, by member. When a filter is active the only results that will be displayed will be those that match that filter.';
-$helptxt['theme_settings'] = '<strong>Theme Settings</strong><br />
-	The settings screen allows you to change settings specific to a theme. These settings include options such as the themes directory and URL information but
-	also options that affect the layout of a theme on your forum. Most themes will have a variety of user configurable options, allowing you to adapt a theme
+$helptxt['theme_settings'] = '<strong>Theme Settings</strong><br>
+	The settings page allows you to change settings specific to a theme. These settings include options such as the themes directory and URL information but
+	also options that affect the layout of a theme on your forum. Most themes will have a variety of user configurable settings, allowing you to adapt a theme
 	to suit your individual forum needs.';
-$helptxt['smileys'] = '<strong>Smiley Center</strong><br />
-	Here you can add and remove smileys, and smiley sets.  Note importantly that if a smiley is in one set, it\'s in all sets - otherwise, it might
-	get confusing for your users using different sets.<br /><br />
+$helptxt['smileys'] = '<strong>Smiley Center</strong><br>
+	Here you can add and remove smileys, and smiley sets. If a smiley is present in one set, it should be present in all sets - otherwise, it might
+	get confusing for your users using different sets.<br><br>
 
 	You are also able to edit message icons from here, if you have them enabled on the settings page.';
-$helptxt['calendar'] = '<strong>Manage Calendar</strong><br />
+$helptxt['calendar'] = '<strong>Manage Calendar</strong><br>
 	Here you can modify the current calendar settings as well as add and remove holidays that appear on the calendar.';
+$helptxt['cal_export'] = 'Exports a text file in the iCal format for importing into other calendar applications';
+$helptxt['cal_highlight_events'] = 'This setting allows you to highlight events on the Mini Calendars, Main Calendar, both places, or disable event highlighting.';
+$helptxt['cal_highlight_holidays'] = 'This setting allows you to highlight holidays on the Mini Calendars, Main Calendar, both places, or disable event highlighting.';
+$helptxt['cal_highlight_birthdays'] = 'This setting allows you to highlight birthdays on the Mini Calendars, Main Calendar, both places, or disable event highlighting.';
+$helptxt['cal_disable_prev_next'] = 'If this setting is checked, the three month blocks on the left hand side of the page will be disabled.';
+$helptxt['cal_display_type'] = 'This setting allows you to change the display type of the calendar.<br><br><strong>Comfortable:</strong> makes the rows of the calendar big.<br><strong>Compact:</strong> makes the rows of the calendar small.';
+$helptxt['cal_week_links'] = 'If this setting is checked, links will be added alongside each week in the calendar.';
+$helptxt['cal_prev_next_links'] = 'If this setting is checked, previous month and next month links will be added to the top of each month for easy navigation.';
+$helptxt['cal_short_months'] = 'If this setting is checked, month names within the calendar will be shortened.<br><br><strong>Enabled:</strong> ' . $txt['months_short'][1] . ' 1<br><strong>Disabled:</strong> ' . $txt['months_titles'][1] . ' 1';
+$helptxt['cal_short_days'] = 'If this setting is checked, day names within the calendar will be shortened.<br><br><strong>Enabled:</strong> ' . $txt['days_short'][1] . '<br><strong>Disbaled:</strong> ' . $txt['days'][1];
 
-$helptxt['serversettings'] = '<strong>Server Settings</strong><br />
-	Here you can perform the core configuration for your forum. This section includes the database and url settings, as well as other
+$helptxt['serversettings'] = '<strong>Server Settings</strong><br>
+	Here you can perform some core configuration for your forum. This page includes the database and url settings, as well as other
 	important configuration items such as mail settings and caching. Think carefully whenever editing these settings as an error may
 	render the forum inaccessible';
 $helptxt['manage_files'] = '
 	<ul class="normallist">
 		<li>
-			<strong>Browse Files</strong><br />
-			Browse through all the attachments, avatars and thumbnails stored by SMF.<br /><br />
+			<strong>Browse Files</strong><br>
+			Browse through all the attachments, avatars and thumbnails stored by SMF.<br><br>
 		</li><li>
-			<strong>Attachment Settings</strong><br />
-			Configure where attachments are stored and set restrictions on the types of attachments.<br /><br />
+			<strong>Attachment Settings</strong><br>
+			Configure where attachments are stored and set restrictions on the types of attachments.<br><br>
 		</li><li>
-			<strong>Avatar Settings</strong><br />
-			Configure where avatars are stored and manage resizing of avatars.<br /><br />
+			<strong>Avatar Settings</strong><br>
+			Configure where avatars are stored and manage the resizing of avatars.<br><br>
 		</li><li>
-			<strong>File Maintenance</strong><br />
-			Check and repair any error in the attachment directory and delete selected attachments.<br /><br />
+			<strong>File Maintenance</strong><br>
+			Check and repair any error in the attachment directory and delete selected attachments.<br><br>
 		</li>
 	</ul>';
 
-$helptxt['topicSummaryPosts'] = 'This allows you to set the number of previous posts shown in the topic summary at the reply screen.';
-$helptxt['enableAllMessages'] = 'Set this to the <em>maximum</em> number of posts a topic can have to show the all link.  Setting this lower than &quot;Maximum messages to display in a topic page&quot; will simply mean it never gets shown, and setting it too high could slow down your forum.';
-$helptxt['enableStickyTopics'] = 'Stickies are topics that remain on top of the topic list. They are mostly used for important
-		messages. Although you can change this with permissions, by default only moderators and administrators can make topics sticky.';
-$helptxt['allow_guestAccess'] = 'Unchecking this box will stop guests from doing anything but very basic actions - login, register, password reminder, etc. - on your forum.  This is not the same as disallowing guest access to boards.';
-$helptxt['userLanguage'] = 'Turning this option on will allow users to select which language file they use. It will not affect the
+$helptxt['topicSummaryPosts'] = 'This allows you to set the number of previous posts shown in the topic summary on the reply page.';
+$helptxt['enableAllMessages'] = 'Set this to the <em>maximum</em> number of posts a topic can have to show the <em>all</em> link. Setting this lower than &quot;Maximum messages to display in a topic page&quot; will simply mean it never gets shown, and setting it too high could slow down your forum.';
+$helptxt['allow_guestAccess'] = 'Unchecking this box will stop guests from doing anything but very basic actions on your forum - login, register, password reminder, etc. - on your forum. This is not the same as disallowing guest access to boards.';
+$helptxt['userLanguage'] = 'Turning this setting on will allow users to select which language file they use. It will not affect the
 		default selection.';
-$helptxt['trackStats'] = 'Stats:<br />This will allow users to see the latest posts and the most popular topics on your forum.
-		It will also show several statistics, like the most members online, new members and new topics.<hr />
-		Page views:<br />Adds another column to the stats page with the number of pageviews on your forum.';
+$helptxt['trackStats'] = 'Stats:<br>This will allow users to see the latest posts and the most popular topics on your forum.
+		It will also show several statistics, like the most members online, new members, and new topics.<hr>
+		Page views:<br>Adds another column to the stats page with the number of pageviews on your forum.';
 $helptxt['titlesEnable'] = 'Switching Custom Titles on will allow members with the relevant permission to create a special title for themselves.
-		This will be shown underneath the name.<br /><em>For example:</em><br />Jeff<br />Cool Guy';
-$helptxt['topbottomEnable'] = 'This will add go up and go down buttons, so that member can go to the top and bottom of a page
-		without scrolling.';
+		This will be shown underneath the name.<br><em>For example:</em><br>Jeff<br>Cool Guy';
 $helptxt['onlineEnable'] = 'This will show an image to indicate whether the member is online or offline';
-$helptxt['todayMod'] = 'This will show &quot;Today&quot; or &quot;Yesterday&quot; instead of the date.<br /><br />
-		<strong>Examples:</strong><br /><br />
-		<dt>
-			<dt>Disabled</dt>
-			<dd>October 3, 2009 at 12:59:18 am</dd>
-			<dt>Only Today</dt>
-			<dd>Today at 12:59:18 am</dd>
-			<dt>Today &amp; Yesterday</dt>
-			<dd>Yesterday at 09:36:55 pm</dd>
-		</dt>';
-$helptxt['disableCustomPerPage'] = 'Check this option to stop users from customizing the amount of messages and topics to display per page on the Message Index and Topic Display page respectively.';
+$helptxt['todayMod'] = 'This will show &quot;Today&quot; or &quot;Yesterday&quot; instead of the date.<br><br>
+		<strong>Examples:</strong><br><br>
+		<ul class="normallist">
+			<li>
+			<strong>Disabled</strong><br>
+			October 3, 2009 at 12:59:18 am</li>
+			<li><strong>Only Today</strong><br>
+			Today at 12:59:18 am</li>
+			<li><strong>Today &amp; Yesterday</strong><br>
+			Yesterday at 09:36:55 pm</li>
+		</ul>';
+$helptxt['disableCustomPerPage'] = 'Check this setting to stop users from customizing the amount of messages and topics to display per page on the Message Index and Topic Display page respectively.';
 $helptxt['enablePreviousNext'] = 'This will show a link to the next and previous topic.';
 $helptxt['pollMode'] = 'This selects whether polls are enabled or not. If polls are disabled, any existing polls will be hidden
 		from the topic listing. You can choose to continue to show the regular topic without their polls by selecting
-		&quot;Show Existing Polls as Topics&quot;.<br /><br />To choose who can post polls, view polls, and similar, you
+		&quot;Show Existing Polls as Topics&quot;.<br><br>To choose who can post polls, view polls, and similar, you
 		can allow and disallow those permissions. Remember this if polls are not working.';
-$helptxt['enableVBStyleLogin'] = 'This will show a more compact login on every page of the forum for guests.';
-$helptxt['enableCompressedOutput'] = 'This option will compress output to lower bandwidth consumption, but it requires
+$helptxt['enableCompressedOutput'] = 'This setting will compress output in order to lower bandwidth consumption, but it requires
 		zlib to be installed.';
-$helptxt['disableTemplateEval'] = 'By default, templates are evaluated instead of just included. This helps with showing more useful debug information in case a template contains an error.<br /><br />
-		On large forums however, this customised inclusion process may be significantly slower. Therefore, advanced users may wish to disable it.';
-$helptxt['databaseSession_enable'] = 'This option makes use of the database for session storage - it is best for load balanced servers, but helps with all timeout issues and can make the forum faster.';
-$helptxt['databaseSession_loose'] = 'Turning this on will decrease the bandwidth your forum uses, and make it so clicking back will not reload the page - the downside is that the (new) icons won\'t update, among other things. (unless you click to that page instead of going back to it.)';
-$helptxt['databaseSession_lifetime'] = 'This is the number of seconds for sessions to last after they haven\'t been accessed.  If a session is not accessed for too long, it is said to have &quot;timed out&quot;.  Anything higher than 2400 is recommended.';
+$helptxt['disableTemplateEval'] = 'By default, templates are evaluated instead of just included. This helps with showing more useful debug information in case a template contains an error.<br><br>
+		On large forums however, this customized inclusion process may be significantly slower. Therefore, advanced users may wish to disable it.';
+$helptxt['httponlyCookies'] = 'Cookies won\'t be accessible by scripting languages, such as JavaScript. This setting can help to reduce identity theft through XSS attacks. This can cause issues with third party scripts but should be on wherever possible.';
+$helptxt['databaseSession_enable'] = 'This setting makes use of the database for session storage - it is best for load balanced servers, but helps with all timeout issues and can make the forum faster.';
+$helptxt['databaseSession_loose'] = 'Turning this on will decrease the bandwidth your forum uses, and make it so clicking back will not reload the page - the downside is that the (new) icons won\'t update, among other things. (unless you click to that page instead of going back to it).';
+$helptxt['databaseSession_lifetime'] = 'This is the number of seconds for sessions to last after they haven\'t been accessed. If a session is not accessed for too long, it is said to have &quot;timed out&quot;. Anything higher than 2400 is recommended.';
+$helptxt['cache_enable'] = 'SMF performs caching at a variety of levels. The higher the level of caching enabled the more CPU time will be spent retrieving cached information. If caching is available on your machine it is recommended that you try caching at level 1 first.';
+$helptxt['cache_memcached'] = 'If you are using memcached you need to provide the server details. This should be entered as a comma separated list as shown in the example below:<br><br>	&quot;server1,server2,server3:port,server4&quot;<br><br>Note that if no port is specified SMF will use port 11211. SMF will attempt to perform rough/random load balancing across the specified servers.';
+$helptxt['cache_cachedir'] = 'This setting is only for the smf file-based cache system. It specifies the path to the cache directory. It is recommended that you place this in /tmp/ if you are going to use this, although it will work in any directory';
 $helptxt['enableErrorLogging'] = 'This will log any errors, like a failed login, so you can see what went wrong.';
-$helptxt['enableErrorQueryLogging'] = 'This will include the full query sent to the database in the error log.  Requires error logging to be turned on.<br /><br /><strong>Note:  This will affect the ability to filter the error log by the error message.</strong>';
+$helptxt['enableErrorQueryLogging'] = 'This will include the full query sent to the database in the error log. It requires error logging to be turned on.<br><br><strong>Note:  This will affect the ability to filter the error log by the error message.</strong>';
+$helptxt['log_ban_hits'] = 'If enabled, every time a banned user tries to access the site, this will be logged in the error log. If you do not care whether, or how often, banned users attempt to access the site, you can turn this off for a performance boost.';
 $helptxt['allow_disableAnnounce'] = 'This will allow users to opt out of notification of topics you announce by checking the &quot;announce topic&quot; checkbox when posting.';
-$helptxt['disallow_sendBody'] = 'This option removes the option to receive the text of replies and posts in notification emails.<br /><br />Often, members will reply to the notification email, which in most cases means the webmaster receives the reply.';
-$helptxt['compactTopicPagesEnable'] = 'This will just show a selection of the number of pages.<br /><em>Example:</em>
-		&quot;3&quot; to display: 1 ... 4 [5] 6 ... 9 <br />
+$helptxt['disallow_sendBody'] = 'This setting removes the option to receive the text of replies, posts, and personal messages in notification emails.<br><br>Often, members will reply to the notification email, which in most cases means the webmaster receives the reply.';
+$helptxt['enable_ajax_alerts'] = 'This option allows your members to receive AJAX notifications. This means that members don\'t need to refresh the page to get new notifications.<br><b>DO NOTE:</b> This option might cause a severe load at your server with many users online.';
+$helptxt['jquery_source'] = 'This will determine the source used to load the jQuery Library. <em>Auto</em> will use the CDN first and if not available fall back to the local source. <em>Local</em> will only use the local source. <em>CDN</em> will only load it from Google CDN network';
+$helptxt['compactTopicPagesEnable'] = 'This will just show a selection of the number of pages.<br><em>Example:</em>
+		&quot;3&quot; to display: 1 ... 4 [5] 6 ... 9 <br>
 		&quot;5&quot; to display: 1 ... 3 4 [5] 6 7 ... 9';
-$helptxt['timeLoadPageEnable'] = 'This will show the time in seconds SMF took to create that page at the bottom of the board.';
+$helptxt['timeLoadPageEnable'] = 'This will show the time in seconds SMF took to create the page at the bottom of the board.';
 $helptxt['removeNestedQuotes'] = 'This will strip nested quotes from a post when citing the post in question via a quote link.';
-$helptxt['simpleSearch'] = 'This will show a simple search form and a link to a more advanced form.';
-$helptxt['max_image_width'] = 'This allows you to set a maximum size for posted pictures. Pictures smaller than the maximum will not be affected.';
-$helptxt['mail_type'] = 'This setting allows you to choose either PHP\'s default settings, or to override those settings with SMTP.  PHP doesn\'t support using authentication with SMTP (which many hosts require, now) so if you want that you should select SMTP.  Please note that SMTP can be slower, and some servers will not take usernames and passwords.<br /><br />You don\'t need to fill in the SMTP settings if this is set to PHP\'s default.';
-$helptxt['attachment_manager_settings'] = 'Attachments are files that members can upload, and attach to a post.<br /><br />
-		<strong>Check attachment extension</strong>:<br /> Do you want to check the extension of the files?<br />
-		<strong>Allowed attachment extensions</strong>:<br /> You can set the allowed extensions of attached files.<br />
-		<strong>Attachments directory</strong>:<br /> The path to your attachment folder<br />(example: /home/sites/yoursite/www/forum/attachments)<br />
-		<strong>Max attachment folder space</strong> (in KB):<br /> Select how large the attachment folder can be, including all files within it.<br />
-		<strong>Max attachment size per post</strong> (in KB):<br /> Select the maximum filesize of all attachments made per post.  If this is lower than the per-attachment limit, this will be the limit.<br />
-		<strong>Max size per attachment</strong> (in KB):<br /> Select the maximum filesize of each separate attachment.<br />
-		<strong>Max number of attachments per post</strong>:<br /> Select the number of attachments a person can make, per post.<br />
-		<strong>Display attachment as picture in posts</strong>:<br /> If the uploaded file is a picture, this will show it underneath the post.<br />
-		<strong>Resize images when showing under posts</strong>:<br /> If the above option is selected, this will save a separate (smaller) attachment for the thumbnail to decrease bandwidth.<br />
-		<strong>Maximum width and height of thumbnails</strong>:<br /> Only used with the &quot;Resize images when showing under posts&quot; option, the maximum width and height to resize attachments down from.  They will be resized proportionally.';
-$helptxt['attachment_image_paranoid'] = 'Selecting this option will enable very strict security checks on image attachments. Warning! These extensive checks can fail on valid images too. It is strongly recommended to only use this option together with image re-encoding, in order to have SMF try to resample the images which fail the security checks: if successful, they will be sanitized and uploaded. Otherwise, if image re-encoding is not enabled, all attachments failing checks will be rejected.';
-$helptxt['attachment_image_reencode'] = 'Selecting this option will enable trying to re-encode the uploaded image attachments. Image re-encoding offers better security. Note however that image re-encoding also renders all animated images static. <br /> This feature is only possible if the GD module is installed on your server.';
-$helptxt['avatar_paranoid'] = 'Selecting this option will enable very strict security checks on avatars. Warning! These extensive checks can fail on valid images too. It is strongly recommended to only use this option together with avatars re-encoding, in order to have SMF try to resample the images which fail the security checks: if successful, they will be sanitized and uploaded. Otherwise, if re-encoding of avatars is not enabled, all avatars failing checks will be rejected.';
-$helptxt['avatar_reencode'] = 'Selecting this option will enable trying to re-encode the uploaded avatars. Image re-encoding offers better security. Note however that image re-encoding also renders all animated images static. <br /> This feature is only possible if the GD module is installed on your server.';
-$helptxt['karmaMode'] = 'Karma is a feature that shows the popularity of a member. Members, if allowed, can
-		\'applaud\' or \'smite\' other members, which is how their popularity is calculated. You can change the
-		number of posts needed to have a &quot;karma&quot;, the time between smites or applauds, and if administrators
-		have to wait this time as well.<br /><br />Whether or not groups of members can smite others is controlled by
-		a permission.  If you have trouble getting this feature to work for everyone, double check your permissions.';
-$helptxt['cal_enabled'] = 'The calendar can be used for showing birthdays, or for showing important moments happening in your community.<br /><br />
-		<strong>Show days as link to \'Post Event\'</strong>:<br />This will allow members to post events for that day, when they click on that date<br />
-		<strong>Max days in advance on board index</strong>:<br />If this is set to 7, the next week\'s worth of events will be shown.<br />
-		<strong>Show holidays on board index</strong>:<br />Show today\'s holidays in a calendar bar on the board index.<br />
-		<strong>Show birthdays on board index</strong>:<br />Show today\'s birthdays in a calendar bar on the board index.<br />
-		<strong>Show events on board index</strong>:<br />Show today\'s events in a calendar bar on the board index.<br />
-		<strong>Default Board to Post In</strong>:<br />What\'s the default board to post events in?<br />
-		<strong>Allow events not linked to posts</strong>:<br />Allow members to post events without requiring it to be linked with a post in a board.<br />
-		<strong>Minimum year</strong>:<br />Select the &quot;first&quot; year on the calendar list.<br />
-		<strong>Maximum year</strong>:<br />Select the &quot;last&quot; year on the calendar list<br />
-		<strong>Allow events to span multiple days</strong>:<br />Check to allow events to span multiple days.<br />
-		<strong>Max number of days an event can span</strong>:<br />Select the maximum days that an event can span.<br /><br />
-		Remember that usage of the calendar (posting events, viewing events, etc.) is controlled by permissions set on the permissions screen.';
+$helptxt['max_image_width'] = 'This allows you to set a maximum size for posted pictures. Pictures smaller than the maximum will not be affected. This also determines how attached images are displayed when a thumbnail is clicked on.';
+$helptxt['mail_type'] = 'This setting allows you to choose either PHP\'s default settings, or to override those settings with SMTP. PHP doesn\'t support using authentication with SMTP (which many hosts now require), so if you want that you should select SMTP. Please note that SMTP can be slower, and some servers will not accept usernames and passwords.<br><br>You don\'t need to fill in the SMTP settings if this is set to PHP\'s default.';
+$helptxt['attachment_manager_settings'] = 'Attachments are files that members can upload and attach to a post. Different sites may use these in different ways, which you can configure here.';
+$helptxt['attachmentCheckExtensions'] = 'For some communities, you may wish to limit the types of files that users can upload by checking the extension: e.g. myphoto.jpg has an extension of jpg.';
+$helptxt['attachmentExtensions'] = 'If "check attachment\'s extension" above is ticked, these are the extensions that will be permitted for new attachments.';
+$helptxt['attachmentUploadDir'] = 'The path to your attachment folder on the server<br>(example: /home/sites/yoursite/www/forum/attachments)';
+$helptxt['attachmentDirSizeLimit'] = ' Select how large the attachment folder can be, including all files within it.';
+$helptxt['attachmentPostLimit'] = ' Select the maximum filesize (in KB) of all attachments made per post. If this is lower than the per-attachment limit, this will be the limit.';
+$helptxt['attachmentSizeLimit'] = 'Select the maximum filesize of each separate attachment.';
+$helptxt['attachmentNumPerPostLimit'] = ' Select the number of attachments a person can make per post.';
+$helptxt['attachmentShowImages'] = 'If the uploaded file is a picture, it will be displayed underneath the post.';
+$helptxt['attachmentThumbnails'] = 'If the above setting is selected, this will save a separate (smaller) attachment for the thumbnail to decrease bandwidth.';
+$helptxt['attachmentThumbWidth'] = 'Only used with the &quot;Resize images when showing under posts&quot; setting the maximum width to resize attachments down from. They will be resized proportionally.';
+$helptxt['attachmentThumbHeight'] = 'Only used with the &quot;Resize images when showing under posts&quot; setting the maximum height to resize attachments down from. They will be resized proportionally.';
+$helptxt['attachmentDirFileLimit'] = 'Max number of files per directory';
+$helptxt['attachmentEnable'] = 'This setting enables you to configure how attachments can be made.<br><br>
+	<ul class="normallist">
+		<li>
+			<strong>Disable all attachments</strong><br>
+			All attachments are disabled. Existing attachments are not deleted, but they are hidden from view (even administrators cannot see them). New attachments cannot be made either, regardless of permissions.<br><br>
+		</li>
+		<li>
+			<strong>Enable all attachments</strong><br>
+			Everything behaves as normal, users who are permitted to view attachments can do so, users who are permitted to upload can do so.<br><br>
+		</li>
+		<li>
+			<strong>Disable new attachments</strong><br>
+			Existing attachments are still accessible, but no new attachments can be added, regardless of permission.
+		</li>
+	</ul>';
+$helptxt['attachment_image_paranoid'] = 'Selecting this setting will enable very strict security checks on image attachments. <strong>Warning!</strong> These extensive checks can fail on valid images too. It is strongly recommended to only use this setting together with image re-encoding, in order to have SMF try to resample the images which fail the security checks: if successful, they will be sanitized and uploaded. Otherwise, if image re-encoding is not enabled, all attachments failing checks will be rejected.';
+$helptxt['attachment_image_reencode'] = 'Selecting this setting will enable trying to re-encode the uploaded image attachments. Image re-encoding offers better security. Note however that image re-encoding also renders all animated images static. <br> This feature is only possible if the GD module is installed on your server.';
+$helptxt['attachment_thumb_memory'] = 'The larger the source image (size & width x height), the higher the memory requirements are for the system to successfully create a thumbnail image.<br>Checking this setting, the system will estimate the required memory and will then request that amount. If successful, only then will it attempt to create the thumbnail.<br>This will result in fewer white page errors but may result in fewer thumbnails being created. Leaving this unchecked will always cause the system to try to create the thumbnail (with a fixed amount of memory). This may result in more white page errors.';
+$helptxt['attachmentRecodeLineEndings'] = 'The script will re-code line endings according to your server.';
+$helptxt['automanage_attachments'] = 'By default, SMF puts new attachments into a single folder. For most sites this is not a problem, but as a site grows it can be useful to have multiple folders to store attachments in.<br><br>This setting allows you to set whether you manage these folders yourself (e.g. creating a second folder and moving to it when you are ready) or whether you let SMF do it, based on criteria, such as when the current directory reaches a given size, or breaking down folders by years or even months on very busy sites.';
+$helptxt['use_subdirectories_for_attachments'] = 'Create new directories.';
+$helptxt['max_image_height'] = 'As with the maximum width, this setting indicates the maximum height a posted image can be.';
+$helptxt['avatar_paranoid'] = 'Selecting this setting will enable very strict security checks on avatars. <strong>Warning!</strong> These extensive checks can fail on valid images too. It is strongly recommended to only use this setting together with avatar re-encoding, in order to have SMF try to resample the images which fail the security checks: if successful, they will be sanitized and uploaded. Otherwise, if re-encoding of avatars is not enabled, all avatars failing checks will be rejected.';
+$helptxt['avatar_reencode'] = 'Selecting this setting will enable trying to re-encode the uploaded avatars. Image re-encoding offers better security. Note, however, that image re-encoding also renders all animated images static. <br> This feature is only possible if the GD module is installed on your server.';
+$helptxt['cal_enabled'] = 'The calendar can be used for showing birthdays, or for showing important events happening in your community.<br><br>
+		<strong>Show days as link to \'Post Event\'</strong>:<br>This will allow members to post events for that day, when they click on that date<br>
+		<strong>Max days in advance on board index</strong>:<br>If this is set to 7, the next week\'s worth of events will be shown.<br>
+		<strong>Show holidays on board index</strong>:<br>Show today\'s holidays in a calendar bar on the board index.<br>
+		<strong>Show birthdays on board index</strong>:<br>Show today\'s birthdays in a calendar bar on the board index.<br>
+		<strong>Show events on board index</strong>:<br>Show today\'s events in a calendar bar on the board index.<br>
+		<strong>Default Board to Post In</strong>:<br>What\'s the default board to post events in?<br>
+		<strong>Allow events not linked to posts</strong>:<br>Allow members to post events without requiring them to be linked with a post in a board.<br>
+		<strong>Minimum year</strong>:<br>Select the &quot;first&quot; year on the calendar list.<br>
+		<strong>Maximum year</strong>:<br>Select the &quot;last&quot; year on the calendar list<br>
+		<strong>Allow events to span multiple days</strong>:<br>Select this to allow events to span multiple days.<br>
+		<strong>Max number of days an event can span</strong>:<br>Select the maximum number of days that an event can span.<br><br>
+		Remember that usage of the calendar (posting events, viewing events, etc.) is controlled by permissions set on the permissions page.';
 $helptxt['localCookies'] = 'SMF uses cookies to store login information on the client computer.
-	Cookies can be stored globally (myserver.com) or locally (myserver.com/path/to/forum).<br />
-	Check this option if you\'re experiencing problems with users getting logged out automatically.<hr />
-	Globally stored cookies are less secure when used on a shared webserver (like Tripod).<hr />
-	Local cookies don\'t work outside the forum folder so, if your forum is stored at www.myserver.com/forum, pages like www.myserver.com/index.php cannot access the account information.
-	Especially when using SSI.php, global cookies are recommended.';
-$helptxt['enableBBC'] = 'Selecting this option will allow your members to use Bulletin Board Code (BBC) throughout the forum, allowing users to format their posts with images, type formatting and more.';
-$helptxt['time_offset'] = 'Not all forum administrators want their forum to use the same time zone as the server upon which it is hosted. Use this option to specify a time difference (in hours) from which the forum should operate from the server time. Negative and decimal values are permitted.';
-$helptxt['default_timezone'] = 'The server timezone tells PHP where your server is located. You should ensure this is set correctly, preferably to the country/city in which the city is located. You can find out more information on the <a href="http://www.php.net/manual/en/timezones.php" target="_blank">PHP Site</a>.';
+	Cookies can be stored globally (myserver.com) or locally (myserver.com/path/to/forum).<br><br>
+	Try this setting if you\'re experiencing problems with users getting logged out automatically.<hr>
+	Globally stored cookies are less secure when used on a shared webserver (like Tripod).<hr>
+	Local cookies don\'t work outside the forum directory so, if your forum is stored at www.myserver.com/forum, pages like www.myserver.com/index.php cannot access the account information.<br><br>
+	Global cookies are especially recommended when using SSI.php but work well for most sites on their own domain.';
+$helptxt['enableBBC'] = 'Selecting this setting will allow your members to use Bulletin Board Code (BBC) throughout the forum, allowing users to format their posts with images, type formatting, and more.';
+$helptxt['time_offset'] = 'Not all forum administrators want their forum to use the same time zone as the server upon which it is hosted. Use this setting to specify the time difference (in hours) between the server time and the time to be used for the forum. Negative and decimal values are permitted.';
+$helptxt['default_timezone'] = 'The server time zone tells PHP where your server is located. You should ensure that this is set correctly, preferably to the country/city in which the server is located. You can find out more information on the <a href="http://www.php.net/manual/en/timezones.php" target="_blank">PHP Site</a>.';
 $helptxt['spamWaitTime'] = 'Here you can select the amount of time that must pass between postings. This can be used to stop people from "spamming" your forum by limiting how often they can post.';
 
 $helptxt['enablePostHTML'] = 'This will allow the posting of some basic HTML tags:
-	<ul class="normallist" style="margin-bottom: 0;">
+	<ul class="normallist">
 		<li>&lt;b&gt;, &lt;u&gt;, &lt;i&gt;, &lt;s&gt;, &lt;em&gt;, &lt;ins&gt;, &lt;del&gt;</li>
 		<li>&lt;a href=&quot;&quot;&gt;</li>
 		<li>&lt;img src=&quot;&quot; alt=&quot;&quot; /&gt;</li>
@@ -345,260 +343,261 @@
 	</ul>';
 
 $helptxt['themes'] = 'Here you can select whether the default theme can be chosen, what theme guests will use,
-	as well as other options. Click on a theme to the right to change the settings for it.';
-$helptxt['theme_install'] = 'This allows you to install new themes.  You can do this from an already created directory, by uploading an archive for the theme, or by copying the default theme.<br /><br />Note that the archive or directory must have a <tt>theme_info.xml</tt> definition file.';
-$helptxt['enableEmbeddedFlash'] = 'This option will allow your users to use Flash directly inside their posts,
-	just like images.  This could pose a security risk, although few have successfully exploited it.
+	as well as other settings. Click on a theme to the right to change the settings for it.';
+$helptxt['theme_install'] = 'This allows you to install new themes. You can do this from an existing directory, by uploading an archive for the theme, or by copying the default theme.<br><br>Note that the archive or directory must have a <pre>theme_info.xml</pre> definition file.';
+$helptxt['enableEmbeddedFlash'] = 'This setting will allow your users to use Flash directly inside their posts,
+	just like images. This could pose a security risk, although few have successfully exploited it.
 	USE AT YOUR OWN RISK!';
-// !!! Add more information about how to use them here.
 $helptxt['xmlnews_enable'] = 'Allows people to link to <a href="%1$s?action=.xml;sa=news" target="_blank" class="new_win">Recent news</a>
-	and similar data.  It is also recommended that you limit the size of recent posts/news because, when rss data
-	is displayed in some clients, like Trillian, it is expected to be truncated.';
-$helptxt['hotTopicPosts'] = 'Change the number of posts for a topic to reach the state of a &quot;hot&quot; or
-	&quot;very hot&quot; topic.';
-$helptxt['globalCookies'] = 'Makes log in cookies available across subdomains.  For example, if...<br />
-	Your site is at http://www.simplemachines.org/,<br />
-	And your forum is at http://forum.simplemachines.org/,<br />
-	Using this option will allow you to access the forum\'s cookie on your site.  Do not enable this if there are other subdomains (like hacker.simplemachines.org) not controlled by you.';
-$helptxt['secureCookies'] = 'Enabling this option will force the cookies created for users on your forum to be marked as secure. Only enable this option if you are using HTTPS throughout your site as it will break cookie handling otherwise!';
-$helptxt['securityDisable'] = 'This <em>disables</em> the additional password check for the administration section. This is not recommended!';
-$helptxt['securityDisable_why'] = 'This is your current password. (the same one you use to login.)<br /><br />Having to type this helps ensure that you want to do whatever administration you are doing, and that it is <strong>you</strong> doing it.';
-$helptxt['emailmembers'] = 'In this message you can use a few &quot;variables&quot;.  These are:<br />
-	{$board_url} - The URL to your forum.<br />
-	{$current_time} - The current time.<br />
-	{$member.email} - The current member\'s email.<br />
-	{$member.link} - The current member\'s link.<br />
-	{$member.id} - The current member\'s id.<br />
-	{$member.name} - The current member\'s name.  (for personalization.)<br />
-	{$latest_member.link} - The most recently registered member\'s link.<br />
-	{$latest_member.id} - The most recently registered member\'s id.<br />
+	and similar data. It is also recommended that you limit the size of recent posts/news because some clients expect the RSS data to be truncated for display.';
+$helptxt['globalCookies'] = 'Makes log in cookies available across subdomains. For example, if...<br>
+	your site is http://www.example.com/,<br>
+	and your forum is http://forum.example.com/,<br>
+	using this setting will allow you to access the forum\'s cookie on your site. Do not enable this if there are other subdomains (like hacker.example.com) not controlled by you.<br><br>
+	This setting does not function when local cookies are enabled.';
+$helptxt['globalCookiesDomain'] = 'When using subdomain independent cookies (global cookies), you can specify which domain should be used for them. This should, of course, be set to your main domain - for example, if you are using <em>forum.example.com</em> and <em>www.example.com</em>, the domain is <em>example.com</em> in this case. You should not put the <em>http://</em> part in front of it.';
+$helptxt['secureCookies'] = 'Enabling this setting will force the cookies created for users on your forum to be marked as secure. Only enable this setting if you are using HTTPS throughout your site, otherwise it will mean no-one will be able to log in properly!';
+$helptxt['securityDisable'] = 'This <em>disables</em> the additional password check for the administration page. This is not recommended!';
+$helptxt['securityDisable_why'] = 'This is your current password. (the same one you use to login.)<br><br>The requirement to enter this helps ensure that you want to do whatever administration you are doing, and that it is <strong>you</strong> doing it.';
+$helptxt['securityDisable_moderate'] = 'This <em>disables</em> the additional password check for the moderation page. This is not recommended!';
+$helptxt['securityDisable_moderate_why'] = 'This is your current password. (the same one you use to login).<br><br>The requirement to enter this helps ensure that you want to do whatever moderation you are doing, and that it is <strong>you</strong> doing it.';
+$helptxt['email_members'] = 'In this message you can use a few &quot;variables&quot;. These are:<br>
+	{$board_url} - The URL to your forum.<br>
+	{$current_time} - The current time.<br>
+	{$member.email} - The current member\'s email.<br>
+	{$member.link} - The current member\'s link.<br>
+	{$member.id} - The current member\'s id.<br>
+	{$member.name} - The current member\'s name. (for personalization).<br>
+	{$latest_member.link} - The most recently registered member\'s link.<br>
+	{$latest_member.id} - The most recently registered member\'s id.<br>
 	{$latest_member.name} - The most recently registered member\'s name.';
-$helptxt['attachmentEncryptFilenames'] = 'Encrypting attachment filenames allows you to have more than one attachment of the
-	same name, to safely use .php files for attachments, and heightens security.  It, however, could make it more
-	difficult to rebuild your database if something drastic happened.';
-
-$helptxt['failed_login_threshold'] = 'Set the number of failed login attempts before directing the user to the password reminder screen.';
-$helptxt['oldTopicDays'] = 'If this option is enabled a warning will be displayed to the user when attempting to reply to a topic which has not had any new replies for the amount of time, in days, specified by this setting. Set this setting to 0 to disable the feature.';
-$helptxt['edit_wait_time'] = 'Number of seconds allowed for a post to be edited before logging the last edit date.';
-$helptxt['edit_disable_time'] = 'Number of minutes allowed to pass before a user can no longer edit a post they have made. Set to 0 disable. <br /><br /><em>Note: This will not affect any user who has permission to edit other people\'s posts.</em>';
+
+$helptxt['failed_login_threshold'] = 'Set the number of failed login attempts before directing the user to the password reminder page.';
+$helptxt['loginHistoryDays'] = 'The number of days to keep login history under user profile tracking. The default is 30 days.';
+$helptxt['oldTopicDays'] = 'If this setting is enabled, a warning will be displayed to the user when attempting to reply to a topic which has not had any new replies for the amount of time, in days, specified by this setting. Set this setting to 0 to disable the feature.';
+$helptxt['edit_wait_time'] = 'The number of seconds allowed for a post to be edited before logging the last edit date.';
+$helptxt['edit_disable_time'] = 'The number of minutes allowed to pass before a user can no longer edit a post they have made. Set to 0 disable. <br><br><em>Note: This will not affect any user who has permission to edit other people\'s posts.</em>';
+$helptxt['preview_characters'] = 'This setting sets the number of available characters for the first and last message topic preview.';
 $helptxt['posts_require_captcha'] = 'This setting will force users to pass anti-spam bot verification each time they make a post to a board. Only users with a post count below the number set will need to enter the code - this should help combat automated spamming scripts.';
-$helptxt['enableSpellChecking'] = 'Enable spell checking. You MUST have the pspell library installed on your server and your PHP configuration set up to use the pspell library. Your server ' . (function_exists('pspell_new') ? 'DOES' : 'DOES NOT') . ' appear to have this set up.';
+$helptxt['enableSpellChecking'] = 'Enable spell checking. You MUST have the pspell or enchant library installed on your server and your PHP configuration set up to use the installed library. Your server ' . ((function_exists('pspell_new') || function_exists('enchant_broker_init')) ? 'DOES' : 'DOES NOT') . ' appear to have this set up.';
 $helptxt['disable_wysiwyg'] = 'This setting disallows all users from using the WYSIWYG (&quot;What You See Is What You Get&quot;) editor on the post page.';
 $helptxt['lastActive'] = 'Set the number of minutes to show people are active in X number of minutes on the board index. Default is 15 minutes.';
 
-$helptxt['customoptions'] = 'This section defines the options that a user may choose from a drop down list. There are a few key points to note in this section:
+$helptxt['customoptions'] = 'This defines the options that a user may choose from a drop down list. There are a few key points to note on this page:
 	<ul class="normallist">
-		<li><strong>Default Option:</strong> Whichever option box has the &quot;radio button&quot; next to it selected will be the default selection for the user when they enter their profile.</li>
+		<li><strong>Default setting:</strong> Whichever check box has the &quot;radio button&quot; next to it selected will be the default selection for the user when they enter their profile.</li>
 		<li><strong>Removing Options:</strong> To remove an option simply empty the text box for that option - all users with that selected will have their option cleared.</li>
 		<li><strong>Reordering Options:</strong> You can reorder the options by moving text around between the boxes. However - an important note - you must make sure you do <strong>not</strong> change the text when reordering options as otherwise user data will be lost.</li>
 	</ul>';
 
-$helptxt['autoOptDatabase'] = 'This option optimizes the database every so many days.  Set it to 1 to make a daily optimization.  You can also specify a maximum number of online users, so that you won\'t overload your server or inconvenience too many users.';
-$helptxt['autoFixDatabase'] = 'This will automatically fix broken tables and resume like nothing happened.  This can be useful, because the only way to fix it is to REPAIR the table, and this way your forum won\'t be down until you notice.  It does email you when this happens.';
+$helptxt['autoFixDatabase'] = 'This will automatically fix broken tables and resume as if nothing happened. This can be useful, because the only way to fix it is to REPAIR the table, and this way your forum won\'t be down until you notice. It does email you when this happens.';
 
 $helptxt['enableParticipation'] = 'This shows a little icon on the topics the user has posted in.';
 
-$helptxt['db_persist'] = 'Keeps the connection active to increase performance.  If you aren\'t on a dedicated server, this may cause you problems with your host.';
+$helptxt['db_persist'] = 'This keeps the connection active to increase performance. If you aren\'t on a dedicated server, this may cause you problems with your host.';
 $helptxt['ssi_db_user'] = 'Optional setting to use a different database user and password when you are using SSI.php.';
 
-$helptxt['queryless_urls'] = 'This changes the format of URLs a little so search engines will like them better.  They will look like index.php/topic,1.0.html.<br /><br />This feature will ' . (isset($_SERVER['SERVER_SOFTWARE']) && (strpos($_SERVER['SERVER_SOFTWARE'], 'Apache') !== false || strpos($_SERVER['SERVER_SOFTWARE'], 'lighttpd') !== false) ? '' : 'not') . ' work on your server.';
-$helptxt['countChildPosts'] = 'Checking this option will mean that posts and topics in a board\'s child board will count toward its totals on the index page.<br /><br />This will make things notably slower, but means that a parent with no posts in it won\'t show \'0\'.';
-$helptxt['fixLongWords'] = 'This option breaks words longer than a certain length into pieces so they don\'t disturb the forum\'s layout. (as much...)  This option should not be set to a value under 40. This option will not work with forums using UTF-8 and PHP less than 4.4.0. This ' . (empty($GLOBALS['context']['utf8']) || version_compare(PHP_VERSION, '4.4.0') != -1 ? 'WILL' : 'WILL NOT') . ' work on your server';
-$helptxt['allow_ignore_boards'] = 'Checking this option will allow users to select boards they wish to ignore.';
+$helptxt['queryless_urls'] = 'This changes the format of URLs a little so search engines will like them better. They will look like index.php/topic,1.0.html.<br><br>This feature will ' . (isset($_SERVER['SERVER_SOFTWARE']) && (strpos($_SERVER['SERVER_SOFTWARE'], 'Apache') !== false || strpos($_SERVER['SERVER_SOFTWARE'], 'lighttpd') !== false) ? '' : 'not') . ' work on your server.';
+$helptxt['countChildPosts'] = 'Checking this setting means that posts and topics in a board\'s sub-board will count toward its totals on the index page.<br><br>This will make things notably slower, but means that a parent with no posts in it won\'t show \'0\'.';
+$helptxt['allow_ignore_boards'] = 'Checking this setting will allow users to select boards they wish to ignore.';
+$helptxt['deny_boards_access'] = 'Checking this setting will allow you to deny access to certain boards based on membergroup access';
 
-$helptxt['who_enabled'] = 'This option allows you to turn on or off the ability for users to see who is browsing the forum and what they are doing.';
+$helptxt['who_enabled'] = 'This setting allows you to turn on or off the ability for users to see who is browsing the forum and what they are doing.';
 
 $helptxt['recycle_enable'] = '&quot;Recycles&quot; deleted topics and posts to the specified board.';
 
-$helptxt['enableReportPM'] = 'This option allows your users to report personal messages they receive to the administration team. This may be useful in helping to track down any abuse of the personal messaging system.';
-$helptxt['max_pm_recipients'] = 'This option allows you to set the maximum amount of recipients allowed in a single personal message sent by a forum member. This may be used to help stop spam abuse of the PM system. Note that users with permission to send newsletters are exempt from this restriction. Set to zero for no limit.';
+$helptxt['enableReportPM'] = 'This setting allows your users to report personal messages they receive to the administration team. This may be useful in helping to track down any abuse of the personal messaging system.';
+$helptxt['max_pm_recipients'] = 'This setting allows you to set the maximum amount of recipients allowed in a single personal message sent by a forum member. This may be used to help stop spam abuse of the PM system. Note that users with permission to send newsletters are exempt from this restriction. Set to zero for no limit.';
 $helptxt['pm_posts_verification'] = 'This setting will force users to enter a code shown on a verification image each time they are sending a personal message. Only users with a post count below the number set will need to enter the code - this should help combat automated spamming scripts.';
 $helptxt['pm_posts_per_hour'] = 'This will limit the number of personal messages which may be sent by a user in a one hour period. This does not affect admins or moderators.';
 
-$helptxt['default_personal_text'] = 'Sets the default text a new user will have as their &quot;personal text.&quot;';
-
-$helptxt['modlog_enabled'] = 'Logs all moderation actions.';
-
-$helptxt['guest_hideContacts'] = 'If selected this option will hide the email addresses and messenger contact details
-	of all members from any guests on your forum';
+$helptxt['default_personal_text'] = 'Sets the default text a new user will have as their &quot;personal text.&quot; This setting is not available when personal text is disabled, or when users can set personal text on registration for themselves.';
 
-$helptxt['registration_method'] = 'This option determines what method of registration is used for people wishing to join your forum. You can select from:<br /><br />
+$helptxt['registration_method'] = 'This setting determines what method of registration is used for people wishing to join your forum. You can select from:<br><br>
 	<ul class="normallist">
 		<li>
-			<strong>Registration Disabled</strong><br />
-				Disables the registration process, which means that no new members can register to join your forum.<br />
+			<strong>Registration Disabled</strong><br>
+				Disables the registration process, which means that no new members can register to join your forum.<br>
 		</li><li>
-			<strong>Immediate Registration</strong><br />
-				New members can login and post immediately after registering on your forum.<br />
+			<strong>Immediate Registration</strong><br>
+				New members can login and post immediately after registering on your forum.<br>
 		</li><li>
-			<strong>Email Activation</strong><br />
-				When this option is enabled any members registering with the forum will have an activation link emailed to them which they must click before they can become full members.<br />
+			<strong>Email Activation</strong><br>
+				When this setting is enabled any members registering with the forum will have an activation link emailed to them which they must click before they can become full members.<br>
 		</li><li>
-			<strong>Admin Approval</strong><br />
-				This option will make it so all new members registering to your forum will need to be approved by the admin before they become members.
+			<strong>Admin Approval</strong><br>
+				This setting will make it so all new members registering on your forum will need to be approved by the admin before they become members.
 		</li>
 	</ul>';
-$helptxt['register_openid'] = '<strong>Authenticate with OpenID</strong><br />
-	OpenID is a means of using one username across different websites, to simplify the online experience. To use OpenID you first need to create an OpenID account - a list of providers can be found on the <a href="http://openid.net/" target="_blank">OpenID Official Site</a><br /><br />
-	Once you have an OpenID account simply enter your unique identification URL into the OpenID input box and submit. You will then be taken to your providers site to verify your identity before being passed back to this site.<br /><br />
-	On your first visit to this site you will be asked to confirm a couple of details before you will be recognized, after which you can login to this site and change your profile settings using just your OpenID.<br /><br />
-	For more information please visit the <a href="http://openid.net/" target="_blank">OpenID Official Site</a>';
 
-$helptxt['send_validation_onChange'] = 'When this option is checked all members who change their email address in their profile will have to reactivate their account from an email sent to that address';
-$helptxt['send_welcomeEmail'] = 'When this option is enabled all new members will be sent an email welcoming them to your community';
+$helptxt['send_validation_onChange'] = 'When this setting is checked all members who change their email address in their profile will have to reactivate their account from an email sent to that address';
+$helptxt['send_welcomeEmail'] = 'When this setting is enabled all new members will be sent an email welcoming them to your community';
 $helptxt['password_strength'] = 'This setting determines the strength required for passwords selected by your forum users. The stronger the password, the harder it should be to compromise member\'s accounts.
-	Its possible options are:
+	Its possible settings are:
 	<ul class="normallist">
 		<li><strong>Low:</strong> The password must be at least four characters long.</li>
-		<li><strong>Medium:</strong> The password must be at least eight characters long, and can not be part of a users name or email address.</li>
+		<li><strong>Medium:</strong> The password must be at least eight characters long, and cannot be part of a user\'s name or email address.</li>
 		<li><strong>High:</strong> As for medium, except the password must also contain a mixture of upper and lower case letters, and at least one number.</li>
 	</ul>';
+$helptxt['enable_password_conversion'] = 'By enabling this setting, SMF will attempt to detect passwords stored in other formats and convert them to the format SMF uses. Typically this is used for forums converted to SMF, but may have other uses as well. Disabling this prevents a user from logging in using their password after a conversion and they would need to reset their password.';
 
-$helptxt['coppaAge'] = 'The value specified in this box will determine the minimum age that new members must be to be granted immediate access to the forums.
+$helptxt['coppaAge'] = 'The value specified in this box will determine the minimum age that new members must be in order to be granted immediate access to the forums.
 	On registration they will be prompted to confirm whether they are over this age, and if not will either have their application rejected or suspended awaiting parental approval - dependant on the type of restriction chosen.
 	If a value of 0 is chosen for this setting then all other age restriction settings shall be ignored.';
-$helptxt['coppaType'] = 'If age restrictions are enabled, then this setting will define that happens when a user below the minimum age attempts to register with your forum. There are two possible choices:
+$helptxt['coppaType'] = 'If age restrictions are enabled, then this setting will define what happens when a user below the minimum age attempts to register with your forum. There are two possible choices:
 	<ul class="normallist">
 		<li>
-			<strong>Reject Their Registration:</strong><br />
-				Any new member below the minimum age will have their registration rejected immediately.<br />
+			<strong>Reject Their Registration:</strong><br>
+				Any new member below the minimum age will have their registration rejected immediately.<br>
 		</li><li>
-			<strong>Require Parent/Guardian Approval</strong><br />
-				Any new member who attempts to register and is below the minimum permitted age will have their account marked as awaiting approval, and will be presented with a form upon which their parents must give permission to become a member of the forums.
-				They will also be presented with the forum contact details entered on the settings page, so they can send the form to the administrator by mail or fax.
+			<strong>Require Parent/Guardian Approval</strong><br>
+				Any new member who attempts to register and is below the minimum permitted age will have their account marked as awaiting approval, and will be presented with a form upon which their parents must give permission to become a member of the forum.
+				They will also be presented with the forum contact details entered on the settings page, so that they can send the form to the administrator by mail or fax.
 		</li>
 	</ul>';
 $helptxt['coppaPost'] = 'The contact boxes are required so that forms granting permission for underage registration can be sent to the forum administrator. These details will be shown to all new minors, and are required for parent/guardian approval. At the very least a postal address or fax number must be provided.';
 
-$helptxt['allow_hideOnline'] = 'With this option enabled all members will be able to hide their online status from other users (except administrators). If disabled only users who can moderate the forum can hide their presence. Note that disabling this option will not change any existing member\'s status - it just stops them from hiding themselves in the future.';
-$helptxt['make_email_viewable'] = 'If this option is enabled instead of users email addresses being hidden to normal members and guests they will be publicly viewable on the forum. Enabling this will put your users at greater risk of being victims of spam as a result of email harvesters visiting your forum. Note this setting does not override the user setting for hiding their email address from users. Enabling this setting is <strong>not</strong> recommended.';
+$helptxt['allow_hideOnline'] = 'With this setting enabled all members will be able to hide their online status from other users (except administrators). If disabled, only users who can moderate the forum can hide their presence. Note that disabling this setting will not change any existing member\'s status - it just stops them from hiding themselves in the future.';
 $helptxt['meta_keywords'] = 'These keywords are sent in the output of every page to indicate to search engines (etc) the key content of your site. They should be a comma separated list of words, and should not use HTML.';
 
-$helptxt['latest_support'] = 'This panel shows you some of the most common problems and questions on your server configuration. Don\'t worry, this information isn\'t logged or anything.<br /><br />If this stays as &quot;Retrieving support information...&quot;, your computer probably cannot connect to <a href="http://www.simplemachines.org/" target="_blank" class="new_win">www.simplemachines.org</a>.';
-$helptxt['latest_packages'] = 'Here you can see some of the most popular and some random packages or mods, with quick and easy installations.<br /><br />If this section doesn\'t show up, your computer probably cannot connect to <a href="http://www.simplemachines.org/" target="_blank" class="new_win">www.simplemachines.org</a>.';
-$helptxt['latest_themes'] = 'This area shows a few of the latest and most popular themes from <a href="http://www.simplemachines.org/" target="_blank" class="new_win">www.simplemachines.org</a>.  It may not show up properly if your computer can\'t find <a href="http://www.simplemachines.org/" target="_blank" class="new_win">www.simplemachines.org</a>, though.';
+$helptxt['latest_themes'] = 'This area shows a few of the latest and most popular themes from <a href="http://www.simplemachines.org/" target="_blank" class="new_win">www.simplemachines.org</a>. It may not show up properly if your computer can\'t find <a href="http://www.simplemachines.org/" target="_blank" class="new_win">www.simplemachines.org</a>, though.';
 
 $helptxt['secret_why_blank'] = 'For your security, your password and the answer to your secret question are encrypted so that the SMF software will never tell you, or anyone else, what they are.';
-$helptxt['moderator_why_missing'] = 'Since moderation is done on a board-by-board basis, you have to make members moderators from the <a href="javascript:window.open(\'%1$s?action=admin;area=manageboards\'); self.close();">board management interface</a>.';
+$helptxt['moderator_why_missing'] = 'Since moderation is done on a board-by-board basis, you have to make members moderators from the <a href="%1$s?action=admin;area=manageboards" target="_blank" class="new_win">board management interface</a>.';
 
-$helptxt['permissions'] = 'Permissions are how you either allow groups to, or deny groups from, doing specific things.<br /><br />You can modify multiple boards at once with the checkboxes, or look at the permissions for a specific group by clicking \'Modify.\'';
-$helptxt['permissions_board'] = 'If a board is set to \'Global,\' it means that the board will not have any special permissions.  \'Local\' means it will have its own permissions - separate from the global ones.  This allows you to have a board that has more or less permissions than another, without requiring you to set them for each and every board.';
-$helptxt['permissions_quickgroups'] = 'These allow you to use the &quot;default&quot; permission setups - standard means \'nothing special\', restrictive means \'like a guest\', moderator means \'what a moderator has\', and lastly \'maintenance\' means permissions very close to those of an administrator.';
-$helptxt['permissions_deny'] = 'Denying permissions can be useful when you want take away permission from certain members. You can add a membergroup with a \'deny\'-permission to the members you wish to deny a permission.<br /><br />Use with care, a denied permission will stay denied no matter what other membergroups the member is in.';
-$helptxt['permissions_postgroups'] = 'Enabling permissions for post count based groups will allow you to attribute permissions to members that have posted a certain amount of messages. The permissions of the post count based groups are <em>added</em> to the permissions of the regular membergroups.';
-$helptxt['membergroup_guests'] = 'The Guests membergroup are all users that are not logged in.';
+$helptxt['permissions'] = 'Permissions are how you either allow groups to, or deny groups from, doing specific things.<br><br>You can modify multiple boards at once with the checkboxes, or look at the permissions for a specific group by clicking \'Modify.\'';
+$helptxt['permissions_board'] = 'If a board is set to \'Global,\' it means that the board will not have any special permissions. \'Local\' means it will have its own permissions - separate from the global ones. This allows you to have a board that has more or fewer permissions than another, without requiring you to set them for each and every board.';
+$helptxt['permissions_quickgroups'] = 'These allow you to use the &quot;default&quot; permission setups -  <em>standard</em> means \'nothing special\', <em>restrictive</em> means \'like a guest\', <em>moderator</em> means \'what a moderator has\', and lastly <em>maintenance</em> means \'permissions very close to those of an administrator\'.';
+$helptxt['permissions_deny'] = 'Denying permissions can be useful when you want to take away permission from certain members. You can add a membergroup with a \'deny\'-permission to the members you wish to deny a permission.<br><br><strong>Use with care</strong>, a denied permission will stay denied no matter what other membergroups the member is in.';
+$helptxt['permissions_postgroups'] = 'Enabling permissions for groups based on post count will allow you to attribute permissions to members that have posted a certain amount of messages. The permissions of the post count based groups are <em>added</em> to the permissions of the regular membergroups.';
+$helptxt['membergroup_guests'] = 'The Guests membergroup is for all users that are not logged in.';
 $helptxt['membergroup_regular_members'] = 'The Regular Members are all members that are logged in, but that have no primary membergroup assigned.';
 $helptxt['membergroup_administrator'] = 'The administrator can, per definition, do anything and see any board. There are no permission settings for the administrator.';
-$helptxt['membergroup_moderator'] = 'The Moderator membergroup is a special membergroup. Permissions and settings assigned to this group apply to moderators but only <em>on the boards they moderate</em>. Outside these boards they\'re just like any other member.';
+$helptxt['membergroup_moderator'] = 'The Moderator membergroup is a special membergroup. Permissions and settings assigned to this group apply to moderators but only <em>on the boards they moderate</em>. Outside these boards they\'re just like any other member. Note that permissions for this group also apply to any group assigned to moderate a board.';
 $helptxt['membergroups'] = 'In SMF there are two types of groups that your members can be part of. These are:
 	<ul class="normallist">
-		<li><strong>Regular Groups:</strong> A regular group is a group to which members are not automatically put into. To assign a member to be in a group simply go to their profile and click &quot;Account Settings&quot;. From here you can assign them any number of regular groups to which they will be part.</li>
+		<li><strong>Regular Groups:</strong> A regular group is a group which members are not automatically placed. To assign a member to be in a group simply go to their profile and click &quot;Account Settings&quot;. From here you can assign them any number of regular groups to which they will be part.</li>
 		<li><strong>Post Groups:</strong> Unlike regular groups post based groups cannot be assigned. Instead, members are automatically assigned to a post based group when they reach the minimum number of posts required to be in that group.</li>
 	</ul>';
 
 $helptxt['calendar_how_edit'] = 'You can edit these events by clicking on the red asterisk (*) next to their names.';
 
-$helptxt['maintenance_backup'] = 'This area allows you to save a copy of all the posts, settings, members, and other information in your forum to a very large file.<br /><br />It is recommended that you do this often, perhaps weekly, for safety and security.';
-$helptxt['maintenance_rot'] = 'This allows you to <strong>completely</strong> and <strong>irrevocably</strong> remove old topics.  It is recommended that you try to make a backup first, just in case you remove something you didn\'t mean to.<br /><br />Use this option with care.';
-$helptxt['maintenance_members'] = 'This allows you to <strong>completely</strong> and <strong>irrevocably</strong> remove member accounts from your forum.  It is <strong>highly</strong> recommended that you try to make a backup first, just in case you remove something you didn\'t mean to.<br /><br />Use this option with care.';
-
-$helptxt['avatar_server_stored'] = 'This allows your members to pick from avatars stored on your server itself.  They are, generally, in the same place as SMF under the avatars folder.<br />As a tip, if you create directories in that folder, you can make &quot;categories&quot; of avatars.';
-$helptxt['avatar_external'] = 'With this enabled, your members can type in a URL to their own avatar.  The downside of this is that, in some cases, they may use avatars that are overly large or portray images you don\'t want on your forum.';
-$helptxt['avatar_download_external'] = 'With this option enabled, the URL given by the user is accessed to download the avatar at that location. On success, the avatar will be treated as uploadable avatar.';
-$helptxt['avatar_upload'] = 'This option is much like &quot;Allow members to select an external avatar&quot;, except that you have better control over the avatars, a better time resizing them, and your members do not have to have somewhere to put avatars.<br /><br />However, the downside is that it can take a lot of space on your server.';
-$helptxt['avatar_download_png'] = 'PNGs are larger, but offer better quality compression.  If this is unchecked, JPEG will be used instead - which is often smaller, but also of lesser or blurry quality.';
-
-$helptxt['disableHostnameLookup'] = 'This disables host name lookups, which on some servers are very slow.  Note that this will make banning less effective.';
-
-$helptxt['search_weight_frequency'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br /><br />This factor counts the amount of matching messages and divides them by the total number of messages within a topic.';
-$helptxt['search_weight_age'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br /><br />This factor rates the age of the last matching message within a topic. The more recent this message is, the higher the score.';
-$helptxt['search_weight_length'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br /><br />This factor is based on the topic size. The more messages are within the topic, the higher the score.';
-$helptxt['search_weight_subject'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br /><br />This factor looks whether a search term can be found within the subject of a topic.';
-$helptxt['search_weight_first_message'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br /><br />This factor looks whether a match can be found in the first message of a topic.';
-$helptxt['search_weight_sticky'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br /><br />This factor looks whether a topic is sticky and increases the relevancy score if it is.';
+$helptxt['maintenance_backup'] = 'This area allows you to save a copy of all the posts, settings, members, and other information in your forum to a very large file.<br><br>It is recommended that you do this often, perhaps weekly, for safety and security.';
+$helptxt['maintenance_rot'] = 'This allows you to <strong>completely</strong> and <strong>irrevocably</strong> remove old topics. It is recommended that you try to make a backup first, just in case you remove something you didn\'t mean to.<br><br><strong>Use this setting with care.</strong>';
+$helptxt['maintenance_members'] = 'This allows you to <strong>completely</strong> and <strong>irrevocably</strong> remove member accounts from your forum. It is <strong>highly</strong> recommended that you try to make a backup first, just in case you remove something you didn\'t mean to.<br><br><strong>Use this setting with care.</strong>';
+
+$helptxt['avatar_server_stored'] = 'This allows your members to pick from avatars stored on your server itself. They are, generally, in the same place as SMF under the avatars directory.<br>As a tip, if you create directories in that folder, you can make &quot;categories&quot; of avatars.';
+$helptxt['avatar_external'] = 'With this enabled, your members can type in a URL to their own avatar. The downside of this is that, in some cases, they may use avatars that are overly large or portray images you don\'t want on your forum.';
+$helptxt['avatar_download_external'] = 'With this setting enabled, the URL given by the user is accessed to download the avatar at that location. On success, the avatar will be treated as uploadable avatar.';
+$helptxt['avatar_action_too_large'] = 'This setting therefore lets you reject images (from other sites) that are too big, or tells the user\'s browser to resize them, or to download them to your server.<br><br>If users put in very large images as their avatars and resize in the browser, it could cause very slow loading for your users - it does not actually resize the file, it just displays it smaller. So a digital photo, for example, would still be loaded in full and then resized only when displayed - so for users this could get quite slow and use a lot of bandwidth.<br><br>On the other hand, downloading them means using your bandwidth and server space, but you also ensure that images are smaller, so it should be faster for users. (Note: downloading and resizing requires either the GD library, or ImageMagick using either the Imagick or MagickWand extensions)';
+$helptxt['avatar_upload'] = 'This setting is much like &quot;Allow members to select an external avatar&quot;, except that you have better control over the avatars, a better time resizing them, and your members do not have to have somewhere to put avatars.<br><br>However, the downside is that it can take a lot of space on your server.';
+$helptxt['avatar_download_png'] = 'PNGs are larger, but offer better quality compression. If this is unchecked, JPEG will be used instead - which is often smaller, but also of lesser or blurry quality.';
+
+$helptxt['disableHostnameLookup'] = 'This disables host name lookups, which on some servers are very slow. Note that this will make banning less effective.';
+
+$helptxt['search_weight_frequency'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br><br>This factor counts the amount of matching messages and divides them by the total number of messages within a topic.';
+$helptxt['search_weight_age'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br><br>This factor rates the age of the last matching message within a topic. The more recent this message is, the higher the score.';
+$helptxt['search_weight_length'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br><br>This factor is based on the topic size. The more messages are within the topic, the higher the score.';
+$helptxt['search_weight_subject'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br><br>This factor looks whether a search term can be found within the subject of a topic.';
+$helptxt['search_weight_first_message'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br><br>This factor looks whether a match can be found in the first message of a topic.';
+$helptxt['search_weight_sticky'] = 'Weight factors are used to determine the relevancy of a search result. Change these weight factors to match the things that are specifically important for your forum. For instance, a forum of a news site, might want a relatively high value for \'age of last matching message\'. All values are relative in relation to each other and should be positive integers.<br><br>This factor looks whether a topic is sticky and increases the relevancy score if it is.';
 $helptxt['search'] = 'Adjust all settings for the search function here.';
-$helptxt['search_why_use_index'] = 'A search index can greatly improve the performance of searches on your forum. Especially when the number of messages on a forum grows bigger, searching without an index can take a long time and increase the pressure on your database. If your forum is bigger than 50.000 messages, you might want to consider creating a search index to assure peak performance of your forum.<br /><br />Note that a search index can take up quite some space. A fulltext index is a built-in index of MySQL. It\'s relatively compact (approximately the same size as the message table), but a lot of words aren\'t indexed and it can, in some search queries, turn out to be very slow. The custom index is often bigger (depending on your configuration it can be up to 3 times the size of the messages table) but it\'s performance is better than fulltext and relatively stable.';
+$helptxt['search_why_use_index'] = 'A search index can greatly improve the performance of searches on your forum. Especially when the number of messages on a forum grows bigger, searching without an index can take a long time and increase the pressure on your database. If your forum is bigger than 50.000 messages, you might want to consider creating a search index to assure peak performance of your forum.<br><br>Note that a search index can take up quite some space. A fulltext index is a built-in index of MySQL. It\'s relatively compact (approximately the same size as the message table), but a lot of words aren\'t indexed and it can, in some search queries, turn out to be very slow. The custom index is often bigger (depending on your configuration it can be up to 3 times the size of the messages table) but it\'s performance is better than fulltext and relatively stable.';
 
-$helptxt['see_admin_ip'] = 'IP addresses are shown to administrators and moderators to facilitate moderation and to make it easier to track people up to no good.  Remember that IP addresses may not always be identifying, and most people\'s IP addresses change periodically.<br /><br />Members are also allowed to see their own IPs.';
-$helptxt['see_member_ip'] = 'Your IP address is shown only to you and moderators.  Remember that this information is not identifying, and that most IPs change periodically.<br /><br />You cannot see other members\' IP addresses, and they cannot see yours.';
+$helptxt['see_admin_ip'] = 'IP addresses are shown to administrators and moderators to facilitate moderation and to make it easier to track people up to no good. Remember that IP addresses may not always be identifying, and most people\'s IP addresses change periodically.<br><br>Members are also allowed to see their own IPs.';
+$helptxt['see_member_ip'] = 'Your IP address is shown only to you and moderators. Remember that this information is not identifying, and that most IPs change periodically.<br><br>You cannot see other members\' IP addresses, and they cannot see yours.';
 $helptxt['whytwoip'] = 'SMF uses various methods to detect user IP addresses. Usually these two methods result in the same address but in some cases more than one address may be detected. In this case SMF logs both addresses, and uses them both for ban checks (etc). You can click on either address to track that IP and ban if necessary.';
 
-$helptxt['ban_cannot_post'] = 'The \'cannot post\' restriction turns the forum into read-only mode for the banned user. The user cannot create new topics, or reply to existing ones, send personal messages or vote in polls. The banned user can however still read personal messages and topics.<br /><br />A warning message is shown to the users that are banned this way.';
+$helptxt['ban_cannot_post'] = 'The \'cannot post\' restriction turns the forum into read-only mode for the banned user. The user cannot create new topics, or reply to existing ones, send personal messages or vote in polls. The banned user can however still read personal messages and topics.<br><br>A warning message is shown to the users that are banned this way.';
 
 $helptxt['posts_and_topics'] = '
 	<ul class="normallist">
 		<li>
-			<strong>Post Settings</strong><br />
+			<strong>Post Settings</strong><br>
 			Modify the settings related to the posting of messages and the way messages are shown. You can also enable the spell check here.
 		</li><li>
-			<strong>Bulletin Board Code</strong><br />
+			<strong>Bulletin Board Code</strong><br>
 			Enable the code that shows forum messages in the right layout. Also adjust which codes are allowed and which aren\'t.
 		</li><li>
 			<strong>Censored Words</strong>
 			In order to keep the language on your forum under control, you can censor certain words. This function allows you to convert forbidden words into innocent versions.
 		</li><li>
 			<strong>Topic Settings</strong>
-			Modify the settings related to topics. The number of topics per page, whether sticky topics are enabled or not, the number of messages needed for a topic to be hot, etc.
+			Modify the settings related to topics. The number of topics per page, whether the print-page view is enabled, etc.
 		</li>
 	</ul>';
-$helptxt['spider_group'] = 'By selecting a restrictive group, when a guest is detected as a search crawler it will automatically be assigned any &quot;deny&quot; deny permissions of this group in addition to the normal permissions of a guest. You can use this to provide lesser access to a search engine than you would a normal guest. You might for example wish to create a new group called &quot;Spiders&quot; and select that here. You could then deny permission for that group to view profiles to stop spiders indexing your members profiles.<br />Note: Spider detection is not perfect and can be simulated by users so this feature is not guaranteed to restrict content only to those search engines you have added.';
-$helptxt['show_spider_online'] = 'This setting allows you to select whether spiders should be listed in the who\'s online list on the board index and &quot;Who\'s Online&quot; page. Options are:
+
+$helptxt['spider_mode'] = 'Sets the logging level.<br>
+Standard - Logs minimal spider activity.<br>
+Moderate - Provides more accurate statistics.<br>
+Agressive - As for &quot;Moderate&quot; but logs data about each page visited.';
+
+$helptxt['spider_group'] = 'By selecting a restrictive group, when a guest is detected as a search crawler it will automatically be assigned any &quot;deny&quot; deny permissions of this group in addition to the normal permissions of a guest. You can use this to provide lesser access to a search engine than you would a normal guest. You might for example wish to create a new group called &quot;Spiders&quot; and select that here. You could then deny permission for that group to view profiles to stop spiders indexing your members profiles.<br>Note: Spider detection is not perfect and can be simulated by users so this feature is not guaranteed to restrict content only to those search engines you have added.';
+$helptxt['show_spider_online'] = 'This setting allows you to select whether spiders should be listed in the &quot;Who\'s Online&quot; list on the board index and &quot;Who\'s Online&quot; page. The options are:
 	<ul class="normallist">
 		<li>
-			<strong>Not at All</strong><br />
+			<strong>Not at All</strong><br>
 			Spiders will simply appear as guests to all users.
 		</li><li>
-			<strong>Show Spider Quantity</strong><br />
+			<strong>Show Spider Quantity</strong><br>
 			The Board Index will display the number of spiders currently visiting the forum.
 		</li><li>
-			<strong>Show Spider Names</strong><br />
+			<strong>Show Spider Names</strong><br>
 			Each spider name will be revealed, so users can see how many of each spider is currently visiting the forum - this takes effect in both the Board Index and Who\'s Online page.
 		</li><li>
-			<strong>Show Spider Names - Admin Only</strong><br />
+			<strong>Show Spider Names - Admin Only</strong><br>
 			As above except only Administrators can see spider status - to all other users spiders appear as guests.
 		</li>
 	</ul>';
 
-$helptxt['birthday_email'] = 'Choose the index of the birthday email message to use.  A preview will be shown in the Email Subject and Email Body fields.<br /><strong>Note:</strong> Setting this option does not automatically enable birthday emails.  To enable birthday emails use the <a href="%1$s?action=admin;area=scheduledtasks;%3$s=%2$s" target="_blank" class="new_win">Scheduled Tasks</a> page and enable the birthday email task.';
-$helptxt['pm_bcc'] = 'When sending a personal message you can choose to add a recipient as BCC or &quot;Blind Carbon Copy&quot;. BCC recipients do not have their identities revealed to other recipients of the message.';
+$helptxt['birthday_email'] = 'Choose the index of the birthday email message to use. A preview will be shown in the Email Subject and Email Body fields.<br><strong>Note:</strong> Selecting this setting does not automatically enable birthday emails. To enable birthday emails use the <a href="%1$s?action=admin;area=scheduledtasks;%3$s=%2$s" target="_blank" class="new_win">Scheduled Tasks</a> page and enable the birthday email task.';
+$helptxt['pm_bcc'] = 'When sending a personal message you can choose to add a recipient as BCC (Blind Carbon Copy). BCC recipients do not have their identities revealed to the other recipients of the message.';
 
 $helptxt['move_topics_maintenance'] = 'This will allow you to move all the posts from one board to another board.';
 $helptxt['maintain_reattribute_posts'] = 'You can use this function to attribute guest posts on your board to a registered member. This is useful if, for example, a user deleted their account and changed their mind and wished to have their old posts associated with their account.';
 $helptxt['chmod_flags'] = 'You can manually set the permissions you wish to set the selected files to. To do this enter the chmod value as a numeric (octet) value. Note - these flags will have no effect on Microsoft Windows operating systems.';
 
-$helptxt['postmod'] = 'This section allows members of the moderation team (with sufficient permissions) to approve any posts and topics before they are shown.';
+$helptxt['postmod'] = 'This page allows members of the moderation team (with sufficient permissions) to approve any posts and topics before they are shown.';
 
-$helptxt['field_show_enclosed'] = 'Encloses the user input between some text or html.  This will allow you to add more instant message providers, images or an embed etc. For example:<br /><br />
-		&lt;a href="http://website.com/{INPUT}"&gt;&lt;img src="{DEFAULT_IMAGES_URL}/icon.gif" alt="{INPUT}" /&gt;&lt;/a&gt;<br /><br />
-		Note that you can use the following variables:<br />
+$helptxt['field_show_enclosed'] = 'Encloses the user input between some text or html. This will allow you to add more instant message providers, images or an embed etc. For example:<br><br>
+		&lt;a href="http://website.com/{INPUT}"&gt;&lt;img src="{DEFAULT_IMAGES_URL}/icon.png" alt="{INPUT}" /&gt;&lt;/a&gt;<br><br>
+		Note that you can use the following variables:<br>
 		<ul class="normallist">
 			<li>{INPUT} - The input specified by the user.</li>
 			<li>{SCRIPTURL} - Web address of forum.</li>
-			<li>{IMAGES_URL} - Url to images folder in the users current theme.</li>
-			<li>{DEFAULT_IMAGES_URL} - Url to the images folder in the default theme.</li>
+			<li>{IMAGES_URL} - Url to images directory in the users current theme.</li>
+			<li>{DEFAULT_IMAGES_URL} - Url to the images directory in the default theme.</li>
 		</ul>';
 
-$helptxt['custom_mask'] = 'The input mask is important for your forum\'s security. Validating the input from a user can help ensure that data is not used in a way you do not expect. We have provided some simple regular expressions as hints.<br /><br />
+$helptxt['custom_mask'] = 'The input mask is important for your forum\'s security. Validating the input from a user can help ensure that data is not used in a way you do not expect. We have provided some simple regular expressions as hints.<br><br>
 	<div class="smalltext" style="margin: 0 2em">
-		&quot;[A-Za-z]+&quot; - Match all upper and lower case alphabet characters.<br />
-		&quot;[0-9]+&quot; - Match all numeric characters.<br />
-		&quot;[A-Za-z0-9]{7}&quot; - Match all upper and lower case alphabet and numeric characters seven times.<br />
-		&quot;[^0-9]?&quot; - Forbid any number from being matched.<br />
-		&quot;^([A-Fa-f0-9]{3}|[A-Fa-f0-9]{6})$&quot; - Only allow 3 or 6 character hexcodes.<br />
-	</div><br /><br />
+		&quot;~[A-Za-z]+~&quot; - Match all upper and lower case alphabet characters.<br>
+		&quot;~[0-9]+~&quot; - Match all numeric characters.<br>
+		&quot;~[A-Za-z0-9]{7}~&quot; - Match all upper and lower case alphabet and numeric characters seven times.<br>
+		&quot;~[^0-9]?~&quot; - Forbid any number from being matched.<br>
+		&quot;~^([A-Fa-f0-9]{3}|[A-Fa-f0-9]{6})$~&quot; - Only allow 3 or 6 character hexcodes.<br>
+	</div><br><br>
 	Additionally, special metacharacters ?+*^$ and {xx} can be defined.
 	<div class="smalltext" style="margin: 0 2em">
-		? - None or one match of previous expression.<br />
-		+ - One or more of previous expression.<br />
-		* - None or more of previous expression.<br />
-		{xx} - An exact number from previous expression.<br />
-		{xx,} - An exact number or more from previous expression.<br />
-		{,xx} - An exact number or less from previous expression.<br />
-		{xx,yy} - An exact match between the two numbers from previous expression.<br />
-		^ - Start of string.<br />
-		$ - End of string.<br />
-		\ - Escapes the next character.<br />
-	</div><br /><br />
-	More information and advanced techniques may be found on the internet.';
-
+		? - None or one match of previous expression.<br>
+		+ - One or more of previous expression.<br>
+		* - None or more of previous expression.<br>
+		{xx} - An exact number from previous expression.<br>
+		{xx,} - An exact number or more from previous expression.<br>
+		{,xx} - An exact number or less from previous expression.<br>
+		{xx,yy} - An exact match between the two numbers from previous expression.<br>
+		^ - Start of string.<br>
+		$ - End of string.<br>
+		\ - Escapes the next character.<br>
+	</div><br><br>
+	More information and advanced techniques may be found on the Internet.';
+
+$helptxt['topic_move_any'] = 'If checked, users will be allowed to move topics to any board they can see. Otherwise, they will only be able to move them to boards where they can post new topics.';
+
+$helptxt['alert_pm_new'] = 'Notifications of new personal messages do not appear in the Alerts pane, but appear in the "My Messages" list instead.';
+$helptxt['alert_event_new'] = 'This will send out an alert or email as requested if there is a new calendar event added. However, if that event is posted and a topic is added, you will not get an alert for the event if you\'re already following that board - the alert from following the board would cover this.';
+
+$helptxt['force_ssl'] = '<b>Test SSL and HTTPS on your server properly before enabling this, it may cause your forum to become inaccessible.</b> Enable maintenance mode if you are unable to access the forum after enabling this';
+$helptxt['image_proxy_enabled'] = 'Required for embedding external images when in full SSL';
+$helptxt['image_proxy_secret'] = 'Keep this a secret, protects your forum from hotlinking images. Change it in order to render current hotlinked images useless';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/index.english.php b/Themes/default/languages/index.english.php
--- a/Themes/default/languages/index.english.php	2014-06-16 10:10:18.000000000 -0700
+++ b/Themes/default/languages/index.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,7 +1,7 @@
 <?php
-// Version: 2.0.8; index
+// Version: 2.1 Beta 1; index
 
-global $forum_copyright, $forum_version, $webmaster_email, $scripturl, $context, $boardurl;
+global $forum_copyright, $webmaster_email, $scripturl, $context, $boardurl;
 
 // Locale (strftime, pspell_new) and spelling. (pspell_new, can be left as '' normally.)
 // For more information see:
@@ -16,28 +16,30 @@
 $txt['lang_character_set'] = 'ISO-8859-1';
 // Character set and right to left?
 $txt['lang_rtl'] = false;
-// Capitalize day and month names?
-$txt['lang_capitalize_dates'] = true;
+// Number format.
+$txt['number_format'] = '1,234.00';
 
+$txt['days_title'] = 'Days';
 $txt['days'] = array('Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday');
 $txt['days_short'] = array('Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat');
 // Months must start with 1 => 'January'. (or translated, of course.)
+$txt['months_title'] = 'Months';
 $txt['months'] = array(1 => 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');
 $txt['months_titles'] = array(1 => 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December');
 $txt['months_short'] = array(1 => 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec');
 
+$txt['minutes_label'] = 'Minutes';
+$txt['hours_label'] = 'Hours';
+$txt['years_title'] = 'Years';
+
 $txt['time_am'] = 'am';
 $txt['time_pm'] = 'pm';
 
-$txt['newmessages0'] = 'is new';
-$txt['newmessages1'] = 'are new';
-$txt['newmessages3'] = 'New';
-$txt['newmessages4'] = ',';
-
 $txt['admin'] = 'Admin';
 $txt['moderate'] = 'Moderate';
 
 $txt['save'] = 'Save';
+$txt['upload'] = 'Upload';
 
 $txt['modify'] = 'Modify';
 $txt['forum_index'] = '%1$s - Index';
@@ -68,10 +70,12 @@
 $txt['modify_msg'] = 'Modify message';
 $txt['name'] = 'Name';
 $txt['email'] = 'Email';
+$txt['user_email_address'] = 'Email Address';
 $txt['subject'] = 'Subject';
 $txt['message'] = 'Message';
 $txt['redirects'] = 'Redirects';
 $txt['quick_modify'] = 'Modify Inline';
+$txt['reason_for_edit'] = 'Reason for editing';
 
 $txt['choose_pass'] = 'Choose password';
 $txt['verify_pass'] = 'Verify password';
@@ -79,9 +83,8 @@
 
 $txt['profile_of'] = 'View the profile of';
 $txt['total'] = 'Total';
-$txt['posts_made'] = 'Posts';
 $txt['website'] = 'Website';
-$txt['register'] = 'Register';
+$txt['register'] = 'Sign Up';
 $txt['warning_status'] = 'Warning Status';
 $txt['user_warn_watch'] = 'User is on moderator watch list';
 $txt['user_warn_moderate'] = 'User posts join approval queue';
@@ -93,24 +96,44 @@
 $txt['message_index'] = 'Message Index';
 $txt['news'] = 'News';
 $txt['home'] = 'Home';
+$txt['page'] = 'Page';
+$txt['prev'] = 'previous page';
+$txt['next'] = 'next page';
 
 $txt['lock_unlock'] = 'Lock/Unlock Topic';
 $txt['post'] = 'Post';
-$txt['error_occured'] = 'An Error Has Occurred!';
+$txt['error_occured'] = 'An Error Has Occurred';
 $txt['at'] = 'at';
+$txt['by'] = 'by';
 $txt['logout'] = 'Logout';
 $txt['started_by'] = 'Started by';
+$txt['topic_started_by'] = 'Started by <strong>%1$s</strong> in <em>%2$s</em>';
 $txt['replies'] = 'Replies';
 $txt['last_post'] = 'Last post';
+$txt['first_post'] = 'First post';
+$txt['last_poster'] = 'Last post by';
+$txt['last_post_message'] = '<strong>Last post: </strong>%3$s <span class="postby">%2$s by %1$s</span>';
+$txt['last_post_topic'] = '%1$s<br>by %2$s';
+$txt['post_by_member'] = '<strong>%1$s</strong> by <strong>%2$s</strong><br>';
+$txt['boardindex_total_posts'] = '%1$s Posts in %2$s Topics by %3$s Members';
+$txt['show'] = 'Show';
+$txt['hide'] = 'Hide';
+
 $txt['admin_login'] = 'Administration Login';
 // Use numeric entities in the below string.
 $txt['topic'] = 'Topic';
 $txt['help'] = 'Help';
+$txt['terms_and_rules'] = 'Terms and Rules';
+$txt['watch_board'] = 'Watch this Board';
+$txt['unwatch_board'] = 'Stop Watching Board';
+$txt['watch_topic'] = 'Watch this Topic';
+$txt['unwatch_topic'] = 'Stop Watching Topic';
+$txt['watching_this_topic'] = 'You are watching this topic, and will receive notifications about it.';
 $txt['notify'] = 'Notify';
 $txt['unnotify'] = 'Unnotify';
 $txt['notify_request'] = 'Do you want a notification email if someone replies to this topic?';
 // Use numeric entities in the below string.
-$txt['regards_team'] = 'Regards,' . "\n" . 'The ' . $context['forum_name'] . ' Team.';
+$txt['regards_team'] = "Regards,\nThe " . $context['forum_name'] . ' Team.';
 $txt['notify_replies'] = 'Notify of replies';
 $txt['move_topic'] = 'Move Topic';
 $txt['move_to'] = 'Move to';
@@ -120,22 +143,33 @@
 $txt['reply_quote'] = 'Reply with quote';
 $txt['reply'] = 'Reply';
 $txt['reply_noun'] = 'Reply';
+$txt['reply_number'] = 'Reply #%1$s';
 $txt['approve'] = 'Approve';
+$txt['unapprove'] = 'Unapprove';
 $txt['approve_all'] = 'approve all';
+$txt['issue_warning'] = 'Issue Warning';
 $txt['awaiting_approval'] = 'Awaiting Approval';
 $txt['attach_awaiting_approve'] = 'Attachments awaiting approval';
 $txt['post_awaiting_approval'] = 'Note: This message is awaiting approval by a moderator.';
 $txt['there_are_unapproved_topics'] = 'There are %1$s topics and %2$s posts awaiting approval in this board. Click <a href="%3$s">here</a> to view them all.';
+$txt['send_message'] = 'Send message';
 
-$txt['msg_alert_none'] = 'No messages...';
-$txt['msg_alert_you_have'] = 'you have';
-$txt['msg_alert_messages'] = 'messages';
-$txt['remove_message'] = 'Remove this message';
+$txt['msg_alert_no_messages'] = 'you don\'t have any message';
+$txt['msg_alert_one_message'] = 'you have <a href="%1$s">1 message</a>';
+$txt['msg_alert_many_message'] = 'you have <a href="%1$s">%2$d messages</a>';
+$txt['msg_alert_one_new'] = '1 is new';
+$txt['msg_alert_many_new'] = '%1$d are new';
+$txt['new_alert'] = 'New Alert';
+$txt['remove_message'] = 'Remove this post';
+$txt['remove_message_question'] = 'Remove this post?';
+
+$txt['topic_alert_none'] = 'No messages...';
+$txt['pm_alert_none'] = 'No messages...';
+$txt['no_messages'] = 'No messages';
 
 $txt['online_users'] = 'Users Online';
-$txt['personal_message'] = 'Personal Message';
 $txt['jump_to'] = 'Jump to';
-$txt['go'] = 'go';
+$txt['go'] = 'Go';
 $txt['are_sure_remove_topic'] = 'Are you sure you want to remove this topic?';
 $txt['yes'] = 'Yes';
 $txt['no'] = 'No';
@@ -145,35 +179,49 @@
 
 $txt['search'] = 'Search';
 $txt['all'] = 'All';
+$txt['search_entireforum'] = 'Entire Forum';
+$txt['search_thisbrd'] = 'This board';
+$txt['search_thistopic'] = 'This topic';
+$txt['search_members'] = 'Members';
 
 $txt['back'] = 'Back';
+$txt['continue'] = 'Continue';
 $txt['password_reminder'] = 'Password reminder';
 $txt['topic_started'] = 'Topic started by';
 $txt['title'] = 'Title';
 $txt['post_by'] = 'Post by';
 $txt['memberlist_searchable'] = 'Searchable list of all registered members.';
-$txt['welcome_member'] = 'Please welcome';
+$txt['welcome_newest_member'] = 'Please welcome %1$s, our newest member.';
 $txt['admin_center'] = 'Administration Center';
-$txt['last_edit'] = 'Last Edit';
+$txt['last_edit_by'] = '<span class="lastedit">Last Edit</span>: %1$s by %2$s';
+$txt['last_edit_reason'] = '<span class="lastedit">Reason</span>: %1$s';
 $txt['notify_deactivate'] = 'Would you like to deactivate notification on this topic?';
 
 $txt['recent_posts'] = 'Recent Posts';
 
 $txt['location'] = 'Location';
 $txt['gender'] = 'Gender';
+$txt['personal_text'] = 'Personal Text';
 $txt['date_registered'] = 'Date Registered';
 
 $txt['recent_view'] = 'View the most recent posts on the forum.';
 $txt['recent_updated'] = 'is the most recently updated topic';
+$txt['is_recent_updated'] = '%1$s is the most recently updated topic';
 
 $txt['male'] = 'Male';
 $txt['female'] = 'Female';
 
 $txt['error_invalid_characters_username'] = 'Invalid character used in Username.';
 
-$txt['welcome_guest'] = 'Welcome, <strong>%1$s</strong>. Please <a href="' . $scripturl . '?action=login">login</a> or <a href="' . $scripturl . '?action=register">register</a>.';
-$txt['login_or_register'] = 'Please <a href="' . $scripturl . '?action=login">login</a> or <a href="' . $scripturl . '?action=register">register</a>.';
-$txt['welcome_guest_activate'] = '<br />Did you miss your <a href="' . $scripturl . '?action=activate">activation email</a>?';
+$txt['welcome_guest'] = 'Welcome, <strong>%1$s</strong>. Please <a href="%3$s" onclick="%4$s">login</a>.';
+
+//$txt['welcome_guest_register'] = 'Welcome, <strong>%1$s</strong>. Please <a href="' . $scripturl . '?action=login">login</a> or <a href="' . $scripturl . '?action=register">register</a>.';
+$txt['welcome_guest_register'] = 'Welcome to <strong>%2$s</strong>. Please <a href="%3$s" onclick="%4$s">login</a> or <a href="%5$s">sign up</a>.';
+
+$txt['please_login'] = 'Please <a href="' . $scripturl . '?action=login">login</a>.';
+$txt['login_or_register'] = 'Please <a href="' . $scripturl . '?action=login">login</a> or <a href="' . $scripturl . '?action=signup">signup</a>.';
+$txt['welcome_guest_activate'] = '<br>Did you miss your <a href="' . $scripturl . '?action=activate">activation email</a>?';
+// @todo the following to sprintf
 $txt['hello_member'] = 'Hey,';
 // Use numeric entities in the below string.
 $txt['hello_guest'] = 'Welcome,';
@@ -248,11 +296,10 @@
 
 $txt['mark_as_read'] = 'Mark ALL messages as read';
 
-$txt['hot_topics'] = 'Hot Topic (More than %1$d replies)';
-$txt['very_hot_topics'] = 'Very Hot Topic (More than %1$d replies)';
 $txt['locked_topic'] = 'Locked Topic';
 $txt['normal_topic'] = 'Normal Topic';
 $txt['participation_caption'] = 'Topic you have posted in';
+$txt['moved_topic'] = 'Moved Topic';
 
 $txt['go_caps'] = 'GO';
 
@@ -260,7 +307,6 @@
 $txt['profile'] = 'Profile';
 $txt['topic_summary'] = 'Topic Summary';
 $txt['not_applicable'] = 'N/A';
-$txt['message_lowercase'] = 'message';
 $txt['name_in_use'] = 'This name is already in use by another member.';
 
 $txt['total_members'] = 'Total Members';
@@ -278,74 +324,56 @@
 
 $txt['www'] = 'WWW';
 
-$txt['by'] = 'by';
-
 $txt['hours'] = 'hours';
-$txt['days_word'] = 'days';
+$txt['minutes'] = 'minutes';
+$txt['seconds'] = 'seconds';
 
-$txt['newest_member'] = ', our newest member.';
+// Used upper case in Paid subscriptions management
+$txt['hour'] = 'Hour';
+$txt['days_word'] = 'days';
 
 $txt['search_for'] = 'Search for';
+$txt['search_match'] = 'Match';
 
-$txt['aim'] = 'AIM';
-// In this string, please use +'s for spaces.
-$txt['aim_default_message'] = 'Hi.+Are+you+there?';
-$txt['aim_title'] = 'AOL Instant Messenger';
-$txt['icq'] = 'ICQ';
-$txt['icq_title'] = 'ICQ Messenger';
-$txt['msn'] = 'MSN';
-$txt['msn_title'] = 'MSN Messenger';
-$txt['yim'] = 'YIM';
-$txt['yim_title'] = 'Yahoo Instant Messenger';
-
-$txt['maintain_mode_on'] = 'Remember, this forum is in \'Maintenance Mode\'.';
+$txt['forum_in_maintainence'] = 'Your forum is in Maintenance Mode. Only administrators can currently log in.';
+$txt['maintenance_page'] = 'You can turn off Maintenance Mode from the <a href="%1$s">Server Settings</a> area.';
 
-$txt['read'] = 'Read';
-$txt['times'] = 'times';
+$txt['read_one_time'] = 'Read 1 time';
+$txt['read_many_times'] = 'Read %1$d times';
 
 $txt['forum_stats'] = 'Forum Stats';
 $txt['latest_member'] = 'Latest Member';
 $txt['total_cats'] = 'Total Categories';
 $txt['latest_post'] = 'Latest Post';
 
-$txt['you_have'] = 'You\'ve got';
-$txt['click'] = 'Click';
-$txt['here'] = 'here';
-$txt['to_view'] = 'to view them.';
-
 $txt['total_boards'] = 'Total Boards';
 
 $txt['print_page'] = 'Print Page';
+$txt['print_page_text'] = 'Text only';
+$txt['print_page_images'] = 'Text with Images';
 
 $txt['valid_email'] = 'This must be a valid email address.';
 
 $txt['geek'] = 'I am a geek!!';
 $txt['info_center_title'] = '%1$s - Info Center';
 
-$txt['send_topic'] = 'Send this topic';
-
-$txt['sendtopic_title'] = 'Send the topic &quot;%1$s&quot; to a friend.';
-$txt['sendtopic_sender_name'] = 'Your name';
-$txt['sendtopic_sender_email'] = 'Your email address';
-$txt['sendtopic_receiver_name'] = 'Recipient\'s name';
-$txt['sendtopic_receiver_email'] = 'Recipient\'s email address';
-$txt['sendtopic_comment'] = 'Add a comment';
-
-$txt['allow_user_email'] = 'Allow users to email me';
+$txt['watch'] = 'Watch';
+$txt['unwatch'] = 'Stop watching';
 
 $txt['check_all'] = 'Check all';
 
 // Use numeric entities in the below string.
 $txt['database_error'] = 'Database Error';
-$txt['try_again'] = 'Please try again.  If you come back to this error screen, report the error to an administrator.';
+$txt['try_again'] = 'Please try again. If you come back to this error screen, report the error to an administrator.';
 $txt['file'] = 'File';
 $txt['line'] = 'Line';
 // Use numeric entities in the below string.
-$txt['tried_to_repair'] = 'SMF has detected and automatically tried to repair an error in your database.  If you continue to have problems, or continue to receive these emails, please contact your host.';
+$txt['tried_to_repair'] = 'SMF has detected and automatically tried to repair an error in your database. If you continue to have problems, or continue to receive these emails, please contact your host.';
 $txt['database_error_versions'] = '<strong>Note:</strong> It appears that your database <em>may</em> require an upgrade. Your forum\'s files are currently at version %1$s, while your database is at version %2$s. The above error might possibly go away if you execute the latest version of upgrade.php.';
 $txt['template_parse_error'] = 'Template Parse Error!';
-$txt['template_parse_error_message'] = 'It seems something has gone sour on the forum with the template system.  This problem should only be temporary, so please come back later and try again.  If you continue to see this message, please contact the administrator.<br /><br />You can also try <a href="javascript:location.reload();">refreshing this page</a>.';
-$txt['template_parse_error_details'] = 'There was a problem loading the <tt><strong>%1$s</strong></tt> template or language file.  Please check the syntax and try again - remember, single quotes (<tt>\'</tt>) often have to be escaped with a slash (<tt>\\</tt>).  To see more specific error information from PHP, try <a href="' . $boardurl . '%1$s">accessing the file directly</a>.<br /><br />You may want to try to <a href="javascript:location.reload();">refresh this page</a> or <a href="' . $scripturl . '?theme=1">use the default theme</a>.';
+$txt['template_parse_error_message'] = 'It seems something has gone sour on the forum with the template system. This problem should only be temporary, so please come back later and try again. If you continue to see this message, please contact the administrator.<br><br>You can also try <a href="javascript:location.reload();">refreshing this page</a>.';
+$txt['template_parse_error_details'] = 'There was a problem loading the <pre><strong>%1$s</strong></pre> template or language file. Please check the syntax and try again - remember, single quotes (<pre>\'</pre>) often have to be escaped with a slash (<pre>\\</pre>). To see more specific error information from PHP, try <a href="' . $boardurl . '%1$s">accessing the file directly</a>.<br><br>You may want to try to <a href="javascript:location.reload();">refresh this page</a> or <a href="' . $scripturl . '?theme=1">use the default theme</a>.';
+$txt['template_parse_errmsg'] = 'Unfortunately more information is not available at this time as to exactly what is wrong.';
 
 $txt['today'] = '<strong>Today</strong> at ';
 $txt['yesterday'] = '<strong>Yesterday</strong> at ';
@@ -353,8 +381,10 @@
 $txt['poll_question'] = 'Question';
 $txt['poll_vote'] = 'Submit Vote';
 $txt['poll_total_voters'] = 'Total Members Voted';
-$txt['shortcuts'] = 'shortcuts: hit alt+s to submit/post or alt+p to preview';
-$txt['shortcuts_firefox'] = 'shortcuts: hit shift+alt+s to submit/post or shift+alt+p to preview';
+$txt['shortcuts'] = 'shortcuts: alt+s submit/post, alt+p preview';
+$txt['shortcuts_firefox'] = 'shortcuts: shift+alt+s submit/post, shift+alt+p preview';
+$txt['shortcuts_drafts'] = ', alt+d save draft';
+$txt['shortcuts_drafts_firefox'] = ', shift+alt+d save draft';
 $txt['poll_results'] = 'View results';
 $txt['poll_lock'] = 'Lock Voting';
 $txt['poll_unlock'] = 'Unlock Voting';
@@ -362,12 +392,14 @@
 $txt['poll'] = 'Poll';
 $txt['one_day'] = '1 Day';
 $txt['one_week'] = '1 Week';
+$txt['two_weeks'] = '2 Weeks';
 $txt['one_month'] = '1 Month';
+$txt['two_months'] = '2 Months';
 $txt['forever'] = 'Forever';
 $txt['quick_login_dec'] = 'Login with username, password and session length';
 $txt['one_hour'] = '1 Hour';
 $txt['moved'] = 'MOVED';
-$txt['moved_why'] = 'Please enter a brief description as to<br />why this topic is being moved.';
+$txt['move_why'] = 'Please enter a brief description as to<br>why this topic is being moved.';
 $txt['board'] = 'Board';
 $txt['in'] = 'in';
 $txt['sticky_topic'] = 'Sticky Topic';
@@ -376,7 +408,8 @@
 
 $txt['your_pms'] = 'Your Personal Messages';
 
-$txt['kilobyte'] = 'kB';
+$txt['kilobyte'] = 'KB';
+$txt['megabyte'] = 'MB';
 
 $txt['more_stats'] = '[More Stats]';
 
@@ -385,17 +418,24 @@
 $txt['code_select'] = '[Select]';
 $txt['quote_from'] = 'Quote from';
 $txt['quote'] = 'Quote';
+$txt['quote_action'] = 'Quote';
+$txt['fulledit'] = 'Full&nbsp;edit';
+$txt['edit'] = 'Edit';
+$txt['quick_edit'] = 'Quick Edit';
+$txt['post_options'] = 'More...';
 
 $txt['merge_to_topic_id'] = 'ID of target topic';
 $txt['split'] = 'Split Topic';
 $txt['merge'] = 'Merge Topics';
+$txt['target_id'] = 'Select target by topic ID';
+$txt['target_below'] = 'Select target from the list below';
 $txt['subject_new_topic'] = 'Subject For New Topic';
 $txt['split_this_post'] = 'Only split this post.';
 $txt['split_after_and_this_post'] = 'Split topic after and including this post.';
 $txt['select_split_posts'] = 'Select posts to split.';
 $txt['new_topic'] = 'New Topic';
 $txt['split_successful'] = 'Topic successfully split into two topics.';
-$txt['origin_topic'] = 'Origin Topic';
+$txt['origin_topic'] = 'Original Topic';
 $txt['please_select_split'] = 'Please select which posts you wish to split.';
 $txt['merge_successful'] = 'Topics successfully merged.';
 $txt['new_merged_topic'] = 'Newly Merged Topic';
@@ -415,19 +455,21 @@
 
 $txt['security_risk'] = 'MAJOR SECURITY RISK:';
 $txt['not_removed'] = 'You have not removed ';
-$txt['not_removed_extra'] ='%1$s is a backup of %2$s that was not generated by SMF. It can be accessed directly and used to gain unauthorised access to your forum. You should delete it immediately.';
+$txt['not_removed_extra'] = '%1$s is a backup of %2$s that was not generated by SMF. It can be accessed directly and used to gain unauthorized access to your forum. You should delete it immediately.';
+$txt['generic_warning'] = 'Warning';
+$txt['agreement_missing'] = 'You are requiring new users to accept a registration agreement, however the file (agreement.txt) doesn\'t exist.';
 
-$txt['cache_writable_head'] = 'Performance Warning';
 $txt['cache_writable'] = 'The cache directory is not writable - this will adversely affect the performance of your forum.';
 
-$txt['page_created'] = 'Page created in ';
-$txt['seconds_with'] = ' seconds with ';
-$txt['queries'] = ' queries.';
+$txt['page_created_full'] = 'Page created in %1$.3f seconds with %2$d queries.';
 
-$txt['report_to_mod_func'] = 'Use this function to inform the moderators and administrators of an abusive or wrongly posted message.<br /><em>Please note that your email address will be revealed to the moderators if you use this.</em>';
+$txt['report_to_mod_func'] = 'Use this function to inform the moderators and administrators of an abusive or wrongly posted message.';
+$txt['report_profile_func'] = 'Use this function to inform the administrators of abusive profile content, such as spam or inappropriate images.';
 
 $txt['online'] = 'Online';
+$txt['member_is_online'] = '%1$s is online';
 $txt['offline'] = 'Offline';
+$txt['member_is_offline'] = '%1$s is offline';
 $txt['pm_online'] = 'Personal Message (Online)';
 $txt['pm_offline'] = 'Personal Message (Offline)';
 $txt['status'] = 'Status';
@@ -435,15 +477,14 @@
 $txt['go_up'] = 'Go Up';
 $txt['go_down'] = 'Go Down';
 
-$forum_copyright = '<a href="' . $scripturl . '?action=credits" title="Simple Machines Forum" target="_blank" class="new_win">%1$s</a> |
- <a href="http://www.simplemachines.org/about/smf/license.php" title="License" target="_blank" class="new_win">SMF &copy; 2014</a>, <a href="http://www.simplemachines.org" title="Simple Machines" target="_blank" class="new_win">Simple Machines</a>';
+$forum_copyright = '<a href="' . $scripturl . '?action=credits" title="License" target="_blank" class="new_win">%1$s &copy; %2$s</a>, <a href="http://www.simplemachines.org" title="Simple Machines" target="_blank" class="new_win">Simple Machines</a>';
 
 $txt['birthdays'] = 'Birthdays:';
 $txt['events'] = 'Events:';
 $txt['birthdays_upcoming'] = 'Upcoming Birthdays:';
 $txt['events_upcoming'] = 'Upcoming Events:';
 // Prompt for holidays in the calendar, leave blank to just display the holiday's name.
-$txt['calendar_prompt'] = '';
+$txt['calendar_prompt'] = 'Holidays:';
 $txt['calendar_month'] = 'Month:';
 $txt['calendar_year'] = 'Year:';
 $txt['calendar_day'] = 'Day:';
@@ -451,6 +492,8 @@
 $txt['calendar_event_options'] = 'Event Options';
 $txt['calendar_post_in'] = 'Post In:';
 $txt['calendar_edit'] = 'Edit Event';
+$txt['calendar_export'] = 'Export Event';
+$txt['calendar_view_week'] = 'View Week';
 $txt['event_delete_confirm'] = 'Delete this event?';
 $txt['event_delete'] = 'Delete Event';
 $txt['calendar_post_event'] = 'Post Event';
@@ -460,6 +503,8 @@
 $txt['calendar_today'] = 'Today\'s Calendar';
 $txt['calendar_week'] = 'Week';
 $txt['calendar_week_title'] = 'Week %1$d of %2$d';
+// %1$s is the month, %2$s is the day, %3$s is the year. Change to suit your language.
+$txt['calendar_week_beginning'] = 'Week beginning %1$s %2$s, %3$s';
 $txt['calendar_numb_days'] = 'Number of Days:';
 $txt['calendar_how_edit'] = 'how do you edit these events?';
 $txt['calendar_link_event'] = 'Link Event To Post:';
@@ -467,16 +512,25 @@
 $txt['calendar_linked_events'] = 'Linked Events';
 $txt['calendar_click_all'] = 'click to see all %1$s';
 
-$txt['moveTopic1'] = 'Post a redirection topic';
-$txt['moveTopic2'] = 'Change the topic\'s subject';
-$txt['moveTopic3'] = 'New subject';
-$txt['moveTopic4'] = 'Change every message\'s subject';
+$txt['movetopic_change_subject'] = 'Change the topic\'s subject';
+$txt['movetopic_new_subject'] = 'New subject';
+$txt['movetopic_change_all_subjects'] = 'Change every message\'s subject';
 $txt['move_topic_unapproved_js'] = 'Warning! This topic has not yet been approved.\\n\\nIt is not recommended that you create a redirection topic unless you intend to approve the post immediately following the move.';
+$txt['movetopic_auto_board'] = '[BOARD]';
+$txt['movetopic_auto_topic'] = '[TOPIC LINK]';
+$txt['movetopic_default'] = 'This topic has been moved to ' . $txt['movetopic_auto_board'] . ".\n\n" . $txt['movetopic_auto_topic'];
+$txt['movetopic_redirect'] = 'Redirect to the moved topic';
+
+$txt['post_redirection'] = 'Post a redirection topic';
+$txt['redirect_topic_expires'] = 'Automatically remove the redirection topic';
+$txt['mergetopic_redirect'] = 'Redirect to the merged topic';
+$txt['merge_topic_unapproved_js'] = 'Warning! This topic has not yet been approved.\\n\\nIt is not recommended that you create a redirection topic unless you intend to approve the post immediately following the merge.';
 
 $txt['theme_template_error'] = 'Unable to load the \'%1$s\' template.';
 $txt['theme_language_error'] = 'Unable to load the \'%1$s\' language file.';
 
-$txt['parent_boards'] = 'Child Boards';
+$txt['sub_boards'] = 'Sub-Boards';
+$txt['restricted_board'] = 'Restricted Board';
 
 $txt['smtp_no_connect'] = 'Could not connect to SMTP host';
 $txt['smtp_port_ssl'] = 'SMTP port setting incorrect; it should be 465 for SSL servers.';
@@ -486,6 +540,7 @@
 
 $txt['mlist_search'] = 'Search For Members';
 $txt['mlist_search_again'] = 'Search again';
+$txt['mlist_search_filter'] = 'Search Options';
 $txt['mlist_search_email'] = 'Search by email address';
 $txt['mlist_search_messenger'] = 'Search by messenger nickname';
 $txt['mlist_search_group'] = 'Search by position';
@@ -495,9 +550,8 @@
 $txt['mlist_search_by'] = 'Search by %1$s';
 $txt['mlist_menu_view'] = 'View the memberlist';
 
-$txt['attach_downloaded'] = 'downloaded';
-$txt['attach_viewed'] = 'viewed';
-$txt['attach_times'] = 'times';
+$txt['attach_downloaded'] = 'downloaded %1$d times';
+$txt['attach_viewed'] = 'viewed %1$d times';
 
 $txt['settings'] = 'Settings';
 $txt['never'] = 'Never';
@@ -527,14 +581,16 @@
 $txt['quick_mod_move'] = 'Move selected to';
 $txt['quick_mod_merge'] = 'Merge selected';
 $txt['quick_mod_markread'] = 'Mark selected read';
-$txt['quick_mod_go'] = 'Go!';
+$txt['quick_mod_markunread'] = 'Mark selected unread';
+$txt['quick_mod_selected'] = 'With the selected options do';
+$txt['quick_mod_go'] = 'Go';
 $txt['quickmod_confirm'] = 'Are you sure you want to do this?';
 
 $txt['spell_check'] = 'Spell Check';
 
 $txt['quick_reply'] = 'Quick Reply';
 $txt['quick_reply_desc'] = 'With <em>Quick-Reply</em> you can write a post when viewing a topic without loading a new page. You can still use bulletin board code and smileys as you would in a normal post.';
-$txt['quick_reply_warning'] = 'Warning: this topic is currently locked! Only admins and moderators can reply.';
+$txt['quick_reply_warning'] = 'Warning! This topic is currently locked, only admins and moderators can reply.';
 $txt['quick_reply_verification'] = 'After submitting your post you will be directed to the regular post page to verify your post %1$s.';
 $txt['quick_reply_verification_guests'] = '(required for all guests)';
 $txt['quick_reply_verification_posts'] = '(required for all users with less than %1$d posts)';
@@ -545,11 +601,31 @@
 $txt['notification_enable_topic'] = 'Are you sure you wish to enable notification of new replies for this topic?';
 $txt['notification_disable_topic'] = 'Are you sure you wish to disable notification of new replies for this topic?';
 
+// Mentions
+$txt['mentions'] = 'Mentions';
+
+// Likes
+$txt['likes'] = 'Likes';
+$txt['like'] = 'Like';
+$txt['unlike'] = 'Unlike';
+$txt['like_success'] = 'Your content was successfully liked.';
+$txt['like_delete'] = 'Your content was successfully deleted.';
+$txt['like_insert'] = 'Your content was successfully inserted.';
+$txt['like_error'] = 'There was an error with your request.';
+$txt['like_disable'] = 'Likes feature is disabled.';
+$txt['not_valid_like_type'] = 'The liked type is not a valid type.';
+// Translators, if you need to make more strings to suit your language, e.g. $txt['likes_2'] = 'Two people like this', please do so.
+$txt['likes_1'] = '<a href="%1$s">%2$s person</a> likes this.';
+$txt['likes_n'] = '<a href="%1$s">%2$s people</a> like this.';
+$txt['you_likes_0'] = 'You like this.';
+$txt['you_likes_1'] = 'You and <a href="%1$s">%2$s other person</a> like this.';
+$txt['you_likes_n'] = 'You and <a href="%1$s">%2$s other people</a> like this.';
+
 $txt['report_to_mod'] = 'Report to moderator';
-$txt['issue_warning_post'] = 'Issue a warning because of this message';
+$txt['report_profile'] = 'Report profile of %1$s';
 
 $txt['unread_topics_visit'] = 'Recent Unread Topics';
-$txt['unread_topics_visit_none'] = 'No unread topics found since your last visit.  <a href="' . $scripturl . '?action=unread;all">Click here to try all unread topics</a>.';
+$txt['unread_topics_visit_none'] = 'No unread topics found since your last visit. <a href="' . $scripturl . '?action=unread;all">Click here to try all unread topics</a>.';
 $txt['unread_topics_all'] = 'All Unread Topics';
 $txt['unread_replies'] = 'Updated Topics';
 
@@ -562,13 +638,14 @@
 // No longer used by default theme, but for backwards compat
 $txt['powered_by_php'] = 'Powered by PHP';
 $txt['powered_by_mysql'] = 'Powered by MySQL';
-$txt['valid_css'] = 'Valid CSS!';
+$txt['valid_css'] = 'Valid CSS';
 
-// Current footer strings
-$txt['valid_html'] = 'Valid HTML 4.01!';
-$txt['valid_xhtml'] = 'Valid XHTML 1.0!';
+// Current footer strings, no longer used
+$txt['valid_html'] = 'Valid HTML 4.01';
+$txt['valid_xhtml'] = 'Valid XHTML 1.0';
 $txt['wap2'] = 'WAP2';
 $txt['rss'] = 'RSS';
+$txt['atom'] = 'Atom';
 $txt['xhtml'] = 'XHTML';
 $txt['html'] = 'HTML';
 
@@ -577,6 +654,8 @@
 $txt['user'] = 'User';
 $txt['users'] = 'Users';
 $txt['hidden'] = 'Hidden';
+// Plural form of hidden for languages other than English
+$txt['hidden_s'] = 'Hidden';
 $txt['buddy'] = 'Buddy';
 $txt['buddies'] = 'Buddies';
 $txt['most_online_ever'] = 'Most Online Ever';
@@ -587,10 +666,12 @@
 $txt['merge_topic_list'] = 'Select topics to be merged';
 $txt['merge_select_subject'] = 'Select subject of merged topic';
 $txt['merge_custom_subject'] = 'Custom subject';
-$txt['merge_enforce_subject'] = 'Change the subject of all the messages';
 $txt['merge_include_notifications'] = 'Include notifications?';
 $txt['merge_check'] = 'Merge?';
 $txt['merge_no_poll'] = 'No poll';
+$txt['merge_why'] = 'Please entere a brief description as to<br>why these topics are being merged.';
+$txt['merged_subject'] = '[MERGED] %1$s';
+$txt['mergetopic_default'] = 'This topic has been merged into ' . $txt['movetopic_auto_topic'] . '.';
 
 $txt['response_prefix'] = 'Re: ';
 $txt['current_icon'] = 'Current Icon';
@@ -603,7 +684,6 @@
 $txt['search_results'] = 'Search Results';
 $txt['search_no_results'] = 'Sorry, no matches were found';
 
-$txt['totalTimeLogged1'] = 'Total time logged in: ';
 $txt['totalTimeLogged2'] = ' days, ';
 $txt['totalTimeLogged3'] = ' hours and ';
 $txt['totalTimeLogged4'] = ' minutes.';
@@ -611,11 +691,7 @@
 $txt['totalTimeLogged6'] = 'h ';
 $txt['totalTimeLogged7'] = 'm';
 
-$txt['approve_thereis'] = 'There is';
-$txt['approve_thereare'] = 'There are';
-$txt['approve_member'] = 'one member';
-$txt['approve_members'] = 'members';
-$txt['approve_members_waiting'] = 'awaiting approval.';
+$txt['approve_members_waiting'] = 'Member Approvals';
 
 $txt['notifyboard_turnon'] = 'Do you want a notification email when someone posts a new topic in this board?';
 $txt['notifyboard_turnoff'] = 'Are you sure you do not want to receive new topic notifications for this board?';
@@ -636,18 +712,15 @@
 $txt['change_color'] = 'Change Color';
 
 $txt['quickmod_delete_selected'] = 'Remove Selected';
+$txt['quickmod_split_selected'] = 'Split Selected';
 
-// In this string, don't use entities. (&amp;, etc.)
-$txt['show_personal_messages'] = 'You have received one or more new personal messages.\\nWould you like to open a new window to view them?';
-
-$txt['previous_next_back'] = '&laquo; previous';
-$txt['previous_next_forward'] = 'next &raquo;';
+$txt['show_personal_messages_heading'] = 'New messages';
+$txt['show_personal_messages'] = 'You have <strong>%1$s</strong> unread personal messages in your inbox.<br><br><a href="%2$s">Go to your inbox</a>';
 
-$txt['movetopic_auto_board'] = '[BOARD]';
-$txt['movetopic_auto_topic'] = '[TOPIC LINK]';
-$txt['movetopic_default'] = 'This topic has been moved to ' . $txt['movetopic_auto_board'] . ".\n\n" . $txt['movetopic_auto_topic'];
+$txt['help_popup'] = 'A little lost? Let me explain:';
 
-$txt['upshrink_description'] = 'Shrink or expand the header.';
+$txt['previous_next_back'] = 'previous topic';
+$txt['previous_next_forward'] = 'next topic';
 
 $txt['mark_unread'] = 'Mark unread';
 
@@ -658,8 +731,9 @@
 $txt['preview_title'] = 'Preview post';
 $txt['preview_fetch'] = 'Fetching preview...';
 $txt['preview_new'] = 'New message';
-$txt['error_while_submitting'] = 'The following error or errors occurred while posting this message:';
-$txt['error_old_topic'] = 'Warning: this topic has not been posted in for at least %1$d days.<br />Unless you\'re sure you want to reply, please consider starting a new topic.';
+$txt['pm_error_while_submitting'] = 'The following error or errors occurred while sending this personal message:';
+$txt['error_while_submitting'] = 'The message has the following error or errors that must be corrected before continuing:';
+$txt['error_old_topic'] = 'Warning: this topic has not been posted in for at least %1$d days.<br>Unless you\'re sure you want to reply, please consider starting a new topic.';
 
 $txt['split_selected_posts'] = 'Selected posts';
 $txt['split_selected_posts_desc'] = 'The posts below will form a new topic after splitting.';
@@ -668,20 +742,22 @@
 $txt['modify_cancel'] = 'Cancel';
 $txt['mark_read_short'] = 'Mark Read';
 
+$txt['alerts'] = 'Alerts';
+
 $txt['pm_short'] = 'My Messages';
 $txt['pm_menu_read'] = 'Read your messages';
 $txt['pm_menu_send'] = 'Send a message';
 
-$txt['hello_member_ndt'] = 'Hello';
-
 $txt['unapproved_posts'] = 'Unapproved Posts (Topics: %1$d, Posts: %2$d)';
 
 $txt['ajax_in_progress'] = 'Loading...';
 
-$txt['mod_reports_waiting'] = 'There are currently %1$d moderator reports open.';
+$txt['mod_reports_waiting'] = 'Reported Posts';
 
 $txt['view_unread_category'] = 'Unread Posts';
+$txt['new_posts_in_category'] = 'Click to see the new posts in %1$s';
 $txt['verification'] = 'Verification';
+$txt['visual_verification_hidden'] = 'Please leave this box empty';
 $txt['visual_verification_description'] = 'Type the letters shown in the picture';
 $txt['visual_verification_sound'] = 'Listen to the letters';
 $txt['visual_verification_request_new'] = 'Request another image';
@@ -689,8 +765,10 @@
 // Sub menu labels
 $txt['summary'] = 'Summary';
 $txt['account'] = 'Account Settings';
+$txt['theme'] = 'Look and Layout';
 $txt['forumprofile'] = 'Forum Profile';
-
+$txt['activate_changed_email_title'] = 'Email Address Changed';
+$txt['activate_changed_email_desc'] = 'You\'ve changed your email address. In order to validate this address you will receive an email. Click the link in that email to reactivate your account.';
 $txt['modSettings_title'] = 'Features and Options';
 $txt['package'] = 'Package Manager';
 $txt['errlog'] = 'Error Log';
@@ -698,24 +776,22 @@
 $txt['mc_unapproved_attachments'] = 'Unapproved Attachments';
 $txt['mc_unapproved_poststopics'] = 'Unapproved Posts and Topics';
 $txt['mc_reported_posts'] = 'Reported Posts';
+$txt['mc_reported_members'] = 'Reported Members';
 $txt['modlog_view'] = 'Moderation Log';
 $txt['calendar_menu'] = 'View Calendar';
 
-//!!! Send email strings - should move?
+// @todo Send email strings - should move?
 $txt['send_email'] = 'Send Email';
 $txt['send_email_disclosed'] = 'Note this will be visible to the recipient.';
-$txt['send_email_subject'] = 'Email Subject';
 
 $txt['ignoring_user'] = 'You are ignoring this user.';
 $txt['show_ignore_user_post'] = 'Show me the post.';
 
 $txt['spider'] = 'Spider';
 $txt['spiders'] = 'Spiders';
-$txt['openid'] = 'OpenID';
 
 $txt['downloads'] = 'Downloads';
 $txt['filesize'] = 'Filesize';
-$txt['subscribe_webslice'] = 'Subscribe to Webslice';
 
 // Restore topic
 $txt['restore_topic'] = 'Restore Topic';
@@ -724,7 +800,7 @@
 
 // Editor prompt.
 $txt['prompt_text_email'] = 'Please enter the email address.';
-$txt['prompt_text_ftp'] = 'Please enter the ftp address.';
+$txt['prompt_text_ftp'] = 'Please enter the FTP address.';
 $txt['prompt_text_url'] = 'Please enter the URL you wish to link to.';
 $txt['prompt_text_img'] = 'Enter image location';
 
@@ -737,6 +813,7 @@
 $txt['debug_language_files'] = 'Language files: ';
 $txt['debug_stylesheets'] = 'Style sheets: ';
 $txt['debug_files_included'] = 'Files included: ';
+$txt['debug_memory_use'] = 'Memory used: ';
 $txt['debug_kb'] = 'KB.';
 $txt['debug_show'] = 'show';
 $txt['debug_cache_hits'] = 'Cache hits: ';
@@ -749,5 +826,31 @@
 $txt['debug_query_which_took_at'] = 'which took %1$s seconds at %2$s into request.';
 $txt['debug_show_queries'] = '[Show Queries]';
 $txt['debug_hide_queries'] = '[Hide Queries]';
-
+$txt['debug_tokens'] = 'Tokens: ';
+$txt['debug_browser'] = 'Browser ID: ';
+$txt['debug_hooks'] = 'Hooks called: ';
+$txt['debug_instances'] = 'Instances created: ';
+$txt['are_sure_mark_read'] = 'Are you sure you want to mark messages as read?';
+
+// Accessibility
+$txt['hide_category'] = 'Hide Category';
+$txt['show_category'] = 'Show Category';
+$txt['hide_infocenter'] = 'Hide Info Center';
+$txt['show_infocenter'] = 'Show Info Center';
+
+// Notification post control
+$txt['notify_topic_0'] = 'Not Following';
+$txt['notify_topic_1'] = 'No Alerts or Emails';
+$txt['notify_topic_2'] = 'Receive Alerts';
+$txt['notify_topic_3'] = 'Receive Emails and Alerts';
+$txt['notify_topic_0_desc'] = 'You will not receive any emails or alerts for this post and it will also not show up in your unread replies and topics list. You will still receive @mentions for this topic.';
+$txt['notify_topic_1_desc'] = 'You will not receive any emails or alerts but only @mentions by other members.';
+$txt['notify_topic_2_desc'] = 'You will receive alerts for this topic.';
+$txt['notify_topic_3_desc'] = 'You will receive both alerts and e-mails for this topic.';
+$txt['notify_board_1'] = 'No Alerts or Emails';
+$txt['notify_board_2'] = 'Receive Alerts';
+$txt['notify_board_3'] = 'Receive Emails and Alerts';
+$txt['notify_board_1_desc'] = 'You will not receive any emails or alerts for new topics';
+$txt['notify_board_2_desc'] = 'You will receive alerts for this board.';
+$txt['notify_board_3_desc'] = 'You will receive both alerts and e-mails for this board.';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Install.english.php b/Themes/default/languages/Install.english.php
--- a/Themes/default/languages/Install.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Install.english.php	2015-03-05 23:30:06.024678600 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; Install
+// Version: 2.1 Beta 1; Install
 
 // These should be the same as those in index.language.php.
 $txt['lang_character_set'] = 'ISO-8859-1';
@@ -18,34 +18,32 @@
 $txt['installer_language_set'] = 'Set';
 $txt['congratulations'] = 'Congratulations, the installation process is complete!';
 $txt['congratulations_help'] = 'If at any time you need support, or SMF fails to work properly, please remember that <a href="http://www.simplemachines.org/community/index.php" target="_blank">help is available</a> if you need it.';
-$txt['still_writable'] = 'Your installation directory is still writable.  It\'s a good idea to chmod it so that it is not writable for security reasons.';
+$txt['still_writable'] = 'Your installation directory is still writable. It\'s a good idea to chmod it so that it is not writable for security reasons.';
 $txt['delete_installer'] = 'Click here to delete this install.php file now.';
 $txt['delete_installer_maybe'] = '<em>(doesn\'t work on all servers.)</em>';
-$txt['go_to_your_forum'] = 'Now you can see <a href="%1$s">your newly installed forum</a> and begin to use it.  You should first make sure you are logged in, after which you will be able to access the administration center.';
-$txt['good_luck'] = 'Good luck!<br />Simple Machines';
+$txt['go_to_your_forum'] = 'Now you can see <a href="%1$s">your newly installed forum</a> and begin to use it. You should first make sure you are logged in, after which you will be able to access the administration center.';
+$txt['good_luck'] = 'Good luck!<br>Simple Machines';
 
 $txt['install_welcome'] = 'Welcome';
 $txt['install_welcome_desc'] = 'Welcome to SMF. This script will guide you through the process for installing %1$s. We\'ll gather a few details about your forum over the next few steps, and after a couple of minutes your forum will be ready for use.';
 $txt['install_all_lovely'] = 'We\'ve completed some initial tests on your server and everything appears to be in order. Simply click the &quot;Continue&quot; button below to get started.';
 
 $txt['user_refresh_install'] = 'Forum Refreshed';
-$txt['user_refresh_install_desc'] = 'While installing, the installer found that (with the details you provided) one or more of the tables this installer might create already existed.<br />Any missing tables in your installation have been recreated with the default data, but no data was deleted from existing tables.';
+$txt['user_refresh_install_desc'] = 'While installing, the installer found that (with the details you provided) one or more of the tables this installer might create already existed.<br>Any missing tables in your installation have been recreated with the default data, but no data was deleted from existing tables.';
 
 $txt['default_topic_subject'] = 'Welcome to SMF!';
-$txt['default_topic_message'] = 'Welcome to Simple Machines Forum!<br /><br />We hope you enjoy using your forum.&nbsp; If you have any problems, please feel free to [url=http://www.simplemachines.org/community/index.php]ask us for assistance[/url].<br /><br />Thanks!<br />Simple Machines';
+$txt['default_topic_message'] = 'Welcome to Simple Machines Forum!<br><br>We hope you enjoy using your forum.&nbsp; If you have any problems, please feel free to [url=http://www.simplemachines.org/community/index.php]ask us for assistance[/url].<br><br>Thanks!<br>Simple Machines';
 $txt['default_board_name'] = 'General Discussion';
 $txt['default_board_description'] = 'Feel free to talk about anything and everything in this board.';
 $txt['default_category_name'] = 'General Category';
-$txt['default_time_format'] = '%B %d, %Y, %I:%M:%S %p';
+$txt['default_time_format'] = '%b %d, %Y, %I:%M %p';
 $txt['default_news'] = 'SMF - Just Installed!';
-$txt['default_karmaLabel'] = 'Karma:';
-$txt['default_karmaSmiteLabel'] = '[smite]';
-$txt['default_karmaApplaudLabel'] = '[applaud]';
 $txt['default_reserved_names'] = 'Admin\nWebmaster\nGuest\nroot';
 $txt['default_smileyset_name'] = 'Alienine\'s Set';
 $txt['default_aaron_smileyset_name'] = 'Aaron\'s Set';
 $txt['default_akyhne_smileyset_name'] = 'Akyhne\'s Set';
-$txt['default_theme_name'] = 'SMF Default Theme - Curve';
+$txt['default_fugue_smileyset_name'] = 'Fugue\'s Set';
+$txt['default_theme_name'] = 'SMF Default Theme - Curve2';
 $txt['default_core_theme_name'] = 'Core Theme';
 $txt['default_classic_theme_name'] = 'Classic YaBB SE Theme';
 $txt['default_babylon_theme_name'] = 'Babylon Theme';
@@ -92,11 +90,18 @@
 $txt['install_settings_name_info'] = 'This is the name of your forum, ie. &quot;The Testing Forum&quot;.';
 $txt['install_settings_name_default'] = 'My Community';
 $txt['install_settings_url'] = 'Forum URL';
-$txt['install_settings_url_info'] = 'This is the URL to your forum <strong>without the trailing \'/\'!</strong>.<br />In most cases, you can leave the default value in this box alone - it is usually right.';
+$txt['install_settings_url_info'] = 'This is the URL to your forum <strong>without the trailing \'/\'!</strong>.<br>In most cases, you can leave the default value in this box alone - it is usually right.';
+$txt['install_settings_reg_mode'] = 'Registration Mode';
+$txt['install_settings_reg_modes'] = 'Registration Modes';
+$txt['install_settings_reg_immediate'] = 'Immediate Registration';
+$txt['install_settings_reg_email'] = 'Email Activation';
+$txt['install_settings_reg_admin'] = 'Admin Approval';
+$txt['install_settings_reg_disabled'] = 'Registration Disabled';
+$txt['install_settings_reg_mode_info'] = 'This field allows you to change the mode of registration on installation to prevent unwanted registrations.';
 $txt['install_settings_compress'] = 'Gzip Output';
 $txt['install_settings_compress_title'] = 'Compress output to save bandwidth.';
 // In this string, you can translate the word "PASS" to change what it says when the test passes.
-$txt['install_settings_compress_info'] = 'This function does not work properly on all servers, but can save you a lot of bandwidth.<br />Click <a href="install.php?obgz=1&amp;pass_string=PASS" onclick="return reqWin(this.href, 200, 60);" target="_blank">here</a> to test it. (it should just say "PASS".)';
+$txt['install_settings_compress_info'] = 'This function does not work properly on all servers, but can save you a lot of bandwidth.<br>Click <a href="install.php?obgz=1&amp;pass_string=PASS" onclick="return reqWin(this.href, 200, 60);" target="_blank">here</a> to test it. (it should just say "PASS".)';
 $txt['install_settings_dbsession'] = 'Database Sessions';
 $txt['install_settings_dbsession_title'] = 'Use the database for sessions instead of using files.';
 $txt['install_settings_dbsession_info1'] = 'This feature is almost always for the best, as it makes sessions more dependable.';
@@ -110,23 +115,24 @@
 $txt['install_settings_proceed'] = 'Proceed';
 
 $txt['db_settings'] = 'Database Server Settings';
-$txt['db_settings_info'] = 'These are the settings to use for your database server.  If you don\'t know the values, you should ask your host what they are.';
+$txt['db_settings_info'] = 'These are the settings to use for your database server. If you don\'t know the values, you should ask your host what they are.';
 $txt['db_settings_type'] = 'Database type';
 $txt['db_settings_type_info'] = 'Multiple supported database types were detected - which do you wish to use. Please note that running pre-SMF 2.0 RC3 along with newer SMF versions in the same PostgreSQL database is not supported. You need to upgrade your older installations in that case.';
 $txt['db_settings_server'] = 'Server name';
 $txt['db_settings_server_info'] = 'This is nearly always localhost - so if you don\'t know, try localhost.';
 $txt['db_settings_username'] = 'Username';
-$txt['db_settings_username_info'] = 'Fill in the username you need to connect to your database here.<br />If you don\'t know what it is, try the username of your ftp account, most of the time they are the same.';
+$txt['db_settings_username_info'] = 'Fill in the username you need to connect to your database here.<br>If you don\'t know what it is, try the username of your ftp account, most of the time they are the same.';
 $txt['db_settings_password'] = 'Password';
-$txt['db_settings_password_info'] = 'Here, put the password you need to connect to your database.<br />If you don\'t know this, you should try the password to your ftp account.';
+$txt['db_settings_password_info'] = 'Here, put the password you need to connect to your database.<br>If you don\'t know this, you should try the password to your ftp account.';
 $txt['db_settings_database'] = 'Database name';
 $txt['db_settings_database_info'] = 'Fill in the name of the database you want to use for SMF to store its data in.';
 $txt['db_settings_database_info_note'] = 'If this database does not exist, this installer will try to create it.';
+$txt['db_settings_port'] = 'Database port';
+$txt['db_settings_port_info'] = 'Leave blank to use the default';
 $txt['db_settings_database_file'] = 'Database filename';
 $txt['db_settings_database_file_info'] = 'This is the name of the file in which to store the SMF data. We recommend you use the randomly generated name for this and set the path of this file to be outside of the public area of your webserver.';
 $txt['db_settings_prefix'] = 'Table prefix';
-$txt['db_settings_prefix_info'] = 'The prefix for every table in the database.  <strong>Do not install two forums with the same prefix!</strong><br />This value allows for multiple installations in one database.';
-$txt['db_sqlite_warning'] = 'Only recommended for small, low volume and/or intranet-type forums';
+$txt['db_settings_prefix_info'] = 'The prefix for every table in the database. <strong>Do not install two forums with the same prefix!</strong><br>This value allows for multiple installations in one database.';
 $txt['db_populate'] = 'Populated Database';
 $txt['db_populate_info'] = 'Your settings have now been saved and the database has been populated with all the data required to get your forum up and running. Summary of population:';
 $txt['db_populate_info2'] = 'Click &quot;Continue&quot; to progress to the admin account creation page.';
@@ -138,13 +144,13 @@
 $txt['user_settings'] = 'Create Your Account';
 $txt['user_settings_info'] = 'The installer will now create a new administrator account for you.';
 $txt['user_settings_username'] = 'Your username';
-$txt['user_settings_username_info'] = 'Choose the name you want to login with.<br />This can\'t be changed later, but your display name can be.';
+$txt['user_settings_username_info'] = 'Choose the name you want to login with.<br>This can be changed later.';
 $txt['user_settings_password'] = 'Password';
 $txt['user_settings_password_info'] = 'Fill in your preferred password here, and remember it well!';
 $txt['user_settings_again'] = 'Password';
 $txt['user_settings_again_info'] = '(just for verification.)';
 $txt['user_settings_email'] = 'Email Address';
-$txt['user_settings_email_info'] = 'Provide your email address as well.  <strong>This must be a valid email address.</strong>';
+$txt['user_settings_email_info'] = 'Provide your email address as well. <strong>This must be a valid email address.</strong>';
 $txt['user_settings_database'] = 'Database Password';
 $txt['user_settings_database_info'] = 'The installer requires that you supply the database password to create an administrator account, for security reasons.';
 $txt['user_settings_skip'] = 'Skip';
@@ -153,7 +159,7 @@
 
 $txt['ftp_checking_writable'] = 'Checking Files are Writable';
 $txt['ftp_setup'] = 'FTP Connection Information';
-$txt['ftp_setup_info'] = 'This installer can connect via FTP to fix the files that need to be writable and are not.  If this doesn\'t work for you, you will have to go in manually and make the files writable.  Please note that this doesn\'t support SSL right now.';
+$txt['ftp_setup_info'] = 'This installer can connect via FTP to fix the files that need to be writable and are not. If this doesn\'t work for you, you will have to go in manually and make the files writable. Please note that this doesn\'t support SSL right now.';
 $txt['ftp_server'] = 'Server';
 $txt['ftp_server_info'] = 'This should be the server and port for your FTP server.';
 $txt['ftp_port'] = 'Port';
@@ -166,45 +172,44 @@
 $txt['ftp_path_found_info'] = 'The path in the box above was automatically detected.';
 $txt['ftp_connect'] = 'Connect';
 $txt['ftp_setup_why'] = 'What is this step for?';
-$txt['ftp_setup_why_info'] = 'Some files need to be writable for SMF to work properly.  This step allows you to let the installer make them writable for you.  However, in some cases it won\'t work - in that case, please make the following files 777 (writable, 755 on some hosts):';
+$txt['ftp_setup_why_info'] = 'Some files need to be writable for SMF to work properly. This step allows you to let the installer make them writable for you. However, in some cases it won\'t work - in that case, please make the following files 777 (writable, 755 on some hosts):';
 $txt['ftp_setup_again'] = 'to test if these files are writable again.';
 
-$txt['error_php_too_low'] = 'Warning!  You do not appear to have a version of PHP installed on your webserver that meets SMF\'s <strong>minimum installations requirements</strong>.<br />If you are not the host, you will need to ask your host to upgrade, or use a different host - otherwise, please upgrade PHP to a recent version.<br /><br />If you know for a fact that your PHP version is high enough you may continue, although this is strongly discouraged.';
-$txt['error_missing_files'] = 'Unable to find crucial installation files in the directory of this script!<br /><br />Please make sure you uploaded the entire installation package, including the sql file, and then try again.';
-$txt['error_session_save_path'] = 'Please inform your host that the <strong>session.save_path specified in php.ini</strong> is not valid!  It needs to be changed to a directory that <strong>exists</strong>, and is <strong>writable</strong> by the user PHP is running under.<br />';
-$txt['error_windows_chmod'] = 'You\'re on a windows server, and some crucial files are not writable.  Please ask your host to give <strong>write permissions</strong> to the user PHP is running under for the files in your SMF installation.  The following files or directories need to be writable:';
+$txt['error_php_too_low'] = 'Warning!  You do not appear to have a version of PHP installed on your webserver that meets SMF\'s <strong>minimum installations requirements</strong>.<br>If you are not the host, you will need to ask your host to upgrade, or use a different host - otherwise, please upgrade PHP to a recent version.<br><br>If you know for a fact that your PHP version is high enough you may continue, although this is strongly discouraged.';
+$txt['error_missing_files'] = 'Unable to find crucial installation files in the directory of this script!<br><br>Please make sure you uploaded the entire installation package, including the sql file, and then try again.';
+$txt['error_session_save_path'] = 'Please inform your host that the <strong>session.save_path specified in php.ini</strong> is not valid!  It needs to be changed to a directory that <strong>exists</strong>, and is <strong>writable</strong> by the user PHP is running under.<br>';
+$txt['error_windows_chmod'] = 'You\'re on a windows server, and some crucial files are not writable. Please ask your host to give <strong>write permissions</strong> to the user PHP is running under for the files in your SMF installation. The following files or directories need to be writable:';
 $txt['error_ftp_no_connect'] = 'Unable to connect to FTP server with this combination of details.';
 $txt['error_db_file'] = 'Cannot find database source script! Please check file %1$s is within your forum source directory.';
-$txt['error_db_connect'] = 'Cannot connect to the database server with the supplied data.<br /><br />If you are not sure about what to type in, please contact your host.';
-$txt['error_db_too_low'] = 'The version of your database server is very old, and does not meet SMF\'s minimum requirements.<br /><br />Please ask your host to either upgrade it or supply a new one, and if they won\'t, please try a different host.';
-$txt['error_db_database'] = 'The installer was unable to access the &quot;<em>%1$s</em>&quot; database.  With some hosts, you have to create the database in your administration panel before SMF can use it.  Some also add prefixes - like your username - to your database names.';
-$txt['error_db_queries'] = 'Some of the queries were not executed properly.  This could be caused by an unsupported (development or old) version of your database software.<br /><br />Technical information about the queries:';
+$txt['error_db_connect'] = 'Cannot connect to the database server with the supplied data.<br><br>If you are not sure about what to type in, please contact your host.';
+$txt['error_db_too_low'] = 'The version of your database server is very old, and does not meet SMF\'s minimum requirements.<br><br>Please ask your host to either upgrade it or supply a new one, and if they won\'t, please try a different host.';
+$txt['error_db_database'] = 'The installer was unable to access the &quot;<em>%1$s</em>&quot; database. With some hosts, you have to create the database in your administration panel before SMF can use it. Some also add prefixes - like your username - to your database names.';
+$txt['error_db_queries'] = 'Some of the queries were not executed properly. This could be caused by an unsupported (development or old) version of your database software.<br><br>Technical information about the queries:';
 $txt['error_db_queries_line'] = 'Line #';
-$txt['error_db_missing'] = 'The installer was unable to detect any database support in PHP.  Please ask your host to ensure that PHP was compiled with the desired database, or that the proper extension is being loaded.';
+$txt['error_db_missing'] = 'The installer was unable to detect any database support in PHP. Please ask your host to ensure that PHP was compiled with the desired database, or that the proper extension is being loaded.';
 $txt['error_db_script_missing'] = 'The installer could not find any install script files for the detected databases. Please check you have uploaded the necessary install script files to your forum directory, for example &quot;%1$s&quot;';
-$txt['error_session_missing'] = 'The installer was unable to detect sessions support in your server\'s installation of PHP.  Please ask your host to ensure that PHP was compiled with session support (in fact, it has to be explicitly compiled without it.)';
+$txt['error_session_missing'] = 'The installer was unable to detect sessions support in your server\'s installation of PHP. Please ask your host to ensure that PHP was compiled with session support (in fact, it has to be explicitly compiled without it.)';
 $txt['error_user_settings_again_match'] = 'You typed in two completely different passwords!';
 $txt['error_user_settings_no_password'] = 'Your password must be at least four characters long.';
-$txt['error_user_settings_taken'] = 'Sorry, a member is already registered with that username and/or email address.<br /><br />A new account has not been created.';
-$txt['error_user_settings_query'] = 'A database error occurred while trying to create an administrator.  This error was:';
-$txt['error_subs_missing'] = 'Unable to find the Sources/Subs.php file.  Please make sure it was uploaded properly, and then try again.';
+$txt['error_user_settings_taken'] = 'Sorry, a member is already registered with that username and/or email address.<br><br>A new account has not been created.';
+$txt['error_user_settings_query'] = 'A database error occurred while trying to create an administrator. This error was:';
+$txt['error_subs_missing'] = 'Unable to find the Sources/Subs.php file. Please make sure it was uploaded properly, and then try again.';
 $txt['error_db_alter_priv'] = 'The database account you specified does not have permission to ALTER, CREATE, and/or DROP tables in the database; this is necessary for SMF to function properly.';
-$txt['error_versions_do_not_match'] = 'The installer has detected another version of SMF already installed with the specified information.  If you are trying to upgrade, you should use the upgrader, not the installer.<br /><br />Otherwise, you may wish to use different information, or create a backup and then delete the data currently in the database.';
-$txt['error_mod_security'] = 'The installer has detected the mod_security module is installed on your web server. Mod_security will block submitted forms even before SMF gets a say in anything. SMF has a built-in security scanner that will work more effectively than mod_security and that won\'t block submitted forms.<br /><br /><a href="http://www.simplemachines.org/redirect/mod_security">More information about disabling mod_security</a>';
-$txt['error_mod_security_no_write'] = 'The installer has detected the mod_security module is installed on your web server. Mod_security will block submitted forms even before SMF gets a say in anything. SMF has a built-in security scanner that will work more effectively than mod_security and that won\'t block submitted forms.<br /><br /><a href="http://www.simplemachines.org/redirect/mod_security">More information about disabling mod_security</a><br /><br />Alternatively, you may wish to use your ftp client to chmod .htaccess in the forum directory to be writable (777), and then refresh this page.';
+$txt['error_versions_do_not_match'] = 'The installer has detected another version of SMF already installed with the specified information. If you are trying to upgrade, you should use the upgrader, not the installer.<br><br>Otherwise, you may wish to use different information, or create a backup and then delete the data currently in the database.';
+$txt['error_mod_security'] = 'The installer has detected the mod_security module is installed on your web server. Mod_security will block submitted forms even before SMF gets a say in anything. SMF has a built-in security scanner that will work more effectively than mod_security and that won\'t block submitted forms.<br><br><a href="http://www.simplemachines.org/redirect/mod_security">More information about disabling mod_security</a>';
+$txt['error_mod_security_no_write'] = 'The installer has detected the mod_security module is installed on your web server. Mod_security will block submitted forms even before SMF gets a say in anything. SMF has a built-in security scanner that will work more effectively than mod_security and that won\'t block submitted forms.<br><br><a href="http://www.simplemachines.org/redirect/mod_security">More information about disabling mod_security</a><br><br>Alternatively, you may wish to use your ftp client to chmod .htaccess in the forum directory to be writable (777), and then refresh this page.';
 $txt['error_utf8_version'] = 'The current version of your database doesn\'t support the use of the UTF-8 character set. You can still install SMF without any problems, but only with UTF-8 support unchecked. If you would like to switch over to UTF-8 in the future (e.g. after the database server of your forum has been upgraded to version >= %1$s), you can convert your forum to UTF-8 through the admin panel.';
 $txt['error_valid_email_needed'] = 'You have not entered a valid email address.';
-$txt['error_already_installed'] = 'The installer has detected that you already have SMF installed. It is strongly advised that you do <strong>not</strong> try to overwrite an existing installation - continuing with installation <strong>may result in the loss or corruption of existing data</strong>.<br /><br />If you wish to upgrade please visit the <a href="http://www.simplemachines.org">Simple Machines Website</a> and download the latest <em>upgrade</em> package.<br /><br />If you wish to overwrite your existing installation, including all data, it\'s recommended that you delete the existing database tables and replace Settings.php and try again.';
+$txt['error_already_installed'] = 'The installer has detected that you already have SMF installed. It is strongly advised that you do <strong>not</strong> try to overwrite an existing installation - continuing with installation <strong>may result in the loss or corruption of existing data</strong>.<br><br>If you wish to upgrade please visit the <a href="http://www.simplemachines.org">Simple Machines Website</a> and download the latest <em>upgrade</em> package.<br><br>If you wish to overwrite your existing installation, including all data, it\'s recommended that you delete the existing database tables and replace Settings.php and try again.';
 $txt['error_warning_notice'] = 'Warning!';
-$txt['error_script_outdated'] = 'This install script is out of date! The current version of SMF is %1$s but this install script is for %2$s.<br /><br />
+$txt['error_script_outdated'] = 'This install script is out of date! The current version of SMF is %1$s but this install script is for %2$s.<br><br>
 	It is recommended that you visit the <a href="http://www.simplemachines.org">Simple Machines</a> website to ensure you are installing the latest version.';
-$txt['error_db_filename'] = 'You must enter a name for the database file name for SQLite.';
 $txt['error_db_prefix_numeric'] = 'The selected database type does not support the use of numeric prefixes.';
 $txt['error_invalid_characters_username'] = 'Invalid character used in Username.';
 $txt['error_username_too_long'] = 'Username must be less than 25 characters long.';
 $txt['error_username_left_empty'] = 'Username field was left empty.';
-$txt['error_db_filename_exists'] = 'The database that you are trying to create exists.  Please delete the current database file or enter another name.';
-$txt['error_db_prefix_reserved'] = 'The prefix that you entered is a reserved prefix.  Please enter another prefix.';
+$txt['error_db_filename_exists'] = 'The database that you are trying to create exists. Please delete the current database file or enter another name.';
+$txt['error_db_prefix_reserved'] = 'The prefix that you entered is a reserved prefix. Please enter another prefix.';
 
 $txt['upgrade_upgrade_utility'] = 'SMF Upgrade Utility';
 $txt['upgrade_warning'] = 'Warning!';
@@ -223,13 +228,33 @@
 
 $txt['upgrade_incomplete'] = 'Incomplete';
 $txt['upgrade_not_quite_done'] = 'Not quite done yet!';
-$txt['upgrade_paused_overload'] = 'This upgrade has been paused to avoid overloading your server.  Don\'t worry, nothing\'s wrong - simply click the <label for="contbutt">continue button</label> below to keep going.';
+$txt['upgrade_paused_overload'] = 'This upgrade has been paused to avoid overloading your server. Don\'t worry, nothing\'s wrong - simply click the <label for="contbutt">continue button</label> below to keep going.';
 
 $txt['upgrade_ready_proceed'] = 'Thank you for choosing to upgrade to SMF %1$s. All files appear to be in place, and we\'re ready to proceed.';
 
 $txt['upgrade_error_script_js'] = 'The upgrade script cannot find script.js or it is out of date. Make sure your theme paths are correct. You can download a setting checker tool from the <a href="http://www.simplemachines.org">Simple Machines Website</a>';
 
 $txt['upgrade_warning_lots_data'] = 'This upgrade script has detected that your forum contains a lot of data which needs upgrading. This process may take quite some time depending on your server and forum size, and for very large forums (~300,000 messages) may take several hours to complete.';
-$txt['upgrade_warning_out_of_date'] = 'This upgrade script is out of date! The current version of SMF is <em id="smfVersion" style="white-space: nowrap;">??</em> but this upgrade script is for <em id="yourVersion" style="white-space: nowrap;">%1$s</em>.<br /><br />It is recommended that you visit the <a href="http://www.simplemachines.org">Simple Machines</a> website to ensure you are upgrading to the latest version.';
+$txt['upgrade_warning_out_of_date'] = 'This upgrade script is out of date! The current version of SMF is <em id="smfVersion" style="white-space: nowrap;">??</em> but this upgrade script is for <em id="yourVersion" style="white-space: nowrap;">%1$s</em>.<br><br>It is recommended that you visit the <a href="http://www.simplemachines.org">Simple Machines</a> website to ensure you are upgrading to the latest version.';
 
+$txt['error_ftp_no_connect'] = 'Unable to connect to FTP server with this combination of details.';
+$txt['ftp_login'] = 'Your FTP connection information';
+$txt['ftp_login_info'] = 'This web installer needs your FTP information in order to automate the installation for you. Please note that none of this information is saved in your installation, it is just used to setup SMF.';
+$txt['ftp_server'] = 'Server';
+$txt['ftp_server_info'] = 'The address (often localhost) and port for your FTP server.';
+$txt['ftp_port'] = 'Port';
+$txt['ftp_username'] = 'Username';
+$txt['ftp_username_info'] = 'The username to login with. <em>This will not be saved anywhere.</em>';
+$txt['ftp_password'] = 'Password';
+$txt['ftp_password_info'] = 'The password to login with. <em>This will not be saved anywhere.</em>';
+$txt['ftp_path'] = 'Install Path';
+$txt['ftp_path_info'] = 'This is the <em>relative</em> path you use in your FTP client <a href="' . $_SERVER['PHP_SELF'] . '?ftphelp" onclick="window.open(this.href, \'\', \'width=450,height=250\');return false;" target="_blank">(more help)</a>.';
+$txt['ftp_path_found_info'] = 'The path in the box above was automatically detected.';
+$txt['ftp_path_help'] = 'Your FTP path is the path you see when you log in to your FTP client. It commonly starts with &quot;<pre>www</pre>&quot;, &quot;<pre>public_html</pre>&quot;, or &quot;<pre>httpdocs</pre>&quot; - but it should include the directory SMF is in too, such as &quot;/public_html/forum&quot;. It is different from your URL and full path.<br><br>Files in this path may be overwritten, so make sure it\'s correct.';
+$txt['ftp_path_help_close'] = 'Close';
+$txt['ftp_connect'] = 'Connect';
+
+$txt['force_ssl'] = 'Enable SSL';
+$txt['force_ssl_label'] = 'Force SSL throughout the forum';
+$txt['force_ssl_info'] = '<b>Make sure SSL and HTTPS are supported throughout the forum, otherwise your forum may become inaccessible</b>';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Login.english.php b/Themes/default/languages/Login.english.php
--- a/Themes/default/languages/Login.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Login.english.php	2015-03-05 23:30:06.024678600 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; Login
+// Version: 2.1 Beta 1; Login
 
 global $context;
 
@@ -8,6 +8,8 @@
 $txt['agreement_agree'] = 'I accept the terms of the agreement.';
 $txt['agreement_agree_coppa_above'] = 'I accept the terms of the agreement and I am at least %1$d years old.';
 $txt['agreement_agree_coppa_below'] = 'I accept the terms of the agreement and I am younger than %1$d years old.';
+$txt['agree_coppa_above'] = 'I am at least %1$d years old.';
+$txt['agree_coppa_below'] = 'I am younger than %1$d years old.';
 
 // Registration form.
 $txt['registration_form'] = 'Registration Form';
@@ -26,27 +28,26 @@
 $txt['additional_information'] = 'Additional Information';
 $txt['warning'] = 'Warning!';
 $txt['only_members_can_access'] = 'Only registered members are allowed to access this section.';
-$txt['login_below'] = 'Please login below or';
-$txt['register_an_account'] = 'register an account';
-$txt['login_with_forum'] = 'with %1$s.';
+$txt['login_below'] = 'Please login below.';
+$txt['login_below_or_register'] = 'Please login below or <a href="%1$s">sign up for an account</a> with %2$s';
+
 // Use numeric entities in the below two strings.
 $txt['may_change_in_profile'] = 'You may change it after you login by going to the profile page, or by visiting this page after you login:';
 $txt['your_username_is'] = 'Your username is: ';
 
-$txt['login_hash_error'] = 'Password security has recently been upgraded.  Please enter your password again.';
+$txt['login_hash_error'] = 'Password security has recently been upgraded. Please enter your password again.';
 
-$txt['ban_register_prohibited'] = 'Sorry, you are not allowed to register on this forum.';
-$txt['under_age_registration_prohibited'] = 'Sorry, but users under the age of %1$d are not allowed to register on this forum.';
+$txt['ban_register_prohibited'] = 'Sorry, you are not allowed to sign up on this forum.';
 
 $txt['activate_account'] = 'Account activation';
 $txt['activate_success'] = 'Your account has been successfully activated. You can now proceed to login.';
 $txt['activate_not_completed1'] = 'Your email address needs to be validated before you can login.';
 $txt['activate_not_completed2'] = 'Need another activation email?';
-$txt['activate_after_registration'] = 'Thank you for registering. You will receive an email soon with a link to activate your account.  If you don\'t receive an email after some time, check your spam folder.';
+$txt['activate_after_registration'] = 'Thank you for signing up. You will receive an email soon with a link to activate your account. If you don\'t receive an email after some time, check your spam folder.';
 $txt['invalid_userid'] = 'User does not exist';
 $txt['invalid_activation_code'] = 'Invalid activation code';
 $txt['invalid_activation_username'] = 'Username or email';
-$txt['invalid_activation_new'] = 'If you registered with the wrong email address, type a new one and your password here.';
+$txt['invalid_activation_new'] = 'If you signed up with the wrong email address, type a new one and your password here.';
 $txt['invalid_activation_new_email'] = 'New email address';
 $txt['invalid_activation_password'] = 'Old password';
 $txt['invalid_activation_resend'] = 'Resend activation code';
@@ -57,7 +58,7 @@
 $txt['coppa_no_concent'] = 'The administrator has still not received parent/guardian consent for your account.';
 $txt['coppa_need_more_details'] = 'Need more details?';
 
-$txt['awaiting_delete_account'] = 'Your account has been marked for deletion!<br />If you wish to restore your account, please check the &quot;Reactivate my account&quot; box, and login again.';
+$txt['awaiting_delete_account'] = 'Your account has been marked for deletion!<br>If you wish to restore your account, please check the &quot;Reactivate my account&quot; box, and login again.';
 $txt['undelete_account'] = 'Reactivate my account';
 
 // Use numeric entities in the below three strings.
@@ -68,25 +69,21 @@
 $txt['in_maintain_mode'] = 'This board is in Maintenance Mode.';
 
 // These two are used as a javascript alert; please use international characters directly, not as entities.
-$txt['register_agree'] = 'Please read and accept the agreement before registering.';
+$txt['register_agree'] = 'Please read and accept the agreement before signing up.';
 $txt['register_passwords_differ_js'] = 'The two passwords you entered are not the same!';
 
-$txt['approval_after_registration'] = 'Thank you for registering. The admin must approve your registration before you may begin to use your account, you will receive an email shortly advising you of the admins decision.';
+$txt['approval_after_registration'] = 'Thank you for signing up. The admin must approve your registration before you may begin to use your account, you will receive an email shortly advising you of the admins decision.';
 
 $txt['admin_settings_desc'] = 'Here you can change a variety of settings related to registration of new members.';
 
-$txt['setting_enableOpenID'] = 'Allow users to register using OpenID';
-
 $txt['setting_registration_method'] = 'Method of registration employed for new members';
 $txt['setting_registration_disabled'] = 'Registration Disabled';
 $txt['setting_registration_standard'] = 'Immediate Registration';
 $txt['setting_registration_activate'] = 'Email Activation';
 $txt['setting_registration_approval'] = 'Admin Approval';
-$txt['setting_notify_new_registration'] = 'Notify administrators when a new member joins';
 $txt['setting_send_welcomeEmail'] = 'Send welcome email to new members';
 
 $txt['setting_coppaAge'] = 'Age below which to apply registration restrictions';
-$txt['setting_coppaAge_desc'] = '(Set to 0 to disable)';
 $txt['setting_coppaType'] = 'Action to take when a user below minimum age registers';
 $txt['setting_coppaType_reject'] = 'Reject their registration';
 $txt['setting_coppaType_approval'] = 'Require parent/guardian approval';
@@ -112,8 +109,8 @@
 $txt['admin_register_done'] = 'Member %1$s has been registered successfully!';
 
 $txt['coppa_title'] = 'Age Restricted Forum';
-$txt['coppa_after_registration'] = 'Thank you for registering with ' . $context['forum_name_html_safe'] . '.<br /><br />Because you fall under the age of {MINIMUM_AGE}, it is a legal requirement
-	to obtain your parent or guardian\'s permission before you may begin to use your account.  To arrange for account activation please print off the form below:';
+$txt['coppa_after_registration'] = 'Thank you for signing up with ' . $context['forum_name_html_safe'] . '.<br><br>Because you fall under the age of {MINIMUM_AGE}, it is a legal requirement
+	to obtain your parent or guardian\'s permission before you may begin to use your account. To arrange for account activation please print off the form below:';
 $txt['coppa_form_link_popup'] = 'Load Form In New Window';
 $txt['coppa_form_link_download'] = 'Download Form as Text File';
 $txt['coppa_send_to_one_option'] = 'Then arrange for your parent/guardian to send the completed form by:';
@@ -125,7 +122,7 @@
 $txt['coppa_form_title'] = 'Permission form for registration at ' . $context['forum_name_html_safe'];
 $txt['coppa_form_address'] = 'Address';
 $txt['coppa_form_date'] = 'Date';
-$txt['coppa_form_body'] = 'I {PARENT_NAME},<br /><br />Give permission for {CHILD_NAME} (child name) to become a fully registered member of the forum: ' . $context['forum_name_html_safe'] . ', with the username: {USER_NAME}.<br /><br />I understand that certain personal information entered by {USER_NAME} may be shown to other users of the forum.<br /><br />Signed:<br />{PARENT_NAME} (Parent/Guardian).';
+$txt['coppa_form_body'] = 'I {PARENT_NAME},<br><br>Give permission for {CHILD_NAME} (child name) to become a fully registered member of the forum: ' . $context['forum_name_html_safe'] . ', with the username: {USER_NAME}.<br><br>I understand that certain personal information entered by {USER_NAME} may be shown to other users of the forum.<br><br>Signed:<br>{PARENT_NAME} (Parent/Guardian).';
 
 $txt['visual_verification_sound_again'] = 'Play again';
 $txt['visual_verification_sound_close'] = 'Close window';
@@ -143,9 +140,4 @@
 
 $txt['registration_errors_occurred'] = 'The following errors were detected in your registration. Please correct them to continue:';
 
-$txt['authenticate_label'] = 'Authentication Method';
-$txt['authenticate_password'] = 'Password';
-$txt['authenticate_openid'] = 'OpenID';
-$txt['authenticate_openid_url'] = 'OpenID Authentication URL';
-
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/ManageBoards.english.php b/Themes/default/languages/ManageBoards.english.php
--- a/Themes/default/languages/ManageBoards.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ManageBoards.english.php	2015-03-05 23:30:06.024678600 -0800
@@ -1,11 +1,11 @@
 <?php
-// Version: 2.0; ManageBoards
+// Version: 2.1 Beta 1; ManageBoards
 
 $txt['boards_and_cats'] = 'Manage Boards and Categories';
 $txt['order'] = 'Order';
 $txt['full_name'] = 'Full name';
 $txt['name_on_display'] = 'This is the name that will be displayed.';
-$txt['boards_and_cats_desc'] = 'Edit your categories and boards here. List multiple moderators as <em>&quot;username&quot;, &quot;username&quot;</em>. (these must be usernames not display names!)<br />To create a new board, click the Add Board button. To make the new board a child of a current board, select "Child of..." from the Order drop down menu when creating the board.';
+$txt['boards_and_cats_desc'] = 'Edit your categories and boards here. List multiple moderators as <em>&quot;username&quot;, &quot;username&quot;</em>. (these must be usernames and *not* display names)<br>To create a new board, click the Add Board button. To make the new board a sub-board of a current board, select "Sub-board of..." from the Order drop down menu when creating the board.';
 $txt['parent_members_only'] = 'Regular Members';
 $txt['parent_guests_only'] = 'Guests';
 $txt['catConfirm'] = 'Do you really want to delete this category?';
@@ -37,9 +37,9 @@
 $txt['mboards_delete_cat_contains'] = 'Deleting this category will also delete the below boards, including all topics, posts and attachments within each board';
 $txt['mboards_delete_option1'] = 'Delete category and all boards contained within.';
 $txt['mboards_delete_option2'] = 'Delete category and move all boards contained within to';
-$txt['mboards_delete_board_contains'] = 'Deleting this board will also move the child boards below, including all topics, posts and attachments within each board';
-$txt['mboards_delete_board_option1'] = 'Delete board and move child boards contained within to category level.';
-$txt['mboards_delete_board_option2'] = 'Delete board and move all child boards contained within to';
+$txt['mboards_delete_board_contains'] = 'Deleting this board will also move the sub-boards below, including all topics, posts and attachments within each board';
+$txt['mboards_delete_board_option1'] = 'Delete board and move sub-boards contained within to category level.';
+$txt['mboards_delete_board_option2'] = 'Delete board and move all sub-boards contained within to';
 $txt['mboards_delete_what_do'] = 'Please select what you would like to do with these boards';
 $txt['mboards_delete_confirm'] = 'Confirm';
 $txt['mboards_delete_cancel'] = 'Cancel';
@@ -47,12 +47,15 @@
 $txt['mboards_category'] = 'Category';
 $txt['mboards_description'] = 'Description';
 $txt['mboards_description_desc'] = 'A short description of your board.';
+$txt['mboards_cat_description_desc'] = 'A short description of your category.';
 $txt['mboards_groups'] = 'Allowed Groups';
-$txt['mboards_groups_desc'] = 'Groups allowed to access this board.<br /><em>Note: if the member is in any group or post group checked, they will have access to this board.</em>';
+$txt['mboards_groups_desc'] = 'Groups allowed to access this board.<br><em>Note: if the member is in any group or post group checked, they will have access to this board.</em>';
 $txt['mboards_groups_regular_members'] = 'This group contains all members that have no primary group set.';
 $txt['mboards_groups_post_group'] = 'This group is a post count based group.';
 $txt['mboards_moderators'] = 'Moderators';
-$txt['mboards_moderators_desc'] = 'Additional members to have moderation privileges on this board.  Note that administrators don\'t have to be listed here.';
+$txt['mboards_moderators_desc'] = 'Additional members to have moderation privileges on this board. Note that administrators don\'t have to be listed here.';
+$txt['mboards_moderator_groups'] = 'Moderator Groups';
+$txt['mboards_moderator_groups_desc'] = 'Groups whose members have moderation privileges on this board. Note that this is limited to groups which are not post-based and not "hidden".';
 $txt['mboards_count_posts'] = 'Count Posts';
 $txt['mboards_count_posts_desc'] = 'Makes new replies and topics raise members\' post counts.';
 $txt['mboards_unchanged'] = 'Unchanged';
@@ -69,11 +72,9 @@
 $txt['mboards_redirect_reset'] = 'Reset redirect count';
 $txt['mboards_redirect_reset_desc'] = 'Selecting this will reset the redirection count for this board to zero.';
 $txt['mboards_current_redirects'] = 'Currently: %1$s';
-$txt['mboards_redirect_disabled'] = 'Note: Board must be empty of topics to enable this option.';
-$txt['mboards_redirect_disabled_recycle'] = 'Note: You cannot set the recycle bin board to be a redirection board.';
 
 $txt['mboards_order_before'] = 'Before';
-$txt['mboards_order_child_of'] = 'Child of';
+$txt['mboards_order_child_of'] = 'Sub-board of';
 $txt['mboards_order_in_category'] = 'In category';
 $txt['mboards_current_position'] = 'Current Position';
 $txt['no_valid_parent'] = 'Board %1$s does not have a valid parent. Use the \'find and repair errors\' function to fix this.';
@@ -85,9 +86,12 @@
 $txt['mboards_settings_submit'] = 'Save';
 $txt['recycle_enable'] = 'Enable recycling of deleted topics';
 $txt['recycle_board'] = 'Board for recycled topics';
-$txt['recycle_board_unselected_notice'] = 'You have enabled the recycling of topics without specifying a board to place them in.  This feature will not be enabled until you specify a board to place recycled topics into.';
-$txt['countChildPosts'] = 'Count child\'s posts in parent\'s totals';
+$txt['redirect_board_desc'] = 'A board that redirects users if they visit it';
+$txt['recycle_board_unselected_notice'] = 'You have enabled the recycling of topics without specifying a board to place them in. This feature will not be enabled until you specify a board to place recycled topics into.';
+$txt['countChildPosts'] = 'Count sub-board\'s posts in parent\'s totals';
 $txt['allow_ignore_boards'] = 'Allow boards to be ignored';
+$txt['deny_boards_access'] = 'Enable the option to deny board access based on membergroup';
+$txt['boardsaccess_option_desc'] = 'For each permission you can choose \'Allow\' (A), \'Disallow\' (X), or <span class="alert">\'Deny\' (D)</span>.<br><br>If you deny access, any member - (including moderators) - in that group will be denied access.<br>For this reason, you should set deny carefully, only when <strong>necessary</strong>. Disallow, on the other hand, denies unless otherwise granted.';
 
 $txt['mboards_select_destination'] = 'Select destination for board \'<strong>%1$s</strong>\'';
 $txt['mboards_cancel_moving'] = 'Cancel moving';
diff -ru a/Themes/default/languages/ManageCalendar.english.php b/Themes/default/languages/ManageCalendar.english.php
--- a/Themes/default/languages/ManageCalendar.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ManageCalendar.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; ManageCalendar
+// Version: 2.1 Beta 1; ManageCalendar
 
 $txt['calendar_desc'] = 'From here you can modify all aspects of the calendar.';
 
@@ -16,6 +16,7 @@
 $txt['setting_cal_showholidays'] = 'Show holidays';
 $txt['setting_cal_showbdays'] = 'Show birthdays';
 $txt['setting_cal_showevents'] = 'Show events';
+$txt['setting_cal_export'] = 'Allow events to be exported in iCal format';
 $txt['setting_cal_show_never'] = 'Never';
 $txt['setting_cal_show_cal'] = 'In calendar only';
 $txt['setting_cal_show_index'] = 'On board index only';
@@ -28,14 +29,40 @@
 $txt['setting_cal_maxspan'] = 'Max number of days an event can span';
 $txt['setting_cal_showInTopic'] = 'Show linked events in topic display';
 
+$txt['setting_cal_display_type'] = 'Cell Display Type';
+$txt['setting_cal_display_comfortable'] = 'Comfortable';
+$txt['setting_cal_display_compact'] = 'Compact';
+
+$txt['setting_cal_disable_prev_next'] = 'Disable Three Month Blocks';
+
+$txt['setting_cal_highlight_events'] = 'Highlight Events';
+$txt['setting_cal_highlight_holidays'] = 'Highlight Holidays';
+$txt['setting_cal_highlight_birthdays'] = 'Highlight Birthdays';
+
+$txt['setting_cal_highlight_none'] = 'Nowhere';
+$txt['setting_cal_highlight_mini'] = 'Mini Calendars Only';
+$txt['setting_cal_highlight_main'] = 'Main Calendar Only';
+$txt['setting_cal_highlight_both'] = 'Mini &amp; Main Calendars';
+
+$txt['setting_cal_week_links'] = 'Show Week Links';
+$txt['setting_cal_week_links_none'] = 'Nowhere';
+$txt['setting_cal_week_links_mini'] = 'Mini Calendars Only';
+$txt['setting_cal_week_links_main'] = 'Main Calendar Only';
+$txt['setting_cal_week_links_both'] = 'Mini &amp; Main Calendars';
+$txt['setting_cal_prev_next_links'] = 'Show <em>Previous / Next</em> Month Links';
+
+// The name of this setting is kind of misleading...we can't shorten actual months unfortunately!
+$txt['setting_cal_short_months'] = 'Short Month Titles';
+$txt['setting_cal_short_days'] = 'Short Day Titles';
+
 // Adding/Editing/Viewing Holidays
 $txt['manage_holidays_desc'] = 'From here you can add and remove holidays from your forum calendar.';
 $txt['current_holidays'] = 'Current Holidays';
 $txt['holidays_title'] = 'Holiday';
 $txt['holidays_title_label'] = 'Title';
 $txt['holidays_delete_confirm'] = 'Are you sure you wish to remove these holidays?';
-$txt['holidays_add'] = 'Add New Holiday';
-$txt['holidays_edit'] = 'Edit Existing Holiday';
+$txt['holidays_add'] = 'Add new holiday';
+$txt['holidays_edit'] = 'Edit existing holiday';
 $txt['holidays_button_add'] = 'Add';
 $txt['holidays_button_edit'] = 'Edit';
 $txt['holidays_button_remove'] = 'Remove';
diff -ru a/Themes/default/languages/ManageMail.english.php b/Themes/default/languages/ManageMail.english.php
--- a/Themes/default/languages/ManageMail.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ManageMail.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; ManageMail
+// Version: 2.1 Beta 1; ManageMail
 
 $txt['mailqueue_desc'] = 'From this page you can configure your mail settings, as well as viewing and administrating the current mail queue if it is enabled.';
 
@@ -10,22 +10,21 @@
 $txt['smtp_username'] = 'SMTP username';
 $txt['smtp_password'] = 'SMTP password';
 
-$txt['mail_queue'] = 'Enable Mail Queue';
 $txt['mail_limit'] = 'Maximum emails to send per minute';
-$txt['mail_limit_desc'] = '(Set to 0 to disable)';
 $txt['mail_quantity'] = 'Maximum amount of emails to send per page load';
 
-$txt['mailqueue_stats'] = 'Mail Queue Statistics';
+$txt['mailqueue_stats'] = 'Mail queue statistics';
 $txt['mailqueue_oldest'] = 'Oldest Mail';
 $txt['mailqueue_oldest_not_available'] = 'N/A';
-$txt['mailqueue_size'] = 'Queue Length';
+$txt['mailqueue_size'] = 'Queue length';
 
 $txt['mailqueue_age'] = 'Age';
 $txt['mailqueue_priority'] = 'Priority';
 $txt['mailqueue_recipient'] = 'Recipient';
 $txt['mailqueue_subject'] = 'Subject';
-$txt['mailqueue_clear_list'] = 'Send Mail Queue Now';
+$txt['mailqueue_clear_list'] = 'Send mail queue now';
 $txt['mailqueue_no_items'] = 'The mail queue is currently empty';
+$txt['personal_message'] = 'Personal Message';
 // Do not use numeric entities in below string.
 $txt['mailqueue_clear_list_warning'] = 'Are you sure you wish to send the whole mail queue now? This will override any limits you have set.';
 
@@ -44,7 +43,7 @@
 $txt['mq_mpriority_2'] = 'High';
 $txt['mq_mpriority_1'] = 'Very High';
 
-$txt['birthday_email'] = 'Birthday Message to use';
-$txt['birthday_body'] = 'Email Body';
-$txt['birthday_subject'] = 'Email Subject';
+$txt['birthday_email'] = 'Birthday message to use';
+$txt['birthday_body'] = 'Email body';
+$txt['birthday_subject'] = 'Email subject';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/ManageMaintenance.english.php b/Themes/default/languages/ManageMaintenance.english.php
--- a/Themes/default/languages/ManageMaintenance.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ManageMaintenance.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; ManageMaintenance
+// Version: 2.1 Beta 1; ManageMaintenance
 
 $txt['repair_zero_ids'] = 'Found topics and/or messages with topic or message IDs of 0.';
 $txt['repair_missing_topics'] = 'Message #%1$d is in non-existent topic #%2$d.';
@@ -12,7 +12,7 @@
 $txt['repair_missing_boards'] = 'Topic #%1$d is in board #%2$d, which is missing.';
 $txt['repair_missing_categories'] = 'Board #%1$d is in category #%2$d, which is missing.';
 $txt['repair_missing_posters'] = 'Message #%1$d was posted by member #%2$d, who is now missing.';
-$txt['repair_missing_parents'] = 'Board #%1$d is a child of board #%2$d, which is missing.';
+$txt['repair_missing_parents'] = 'Board #%1$d is a sub-board of board #%2$d, which is missing.';
 $txt['repair_missing_polls'] = 'Topic #%1$d is tied to non-existent poll #%2$d.';
 $txt['repair_polls_missing_topics'] = 'Poll #%1$d is tied to non-existent topic #%2$d.';
 $txt['repair_missing_calendar_topics'] = 'Event #%1$d is tied to topic #%2$d, which is missing.';
@@ -48,7 +48,7 @@
 $txt['repair_operation_missing_boards'] = 'Topics in a non-existent board';
 $txt['repair_operation_missing_categories'] = 'Boards in a non-existent category';
 $txt['repair_operation_missing_posters'] = 'Messages linked to non-existent members';
-$txt['repair_operation_missing_parents'] = 'Child boards with non-existent parents';
+$txt['repair_operation_missing_parents'] = 'Sub-boards with non-existent parents';
 $txt['repair_operation_missing_polls'] = 'Topics linked to non-existent polls';
 $txt['repair_operation_missing_calendar_topics'] = 'Events linked to non-existent topics';
 $txt['repair_operation_missing_log_topics'] = 'Topic logs linked to non-existent topics';
@@ -81,7 +81,7 @@
 $txt['database_optimize'] = 'Optimize Database';
 $txt['database_numb_tables'] = 'Your database contains %1$d tables.';
 $txt['database_optimize_attempt'] = 'Attempting to optimize your database...';
-$txt['database_optimizing'] = 'Optimizing %1$s... %2$01.2f kb optimized.';
+$txt['database_optimizing'] = 'Optimizing %1$s... %2$01.2f KB optimized.';
 $txt['database_already_optimized'] = 'All of the tables were already optimized.';
 $txt['database_opimize_unneeded'] = 'It wasn\'t necessary to optimize any tables.';
 $txt['database_optimized'] = ' table(s) optimized.';
@@ -99,8 +99,10 @@
 $txt['error_message'] = 'Error message';
 $txt['clear_filter'] = 'Clear filter';
 $txt['remove_selection'] = 'Remove Selection';
-$txt['remove_filtered_results'] = 'Remove All Filtered Results';
-$txt['sure_about_errorlog_remove'] = 'Are you sure you want to remove all error messages?';
+$txt['remove_filtered_results'] = 'Remove all filtered results';
+$txt['sure_about_errorlog_remove'] = 'Are you sure you want to completely clear the error log?';
+$txt['remove_selection_confirm'] = 'Are you sure you want to delete the selected entries?';
+$txt['remove_filtered_results_confirm'] = 'Are you sure you want to delete the filtered entries?';
 $txt['reverse_direction'] = 'Reverse chronological order of list';
 $txt['error_type'] = 'Type of error';
 $txt['filter_only_type'] = 'Only show the errors of this type';
@@ -110,16 +112,22 @@
 $txt['errortype_all'] = 'All errors';
 $txt['errortype_general'] = 'General';
 $txt['errortype_general_desc'] = 'General errors that have not been categorized into another type';
-$txt['errortype_critical'] = '<span style="color:red;">Critical</span>';
-$txt['errortype_critical_desc'] = 'Critical errors.  These should be taken care of as quickly as possible.  Ignoring these errors can result in your forum failing and possibly security issues';
+$txt['errortype_critical'] = '<span class="red">Critical</span>';
+$txt['errortype_critical_desc'] = 'Critical errors. These should be taken care of as quickly as possible. Ignoring these errors can result in your forum failing and possibly security issues';
 $txt['errortype_database'] = 'Database';
-$txt['errortype_database_desc'] = 'Errors caused by faulty queries.  These should be looked at and reported to the SMF team.';
+$txt['errortype_database_desc'] = 'Errors caused by faulty queries. These should be looked at and reported to the SMF team.';
 $txt['errortype_undefined_vars'] = 'Undefined';
 $txt['errortype_undefined_vars_desc'] = 'Errors caused by the use of undefined variables, indexes, or offsets.';
+$txt['errortype_ban'] = 'Bans';
+$txt['errortype_ban_desc'] = 'A log of banned users trying to access your forum.';
 $txt['errortype_template'] = 'Template';
 $txt['errortype_template_desc'] = 'Errors related to the loading of templates.';
 $txt['errortype_user'] = 'User';
-$txt['errortype_user_desc'] = 'Errors resulting from user errors.  Includes failed passwords, trying to login when banned, and trying to do an action for which they do not have permission.';
+$txt['errortype_user_desc'] = 'Errors resulting from user errors. Includes failed passwords, trying to login when banned, and trying to do an action for which they do not have permission.';
+$txt['errortype_cron'] = 'Cron';
+$txt['errortype_cron_desc'] = 'Errors resulting from background tasks.';
+$txt['errortype_paidsubs'] = 'Paid Subs';
+$txt['errortype_paidsubs'] = 'Errors resulting from paid subscriptions, which can include notification of payment failures.';
 
 $txt['maintain_recount'] = 'Recount all forum totals and statistics';
 $txt['maintain_recount_info'] = 'Should the total replies of a topic or the number of PMs in your inbox be incorrect: this function will recount all saved counts and statistics for you.';
@@ -130,7 +138,7 @@
 $txt['maintain_cache'] = 'Empty the file cache';
 $txt['maintain_cache_info'] = 'This function will empty out the file cache should you need it to be cleared.';
 $txt['maintain_optimize'] = 'Optimize all tables';
-$txt['maintain_optimize_info'] = 'This task allows you to optimize all tables. This will get rid of overhead, effectively making the tables smaller in size and your forum faster!';
+$txt['maintain_optimize_info'] = 'This task allows you to optimize all tables. This will get rid of overhead, effectively making the tables smaller in size and your forum faster.';
 $txt['maintain_version'] = 'Check all files against current versions';
 $txt['maintain_version_info'] = 'This maintenance task allows you to do a detailed version check of all forum files against the official list of latest versions.';
 $txt['maintain_run_now'] = 'Run task now';
@@ -147,14 +155,17 @@
 $txt['maintain_old_since_days1'] = 'Remove all topics not posted in for ';
 $txt['maintain_old_since_days2'] = ' days, which are:';
 $txt['maintain_old_nothing_else'] = 'Any sort of topic.';
-$txt['maintain_old_are_moved'] = 'Moved topic notices.';
+$txt['maintain_old_are_moved'] = 'Moved/merged topic notices.';
 $txt['maintain_old_are_locked'] = 'Locked.';
 $txt['maintain_old_are_not_stickied'] = 'But don\'t count stickied topics.';
-$txt['maintain_old_all'] = 'All Boards (click to select specific boards)';
-$txt['maintain_old_choose'] = 'Specific Boards (click to select all)';
+$txt['maintain_old_all'] = 'All boards (click to select specific boards)';
+$txt['maintain_old_choose'] = 'Specific boards (click to select all)';
 $txt['maintain_old_remove'] = 'Remove now';
 $txt['maintain_old_confirm'] = 'Are you really sure you want to delete old posts now?\\n\\nThis cannot be undone!';
 
+$txt['maintain_old_drafts'] = 'Remove old drafts';
+$txt['maintain_old_drafts_days'] = 'Remove all drafts older than';
+$txt['maintain_old_drafts_confirm'] = 'Are you really sure you want to delete old drafts now?\\n\\nThis cannot be undone!';
 $txt['maintain_members'] = 'Remove Inactive Members';
 $txt['maintain_members_ungrouped'] = 'Ungrouped Members <span class="smalltext">(Members with no assigned groups)</span>';
 $txt['maintain_members_since1'] = 'Remove all members who have not';
@@ -170,7 +181,7 @@
 $txt['utf8_introduction'] = 'UTF-8 is an international character set covering nearly all languages around the world. Converting your database and data to UTF-8 can make it easier to support multiple languages on the same board. It also can enhance search and sorting capabilities for languages with non-latin characters.';
 $txt['utf8_warning'] = 'If you want to convert your data and database to UTF-8, be aware of the following:
 <ul class="normallist">
-	<li>Converting character sets might be <em>harmful</em> for your data! Make sure you have backed up your database <em>before</em> converting.</li>
+	<li>Converting character sets might be <em>harmful</em> for your data. Make sure you have backed up your database <em>before</em> converting.</li>
 	<li>Because UTF-8 is a richer character set than most other character sets, there\'s no way back, unless by restoring your database to before the conversion.</li>
 	<li>After converting your data and database to UTF-8, you will need UTF-8 compatible language files.</li>
 </ul>';
@@ -183,7 +194,16 @@
 $txt['utf8_target_charset'] = 'Convert data and database to';
 $txt['utf8_utf8'] = 'UTF-8';
 $txt['utf8_db_version_too_low'] = 'The version of MySQL that your database server is using is not high enough to support UTF-8 properly. A minimum version of 4.1.2 is required.';
-$txt['utf8_cannot_convert_fulltext'] = 'Your messages table is using a fulltext index for use when searching.  You cannot proceed in converting to UTF-8 until that index is removed. You can re-create it after the conversion has been completed.';
+$txt['utf8_cannot_convert_fulltext'] = 'Your messages table is using a fulltext index for use when searching. You cannot proceed in converting to UTF-8 until that index is removed. You can re-create it after the conversion has been completed.';
+
+$txt['text_title'] = 'Convert to TEXT';
+$txt['mediumtext_title'] = 'Convert to MEDIUMTEXT';
+$txt['mediumtext_introduction'] = 'The default messages table can contain posts up to a size of 65535 characters, in order be able to store bigger texts the column must be converted to "MEDIUMTEXT". It is also possible to revert the column back to TEXT (that operation would reduce the space occupied), but <strong>only if</strong> none of the posts in your database exceed the size of 65535 characters. This condition will be verified before the conversion.';
+$txt['body_checking_introduction'] = 'This function will convert the column of your database that contains the text of the messages into a "TEXT" format (currently is "MEDIUMTEXT"). This operation will allow to slightly reduce the amount of space occupied by each message (1 byte per message). If any message stored into the database is longer than 65535 characters it will be truncated and part of the text will be lost.';
+$txt['exceeding_messages'] = 'The following messages are longer than 65535 characters and will be truncated by the process:';
+$txt['exceeding_messages_morethan'] = 'And other %1$d';
+$txt['convert_to_text'] = 'No messages are longer than 65535 characters. You can safely proceed with the conversion without losing any part of the text.';
+$txt['convert_to_suggest_text'] = 'The messages body column in your database is currently set as MEDIUMTEXT, but the maximum allowed length set for the messages is lower than 65535 characters. You may free some space converting the column to TEXT.';
 
 $txt['entity_convert_title'] = 'Convert HTML-entities to UTF-8 characters';
 $txt['entity_convert_only_utf8'] = 'The database needs to be in UTF-8 format before HTML-entities can be converted to UTF-8';
@@ -197,9 +217,13 @@
 $txt['move_topics_to'] = 'to';
 $txt['move_topics_now'] = 'Move now';
 $txt['move_topics_confirm'] = 'Are you sure you want to move ALL the topics from &quot;%board_from%&quot; to &quot;%board_to%&quot;?';
+$txt['move_topics_older_than'] = 'Move topics not posted in for ';
+$txt['move_type_sticky'] = 'Sticky topics';
+$txt['move_type_locked'] = 'Locked topics';
+$txt['move_zero_all'] = 'Enter 0 to move all topics';
 
 $txt['maintain_reattribute_posts'] = 'Reattribute User Posts';
-$txt['reattribute_guest_posts'] = 'Attribute guest posts made with';
+$txt['reattribute_guest_posts'] = 'Attribute posts made with';
 $txt['reattribute_email'] = 'Email address of';
 $txt['reattribute_username'] = 'Username of';
 $txt['reattribute_current_member'] = 'Attribute posts to member';
@@ -211,4 +235,14 @@
 $txt['reattribute_confirm_email'] = 'an email address';
 $txt['reattribute_cannot_find_member'] = 'Could not find member to attribute posts to.';
 
+$txt['maintain_recountposts'] = 'Recount User Posts';
+$txt['maintain_recountposts_info'] = 'Run this maintenance task to update your users total post count. It will recount all (countable) posts made by each user and then update their profile post count totals';
+
+$txt['safe_mode_enabled'] = '<a href="http://php.net/manual/en/features.safe-mode.php">safe_mode</a> is enabled on your server!<br>The backup done with this tool cannot be considered reliable!';
+$txt['use_external_tool'] = 'Please consider using an external tool to backup your database, any backup created with this utility cannot be considered 100% reliable.';
+$txt['zipped_file'] = 'If you want you can create a compressed (zipped) backup.';
+$txt['plain_text'] = 'The best method to backup your database is to create a plain text file, a compressed package may not be completely reliable.';
+$txt['enable_maintenance1'] = 'Due to the size of your forum, it is recommended to place your forum in "maintenance mode" before you start the backup.';
+$txt['enable_maintenance2'] = 'To proceed, due to the size of your forum, please place your forum in "maintenance mode".';
+
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/ManageMembers.english.php b/Themes/default/languages/ManageMembers.english.php
--- a/Themes/default/languages/ManageMembers.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ManageMembers.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; ManageMembers
+// Version: 2.1 Beta 1; ManageMembers
 
 global $context;
 
@@ -13,6 +13,7 @@
 $txt['membergroups_add_group'] = 'Add group';
 $txt['membergroups_regular'] = 'Regular groups';
 $txt['membergroups_post'] = 'Post count based groups';
+$txt['membergroups_guests_na'] = 'n/a';
 
 $txt['membergroups_group_name'] = 'Membergroup name';
 $txt['membergroups_new_board'] = 'Visible Boards';
@@ -23,6 +24,9 @@
 $txt['membergroups_new_as_copy'] = 'based off of';
 $txt['membergroups_new_copy_none'] = '(none)';
 $txt['membergroups_can_edit_later'] = 'You can edit them later.';
+$txt['membergroups_can_manage_access'] = 'This group can see all boards because they have the power to manage boards.';
+
+$txt['membergroups_cannot_delete_paid'] = 'This group cannot be deleted, it is currently in use by the following paid subscription(s): %1$s';
 
 $txt['membergroups_edit_group'] = 'Edit Membergroup';
 $txt['membergroups_edit_name'] = 'Group name';
@@ -32,13 +36,13 @@
 $txt['membergroups_edit_inherit_permissions_from'] = 'Inherit From';
 $txt['membergroups_edit_hidden'] = 'Visibility';
 $txt['membergroups_edit_hidden_no'] = 'Visible';
-$txt['membergroups_edit_hidden_boardindex'] = 'Visible - Except in Group Key';
+$txt['membergroups_edit_hidden_boardindex'] = 'Visible - Apart from in group key';
 $txt['membergroups_edit_hidden_all'] = 'Invisible';
 // Do not use numeric entities in the below string.
-$txt['membergroups_edit_hidden_warning'] = 'Are you sure you want to disallow assignment of this group as a users primary group?\\n\\nDoing so will restrict assignment to additional groups only, and will update all current &quot;primary&quot; members to have it as an additional group only.';
+$txt['membergroups_edit_hidden_warning'] = 'Are you sure you want to disallow assignment of this group as a users primary group?\\n\\nDoing so will restrict assignment to additional groups only, and will update all current &quot;primary&quot; members to have it as an additional group only.\\n\\nIt will also remove the group as moderator from any boards it is currently assigned to moderate.';
 $txt['membergroups_edit_desc'] = 'Group description';
-$txt['membergroups_edit_group_type'] = 'Group Type';
-$txt['membergroups_edit_select_group_type'] = 'Select Group Type';
+$txt['membergroups_edit_group_type'] = 'Group type';
+$txt['membergroups_edit_select_group_type'] = 'Select Group type';
 $txt['membergroups_group_type_private'] = 'Private <span class="smalltext">(Membership must be assigned)</span>';
 $txt['membergroups_group_type_protected'] = 'Protected <span class="smalltext">(Only administrators can manage and assign)</span>';
 $txt['membergroups_group_type_request'] = 'Requestable <span class="smalltext">(User may request membership)</span>';
@@ -46,14 +50,16 @@
 $txt['membergroups_group_type_post'] = 'Post Based <span class="smalltext">(Membership based on post count)</span>';
 $txt['membergroups_min_posts'] = 'Required posts';
 $txt['membergroups_online_color'] = 'Color in online list';
-$txt['membergroups_star_count'] = 'Number of star images';
-$txt['membergroups_star_image'] = 'Star image filename';
-$txt['membergroups_star_image_note'] = 'you can use $language for the language of the user';
+$txt['membergroups_icon_count'] = 'Number of icon images';
+$txt['membergroups_icon_image'] = 'Icon image filename';
+$txt['membergroups_icon_image_note'] = 'You can upload custom images to the default theme directory to be able to select them here.';
 $txt['membergroups_max_messages'] = 'Max personal messages';
 $txt['membergroups_max_messages_note'] = '0 = unlimited';
 $txt['membergroups_edit_save'] = 'Save';
 $txt['membergroups_delete'] = 'Delete';
-$txt['membergroups_confirm_delete'] = 'Are you sure you want to delete this group?!';
+$txt['membergroups_confirm_delete'] = 'Are you sure you want to delete this group?';
+$txt['membergroups_confirm_delete_mod'] = 'This group is assigned to moderate one or more boards. Are you sure you want to delete it?';
+$txt['membergroups_swap_mod'] = 'This group is assigned to moderate one or more boards. Changing it to a post group will result in that group being dropped as moderator of those boards.';
 
 $txt['membergroups_members_title'] = 'Viewing Group';
 $txt['membergroups_members_group_members'] = 'Group Members';
@@ -73,11 +79,11 @@
 $txt['membergroups_settings'] = 'Membergroup Settings';
 $txt['groups_manage_membergroups'] = 'Groups allowed to change membergroups';
 $txt['membergroups_select_permission_type'] = 'Select permission profile';
-$txt['membergroups_images_url'] = '{theme URL}/images/';
+$txt['membergroups_images_url'] = 'Themes/{theme}/images/membericons/';
 $txt['membergroups_select_visible_boards'] = 'Show boards';
 $txt['membergroups_members_top'] = 'Members';
 $txt['membergroups_name'] = 'Name';
-$txt['membergroups_stars'] = 'Stars';
+$txt['membergroups_icons'] = 'Icons';
 
 $txt['admin_browse_approve'] = 'Members whose accounts are awaiting approval';
 $txt['admin_browse_approve_desc'] = 'From here you can manage all members who are waiting to have their accounts approved.';
@@ -105,14 +111,14 @@
 $txt['admin_browse_w_remind'] = 'Remind';
 $txt['admin_browse_w_approve_deletion'] = 'Approve (Delete Accounts)';
 $txt['admin_browse_w_email'] = 'and send email';
-$txt['admin_browse_w_approve_require_activate'] = 'Approve and Require Activation';
+$txt['admin_browse_w_approve_require_activate'] = 'Approve and require activation';
 
 $txt['admin_browse_filter_by'] = 'Filter By';
 $txt['admin_browse_filter_show'] = 'Displaying';
-$txt['admin_browse_filter_type_0'] = 'Unactivated New Accounts';
-$txt['admin_browse_filter_type_2'] = 'Unactivated Email Changes';
-$txt['admin_browse_filter_type_3'] = 'Unapproved New Accounts';
-$txt['admin_browse_filter_type_4'] = 'Unapproved Account Deletions';
+$txt['admin_browse_filter_type_0'] = 'Unactivated new accounts';
+$txt['admin_browse_filter_type_2'] = 'Unactivated email changes';
+$txt['admin_browse_filter_type_3'] = 'Unapproved new accounts';
+$txt['admin_browse_filter_type_4'] = 'Unapproved account deletions';
 $txt['admin_browse_filter_type_5'] = 'Unapproved "Under Age" Accounts';
 
 $txt['admin_browse_outstanding'] = 'Outstanding Members';
@@ -121,8 +127,8 @@
 $txt['admin_browse_outstanding_perform'] = 'Perform the following action';
 $txt['admin_browse_outstanding_go'] = 'Perform Action';
 
-$txt['check_for_duplicate'] = 'Check for Duplicates';
-$txt['dont_check_for_duplicate'] = 'Don\'t Check for Duplicates';
+$txt['check_for_duplicate'] = 'Check for duplicates';
+$txt['dont_check_for_duplicate'] = 'Don\'t check for duplicates';
 $txt['duplicates'] = 'Duplicates';
 
 $txt['not_activated'] = 'Not activated';
diff -ru a/Themes/default/languages/ManagePaid.english.php b/Themes/default/languages/ManagePaid.english.php
--- a/Themes/default/languages/ManagePaid.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ManagePaid.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,16 +1,23 @@
 <?php
-// Version: 2.0; ManagePaid
+// Version: 2.1 Beta 1; ManagePaid
 
 global $boardurl;
 
+// Some payment gateways need language specific information.
+$txt['lang_paypal'] = 'US';
+
 // Symbols.
 $txt['usd_symbol'] = '$%1.2f';
 $txt['eur_symbol'] = '&euro;%1.2f';
 $txt['gbp_symbol'] = '&pound;%1.2f';
+$txt['cad_symbol'] = 'C$%1.2f';
+$txt['aud_symbol'] = 'A$%1.2f';
 
 $txt['usd'] = 'USD ($)';
 $txt['eur'] = 'EURO (&euro;)';
 $txt['gbp'] = 'GBP (&pound;)';
+$txt['cad'] = 'CAD (C$)';
+$txt['aud'] = 'AUD (A$)';
 $txt['other'] = 'Other';
 
 $txt['paid_username'] = 'Username';
@@ -23,11 +30,11 @@
 
 // Setting type strings.
 $txt['paid_enabled'] = 'Enable Paid Subscriptions';
-$txt['paid_enabled_desc'] = 'This must be checked the paid subscriptions to be used on the forum.';
+$txt['paid_enabled_desc'] = 'This must be checked for the paid subscriptions to be used on the forum.';
 $txt['paid_email'] = 'Send Notification Emails';
 $txt['paid_email_desc'] = 'Inform the admin when a subscription automatically changes.';
 $txt['paid_email_to'] = 'Email for Correspondence';
-$txt['paid_email_to_desc'] = 'Comma-separated list of addresses to email notifications to in addition to forum admins.';
+$txt['paid_email_to_desc'] = 'Comma-separated list of addresses to email to send notifications to.';
 $txt['paidsubs_test'] = 'Enable test mode';
 $txt['paidsubs_test_desc'] = 'This puts the paid subscriptions into &quot;test&quot; mode, which will, wherever possible, use sandbox payment methods in PayPal, Authorize.net etc. Do not enable unless you know what you are doing!';
 $txt['paidsubs_test_confirm'] = 'Are you sure you want to enable test mode?';
@@ -41,6 +48,8 @@
 $txt['paid_currency_symbol_desc'] = 'Use \'%1.2f\' to specify where number goes, for example $%1.2f, %1.2fDM etc';
 $txt['paypal_email'] = 'Paypal email address';
 $txt['paypal_email_desc'] = 'Leave blank if you do not wish to use paypal.';
+$txt['paypal_sandbox_email'] = 'Paypal sandbox email address';
+$txt['paypal_sandbox_email_desc'] = 'Can be left blank if test mode is disabled or not using PayPal.';
 $txt['worldpay_id'] = 'WorldPay Install ID';
 $txt['worldpay_id_desc'] = 'The Install ID generated by WorldPay. Leave blank if you are not using WorldPay';
 $txt['worldpay_password'] = 'WorldPay Callback Password';
@@ -56,10 +65,10 @@
 $txt['nochex_email_desc'] = 'Email of a merchant account at Nochex. Leave blank if you are not using Nochex';
 $txt['paid_settings_save'] = 'Save';
 
-$txt['paid_note'] = '<strong class="alert">Note:</strong><br />For subscriptions to be automatically updated for your users, you
-	will need to setup a return URL for each of your payment methods. For all payment types, this return URL should be set as:<br /><br />
-	&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong>' . $boardurl . '/subscriptions.php</strong><br /><br />
-	You can edit the link for paypal directly, by clicking <a href="https://www.paypal.com/us/cgi-bin/webscr?cmd=_profile-ipn-notify" target="_blank">here</a>.<br />
+$txt['paid_note'] = '<strong class="alert">Note:</strong><br>For subscriptions to be automatically updated for your users, you
+	will need to setup a return URL for each of your payment methods. For all payment types, this return URL should be set as:<br><br>
+	&nbsp;&nbsp;&bull;&nbsp;&nbsp;<strong>' . $boardurl . '/subscriptions.php</strong><br><br>
+	You can edit the link for paypal directly, by clicking <a href="https://www.paypal.com/us/cgi-bin/webscr?cmd=_profile-ipn-notify" target="_blank">here</a>.<br>
 	For the other gateways (If installed) you can normally find it in your customer panels, usually under the term &quot;Return URL&quot; or &quot;Callback URL&quot;.';
 
 // View subscription strings.
@@ -87,12 +96,14 @@
 $txt['paid_mod_name'] = 'Subscription Name';
 $txt['paid_mod_desc'] = 'Description';
 $txt['paid_mod_reminder'] = 'Send Reminder Email';
-$txt['paid_mod_reminder_desc'] = 'Days before subscription is due to expire to send reminder. (In days, 0 to disable)';
+$txt['paid_mod_reminder_desc'] = 'Days before subscription is due to expire to send reminder.';
 $txt['paid_mod_email'] = 'Email to Send upon Completion';
 $txt['paid_mod_email_desc'] = 'Where {NAME} is members name; {FORUM} is community name. Email subject should be on first line. Blank for no email notification.';
 $txt['paid_mod_cost_usd'] = 'Cost (USD)';
 $txt['paid_mod_cost_eur'] = 'Cost (EUR)';
 $txt['paid_mod_cost_gbp'] = 'Cost (GBP)';
+$txt['paid_mod_cost_cad'] = 'Cost (CAD)';
+$txt['paid_mod_cost_aud'] = 'Cost (AUD)';
 $txt['paid_mod_cost_blank'] = 'Leave this blank to not offer this currency.';
 $txt['paid_mod_span'] = 'Length of Subscription';
 $txt['paid_mod_span_days'] = 'Days';
@@ -107,14 +118,14 @@
 $txt['paid_mod_add_groups_desc'] = 'Additional groups to add the user to after subscription.';
 $txt['paid_mod_no_group'] = 'Don\'t Change';
 $txt['paid_mod_edit_note'] = 'Note that as this group has existing subscribers the group settings cannot be changed!';
-$txt['paid_mod_delete_warning'] = '<strong>WARNING</strong><br /><br />If you delete this subscription all users currently subscribed will lose any access rights granted by the subscription. Unless you are sure you want to do this it is recommended that you simply deactivate a subscription rather than delete it.<br />';
+$txt['paid_mod_delete_warning'] = '<strong>WARNING</strong><br><br>If you delete this subscription all users currently subscribed will lose any access rights granted by the subscription. Unless you are sure you want to do this it is recommended that you simply deactivate a subscription rather than delete it.<br>';
 $txt['paid_mod_repeatable'] = 'Allow user to auto-renew this subscription';
 $txt['paid_mod_allow_partial'] = 'Allow partial subscription';
 $txt['paid_mod_allow_partial_desc'] = 'If this option is enabled, in the case where the user pays less than required they will be granted a subscription for the percentage of the duration they have paid for.';
 $txt['paid_mod_fixed_price'] = 'Subscription for fixed price and period';
 $txt['paid_mod_flexible_price'] = 'Subscription price varies on duration ordered';
 $txt['paid_mod_price_breakdown'] = 'Flexible Price Breakdown';
-$txt['paid_mod_price_breakdown_desc'] = 'Define here how much the subscription should cost dependant on the period they subscribe for. For example, it could cost 12USD to subscribe for a month, but only 100USD for a year. If you don\'t want to define a price for a particular period of time leave it blank.';
+$txt['paid_mod_price_breakdown_desc'] = 'Define here how much the subscription should cost dependent on the period they subscribe for. For example, it could cost 12USD to subscribe for a month, but only 100USD for a year. If you don\'t want to define a price for a particular period of time leave it blank.';
 $txt['flexible'] = 'Flexible';
 
 $txt['paid_per_day'] = 'Price Per Day';
@@ -129,13 +140,13 @@
 // View subscribed users.
 $txt['viewing_users_subscribed'] = 'Viewing Users';
 $txt['view_users_subscribed'] = 'Viewing users subscribed to: &quot;%1$s&quot;';
-$txt['no_subscribers'] = 'There are currently no subscribers to this subscription!';
+$txt['no_subscribers'] = 'There are currently no subscribers to this subscription.';
 $txt['add_subscriber'] = 'Add New Subscriber';
 $txt['edit_subscriber'] = 'Edit Subscriber';
 $txt['delete_selected'] = 'Delete Selected';
 $txt['complete_selected'] = 'Complete Selected';
 
-// !!! These strings are used in conjunction with JavaScript.  Use numeric entities.
+// @todo These strings are used in conjunction with JavaScript. Use numeric entities.
 $txt['delete_are_sure'] = 'Are you sure you want to delete all records of the selected subscriptions?';
 $txt['complete_are_sure'] = 'Are you sure you want to complete the selected subscriptions?';
 
@@ -145,7 +156,6 @@
 $txt['end_date_and_time'] = 'End Date and Time';
 $txt['edit'] = 'EDIT';
 $txt['one_username'] = 'Please enter one username only.';
-$txt['hour'] = 'Hour';
 $txt['minute'] = 'Minute';
 $txt['error_member_not_found'] = 'The member entered could not be found';
 $txt['member_already_subscribed'] = 'This member is already subscribed to this subscription. Please edit their existing subscription.';
@@ -177,14 +187,19 @@
 
 $txt['paid_not_set_currency'] = 'You have not setup your currency yet. Please do so from the <a href="%1$s">Settings</a> section before continuing.';
 $txt['paid_no_cost_value'] = 'You must enter a cost and subscription length.';
+$txt['paid_invalid_duration'] = 'You must enter a valid duration for this subscription.';
+$txt['paid_invalid_duration_D'] = 'If putting in a subscription length measured in days, you can only use 1 to 90 days. If you want a subscription that long, you should use weeks, months or years.';
+$txt['paid_invalid_duration_W'] = 'If putting in a subscription length measured in weeks, you can only use 1 to 52 weeks. If you want a subscription that long, you should use months or years';
+$txt['paid_invalid_duration_M'] = 'If putting in a subscription length measured in months, you can only use 1 to 24 months. If you want a subscription that long, you should use years';
+$txt['paid_invalid_duration_Y'] = 'If putting in a subscription length measured in years, you can only use 1 to 5 years.';
 $txt['paid_all_freq_blank'] = 'You must enter a cost for at least one of the four durations.';
 
 // Some error strings.
 $txt['paid_no_data'] = 'No valid data was sent to the script.';
 
 $txt['paypal_could_not_connect'] = 'Could not connect to PayPal server';
-$txt['paid_sub_not_active'] = 'That subscription is not taking any new users!';
-$txt['paid_disabled'] = 'Paid subscriptions are currently disabled!';
+$txt['paid_sub_not_active'] = 'That subscription is not taking any new users.';
+$txt['paid_disabled'] = 'Paid subscriptions are currently disabled.';
 $txt['paid_unknown_transaction_type'] = 'Unknown Paid Subscriptions transaction type.';
 $txt['paid_empty_member'] = 'Paid subscription handler could not recover member ID';
 $txt['paid_could_not_find_member'] = 'Paid subscription handler could not find member with ID: %1$d';
@@ -197,7 +212,7 @@
 $txt['subscriptions'] = 'Subscriptions';
 $txt['subscription'] = 'Subscription';
 $txt['paid_subs_desc'] = 'Below is a list of all the subscriptions which are available on this forum.';
-$txt['paid_subs_none'] = 'There are currently no paid subscriptions available!';
+$txt['paid_subs_none'] = 'There are currently no paid subscriptions available.';
 
 $txt['paid_current'] = 'Existing Subscriptions';
 $txt['pending_payments'] = 'Pending Payments';
diff -ru a/Themes/default/languages/ManagePermissions.english.php b/Themes/default/languages/ManagePermissions.english.php
--- a/Themes/default/languages/ManagePermissions.english.php	2011-06-07 16:05:33.000000000 -0700
+++ b/Themes/default/languages/ManagePermissions.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; ManagePermissions
+// Version: 2.1 Beta 1; ManagePermissions
 
 $txt['permissions_title'] = 'Manage Permissions';
 $txt['permissions_modify'] = 'Modify';
@@ -23,7 +23,7 @@
 $txt['permissions_profile_reply_only'] = 'Reply Only';
 $txt['permissions_profile_read_only'] = 'Read Only';
 
-$txt['permissions_profile_rename'] = 'Rename';
+$txt['permissions_profile_rename'] = 'Rename all';
 $txt['permissions_profile_edit'] = 'Edit Profiles';
 $txt['permissions_profile_new'] = 'New Profile';
 $txt['permissions_profile_new_create'] = 'Create';
@@ -34,6 +34,23 @@
 $txt['permissions_profile_used_by_none'] = 'No Boards';
 $txt['permissions_profile_do_edit'] = 'Edit';
 $txt['permissions_profile_do_delete'] = 'Delete';
+
+$txt['permissionname_profile_signature'] = 'Edit signature';
+$txt['permissionhelp_profile_signature'] = 'Allow the member to edit the signature field in their profile';
+$txt['permissionname_profile_signature_own'] = 'Own signature';
+$txt['permissionname_profile_signature_any'] = 'Any signature';
+$txt['permissionname_profile_forum'] = 'Allow Forum Profile edits';
+$txt['permissionhelp_profile_forum'] = 'This option will allow a member to edit their Forum Profile';
+$txt['permissionname_profile_forum_own'] = 'Own profile';
+$txt['permissionname_profile_forum_any'] = 'Any profile';
+$txt['permissionname_profile_other'] = 'Edit website';
+$txt['permissionhelp_profile_other'] = 'Allow the member to edit the website fields in their profile';
+$txt['permissionname_profile_other_own'] = 'Own profile';
+$txt['permissionname_profile_other_any'] = 'Any profile';
+$txt['permissionname_profile_blurb'] = 'Edit personal text';
+$txt['permissionhelp_profile_blurb'] = 'Allow the member to edit the personal text field in their profile';
+$txt['permissionname_profile_blurb_own'] = 'Own profile';
+$txt['permissionname_profile_blurb_any'] = 'Any profile';
 $txt['permissions_profile_copy_from'] = 'Copy Permissions From';
 
 $txt['permissions_includes_inherited'] = 'Inherited Groups';
@@ -67,13 +84,12 @@
 $txt['permissions_commit'] = 'Save changes';
 $txt['permissions_on'] = 'in profile';
 $txt['permissions_local_for'] = 'Permissions for group';
+$txt['permissions_option_own'] = 'Own';
+$txt['permissions_option_any'] = 'Any';
 $txt['permissions_option_on'] = 'A';
 $txt['permissions_option_off'] = 'X';
 $txt['permissions_option_deny'] = 'D';
-$txt['permissions_option_desc'] = 'For each permission you can pick either \'Allow\' (A), \'Disallow\' (X), or <span style="color: red;">\'Deny\' (D)</span>.<br /><br />Remember that if you deny a permission, any member - whether moderator or otherwise - that is in that group will be denied that as well.<br />For this reason, you should use deny carefully, only when <strong>necessary</strong>. Disallow, on the other hand, denies unless otherwise granted.';
-$txt['permissions_change_view'] = 'Change View';
-$txt['permissions_view_simple'] = 'Simple';
-$txt['permissions_view_classic'] = 'Classic';
+$txt['permissions_option_desc'] = 'For each permission you can pick either \'Allow\' (A), \'Disallow\' (X), or <span class="red">\'Deny\' (D)</span>.<br><br>Remember that if you deny a permission, any member - whether moderator or otherwise - that is in that group will be denied that as well.<br>For this reason, you should use deny carefully, only when <strong>necessary</strong>. Disallow, on the other hand, denies unless otherwise granted.';
 
 $txt['permissiongroup_general'] = 'General';
 $txt['permissionname_view_stats'] = 'View forum statistics';
@@ -84,8 +100,6 @@
 $txt['permissionhelp_who_view'] = 'Who\'s online shows all members that are currently online and what they are doing at that moment. This permission will only work if you also have enabled it in \'Features and Options\'. You can access the \'Who\'s Online\' screen by clicking the link in the \'Users Online\' section of the board index. Even if this is denied, members will still be able to see who\'s online, just not where they are.';
 $txt['permissionname_search_posts'] = 'Search for posts and topics';
 $txt['permissionhelp_search_posts'] = 'The Search permission allows the user to search all boards he or she is allowed to access. When the search permission is enabled, a \'Search\' button will be added to the forum button bar.';
-$txt['permissionname_karma_edit'] = 'Change other people\'s karma';
-$txt['permissionhelp_karma_edit'] = 'Karma is a feature that shows the popularity of a member. In order to use this feature, you need to have it enabled in \'Features and Options\'. This permission will allow a membergroup to cast a vote. This permission has no effect on guests.';
 
 $txt['permissiongroup_pm'] = 'Personal Messaging';
 $txt['permissionname_pm_read'] = 'Read personal messages';
@@ -132,14 +146,8 @@
 $txt['permissionhelp_issue_warning'] = 'Issue a warning to members of the forum and change that members\' warning level. Requires the warning system to be enabled.';
 
 $txt['permissiongroup_profile'] = 'Member Profiles';
-$txt['permissionname_profile_view'] = 'View profile summary and stats';
-$txt['permissionhelp_profile_view'] = 'This permission allows users clicking on a username to see a summary of profile settings, some statistics and all posts of the user.';
-$txt['permissionname_profile_view_own'] = 'Own profile';
-$txt['permissionname_profile_view_any'] = 'Any profile';
-$txt['permissionname_profile_identity'] = 'Edit account settings';
-$txt['permissionhelp_profile_identity'] = 'Account settings are the basic settings of a profile, like password, email address, membergroup and preferred language.';
-$txt['permissionname_profile_identity_own'] = 'Own profile';
-$txt['permissionname_profile_identity_any'] = 'Any profile';
+$txt['permissionname_profile_view'] = 'View other members\' profile summary and stats pages';
+$txt['permissionhelp_profile_view'] = 'This permission allows users clicking on a username to see a summary of other users\' profile settings, some statistics and their posts.';
 $txt['permissionname_profile_extra'] = 'Edit additional profile settings';
 $txt['permissionhelp_profile_extra'] = 'Additional profile settings include settings for avatars, theme preferences, notifications and Personal Messages.';
 $txt['permissionname_profile_extra_own'] = 'Own profile';
@@ -148,10 +156,6 @@
 $txt['permissionhelp_profile_title'] = 'The custom title is shown on the topic display page, under the profile of each user that has a custom title.';
 $txt['permissionname_profile_title_own'] = 'Own profile';
 $txt['permissionname_profile_title_any'] = 'Any profile';
-$txt['permissionname_profile_remove'] = 'Delete account';
-$txt['permissionhelp_profile_remove'] = 'This permission allows a user to delete his account, when set to \'Own Account\'.';
-$txt['permissionname_profile_remove_own'] = 'Own account';
-$txt['permissionname_profile_remove_any'] = 'Any account';
 $txt['permissionname_profile_server_avatar'] = 'Select an avatar from the server';
 $txt['permissionhelp_profile_server_avatar'] = 'If enabled this will allow a user to select an avatar from the avatar collections installed on the server.';
 $txt['permissionname_profile_upload_avatar'] = 'Upload an avatar to the server';
@@ -159,6 +163,31 @@
 $txt['permissionname_profile_remote_avatar'] = 'Choose a remotely stored avatar';
 $txt['permissionhelp_profile_remote_avatar'] = 'Because avatars might influence the page creation time negatively, it is possible to disallow certain membergroups to use avatars from external servers.';
 
+$txt['permissiongroup_profile_account'] = 'Member Accounts';
+$txt['permissionname_profile_identity'] = 'Edit account settings';
+$txt['permissionhelp_profile_identity'] = 'Account settings are the basic settings of a profile, like password, email address, membergroup and preferred language.';
+$txt['permissionname_profile_identity_own'] = 'Own profile';
+$txt['permissionname_profile_identity_any'] = 'Any profile';
+$txt['permissionname_profile_displayed_name'] = 'Edit displayed name';
+$txt['permissionhelp_profile_displayed_name'] = 'Allow the member to edit the displayed name field in their profile';
+$txt['permissionname_profile_displayed_name_own'] = 'Own displayed name';
+$txt['permissionname_profile_displayed_name_any'] = 'Any displayed name';
+$txt['permissionname_profile_password'] = 'Change password';
+$txt['permissionhelp_profile_password'] = 'Allow the member to change the password or the secret question fields';
+$txt['permissionname_profile_password_own'] = 'Own profile';
+$txt['permissionname_profile_password_any'] = 'Any profile';
+$txt['permissionname_profile_remove'] = 'Delete account';
+$txt['permissionhelp_profile_remove'] = 'This permission allows a user to delete his account, when set to \'Own Account\'.';
+$txt['permissionname_profile_remove_own'] = 'Own account';
+$txt['permissionname_profile_remove_any'] = 'Any account';
+$txt['permissionname_view_warning'] = 'View warning status';
+$txt['permissionname_view_warning_own'] = 'Own account';
+$txt['permissionname_view_warning_any'] = 'Any account';
+$txt['permissionhelp_view_warning'] = 'Allows users to view their own warning status and history (\'Own account\') or that of any user (\'Any account\')';
+
+$txt['permissionname_report_user'] = 'Report users\' profiles';
+$txt['permissionhelp_report_user'] = 'This permission will allow members to report other users\' profiles to the admins to alert them of spam or other inappropriate content in the profile.';
+
 $txt['permissiongroup_general_board'] = 'General';
 $txt['permissionname_moderate_board'] = 'Moderate board';
 $txt['permissionhelp_moderate_board'] = 'The moderate board permission adds a few small permissions that make a moderator a real moderator. Permissions include replying to locked topics, changing the poll expire time and viewing poll results.';
@@ -170,8 +199,6 @@
 $txt['permissionhelp_merge_any'] = 'Merge two or more topic into one. The order of messages within the merged topic will be based on the time the messages were created. A user can only merge topics on those boards a user is allowed to merge. In order to merge multiple topics at once, a user has to enable quickmoderation in their profile settings.';
 $txt['permissionname_split_any'] = 'Split any topic';
 $txt['permissionhelp_split_any'] = 'Split a topic into two separate topics.';
-$txt['permissionname_send_topic'] = 'Send topics to friends';
-$txt['permissionhelp_send_topic'] = 'This permission allows a user to mail a topic to a friend, by entering their email address and allows adding a message.';
 $txt['permissionname_make_sticky'] = 'Make topics sticky';
 $txt['permissionhelp_make_sticky'] = 'Sticky topics are topics that always remain on top of a board. They can be useful for announcements or other important messages.';
 $txt['permissionname_move'] = 'Move topic';
@@ -209,11 +236,21 @@
 $txt['permissionname_report_any'] = 'Report posts to the moderators';
 $txt['permissionhelp_report_any'] = 'This permission adds a link to each message, allowing a user to report a post to a moderator. On reporting, all moderators on that board will receive an email with a link to the reported post and a description of the problem (as given by the reporting user).';
 
+$txt['permissiongroup_likes'] = 'Likes';
+$txt['permissionname_likes_view'] = 'View likes';
+$txt['permissionhelp_likes_view'] = 'This permission allows an user to view any likes. Without this permission, the user will only see the likes she/he has made.';
+$txt['permissionname_likes_like'] = 'Can like any content';
+$txt['permissionhelp_likes_like'] = 'This permission allows an user to like any content. Users aren\'t allowed to like their own content.';
+
+$txt['permissiongroup_mentions'] = 'Mentions';
+$txt['permissionname_mention'] = 'Mention others via @name';
+$txt['permissionhelp_mention'] = 'This permission allows a user to mention other users by @name. For example, user Jack could be mentioned using @Jack by a user when given this permission.';
+
 $txt['permissiongroup_poll'] = 'Polls';
 $txt['permissionname_poll_view'] = 'View polls';
 $txt['permissionhelp_poll_view'] = 'This permission allows a user to view a poll. Without this permission, the user will only see the topic.';
 $txt['permissionname_poll_vote'] = 'Vote in polls';
-$txt['permissionhelp_poll_vote'] = 'This permission allows a (registered) user to cast one vote. It doesn\'t apply to guests.';
+$txt['permissionhelp_poll_vote'] = 'This permission allows a user to cast one vote. <br><br><strong>Note on guest voting:</strong> SMF uses cookies to attempt to prevent guests from voting multiple times. However, it should be noted that nothing can be done to completely prevent guests from voting twice, and as such, results may not be reliable. Also note that guest voting must be enabled on a per-poll basis.';
 $txt['permissionname_poll_post'] = 'Post polls';
 $txt['permissionhelp_poll_post'] = 'This permission allows a user to post a new poll. The user needs to have the \'Post new topics\' permission.';
 $txt['permissionname_poll_add'] = 'Add poll to topics';
@@ -233,6 +270,11 @@
 $txt['permissionname_poll_remove_own'] = 'Own poll';
 $txt['permissionname_poll_remove_any'] = 'Any poll';
 
+$txt['permissionname_post_draft'] = 'Save drafts of new posts';
+$txt['permissionhelp_post_draft'] = 'This permission allows users to save drafts of their posts so they can complete them later.';
+$txt['permissionname_pm_draft'] = 'Save drafts of personal messages';
+$txt['permissionhelp_pm_draft'] = 'This permission allows users to save drafts of their personal messages so they can complete them later.';
+
 $txt['permissiongroup_approval'] = 'Post Moderation';
 $txt['permissionname_approve_posts'] = 'Approve items awaiting moderation';
 $txt['permissionhelp_approve_posts'] = 'This permission allows a user to approve all unapproved items on a board.';
@@ -245,72 +287,12 @@
 $txt['permissionname_post_unapproved_attachments'] = 'Post attachments, but hide until approved';
 $txt['permissionhelp_post_unapproved_attachments'] = 'This permission allows a user to attach files to their posts. The attached files will then require approval before being shown to other users.';
 
-$txt['permissiongroup_notification'] = 'Notifications';
-$txt['permissionname_mark_any_notify'] = 'Request notification on replies';
-$txt['permissionhelp_mark_any_notify'] = 'This feature allows users to receive a notification whenever someone replies to a topic they subscribed to.';
-$txt['permissionname_mark_notify'] = 'Request notification on new topics';
-$txt['permissionhelp_mark_notify'] = 'Notification on new topics is a feature that allows a user to receive an email every time a new topic is created on the board they subscribe to.';
-
 $txt['permissiongroup_attachment'] = 'Attachments';
 $txt['permissionname_view_attachments'] = 'View attachments';
 $txt['permissionhelp_view_attachments'] = 'Attachments are files that are attached to posted messages. This feature can be enabled and configured in \'Attachments and avatars\'. Since attachments are not directly accessed, you can protect them from being downloaded by users that don\'t have this permission.';
 $txt['permissionname_post_attachment'] = 'Post attachments';
 $txt['permissionhelp_post_attachment'] = 'Attachments are files that are attached to posted messages. One message can contain multiple attachments.';
 
-$txt['permissiongroup_simple_view_basic_info'] = 'Use basic forum functionality';
-$txt['permissiongroup_simple_use_pm_system'] = 'Contact members using the personal messaging system';
-$txt['permissiongroup_simple_post_calendar'] = 'Post events onto the calendar';
-$txt['permissiongroup_simple_edit_profile'] = 'Personalize their profile';
-$txt['permissiongroup_simple_delete_account'] = 'Delete their account';
-$txt['permissiongroup_simple_use_avatar'] = 'Select or upload an avatar';
-$txt['permissiongroup_simple_moderate_general'] = 'Moderate the entire forum';
-$txt['permissiongroup_simple_administrate'] = 'Carry out administrative duties';
-
-$txt['permissionname_simple_calendar_edit_own'] = 'Edit their own calendar events';
-$txt['permissionname_simple_calendar_edit_any'] = 'Edit other people\'s calendar events';
-$txt['permissionname_simple_profile_view_own'] = 'View their own profile';
-$txt['permissionname_simple_profile_view_any'] = 'View other people\'s profiles';
-$txt['permissionname_simple_profile_identity_own'] = 'Edit their account settings';
-$txt['permissionname_simple_profile_identity_any'] = 'Edit other people\'s account settings';
-$txt['permissionname_simple_profile_extra_own'] = 'Edit their additional profile options';
-$txt['permissionname_simple_profile_extra_any'] = 'Edit other people\'s profile options';
-$txt['permissionname_simple_profile_title_own'] = 'Choose a custom title for themselves';
-$txt['permissionname_simple_profile_title_any'] = 'Edit other people\'s custom titles';
-$txt['permissionname_simple_profile_remove_own'] = 'Delete their own account';
-$txt['permissionname_simple_profile_remove_any'] = 'Delete other user\'s accounts';
-
-$txt['permissiongroup_simple_make_unapproved_posts'] = 'Post topics and replies to the board <span style="text-decoration: underline">only</span> after they have been approved';
-$txt['permissiongroup_simple_make_posts'] = 'Post topics and replies to the board';
-$txt['permissiongroup_simple_post_polls'] = 'Make new polls';
-$txt['permissiongroup_simple_participate'] = 'View additional board content';
-$txt['permissiongroup_simple_modify'] = 'Modify their posts';
-$txt['permissiongroup_simple_notification'] = 'Request notifications';
-$txt['permissiongroup_simple_attach'] = 'Post attachments';
-$txt['permissiongroup_simple_moderate'] = 'Moderate the board';
-
-$txt['permissionname_simple_post_unapproved_replies_own'] = 'Post replies to their own topic - but require approval';
-$txt['permissionname_simple_post_unapproved_replies_any'] = 'Post replies to any topic - but require approval';
-$txt['permissionname_simple_post_reply_own'] = 'Post replies to a topic they started';
-$txt['permissionname_simple_post_reply_any'] = 'Post replies to any topic';
-$txt['permissionname_simple_move_own'] = 'Move their own topics';
-$txt['permissionname_simple_move_any'] = 'Move anyone\'s topic';
-$txt['permissionname_simple_lock_own'] = 'Lock their own topic';
-$txt['permissionname_simple_lock_any'] = 'Lock anyone\'s topic';
-$txt['permissionname_simple_remove_own'] = 'Remove their own topic';
-$txt['permissionname_simple_remove_any'] = 'Remove anyone\'s topic';
-$txt['permissionname_simple_delete_own'] = 'Delete a post that they made';
-$txt['permissionname_simple_delete_any'] = 'Delete a post made by anyone';
-$txt['permissionname_simple_modify_own'] = 'Modify their own post';
-$txt['permissionname_simple_modify_any'] = 'Modify someone else\'s post';
-$txt['permissionname_simple_poll_add_own'] = 'Add a poll to a topic they created';
-$txt['permissionname_simple_poll_add_any'] = 'Add a poll to any topic';
-$txt['permissionname_simple_poll_edit_own'] = 'Edit a poll they created';
-$txt['permissionname_simple_poll_edit_any'] = 'Edit anyone\'s poll';
-$txt['permissionname_simple_poll_lock_own'] = 'Lock their own poll';
-$txt['permissionname_simple_poll_lock_any'] = 'Lock anyone\'s poll';
-$txt['permissionname_simple_poll_remove_own'] = 'Remove a poll they created';
-$txt['permissionname_simple_poll_remove_any'] = 'Remove anyone\'s poll';
-
 $txt['permissionicon'] = '';
 
 $txt['permission_settings_title'] = 'Permission Settings';
@@ -325,7 +307,8 @@
 // Escape any single quotes in here twice.. 'it\'s' -> 'it\\\'s'.
 $txt['permission_disable_postgroups_warning'] = 'Disabling this setting will remove permissions currently set to post count based groups.';
 
-$txt['permissions_post_moderation_desc'] = 'From this page you can easily change which groups have their posts moderated for a particular permissions profile.';
+$txt['permissions_post_moderation_desc'] = 'From this page, you can configure the ability to hold users\' posts before being visible to regular forum members, including which group or groups of users can approve them. Users whose posts are held for approval will still be able to see their posts, as well as replies from approvers, e.g. moderator feedback about making a post appropriate.';
+$txt['permissions_post_moderation_enable'] = 'Enable Post Moderation';
 $txt['permissions_post_moderation_deny_note'] = 'Note that while you have advanced permissions enabled you cannot apply the &quot;deny&quot; permission from this page. Please edit the permissions directly if you wish to apply a deny permission.';
 $txt['permissions_post_moderation_select'] = 'Select Profile';
 $txt['permissions_post_moderation_new_topics'] = 'New Topics';
diff -ru a/Themes/default/languages/ManageScheduledTasks.english.php b/Themes/default/languages/ManageScheduledTasks.english.php
--- a/Themes/default/languages/ManageScheduledTasks.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ManageScheduledTasks.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; ManageScheduledTasks
+// Version: 2.1 Beta 1; ManageScheduledTasks
 
 $txt['scheduled_tasks_title'] = 'Scheduled Tasks';
 $txt['scheduled_tasks_header'] = 'All Scheduled Tasks';
@@ -11,6 +11,7 @@
 $txt['scheduled_tasks_save_changes'] = 'Save Changes';
 $txt['scheduled_tasks_time_offset'] = '<strong>Note:</strong> All times given below are <em>server time</em> and do not take any time offsets setup within SMF into account.';
 $txt['scheduled_tasks_were_run'] = 'All selected tasks were completed';
+$txt['scheduled_tasks_were_run_errors'] = 'All selected tasks were completed but some had errors:';
 
 $txt['scheduled_tasks_na'] = 'N/A';
 $txt['scheduled_task_approval_notification'] = 'Approval Notifications';
@@ -31,6 +32,10 @@
 $txt['scheduled_task_desc_weekly_maintenance'] = 'Runs essential weekly maintenance on the forum - should not be disabled.';
 $txt['scheduled_task_paid_subscriptions'] = 'Paid Subscription Checks';
 $txt['scheduled_task_desc_paid_subscriptions'] = 'Sends out any necessary paid subscription reminders and removes expired member subscriptions.';
+$txt['scheduled_task_remove_topic_redirect'] = 'Remove MOVED: redirection topics';
+$txt['scheduled_task_desc_remove_topic_redirect'] = 'Deletes "MOVED:" topic notifications as specified when the moved notice was created.';
+$txt['scheduled_task_remove_temp_attachments'] = 'Remove temporary attachment files';
+$txt['scheduled_task_desc_remove_temp_attachments'] = 'Deletes temporary files created while attaching a file to a post that for any reason weren\'t renamed or deleted before.';
 
 $txt['scheduled_task_reg_starting'] = 'Starting at %1$s';
 $txt['scheduled_task_reg_repeating'] = 'repeating every %1$d %2$s';
@@ -41,7 +46,6 @@
 
 $txt['scheduled_task_edit'] = 'Edit Scheduled Task';
 $txt['scheduled_task_edit_repeat'] = 'Repeat task every';
-$txt['scheduled_task_edit_pick_unit'] = 'Pick Unit';
 $txt['scheduled_task_edit_interval'] = 'Interval';
 $txt['scheduled_task_edit_start_time'] = 'Start Time';
 $txt['scheduled_task_edit_start_time_desc'] = 'Time the first instance of the day should start (hours:minutes)';
@@ -52,6 +56,10 @@
 $txt['scheduled_log_time_run'] = 'Time Run';
 $txt['scheduled_log_time_taken'] = 'Time taken';
 $txt['scheduled_log_time_taken_seconds'] = '%1$d seconds';
-$txt['scheduled_log_empty_log'] = 'Empty Log';
+$txt['scheduled_log_empty_log'] = 'Clear Log';
+$txt['scheduled_log_empty_log_confirm'] = 'Are you sure you want to completely clear the log?';
+
+$txt['scheduled_task_remove_old_drafts'] = 'Remove old drafts';
+$txt['scheduled_task_desc_remove_old_drafts'] = 'Deletes drafts older than the number of days defined in the draft settings in the admin panel.';
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/ManageSettings.english.php b/Themes/default/languages/ManageSettings.english.php
--- a/Themes/default/languages/ManageSettings.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ManageSettings.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,10 +1,9 @@
 <?php
-// Version: 2.0; ManageSettings
+// Version: 2.1 Beta 1; ManageSettings
 
 global $scripturl;
 
-$txt['modSettings_desc'] = 'This page allows you to change the settings of features and basic options in your forum.  Please see the <a href="' . $scripturl . '?action=admin;area=theme;sa=settings;th=%1$s;%3$s=%2$s">theme settings</a> for more options.  Click the help icons for more information about a setting.';
-$txt['security_settings_desc'] = 'This page allows you to set options specifically related to the security and moderation of your forum, including anti-spam options.';
+$txt['modSettings_desc'] = 'This page allows you to change the settings of features and basic options in your forum. Please see the <a href="' . $scripturl . '?action=admin;area=theme;sa=list;th=%1$s;%3$s=%2$s">theme settings</a> for more options. Click the help icons for more information about a setting.';
 $txt['modification_settings_desc'] = 'This page contains settings added by any modifications to your forum';
 
 $txt['modification_no_misc_settings'] = 'There are no modifications installed that have added any settings to this area yet.';
@@ -15,17 +14,17 @@
 $txt['polls_as_topics'] = 'Show existing polls as topics';
 $txt['allow_guestAccess'] = 'Allow guests to browse the forum';
 $txt['userLanguage'] = 'Enable user-selectable language support';
-$txt['allow_editDisplayName'] = 'Allow users to edit their displayed name';
 $txt['allow_hideOnline'] = 'Allow non-administrators to hide their online status';
-$txt['guest_hideContacts'] = 'Do not reveal contact details of members to guests';
 $txt['titlesEnable'] = 'Enable custom titles';
 $txt['enable_buddylist'] = 'Enable buddy/ignore lists';
-$txt['default_personal_text'] = 'Default personal text<div class="smalltext">Personal text to assign to newly registered members.</div>';
-$txt['number_format'] = 'Default number format';
+$txt['default_personal_text'] = 'Default personal text';
+$txt['default_personal_text_note'] = 'Personal text to assign to newly registered members.';
 $txt['time_format'] = 'Default time format';
-$txt['setting_time_offset'] = 'Overall time offset<div class="smalltext">(added to the member specific option.)</div>';
+$txt['setting_time_offset'] = 'Overall time offset';
+$txt['setting_time_offset_note'] = '(added to the member specific option)';
 $txt['setting_default_timezone'] = 'Server timezone';
 $txt['failed_login_threshold'] = 'Failed login threshold';
+$txt['loginHistoryDays'] = 'Days to keep login history';
 $txt['lastActive'] = 'User online time threshold';
 $txt['trackStats'] = 'Track daily statistics';
 $txt['hitStats'] = 'Track daily page views (must have stats enabled)';
@@ -34,33 +33,46 @@
 $txt['databaseSession_enable'] = 'Use database driven sessions';
 $txt['databaseSession_loose'] = 'Allow browsers to go back to cached pages';
 $txt['databaseSession_lifetime'] = 'Seconds before an unused session timeout';
+$txt['error_log_desc'] = 'The error log, if enabled, will log every error encountered by users using your forum. This can be an invaluable aid to identifying forum problems.';
 $txt['enableErrorLogging'] = 'Enable error logging';
 $txt['enableErrorQueryLogging'] = 'Include database query in the error log';
 $txt['pruningOptions'] = 'Enable pruning of log entries';
-$txt['pruneErrorLog'] = 'Remove error log entries older than<div class="smalltext">(0 to disable)</div>';
-$txt['pruneModLog'] = 'Remove moderation log entries older than<div class="smalltext">(0 to disable)</div>';
-$txt['pruneBanLog'] = 'Remove ban hit log entries older than<div class="smalltext">(0 to disable)</div>';
-$txt['pruneReportLog'] = 'Remove report to moderator log entries older than<div class="smalltext">(0 to disable)</div>';
-$txt['pruneScheduledTaskLog'] = 'Remove scheduled task log entries older than<div class="smalltext">(0 to disable)</div>';
-$txt['pruneSpiderHitLog'] = 'Remove search engine hit logs older than<div class="smalltext">(0 to disable)</div>';
-$txt['cookieTime'] = 'Default login cookies length (in minutes)';
-$txt['localCookies'] = 'Enable local storage of cookies<div class="smalltext">(SSI won\'t work well with this on.)</div>';
-$txt['globalCookies'] = 'Use subdomain independent cookies<div class="smalltext">(turn off local cookies first!)</div>';
-$txt['secureCookies'] = 'Force cookies to be secure<div class="smalltext">(This only applies if you are using HTTPS - don\'t use otherwise!)</div>';
+$txt['pruneErrorLog'] = 'Remove error log entries older than';
+$txt['pruneModLog'] = 'Remove moderation log entries older than';
+$txt['pruneBanLog'] = 'Remove ban hit log entries older than';
+$txt['pruneReportLog'] = 'Remove report to moderator log entries older than';
+$txt['pruneScheduledTaskLog'] = 'Remove scheduled task log entries older than';
+$txt['pruneSpiderHitLog'] = 'Remove search engine hit logs older than';
+$txt['cookieTime'] = 'Default login cookies length';
+$txt['localCookies'] = 'Enable local storage of cookies';
+$txt['globalCookies'] = 'Use subdomain independent cookies';
+$txt['globalCookiesDomain'] = 'Main domain used for subdomain independent cookies';
+$txt['invalid_cookie_domain'] = 'The domain introduced seems to be invalid, please check it and save again.';
+$txt['secureCookies'] = 'Force cookies to be secure';
+$txt['httponlyCookies'] = 'Force cookies to be made accessible only through the HTTP protocol';
 $txt['securityDisable'] = 'Disable administration security';
+$txt['securityDisable_moderate'] = 'Disable moderation security';
 $txt['send_validation_onChange'] = 'Require reactivation after email change';
 $txt['approveAccountDeletion'] = 'Require admin approval when member deletes account';
-$txt['autoOptMaxOnline'] = 'Maximum users online when optimizing<div class="smalltext">(0 for no max.)</div>';
 $txt['autoFixDatabase'] = 'Automatically fix broken tables';
 $txt['allow_disableAnnounce'] = 'Allow users to disable announcements';
 $txt['disallow_sendBody'] = 'Don\'t allow post text in notifications';
-$txt['queryless_urls'] = 'Search engine friendly URLs<div class="smalltext"><strong>Apache/Lighttpd only!</strong></div>';
-$txt['max_image_width'] = 'Max width of posted pictures (0 = disable)';
-$txt['max_image_height'] = 'Max height of posted pictures (0 = disable)';
+$txt['enable_ajax_alerts'] = 'Allow AJAX Desktop Notifications for Alerts';
+$txt['jquery_source'] = 'Source for the jQuery Library';
+$txt['jquery_custom_label'] = 'Custom';
+$txt['jquery_custom'] = 'Custom url to the jQuery Library';
+$txt['jquery_local'] = 'Local';
+$txt['jquery_cdn'] = 'Google CDN';
+$txt['jquery_auto'] = 'Auto';
+$txt['queryless_urls'] = 'Search engine friendly URLs';
+$txt['queryless_urls_note'] = 'Apache/Lighttpd only';
 $txt['enableReportPM'] = 'Enable reporting of personal messages';
-$txt['max_pm_recipients'] = 'Maximum number of recipients allowed in a personal message<div class="smalltext">(0 for no limit, admins are exempt)</div>';
-$txt['pm_posts_verification'] = 'Post count under which users must pass verification when sending personal messages<div class="smalltext">(0 for no limit, admins are exempt)</div>';
-$txt['pm_posts_per_hour'] = 'Number of personal messages a user may send in an hour<div class="smalltext">(0 for no limit, moderators are exempt)</div>';
+$txt['max_pm_recipients'] = 'Maximum number of recipients allowed in a personal message';
+$txt['max_pm_recipients_note'] = '(0 for no limit, admins are exempt)';
+$txt['pm_posts_verification'] = 'Post count under which users must pass verification when sending personal messages';
+$txt['pm_posts_verification_note'] = '(0 for no limit, admins are exempt)';
+$txt['pm_posts_per_hour'] = 'Number of personal messages a user may send in an hour';
+$txt['pm_posts_per_hour_note'] = '(0 for no limit, moderators are exempt)';
 $txt['compactTopicPagesEnable'] = 'Limit number of displayed page links';
 $txt['contiguous_page_display'] = 'Contiguous pages to display';
 $txt['to_display'] = 'to display';
@@ -68,61 +80,52 @@
 $txt['today_disabled'] = 'Disabled';
 $txt['today_only'] = 'Only Today';
 $txt['yesterday_today'] = 'Today &amp; Yesterday';
-$txt['topbottomEnable'] = 'Enable Go Up/Go Down buttons';
 $txt['onlineEnable'] = 'Show online/offline in posts and PMs';
-$txt['enableVBStyleLogin'] = 'Show a quick login on every page';
 $txt['defaultMaxMembers'] = 'Members per page in member list';
 $txt['timeLoadPageEnable'] = 'Display time taken to create every page';
 $txt['disableHostnameLookup'] = 'Disable hostname lookups';
 $txt['who_enabled'] = 'Enable who\'s online list';
-$txt['make_email_viewable'] = 'Allow viewable email addresses';
-$txt['meta_keywords'] = 'Meta keywords associated with forum<div class="smalltext">For search engines. Leave blank for default.</div>';
+$txt['meta_keywords'] = 'Meta keywords associated with forum';
+$txt['meta_keywords_note'] = 'For search engines. Leave blank for default.';
+$txt['settings_error'] = 'Warning: Updating of Settings.php failed, the settings cannot be saved.';
+$txt['image_proxy_enabled'] = 'Enable Image Proxy';
+$txt['image_proxy_secret'] = 'Image Proxy Secret';
+$txt['image_proxy_maxsize'] = 'Maximum file size of images to cache (in KB)';
+$txt['force_ssl'] = 'Forum SSL mode';
+$txt['force_ssl_off'] = 'Disable SSL';
+$txt['force_ssl_auth'] = 'Enable SSL for Authentication (Login and Register)';
+$txt['force_ssl_complete'] = 'Force SSL throughout the forum';
+
+// Like settings.
+$txt['enable_likes'] = 'Enable likes';
+
+// Mention settings.
+$txt['enable_mentions'] = 'Enable mentions';
+
+$txt['caching_information'] = 'SMF supports caching through the use of accelerators. The currently supported accelerators include:
+<ul class="normallist">
+	<li>APC</li>
+	<li>Memcached</li>
+	<li>Zend Platform/Performance Suite (Not Zend Optimizer)</li>
+	<li>XCache</li>
+</ul>
+Caching will work best if you have PHP compiled with one of the above optimizers, or have memcached available. If you do not have any optimizer installed SMF will do file based caching.';
+$txt['detected_no_caching'] = '<strong class="alert">SMF has not been able to detect a compatible accelerator on your server. File based caching can be used instead.</strong>';
+$txt['detected_accelerators'] = '<strong class="success">SMF has detected the following accelerators: %1$s</strong>';
 
-$txt['karmaMode'] = 'Karma mode';
-$txt['karma_options'] = 'Disable karma|Enable karma total|Enable karma positive/negative';
-$txt['karmaMinPosts'] = 'Set the minimum posts needed to modify karma';
-$txt['karmaWaitTime'] = 'Set wait time in hours';
-$txt['karmaTimeRestrictAdmins'] = 'Restrict administrators to wait time';
-$txt['karmaLabel'] = 'Karma label';
-$txt['karmaApplaudLabel'] = 'Karma applaud label';
-$txt['karmaSmiteLabel'] = 'Karma smite label';
-
-$txt['caching_information'] = '<div class="aligncenter underline"><strong>Important! Read this first before enabling these features.</strong></div><br />
-	SMF supports caching through the use of accelerators. The currently supported accelerators include:<br />
-	<ul class="normallist">
-		<li>APC</li>
-		<li>eAccelerator</li>
-		<li>Turck MMCache</li>
-		<li>Memcached</li>
-		<li>Zend Platform/Performance Suite (Not Zend Optimizer)</li>
-		<li>XCache</li>
-	</ul>
-	Caching will work best if you have PHP compiled with one of the above optimizers, or have memcache
-	available. If you do not have any optimizer installed SMF will do file based caching.<br /><br />
-	SMF performs caching at a variety of levels. The higher the level of caching enabled the more CPU time will be spent
-	retrieving cached information. If caching is available on your machine it is recommended that you try caching at level 1 first.
-	<br /><br />
-	Note that if you use memcached you need to provide the server details in the setting below. This should be entered as a comma separated list
-	as shown in the example below:<br />
-	&quot;server1,server2,server3:port,server4&quot;<br /><br />
-	Note that if no port is specified SMF will use port 11211. SMF will attempt to perform rough/random load balancing across the servers.
-	<br /><br />
-	%1$s';
-
-$txt['detected_no_caching'] = '<strong class="alert">SMF has not been able to detect a compatible accelerator on your server.</strong>';
-$txt['detected_APC'] = '<strong style="color: green">SMF has detected that your server has APC installed.</strong>';
-$txt['detected_eAccelerator'] = '<strong style="color: green">SMF has detected that your server has eAccelerator installed.</strong>';
-$txt['detected_MMCache'] = '<strong style="color: green">SMF has detected that your server has MMCache installed.</strong>';
-$txt['detected_Zend'] = '<strong style="color: green">SMF has detected that your server has Zend installed.</strong>';
-$txt['detected_Memcached'] = '<strong style="color: green">SMF has detected that your server has Memcached installed.</strong>';
-$txt['detected_XCache'] = '<strong style="color: green">SMF has detected that your server has XCache installed.</strong>';
 
 $txt['cache_enable'] = 'Caching Level';
 $txt['cache_off'] = 'No caching';
 $txt['cache_level1'] = 'Level 1 Caching (Recommended)';
 $txt['cache_level2'] = 'Level 2 Caching';
 $txt['cache_level3'] = 'Level 3 Caching (Not Recommended)';
-$txt['cache_memcached'] = 'Memcache settings';
+$txt['cache_memcached'] = 'Memcached settings';
+$txt['cache_accelerator'] = 'Caching Accelerator';
+$txt['default_cache'] = 'SMF file based caching';
+$txt['apc_cache'] = 'APC';
+$txt['memcached_cache'] = 'Memcached';
+$txt['zend_cache'] = 'Zend Platform/Performance Suite';
+$txt['xcache_cache'] = 'XCache';
 
 $txt['loadavg_warning'] = '<span class="error">Please note: the settings below are to be edited with care. Setting any of them too low may render your forum <strong>unusable</strong>! The current load average is <strong>%01.2f</strong></span>';
 $txt['loadavg_enable'] = 'Enable load balancing by load averages';
@@ -131,6 +134,8 @@
 $txt['loadavg_allunread'] = 'Threshold to disabling all unread topics';
 $txt['loadavg_unreadreplies'] = 'Threshold to disabling unread replies';
 $txt['loadavg_show_posts'] = 'Threshold to disabling showing user posts';
+$txt['loadavg_userstats'] = 'Threshold to disabling showing user statistics';
+$txt['loadavg_bbc'] = 'Threshold to disabling BBC formatting when showing posts';
 $txt['loadavg_forum'] = 'Threshold to disabling the forum <strong>completely</strong>';
 $txt['loadavg_disabled_windows'] = '<span class="error">Load balancing support is not available on Windows.</span>';
 $txt['loadavg_disabled_conf'] = '<span class="error">Load balancing support is disabled by your host configuration.</span>';
@@ -139,6 +144,7 @@
 $txt['setting_password_strength_low'] = 'Low - 4 character minimum';
 $txt['setting_password_strength_medium'] = 'Medium - cannot contain username';
 $txt['setting_password_strength_high'] = 'High - mixture of different characters';
+$txt['setting_enable_password_conversion'] = 'Allow password hash conversion';
 
 $txt['antispam_Settings'] = 'Anti-Spam Verification';
 $txt['antispam_Settings_desc'] = 'This section allows you to setup verification checks to ensure the user is a human (and not a bot), and tweak how and where these apply.';
@@ -148,7 +154,7 @@
 $txt['search_enable_captcha'] = 'Require verification on all guest searches';
 $txt['setting_guests_require_captcha'] = 'Guests must pass verification when making a post';
 $txt['setting_guests_require_captcha_desc'] = '(Automatically set if you specify a minimum post count below)';
-$txt['guests_report_require_captcha'] = 'Guests must pass verification when reporting a post';
+$txt['question_not_defined'] = 'You need to add a question and answer for your forum\'s default language (%1$s) otherwise users will not be able to fill in a CAPTCHA, meaning no registration.';
 
 $txt['configure_verification_means'] = 'Configure Verification Methods';
 $txt['setting_qa_verification_number'] = 'Number of verification questions user must answer';
@@ -165,35 +171,44 @@
 $txt['setting_image_verification_sample'] = 'Sample';
 $txt['setting_image_verification_nogd'] = '<strong>Note:</strong> as this server does not have the GD library installed the different complexity settings will have no effect.';
 $txt['setup_verification_questions'] = 'Verification Questions';
-$txt['setup_verification_questions_desc'] = '<span class="smalltext">If you want users to answer verification questions in order to stop spam bots you should setup a number of questions in the table below. You should pick relatively simple questions; answers are not case sensitive. You may use BBC in the questions for formatting, to remove a question simply delete the contents of that line.</span>';
+$txt['setup_verification_questions_desc'] = '<span class="smalltext">If you want users to answer verification questions in order to stop spam bots, you should setup a number of questions in the table below. You should choose questions which relate to the subject of your forum. Genuine users will be able to answer these questions, while spam bots will not. Answers are not case sensitive. You may use BBC in the questions for formatting. To remove a question simply delete the contents of that line.</span>';
 $txt['setup_verification_question'] = 'Question';
 $txt['setup_verification_answer'] = 'Answer';
 $txt['setup_verification_add_more'] = 'Add another question';
+$txt['setup_verification_add_answer'] = 'Add another answer';
 
 $txt['moderation_settings'] = 'Moderation Settings';
 $txt['setting_warning_enable'] = 'Enable User Warning System';
-$txt['setting_warning_watch'] = 'Warning level for user watch<div class="smalltext">The user warning level after which a user watch is put in place - 0 to disable.</div>';
-$txt['setting_warning_moderate'] = 'Warning level for post moderation<div class="smalltext">The user warning level after which a user has all posts moderated - 0 to disable.</div>';
-$txt['setting_warning_mute'] = 'Warning level for user muting<div class="smalltext">The user warning level after which a user cannot post any further - 0 to disable.</div>';
-$txt['setting_user_limit'] = 'Maximum user warning points per day<div class="smalltext">This value is the maximum amount of warning points a single moderator can assign to a user in a 24 hour period - 0 for no limit.</div>';
-$txt['setting_warning_decrement'] = 'Warning points to decrement from users every 24 hours<div class="smalltext">Only applies to users not warned within last 24 hours - set to 0 to disable.</div>';
-$txt['setting_warning_show'] = 'Users who can see warning status<div class="smalltext">Determines who can see the warning level of users on the forum.</div>';
+$txt['setting_warning_watch'] = 'Warning level for user watch';
+$txt['setting_warning_watch_note'] = 'The user warning level after which a user watch is put in place.';
+$txt['setting_warning_moderate'] = 'Warning level for post moderation';
+$txt['setting_warning_moderate_note'] = 'The user warning level after which a user has all posts moderated.';
+$txt['setting_warning_mute'] = 'Warning level for user muting';
+$txt['setting_warning_mute_note'] = 'The user warning level after which a user cannot post any further.';
+$txt['setting_user_limit'] = 'Maximum user warning points per day';
+$txt['setting_user_limit_note'] = 'This value is the maximum amount of warning points a single moderator can assign to a user in a 24 hour period - 0 for no limit.';
+$txt['setting_warning_decrement'] = 'Warning points that are decreased every 24 hours';
+$txt['setting_warning_decrement_note'] = 'Only applies to users not warned within last 24 hours.';
+$txt['setting_warning_show'] = 'Users who can see warning status';
+$txt['setting_warning_show_note'] = 'Determines who can see the warning level of users on the forum.';
 $txt['setting_warning_show_mods'] = 'Moderators Only';
 $txt['setting_warning_show_user'] = 'Moderators and Warned Users';
 $txt['setting_warning_show_all'] = 'All Users';
 
 $txt['signature_settings'] = 'Signature Settings';
 $txt['signature_settings_desc'] = 'Use the settings on this page to decide how member signatures should be treated in SMF.';
-$txt['signature_settings_warning'] = 'Note that settings are not applied to existing signatures by default. Click <a href="' . $scripturl . '?action=admin;area=featuresettings;sa=sig;apply;%2$s=%1$s">here</a> to apply rules to all existing signatures.';
+$txt['signature_settings_warning'] = 'Note that settings are not applied to existing signatures by default. <a href="' . $scripturl . '?action=admin;area=featuresettings;sa=sig;apply;%2$s=%1$s">Run the process now</a>';
+$txt['signature_settings_applied'] = 'The updated rules have been applied to the existing signatures.';
 $txt['signature_enable'] = 'Enable signatures';
-$txt['signature_max_length'] = 'Maximum allowed characters<div class="smalltext">(0 for no max.)</div>';
-$txt['signature_max_lines'] = 'Maximum amount of lines<div class="smalltext">(0 for no max)</div>';
-$txt['signature_max_images'] = 'Maximum image count<div class="smalltext">(0 for no max - excludes smileys)</div>';
+$txt['signature_max_length'] = 'Maximum allowed characters';
+$txt['signature_max_lines'] = 'Maximum amount of lines';
+$txt['signature_max_images'] = 'Maximum image count';
+$txt['signature_max_images_note'] = '(0 for no max - excludes smileys)';
 $txt['signature_allow_smileys'] = 'Allow smileys in signatures';
-$txt['signature_max_smileys'] = 'Maximum smiley count<div class="smalltext">(0 for no max)</div>';
-$txt['signature_max_image_width'] = 'Maximum width of signature images (pixels)<div class="smalltext">(0 for no max)</div>';
-$txt['signature_max_image_height'] = 'Maximum height of signature images (pixels)<div class="smalltext">(0 for no max)</div>';
-$txt['signature_max_font_size'] = 'Maximum font size allowed in signatures<div class="smalltext">(0 for no max, in pixels)</div>';
+$txt['signature_max_smileys'] = 'Maximum smiley count';
+$txt['signature_max_image_width'] = 'Maximum width of signature images (pixels)';
+$txt['signature_max_image_height'] = 'Maximum height of signature images (pixels)';
+$txt['signature_max_font_size'] = 'Maximum font size allowed in signatures (pixels)';
 $txt['signature_bbc'] = 'Enabled BBC tags';
 
 $txt['custom_profile_title'] = 'Custom Profile Fields';
@@ -201,6 +216,7 @@
 $txt['custom_profile_active'] = 'Active';
 $txt['custom_profile_fieldname'] = 'Field Name';
 $txt['custom_profile_fieldtype'] = 'Field Type';
+$txt['custom_profile_fieldorder'] = 'Field Order';
 $txt['custom_profile_make_new'] = 'New Field';
 $txt['custom_profile_none'] = 'You have not created any custom profile fields yet!';
 $txt['custom_profile_icon'] = 'Icon';
@@ -226,6 +242,7 @@
 $txt['custom_edit_registration_allow'] = 'Yes';
 $txt['custom_edit_registration_require'] = 'Yes, and require entry';
 $txt['custom_edit_display'] = 'Show on Topic View';
+$txt['custom_edit_mlist'] = 'Show on memberlist';
 $txt['custom_edit_picktype'] = 'Field Type';
 
 $txt['custom_edit_max_length'] = 'Maximum Length';
@@ -257,45 +274,25 @@
 $txt['custom_edit_enclose'] = 'Show Enclosed Within Text (Optional)';
 $txt['custom_edit_enclose_desc'] = 'We <strong>strongly</strong> recommend to use an input mask to validate the input supplied by the user.';
 
+$txt['custom_edit_order_move'] = 'Move ';
+$txt['custom_edit_order_up'] = 'Up';
+$txt['custom_edit_order_down'] = 'Down';
 $txt['custom_edit_placement'] = 'Choose Placement';
-$txt['custom_edit_placement_standard'] = 'Standard (with title)';
-$txt['custom_edit_placement_withicons'] = 'With Icons';
-$txt['custom_edit_placement_abovesignature'] = 'Above Signature';
 $txt['custom_profile_placement'] = 'Placement';
-$txt['custom_profile_placement_standard'] = 'Standard';
-$txt['custom_profile_placement_withicons'] = 'With Icons';
-$txt['custom_profile_placement_abovesignature'] = 'Above Signature';
+$txt['custom_profile_placement_standard'] = 'Standard (with title)';
+$txt['custom_profile_placement_icons'] = 'With Icons';
+$txt['custom_profile_placement_above_signature'] = 'Above Signature';
+$txt['custom_profile_placement_below_signature'] = 'Below Signature';
+$txt['custom_profile_placement_below_avatar'] = 'Below Avatar';
+$txt['custom_profile_placement_above_member'] = 'Above Username';
+$txt['custom_profile_placement_bottom_poster'] = 'Bottom poster info';
 
 // Use numeric entities in the string below!
 $txt['custom_edit_delete_sure'] = 'Are you sure you wish to delete this field - all related user data will be lost!';
 
 $txt['standard_profile_title'] = 'Standard Profile Fields';
 $txt['standard_profile_field'] = 'Field';
-
-$txt['core_settings_welcome_msg'] = 'Welcome to Your New Forum';
-$txt['core_settings_welcome_msg_desc'] = 'To get you started we suggest you select which of SMF\'s core features you want to enable. We\'d recommend only enabling with those features you need!';
-$txt['core_settings_item_cd'] = 'Calendar';
-$txt['core_settings_item_cd_desc'] = 'Enabling this feature will open up a selection of options to enable your users to view the calendar, add and review events, see users birthdates on a calendar and much, much more.';
-$txt['core_settings_item_cp'] = 'Advanced Profile Fields';
-$txt['core_settings_item_cp_desc'] = 'This enables you to hide standard profile fields, add profile fields to registration, and create new profile fields for your forum.';
-$txt['core_settings_item_k'] = 'Karma';
-$txt['core_settings_item_k_desc'] = 'Karma is a feature that shows the popularity of a member. Members, if allowed, can \'applaud\' or \'smite\' other members, which is how their popularity is calculated.';
-$txt['core_settings_item_ml'] = 'Moderation, Administration and User Logs';
-$txt['core_settings_item_ml_desc'] = 'Enable the moderation and administration logs to keep an audit trail of all the key actions taken on your forum. Also allows forum moderators to view a history of key changes a user makes to their profile.';
-$txt['core_settings_item_pm'] = 'Post Moderation';
-$txt['core_settings_item_pm_desc'] = 'Post moderation enables you to select groups and boards within which posts must be approved before they become public. Upon enabling this feature be sure to visit the permission section to set up the relevant permissions.';
-$txt['core_settings_item_ps'] = 'Paid Subscriptions';
-$txt['core_settings_item_ps_desc'] = 'Paid subscriptions allow users to pay for subscriptions to change membergroup within the forum and thus change their access rights.';
-$txt['core_settings_item_rg'] = 'Report Generation';
-$txt['core_settings_item_rg_desc'] = 'This administration feature allows the generation of reports (Which can be printed) to present your current forum setup in an easy to view manner - particularly useful for large forums.';
-$txt['core_settings_item_sp'] = 'Search Engine Tracking';
-$txt['core_settings_item_sp_desc'] = 'Enabling this feature will allow administrators to track search engines as they index your forum.';
-$txt['core_settings_item_w'] = 'Warning System';
-$txt['core_settings_item_w_desc'] = 'This functionality allows administrators and moderators to issue warnings to users; it also includes advanced functionality for automatically removing user rights as their warning level increases. Note to take full advantage of this function &quot;Post Moderation&quot; should be enabled.';
-$txt['core_settings_switch_on'] = 'Click to Enable';
-$txt['core_settings_switch_off'] = 'Click to Disable';
-$txt['core_settings_enabled'] = 'Enabled';
-$txt['core_settings_disabled'] = 'Disabled';
+$txt['standard_profile_field_timezone'] = 'Timezone';
 
 $txt['languages_lang_name'] = 'Language Name';
 $txt['languages_locale'] = 'Locale';
@@ -312,7 +309,8 @@
 $txt['add_language_smf'] = 'Download from Simple Machines';
 $txt['add_language_smf_browse'] = 'Type name of language to search for or leave blank to search for all.';
 $txt['add_language_smf_install'] = 'Install';
-$txt['add_language_smf_found'] = 'The following languages were found. Click the install link next to the language you wish to install, you will then be taken to the package manager to install.';
+$txt['add_language_found_title'] = 'Found Languages';
+$txt['add_language_smf_found'] = 'The following languages were found. Click the install link next to the language you wish to install. You will then be taken to the package manager to install.';
 $txt['add_language_error_no_response'] = 'The Simple Machines site is not responding. Please try again later.';
 $txt['add_language_error_no_files'] = 'No files could be found.';
 $txt['add_language_smf_desc'] = 'Description';
@@ -345,7 +343,7 @@
 $txt['languages_download_dest'] = 'Destination';
 $txt['languages_download_writable'] = 'Writable';
 $txt['languages_download_version'] = 'Version';
-$txt['languages_download_older'] = 'You have a newer version of this file installed, overwriting is not recommended.';
+$txt['languages_download_older'] = 'You have a newer version of this file installed. Overwriting is not recommended.';
 $txt['languages_download_exists'] = 'Already Exists';
 $txt['languages_download_exists_same'] = 'Identical';
 $txt['languages_download_exists_different'] = 'Different';
@@ -356,4 +354,21 @@
 $txt['languages_download_complete_desc'] = 'Language pack installed successfully. Please click <a href="%1$s">here</a> to return to the languages page';
 $txt['languages_delete_confirm'] = 'Are you sure you want to delete this language?';
 
+$txt['setting_frame_security'] = 'Frame Security Options';
+$txt['setting_frame_security_SAMEORIGIN'] = 'Allow Same Origin';
+$txt['setting_frame_security_DENY'] = 'Deny all frames';
+$txt['setting_frame_security_DISABLE'] = 'Disabled';
+
+$txt['select_boards_from_list'] = 'Select boards which apply';
+
+$txt['topic_move_any'] = 'Allow moving of topics to read-only boards';
+
+$txt['defaultMaxListItems'] = 'Maximum number of items per page in lists';
+
+$txt['tfa_mode'] = 'Two-Factor Authentication';
+$txt['tfa_mode_forced'] = 'Force on all users';
+$txt['tfa_mode_forced_help'] = 'Please enable 2FA in your account in order to be able to force 2FA on all users';
+$txt['tfa_mode_enabled'] = 'Enabled';
+$txt['tfa_mode_disabled'] = 'Disabled';
+$txt['tfa_mode_subtext'] = 'Allows users to have a second layer of security while logging in, users would need an app like Google Authenticator paired with their account';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/ManageSmileys.english.php b/Themes/default/languages/ManageSmileys.english.php
--- a/Themes/default/languages/ManageSmileys.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ManageSmileys.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,16 +1,18 @@
 <?php
-// Version: 2.0; ManageSmileys
+// Version: 2.1 Beta 1; ManageSmileys
 
 $txt['smiley_sets_save'] = 'Save Changes';
 $txt['smiley_sets_add'] = 'New smiley Set';
 $txt['smiley_sets_delete'] = 'Delete selected';
 $txt['smiley_sets_confirm'] = 'Are you sure you want to remove these smiley sets?\\n\\nNote: This won\\\'t remove the images, just the choices.';
+$txt['smiley_sets_none'] = 'There are currently no smiley sets.';
 
 $txt['setting_smiley_sets_default'] = 'Default Smiley Set';
 $txt['setting_smiley_sets_enable'] = 'Enable smiley set selection by members';
 $txt['setting_smiley_enable'] = 'Enable customized smileys';
 $txt['setting_smileys_url'] = 'Base URL to all smiley sets';
 $txt['setting_smileys_dir'] = 'Absolute path to all smiley sets';
+$txt['setting_smileys_dir_wrong'] = 'The path to all smiley sets is wrong. This will prevent smileys from working';
 $txt['setting_messageIcons_enable'] = 'Enable customized message icons';
 $txt['setting_messageIcons_enable_note'] = '(otherwise, the default message icons will be used.)';
 $txt['groups_manage_smileys'] = 'Groups allowed to manage smileys and message icons';
@@ -19,12 +21,9 @@
 $txt['smiley_sets_url'] = 'URL';
 $txt['smiley_sets_default'] = 'Default';
 
-$txt['smiley_sets_latest'] = 'Smileys of The Moment';
-$txt['smiley_sets_latest_fetch'] = 'Loading smiley information from simplemachines.org...';
-
 $txt['smileys_add_method'] = 'Image Source';
-$txt['smileys_add_existing'] = 'Use Existing File';
-$txt['smileys_add_upload'] = 'Upload New Smiley';
+$txt['smileys_add_existing'] = 'Use existing file';
+$txt['smileys_add_upload'] = 'Upload new smiley';
 $txt['smileys_add_upload_choose'] = 'File to upload';
 $txt['smileys_add_upload_choose_desc'] = 'Image to be used by all smiley sets.';
 $txt['smileys_add_upload_all'] = 'Same image for all sets';
@@ -42,29 +41,27 @@
 $txt['smileys_delete_confirm'] = 'Are you sure you wish to delete this smiley?';
 $txt['smileys_with_selected'] = 'With Selected';
 $txt['smileys_make_hidden'] = 'Make Hidden';
-$txt['smileys_show_on_post'] = 'Show on Post Form';
-$txt['smileys_show_on_popup'] = 'Show on Popup';
+$txt['smileys_show_on_post'] = 'Show on post form';
+$txt['smileys_show_on_popup'] = 'Show on popup';
 
 $txt['smiley_settings_explain'] = 'These settings allow you to change the default smiley set, allow people to select their own smileys, and set paths and configuration data.';
-$txt['smiley_editsets_explain'] = 'Smiley Sets are groups of smileys your users can choose between.  For example, you might have yellow and red smileys.<br />Here you can change the name and location of each smiley set - remember, however, that all sets share the same smileys.';
-$txt['smiley_editsmileys_explain'] = 'Change your smileys here by clicking on the smiley you want to modify. Remember that these smileys all have to exist in all the sets or some smileys won\'t show up!  Don\'t forget to save after you are done editing!';
+$txt['smiley_editsets_explain'] = 'Smiley Sets are groups of smileys your users can choose between. For example, you might have yellow and red smileys.<br>Here you can change the name and location of each smiley set - remember, however, that all sets share the same smileys.';
+$txt['smiley_editsmileys_explain'] = 'Change your smileys here by clicking on the smiley you want to modify. Remember that these smileys all have to exist in all the sets or some smileys won\'t show up. Don\'t forget to save after you are done editing.';
 $txt['smiley_setorder_explain'] = 'Change the order of the smileys here.';
 $txt['smiley_addsmiley_explain'] = 'Here you can add a new smiley - either from an existing file or by uploading new ones.';
 
-$txt['smiley_set_select_default'] = 'Default Smiley Set';
-$txt['smiley_set_new'] = 'Create new smiley set';
-$txt['smiley_set_modify_existing'] = 'Modify existing smiley set';
+$txt['smiley_set_select_default'] = 'Default Smiley set';
+$txt['smiley_set_new'] = 'Create new Smiley set';
+$txt['smiley_set_modify_existing'] = 'Modify existing Smiley set';
 $txt['smiley_set_modify'] = 'Modify';
 $txt['smiley_set_import_directory'] = 'Import smileys already in this directory';
-$txt['smiley_set_import_single'] = 'There is one smiley in this smiley set not yet imported. Click';
-$txt['smiley_set_import_multiple'] = 'There are %1$d smileys in the directory that have not yet been imported. Click';
-$txt['smiley_set_to_import_single'] = 'to import it now.';
-$txt['smiley_set_to_import_multiple'] = 'to import them now.';
+$txt['smiley_set_import_single'] = 'There is one smiley in this smiley set not yet imported. Click <a href="%1$s">here</a> to import it now.';
+$txt['smiley_set_import_multiple'] = 'There are %1$d smileys in the directory that have not yet been imported. Click <a href="%2$s">here</a> to import them now.';
 
 $txt['smileys_location'] = 'Location';
 $txt['smileys_location_form'] = 'Post form';
 $txt['smileys_location_hidden'] = 'Hidden';
-$txt['smileys_location_popup'] = 'Popup';
+$txt['smileys_location_popup'] = 'More';
 $txt['smileys_modify'] = 'Modify';
 $txt['smileys_not_found_in_set'] = 'Smiley not found in set(s)';
 $txt['smileys_default_description'] = '(Insert a description)';
@@ -74,22 +71,23 @@
 $txt['smiley_preview_using'] = 'using smiley set';
 $txt['smileys_confirm'] = 'Are you sure you want to remove these smileys?\\n\\nNote: This won\\\'t remove the images, just the choices.';
 $txt['smileys_location_form_description'] = 'These smileys will appear above the text area, when posting a new forum message or Personal Message.';
-$txt['smileys_location_popup_description'] = 'These smileys will be shown in a popup, that is shown after a user has clicked \'[more]\'';
+$txt['smileys_location_popup_description'] = 'These smileys will be shown in a popup, that is shown after a user has clicked \'more\' button.';
 $txt['smileys_move_select_destination'] = 'Select smiley destination';
 $txt['smileys_move_select_smiley'] = 'Select smiley to move';
 $txt['smileys_move_here'] = 'Move smiley to this location';
 $txt['smileys_no_entries'] = 'There are currently no smileys configured.';
 
 $txt['icons_edit_icons_explain'] = 'From here you can change which message icons are available throughout your board. You can add, edit and remove icons, as well as limit their use to certain boards.';
-$txt['icons_edit_icons_all_boards'] = 'Available In All Boards';
+$txt['icons_edit_icons_all_boards'] = 'Available in all boards';
 $txt['icons_board'] = 'Board';
 $txt['icons_confirm'] = 'Are you sure you wish to remove these icons?\\n\\nNote this will only stop new posters from using the icons, the images will remain.';
-$txt['icons_add_new'] = 'Add New Icon';
+$txt['icons_add_new'] = 'Add new icon';
 
-$txt['icons_edit_icon'] = 'Edit Message Icon';
-$txt['icons_new_icon'] = 'New Message Icon';
-$txt['icons_location_first_icon'] = 'As First Icon';
+$txt['icons_edit_icon'] = 'Edit message icon';
+$txt['icons_new_icon'] = 'New message icon';
+$txt['icons_location_first_icon'] = 'As first icon';
 $txt['icons_location_after'] = 'After';
 $txt['icons_filename_all_gif'] = 'All files must be &quot;gif&quot; files';
+$txt['icons_filename_all_png'] = 'All files must be &quot;png&quot; files';
 $txt['icons_no_entries'] = 'There are currently no message icons configured.';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Manual.english.php b/Themes/default/languages/Manual.english.php
--- a/Themes/default/languages/Manual.english.php	2011-06-11 08:04:50.000000000 -0700
+++ b/Themes/default/languages/Manual.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; Manual
+// Version: 2.1 Beta 1; Manual
 
 /* Everything in this file is for the Simple Machines help manual
    If you are looking at translating the manual into another language
@@ -33,4 +33,5 @@
 $txt['manual_section_calendar_desc'] = 'Users can keep track of events, holidays, and birthdays with the calendar.';
 $txt['manual_section_features_desc'] = 'Here is a list of the most popular features in SMF.';
 
+$txt['agreement_disabled'] = 'Registration agreement disabled';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/ModerationCenter.english.php b/Themes/default/languages/ModerationCenter.english.php
--- a/Themes/default/languages/ModerationCenter.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/ModerationCenter.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,16 +1,16 @@
 <?php
-// Version: 2.0; ModerationCenter
-
-global $scripturl;
+// Version: 2.1 Beta 1; ModerationCenter
 
 $txt['moderation_center'] = 'Moderation Center';
 $txt['mc_main'] = 'Main';
+$txt['mc_logs'] = 'Logs';
 $txt['mc_posts'] = 'Posts';
-$txt['mc_groups'] = 'Membergroups';
+$txt['mc_groups'] = 'Groups';
+$txt['mc_members'] = 'Members';
 
 $txt['mc_view_groups'] = 'View Membergroups';
 
-$txt['mc_description'] = 'This is your &quot;Moderation Center&quot;. From here you can perform all the moderation actions assigned to yourself by the Administrator. This home page contains a summary of all the latest happenings in your community. You can personalize the layout by clicking <a href="' . $scripturl . '?action=moderate;area=settings">here</a>.';
+$txt['mc_description'] = 'This is your &quot;Moderation Center&quot;. From here you can perform all the moderation actions assigned to yourself by the Administrator. This home page contains a summary of all the latest happenings in your community.';
 $txt['mc_group_requests'] = 'Membergroup Requests';
 $txt['mc_unapproved_posts'] = 'Unapproved Posts';
 $txt['mc_watched_users'] = 'Recent Watched Members';
@@ -18,18 +18,22 @@
 $txt['mc_scratch_board'] = 'Moderator Scratch Board';
 $txt['mc_latest_news'] = 'Simple Machines Latest News';
 $txt['mc_recent_reports'] = 'Recent Topic Reports';
+$txt['mc_recent_user_reports'] = 'Recent Profile Reports';
 $txt['mc_warnings'] = 'Warnings';
 $txt['mc_notes'] = 'Moderator Notes';
 
+$txt['mc_notes_delete_own'] = 'You are only allowed to delete your own notes.';
 $txt['mc_cannot_connect_sm'] = 'You are unable to connect to simplemachines.org\'s latest news file.';
 
 $txt['mc_recent_reports_none'] = 'There are no outstanding reports';
 $txt['mc_watched_users_none'] = 'There are not currently any watches in place.';
 $txt['mc_group_requests_none'] = 'There are no open requests for group membership.';
+$txt['mc_reported_users_none'] = 'There are no pending profile reports.';
 
 $txt['mc_seen'] = '%1$s last seen %2$s';
 $txt['mc_seen_never'] = '%1$s never seen';
 $txt['mc_groupr_by'] = 'by';
+$txt['mc_post_report'] = '%1$s by %2$s';
 
 $txt['mc_reported_posts_desc'] = 'Here you can review all the post reports raised by members of the community.';
 $txt['mc_reportedp_active'] = 'Active Reports';
@@ -38,14 +42,20 @@
 $txt['mc_reportedp_reported_by'] = 'Reported By';
 $txt['mc_reportedp_last_reported'] = 'Last Reported';
 $txt['mc_reportedp_none_found'] = 'No Reports Found';
-
+$txt['mc_reportedp_comment_none_found'] = 'No Moderator Comment Found';
+$txt['mc_reportedp_comment_edit'] = 'Edit';
+$txt['mc_reportedp_comment_delete'] = 'Delete';
 $txt['mc_reportedp_details'] = 'Details';
 $txt['mc_reportedp_close'] = 'Close';
 $txt['mc_reportedp_open'] = 'Open';
 $txt['mc_reportedp_ignore'] = 'Ignore';
 $txt['mc_reportedp_unignore'] = 'Un-Ignore';
+$txt['mc_reportedp_delete'] = 'Delete message';
+$txt['mc_reportedp_new_comment'] = 'Add a new comment';
+$txt['mc_reportedp_delete_confirm'] = 'Are you sure you wish to delete this message?';
+$txt['mc_reportedp_ban'] = 'Ban this user';
 // Do not use numeric entries in the below string.
-$txt['mc_reportedp_ignore_confirm'] = 'Are you sure you wish to ignore further reports about this message?\\n\\nThis will turn off further reports for all moderators of the forum.';
+$txt['mc_reportedp_ignore_confirm'] = 'If you choose "OK", then this forum will silently ignore and ignore all future attempts to report this post; moderators will not see any future reports about this post. Are you sure you wish to do this?';
 $txt['mc_reportedp_close_selected'] = 'Close Selected';
 
 $txt['mc_groupr_group'] = 'Membergroups';
@@ -54,15 +64,16 @@
 $txt['mc_groupr_none_found'] = 'There are currently no outstanding membergroup requests.';
 $txt['mc_groupr_submit'] = 'Submit';
 $txt['mc_groupr_reason_desc'] = 'Reason to reject %1$s\'s request to join &quot;%2$s&quot;';
-$txt['mc_groups_reason_title'] = 'Reasons for Rejection';
-$txt['with_selected'] = 'With Selected';
-$txt['mc_groupr_approve'] = 'Approve Request';
-$txt['mc_groupr_reject'] = 'Reject Request (No Reason)';
-$txt['mc_groupr_reject_w_reason'] = 'Reject Request with Reason';
+$txt['mc_groups_reason_title'] = 'Reasons for rejection';
+$txt['with_selected'] = 'With selected';
+$txt['mc_groupr_approve'] = 'Approve request';
+$txt['mc_groupr_reject'] = 'Reject request (No Reason)';
+$txt['mc_groupr_reject_w_reason'] = 'Reject request with reason';
 // Do not use numeric entries in the below string.
 $txt['mc_groupr_warning'] = 'Are you sure you wish to do this?';
 
 $txt['mc_unapproved_attachments_none_found'] = 'There are currently no attachments awaiting approval';
+$txt['mc_unapproved_attachments_desc'] = 'From here you can approve or delete any attachments awaiting moderation.';
 $txt['mc_unapproved_replies_none_found'] = 'There are currently no posts awaiting approval';
 $txt['mc_unapproved_topics_none_found'] = 'There are currently no topics awaiting approval';
 $txt['mc_unapproved_posts_desc'] = 'From here you can approve or delete any posts awaiting moderation.';
@@ -70,17 +81,22 @@
 $txt['mc_unapproved_topics'] = 'Topics';
 $txt['mc_unapproved_by'] = 'by';
 $txt['mc_unapproved_sure'] = 'Are you sure you want to do this?';
-$txt['mc_unapproved_attach_name'] = 'Attachment Name';
+$txt['mc_unapproved_attach_name'] = 'Attachment name';
 $txt['mc_unapproved_attach_size'] = 'Filesize';
 $txt['mc_unapproved_attach_poster'] = 'Poster';
-$txt['mc_viewmodreport'] = 'Moderation Report for %1$s by %2$s';
-$txt['mc_modreport_summary'] = 'There have been %1$d report(s) concerning this post.  The last report was %2$s.';
+$txt['mc_viewmodreport'] = 'Moderation report for %1$s by %2$s';
+$txt['mc_modreport_summary'] = 'There have been %1$d report(s) concerning this post. The last report was %2$s.';
 $txt['mc_modreport_whoreported_title'] = 'Members who have reported this post';
-$txt['mc_modreport_whoreported_data'] = 'Reported by %1$s on %2$s.  They left the following message:';
+$txt['mc_modreport_whoreported_data'] = 'Reported by %1$s on %2$s. They left the following message:';
 $txt['mc_modreport_modactions'] = 'Actions taken by other moderators';
 $txt['mc_modreport_mod_comments'] = 'Moderator Comments';
 $txt['mc_modreport_no_mod_comment'] = 'There are not currently any moderator comments';
 $txt['mc_modreport_add_mod_comment'] = 'Add Comment';
+$txt['mc_modreport_edit_mod_comment'] = 'Edit Comment';
+
+$txt['mc_viewmemberreport'] = 'Report for profile of %1$s';
+$txt['mc_memberreport_summary'] = 'There have been %1$d report(s) concerning this member. The last report was %2$s.';
+$txt['mc_memberreport_whoreported_title'] = 'Members who have reported this member.';
 
 $txt['show_notice'] = 'Notice Text';
 $txt['show_notice_subject'] = 'Subject';
@@ -102,10 +118,10 @@
 $txt['mc_warnings_description'] = 'From this section you can see which warnings have been issued to members of the forum. You can also add and modify the notification templates used when sending a warning to a member.';
 $txt['mc_warning_log'] = 'Log';
 $txt['mc_warning_templates'] = 'Custom Templates';
-$txt['mc_warning_log_title'] = 'Viewing Warning Log';
-$txt['mc_warning_templates_title'] = 'Custom Warning Templates';
+$txt['mc_warning_log_title'] = 'Viewing warning log';
+$txt['mc_warning_templates_title'] = 'Custom warning templates';
 
-$txt['mc_warnings_none'] = 'No warnings have been issued yet!';
+$txt['mc_warnings_none'] = 'No warnings have been issued.';
 $txt['mc_warnings_recipient'] = 'Recipient';
 
 $txt['mc_warning_templates_none'] = 'No warning templates have been created yet';
@@ -116,6 +132,19 @@
 $txt['mc_warning_template_modify'] = 'Edit Template';
 $txt['mc_warning_template_delete'] = 'Delete Selected';
 $txt['mc_warning_template_delete_confirm'] = 'Are you sure you want to delete the selected templates?';
+$txt['report_action_message_saved'] = 'You successfully created a new comment.';
+$txt['report_action_message_edited'] = 'You successfully edited the comment.';
+$txt['report_action_message_deleted'] = 'The message was successfully deleted.';
+$txt['report_action_message_edit_issue'] = 'The message you\'re trying to edit isn\'t available any more. Please check if it wasn\'t deleted already.';
+$txt['report_action_message_edit_cannot'] = 'I\'m sorry, you aren\'t allowed to edit this comment.';
+$txt['report_action_message_delete_cannot'] = 'I\'m sorry, you aren\'t allowed to delete this comment.';
+$txt['report_action_message_delete_issue'] = 'The message you\'re trying to delete isn\'t available any more. Please check if it wasn\'t deleted already.';
+$txt['report_action_ignore'] = 'The report was successfully ignored.';
+$txt['report_action_unignore'] = 'The report was successfully un-ignored.';
+$txt['report_action_close'] = 'The report was successfully closed.';
+$txt['report_action_close_all'] = 'You successfully closed all reports.';
+$txt['report_action_open'] = 'The report was successfully open.';
+$txt['report_action_close_all'] = 'You successfully closed all selected reports.';
 
 $txt['mc_warning_template_desc'] = 'Use this page to fill in the details of the template. Note that the subject for the email is not part of the template. Note that as the notification is sent by PM you can use BBC within the template. Note if you use the {MESSAGE} variable then this template will not be available when issuing a generic warning (i.e. A warning not linked to a post).';
 $txt['mc_warning_template_title'] = 'Template Title';
@@ -123,23 +152,23 @@
 $txt['mc_warning_template_body_default'] = '{MEMBER},' . "\n\n" . 'You have received a warning for inappropriate activity. Please cease these activities and abide by the forum rules otherwise we will take further action.' . "\n\n" . '{REGARDS}';
 $txt['mc_warning_template_personal'] = 'Personal Template';
 $txt['mc_warning_template_personal_desc'] = 'If you select this option only you will be able to see, edit and use this template. If not selected all moderators will be able to use this template.';
-$txt['mc_warning_template_error_empty'] = 'You must set both a title and notification body.';
+$txt['mc_warning_template_error_no_title'] = 'You must set title.';
+$txt['mc_warning_template_error_no_body'] = 'You must set a notification body.';
 
-$txt['mc_prefs'] = 'Preferences';
 $txt['mc_settings'] = 'Change Settings';
 $txt['mc_prefs_title'] = 'Moderation Preferences';
 $txt['mc_prefs_desc'] = 'This section allows you to set some personal preferences for moderation related activities such as email notifications.';
-$txt['mc_prefs_homepage'] = 'Items to show on moderation homepage';
-$txt['mc_prefs_latest_news'] = 'SM News';
-$txt['mc_prefs_show_reports'] = 'Show open report count in forum header';
-$txt['mc_prefs_notify_report'] = 'Notify of topic reports';
-$txt['mc_prefs_notify_report_never'] = 'Never';
-$txt['mc_prefs_notify_report_moderator'] = 'Only if it\'s a board I moderate';
-$txt['mc_prefs_notify_report_always'] = 'Always';
+$txt['mc_no_settings'] = 'There are no settings to display.';
+
 $txt['mc_prefs_notify_approval'] = 'Notify of items awaiting approval';
+$txt['mc_logoff'] = 'End Moderator Session';
 
 // Use entities in the below string.
 $txt['mc_click_add_note'] = 'Add a new note';
 $txt['mc_add_note'] = 'Add';
 
-?>
\ No newline at end of file
+// Do not use numeric entries in the below string.
+$txt['mc_reportedm_ignore_confirm'] = 'Are you sure you wish to ignore further reports about this user\'s profile?\\n\\nThis will turn off further reports for everyone.';
+$txt['mc_reported_members_title'] = 'Reported Members';
+$txt['mc_reported_members_desc'] = 'Allows you to view a list of all users whose profiles have been reported';
+?>
diff -ru a/Themes/default/languages/Modifications.english.php b/Themes/default/languages/Modifications.english.php
--- a/Themes/default/languages/Modifications.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Modifications.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,4 +1,4 @@
 <?php
-// Version: 2.0; Modifications
+// Version: 2.1 Beta 1; Modifications
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Modlog.english.php b/Themes/default/languages/Modlog.english.php
--- a/Themes/default/languages/Modlog.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Modlog.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,7 +1,5 @@
 <?php
-// Version: 2.0; Modlog
-
-global $scripturl;
+// Version: 2.1 Beta 1; Modlog
 
 $txt['modlog_date'] = 'Date';
 $txt['modlog_member'] = 'Member';
@@ -11,7 +9,9 @@
 $txt['modlog_search_result'] = 'Search Results';
 $txt['modlog_total_entries'] = 'Total Entries';
 $txt['modlog_ac_approve_topic'] = 'Approved topic &quot;{topic}&quot; by &quot;{member}&quot;';
+$txt['modlog_ac_unapprove_topic'] = 'Unapproved topic &quot;{topic}&quot; by &quot;{member}&quot;';
 $txt['modlog_ac_approve'] = 'Approved message &quot;{subject}&quot; in &quot;{topic}&quot; by &quot;{member}&quot;';
+$txt['modlog_ac_unapprove'] = 'Unapproved message &quot;{subject}&quot; in &quot;{topic}&quot; by &quot;{member}&quot;';
 $txt['modlog_ac_lock'] = 'Locked &quot;{topic}&quot;';
 $txt['modlog_ac_warning'] = 'Warned {member} for &quot;{message}&quot;';
 $txt['modlog_ac_unlock'] = 'Unlocked &quot;{topic}&quot;';
@@ -27,12 +27,16 @@
 $txt['modlog_ac_profile'] = 'Edit the profile of &quot;{member}&quot;';
 $txt['modlog_ac_pruned'] = 'Pruned some posts older than {days} days';
 $txt['modlog_ac_news'] = 'Edited the news';
+$txt['modlog_ac_clearlog_moderate'] = 'Cleared the moderation log';
+$txt['modlog_ac_clearlog_admin'] = 'Cleared the administration log';
 $txt['modlog_enter_comment'] = 'Enter Moderation Comment';
 $txt['modlog_moderation_log'] = 'Moderation Log';
-$txt['modlog_moderation_log_desc'] = 'Below is a list of all the moderation actions that have been carried out by moderators of the forum.<br /><strong>Please note:</strong> Entries cannot be removed from this log until they are at least twenty-four hours old.';
+$txt['modlog_moderation_log_desc'] = 'Below is a list of all the moderation actions that have been carried out by moderators of the forum.';
 $txt['modlog_no_entries_found'] = 'There are currently no moderation log entries.';
-$txt['modlog_remove'] = 'Remove';
-$txt['modlog_removeall'] = 'Remove All';
+$txt['modlog_remove'] = 'Delete Selected';
+$txt['modlog_removeall'] = 'Clear Log';
+$txt['modlog_remove_selected_confirm'] = 'Are you sure you want to delete the selected log entries?';
+$txt['modlog_remove_all_confirm'] = 'Are you sure you want to completely clear the log?';
 $txt['modlog_go'] = 'Go';
 $txt['modlog_add'] = 'Add';
 $txt['modlog_search'] = 'Quick Search';
@@ -44,13 +48,14 @@
 $txt['modlog_ac_delete_warn_template'] = 'Deleted the warning template: &quot;{template}&quot;';
 
 $txt['modlog_ac_ban'] = 'Added ban triggers:';
+$txt['modlog_ac_ban_remove'] = 'Removed ban triggers:';
 $txt['modlog_ac_ban_trigger_member'] = ' <em>Member:</em> {member}';
 $txt['modlog_ac_ban_trigger_email'] = ' <em>Email:</em> {email}';
 $txt['modlog_ac_ban_trigger_ip_range'] = ' <em>IP:</em> {ip_range}';
 $txt['modlog_ac_ban_trigger_hostname'] = ' <em>Hostname:</em> {hostname}';
 
 $txt['modlog_admin_log'] = 'Administration Log';
-$txt['modlog_admin_log_desc'] = 'Below is a list of administration actions which have been logged on your forum.<br /><strong>Please note:</strong> Entries cannot be removed from this log until they are at least twenty-four hours old.';
+$txt['modlog_admin_log_desc'] = 'Below is a list of administration actions which have been logged on your forum.';
 $txt['modlog_admin_log_no_entries_found'] = 'There are currently no administration log entries.';
 
 // Admin type strings.
@@ -84,4 +89,28 @@
 
 $txt['modlog_parameter_guest'] = '<em>Guest</em>';
 
+$txt['modlog_ac_approve_attach'] = 'Approved &quot;{filename}&quot; in &quot;{message}&quot;';
+$txt['modlog_ac_remove_attach'] = 'Removed unapproved &quot;{filename}&quot; in &quot;{message}&quot;';
+
+// Handling reports on posts
+$txt['modlog_report'] = 'report';
+$txt['modlog_ac_close_report'] = 'Closed {report} on &quot;{message}&quot;';
+$txt['modlog_ac_ignore_report'] = 'Disregarded {report} on &quot;{message}&quot;';
+$txt['modlog_ac_open_report'] = 'Reopened {report} on &quot;{message}&quot;';
+$txt['modlog_ac_unignore_report'] = 'Undone disregard of {report} on &quot;{message}&quot;';
+
+// Handling reports on users
+$txt['modlog_ac_close_user_report'] = 'Closed {report} on profile of {member}';
+$txt['modlog_ac_ignore_user_report'] = 'Disregarded {report} on profile of {member}';
+$txt['modlog_ac_open_user_report'] = 'Reopened {report} on profile of {member}';
+$txt['modlog_ac_unignore_user_report'] = 'Undone disregard of {report} on profile of {member}';
+
+// Poll stuff
+$txt['modlog_ac_add_poll'] = 'Added a poll to &quot;{topic}&quot;';
+$txt['modlog_ac_edit_poll'] = 'Edited the poll in &quot;{topic}&quot;';
+$txt['modlog_ac_lock_poll'] = 'Locked voting in the poll in &quot;{topic}&quot;';
+$txt['modlog_ac_remove_poll'] = 'Removed the poll from &quot;{topic}&quot;';
+$txt['modlog_ac_reset_poll'] = 'Reset votes in the poll in &quot;{topic}&quot;';
+$txt['modlog_ac_unlock_poll'] = 'Unlocked voting in the poll in &quot;{topic}&quot;';
+
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Packages.english.php b/Themes/default/languages/Packages.english.php
--- a/Themes/default/languages/Packages.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Packages.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,9 +1,10 @@
 <?php
-// Version: 2.0; Packages
+// Version: 2.1 Beta 1; Packages
 
 $txt['package_proceed'] = 'Proceed';
 $txt['php_script'] = 'Modification file was extracted, but this modification also comes with a PHP script which should be executed before it will work';
 $txt['package_run'] = 'Run';
+$txt['package_id'] = 'ID';
 $txt['package_read'] = 'Read';
 $txt['script_output'] = 'Script output:';
 $txt['additional_notes'] = 'Additional notes';
@@ -23,26 +24,27 @@
 $txt['package_manager'] = 'Package Manager';
 $txt['install_mod'] = 'Install Mod';
 $txt['uninstall_mod'] = 'Uninstall Mod';
-$txt['sql_file'] = 'Modification file was extracted, this modification also comes with a SQL file with modifications the database needs.  It is a good idea to run it.';
+$txt['sql_file'] = 'The Modification file has been extracted. This modification also comes with a database file containing changes the database needs. You will need to execute this file for the modification to function properly.';
 $txt['sql_queries'] = 'SQL Queries';
 $txt['no_mods_installed'] = 'No mods currently installed';
 $txt['browse_installed'] = 'Browse installed mods';
 $txt['uninstall'] = 'Uninstall';
-$txt['delete_list'] = 'Delete Mod List';
-$txt['php_safe_mode'] = 'Sorry, you server has PHP set to SAFE MODE.  This feature is not compatible with SAFE MODE.  Sorry.';
+$txt['package_delete_list_warning'] = 'Are you sure you wish to clear the installed modification list?';
+$txt['php_safe_mode'] = 'Sorry, your server currently has PHP set to run in SAFE MODE. This feature is not compatible with SAFE MODE.';
 $txt['lets_try_anyway'] = 'Let me try anyway.';
 
-$txt['package_manager_desc'] = 'From the package manager you can download and install modifications to your forum through an easy to use interface.';
-$txt['installed_packages_desc'] = 'You can use the interface below to view those packages currently installed on the forum, and remove the ones you no longer require.';
+$txt['could_not_package_backup'] = 'A backup could not be made before making changes. No changes have been made at this time as a result (either change the permissions so Packages/backup can be written to, or turn off backups - not recommended)';
+
+$txt['package_manager_desc'] = 'From this easy to use interface, you can download and install modifications for use on your forum.';
 $txt['download_packages_desc'] = 'From this section you can choose to either download new packages from package servers, or upload a package file directly to the forum.';
 
-$txt['create_package'] = 'Create a New Package';
-$txt['download_new_package'] = 'Download New Packages';
-$txt['view_and_remove'] = 'View and Remove Installed Packages';
-$txt['modification_package'] = 'Modification Packages';
-$txt['avatar_package'] = 'Avatar Packages';
-$txt['language_package'] = 'Language Packages';
-$txt['unknown_package'] = 'Unknown Packages';
+$txt['create_package'] = 'Create a new Package';
+$txt['download_new_package'] = 'Download new packages';
+$txt['view_and_remove'] = 'View and remove installed packages';
+$txt['modification_package'] = 'Modification packages';
+$txt['avatar_package'] = 'Avatar packages';
+$txt['language_package'] = 'Language packages';
+$txt['unknown_package'] = 'Unknown packages';
 $txt['use_avatars'] = 'Use Avatars';
 $txt['add_languages'] = 'Add Language';
 $txt['list_files'] = 'List Files';
@@ -50,40 +52,40 @@
 $txt['package_type'] = 'Package Type';
 $txt['archiving'] = 'Archiving';
 $txt['extracting'] = 'Extracting';
-$txt['avatars_extracted'] = 'The avatars have been extracted, you can now use them.';
-$txt['language_extracted'] = 'The language pack has been extracted, you can now use it (by setting it in your settings).';
+$txt['avatars_extracted'] = 'The avatars have been installed. You should now be able to use them.';
+$txt['language_extracted'] = 'The language pack has been installed. You can now enable its use in the language settings area of your admin control panel.';
 
 $txt['mod_name'] = 'Mod Name';
 $txt['mod_version'] = 'Version';
+$txt['mod_installed_time'] = 'Installed';
 $txt['mod_author'] = 'Author';
 $txt['author_website'] = 'Author\'s Homepage';
-$txt['package_no_description'] = 'No Description Given';
+$txt['package_no_description'] = 'No description given';
 $txt['package_description'] = 'Description';
 $txt['file_location'] = 'Location of file';
 
 $txt['package_installed_key'] = 'Installed mods:';
-$txt['package_installed_current'] = 'current version';
-$txt['package_installed_old'] = 'older version';
-$txt['package_installed_warning1'] = 'This package is already installed, and no upgrade was found!';
+$txt['package_installed_warning1'] = 'This package is already installed, and no upgrade was found.';
 $txt['package_installed_warning2'] = 'You should uninstall the old version first to avoid problems, or ask the author to create an upgrade from your old version.';
 $txt['package_installed_warning3'] = 'Please remember to always make regular backups of your sources and database before installing mods, especially beta versions.';
 $txt['package_installed_extract'] = 'Extracting Package';
-$txt['package_installed_done'] = 'The package was installed successfully.  You should now be able to use whatever functionality it adds or changes; or not be able to use functionality it removes.';
+$txt['package_installed_done'] = 'The package was installed successfully. You should now be able to use whatever functionality it adds or changes; or not be able to use functionality it removes.';
 $txt['package_installed_redirecting'] = 'Redirecting...';
 $txt['package_installed_redirect_go_now'] = 'Redirect Now';
 $txt['package_installed_redirect_cancel'] = 'Return to Package Manager';
 
-$txt['packages_latest'] = 'Latest Packages';
-$txt['packages_latest_fetch'] = 'Attempting to fetch the most popular and recent packages from www.simplemachines.org...';
+$txt['packages_adding_title'] = 'Obtaining Packages';
+$txt['packages_adding'] = 'You can always find new packages for your forum from the SMF modifications area - <strong><a href="http://custom.simplemachines.org/mods/" target="_blank">http://custom.simplemachines.org/mods/</a></strong>. You can browse them on the website, read the comments, and download them to your computer and then upload them to your forum from there.<br><br>If you run into any questions with modifications, each modification published on simplemachines.org has a dedicated topic about it where support and comments should be directed to.';
 
 $txt['package_upgrade'] = 'Upgrade';
 $txt['package_uninstall_readme'] = 'Uninstallation Readme';
 $txt['package_install_readme'] = 'Installation Readme';
+$txt['package_install_license'] = 'License';
 $txt['package_install_type'] = 'Type';
 $txt['package_install_action'] = 'Action';
 $txt['package_install_desc'] = 'Description';
 $txt['install_actions'] = 'Install Actions';
-$txt['perform_actions'] = 'Installing this package will perform the following actions:';
+$txt['perform_actions'] = 'This will perform the following actions:';
 $txt['corrupt_compatible'] = 'The package you are trying to download or install is either corrupt or not compatible with this version of SMF.';
 $txt['package_create'] = 'Create';
 $txt['package_move'] = 'Move';
@@ -93,20 +95,29 @@
 $txt['package_tree'] = 'Tree';
 $txt['execute_modification'] = 'Execute Modification';
 $txt['execute_code'] = 'Execute Code';
-$txt['execute_database_changes'] = 'Adapt Database';
+$txt['execute_database_changes'] = 'Execute file';
+$txt['execute_hook_add'] = 'Add Hook';
+$txt['execute_hook_remove'] = 'Remove Hook';
+$txt['execute_hook_action'] = 'Adapting hook %1$s';
+$txt['package_requires'] = 'Requires Modification';
+$txt['package_check_for'] = 'Check for installation:';
+$txt['execute_credits_add'] = 'Add Credits';
+$txt['execute_credits_remove'] = 'Remove Credits';
+$txt['execute_credits_action'] = 'Credits: %1$s';
 
 $txt['package_install_actions'] = 'Installations actions for';
-$txt['package_will_fail_title'] = 'Error in Package Installation';
-$txt['package_will_fail_warning'] = 'At least one error was encountered during a test installation of this package.
-	It is <strong>strongly</strong> recommended that you do not continue with installation unless you know what you are doing, and have made a backup very recently.
-	This error may be caused by a conflict between the package you\'re trying to install and another package you have already installed, an error in the package, a package which requires another package that you don\'t have installed yet, or a package designed for another version of SMF.';
+$txt['package_will_fail_title'] = 'Error in package %1$s';
+$txt['package_will_fail_warning'] = 'At least one error was encountered during a test %1$s of this package.<br>It is <strong>strongly</strong> recommended that you do not continue with %1$s unless you know what you are doing, and have made a backup very recently.<br><br>This error may be caused by a conflict between the package you\'re trying to install and another package you have already installed, an error in the package, a package which requires another package that you have not installed yet, or a package designed for another version of SMF.';
+$txt['package_will_fail_unknown_action'] = 'The package is trying to perform an unknown action: %1$s';
 // Don't use entities in the below string.
 $txt['package_will_fail_popup'] = 'Are you sure you wish to continue installing this modification, even though it will not install successfully?';
 $txt['package_will_fail_popup_uninstall'] = 'Are you sure you wish to continue uninstalling this modification, even though it will not uninstall successfully?';
-$txt['package_install_now'] = 'Install Now';
-$txt['package_uninstall_now'] = 'Uninstall Now';
-$txt['package_other_themes'] = 'Install in Other Themes';
-$txt['package_other_themes_uninstall'] = 'UnInstall in Other Themes';
+$txt['package_install'] = 'installation';
+$txt['package_uninstall'] = 'removal';
+$txt['package_install_now'] = 'Install now';
+$txt['package_uninstall_now'] = 'Uninstall now';
+$txt['package_other_themes'] = 'Install in other themes';
+$txt['package_other_themes_uninstall'] = 'UnInstall in other themes';
 $txt['package_other_themes_desc'] = 'To use this modification in themes other than the default, the package manager needs to make additional changes to the other themes. If you\'d like to install this modification in the other themes, please select these themes below.';
 // Don't use entities in the below string.
 $txt['package_theme_failure_warning'] = 'At least one error was encountered during a test install of this theme. Are you sure you wish to attempt installation?';
@@ -120,20 +131,22 @@
 $txt['package_action_skipping'] = '<strong>Skipping file</strong>';
 
 $txt['package_uninstall_actions'] = 'Uninstall Actions';
-$txt['package_uninstall_done'] = 'The package has been uninstalled, it should no longer take effect.';
-$txt['package_uninstall_cannot'] = 'This package cannot be uninstalled, because there is no uninstaller!<br /><br />Please contact the mod author for more information.';
+$txt['package_uninstall_done'] = 'The package has been successfully uninstalled.';
+$txt['package_uninstall_cannot'] = 'This package cannot be uninstalled, because there is no uninstaller.<br><br>Please contact the mod author for more information.';
 
 $txt['package_install_options'] = 'Installation Options';
-$txt['package_install_options_ftp_why'] = 'Using the package manager\'s FTP functionality is the easiest way to avoid having to manually chmod the files writable through FTP yourself for the package manager to work.<br />Here you can set the default values for some fields.';
+$txt['package_install_options_desc'] = 'Set various options for how the package manager installs modifications, including backups and FTP access';
+$txt['package_install_options_ftp_why'] = 'Using the package manager\'s FTP functionality is the easiest way to avoid having to manually chmod the files writable through FTP yourself for the package manager to work.<br>Here you can set the default values for some fields.';
 $txt['package_install_options_ftp_server'] = 'FTP Server';
 $txt['package_install_options_ftp_port'] = 'Port';
 $txt['package_install_options_ftp_user'] = 'Username';
 $txt['package_install_options_make_backups'] = 'Create Backup versions of replaced files with a tilde (~) on the end of their names.';
+$txt['package_install_options_make_full_backups'] = 'Create an entire backup (excluding smileys, avatars and attachments) of the SMF install.';
 
 $txt['package_ftp_necessary'] = 'FTP Information Required';
-$txt['package_ftp_why'] = 'Some of the files the package manager needs to modify are not writable.  This needs to be changed by logging into FTP and using it to chmod or create the files and folders.  Your FTP information may be temporarily cached for proper operation of the package manager. Note you can also do this manually using an FTP client - to view a list of the affected files please click <a href="#" onclick="%1$s">here</a>.';
+$txt['package_ftp_why'] = 'Some of the files the package manager needs to modify are not writable. This needs to be changed by logging into FTP and using it to chmod or create the files and directories. Your FTP information may be temporarily cached for proper operation of the package manager. Note you can also do this manually using an FTP client - to view a list of the affected files please click <a href="#" onclick="%1$s">here</a>.';
 $txt['package_ftp_why_file_list'] = 'The following files need to made writable to continue installation:';
-$txt['package_ftp_why_download'] = 'To download packages, the Packages directory and files in it need to be writable - and they are not currently.  The package manager can use your FTP information to fix this.';
+$txt['package_ftp_why_download'] = 'In order to download packages, the Packages directory, and any files in it, must be writable. Currently the system does not have the needed permissions to write to this directory. The package manager can use your FTP information to attempt to fix this problem.';
 $txt['package_ftp_server'] = 'FTP Server';
 $txt['package_ftp_port'] = 'Port';
 $txt['package_ftp_username'] = 'Username';
@@ -144,7 +157,7 @@
 $txt['package_ftp_test_success'] = 'FTP connection established.';
 $txt['package_ftp_test_failed'] = 'Could not contact server.';
 
-// For a break, use \\n instead of <br />... and don't use entities.
+// For a break, use \\n instead of <br>... and don't use entities.
 $txt['package_delete_bad'] = 'The package you are about to delete is currently installed!  If you delete it, you may not be able to uninstall it later.\\n\\nAre you sure?';
 
 $txt['package_examine_file'] = 'View file in package';
@@ -152,13 +165,12 @@
 
 $txt['package_upload_title'] = 'Upload a Package';
 $txt['package_upload_select'] = 'Package to Upload';
-$txt['package_upload'] = 'Upload';
 $txt['package_uploaded_success'] = 'Package uploaded successfully';
 $txt['package_uploaded_successfully'] = 'The package has been uploaded successfully';
 
 $txt['package_modification_malformed'] = 'Malformed or invalid modification file.';
 $txt['package_modification_missing'] = 'The file could not be found.';
-$txt['package_no_zlib'] = 'Sorry, your PHP configuration doesn\'t have support for <strong>zlib</strong>.  Without this, the package manager cannot function.  Please contact your host about this for more information.';
+$txt['package_no_zlib'] = 'Sorry, your PHP configuration doesn\'t have support for <strong>zlib</strong>. Without this, the package manager cannot function. Please contact your host about this for more information.';
 
 $txt['package_cleanperms_title'] = 'Cleanup Permissions';
 $txt['package_cleanperms_desc'] = 'This interface allows you to reset the permissions for files throughout your installation, so as to increase security or solve any permission problems you may encounter while installing packages.';
@@ -170,19 +182,21 @@
 
 $txt['package_download_by_url'] = 'Download a package by url';
 $txt['package_download_filename'] = 'Name of the file';
-$txt['package_download_filename_info'] = 'Optional value.  Should be used when the url does not end in the filename.  For example: index.php?mod=5';
+$txt['package_download_filename_info'] = 'Optional value. Should be used when the url does not end in the filename. For example: index.php?mod=5';
 
 $txt['package_db_uninstall'] = 'Remove all data associated with this modification.';
 $txt['package_db_uninstall_details'] = 'Details';
-$txt['package_db_uninstall_actions'] = 'Checking this option will result in the following database changes';
+$txt['package_db_uninstall_actions'] = 'Checking this option will result in the following actions';
 $txt['package_db_remove_table'] = 'Drop table &quot;%1$s&quot;';
 $txt['package_db_remove_column'] = 'Remove column &quot;%2$s&quot; from &quot;%1$s&quot;';
 $txt['package_db_remove_index'] = 'Remove index &quot;%1$s&quot; from &quot;%2$s&quot;';
 
-$txt['package_advanced_button'] = 'Advanced';
+$txt['package_advanced_button'] = 'Emulation Support';
 $txt['package_advanced_options'] = 'Advanced Options';
 $txt['package_apply'] = 'Apply';
 $txt['package_emulate'] = 'Emulate Version';
+$txt['package_emulate_install'] = 'Install Emulating:';
+$txt['package_emulate_uninstall'] = 'Uninstall Emulating:';
 $txt['package_emulate_revert'] = 'Revert';
 $txt['package_emulate_desc'] = 'Sometimes packages are locked to early versions of SMF but remain compatible with a newer version. Here you can choose to &quot;emulate&quot; a different SMF version within the package manager.';
 
@@ -196,7 +210,7 @@
 $txt['operation_invalid'] = 'The operation that you selected is invalid.';
 
 $txt['package_file_perms_desc'] = 'You can use this section to review the writable status of critical files and folders within your forum directory. Note this only considers key forum folders and files - use an FTP client for additional options.';
-$txt['package_file_perms_name'] = 'File/Folder Name';
+$txt['package_file_perms_name'] = 'File/Directory Name';
 $txt['package_file_perms_status'] = 'Current Status';
 $txt['package_file_perms_new_status'] = 'New Status';
 $txt['package_file_perms_status_read'] = 'Read';
@@ -211,7 +225,7 @@
 
 $txt['package_file_perms_change'] = 'Change File Permissions';
 $txt['package_file_perms_predefined'] = 'Use predefined permission profile';
-$txt['package_file_perms_predefined_note'] = 'Note that this only applies the predefined profile to key SMF folders and files.';
+$txt['package_file_perms_predefined_note'] = 'Note that this only applies the predefined profile to key SMF directories and files.';
 $txt['package_file_perms_apply'] = 'Apply individual file permissions settings selected above.';
 $txt['package_file_perms_custom'] = 'If &quot;Custom&quot; has been selected use chmod value of';
 $txt['package_file_perms_pre_restricted'] = 'Restricted - minimum files writable';
@@ -230,7 +244,7 @@
 
 $txt['chmod_value_invalid'] = 'You have tried to enter an invalid chmod value. Chmod must be between 0444 and 0777';
 
-$txt['package_restore_permissions'] = 'Restore File Permissions';
+$txt['package_restore_permissions'] = 'Restore file permissions';
 $txt['package_restore_permissions_desc'] = 'The following file permissions were changed by SMF to install the selected package(s). You can return these files back to their original status by clicking &quot;Restore&quot; below.';
 $txt['package_restore_permissions_restore'] = 'Restore';
 $txt['package_restore_permissions_filename'] = 'Filename';
@@ -240,7 +254,7 @@
 $txt['package_restore_permissions_pre_change'] = '%1$s (%3$s)';
 $txt['package_restore_permissions_post_change'] = '%2$s (%3$s - was %2$s)';
 $txt['package_restore_permissions_action_skipped'] = '<em>Skipped</em>';
-$txt['package_restore_permissions_action_success'] = '<span style="color: green;">Success</span>';
+$txt['package_restore_permissions_action_success'] = '<span class="success">Success</span>';
 $txt['package_restore_permissions_action_failure'] = '<span class="error">Failed</span>';
 $txt['package_restore_permissions_action_done'] = 'SMF has attempted to restore the selected files back to their original permissions, the results can be seen below. If a change failed, or for a more detailed view of file permissions, please see the <a href="%1$s">File Permissions</a> section.';
 
@@ -252,11 +266,13 @@
 	<li>This functionality is mainly applicable on non-Windows based servers - it will not work as expected on Windows in regards to permission flags.</li>
 	<li>Before proceeding make sure you have an FTP client installed in case you do make an error and need to FTP into the server to remedy it.</li>';
 
-$txt['package_confirm_view_package_content'] = 'Are you sure you want to view the package contents from this location:<br /><br />%1$s';
+$txt['package_confirm_view_package_content'] = 'Are you sure you want to view the package contents from this location:<br><br>%1$s';
 $txt['package_confirm_proceed'] = 'Proceed';
 $txt['package_confirm_go_back'] = 'Go back';
 
 $txt['package_readme_default'] = 'Default';
 $txt['package_available_readme_language'] = 'Available Readme Languages:';
+$txt['package_license_default'] = 'Default';
+$txt['package_available_license_language'] = 'Available License Languages:';
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/PersonalMessage.english.php b/Themes/default/languages/PersonalMessage.english.php
--- a/Themes/default/languages/PersonalMessage.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/PersonalMessage.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,8 +1,18 @@
 <?php
-// Version: 2.0; PersonalMessage
+// Version: 2.1 Beta 1; PersonalMessage
 
 global $context;
 
+// Things for the popup
+$txt['pm_unread'] = 'Unread';
+$txt['pm_sent_short'] = 'Sent';
+$txt['pm_new_short'] = 'New';
+$txt['pm_drafts_short'] = 'Drafts';
+$txt['pm_settings_short'] = 'Settings';
+$txt['pm_no_unread'] = 'No unread messages.';
+$txt['pm_was_sent_to_you'] = 'You received a message.';
+$txt['pm_you_were_replied_to'] = 'A message of yours was replied to.';
+
 $txt['pm_inbox'] = 'Personal Messages Index';
 $txt['send_message'] = 'Send message';
 $txt['pm_add'] = 'Add';
@@ -19,19 +29,13 @@
 $txt['delete_all'] = 'Delete all messages in your PMBOX';
 $txt['delete_all_confirm'] = 'Are you sure you want to delete all messages?';
 $txt['recipient'] = 'Recipient';
-// Don't translate the word "SUBJECT" here, as it is used to format the message - use numeric entities as well.
-$txt['new_pm_subject'] = 'New Personal Message: SUBJECT';
-// Don't translate SENDER or MESSAGE in this language string; they are replaced with the corresponding text - use numeric entities too.
-$txt['pm_email'] = 'You have just been sent a personal message by SENDER on ' . $context['forum_name'] . '.' . "\n\n" . 'IMPORTANT: Remember, this is just a notification. Please do not reply to this email.' . "\n\n" . 'The message they sent you was:' . "\n\n" . 'MESSAGE';
-$txt['pm_multiple'] = '(multiple recipients: \'name1, name2\')';
-// Use numeric entities in the below string.
-$txt['instant_reply'] = 'Reply to this Personal Message here:';
 
 $txt['delete_selected_confirm'] = 'Are you sure you want to delete all selected personal messages?';
 
 $txt['sent_to'] = 'Sent to';
 $txt['reply_to_all'] = 'Reply to All';
 $txt['delete_conversation'] = 'Delete Conversation';
+$txt['remove_conversation'] = 'Remove all messages in this conversation?';
 
 $txt['pm_capacity'] = 'Capacity';
 $txt['pm_currently_using'] = '%1$s messages, %2$s%% full.';
@@ -39,11 +43,10 @@
 
 $txt['pm_error_user_not_found'] = 'Unable to find member \'%1$s\'.';
 $txt['pm_error_ignored_by_user'] = 'User \'%1$s\' has blocked your personal message.';
-$txt['pm_error_data_limit_reached'] = 'PM could not be sent to \'%1$s\' as their inbox is full!';
+$txt['pm_error_data_limit_reached'] = 'PM could not be sent to \'%1$s\' as their inbox is full.';
 $txt['pm_error_user_cannot_read'] = 'User \'%1$s\' can not receive personal messages.';
 $txt['pm_successfully_sent'] = 'PM successfully sent to \'%1$s\'.';
 $txt['pm_send_report'] = 'Send report';
-$txt['pm_save_outbox'] = 'Save a copy in my outbox';
 $txt['pm_undisclosed_recipients'] = 'Undisclosed recipients';
 $txt['pm_too_many_recipients'] = 'You may not send personal messages to more than %1$d recipient(s) at once.';
 
@@ -54,32 +57,35 @@
 $txt['pm_prune'] = 'Prune Messages';
 $txt['pm_prune_desc1'] = 'Delete all personal messages older than';
 $txt['pm_prune_desc2'] = 'days.';
-$txt['pm_prune_warning'] = 'Are you sure you wish to prune your personal messages?';
+$txt['pm_prune_warning'] = 'Are you sure you wish to prune your personal messages? They cannot be recovered!';
+$txt['pm_remove_all'] = 'Delete all of your personal messages (this will wipe out your inbox and your outbox).';
+$txt['pm_remove_all_warning'] = 'Are you absolutely sure you wish to delete all of your personal messages? They cannot be recovered!';
+$txt['delete_all_prune'] = 'Delete all';
 
 // Actions Drop Down.
-$txt['pm_actions_title'] = 'Further Actions';
-$txt['pm_actions_delete_selected'] = 'Delete Selected';
-$txt['pm_actions_filter_by_label'] = 'Filter By Label';
+$txt['pm_actions_title'] = 'Further actions';
+$txt['pm_actions_delete_selected'] = 'Delete selected';
+$txt['pm_actions_filter_by_label'] = 'Filter by label';
 $txt['pm_actions_go'] = 'Go';
 
 // Manage Labels Screen.
 $txt['pm_apply'] = 'Apply';
-$txt['pm_manage_labels'] = 'Manage Labels';
+$txt['pm_manage_labels'] = 'Manage labels';
 $txt['pm_labels_delete'] = 'Are you sure you wish to delete the selected labels?';
 $txt['pm_labels_desc'] = 'From here you can add, edit and delete the labels used in your personal message center.';
-$txt['pm_label_add_new'] = 'Add New Label';
-$txt['pm_label_name'] = 'Label Name';
+$txt['pm_label_add_new'] = 'Add new label';
+$txt['pm_label_name'] = 'Label name';
 $txt['pm_labels_no_exist'] = 'You currently have no labels setup!';
 
 // Labeling Drop Down.
 $txt['pm_current_label'] = 'Label';
-$txt['pm_msg_label_title'] = 'Label Message';
-$txt['pm_msg_label_apply'] = 'Add Label';
-$txt['pm_msg_label_remove'] = 'Remove Label';
+$txt['pm_msg_label_title'] = 'Label message';
+$txt['pm_msg_label_apply'] = 'Add label';
+$txt['pm_msg_label_remove'] = 'Remove label';
 $txt['pm_msg_label_inbox'] = 'Inbox';
-$txt['pm_sel_label_title'] = 'Label Selected';
+$txt['pm_sel_label_title'] = 'Label selected';
 
-// Sidebar Headings.
+// Menu headings.
 $txt['pm_labels'] = 'Labels';
 $txt['pm_messages'] = 'Messages';
 $txt['pm_actions'] = 'Actions';
@@ -88,8 +94,8 @@
 $txt['pm_is_replied_to'] = 'You have forwarded or responded to this message.';
 
 // Reporting messages.
-$txt['pm_report_to_admin'] = 'Report To Admin';
-$txt['pm_report_title'] = 'Report Personal Message';
+$txt['pm_report_to_admin'] = 'Report to admin';
+$txt['pm_report_title'] = 'Report personal message';
 $txt['pm_report_desc'] = 'From this page you can report the personal message you received to the admin team of the forum. Please be sure to include a description of why you are reporting the message, as this will be sent along with the contents of the original message.';
 $txt['pm_report_admins'] = 'Administrator to send report to';
 $txt['pm_report_all_admins'] = 'Send to all forum administrators';
@@ -108,8 +114,8 @@
 $txt['pm_report_done'] = 'Thank you for submitting this report. You should hear back from the admin team shortly.';
 $txt['pm_report_return'] = 'Return to the inbox';
 
-$txt['pm_search_title'] = 'Search Personal Messages';
-$txt['pm_search_bar_title'] = 'Search Messages';
+$txt['pm_search_title'] = 'Search personal messages';
+$txt['pm_search_bar_title'] = 'Search messages';
 $txt['pm_search_text'] = 'Search for';
 $txt['pm_search_go'] = 'Search';
 $txt['pm_search_advanced'] = 'Advanced search';
@@ -126,8 +132,8 @@
 $txt['pm_search_order'] = 'Search order';
 $txt['pm_search_choose_label'] = 'Choose labels to search by, or search all';
 
-$txt['pm_search_results'] = 'Search Results';
-$txt['pm_search_none_found'] = 'No Messages Found';
+$txt['pm_search_results'] = 'Search results';
+$txt['pm_search_none_found'] = 'No messages found';
 
 $txt['pm_search_orderby_relevant_first'] = 'Most relevant first';
 $txt['pm_search_orderby_recent_first'] = 'Most recent first';
@@ -136,20 +142,20 @@
 $txt['pm_visual_verification_label'] = 'Verification';
 $txt['pm_visual_verification_desc'] = 'Please enter the code in the image above to send this pm.';
 
-$txt['pm_settings'] = 'Change Settings';
-$txt['pm_change_view'] = 'Change View';
+$txt['pm_settings'] = 'Change settings';
+$txt['pm_change_view'] = 'Change view';
 
 $txt['pm_manage_rules'] = 'Manage Rules';
-$txt['pm_manage_rules_desc'] = 'Message rules allow you to automatically sort incoming messages dependant on a set of criteria you define. Below are all the rules you currently have setup. To edit a rule simply click the rule name.';
+$txt['pm_manage_rules_desc'] = 'Message rules allow you to automatically sort incoming messages dependent on a set of criteria you define. Below are all the rules you currently have setup. To edit a rule simply click the rule name.';
 $txt['pm_rules_none'] = 'You have not yet setup any message rules.';
 $txt['pm_rule_title'] = 'Rule';
-$txt['pm_add_rule'] = 'Add New Rule';
-$txt['pm_apply_rules'] = 'Apply Rules Now';
+$txt['pm_add_rule'] = 'Add new rule';
+$txt['pm_apply_rules'] = 'Apply rules now';
 // Use entities in the below string.
 $txt['pm_js_apply_rules_confirm'] = 'Are you sure you wish to apply the current rules to all personal messages?';
 $txt['pm_edit_rule'] = 'Edit Rule';
 $txt['pm_rule_save'] = 'Save Rule';
-$txt['pm_delete_selected_rule'] = 'Delete Selected Rules';
+$txt['pm_delete_selected_rule'] = 'Delete selected rules';
 // Use entities in the below string.
 $txt['pm_js_delete_rule_confirm'] = 'Are you sure you wish to delete the selected rules?';
 $txt['pm_rule_name'] = 'Name';
@@ -159,23 +165,23 @@
 $txt['pm_rule_not_defined'] = 'Add some criteria to begin building this rule description.';
 $txt['pm_rule_js_disabled'] = '<span class="alert"><strong>Note:</strong> You appear to have javascript disabled. We highly recommend you enable javascript to use this feature.</span>';
 $txt['pm_rule_criteria'] = 'Criteria';
-$txt['pm_rule_criteria_add'] = 'Add Criteria';
-$txt['pm_rule_criteria_pick'] = 'Choose Criteria';
-$txt['pm_rule_mid'] = 'Sender Name';
-$txt['pm_rule_gid'] = 'Sender\'s Group';
-$txt['pm_rule_sub'] = 'Message Subject Contains';
-$txt['pm_rule_msg'] = 'Message Body Contains';
-$txt['pm_rule_bud'] = 'Sender is Buddy';
-$txt['pm_rule_sel_group'] = 'Select Group';
-$txt['pm_rule_logic'] = 'When Checking Criteria';
+$txt['pm_rule_criteria_add'] = 'Add criteria';
+$txt['pm_rule_criteria_pick'] = 'Choose criteria';
+$txt['pm_rule_mid'] = 'Sender name';
+$txt['pm_rule_gid'] = 'Sender\'s group';
+$txt['pm_rule_sub'] = 'Message subject contains';
+$txt['pm_rule_msg'] = 'Message body contains';
+$txt['pm_rule_bud'] = 'Sender is buddy';
+$txt['pm_rule_sel_group'] = 'Select group';
+$txt['pm_rule_logic'] = 'When checking criteria';
 $txt['pm_rule_logic_and'] = 'All criteria must be met';
 $txt['pm_rule_logic_or'] = 'Any criteria can be met';
 $txt['pm_rule_actions'] = 'Actions';
-$txt['pm_rule_sel_action'] = 'Select an Action';
-$txt['pm_rule_add_action'] = 'Add Action';
+$txt['pm_rule_sel_action'] = 'Select an action';
+$txt['pm_rule_add_action'] = 'Add action';
 $txt['pm_rule_label'] = 'Label message with';
-$txt['pm_rule_sel_label'] = 'Select Label';
-$txt['pm_rule_delete'] = 'Delete Message';
+$txt['pm_rule_sel_label'] = 'Select label';
+$txt['pm_rule_delete'] = 'Delete message';
 $txt['pm_rule_no_name'] = 'You forgot to enter a name for the rule.';
 $txt['pm_rule_no_criteria'] = 'A rule must have at least one criteria and one action set.';
 $txt['pm_rule_too_complex'] = 'The rule you are creating is too long for SMF to store. Try breaking it up into smaller rules.';
@@ -192,5 +198,6 @@
 $txt['pm_readable_label'] = 'apply label &quot;{LABEL}&quot;';
 $txt['pm_readable_delete'] = 'delete the message';
 $txt['pm_readable_then'] = '<strong>then</strong>';
+$txt['pm_remove_message'] = 'Remove this message';
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Post.english.php b/Themes/default/languages/Post.english.php
--- a/Themes/default/languages/Post.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Post.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,82 +1,30 @@
 <?php
-// Version: 2.0; Post
+// Version: 2.1 Beta 1; Post
 
 global $context;
 
 $txt['post_reply'] = 'Post reply';
-$txt['enter_verification_details'] = 'Complete verification details';
 $txt['message_icon'] = 'Message icon';
-$txt['subject_not_filled'] = 'The Subject field was not filled out. It is required.';
-$txt['message_body_not_filled'] = 'The Message Body was not filled out. It is required.';
+$txt['subject_not_filled'] = 'The subject field was not filled out. It is required.';
+$txt['message_body_not_filled'] = 'The message body was not filled out. It is required.';
 // Use numeric entities in the below string.
-$txt['regards_team'] = "Regards,\nThe " . $context['forum_name'] . ' Team.';
 $txt['add_bbc'] = 'Add BBC tags';
-$txt['bold'] = 'Bold';
-$txt['italic'] = 'Italicized';
-$txt['underline'] = 'Underline';
-$txt['center'] = 'Centered';
-$txt['hyperlink'] = 'Insert Hyperlink';
-$txt['insert_email'] = 'Insert Email';
-$txt['bbc_code'] = 'Insert Code';
-// Escape any single quotes in here twice.. 'it\'s' -> 'it\\\'s'.
-$txt['bbc_quote'] = 'Insert Quote';
-$txt['list'] = 'Insert List';
-$txt['list_unordered'] = 'Insert Unordered List';
-$txt['list_ordered'] = 'Insert Ordered List';
-
-$txt['change_color'] = 'Change Color';
-$txt['black'] = 'Black';
-$txt['red'] = 'Red';
-$txt['yellow'] = 'Yellow';
-$txt['pink'] = 'Pink';
-$txt['green'] = 'Green';
-$txt['orange'] = 'Orange';
-$txt['purple'] = 'Purple';
-$txt['blue'] = 'Blue';
-$txt['beige'] = 'Beige';
-$txt['brown'] = 'Brown';
-$txt['teal'] = 'Teal';
-$txt['navy'] = 'Navy';
-$txt['maroon'] = 'Maroon';
-$txt['lime_green'] = 'Lime Green';
-$txt['white'] = 'White';
-$txt['disable_smileys'] = 'Disable Smileys';
+
+$txt['disable_smileys'] = 'Disable smileys';
 $txt['dont_use_smileys'] = 'Don\'t use smileys.';
 // Escape any single quotes in here twice.. 'it\'s' -> 'it\\\'s'.
 $txt['posted_on'] = 'Posted on';
 $txt['standard'] = 'Standard';
 $txt['thumbs_up'] = 'Thumb Up';
 $txt['thumbs_down'] = 'Thumb Down';
-$txt['excamation_point'] = 'Exclamation point';
+$txt['exclamation_point'] = 'Exclamation point';
 $txt['question_mark'] = 'Question mark';
+$txt['icon_poll'] = 'Poll';
 $txt['lamp'] = 'Lamp';
-$txt['add_smileys'] = 'Add Smileys';
-$txt['flash'] = 'Insert Flash';
-$txt['ftp'] = 'Insert FTP Link';
-$txt['image'] = 'Insert Image';
-$txt['table'] = 'Insert Table';
-$txt['table_td'] = 'Insert Table Column';
-$txt['topic_notify_no'] = 'There are no topics with Notification.';
-$txt['marquee'] = 'Marquee';
-$txt['teletype'] = 'Teletype';
-$txt['strike'] = 'Strikethrough';
-$txt['glow'] = 'Glow';
-$txt['shadow'] = 'Shadow';
-$txt['preformatted'] = 'Preformatted Text';
-$txt['left_align'] = 'Left Align';
-$txt['right_align'] = 'Right Align';
-$txt['superscript'] = 'Superscript';
-$txt['subscript'] = 'Subscript';
-$txt['table_tr'] = 'Insert Table Row';
+$txt['add_smileys'] = 'Add smileys';
+$txt['topic_notify_no'] = 'There are no topics with notification.';
+// post_too_long seems unused (duplicate in Errors: error_post_too_long
 $txt['post_too_long'] = 'Your message is too long. Please go back and shorten it, then try again.';
-$txt['horizontal_rule'] = 'Horizontal Rule';
-$txt['font_size'] = 'Font Size';
-$txt['font_face'] = 'Font Face';
-$txt['toggle_view'] = 'Toggle View';
-$txt['unformat_text'] = 'Remove Formatting';
-
-$txt['rich_edit_wont_work'] = 'Your browser does not support Rich Text editing.';
-$txt['rich_edit_function_disabled'] = 'Your browser does not support this function.';
 
 // Use numeric entities in the below five strings.
 $txt['notifyUnsubscribe'] = 'Unsubscribe to this topic by clicking here';
@@ -84,20 +32,22 @@
 $txt['lock_after_post'] = 'Lock after Post';
 $txt['notify_replies'] = 'Notify me of replies.';
 $txt['lock_topic'] = 'Lock this topic.';
-$txt['shortcuts'] = 'shortcuts: hit alt+s to submit/post or alt+p to preview';
-$txt['shortcuts_firefox'] = 'shortcuts: hit shift+alt+s to submit/post or shift+alt+p to preview';
+$txt['shortcuts'] = 'shortcuts: alt+s submit/post or alt+p preview';
+$txt['shortcuts_drafts'] = 'shortcuts: alt+s submit/post, alt+p preview or alt+d save draft';
+$txt['shortcuts_firefox'] = 'shortcuts: shift+alt+s submit/post or shift+alt+p preview';
+$txt['shortcuts_drafts_firefox'] = 'shortcuts: shift+alt+s submit/post, shift+alt+p preview or shift+alt+d save draft';
 $txt['option'] = 'Option';
-$txt['reset_votes'] = 'Reset Vote Count';
+$txt['reset_votes'] = 'Reset vote count';
 $txt['reset_votes_check'] = 'Check this if you want to reset all vote counts to 0.';
 $txt['votes'] = 'votes';
 $txt['attach'] = 'Attach';
-$txt['clean_attach'] = 'Clear Attachment';
+$txt['clean_attach'] = 'Clear attachment';
 $txt['attached'] = 'Attached';
 $txt['allowed_types'] = 'Allowed file types';
-$txt['cant_upload_type'] = 'You cannot upload that type of file. The only allowed extensions are';
+$txt['cant_upload_type'] = 'You cannot upload that type of file. The only allowed extensions are %1$s.';
 $txt['uncheck_unwatchd_attach'] = 'Uncheck the attachments you no longer want attached';
 $txt['restricted_filename'] = 'That is a restricted filename. Please try a different filename.';
-$txt['topic_locked_no_reply'] = 'Warning: topic is currently/will be locked!<br />Only admins and moderators can reply.';
+$txt['topic_locked_no_reply'] = 'Warning! This topic is currently/will be locked<br>Only admins and moderators can reply.';
 $txt['awaiting_approval'] = 'Awaiting approval';
 $txt['attachment_requires_approval'] = 'Note that any files attached will not be displayed until approved by a moderator.';
 $txt['error_temp_attachments'] = 'There are attachments found, which you have attached before but not posted. These attachments are now attached to this post. If you do not want to include them in this post, you can remove them <a href="#postAttachment">here</a>.';
@@ -115,18 +65,26 @@
 $txt['board_moderate'] = 'on a board you moderate';
 $txt['report_comment'] = 'The reporter has made the following comment';
 
-$txt['attach_restrict_attachmentPostLimit'] = 'maximum total size %1$dKB';
-$txt['attach_restrict_attachmentSizeLimit'] = 'maximum individual size %1$dKB';
+// Use numeric entities in the below three strings.
+$txt['report_profile'] = 'Report profile of \'%1$s\'';
+$txt['reported_profile'] = 'Reported user';
+$txt['report_following_user'] = 'The profile of "%1$s" at %2$s';
+
+$txt['attach_restrict_attachmentPostLimit'] = 'maximum total size %1$d KB';
+$txt['attach_restrict_attachmentPostLimit_MB'] = 'maximum total size %1$d MB';
+$txt['attach_restrict_attachmentSizeLimit'] = 'maximum individual size %1$d KB';
+$txt['attach_restrict_attachmentSizeLimit_MB'] = 'maximum individual size %1$d MB';
 $txt['attach_restrict_attachmentNumPerPostLimit'] = '%1$d per post';
 $txt['attach_restrictions'] = 'Restrictions:';
 
-$txt['post_additionalopt'] = 'Attachments and other options';
+$txt['post_additionalopt_attach'] = 'Attachments and other options';
+$txt['post_additionalopt'] = 'Other options';
 $txt['sticky_after'] = 'Sticky this topic.';
 $txt['move_after2'] = 'Move this topic.';
 $txt['back_to_topic'] = 'Return to this topic.';
-$txt['approve_this_post'] = 'Approve this Post';
+$txt['approve_this_post'] = 'Approve this post';
 
-$txt['retrieving_quote'] = 'Retrieving Quote...';
+$txt['retrieving_quote'] = 'Retrieving quote...';
 
 $txt['post_visual_verification_label'] = 'Verification';
 $txt['post_visual_verification_desc'] = 'Please enter the code in the image above to make this post.';
@@ -140,7 +98,7 @@
 $txt['poll_results_after'] = 'Only show the results after the poll has expired.';
 $txt['poll_max_votes'] = 'Maximum votes per user';
 $txt['poll_do_change_vote'] = 'Allow users to change vote';
-$txt['poll_too_many_votes'] = 'You selected too many options.  For this poll, you may only select %1$s options.';
+$txt['poll_too_many_votes'] = 'You selected too many options. For this poll, you may only select %1$s options.';
 $txt['poll_add_option'] = 'Add Option';
 $txt['poll_guest_vote'] = 'Allow guests to vote';
 
@@ -166,6 +124,11 @@
 $txt['error_new_reply_reading'] = 'Warning - while you were reading a new reply has been posted. You may wish to review your post.';
 $txt['error_new_replies_reading'] = 'Warning - while you were reading %1$d new replies have been posted. You may wish to review your post.';
 
+$txt['error_topic_locked'] = 'Warning - while you were typing the topic was locked. Please check the "Lock this topic" box under "Attachments and other options" below if you do not wish to undo this action.';
+$txt['error_topic_unlocked'] = 'Warning - while you were typing the topic was locked. Please uncheck the "Lock this topic" box under "Attachments and other options" below if you do not wish to undo this action.';
+$txt['error_topic_stickied'] = 'Warning - while you were typing the topic was stickied. Please check the "Sticky this topic" box under "Attachments and other options" below if you do not wish to undo this action.';
+$txt['error_topic_unstickied'] = 'Warning - while you were typing the topic was unstickied. Please uncheck the "Sticky this topic" box under "Attachments and Other Options" below if you do not wish to undo this action.';
+
 $txt['announce_this_topic'] = 'Send an announcement about this topic to the members:';
 $txt['announce_title'] = 'Send an announcement';
 $txt['announce_desc'] = 'This form allows you to send an announcement to the selected membergroups about this topic.';
@@ -193,4 +156,41 @@
 $txt['digest_mod_act_merge'] = '"%1$s" was merged';
 $txt['digest_mod_act_split'] = '"%1$s" was split';
 
+$txt['attach_error_title'] = 'Error uploading attachments.';
+$txt['attach_warning'] = 'There was a problem during the uploading of <strong>%1$s</strong>.';
+$txt['attach_check_nag'] = 'Unable to continue due to incomplete data (%1$s).';
+$txt['attach_max_total_file_size'] = 'Sorry, you are out of attachment space. The total attachment size allowed per post is %1$s KB. Space remaining is %2$s kB.';
+$txt['attach_folder_warning'] = 'The attachments directory can not be located. Please notify an administrator of this problem.';
+$txt['attach_folder_admin_warning'] = 'The path to the attachments directory (%1$s) is incorrect. Please correct it in the attachment settings area of your admin panel.';
+$txt['attach_limit_nag'] = 'You have reached the maximum number of attachments allowed per post.';
+$txt['attach_no_upload'] = 'There was a problem and your attachments could not be uploaded';
+$txt['attach_remaining'] = '%1$d remaining';
+$txt['attach_available'] = '%1$s KB available';
+$txt['attach_kb'] = ' (%1$s KB)';
+$txt['attach_0_byte_file'] = 'The file appears to be empty. Please contact your forum administrator if this continues to be a problem';
+$txt['attached_files_in_session'] = '<em>The above underlined file(s) have been uploaded but will not be attached to this post until it is submitted.</em>';
+
+$txt['attach_php_error'] = 'Due to an error, your attachment could not be uploaded. Please contact the forum administrator if this problem continues.';
+$txt['php_upload_error_1'] = 'The uploaded file exceeds the upload_max_filesize directive in php.ini. Please contact your host if you are unable to correct this issue.';
+$txt['php_upload_error_3'] = 'The uploaded file was only partially uploaded. This is a PHP related error. Please contact your host if this problem continues.';
+$txt['php_upload_error_4'] = 'No file was uploaded. This is a PHP related error. Please contact your host if this problem continues.';
+$txt['php_upload_error_6'] = 'Unable to save. Missing a temporary directory. Please contact your host if you are unable to correct this problem.';
+$txt['php_upload_error_7'] = 'Failed to write file to disk. This is a PHP related error. Please contact your host if this problem continues.';
+$txt['php_upload_error_8'] = 'A PHP extension stopped the file upload. This is a PHP related error. Please contact your host if this problem continues.';
+$txt['error_temp_attachments_new'] = 'There are attachments which you had previously attached but not posted. These attachments are still attached to this post. This post does need to be submitted before these attachments are either saved or removed. You can do that <a href="#postAttachment">here</a>';
+$txt['error_temp_attachments_found'] = 'The following attachments were found which you had previously attached to another post but not posted. It is advisable that you do not post until these are either removed or that post has been submitted.<br>Click <a href="%1$s">here</a> to remove those attachments. Or <a href="%2$s">here</a> to return to that post.%3$s';
+$txt['error_temp_attachments_lost'] = 'The following attachments were found which you had previously attached to another post but not posted. It is advisable that you do not upload any more attachments until these are removed or that post has been submitted.<br>Click <a href="%1$s">here</a> to remove these attachments.%2$s';
+$txt['error_temp_attachments_gone'] = 'Those attachments have now been removed and you have been returned to the page you were previously on';
+$txt['error_temp_attachments_flushed'] = 'Please note that any files which had been previously attached but not posted have now been removed.';
+$txt['error_topic_already_announced'] = 'Please note that this topic has already been announced.';
+
+$txt['cant_access_upload_path'] = 'Cannot access attachments upload path!';
+$txt['file_too_big'] = 'Your file is too large. The maximum attachment size allowed is %1$d KB.';
+$txt['attach_timeout'] = 'Your attachment couldn\'t be saved. This might happen because it took too long to upload or the file is bigger than the server will allow.<br><br>Please consult your server administrator for more information.';
+$txt['bad_attachment'] = 'Your attachment has failed security checks and cannot be uploaded. Please consult the forum administrator.';
+$txt['ran_out_of_space'] = 'The upload directory is full. Please contact an administrator about this problem.';
+$txt['attachments_no_write'] = 'The attachments upload directory is not writable. Your attachment or avatar cannot be saved.';
+$txt['attachments_no_create'] = 'Unable to create a new attachment directory. Your attachment or avatar cannot be saved.';
+$txt['attachments_limit_per_post'] = 'You may not upload more than %1$d attachments per post';
+
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Profile.english.php b/Themes/default/languages/Profile.english.php
--- a/Themes/default/languages/Profile.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Profile.english.php	2015-03-05 23:33:03.409394841 -0800
@@ -1,17 +1,24 @@
 <?php
-// Version: 2.0; Profile
+// Version: 2.1 Beta 1; Profile
 
 global $scripturl, $context;
 
+// Some of the things from the popup need their own descriptions
+$txt['popup_summary'] = 'My Profile';
+$txt['popup_showposts'] = 'My Posts';
+$txt['popup_ignore'] = 'Ignore People';
+
 $txt['no_profile_edit'] = 'You are not allowed to change this person\'s profile.';
 $txt['website_title'] = 'Website title';
 $txt['website_url'] = 'Website URL';
 $txt['signature'] = 'Signature';
 $txt['profile_posts'] = 'Posts';
 $txt['change_profile'] = 'Change profile';
+$txt['preview_signature'] = 'Preview signature';
+$txt['current_signature'] = 'Current signature';
+$txt['signature_preview'] = 'Signature preview';
 $txt['delete_user'] = 'Delete user';
 $txt['current_status'] = 'Current Status:';
-$txt['personal_text'] = 'Personal Text';
 $txt['personal_picture'] = 'Personalized Picture';
 $txt['no_avatar'] = 'No avatar';
 $txt['choose_avatar_gallery'] = 'Choose avatar from gallery';
@@ -22,10 +29,14 @@
 $txt['no_pic'] = '(no pic)';
 $txt['latest_posts'] = 'Latest posts of: ';
 $txt['additional_info'] = 'Additional Information';
-$txt['avatar_by_url'] = 'Specify your own avatar by URL. (e.g.: <em>http://www.mypage.com/mypic.gif</em>)';
+$txt['avatar_by_url'] = 'Specify your own avatar by URL. (e.g.: <em>http://www.mypage.com/mypic.png</em>)';
 $txt['my_own_pic'] = 'Specify avatar by URL';
+$txt['use_gravatar'] = 'Use my Gravatar';
+$txt['gravatar_alternateEmail'] = 'Normally, the Gravatar used will be based on your regular email address but if you wish to use the Gravatar from a different email account to your regular forum account (say, the Gravatar from your blog\'s email account), you can enter that email address here.';
+$txt['gravatar_noAlternateEmail'] = 'The Gravatar displayed will be the one based on your account\'s email address.';
 $txt['date_format'] = 'The format here will be used to show dates throughout this forum.';
 $txt['time_format'] = 'Time Format';
+$txt['timezone'] = 'Timezone';
 $txt['display_name_desc'] = 'This is the displayed name that people will see.';
 $txt['personal_time_offset'] = 'Number of hours to +/- to make displayed time equal to your local time.';
 $txt['dob'] = 'Birthdate';
@@ -35,50 +46,45 @@
 $txt['password_strength'] = 'For best security, you should use eight or more characters with a combination of letters, numbers, and symbols.';
 $txt['include_website_url'] = 'This must be included if you specify a URL below.';
 $txt['complete_url'] = 'This must be a complete URL.';
-$txt['your_icq'] = 'This is your ICQ number.';
-$txt['your_aim'] = 'This is your AOL Instant Messenger nickname.';
-$txt['your_yim'] = 'This is your Yahoo! Instant Messenger nickname.';
 $txt['sig_info'] = 'Signatures are displayed at the bottom of each post or personal message. BBCode and smileys may be used in your signature.';
+$txt['no_signature_set'] = 'No signature set.';
+$txt['no_signature_preview'] = 'No signature to preview.';
 $txt['max_sig_characters'] = 'Max characters: %1$d; characters remaining: ';
 $txt['send_member_pm'] = 'Send this member a personal message';
 $txt['hidden'] = 'hidden';
 $txt['current_time'] = 'Current forum time';
-$txt['digits_only'] = 'The \'number of posts\' box can only contain digits.';
+
+$txt['skype_username'] = 'Your Skype Username.';
 
 $txt['language'] = 'Language';
 $txt['avatar_too_big'] = 'Avatar image is too big, please resize it and try again (max';
 $txt['invalid_registration'] = 'Invalid Date Registered value, valid example:';
-$txt['msn_email_address'] = 'Your MSN messenger email address';
 $txt['current_password'] = 'Current Password';
 // Don't use entities in the below string, except the main ones. (lt, gt, quot.)
 $txt['required_security_reasons'] = 'For security reasons, your current password is required to make changes to your account.';
+$txt['email_change_logout'] = 'Since you decided to change your email, you will need to reactivate your account. You will now be logged out.';
 
-$txt['timeoffset_autodetect'] = '(auto detect)';
+$txt['timeoffset_autodetect'] = 'auto detect';
 
 $txt['secret_question'] = 'Secret Question';
 $txt['secret_desc'] = 'To help retrieve your password, enter a question here with an answer that <strong>only</strong> you know.';
 $txt['secret_desc2'] = 'Choose carefully, you wouldn\'t want someone guessing your answer!';
 $txt['secret_answer'] = 'Answer';
 $txt['secret_ask'] = 'Ask me my question';
-$txt['cant_retrieve'] = 'You can\'t retrieve your password, but you can set a new one by following a link sent to you by email.  You also have the option of setting a new password by answering your secret question.';
-$txt['incorrect_answer'] = 'Sorry, but you did not specify a valid combination of Secret Question and Answer in your profile.  Please click on the back button, and use the default method of obtaining your password.';
-$txt['enter_new_password'] = 'Please enter the answer to your question, and the password you would like to use.  Your password will be changed to the one you select provided you answer the question correctly.';
-$txt['password_success'] = 'Your password was changed successfully.<br />Click <a href="' . $scripturl . '?action=login">here</a> to login.';
+$txt['cant_retrieve'] = 'You can\'t retrieve your password, but you can set a new one by following a link sent to you by email. You also have the option of setting a new password by answering your secret question.';
+$txt['incorrect_answer'] = 'Sorry, but you did not specify a valid combination of Secret Question and Answer in your profile. Please click on the back button, and use the default method of obtaining your password.';
+$txt['enter_new_password'] = 'Please enter the answer to your question, and the password you would like to use. Your password will be changed to the one you select provided you answer the question correctly.';
+$txt['password_success'] = 'Your password was changed successfully.<br>Click <a href="' . $scripturl . '?action=login">here</a> to login.';
 $txt['secret_why_blank'] = 'why is this blank?';
 
 $txt['authentication_reminder'] = 'Authentication Reminder';
 $txt['password_reminder_desc'] = 'If you\'ve forgotten your login details, don\'t worry, they can be retrieved. To start this process please enter your username or email address below.';
-$txt['authentication_options'] = 'Please select one of the two options below';
-$txt['authentication_openid_email'] = 'Email me a reminder of my OpenID identity';
-$txt['authentication_openid_secret'] = 'Answer my &quot;secret question&quot; to display my OpenID identity';
 $txt['authentication_password_email'] = 'Email me a new password';
 $txt['authentication_password_secret'] = 'Let me set a new password by answering my &quot;secret question&quot;';
-$txt['openid_secret_reminder'] = 'Please enter your answer to the question below. If you get it correct your OpenID identity will be shown.';
-$txt['reminder_openid_is'] = 'The OpenID identity associated with your account is:<br />&nbsp;&nbsp;&nbsp;&nbsp;<strong>%1$s</strong><br /><br />Please make a note of this for future reference.';
 $txt['reminder_continue'] = 'Continue';
 
 $txt['current_theme'] = 'Current Theme';
-$txt['change'] = '(change)';
+$txt['change'] = 'change';
 $txt['theme_preferences'] = 'Theme preferences';
 $txt['theme_forum_default'] = 'Forum or Board Default';
 $txt['theme_forum_default_desc'] = 'This is the default theme, which means your theme will change along with the administrator\'s settings and the board you are viewing.';
@@ -89,6 +95,14 @@
 
 $txt['lastLoggedIn'] = 'Last Active';
 
+$txt['alert_prefs'] = 'Notification Preferences';
+$txt['alert_prefs_desc'] = 'This page will allow you to configure when and how you get notified about new content.';
+$txt['watched_topics'] = 'Watched Topics';
+$txt['watched_topics_desc'] = 'This page lets you review which topics you are watching; when topics that you are watching have been replied to, you can be notified.';
+$txt['watched_boards'] = 'Watched Boards';
+$txt['watched_boards_desc'] = 'This page lets you review which boards you are watching; when boards that you are watching have new topics, you can be notified.';
+
+$txt['notification_general'] = 'General Settings';
 $txt['notify_settings'] = 'Notification Settings:';
 $txt['notify_save'] = 'Save settings';
 $txt['notify_important_email'] = 'Receive forum newsletters, announcements and important notifications by email.';
@@ -100,10 +114,52 @@
 $txt['auto_notify'] = 'Turn notification on when you post or reply to a topic.';
 $txt['notify_send_types'] = 'For topics and boards I\'ve requested notification on, notify me of';
 $txt['notify_send_type_everything'] = 'Replies and moderation';
-$txt['notify_send_type_everything_own'] = 'Moderation only if I started the topic';
+$txt['notify_send_type_everything_own'] = 'Moderation only if I started the topic and am following it';
 $txt['notify_send_type_only_replies'] = 'Only replies';
 $txt['notify_send_type_nothing'] = 'Nothing at all';
 $txt['notify_send_body'] = 'When sending notification of a reply to a topic, send the post in the email (but please don\'t reply to these emails.)';
+$txt['notify_alert_timeout'] = 'Timeout for Alert desktop notifications';
+
+$txt['notify_what_how'] = 'Alert Preferences';
+$txt['receive_alert'] = 'Receive alert';
+$txt['receive_mail'] = 'Receive email';
+$txt['alert_group_board'] = 'Boards and Topics';
+$txt['alert_group_msg'] = 'Posts';
+$txt['alert_opt_pm_notify'] = 'If enabled, e-mail alerts for:';
+$txt['alert_opt_msg_notify_type'] = 'Notify me of:';
+$txt['alert_opt_msg_auto_notify'] = 'Follow topics I create and reply to';
+$txt['alert_opt_msg_receive_body'] = 'Receive message body in e-mails';
+$txt['alert_opt_msg_notify_pref'] = 'How frequently to tell me:';
+$txt['alert_opt_msg_notify_pref_nothing'] = 'Nothing, just make a note of it';
+$txt['alert_opt_msg_notify_pref_instant'] = 'Straight away';
+$txt['alert_opt_msg_notify_pref_first'] = 'Straight away (but only for the first unread message)';
+$txt['alert_opt_msg_notify_pref_daily'] = 'Send me a daily email digest';
+$txt['alert_opt_msg_notify_pref_weekly'] = 'Send me a weekly email digest';
+$txt['alert_topic_notify'] = 'When a topic I follow gets a reply, I normally want to know via...';
+$txt['alert_board_notify'] = 'When a board I follow gets a topic, I normally want to know via...';
+$txt['alert_msg_mention'] = 'When my @name is mentioned in a post';
+$txt['alert_msg_quote'] = 'When a post of mine is quoted (when I\'m not already watching that topic)';
+$txt['alert_msg_like'] = 'When a message of mine is liked';
+$txt['alert_unapproved_reply'] = 'When an reply is made to my unapproved topic';
+$txt['alert_group_pm'] = 'Personal Messages';
+$txt['alert_pm_new'] = 'When I receive a new personal message';
+$txt['alert_pm_reply'] = 'When a personal message I sent gets replied to';
+$txt['alert_group_moderation'] = 'Moderation';
+$txt['alert_unapproved_post'] = 'When an unapproved topic is created';
+$txt['alert_msg_report'] = 'When a message is reported';
+$txt['alert_msg_report_reply'] = 'When a post report I\'ve replied to gets replied to';
+$txt['alert_group_members'] = 'Members';
+$txt['alert_member_register'] = 'When a new person registers';
+$txt['alert_warn_any'] = 'When other members receive a warning';
+$txt['alert_group_calendar'] = 'Calendar';
+$txt['alert_event_new'] = 'When a new event goes into the calendar';
+$txt['alert_request_group'] = 'When someone requests to join a group I moderate';
+$txt['alert_member_report'] = 'When another member\'s profile is reported';
+$txt['alert_member_report_reply'] = 'When a member report I\'ve replied to gets replied to';
+$txt['alert_group_paidsubs'] = 'Paid Subscriptions';
+$txt['alert_paidsubs_expiring'] = 'When your Paid Subscriptions are about to expire';
+$txt['toggle_all'] = 'toggle all';
+
 
 $txt['notifications_topics'] = 'Current Topic Notifications';
 $txt['notifications_topics_list'] = 'You are being notified of replies to the following topics';
@@ -139,9 +195,9 @@
 $txt['deleteAccount_desc'] = 'From this page you can delete this user\'s account and posts.';
 $txt['deleteAccount_member'] = 'Delete this member\'s account';
 $txt['deleteAccount_posts'] = 'Remove posts made by this member';
-$txt['deleteAccount_none'] = 'None';
-$txt['deleteAccount_all_posts'] = 'All Posts';
+$txt['deleteAccount_all_posts'] = 'Replies to Topics';
 $txt['deleteAccount_topics'] = 'Topics and Posts';
+$txt['deleteAccount_votes'] = 'Remove poll votes made by this member';
 $txt['deleteAccount_confirm'] = 'Are you completely sure you want to delete this account?';
 $txt['deleteAccount_approval'] = 'Please note that the forum moderators will have to approve this account\'s deletion before it will be removed.';
 
@@ -151,30 +207,30 @@
 $txt['showPosts_help'] = 'This section allows you to view all posts made by this member. Note that you can only see posts made in areas you currently have access to.';
 $txt['showMessages'] = 'Messages';
 $txt['showTopics'] = 'Topics';
+$txt['showUnwatched'] = 'Unwatched topics';
 $txt['showAttachments'] = 'Attachments';
+$txt['viewWarning_help'] = 'This section allows you to view all warnings issued to this member.';
 $txt['statPanel'] = 'Show Stats';
 $txt['editBuddyIgnoreLists'] = 'Buddies/Ignore List';
+$txt['could_not_add_person'] = 'You could not add that person to your list';
+$txt['could_not_remove_person'] = 'You could not remove that person from your list';
 $txt['editBuddies'] = 'Edit Buddies';
 $txt['editIgnoreList'] = 'Edit Ignore List';
 $txt['trackUser'] = 'Track User';
 $txt['trackActivity'] = 'Activity';
 $txt['trackIP'] = 'IP Address';
+$txt['trackLogins'] = 'Logins';
 
-$txt['authentication'] = 'Authentication';
-$txt['change_authentication'] = 'From this section you can change how you login to the forum. You may choose to either use an OpenID account for your authentication, or alternatively switch to use a username and password.';
-
-$txt['profileEdit'] = 'Modify Profile';
 $txt['account_info'] = 'These are your account settings. This page holds all critical information that identifies you on this forum. For security reasons, you will need to enter your (current) password to make changes to this information.';
 $txt['forumProfile_info'] = 'You can change your personal information on this page. This information will be displayed throughout ' . $context['forum_name_html_safe'] . '. If you aren\'t comfortable with sharing some information, simply skip it - nothing here is required.';
-$txt['theme'] = 'Look and Layout';
 $txt['theme_info'] = 'This section allows you to customize the look and layout of the forum.';
 $txt['notification'] = 'Notifications';
 $txt['notification_info'] = 'SMF allows you to be notified of replies to posts, newly posted topics, and forum announcements. You can change those settings here, or oversee the topics and boards you are currently receiving notifications for.';
 $txt['groupmembership'] = 'Group Membership';
 $txt['groupMembership_info'] = 'In this section of your profile you can change which groups you belong to.';
-$txt['ignoreboards'] = 'Ignore Boards Options';
-$txt['ignoreboards_info'] = 'This page lets you ignore particular boards.  When a board is ignored, the new post indicator will not show up on the board index.  New posts will not show up using the "unread post" search link (when searching it will not look in those boards) however, ignored boards will still appear on the board index and upon entering will show which topics have new posts.  When using the "unread replies" link, new posts in an ignored board will still be shown.';
-$txt['pmprefs'] = 'Personal Messaging';
+$txt['ignoreboards'] = 'Ignore Boards';
+$txt['ignoreboards_info'] = 'This page lets you ignore particular boards. When a board is ignored, the new post indicator will not show up on the board index. New posts will not show up using the "unread post" search link (when searching it will not look in those boards) however, ignored boards will still appear on the board index and upon entering will show which topics have new posts. When using the "unread replies" link, new posts in an ignored board will still be shown.';
+$txt['alerts_show'] = 'Show Alerts';
 
 $txt['profileAction'] = 'Actions';
 $txt['deleteAccount'] = 'Delete this account';
@@ -196,20 +252,22 @@
 $txt['members_in_range'] = 'Members possibly in the same range';
 $txt['messages_from_ip'] = 'Messages posted from IP (range)';
 $txt['messages_from_ip_desc'] = 'Below is a list of all messages posted from this IP (range).';
+$txt['trackLogins_desc'] = 'Below is a list of all times this account was logged into.';
 $txt['most_recent_ip'] = 'Most recent IP address';
 $txt['why_two_ip_address'] = 'Why are there two IP addresses listed?';
 $txt['no_errors_from_ip'] = 'No error messages from the specified IP (range) found';
 $txt['no_errors_from_user'] = 'No error messages from the specified user found';
 $txt['no_members_from_ip'] = 'No members from the specified IP (range) found';
 $txt['no_messages_from_ip'] = 'No messages from the specified IP (range) found';
+$txt['trackLogins_none_found'] = 'No recent logins were found';
 $txt['none'] = 'None';
 $txt['own_profile_confirm'] = 'Are you sure you want to delete your account?';
 $txt['view_ips_by'] = 'View IPs used by';
 
 $txt['avatar_will_upload'] = 'Upload an avatar';
-
-$txt['activate_changed_email_title'] = 'Email Address Changed';
-$txt['activate_changed_email_desc'] = 'You\'ve changed your email address. In order to validate this address you will receive an email. Click the link in that email to reactivate your account.';
+$txt['avatar_max_size_wh'] = 'Max size: %1$spx by %2$spx';
+$txt['avatar_max_size_w'] = 'Max size: %1$spx wide';
+$txt['avatar_max_size_h'] = 'Max size: %2$spx high';
 
 // Use numeric entities in the below three strings.
 $txt['no_reminder_email'] = 'Unable to send reminder email.';
@@ -222,17 +280,16 @@
 $txt['reminder_subject'] = 'New password for ' . $context['forum_name'];
 $txt['reminder_mail'] = 'This mail was sent because the \'forgot password\' function has been applied to your account. To set a new password, click the following link';
 $txt['reminder_sent'] = 'A mail has been sent to your email address. Click the link in that mail to set a new password.';
-$txt['reminder_openid_sent'] = 'Your current OpenID identity has been sent to your email address.';
 $txt['reminder_set_password'] = 'Set Password';
 $txt['reminder_password_set'] = 'Password successfully set';
 $txt['reminder_error'] = '%1$s failed to answer their secret question correctly when attempting to change a forgotten password.';
 
-$txt['registration_not_approved'] = 'Sorry, this account has not yet been approved. If you need to change your email address please click';
-$txt['registration_not_activated'] = 'Sorry, this account has not yet been activated. If you need to resend the activation email please click';
+$txt['registration_not_approved'] = 'Sorry, this account has not yet been approved. If you need to change your email address please click <a href="%1$s">here</a>.';
+$txt['registration_not_activated'] = 'Sorry, this account has not yet been activated. If you need to resend the activation email please click <a href="%1$s">here</a>';
 
 $txt['primary_membergroup'] = 'Primary Membergroup';
 $txt['additional_membergroups'] = 'Additional Membergroups';
-$txt['additional_membergroups_show'] = '[ show additional groups ]';
+$txt['additional_membergroups_show'] = 'show additional groups';
 $txt['no_primary_membergroup'] = '(no primary membergroup)';
 $txt['deadmin_confirm'] = 'Are you sure you wish to irrevocably remove your admin status?';
 
@@ -255,9 +312,8 @@
 $txt['show_online'] = 'Show others my online status';
 
 $txt['return_to_post'] = 'Return to topics after posting by default.';
-$txt['no_new_reply_warning'] = 'Don\'t warn on new replies made while posting.';
 $txt['posts_apply_ignore_list'] = 'Hide messages posted by members on my ignore list.';
-$txt['recent_posts_at_top'] = 'Show most recent posts at the top.';
+$txt['recent_posts_at_top'] = 'Show most recent posts at the top in topic view.';
 $txt['recent_pms_at_top'] = 'Show most recent personal messages at top.';
 $txt['wysiwyg_default'] = 'Show WYSIWYG editor on post page by default.';
 
@@ -270,9 +326,7 @@
 
 $txt['poster'] = 'Poster';
 
-$txt['board_desc_inside'] = 'Show board descriptions inside boards.';
-$txt['show_children'] = 'Show child boards on every page inside boards, not just the first.';
-$txt['use_sidebar_menu'] = 'Use sidebar menus instead of dropdown menus when possible.';
+$txt['show_children'] = 'Show sub-boards on every page inside boards, not just the first.';
 $txt['show_no_avatars'] = 'Don\'t show users\' avatars.';
 $txt['show_no_signatures'] = 'Don\'t show users\' signatures.';
 $txt['show_no_censored'] = 'Leave words uncensored.';
@@ -280,14 +334,11 @@
 $txt['messages_per_page'] = 'Messages to display per page:';
 $txt['per_page_default'] = 'forum default';
 $txt['calendar_start_day'] = 'First day of the week on the calendar';
-$txt['display_quick_reply'] = 'Use quick reply on topic display: ';
-$txt['display_quick_reply1'] = 'don\'t show at all';
-$txt['display_quick_reply2'] = 'show, off by default';
-$txt['display_quick_reply3'] = 'show, on by default';
-$txt['display_quick_mod'] = 'Show quick-moderation as ';
-$txt['display_quick_mod_none'] = 'don\'t show.';
-$txt['display_quick_mod_check'] = 'checkboxes.';
-$txt['display_quick_mod_image'] = 'icons.';
+$txt['use_editor_quick_reply'] = 'Use full editor in Quick Reply';
+$txt['display_quick_mod'] = 'Show quick-moderation as';
+$txt['display_quick_mod_none'] = 'don\'t show';
+$txt['display_quick_mod_check'] = 'checkboxes';
+$txt['display_quick_mod_image'] = 'icons';
 
 $txt['whois_title'] = 'Look up IP on a regional whois-server';
 $txt['whois_afrinic'] = 'AfriNIC (Africa)';
@@ -305,6 +356,7 @@
 $txt['show_member_attachments'] = 'View Member Attachments';
 $txt['show_posts_none'] = 'No posts have been posted yet.';
 $txt['show_topics_none'] = 'No topics have been posted yet.';
+$txt['unwatched_topics_none'] = 'You don\'t have any topic in the unwatched list.';
 $txt['show_attachments_none'] = 'No attachments have been posted yet.';
 $txt['show_attach_filename'] = 'Filename';
 $txt['show_attach_downloads'] = 'Downloads';
@@ -341,7 +393,7 @@
 $txt['no_ignore'] = 'Your ignore list is currently empty';
 
 $txt['regular_members'] = 'Registered Members';
-$txt['regular_members_desc'] = 'Every member of the forum is a member of this group.';
+$txt['regular_members_desc'] = 'Every member of the forum, without a different badge or title, is a member of this group.';
 $txt['group_membership_msg_free'] = 'Your group membership was successfully updated.';
 $txt['group_membership_msg_request'] = 'Your request has been submitted, please be patient while the request is considered.';
 $txt['group_membership_msg_primary'] = 'Your primary group has been updated';
@@ -358,7 +410,7 @@
 $txt['submit_request'] = 'Submit Request';
 
 $txt['profile_updated_own'] = 'Your profile has been updated successfully.';
-$txt['profile_updated_else'] = 'The profile for %1$s has been updated successfully.';
+$txt['profile_updated_else'] = 'The profile of %1$s has been updated successfully.';
 
 $txt['profile_error_signature_max_length'] = 'Your signature cannot be greater than %1$d characters';
 $txt['profile_error_signature_max_lines'] = 'Your signature cannot span more than %1$d lines';
@@ -421,7 +473,7 @@
 
 $txt['viewwarning'] = 'View Warnings';
 $txt['profile_viewwarning_for_user'] = 'Warnings for %1$s';
-$txt['profile_viewwarning_no_warnings'] = 'No warnings have yet been issued.';
+$txt['profile_viewwarning_no_warnings'] = 'No warnings have been issued.';
 $txt['profile_viewwarning_desc'] = 'Below is a summary of all the warnings that have been issued by the forum moderation team.';
 $txt['profile_viewwarning_previous_warnings'] = 'Previous Warnings';
 $txt['profile_viewwarning_impact'] = 'Warning Impact';
@@ -430,9 +482,8 @@
 
 $txt['pm_settings_desc'] = 'From this page you can change a variety of personal messaging options, including how messages are displayed and who may send them to you.';
 $txt['email_notify'] = 'Notify by email every time you receive a personal message:';
-$txt['email_notify_never'] = 'Never';
-$txt['email_notify_buddies'] = 'From Buddies Only';
-$txt['email_notify_always'] = 'Always';
+$txt['email_notify_buddies'] = 'Buddies Only';
+$txt['email_notify_all'] = 'All members';
 
 $txt['pm_receive_from'] = 'Receive personal messages from:';
 $txt['pm_receive_from_everyone'] = 'All members';
@@ -440,18 +491,15 @@
 $txt['pm_receive_from_admins'] = 'Administrators only';
 $txt['pm_receive_from_buddies'] = 'Buddies and Administrators only';
 
-$txt['copy_to_outbox'] = 'Save a copy of each personal message in my sent items by default.';
 $txt['popup_messages'] = 'Show a popup when I receive new messages.';
 $txt['pm_remove_inbox_label'] = 'Remove the inbox label when applying another label';
 $txt['pm_display_mode'] = 'Display personal messages';
 $txt['pm_display_mode_all'] = 'All at once';
 $txt['pm_display_mode_one'] = 'One at a time';
 $txt['pm_display_mode_linked'] = 'As a conversation';
-// Use entities in the below string.
-$txt['pm_recommend_enable_outbox'] = 'To make the most of this setting we suggest you enable &quot;Save a copy of each Personal Message in my sent items by default&quot;\\n\\nThis will help ensure that the conversations flow better as you can see both sides of the conversation.';
 
 $txt['tracking'] = 'Tracking';
-$txt['tracking_description'] = 'This section allows you to review certain profile actions performed on this member\'s profile as well as track their IP address.';
+$txt['tracking_description'] = 'This section allows you to review certain profile actions performed on this member\'s profile as well as track their IP address and login history.';
 
 $txt['trackEdits'] = 'Profile Edits';
 $txt['trackEdit_deleted_member'] = 'Deleted Member';
@@ -468,4 +516,44 @@
 $txt['trackEdit_action_id_group'] = 'Primary Membergroup';
 $txt['trackEdit_action_additional_groups'] = 'Additional Membergroups';
 
-?>
\ No newline at end of file
+$txt['trackGroupRequests'] = 'Group Requests';
+$txt['trackGroupRequests_title'] = 'Group Requests for %1$s';
+$txt['requested_group'] = 'Requested Group';
+$txt['requested_group_reason'] = 'Reason Given';
+$txt['requested_group_time'] = 'Date';
+$txt['requested_group_outcome'] = 'Outcome';
+$txt['requested_none'] = 'There are no requests made by this user.';
+$txt['outcome_pending'] = 'Open';
+$txt['outcome_approved'] = 'Approved by %1$s on %2$s';
+$txt['outcome_refused'] = 'Refused by %1$s on %2$s';
+$txt['outcome_refused_reason'] = 'Refused by %1$s on %2$s, reason given: %3$s';
+
+$txt['report_profile'] = 'Report This Member';
+$txt['notification_remove_pref'] = 'Use default preference';
+
+$txt['tfa_profile_label'] = 'Two-Factor Authentication';
+$txt['tfa_profile_desc'] = 'TFA allows you to have a secondary layer of security by assigning a dedicated device without which no one would be able to log into your account even if they have your username and password';
+$txt['tfa_profile_enable'] = 'Enable Two-Factor Authentication';
+$txt['tfa_profile_enabled'] = 'Two-Factor Authentication is enabled. <a href="%s">Disable</a>';
+$txt['tfa_profile_disabled'] = 'Two-Factor Authentication is disabled';
+$txt['tfa_title'] = 'Enable Two-Factor Authentication via compatible application';
+$txt['tfa_desc'] = 'In order to have Two-Factor Authentication, you would need a compatible app such as Google Authenticator on your device. Once you have enabled 2FA for your account, you will be required to enter a code on login via the paired device alongside your username and password in order to successfully login. After you have enabled 2FA, a backup code will be provided should you lose your paired device.';
+$txt['tfa_forced_desc'] = 'Administrator has forced 2FA to be enabled on all accounts, please enable 2FA here in order to resume';
+$txt['tfa_step1'] = '1. Enter your current password';
+$txt['tfa_step2'] = '2. Enter the secret';
+$txt['tfa_step2_desc'] = 'In order to setup the app, either scan the QR code on the right side or enter the following code manually: ';
+$txt['tfa_step3'] = '3. Enter the code generated by the app';
+$txt['tfa_enable'] = 'Enable';
+$txt['tfa_pass_invalid'] = 'Entered password is invalid, please try again';
+$txt['tfa_code_invalid'] = 'Entered code is invalid, please try again';
+$txt['tfa_backup_invalid'] = 'Entered backup code is invalid, please try again';
+$txt['tfa_backup_title'] = 'Save this Two-Factor Authentication Backup code somewhere safe!';
+$txt['tfa_backup_desc'] = 'If you lose your device, this code can be used to login again. You will not be able to see this code again, please save it somewhere secure now';
+$txt['tfa_backup_used_desc'] = 'Your backup code has been successfully entered and 2FA details have been reset, if you wish to use 2FA again you need to enable it from here';
+$txt['tfa_login_desc'] = 'Enter code generated by authenticating application from your paired device below';
+$txt['tfa_backup'] = 'Or use backup code';
+$txt['tfa_code'] = 'Code';
+$txt['tfa_backup_code'] = 'Backup code';
+$txt['tfa_backup_desc'] = 'In case you have lost your device or authentication app, you can use the backup code provided to you when 2FA was setup. In case you have lost that as well, please contact the administrator';
+$txt['tfa_wait'] = 'Please wait for about 2 minutes before attempting to log in via 2FA again';
+?>
diff -ru a/Themes/default/languages/Reports.english.php b/Themes/default/languages/Reports.english.php
--- a/Themes/default/languages/Reports.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Reports.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; Reports
+// Version: 2.1 Beta 1; Reports
 
 $txt['generate_reports_desc'] = 'From this section you can generate a variety of reports to assist in the administration of your forum. Simply follow the steps below to select the option of your choice.';
 $txt['generate_reports_continue'] = 'Continue';
@@ -31,8 +31,6 @@
 $txt['board_perms_name_lock_any'] = 'Lock any topic';
 $txt['board_perms_name_lock_own'] = 'Lock own topic';
 $txt['board_perms_name_make_sticky'] = 'Make topics sticky';
-$txt['board_perms_name_mark_any_notify'] = 'Request notification on any topic';
-$txt['board_perms_name_mark_notify'] = 'Request notification on own topics';
 $txt['board_perms_name_merge_any'] = 'Merge topics';
 $txt['board_perms_name_moderate_board'] = 'Moderate the board';
 $txt['board_perms_name_modify_any'] = 'Modify any post';
@@ -59,10 +57,11 @@
 $txt['board_perms_name_post_unapproved_topics'] = 'Post unapproved topics';
 $txt['board_perms_name_post_unapproved_replies_any'] = 'Post unapproved replies in any topic';
 $txt['board_perms_name_post_unapproved_replies_own'] = 'Post unapproved replies in own topic';
+$txt['board_perms_name_post_draft'] = 'Save drafts of posts';
+$txt['board_perms_name_post_autosave_draft'] = 'Automatically save drafts of posts';
 $txt['board_perms_name_remove_any'] = 'Remove any topic';
 $txt['board_perms_name_remove_own'] = 'Remove own topics';
 $txt['board_perms_name_report_any'] = 'Report any post';
-$txt['board_perms_name_send_topic'] = 'Send topics to friends';
 $txt['board_perms_name_split_any'] = 'Split any topics';
 $txt['board_perms_name_view_attachments'] = 'View attachments';
 
@@ -74,7 +73,7 @@
 $txt['member_group_color'] = 'Color';
 $txt['member_group_min_posts'] = 'Minimum Posts';
 $txt['member_group_max_messages'] = 'Max Personal Messages';
-$txt['member_group_stars'] = 'Stars';
+$txt['member_group_icons'] = 'Icons';
 $txt['member_group_settings'] = 'Settings';
 $txt['member_group_access'] = 'Board Access';
 
@@ -82,6 +81,7 @@
 $txt['none'] = 'None';
 $txt['board_category'] = 'Category';
 $txt['board_parent'] = 'Parent Board';
+$txt['board_redirect'] = 'Redirection Board, redirects to';
 $txt['board_num_topics'] = 'Number of Topics';
 $txt['board_num_posts'] = 'Number of Posts';
 $txt['board_count_posts'] = 'Count Posts';
@@ -89,7 +89,9 @@
 $txt['board_override_theme'] = 'Force Board Theme';
 $txt['board_profile'] = 'Permissions Profile';
 $txt['board_moderators'] = 'Moderators';
+$txt['board_moderator_groups'] = 'Moderator Groups';
 $txt['board_groups'] = 'Groups with Access';
+$txt['board_disallowed_groups'] = 'Groups with Access Denied';
 
 // Group Permissions.
 $txt['group_perms_name_access_mod_center'] = 'Access Moderation Center';
@@ -100,7 +102,6 @@
 $txt['group_perms_name_calendar_view'] = 'View events';
 $txt['group_perms_name_edit_news'] = 'Edit forum news';
 $txt['group_perms_name_issue_warning'] = 'Issue warnings';
-$txt['group_perms_name_karma_edit'] = 'Edit user karma';
 $txt['group_perms_name_manage_attachments'] = 'Manage attachments';
 $txt['group_perms_name_manage_bans'] = 'Manage bans';
 $txt['group_perms_name_manage_boards'] = 'Manage boards';
@@ -110,6 +111,8 @@
 $txt['group_perms_name_moderate_forum'] = 'Moderate the forum';
 $txt['group_perms_name_pm_read'] = 'Read personal messages';
 $txt['group_perms_name_pm_send'] = 'Send personal messages';
+$txt['group_perms_name_pm_draft'] = 'Save draft personal messages';
+$txt['group_perms_name_pm_autosave_draft'] = 'Automatically save draft personal messages';
 $txt['group_perms_name_profile_extra_any'] = 'Edit any additional options';
 $txt['group_perms_name_profile_extra_own'] = 'Edit own additional options';
 $txt['group_perms_name_profile_identity_any'] = 'Edit any account settings';
@@ -121,15 +124,14 @@
 $txt['group_perms_name_profile_remove_own'] = 'Delete own account';
 $txt['group_perms_name_profile_title_any'] = 'Edit any custom title';
 $txt['group_perms_name_profile_title_own'] = 'Edit own custom title';
-$txt['group_perms_name_profile_view_any'] = 'View any profile';
-$txt['group_perms_name_profile_view_own'] = 'View  own profile';
+$txt['group_perms_name_profile_view'] = 'View any user\'s profile';
 $txt['group_perms_name_search_posts'] = 'Search for posts';
-$txt['group_perms_name_send_mail'] = 'Send a forum email to members';
+$txt['group_perms_name_send_email_to_members'] = 'Send a forum email to members';
 $txt['group_perms_name_view_mlist'] = 'View the memberlist';
 $txt['group_perms_name_view_stats'] = 'View forum stats';
 $txt['group_perms_name_who_view'] = 'See who\'s online';
 
-$txt['report_error_too_many_staff'] = 'You have too many staff members. The report will not work with more than 300 members of staff!';
+$txt['report_error_too_many_staff'] = 'You have too many staff members. The report will not work with more than 300 staff members.';
 $txt['report_staff_position'] = 'Position';
 $txt['report_staff_moderates'] = 'Moderates';
 $txt['report_staff_posts'] = 'Posts';
diff -ru a/Themes/default/languages/Search.english.php b/Themes/default/languages/Search.english.php
--- a/Themes/default/languages/Search.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Search.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; Search
+// Version: 2.1 Beta 1; Search
 
 $txt['set_parameters'] = 'Set Search Parameters';
 $txt['choose_board'] = 'Choose a board to search in, or search all';
@@ -28,7 +28,6 @@
 
 $txt['mods_cat_search'] = 'Search';
 $txt['groups_search_posts'] = 'Membergroups with access to the search function';
-$txt['simpleSearch'] = 'Enable simple search';
 $txt['search_results_per_page'] = 'Number of search results per page';
 $txt['search_weight_frequency'] = 'Relative search weight for number of matching messages within a topic';
 $txt['search_weight_age'] = 'Relative search weight for age of last matching message';
@@ -38,7 +37,7 @@
 $txt['search_weight_sticky'] = 'Relative search weight for a sticky topic';
 
 $txt['search_settings_desc'] = 'Here you can changes the basic settings of the search function.';
-$txt['search_settings_title'] = 'Search function - settings';
+$txt['search_settings_title'] = 'Search Settings';
 
 $txt['search_weights_desc'] = 'Here you can change the individual components of the relevance rating. ';
 $txt['search_weights_title'] = 'Search - weights';
@@ -60,7 +59,7 @@
 $txt['search_method_index_partial'] = 'partially created';
 $txt['search_index_custom_resume'] = 'resume';
 // This string is used in a javascript confirmation popup; don't use entities.
-$txt['search_method_fulltext_warning'] = 'In order to be able to use fulltext search, you\\\'ll have to create a fulltext index first!';
+$txt['search_method_fulltext_warning'] = 'In order to be able to use fulltext search, you\\\'ll have to create a fulltext index first.';
 
 $txt['search_index'] = 'Search index';
 $txt['search_index_none'] = 'No index';
@@ -91,7 +90,7 @@
 $txt['search_create_index_continue'] = 'Continue';
 $txt['search_create_index_not_ready'] = 'SMF is currently creating a search index of your messages. To avoid overloading your server, the process has been temporarily paused. It should automatically continue in a few seconds. If it doesn\'t, please click continue below.';
 $txt['search_create_index_progress'] = 'Progress';
-$txt['search_create_index_done'] = 'Custom search index created!';
+$txt['search_create_index_done'] = 'Custom search index successfully created.';
 $txt['search_create_index_done_link'] = 'Continue';
 $txt['search_double_index'] = 'You have currently created two indexes on the messages table. For best performance it is advisable to remove one of the two indexes.';
 
@@ -100,20 +99,24 @@
 $txt['error_string_too_long'] = 'Search string must be less than %1$d characters long.';
 
 $txt['search_adjust_query'] = 'Adjust Search Parameters';
+$txt['search_warning_ignored_word'] = 'The following term has been ignored in your search because too short';
+$txt['search_warning_ignored_words'] = 'The following terms have been ignored in your search because too short';
 $txt['search_adjust_submit'] = 'Revise Search';
 $txt['search_did_you_mean'] = 'You may have meant to search for';
 
 $txt['search_example'] = '<em>e.g.</em> Orwell "Animal Farm" -movie';
 
 $txt['search_engines_description'] = 'From this area you can decide in what detail you wish to track search engines as they index your forum as well as review search engine logs.';
-$txt['spider_mode'] = 'Search Engine Tracking Level<div class="smalltext">Note higher level tracking increases server resource requirement.</div>';
+$txt['spider_mode'] = 'Search Engine Tracking Level';
+$txt['spider_mode_note'] = 'Note that logging of every spider action only occurs if tracking is set to either "high" or "very high". Detail of every spiders action is only logged if tracking is set to "very high".';
 $txt['spider_mode_off'] = 'Disabled';
-$txt['spider_mode_standard'] = 'Standard - Logs minimal spider activity.';
-$txt['spider_mode_high'] = 'High - Provides more accurate statistics.';
-$txt['spider_mode_vhigh'] = 'Very High - As for &quot;High&quot; but logs data about each page visited.';
+$txt['spider_mode_standard'] = 'Standard';
+$txt['spider_mode_high'] = 'Moderate';
+$txt['spider_mode_vhigh'] = 'Aggressive';
 $txt['spider_settings_desc'] = 'You can change settings for spider tracking from this page. Note, if you wish to enable automatic pruning of the hit logs you can set this up <a href="%1$s">here</a>';
 
-$txt['spider_group'] = 'Apply restrictive permissions from group<div class="smalltext">To enable you to stop spiders indexing some pages.</div>';
+$txt['spider_group'] = 'Apply restrictive permissions from group';
+$txt['spider_group_note'] = 'To enable you to stop spiders indexing some pages.';
 $txt['spider_group_none'] = 'Disabled';
 
 $txt['show_spider_online'] = 'Show spiders in the online list';
@@ -129,11 +132,11 @@
 $txt['spider_ip_info'] = 'IP Addresses';
 $txt['spiders_add'] = 'Add New Spider';
 $txt['spiders_edit'] = 'Edit Spider';
-$txt['spiders_remove_selected'] = 'Remove Selected Spiders';
-$txt['spider_remove_selected_confirm'] = 'Are you sure you wish to remove these spiders?\\n\\nAll associated statistics will also be deleted!';
+$txt['spiders_remove_selected'] = 'Remove Selected';
+$txt['spider_remove_selected_confirm'] = 'Are you sure you want to remove these spiders?\\n\\nAll associated statistics will also be deleted!';
 $txt['spiders_no_entries'] = 'There are currently no spiders configured.';
 
-$txt['add_spider_desc'] = 'From this page you can edit the parameters against which a spider is categorised. If a guest\'s user agent/IP address matches those entered below it will be detected as a search engine spider and tracked as per the forum preferences.';
+$txt['add_spider_desc'] = 'From this page you can edit the parameters against which a spider is categorized. If a guest\'s user agent/IP address matches those entered below it will be detected as a search engine spider and tracked as per the forum preferences.';
 $txt['spider_name_desc'] = 'Name by which the spider will be referred.';
 $txt['spider_agent_desc'] = 'User agent associated with this spider.';
 $txt['spider_ip_info_desc'] = 'Comma separated list of IP addresses associated with this spider.';
@@ -144,11 +147,16 @@
 $txt['spider_logs_empty'] = 'There are currently no spider log entries.';
 $txt['spider_logs_info'] = 'Note that logging of every spider action only occurs if tracking is set to either &quot;high&quot; or &quot;very high&quot;. Detail of every spiders action is only logged if tracking is set to &quot;very high&quot;.';
 $txt['spider_disabled'] = 'Disabled';
+$txt['spider_log_empty_log'] = 'Clear Log';
+$txt['spider_log_empty_log_confirm'] = 'Are you sure you want to completely clear the log';
 
 $txt['spider_logs_delete'] = 'Delete Entries';
 $txt['spider_logs_delete_older'] = 'Delete all entries older than';
 $txt['spider_logs_delete_day'] = 'days.';
 $txt['spider_logs_delete_submit'] = 'Delete';
+
+$txt['spider_stats_delete_older'] = 'Delete all spider statistics from spiders not seen in %1$s days.';
+
 // Don't use entities in the below string.
 $txt['spider_logs_delete_confirm'] = 'Are you sure you wish to empty out all log entries?';
 
diff -ru a/Themes/default/languages/Settings.english.php b/Themes/default/languages/Settings.english.php
--- a/Themes/default/languages/Settings.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Settings.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,9 +1,9 @@
 <?php
-// Version: 2.0; Settings
+// Version: 2.1 Beta 1; Settings
 
 global $settings;
 
-$txt['theme_thumbnail_href'] = $settings['images_url'] . '/thumbnail.gif';
-$txt['theme_description'] = 'The default theme from Simple Machines.<br /><br />Author: The Simple Machines Team';
+$txt['theme_thumbnail_href'] = $settings['images_url'] . '/thumbnail.png';
+$txt['theme_description'] = 'The default theme from Simple Machines.<br><br>Author: The Simple Machines Team';
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Stats.english.php b/Themes/default/languages/Stats.english.php
--- a/Themes/default/languages/Stats.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Stats.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; Stats
+// Version: 2.1 Beta 1; Stats
 
 global $context;
 
@@ -20,17 +20,17 @@
 $txt['yearly_summary'] = 'Yearly Summary';
 $txt['smf_stats_14'] = 'Most Online';
 $txt['top_starters'] = 'Top Topic Starters';
-$txt['most_time_online'] = 'Most Time Online';
-$txt['best_karma'] = 'Best Karma';
-$txt['worst_karma'] = 'Worst Karma';
+$txt['top_time_online'] = 'Most Time Online';
 $txt['stats_more_detailed'] = 'more detailed &raquo;';
+$txt['top_liked_messages'] = 'Top liked messages';
+$txt['top_liked_users'] = 'Top liked users';
 
 $txt['average_members'] = 'Average registrations per day';
 $txt['average_posts'] = 'Average posts per day';
 $txt['average_topics'] = 'Average topics per day';
 $txt['average_online'] = 'Average online per day';
 $txt['users_online'] = 'Users Online';
-$txt['gender_ratio'] = 'Male to Female Ratio';
+$txt['gender_stats'] = 'Gender stats';
 $txt['users_online_today'] = 'Online Today';
 $txt['num_hits'] = 'Total page views';
 $txt['average_hits'] = 'Average page views per day';
@@ -38,7 +38,7 @@
 $txt['ssi_comment'] = 'comment';
 $txt['ssi_comments'] = 'comments';
 $txt['ssi_write_comment'] = 'Write Comment';
-$txt['ssi_no_guests'] = 'You cannot specify a board that doesn\'t allow guests.  Please check the board ID before trying again.';
+$txt['ssi_no_guests'] = 'You cannot specify a board that doesn\'t allow guests. Please check the board ID before trying again.';
 $txt['xml_rss_desc'] = 'Live information from ' . $context['forum_name'];
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Themes.english.php b/Themes/default/languages/Themes.english.php
--- a/Themes/default/languages/Themes.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Themes.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,7 +1,7 @@
 <?php
-// Version: 2.0; Themes
+// Version: 2.1 Beta 1; Themes
 
-$txt['themeadmin_explain'] = 'Themes are the different looks and feels of your forum.  These settings affect the selection of themes, and which themes guests and other members use.';
+$txt['themeadmin_explain'] = 'Themes are the different looks and feels of your forum. These settings affect the selection of themes, and which themes guests and other members use.';
 
 $txt['theme_allow'] = 'Allow members to select their own themes.';
 $txt['theme_guests'] = 'Overall forum default';
@@ -11,22 +11,38 @@
 $txt['theme_forum_default'] = 'Forum Default';
 
 $txt['theme_remove'] = 'remove';
+$txt['theme_enable'] = 'enable';
+$txt['theme_disable'] = 'disable';
 $txt['theme_remove_confirm'] = 'Are you sure you want to permanently remove this theme?';
+$txt['theme_enable_confirm'] = 'Are you sure you want to enable this theme?';
+$txt['theme_disable_confirm'] = 'Are you sure you want to disable this theme?';
+$txt['theme_confirmed_disabling'] = 'The theme was successfully disabled.';
+$txt['theme_confirmed_enabling'] = 'The theme was successfully enabled.';
+$txt['theme_confirmed_removing'] = 'The theme was successfully removed.';
 
 $txt['theme_install'] = 'Install a New Theme';
-$txt['theme_install_file'] = 'From a file';
+$txt['theme_install_file'] = 'From an archive (e.g. .zip, .tar.gz)';
 $txt['theme_install_dir'] = 'From a directory on the server';
-$txt['theme_install_error'] = 'That theme directory doesn\'t exist, or doesn\'t contain a theme!';
-$txt['theme_install_write_error'] = 'The Themes directory must be writable to continue!';
-$txt['theme_install_go'] = 'Install!';
+$txt['theme_install_error'] = 'That theme directory doesn\'t exist, or doesn\'t contain a theme.';
+$txt['theme_install_write_error'] = 'The Themes directory must be writable to continue.';
+$txt['theme_install_go'] = 'Install';
 $txt['theme_install_new'] = 'Create a copy of Default named';
 $txt['theme_install_new_confirm'] = 'Are you sure you want to install this new theme?';
-$txt['theme_install_writable'] = 'Warning - you cannot create or install a new theme as your themes directory is not currently writable!';
+$txt['theme_install_writable'] = 'Warning - you cannot create or install a new theme as your themes directory is not currently writable.';
 $txt['theme_installed'] = 'Installed Successfully';
 $txt['theme_installed_message'] = 'was installed successfully.';
-
-$txt['theme_latest'] = 'Latest and Greatest Themes';
-$txt['theme_latest_fetch'] = 'Fetching latest themes from www.simplemachines.org...';
+$txt['theme_updated_message'] = 'was updated successfully.';
+$txt['theme_install_no_action'] = 'This isn\'t a valid install action.';
+$txt['theme_install_error_title'] = 'An error occurred while installing the theme.';
+$txt['theme_install_error_file_1'] = 'The uploaded file exceeds the upload_max_filesize directive in php.ini.';
+$txt['theme_install_error_file_2'] = 'The uploaded file exceeds the MAX_FILE_SIZE directive that was specified in the HTML form.';
+$txt['theme_install_error_file_3'] = 'The uploaded file was only partially uploaded.';
+$txt['theme_install_error_file_4'] = 'No file was uploaded.';
+$txt['theme_install_error_file_6'] = 'Missing a temporary upload folder.';
+$txt['theme_install_error_file_7'] = 'Failed to write file to disk.';
+$txt['theme_install_invalid_dir'] = 'You did not add a path for your actual theme, you cannot re-add the default theme';
+$txt['theme_install_already_dir'] = 'The name you specified is already been used by another theme, please try a different name.';
+$txt['theme_install_invalid_id'] = 'This is not a valid ID theme.';
 
 $txt['theme_pick'] = 'Choose a theme...';
 $txt['theme_preview'] = 'Preview theme';
@@ -38,7 +54,7 @@
 $txt['theme_edit'] = 'Edit Theme';
 $txt['theme_edit_style'] = 'Modify the stylesheets. (colors, fonts, etc.)';
 $txt['theme_edit_index'] = 'Modify the index template. (the main template)';
-$txt['theme_edit_no_save'] = 'This file cannot be saved because it is not writable!  Please make sure the following file is 777 or has the proper permissions';
+$txt['theme_edit_no_save'] = 'This file cannot be saved because it is not writable. Please make sure the following file is 777 or has the proper permissions';
 $txt['theme_edit_save'] = 'Save Changes';
 
 $txt['theme_global_description'] = 'This is the default theme, which means your theme will change along with the administrators\' settings and the board you are viewing.';
@@ -62,7 +78,6 @@
 
 $txt['enable_random_news'] = 'Enable random news line in the forum header';
 $txt['show_group_key'] = 'Show group key on board index';
-$txt['additional_options_collapsable'] = 'Enable collapsible additional post options';
 $txt['allow_no_censored'] = 'Allow users to turn off word censoring';
 $txt['who_display_viewing'] = 'Show who is viewing the board index and posts';
 $txt['who_display_viewing_off'] = 'Don\'t show';
@@ -71,40 +86,31 @@
 $txt['disable_recent_posts'] = 'Disable recent posts';
 $txt['enable_single_post'] = 'Enable single post';
 $txt['enable_multiple_posts'] = 'Enable multiple posts';
-$txt['enable_inline_links'] = 'Enable inline links';
-$txt['inline_desc'] = 'Enabling this will cause your current location to be drawn in a single line, as opposed to in a tree-like manner.';
 $txt['show_stats_index'] = 'Show statistics on board index';
 $txt['latest_members'] = 'Show latest member on board index';
-$txt['last_modification'] = 'Show last modification date on modified posts';
-$txt['user_avatars'] = 'Show user avatars in message view';
-$txt['user_text'] = 'Show personal text in message view';
-$txt['gender_images'] = 'Show gender images in message view';
 $txt['news_fader'] = 'Show news fader on board index';
 $txt['member_list_bar'] = 'Show members list bar on board index';
-$txt['current_pos_text_img'] = 'Show current position in forum as link instead of text';
-$txt['show_view_profile_button'] = 'Show view profile button under post';
-$txt['enable_mark_as_read'] = 'Enable and show \'Mark as Read\' buttons';
 $txt['header_logo_url'] = 'Logo image URL';
 $txt['header_logo_url_desc'] = '(leave blank to show forum name or default logo.)';
 $txt['number_recent_posts'] = 'Number of recent posts to display on board index';
-$txt['number_recent_posts_desc'] = 'To disable the recent posts bar set this value to zero.';
-$txt['hide_post_group'] = 'Hide post group titles for grouped members';
-$txt['hide_post_group_desc'] = 'Enabling this will not display a member\'s post group title on the message view if they are assigned to a non-post based group.';
 
-$txt['theme_options_defaults'] = 'These are the default values for some member specific settings.  Changing these will only affect new members and guests.';
+$txt['theme_adding_title'] = 'Obtaining Themes';
+$txt['theme_adding'] = 'You can always find new themes for your forum from the SMF themes area - <strong><a href="http://custom.simplemachines.org/themes/" target="_blank">http://custom.simplemachines.org/themes/</a></strong>. You can browse them on the website, read the comments, and download them to your computer and then upload them to your forum from there.<br><br>If you run into any questions with themes, each modification published on simplemachines.org has a dedicated topic about it where support and comments should be directed to.';
+
+$txt['theme_options_defaults'] = 'These are the default values for some member specific settings. Changing these will only affect new members and guests.';
 $txt['theme_options_title'] = 'Change or reset default options';
 
 $txt['themeadmin_title'] = 'Themes and Layout Settings';
 $txt['themeadmin_description'] = 'Here you can modify the settings for your themes, update theme selections, reset member options, and the like.';
-$txt['themeadmin_admin_desc'] = 'This page allows you to change the default theme, reset members to all use a certain theme, and choose other settings related to theme selection.  You are also able to install themes from here.<br /><br />Don\'t forget to look at the theme settings for your themes for layout options.';
+$txt['themeadmin_admin_desc'] = 'This page allows you to change the default theme, reset members to all use a certain theme, and choose other settings related to theme selection. You are also able to install themes from here.<br><br>Don\'t forget to look at the theme settings for your themes for layout options.';
 $txt['themeadmin_list_desc'] = 'From here, you can view the list of themes you currently have installed, change their paths and settings, and uninstall them.';
-$txt['themeadmin_reset_desc'] = 'Below you will see an interface to change the current theme-specific options for all your members.  You will only see those themes that have their own set of settings.';
-$txt['themeadmin_edit_desc'] = 'Modify the stylesheet and source code of your installed themes.  Please consult the documentation for more information.';
+$txt['themeadmin_reset_desc'] = 'Below you will see an interface to change the current theme-specific options for all your members. You will only see those themes that have their own set of settings.';
+$txt['themeadmin_edit_desc'] = 'Modify the stylesheet and source code of your installed themes. Please consult the documentation for more information.';
 
 $txt['themeadmin_list_heading'] = 'Theme Settings Overview';
-$txt['themeadmin_list_tip'] = 'Remember, the layout settings may be different between one theme and another.  Click on the theme\'s names below to set their options, change their directory or URL settings, or to find other options.';
+$txt['themeadmin_list_tip'] = 'Remember, the layout settings may be different between one theme and another. Click on the theme\'s names below to set their options, change their directory or URL settings, or to find other options.';
 $txt['themeadmin_list_theme_dir'] = 'Theme directory (templates)';
-$txt['themeadmin_list_invalid'] = '(warning, this path is not correct!)';
+$txt['themeadmin_list_invalid'] = '(Warning! this path is not correct.)';
 $txt['themeadmin_list_theme_url'] = 'URL to above directory';
 $txt['themeadmin_list_images_url'] = 'URL to images directory';
 $txt['themeadmin_list_reset'] = 'Reset Theme URLs and Directories';
@@ -112,7 +118,7 @@
 $txt['themeadmin_list_reset_url'] = 'Base URL to the same directory';
 $txt['themeadmin_list_reset_go'] = 'Attempt to reset all themes';
 
-$txt['themeadmin_reset_tip'] = 'Each theme may have its own custom options for selection by your members.  These include things like &quot;quick reply&quot;, avatars and signatures, layout options, and other similar options.  Here you can change the defaults or reset everyone\'s options.<br /><br />Please note that some themes may use the default options, in which case they will not have their own options.';
+$txt['themeadmin_reset_tip'] = 'Each theme may have its own custom options for selection by your members. These include things like avatars, signatures, layout options and other similar options. Here you can change the defaults or reset everyone\'s options.<br><br>Please note that some themes may use the default options, in which case they will not have their own options.';
 $txt['themeadmin_reset_defaults'] = 'Configure guest and new user options for this theme';
 $txt['themeadmin_reset_defaults_current'] = 'options currently set.';
 $txt['themeadmin_reset_members'] = 'Change current options for all members using this theme';
@@ -120,20 +126,21 @@
 $txt['themeadmin_reset_remove_current'] = 'members currently using their own options.';
 // Don't use entities in the below string.
 $txt['themeadmin_reset_remove_confirm'] = 'Are you sure you want to remove all theme options?\\nThis may reset some custom profile fields as well.';
-$txt['themeadmin_reset_options_info'] = 'The options below will reset options for <em>everyone</em>.  To change an option, select &quot;change&quot; in the box next to it, and then select a value for it.  To use the default, select &quot;remove&quot;.  Otherwise, use &quot;don\'t change&quot; to keep it as-is.';
+$txt['themeadmin_reset_options_info'] = 'The options below will reset options for <em>everyone</em>. To change an option, select &quot;change&quot; in the box next to it, and then select a value for it. To use the default, select &quot;default&quot;. Otherwise, use &quot;don\'t change&quot; to keep it as-is.';
 $txt['themeadmin_reset_options_change'] = 'Change';
 $txt['themeadmin_reset_options_none'] = 'Don\'t change';
-$txt['themeadmin_reset_options_remove'] = 'Remove';
+$txt['themeadmin_reset_options_default'] = 'Default';
 
 $txt['themeadmin_edit_browse'] = 'Browse the templates and files in this theme.';
 $txt['themeadmin_edit_style'] = 'Edit this theme\'s stylesheets.';
 $txt['themeadmin_edit_copy_template'] = 'Copy a template from the theme this is based on.';
 $txt['themeadmin_edit_exists'] = 'already exists';
 $txt['themeadmin_edit_do_copy'] = 'copy';
-$txt['themeadmin_edit_copy_warning'] = 'When SMF needs a template or language file which is not in the current theme, it looks in the theme it is based on, or the default theme.<br />Unless you need to modify a template, it\'s better not to copy it.';
+$txt['themeadmin_edit_copy_warning'] = 'When SMF needs a template or language file which is not in the current theme, it looks in the theme it is based on, or the default theme.<br>Unless you need to modify a template, it\'s better not to copy it.';
 $txt['themeadmin_edit_copy_confirm'] = 'Are you sure you want to copy this template?';
-$txt['themeadmin_edit_overwrite_confirm'] = 'Are you sure you want to copy this template over the one that already exists?\nThis will OVERWRITE any changes you\\\'ve made!';
+$txt['themeadmin_edit_overwrite_confirm'] = 'Are you sure you want to copy this template over the one that already exists?\nThis will OVERWRITE any changes you\\\'ve made';
 $txt['themeadmin_edit_no_copy'] = '<em>(can\'t copy)</em>';
+$txt['themeadmin_browsing_theme'] = 'Browsing files in theme: %1$s';
 $txt['themeadmin_edit_filename'] = 'Filename';
 $txt['themeadmin_edit_modified'] = 'Last Modified';
 $txt['themeadmin_edit_size'] = 'Size';
@@ -145,4 +152,7 @@
 $txt['themeadmin_selectable'] = 'Themes that the user is able to select';
 $txt['themeadmin_themelist_link'] = 'Show the list of themes';
 
+/* Open Graph */
+$txt['og_image'] = 'OG Image';
+$txt['og_image_desc'] = 'Link to your Open Graph optimized image, suggested size 175x175px<br><span class="smalltext">You can read more about here <a href="http://ogp.me/">Open Graph</a></span>';
 ?>
\ No newline at end of file
diff -ru a/Themes/default/languages/Who.english.php b/Themes/default/languages/Who.english.php
--- a/Themes/default/languages/Who.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Who.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,9 +1,12 @@
 <?php
-// Version: 2.0; Who
+// Version: 2.1 Beta 1; Who
 
 global $scripturl, $context;
 
 $txt['who_hidden'] = '<em>Nothing, or nothing you can see...</em>';
+$txt['who_admin'] = 'Viewing the admin portal';
+$txt['who_moderate'] = 'Viewing the moderator portal';
+$txt['who_generic'] = 'Viewing the';
 $txt['who_unknown'] = '<em>Unknown Action</em>';
 $txt['who_user'] = 'User';
 $txt['who_time'] = 'Time';
@@ -16,6 +19,7 @@
 $txt['who_no_online_spiders'] = 'There are currently no spiders online.';
 $txt['who_no_online_guests'] = 'There are currently no guests online.';
 $txt['who_no_online_members'] = 'There are currently no members online.';
+$txt['who_guest_login'] = 'User has been taken to the login page.';
 
 $txt['whospider_login'] = 'Viewing the login page.';
 $txt['whospider_register'] = 'Viewing the registration page.';
@@ -34,21 +38,20 @@
 $txt['whoall_login2'] = 'Logging into the forum.';
 $txt['whoall_logout'] = 'Logging out of the forum.';
 $txt['whoall_markasread'] = 'Marking topics read or unread.';
-$txt['whoall_modifykarma_applaud'] = 'Applauding a member.';
-$txt['whoall_modifykarma_smite'] = 'Smiting a member.';
 $txt['whoall_news'] = 'Viewing the news.';
 $txt['whoall_notify'] = 'Changing their notification settings.';
 $txt['whoall_notifyboard'] = 'Changing their notification settings.';
-$txt['whoall_openidreturn'] = 'Logging in using OpenID.';
 $txt['whoall_quickmod'] = 'Moderating a board.';
 $txt['whoall_recent'] = 'Viewing a <a href="' . $scripturl . '?action=recent">list of recent topics</a>.';
-$txt['whoall_register'] = 'Registering for an account on the forum.';
-$txt['whoall_register2'] = 'Registering for an account on the forum.';
 $txt['whoall_reminder'] = 'Requesting a password reminder.';
 $txt['whoall_reporttm'] = 'Reporting a topic to a moderator.';
+$txt['whoall_restoretopic'] = 'Restoring a topic.';
+$txt['whoall_signup'] = 'Registering for an account on the forum.';
+$txt['whoall_signup2'] = 'Registering for an account on the forum.';
 $txt['whoall_spellcheck'] = 'Using the spellchecker';
 $txt['whoall_unread'] = 'Viewing unread topics since their last visit.';
 $txt['whoall_unreadreplies'] = 'Viewing unread replies since their last visit.';
+$txt['whoall_unwatchtopic'] = 'Unwatching a topic.';
 $txt['whoall_who'] = 'Viewing <a href="' . $scripturl . '?action=who">Who\'s Online</a>.';
 
 $txt['whoall_collapse_collapse'] = 'Collapsing a category.';
@@ -75,7 +78,6 @@
 $txt['whotopic_quickmod2'] = 'Moderating the topic <a href="' . $scripturl . '?topic=%1$d.0">%2$s</a>.';
 $txt['whotopic_removepoll'] = 'Removing the poll in &quot;<a href="' . $scripturl . '?topic=%1$d.0">%2$s</a>&quot;.';
 $txt['whotopic_removetopic2'] = 'Removing the topic <a href="' . $scripturl . '?topic=%1$d.0">%2$s</a>.';
-$txt['whotopic_sendtopic'] = 'Sending the topic &quot;<a href="' . $scripturl . '?topic=%1$d.0">%2$s</a>&quot; to a friend.';
 $txt['whotopic_splittopics'] = 'Splitting the topic &quot;<a href="' . $scripturl . '?topic=%1$d.0">%2$s</a>&quot; into two topics.';
 $txt['whotopic_sticky'] = 'Setting the topic &quot;<a href="' . $scripturl . '?topic=%1$d.0">%2$s</a>&quot; as sticky.';
 $txt['whotopic_vote'] = 'Voting in <a href="' . $scripturl . '?topic=%1$d.0">%2$s</a>.';
@@ -108,16 +110,15 @@
 $txt['whoallow_repairboards'] = 'Repairing the database tables.';
 $txt['whoallow_search'] = '<a href="' . $scripturl . '?action=search">Searching</a> the forum.';
 $txt['whoallow_search2'] = 'Viewing the results of a search.';
-$txt['whoallow_setcensor'] = 'Editing the censor text.';
-$txt['whoallow_setreserve'] = 'Editing the reserved names.';
 $txt['whoallow_stats'] = 'Viewing the <a href="' . $scripturl . '?action=stats">forum stats</a>.';
 $txt['whoallow_viewErrorLog'] = 'Viewing the error log.';
 $txt['whoallow_viewmembers'] = 'Viewing a list of members.';
 
 $txt['who_topic'] = 'Viewing the topic <a href="' . $scripturl . '?topic=%1$d.0">%2$s</a>.';
 $txt['who_board'] = 'Viewing the board <a href="' . $scripturl . '?board=%1$d.0">%2$s</a>.';
-$txt['who_index'] = 'Viewing the board index of <a href="' . $scripturl . '">' . $context['forum_name'] . '</a>.';
+$txt['who_index'] = 'Viewing the board index of <a href="' . $scripturl . '">' . $context['forum_name_html_safe'] . '</a>.';
 $txt['who_viewprofile'] = 'Viewing <a href="' . $scripturl . '?action=profile;u=%1$d">%2$s</a>\'s profile.';
+$txt['who_viewownprofile'] = 'Viewing <a href="' . $scripturl . '?action=profile;u=%1$d">their own profile</a>.';
 $txt['who_profile'] = 'Editing the profile of <a href="' . $scripturl . '?action=profile;u=%1$d">%2$s</a>.';
 $txt['who_post'] = 'Posting a new topic in <a href="' . $scripturl . '?board=%1$d.0">%2$s</a>.';
 $txt['who_poll'] = 'Posting a new poll in <a href="' . $scripturl . '?board=%1$d.0">%2$s</a>.';
@@ -132,7 +133,11 @@
 $txt['credits_copyright'] = 'Copyrights';
 $txt['credits_forum'] = 'Forum';
 $txt['credits_modifications'] = 'Modifications';
-$txt['credits_groups_ps'] = 'Project Support';
+$txt['credits_software_graphics'] = 'Software/Graphics';
+$txt['credits_software'] = 'Software';
+$txt['credits_graphics'] = 'Graphics';
+$txt['credits_fonts'] = 'Fonts';
+$txt['credits_groups_pm'] = 'Project Manager';
 $txt['credits_groups_dev'] = 'Developers';
 $txt['credits_groups_support'] = 'Support Specialists';
 $txt['credits_groups_customize'] = 'Customizers';
@@ -141,6 +146,9 @@
 $txt['credits_groups_internationalizers'] = 'Localizers';
 $txt['credits_groups_servers'] = 'Servers Administrators';
 $txt['credits_groups_site'] = 'Site Administrators';
+$txt['credits_license'] = 'License';
+$txt['credits_copyright'] = 'Copyright';
+$txt['credits_version'] = 'Version';
 // Replace "English" with the name of this language pack in the string below.
 $txt['credits_groups_translation'] = 'English Translation';
 $txt['credits_groups_translators'] = 'Language Translators';
diff -ru a/Themes/default/languages/Wireless.english.php b/Themes/default/languages/Wireless.english.php
--- a/Themes/default/languages/Wireless.english.php	2011-06-06 09:26:18.000000000 -0700
+++ b/Themes/default/languages/Wireless.english.php	2015-03-05 23:30:06.028012022 -0800
@@ -1,5 +1,5 @@
 <?php
-// Version: 2.0; Wireless
+// Version: 2.1 Beta 1; Wireless
 
 $txt['wireless_error_home'] = 'Board index';
 
@@ -15,7 +15,7 @@
 $txt['wireless_navigation_topic'] = 'Back to topic';
 
 $txt['wireless_pm_inbox'] = 'PM inbox';
-$txt['wireless_pm_inbox_new'] = 'PM inbox (<span style="color: red;">%1$d new</span>)';
+$txt['wireless_pm_inbox_new'] = 'PM inbox (<span class="red">%1$d new</span>)';
 $txt['wireless_pm_by'] = 'by';
 $txt['wireless_pm_add_buddy'] = 'Add buddy';
 $txt['wireless_pm_select_buddy'] = 'Select a buddy';
Only in a/Themes/default: license.txt
Only in b/Themes/default: Likes.template.php
diff -ru a/Themes/default/Login.template.php b/Themes/default/Login.template.php
--- a/Themes/default/Login.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Login.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,94 +3,180 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // This is just the basic "login" form.
 function template_login()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $settings, $scripturl, $modSettings, $txt;
 
 	echo '
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/sha1.js"></script>
-
-		<form action="', $scripturl, '?action=login2" name="frmLogin" id="frmLogin" method="post" accept-charset="', $context['character_set'], '" ', empty($context['disable_login_hashing']) ? ' onsubmit="hashLoginPassword(this, \'' . $context['session_id'] . '\');"' : '', '>
 		<div class="tborder login">
 			<div class="cat_bar">
 				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/login_sm.gif" alt="" class="icon" /> ', $txt['login'], '</span>
+					<img src="', $settings['images_url'], '/icons/login_hd.png" alt="" class="icon"> ', $txt['login'], '
 				</h3>
 			</div>
-			<span class="upperframe"><span></span></span>
-			<div class="roundframe"><br class="clear" />';
+			<div class="roundframe">
+				<form class="login" action="', $context['login_url'], '" name="frmLogin" id="frmLogin" method="post" accept-charset="', $context['character_set'], '">';
 
 	// Did they make a mistake last time?
 	if (!empty($context['login_errors']))
-		foreach ($context['login_errors'] as $error)
-			echo '
-				<p class="error">', $error, '</p>';
+		echo '
+					<div class="errorbox">', implode('<br>', $context['login_errors']), '</div><br>';
 
 	// Or perhaps there's some special description for this time?
 	if (isset($context['description']))
 		echo '
-				<p class="description">', $context['description'], '</p>';
+					<p class="information">', $context['description'], '</p>';
 
 	// Now just get the basic information - username, password, etc.
 	echo '
-				<dl>
-					<dt>', $txt['username'], ':</dt>
-					<dd><input type="text" name="user" size="20" value="', $context['default_username'], '" class="input_text" /></dd>
-					<dt>', $txt['password'], ':</dt>
-					<dd><input type="password" name="passwrd" value="', $context['default_password'], '" size="20" class="input_password" /></dd>
-				</dl>';
-
-	if (!empty($modSettings['enableOpenID']))
-		echo '<p><strong>&mdash;', $txt['or'], '&mdash;</strong></p>
-				<dl>
-					<dt>', $txt['openid'], ':</dt>
-					<dd><input type="text" name="openid_identifier" class="input_text openid_login" size="17" />&nbsp;<em><a href="', $scripturl, '?action=helpadmin;help=register_openid" onclick="return reqWin(this.href);" class="help">(?)</a></em></dd>
-				</dl><hr />';
-
-	echo '
-				<dl>
-					<dt>', $txt['mins_logged_in'], ':</dt>
-					<dd><input type="text" name="cookielength" size="4" maxlength="4" value="', $modSettings['cookieTime'], '"', $context['never_expire'] ? ' disabled="disabled"' : '', ' class="input_text" /></dd>
-					<dt>', $txt['always_logged_in'], ':</dt>
-					<dd><input type="checkbox" name="cookieneverexp"', $context['never_expire'] ? ' checked="checked"' : '', ' class="input_check" onclick="this.form.cookielength.disabled = this.checked;" /></dd>';
+					<dl>
+						<dt>', $txt['username'], ':</dt>
+						<dd><input type="text" id="', !empty($context['from_ajax']) ? 'ajax_' : '', 'loginuser" name="user" size="20" value="', $context['default_username'], '" class="input_text"></dd>
+						<dt>', $txt['password'], ':</dt>
+						<dd><input type="password" id="', !empty($context['from_ajax']) ? 'ajax_' : '', 'loginpass" name="passwrd" value="', $context['default_password'], '" size="20" class="input_password"></dd>
+					</dl>
+					<dl>
+						<dt>', $txt['mins_logged_in'], ':</dt>
+						<dd><input type="number" name="cookielength" size="4" maxlength="4" value="', $modSettings['cookieTime'], '"', $context['never_expire'] ? ' disabled' : '', ' class="input_text" min="1" max="525600"></dd>
+						<dt>', $txt['always_logged_in'], ':</dt>
+						<dd><input type="checkbox" name="cookieneverexp"', $context['never_expire'] ? ' checked' : '', ' class="input_check" onclick="this.form.cookielength.disabled = this.checked;"></dd>';
 	// If they have deleted their account, give them a chance to change their mind.
 	if (isset($context['login_show_undelete']))
 		echo '
-					<dt class="alert">', $txt['undelete_account'], ':</dt>
-					<dd><input type="checkbox" name="undelete" class="input_check" /></dd>';
+						<dt class="alert">', $txt['undelete_account'], ':</dt>
+						<dd><input type="checkbox" name="undelete" class="input_check"></dd>';
+	echo '
+					</dl>
+					<p><input type="submit" value="', $txt['login'], '" class="button_submit"></p>
+					<p class="smalltext"><a href="', $scripturl, '?action=reminder">', $txt['forgot_your_password'], '</a></p>
+					<input type="hidden" name="hash_passwrd" value="">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['login_token_var'], '" value="', $context['login_token'], '">
+					<script type="text/javascript">
+						setTimeout(function() {
+							document.getElementById("', !empty($context['from_ajax']) ? 'ajax_' : '', isset($context['default_username']) && $context['default_username'] != '' ? 'loginpass' : 'loginuser', '").focus();
+						}, 150);';
+	if (!empty($context['from_ajax']) && (empty($modSettings['force_ssl']) || $modSettings['force_ssl'] == 2))
+		echo '
+						form = $("#frmLogin");
+						form.submit(function(e) {
+							e.preventDefault();
+							e.stopPropagation();
+
+							$.ajax({
+								url: form.prop("action"),
+								method: "POST",
+								data: form.serialize(),
+								success: function(data) {
+									if (data.indexOf("<bo" + "dy") > -1)
+										document.location = ', JavaScriptEscape(!empty($_SESSION['login_url']) ? $_SESSION['login_url'] : $scripturl), ';
+									else {
+										form.parent().html($(data).find(".roundframe").html());
+									}
+								},
+								error: function() {
+									document.location = ', JavaScriptEscape(!empty($_SESSION['login_url']) ? $_SESSION['login_url'] : $scripturl), ';
+								}
+							});
+
+							return false;
+						});';
+
+	echo '
+					</script>
+				</form>';
+
+	// It is a long story as to why we have this when we're clearly not going to use it.
+	if (!empty($context['from_ajax']))
+		echo '
+					<br>
+					<a href="javascript:self.close();"></a>';
 	echo '
-				</dl>
-				<p><input type="submit" value="', $txt['login'], '" class="button_submit" /></p>
-				<p class="smalltext"><a href="', $scripturl, '?action=reminder">', $txt['forgot_your_password'], '</a></p>
-				<input type="hidden" name="hash_passwrd" value="" />
 			</div>
-			<span class="lowerframe"><span></span></span>
-		</div></form>';
+		</div>';
+}
+
+// TFA authentication
+function template_login_tfa()
+{
+	global $context, $scripturl, $modSettings, $txt;
 
-	// Focus on the correct input - username or password.
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			document.forms.frmLogin.', isset($context['default_username']) && $context['default_username'] != '' ? 'passwrd' : 'user', '.focus();
-		// ]]></script>';
+		<div class="tborder login">
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $txt['tfa_profile_label'] ,'
+				</h3>
+			</div>
+			<div class="roundframe">';
+	if (!empty($context['tfa_error']) || !empty($context['tfa_backup_error']))
+		echo '
+				<div class="error">', $txt['tfa_' . (!empty($context['tfa_error']) ? 'code_' : 'backup_') . 'invalid'], '</div>';
+	echo '
+				<form action="', $context['tfa_url'], '" method="post" id="frmTfa">
+					<div id="tfaCode">
+						', $txt['tfa_login_desc'], '<br>
+						<strong>', $txt['tfa_code'], ':</strong>
+						<input type="text" class="input_text" name="tfa_code" style="width: 150px;" value="', !empty($context['tfa_value']) ? $context['tfa_value'] : '', '">
+						<input type="submit" class="button_submit" name="submit" value="', $txt['login'], '">
+						<hr />
+						<input type="button" class="button_submit" name="backup" value="', $txt['tfa_backup'], '" style="float: none; margin: 0;">
+					</div>
+					<div id="tfaBackup" style="display: none;">
+						', $txt['tfa_backup_desc'], '<br>
+						<strong>', $txt['tfa_backup_code'], ': </strong>
+						<input type="text" class="input_text" name="tfa_backup" style="width: 150px;" value="', !empty($context['tfa_backup']) ? $context['tfa_backup'] : '', '">
+						<input type="submit" class="button_submit" name="submit" value="', $txt['login'], '">
+					</div>
+				</form>
+				<script type="text/javascript">
+						form = $("#frmTfa");';
+	if (!empty($context['from_ajax']))
+		echo '
+						form.submit(function(e) {
+							// If we are submitting backup code, let normal workflow follow since it redirects a couple times into a different page
+							if (form.find("input[name=tfa_backup]:first").val().length > 0)
+								return true;
+
+							e.preventDefault();
+							e.stopPropagation();
+
+							$.post(form.prop("action"), form.serialize(), function(data) {
+								if (data.indexOf("<bo" + "dy") > -1)
+									document.location = ', JavaScriptEscape(!empty($_SESSION['login_url']) ? $_SESSION['login_url'] : $scripturl), ';
+								else {
+									form.parent().html($(data).find(".roundframe").html());
+								}
+							});
+
+							return false;
+						});';
+	echo '
+						form.find("input[name=backup]").click(function(e) {
+							$("#tfaBackup").show();
+							$("#tfaCode").hide();
+						});
+				</script>
+			</div>
+		</div>';
 }
 
 // Tell a guest to get lost or login!
 function template_kick_guest()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $settings, $scripturl, $modSettings, $txt;
 
 	// This isn't that much... just like normal login but with a message at the top.
 	echo '
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/sha1.js"></script>
-	<form action="', $scripturl, '?action=login2" method="post" accept-charset="', $context['character_set'], '" name="frmLogin" id="frmLogin"', empty($context['disable_login_hashing']) ? ' onsubmit="hashLoginPassword(this, \'' . $context['session_id'] . '\');"' : '', '>
+	<form action="', $context['login_url'], '" method="post" accept-charset="', $context['character_set'], '" name="frmLogin" id="frmLogin">
 		<div class="tborder login">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['warning'], '</h3>
@@ -99,53 +185,44 @@
 	// Show the message or default message.
 	echo '
 			<p class="information centertext">
-				', empty($context['kick_message']) ? $txt['only_members_can_access'] : $context['kick_message'], '<br />
-				', $txt['login_below'], ' <a href="', $scripturl, '?action=register">', $txt['register_an_account'], '</a> ', sprintf($txt['login_with_forum'], $context['forum_name_html_safe']), '
-			</p>';
+				', empty($context['kick_message']) ? $txt['only_members_can_access'] : $context['kick_message'], '<br>';
+
+
+	if ($context['can_register'])
+		echo sprintf($txt['login_below_or_register'], $scripturl . '?action=signup', $context['forum_name_html_safe']);
+	else
+		echo $txt['login_below'];
 
 	// And now the login information.
 	echo '
 			<div class="cat_bar">
 				<h3 class="catbg">
-					<img src="', $settings['images_url'], '/icons/login_sm.gif" alt="" class="icon" /> ', $txt['login'], '
+					<img src="', $settings['images_url'], '/icons/login_hd.png" alt="" class="icon"> ', $txt['login'], '
 				</h3>
 			</div>
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
 				<dl>
 					<dt>', $txt['username'], ':</dt>
-					<dd><input type="text" name="user" size="20" class="input_text" /></dd>
+					<dd><input type="text" name="user" size="20" class="input_text"></dd>
 					<dt>', $txt['password'], ':</dt>
-					<dd><input type="password" name="passwrd" size="20" class="input_password" /></dd>';
-
-	if (!empty($modSettings['enableOpenID']))
-		echo '
-				</dl>
-				<p><strong>&mdash;', $txt['or'], '&mdash;</strong></p>
-				<dl>
-					<dt>', $txt['openid'], ':</dt>
-					<dd><input type="text" name="openid_identifier" class="input_text openid_login" size="17" /></dd>
-				</dl>
-				<hr />
-				<dl>';
-
-	echo '
+					<dd><input type="password" name="passwrd" size="20" class="input_password"></dd>
 					<dt>', $txt['mins_logged_in'], ':</dt>
-					<dd><input type="text" name="cookielength" size="4" maxlength="4" value="', $modSettings['cookieTime'], '" class="input_text" /></dd>
+					<dd><input type="text" name="cookielength" size="4" maxlength="4" value="', $modSettings['cookieTime'], '" class="input_text"></dd>
 					<dt>', $txt['always_logged_in'], ':</dt>
-					<dd><input type="checkbox" name="cookieneverexp" class="input_check" onclick="this.form.cookielength.disabled = this.checked;" /></dd>
+					<dd><input type="checkbox" name="cookieneverexp" class="input_check" onclick="this.form.cookielength.disabled = this.checked;"></dd>
 				</dl>
-				<p class="centertext"><input type="submit" value="', $txt['login'], '" class="button_submit" /></p>
+				<p class="centertext"><input type="submit" value="', $txt['login'], '" class="button_submit"></p>
 				<p class="centertext smalltext"><a href="', $scripturl, '?action=reminder">', $txt['forgot_your_password'], '</a></p>
 			</div>
-			<span class="lowerframe"><span></span></span>
-			<input type="hidden" name="hash_passwrd" value="" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['login_token_var'], '" value="', $context['login_token'], '">
+			<input type="hidden" name="hash_passwrd" value="">
 		</div>
 	</form>';
 
 	// Do the focus thing...
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			document.forms.frmLogin.user.focus();
 		// ]]></script>';
 }
@@ -153,39 +230,39 @@
 // This is for maintenance mode.
 function template_maintenance()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $txt, $modSettings;
 
 	// Display the administrator's message at the top.
 	echo '
-<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/sha1.js"></script>
-<form action="', $scripturl, '?action=login2" method="post" accept-charset="', $context['character_set'], '"', empty($context['disable_login_hashing']) ? ' onsubmit="hashLoginPassword(this, \'' . $context['session_id'] . '\');"' : '', '>
+<form action="', $context['login_url'], '" method="post" accept-charset="', $context['character_set'], '">
 	<div class="tborder login" id="maintenance_mode">
 		<div class="cat_bar">
 			<h3 class="catbg">', $context['title'], '</h3>
 		</div>
-		<p class="description">
-			<img class="floatleft" src="', $settings['images_url'], '/construction.png" width="40" height="40" alt="', $txt['in_maintain_mode'], '" />
-			', $context['description'], '<br class="clear" />
+		<p class="information">
+			<img class="floatleft" src="', $settings['images_url'], '/construction.png" width="40" height="40" alt="', $txt['in_maintain_mode'], '">
+			', $context['description'], '<br class="clear">
 		</p>
 		<div class="title_bar">
 			<h4 class="titlebg">', $txt['admin_login'], '</h4>
 		</div>
-		<span class="upperframe"><span></span></span>
 		<div class="roundframe">
 			<dl>
 				<dt>', $txt['username'], ':</dt>
-				<dd><input type="text" name="user" size="20" class="input_text" /></dd>
+				<dd><input type="text" name="user" size="20" class="input_text"></dd>
 				<dt>', $txt['password'], ':</dt>
-				<dd><input type="password" name="passwrd" size="20" class="input_password" /></dd>
+				<dd><input type="password" name="passwrd" size="20" class="input_password"></dd>
 				<dt>', $txt['mins_logged_in'], ':</dt>
-				<dd><input type="text" name="cookielength" size="4" maxlength="4" value="', $modSettings['cookieTime'], '" class="input_text" /></dd>
+				<dd><input type="text" name="cookielength" size="4" maxlength="4" value="', $modSettings['cookieTime'], '" class="input_text"></dd>
 				<dt>', $txt['always_logged_in'], ':</dt>
-				<dd><input type="checkbox" name="cookieneverexp" class="input_check" /></dd>
+				<dd><input type="checkbox" name="cookieneverexp" class="input_check"></dd>
 			</dl>
-			<p class="centertext"><input type="submit" value="', $txt['login'], '" class="button_submit" /></p>
+			<input type="submit" value="', $txt['login'], '" class="button_submit">
+			<br class="clear">
 		</div>
-		<span class="lowerframe"><span></span></span>
-		<input type="hidden" name="hash_passwrd" value="" />
+		<input type="hidden" name="hash_passwrd" value="">
+		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+		<input type="hidden" name="', $context['login_token_var'], '" value="', $context['login_token'], '">
 	</div>
 </form>';
 }
@@ -193,20 +270,17 @@
 // This is for the security stuff - makes administrators login every so often.
 function template_admin_login()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
 	// Since this should redirect to whatever they were doing, send all the get data.
 	echo '
-<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/sha1.js"></script>
-
-<form action="', $scripturl, $context['get_data'], '" method="post" accept-charset="', $context['character_set'], '" name="frmLogin" id="frmLogin" onsubmit="hashAdminPassword(this, \'', $context['user']['username'], '\', \'', $context['session_id'], '\');">
+<form action="', !empty($modSettings['force_ssl']) && $modSettings['force_ssl'] < 2 ? strtr($scripturl, array('http://' => 'https://')) : $scripturl, $context['get_data'], '" method="post" accept-charset="', $context['character_set'], '" name="frmLogin" id="frmLogin">
 	<div class="tborder login" id="admin_login">
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/login_sm.gif" alt="" class="icon" /> ', $txt['login'], '</span>
+				<img src="', $settings['images_url'], '/icons/login_hd.png" alt="" class="icon"> ', $txt['login'], '
 			</h3>
 		</div>
-		<span class="upperframe"><span></span></span>
 		<div class="roundframe centertext">';
 
 	if (!empty($context['incorrect_password']))
@@ -215,29 +289,30 @@
 
 	echo '
 			<strong>', $txt['password'], ':</strong>
-			<input type="password" name="admin_pass" size="24" class="input_password" />
-			<a href="', $scripturl, '?action=helpadmin;help=securityDisable_why" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" /></a><br />
-			<input type="submit" style="margin-top: 1em;" value="', $txt['login'], '" class="button_submit" />';
+			<input type="password" name="', $context['sessionCheckType'], '_pass" size="24" class="input_password">
+			<a href="', $scripturl, '?action=helpadmin;help=securityDisable_why" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a><br>
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['admin-login_token_var'], '" value="', $context['admin-login_token'], '">
+			<input type="submit" style="margin-top: 1em;" value="', $txt['login'], '" class="button_submit">';
 
 	// Make sure to output all the old post data.
 	echo $context['post_data'], '
 		</div>
-		<span class="lowerframe"><span></span></span>
 	</div>
-	<input type="hidden" name="admin_hash_pass" value="" />
+	<input type="hidden" name="', $context['sessionCheckType'], '_hash_pass" value="">
 </form>';
 
 	// Focus on the password box.
 	echo '
-<script type="text/javascript"><!-- // --><![CDATA[
-	document.forms.frmLogin.admin_pass.focus();
+<script><!-- // --><![CDATA[
+	document.forms.frmLogin.', $context['sessionCheckType'], '_pass.focus();
 // ]]></script>';
 }
 
 // Activate your account manually?
 function template_retry_activate()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	// Just ask them for their code so they can try it again...
 	echo '
@@ -245,7 +320,6 @@
 			<div class="title_bar">
 				<h3 class="titlebg">', $context['page_title'], '</h3>
 			</div>
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">';
 
 	// You didn't even have an ID?
@@ -253,22 +327,21 @@
 		echo '
 				<dl>
 					<dt>', $txt['invalid_activation_username'], ':</dt>
-					<dd><input type="text" name="user" size="30" class="input_text" /></dd>';
+					<dd><input type="text" name="user" size="30" class="input_text"></dd>';
 
 	echo '
 					<dt>', $txt['invalid_activation_retry'], ':</dt>
-					<dd><input type="text" name="code" size="30" class="input_text" /></dd>
+					<dd><input type="text" name="code" size="30" class="input_text"></dd>
 				</dl>
-				<p><input type="submit" value="', $txt['invalid_activation_submit'], '" class="button_submit" /></p>
+				<p><input type="submit" value="', $txt['invalid_activation_submit'], '" class="button_submit"></p>
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</form>';
 }
 
 // Activate your account manually?
 function template_resend()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	// Just ask them for their code so they can try it again...
 	echo '
@@ -276,18 +349,17 @@
 			<div class="title_bar">
 				<h3 class="titlebg">', $context['page_title'], '</h3>
 			</div>
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
 				<dl>
 					<dt>', $txt['invalid_activation_username'], ':</dt>
-					<dd><input type="text" name="user" size="40" value="', $context['default_username'], '" class="input_text" /></dd>
+					<dd><input type="text" name="user" size="40" value="', $context['default_username'], '" class="input_text"></dd>
 				</dl>
 				<p>', $txt['invalid_activation_new'], '</p>
 				<dl>
 					<dt>', $txt['invalid_activation_new_email'], ':</dt>
-					<dd><input type="text" name="new_email" size="40" class="input_text" /></dd>
+					<dd><input type="text" name="new_email" size="40" class="input_text"></dd>
 					<dt>', $txt['invalid_activation_password'], ':</dt>
-					<dd><input type="password" name="passwd" size="30" class="input_password" /></dd>
+					<dd><input type="password" name="passwd" size="30" class="input_password"></dd>
 				</dl>';
 
 	if ($context['can_activate'])
@@ -295,13 +367,12 @@
 				<p>', $txt['invalid_activation_known'], '</p>
 				<dl>
 					<dt>', $txt['invalid_activation_retry'], ':</dt>
-					<dd><input type="text" name="code" size="30" class="input_text" /></dd>
+					<dd><input type="text" name="code" size="30" class="input_text"></dd>
 				</dl>';
 
 	echo '
-				<p><input type="submit" value="', $txt['invalid_activation_resend'], '" class="button_submit" /></p>
+				<p><input type="submit" value="', $txt['invalid_activation_resend'], '" class="button_submit"></p>
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</form>';
 }
 
diff -ru a/Themes/default/ManageAttachments.template.php b/Themes/default/ManageAttachments.template.php
--- a/Themes/default/ManageAttachments.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/ManageAttachments.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,11 +3,11 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Template template wraps around the simple settings page to add javascript functionality.
@@ -18,14 +18,12 @@
 function template_avatar_settings_below()
 {
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 	var fUpdateStatus = function ()
 	{
 		document.getElementById("avatar_max_width_external").disabled = document.getElementById("avatar_download_external").checked;
 		document.getElementById("avatar_max_height_external").disabled = document.getElementById("avatar_download_external").checked;
 		document.getElementById("avatar_action_too_large").disabled = document.getElementById("avatar_download_external").checked;
-		document.getElementById("custom_avatar_dir").disabled = document.getElementById("custom_avatar_enabled").value == 0;
-		document.getElementById("custom_avatar_url").disabled = document.getElementById("custom_avatar_enabled").value == 0;
 
 	}
 	addLoadEvent(fUpdateStatus);
@@ -33,107 +31,155 @@
 ';
 }
 
-function template_browse()
-{
-	global $context, $settings, $options, $scripturl, $txt;
-
-	echo '
-	<div id="manage_attachments">
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['attachment_manager_browse_files'], '</h3>
-		</div>
-		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<a href="', $scripturl, '?action=admin;area=manageattachments;sa=browse">', $context['browse_type'] === 'attachments' ? '<img src="' . $settings['images_url'] . '/selected.gif" alt="&gt;" /> ' : '', $txt['attachment_manager_attachments'], '</a> |
-				<a href="', $scripturl, '?action=admin;area=manageattachments;sa=browse;avatars">', $context['browse_type'] === 'avatars' ? '<img src="' . $settings['images_url'] . '/selected.gif" alt="&gt;" /> ' : '', $txt['attachment_manager_avatars'], '</a> |
-				<a href="', $scripturl, '?action=admin;area=manageattachments;sa=browse;thumbs">', $context['browse_type'] === 'thumbs' ? '<img src="' . $settings['images_url'] . '/selected.gif" alt="&gt;" /> ' : '', $txt['attachment_manager_thumbs'], '</a>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-	</div>';
-
-	template_show_list('file_list');
-	echo '
-	<br class="clear" />';
-
-}
-
 function template_maintenance()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="manage_attachments">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['attachment_stats'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl class="settings">
-					<dt><strong>', $txt['attachment_total'], ':</strong></dt><dd>', $context['num_attachments'], '</dd>
-					<dt><strong>', $txt['attachment_manager_total_avatars'], ':</strong></dt><dd>', $context['num_avatars'], '</dd>
-					<dt><strong>', $txt['attachmentdir_size' . ($context['attach_multiple_dirs'] ? '_current' : '')], ':</strong></dt><dd>', $context['attachment_total_size'], ' ', $txt['kilobyte'], '</dd>
-					<dt><strong>', $txt['attachment_space' . ($context['attach_multiple_dirs'] ? '_current' : '')], ':</strong></dt><dd>', isset($context['attachment_space']) ? $context['attachment_space'] . ' ' . $txt['kilobyte'] : $txt['attachmentdir_size_not_set'], '</dd>
-				</dl>
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg2">
+			<dl class="settings">
+				<dt><strong>', $txt['attachment_total'], ':</strong></dt><dd>', $context['num_attachments'], '</dd>
+				<dt><strong>', $txt['attachment_manager_total_avatars'], ':</strong></dt><dd>', $context['num_avatars'], '</dd>
+				<dt><strong>', $txt['attachmentdir_size'], ':</strong></dt><dd>', $context['attachment_total_size'], ' ', $txt['kilobyte'], '</dd>
+				<dt><strong>', $txt['attach_current_dir'], ':</strong></dt><dd>', $modSettings['attachmentUploadDir'][$modSettings['currentAttachmentUploadDir']], '</dd>
+				<dt><strong>', $txt['attachmentdir_size_current'], ':</strong></dt><dd>', $context['attachment_current_size'], ' ', $txt['kilobyte'], '</dd>
+				<dt><strong>', $txt['attachment_space'], ':</strong></dt><dd>', isset($context['attachment_space']) ? $context['attachment_space'] . ' ' . $txt['kilobyte'] : $txt['attachmentdir_size_not_set'], '</dd>
+				<dt><strong>', $txt['attachmentdir_files_current'], ':</strong></dt><dd>', $context['attachment_current_files'], '</dd>
+				<dt><strong>', $txt['attachment_files'], ':</strong></dt><dd>', isset($context['attachment_files']) ? $context['attachment_files'] : $txt['attachmentdir_files_not_set'], '</dd>
+			</dl>
 		</div>
+
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['attachment_integrity_check'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=manageattachments;sa=repair;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['attachment_integrity_check_desc'], '</p>
-					<input type="submit" name="submit" value="', $txt['attachment_check_now'], '" class="button_submit" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=manageattachments;sa=repair;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['attachment_integrity_check_desc'], '</p>
+				<input type="submit" name="repair" value="', $txt['attachment_check_now'], '" class="button_submit">
+				<br class="clear_right">
+			</form>
 		</div>
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['attachment_pruning'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=manageattachments" method="post" accept-charset="', $context['character_set'], '" onsubmit="return confirm(\'', $txt['attachment_pruning_warning'], '\');" style="margin: 0 0 2ex 0;">
-					', $txt['attachment_remove_old'], ' <input type="text" name="age" value="25" size="4" class="input_text" /> ', $txt['days_word'], '<br />
-					', $txt['attachment_pruning_message'], ': <input type="text" name="notice" value="', $txt['attachment_delete_admin'], '" size="40" class="input_text" /><br />
-					<input type="submit" name="submit" value="', $txt['remove'], '" class="button_submit" />
-					<input type="hidden" name="type" value="attachments" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="hidden" name="sa" value="byAge" />
-				</form>
-				<hr />
-				<form action="', $scripturl, '?action=admin;area=manageattachments" method="post" accept-charset="', $context['character_set'], '" onsubmit="return confirm(\'', $txt['attachment_pruning_warning'], '\');" style="margin: 0 0 2ex 0;">
-					', $txt['attachment_remove_size'], ' <input type="text" name="size" id="size" value="100" size="4" class="input_text" /> ', $txt['kilobyte'], '<br />
-					', $txt['attachment_pruning_message'], ': <input type="text" name="notice" value="', $txt['attachment_delete_admin'], '" size="40" class="input_text" /><br />
-					<input type="submit" name="submit" value="', $txt['remove'], '" class="button_submit" />
-					<input type="hidden" name="type" value="attachments" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="hidden" name="sa" value="bySize" />
-				</form>
-				<hr />
-				<form action="', $scripturl, '?action=admin;area=manageattachments" method="post" accept-charset="', $context['character_set'], '" onsubmit="return confirm(\'', $txt['attachment_pruning_warning'], '\');" style="margin: 0 0 2ex 0;">
-					', $txt['attachment_manager_avatars_older'], ' <input type="text" name="age" value="45" size="4" class="input_text" /> ', $txt['days_word'], '<br />
-					<input type="submit" name="submit" value="', $txt['remove'], '" class="button_submit" />
-					<input type="hidden" name="type" value="avatars" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="hidden" name="sa" value="byAge" />
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=manageattachments" method="post" accept-charset="', $context['character_set'], '" onsubmit="return confirm(\'', $txt['attachment_pruning_warning'], '\');" style="margin: 0 0 2ex 0;">
+				', $txt['attachment_remove_old'], ' <input type="number" name="age" value="25" size="4" class="input_text"> ', $txt['days_word'], '<br>
+				', $txt['attachment_pruning_message'], ': <input type="text" name="notice" value="', $txt['attachment_delete_admin'], '" size="40" class="input_text"><br>
+				<input type="submit" name="remove" value="', $txt['remove'], '" class="button_submit">
+				<input type="hidden" name="type" value="attachments">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="sa" value="byAge">
+				<br class="clear_right">
+			</form>
+			<hr>
+			<form action="', $scripturl, '?action=admin;area=manageattachments" method="post" accept-charset="', $context['character_set'], '" onsubmit="return confirm(\'', $txt['attachment_pruning_warning'], '\');" style="margin: 0 0 2ex 0;">
+				', $txt['attachment_remove_size'], ' <input type="number" name="size" id="size" value="100" size="4" class="input_text"> ', $txt['kilobyte'], '<br>
+				', $txt['attachment_pruning_message'], ': <input type="text" name="notice" value="', $txt['attachment_delete_admin'], '" size="40" class="input_text"><br>
+				<input type="submit" name="remove" value="', $txt['remove'], '" class="button_submit">
+				<input type="hidden" name="type" value="attachments">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="sa" value="bySize">
+				<br class="clear_right">
+			</form>
+			<hr>
+			<form action="', $scripturl, '?action=admin;area=manageattachments" method="post" accept-charset="', $context['character_set'], '" onsubmit="return confirm(\'', $txt['attachment_pruning_warning'], '\');" style="margin: 0 0 2ex 0;">
+				', $txt['attachment_manager_avatars_older'], ' <input type="number" name="age" value="45" size="4" class="input_text"> ', $txt['days_word'], '<br>
+				<input type="submit" name="remove" value="', $txt['remove'], '" class="button_submit">
+				<input type="hidden" name="type" value="avatars">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="sa" value="byAge">
+			</form>
+		</div>
+	</div>';
+
+	echo '
+			<div id="transfer" class="cat_bar">
+				<h3 class="catbg">', $txt['attachment_transfer'], '</h3>
+			</div>';
+
+	if (!empty($context['results']))
+		echo '
+			<div class="noticebox">', $context['results'], '</div>';
+
+	echo '
+			<div class="windowbg2">
+				<form action="', $scripturl, '?action=admin;area=manageattachments;sa=transfer" method="post" accept-charset="', $context['character_set'], '">
+					<p>', $txt['attachment_transfer_desc'], '</p>
+					<dl class="settings">
+						<dt>', $txt['attachment_transfer_from'], '</dt>
+						<dd><select name="from">
+							<option value="0">', $txt['attachment_transfer_select'], '</option>';
+
+	foreach ($context['attach_dirs'] as $id => $dir)
+		echo '
+							<option value="', $id, '">', $dir, '</option>';
+	echo '
+						</select></dd>
+						<dt>', $txt['attachment_transfer_auto'], '</dt>
+						<dd><select name="auto">
+							<option value="0">', $txt['attachment_transfer_auto_select'], '</option>
+							<option value="-1">', $txt['attachment_transfer_forum_root'], '</option>';
+
+	if (!empty($context['base_dirs']))
+		foreach ($context['base_dirs'] as $id => $dir)
+			echo '
+							<option value="', $id, '">', $dir, '</option>';
+	else
+			echo '
+							<option value="0" disabled>', $txt['attachment_transfer_no_base'], '</option>';
+
+	echo '
+						</select></dd>
+						<dt>', $txt['attachment_transfer_to'], '</dt>
+						<dd><select name="to">
+							<option value="0">', $txt['attachment_transfer_select'], '</option>';
+
+	foreach ($context['attach_dirs'] as $id => $dir)
+		echo '
+							<option value="', $id, '">', $dir, '</option>';
+	echo '
+						</select></dd>';
+
+	if (!empty($modSettings['attachmentDirFileLimit']))
+		echo '
+						<dt>', $txt['attachment_transfer_empty'], '</dt>
+						<dd><input type="checkbox" name="empty_it"', $context['checked'] ? ' checked' : '', '></dd>';
+	echo '
+					</dl>
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="submit" onclick="start_progress()" name="transfer" value="', $txt['attachment_transfer_now'], '" class="button_submit">
+					<div id="progress_msg"></div>
+					<div id="show_progress" class="padding"></div>
+					<br class="clear_right">
 				</form>
+				<script><!-- // --><![CDATA[
+					function start_progress() {
+						setTimeout(\'show_msg()\', 1000);
+					}
+
+					function show_msg() {
+						$(\'#progress_msg\').html(\'<div><img src="', $settings['actual_images_url'], '/loading_sm.gif" alt="', $txt['ajax_in_progress'], '" width="35" height="35">&nbsp; ', $txt['attachment_transfer_progress'] , '<\/div>\');
+						show_progress();
+					}
+
+					function show_progress() {
+						$(\'#show_progress\').load("progress.php");
+						setTimeout(\'show_progress()\', 1500);
+					}
+
+				// ]]></script>
 			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-	</div>
-	<br class="clear" />';
+			<br class="clear">';
 }
 
 function template_attachment_repair()
 {
-	global $context, $txt, $scripturl, $settings;
+	global $context, $txt, $scripturl;
 
 	// If we've completed just let them know!
 	if ($context['completed'])
@@ -144,14 +190,10 @@
 			<h3 class="catbg">', $txt['repair_attachments_complete'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				', $txt['repair_attachments_complete_desc'], '
-			</div>
-			<span class="botslice"><span></span></span>
+			', $txt['repair_attachments_complete_desc'], '
 		</div>
 	</div>
-	<br class="clear" />';
+	<br class="clear">';
 	}
 
 	// What about if no errors were even found?
@@ -163,52 +205,51 @@
 			<h3 class="catbg">', $txt['repair_attachments_complete'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				', $txt['repair_attachments_no_errors'], '
-			</div>
-			<span class="botslice"><span></span></span>
+			', $txt['repair_attachments_no_errors'], '
 		</div>
 	</div>
-	<br class="clear" />';
+	<br class="clear">';
 	}
 	// Otherwise, I'm sad to say, we have a problem!
 	else
 	{
 		echo '
 	<div id="manage_attachments">
-		<form action="', $scripturl, '?action=admin;area=manageattachments;sa=repair;fixErrors=1;step=0;substep=0;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=manageattachments;sa=repair;fixErrors=1;step=0;substep=0;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['repair_attachments'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>', $txt['repair_attachments_error_desc'], '</p>';
+				<p>', $txt['repair_attachments_error_desc'], '</p>';
 
 		// Loop through each error reporting the status
 		foreach ($context['repair_errors'] as $error => $number)
 		{
 			if (!empty($number))
 			echo '
-					<input type="checkbox" name="to_fix[]" id="', $error, '" value="', $error, '" class="input_check" />
-					<label for="', $error, '">', sprintf($txt['attach_repair_' . $error], $number), '</label><br />';
+				<input type="checkbox" name="to_fix[]" id="', $error, '" value="', $error, '" class="input_check">
+				<label for="', $error, '">', sprintf($txt['attach_repair_' . $error], $number), '</label><br>';
 		}
 
-		echo '		<br />
-					<input type="submit" value="', $txt['repair_attachments_continue'], '" class="button_submit" />
-					<input type="submit" name="cancel" value="', $txt['repair_attachments_cancel'], '" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
+		echo '		<br>
+				<input type="submit" value="', $txt['repair_attachments_continue'], '" class="button_submit">
+				<input type="submit" name="cancel" value="', $txt['repair_attachments_cancel'], '" class="button_submit">
 			</div>
 		</form>
 	</div>
-	<br class="clear" />';
+	<br class="clear">';
 	}
 }
 
 function template_attachment_paths()
 {
+	global $modSettings;
+
+	if (!empty($modSettings['attachment_basedirectories']))
+	{
+		template_show_list('base_paths');
+	}
+
 	template_show_list('attach_paths');
 }
 
diff -ru a/Themes/default/ManageBans.template.php b/Themes/default/ManageBans.template.php
--- a/Themes/default/ManageBans.template.php	2011-06-06 10:06:37.000000000 -0700
+++ b/Themes/default/ManageBans.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,245 +3,192 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_ban_edit()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="manage_bans">
-
-		<div class="cat_bar">
-			<h3 class="catbg">
-				', $context['ban']['is_new'] ? $txt['ban_add_new'] : $txt['ban_edit'] . ' \'' . $context['ban']['name'] . '\'', '
-			</h3>
-		</div>';
+		<form id="admin_form_wrapper" action="', $context['form_url'], '" method="post" accept-charset="', $context['character_set'], '" onsubmit="return confirmBan(this);">
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $context['ban']['is_new'] ? $txt['ban_add_new'] : $txt['ban_edit'] . ' \'' . $context['ban']['name'] . '\'', '
+				</h3>
+			</div>';
 
 	if ($context['ban']['is_new'])
 		echo '
-		<div class="information">', $txt['ban_add_notes'], '</div>';
+			<div class="information winfo">', $txt['ban_add_notes'], '</div>';
+
+	// If there were errors creating the ban, show them.
+	if (!empty($context['error_messages']))
+	{
+		echo '
+			<div class="errorbox">
+				<strong>', $txt['ban_errors_detected'], '</strong>
+				<ul>';
+
+		foreach ($context['error_messages'] as $error)
+			echo '
+					<li class="error">', $error, '</li>';
+
+		echo '
+				</ul>
+			</div>';
+	}
 
 	echo '
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=ban;sa=edit" method="post" accept-charset="', $context['character_set'], '" onsubmit="if (this.ban_name.value == \'\') {alert(\'', $txt['ban_name_empty'], '\'); return false;} if (this.partial_ban.checked &amp;&amp; !(this.cannot_post.checked || this.cannot_register.checked || this.cannot_login.checked)) {alert(\'', $txt['ban_restriction_empty'], '\'); return false;}">
+		<div class="windowbg2">
+			<dl class="settings">
+				<dt id="ban_name_label">
+					<strong>', $txt['ban_name'], ':</strong>
+				</dt>
+				<dd>
+					<input type="text" id="ban_name" name="ban_name" value="', $context['ban']['name'], '" size="45" maxlength="60" class="input_text">
+				</dd>';
+
+	if (isset($context['ban']['reason']))
+		echo '
+				<dt>
+					<strong><label for="reason">', $txt['ban_reason'], ':</label></strong><br>
+					<span class="smalltext">', $txt['ban_reason_desc'], '</span>
+				</dt>
+				<dd>
+					<textarea name="reason" id="reason" cols="40" rows="3" style="min-height: 64px; max-height: 64px; min-width: 50%; max-width: 99%;">', $context['ban']['reason'], '</textarea>
+				</dd>';
+
+	if (isset($context['ban']['notes']))
+		echo '
+				<dt>
+					<strong><label for="ban_notes">', $txt['ban_notes'], ':</label></strong><br>
+					<span class="smalltext">', $txt['ban_notes_desc'], '</span>
+				</dt>
+				<dd>
+					<textarea name="notes" id="ban_notes" cols="40" rows="3" style="min-height: 64px; max-height: 64px; min-width: 50%; max-width: 99%;">', $context['ban']['notes'], '</textarea>
+				</dd>';
+
+	echo '
+				</dl>
+				<fieldset class="ban_settings floatleft">
+					<legend>
+						', $txt['ban_expiration'], '
+					</legend>
+					<input type="radio" name="expiration" value="never" id="never_expires" onclick="fUpdateStatus();"', $context['ban']['expiration']['status'] == 'never' ? ' checked' : '', ' class="input_radio"> <label for="never_expires">', $txt['never'], '</label><br>
+					<input type="radio" name="expiration" value="one_day" id="expires_one_day" onclick="fUpdateStatus();"', $context['ban']['expiration']['status'] == 'one_day' ? ' checked' : '', ' class="input_radio"> <label for="expires_one_day">', $txt['ban_will_expire_within'], '</label>: <input type="number" name="expire_date" id="expire_date" size="3" value="', $context['ban']['expiration']['days'], '" class="input_text"> ', $txt['ban_days'], '<br>
+					<input type="radio" name="expiration" value="expired" id="already_expired" onclick="fUpdateStatus();"', $context['ban']['expiration']['status'] == 'expired' ? ' checked' : '', ' class="input_radio"> <label for="already_expired">', $txt['ban_expired'], '</label>
+				</fieldset>
+				<fieldset class="ban_settings floatright">
+					<legend>
+						', $txt['ban_restriction'], '
+					</legend>
+					<input type="radio" name="full_ban" id="full_ban" value="1" onclick="fUpdateStatus();"', $context['ban']['cannot']['access'] ? ' checked' : '', ' class="input_radio"> <label for="full_ban">', $txt['ban_full_ban'], '</label><br>
+					<input type="radio" name="full_ban" id="partial_ban" value="0" onclick="fUpdateStatus();"', !$context['ban']['cannot']['access'] ? ' checked' : '', ' class="input_radio"> <label for="partial_ban">', $txt['ban_partial_ban'], '</label><br>
+					<input type="checkbox" name="cannot_post" id="cannot_post" value="1"', $context['ban']['cannot']['post'] ? ' checked' : '', ' class="ban_restriction input_radio"> <label for="cannot_post">', $txt['ban_cannot_post'], '</label> (<a href="', $scripturl, '?action=helpadmin;help=ban_cannot_post" onclick="return reqOverlayDiv(this.href);">?</a>)<br>
+					<input type="checkbox" name="cannot_register" id="cannot_register" value="1"', $context['ban']['cannot']['register'] ? ' checked' : '', ' class="ban_restriction input_radio"> <label for="cannot_register">', $txt['ban_cannot_register'], '</label><br>
+					<input type="checkbox" name="cannot_login" id="cannot_login" value="1"', $context['ban']['cannot']['login'] ? ' checked' : '', ' class="ban_restriction input_radio"> <label for="cannot_login">', $txt['ban_cannot_login'], '</label><br>
+				</fieldset>
+				<br class="clear_right">';
+
+	if (!empty($context['ban_suggestions']))
+	{
+		echo '
+				<fieldset>
+					<legend>
+						<input type="checkbox" onclick="invertAll(this, this.form, \'ban_suggestion\');" class="input_check"> ', $txt['ban_triggers'], '
+					</legend>
 					<dl class="settings">
 						<dt>
-							<strong>', $txt['ban_name'], ':</strong>
+							<input type="checkbox" name="ban_suggestions[]" id="main_ip_check" value="main_ip" class="input_check"', !empty($context['ban_suggestions']['main_ip']) ? ' checked' : '', '>
+							<label for="main_ip_check">', $txt['ban_on_ip'], '</label>
 						</dt>
 						<dd>
-							<input type="text" name="ban_name" value="', $context['ban']['name'], '" size="45" maxlength="60" class="input_text" />
-						</dd>
+							<input type="text" name="main_ip" value="', $context['ban_suggestions']['main_ip'], '" size="44" onfocus="document.getElementById(\'main_ip_check\').checked = true;" class="input_text">
+						</dd>';
+
+		if (empty($modSettings['disableHostnameLookup']))
+			echo '
+						<dt>
+							<input type="checkbox" name="ban_suggestions[]" id="hostname_check" value="hostname" class="input_check"', !empty($context['ban_suggestions']['hostname']) ? ' checked' : '', '>
+							<label for="hostname_check">', $txt['ban_on_hostname'], '</label>
+						</dt>
+						<dd>
+							<input type="text" name="hostname" value="', $context['ban_suggestions']['hostname'], '" size="44" onfocus="document.getElementById(\'hostname_check\').checked = true;" class="input_text">
+						</dd>';
+
+		echo '
 						<dt>
-							<strong>', $txt['ban_reason'], ':</strong><br />
-							<span class="smalltext">', $txt['ban_reason_desc'], '</span>
+							<input type="checkbox" name="ban_suggestions[]" id="email_check" value="email" class="input_check"', !empty($context['ban_suggestions']['email']) ? ' checked' : '', '>
+							<label for="email_check">', $txt['ban_on_email'], '</label>
 						</dt>
 						<dd>
-							<textarea name="reason" cols="44" rows="3">', $context['ban']['reason'], '</textarea>
+							<input type="text" name="email" value="', $context['ban_suggestions']['email'], '" size="44" onfocus="document.getElementById(\'email_check\').checked = true;" class="input_text">
 						</dd>
 						<dt>
-							<strong>', $txt['ban_notes'], ':</strong><br />
-							<span class="smalltext">', $txt['ban_notes_desc'], '</span>
+							<input type="checkbox" name="ban_suggestions[]" id="user_check" value="user" class="input_check"', !empty($context['ban_suggestions']['user']) ||  isset($context['ban']['from_user']) ? ' checked' : '', '>
+							<label for="user_check">', $txt['ban_on_username'], '</label>:
 						</dt>
 						<dd>
-							<textarea name="notes" cols="44" rows="3">', $context['ban']['notes'], '</textarea>
+							<input type="text" ', isset($context['ban']['from_user']) ? 'readonly value="' . $context['ban_suggestions']['member']['name'] . '"' : ' value=""', ' name="user" id="user" size="44" class="input_text">
 						</dd>
-					</dl>
-					<fieldset class="ban_settings floatleft">
-						<legend>
-							', $txt['ban_expiration'], '
-						</legend>
-						<input type="radio" name="expiration" value="never" id="never_expires" onclick="fUpdateStatus();"', $context['ban']['expiration']['status'] == 'never' ? ' checked="checked"' : '', ' class="input_radio" /> <label for="never_expires">', $txt['never'], '</label><br />
-						<input type="radio" name="expiration" value="one_day" id="expires_one_day" onclick="fUpdateStatus();"', $context['ban']['expiration']['status'] == 'still_active_but_we_re_counting_the_days' ? ' checked="checked"' : '', ' class="input_radio" /> <label for="expires_one_day">', $txt['ban_will_expire_within'], '</label>: <input type="text" name="expire_date" id="expire_date" size="3" value="', $context['ban']['expiration']['days'], '" class="input_text" /> ', $txt['ban_days'], '<br />
-						<input type="radio" name="expiration" value="expired" id="already_expired" onclick="fUpdateStatus();"', $context['ban']['expiration']['status'] == 'expired' ? ' checked="checked"' : '', ' class="input_radio" /> <label for="already_expired">', $txt['ban_expired'], '</label>
-					</fieldset>
-					<fieldset class="ban_settings floatright">
-						<legend>
-							', $txt['ban_restriction'], '
-						</legend>
-						<input type="radio" name="full_ban" id="full_ban" value="1" onclick="fUpdateStatus();"', $context['ban']['cannot']['access'] ? ' checked="checked"' : '', ' class="input_radio" /> <label for="full_ban">', $txt['ban_full_ban'], '</label><br />
-						<input type="radio" name="full_ban" id="partial_ban" value="0" onclick="fUpdateStatus();"', !$context['ban']['cannot']['access'] ? ' checked="checked"' : '', ' class="input_radio" /> <label for="partial_ban">', $txt['ban_partial_ban'], '</label><br />
-						<input type="checkbox" name="cannot_post" id="cannot_post" value="1"', $context['ban']['cannot']['post'] ? ' checked="checked"' : '', ' class="ban_restriction input_radio" /> <label for="cannot_post">', $txt['ban_cannot_post'], '</label> (<a href="', $scripturl, '?action=helpadmin;help=ban_cannot_post" onclick="return reqWin(this.href);">?</a>)<br />
-						<input type="checkbox" name="cannot_register" id="cannot_register" value="1"', $context['ban']['cannot']['register'] ? ' checked="checked"' : '', ' class="ban_restriction input_radio" /> <label for="cannot_register">', $txt['ban_cannot_register'], '</label><br />
-						<input type="checkbox" name="cannot_login" id="cannot_login" value="1"', $context['ban']['cannot']['login'] ? ' checked="checked"' : '', ' class="ban_restriction input_radio" /> <label for="cannot_login">', $txt['ban_cannot_login'], '</label><br />
-					</fieldset>
-					<br class="clear_right" />';
-
-	if (!empty($context['ban_suggestions']))
-	{
-		echo '
-					<fieldset>
-						<legend>
-							', $txt['ban_triggers'], '
-						</legend>
-						<dl class="settings">
-							<dt>
-								<input type="checkbox" name="ban_suggestion[]" id="main_ip_check" value="main_ip" class="input_check" />
-								<label for="main_ip_check">', $txt['ban_on_ip'], '</label>
-							</dt>
-							<dd>
-								<input type="text" name="main_ip" value="', $context['ban_suggestions']['main_ip'], '" size="44" onfocus="document.getElementById(\'main_ip_check\').checked = true;" class="input_text" />
-							</dd>';
-
-		if (empty($modSettings['disableHostnameLookup']))
-			echo '
-							<dt>
-								<input type="checkbox" name="ban_suggestion[]" id="hostname_check" value="hostname" class="input_check" />
-								<label for="hostname_check">', $txt['ban_on_hostname'], '</label>
-							</dt>
-							<dd>
-								<input type="text" name="hostname" value="', $context['ban_suggestions']['hostname'], '" size="44" onfocus="document.getElementById(\'hostname_check\').checked = true;" class="input_text" />
-							</dd>';
-
-		echo '
-							<dt>
-								<input type="checkbox" name="ban_suggestion[]" id="email_check" value="email" class="input_check" checked="checked" />
-								<label for="email_check">', $txt['ban_on_email'], '</label>
-							</dt>
-							<dd>
-								<input type="text" name="email" value="', $context['ban_suggestions']['email'], '" size="44" onfocus="document.getElementById(\'email_check\').checked = true;" class="input_text" />
-							</dd>
-							<dt>
-								<input type="checkbox" name="ban_suggestion[]" id="user_check" value="user" class="input_check" checked="checked" />
-								<label for="user_check">', $txt['ban_on_username'], '</label>:
-							</dt>
-							<dd>';
-
-		if (empty($context['ban_suggestions']['member']['id']))
-			echo '
-								<input type="text" name="user" id="user" value="" size="44" class="input_text" />';
-		else
-			echo '
-								', $context['ban_suggestions']['member']['link'], '
-								<input type="hidden" name="bannedUser" value="', $context['ban_suggestions']['member']['id'], '" />';
-		echo '
-							</dd>';
-
-		if (!empty($context['ban_suggestions']['message_ips']))
-		{
-			echo '
-						</dl>
-						<div>', $txt['ips_in_messages'], ':</div>
-						<dl class="settings">';
+					</dl>';
 
-			foreach ($context['ban_suggestions']['message_ips'] as $ip)
-				echo '
-							<dt>
-								<input type="checkbox" name="ban_suggestion[ips][]" value="', $ip, '" class="input_check" />
-							</dt>
-							<dd>
-								', $ip, '
-							</dd>';
-		}
-
-		if (!empty($context['ban_suggestions']['error_ips']))
+		if (!empty($context['ban_suggestions']['other_ips']))
 		{
-			echo '
-						</dl>
-						<div>', $txt['ips_in_errors'], '</div>
-						<dl class="settings">';
+			foreach ($context['ban_suggestions']['other_ips'] as $key => $ban_ips)
+			{
+				if (!empty($ban_ips))
+				{
+					echo '
+					<div>', $txt[$key], ':</div>
+					<dl class="settings">';
+
+					$count = 0;
+					foreach ($ban_ips as $ip)
+						echo '
+						<dt>
+							<input type="checkbox" id="suggestions_', $key ,'_', $count, '" name="ban_suggestions[', $key ,'][]"', !empty($context['ban_suggestions']['saved_triggers'][$key]) && in_array($ip, $context['ban_suggestions']['saved_triggers'][$key]) ? ' checked' : '', ' value="', $ip, '" class="input_check">
+						</dt>
+						<dd>
+							<label for="suggestions_', $key ,'_', $count++, '">', $ip, '</label>
+						</dd>';
 
-			foreach ($context['ban_suggestions']['error_ips'] as $ip)
-				echo '
-							<dt>
-								<input type="checkbox" name="ban_suggestion[ips][]" value="', $ip, '" class="input_check" />
-							</dt>
-							<dd>
-								', $ip, '
-							</dd>';
+					echo '
+					</dl>';
+				}
+			}
 		}
 
 		echo '
-							</dl>
-						</fieldset>';
+				</fieldset>';
 	}
 
 	echo '
-						<div class="righttext">
-							<input type="submit" name="', $context['ban']['is_new'] ? 'add_ban' : 'modify_ban', '" value="', $context['ban']['is_new'] ? $txt['ban_add'] : $txt['ban_modify'], '" class="button_submit" />
-							<input type="hidden" name="old_expire" value="', $context['ban']['expiration']['days'], '" />
-							<input type="hidden" name="bg" value="', $context['ban']['id'], '" />
-							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						</div>
-					</form>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
+				<input type="submit" name="', $context['ban']['is_new'] ? 'add_ban' : 'modify_ban', '" value="', $context['ban']['is_new'] ? $txt['ban_add'] : $txt['ban_modify'], '" class="button_submit">
+				<input type="hidden" name="old_expire" value="', $context['ban']['expiration']['days'], '">
+				<input type="hidden" name="bg" value="', $context['ban']['id'], '">', isset($context['ban']['from_user']) ? '
+				<input type="hidden" name="u" value="' . $context['ban_suggestions']['member']['id'] . '">' : '', '
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-bet_token_var'], '" value="', $context['admin-bet_token'], '">
+			</div>
+		</form>';
 
 	if (!$context['ban']['is_new'] && empty($context['ban_suggestions']))
 	{
 		echo '
-			<br />
-			<form action="', $scripturl, '?action=admin;area=ban;sa=edit" method="post" accept-charset="', $context['character_set'], '" style="padding: 0px;margin: 0px;" onsubmit="return confirm(\'', $txt['ban_remove_selected_triggers_confirm'], '\');">
-				<table class="table_grid" width="100%">
-					<thead>
-						<tr class="catbg">
-							<th width="65%" align="left">', $txt['ban_banned_entity'], '</td>
-							<th width="15%" align="center">', $txt['ban_hits'], '</td>
-							<th width="15%" align="center">', $txt['ban_actions'], '</td>
-							<th width="5%" align="center"><input type="checkbox" onclick="invertAll(this, this.form, \'ban_items\');" class="input_check" /></td>
-						</tr>
-					</thead>
-					<tbody>';
-		if (empty($context['ban_items']))
-			echo '
-						<tr class="windowbg2">
-							<td colspan="4">(', $txt['ban_no_triggers'], ')</td>
-						</tr>';
-		else
-		{
-			foreach ($context['ban_items'] as $ban_item)
-			{
-				echo '
-						<tr class="windowbg2" align="left">
-							<td>';
-				if ($ban_item['type'] == 'ip')
-					echo '		<strong>', $txt['ip'], ':</strong>&nbsp;', $ban_item['ip'];
-				elseif ($ban_item['type'] == 'hostname')
-					echo '		<strong>', $txt['hostname'], ':</strong>&nbsp;', $ban_item['hostname'];
-				elseif ($ban_item['type'] == 'email')
-					echo '		<strong>', $txt['email'], ':</strong>&nbsp;', $ban_item['email'];
-				elseif ($ban_item['type'] == 'user')
-					echo '		<strong>', $txt['username'], ':</strong>&nbsp;', $ban_item['user']['link'];
-				echo '
-							</td>
-							<td class="windowbg" align="center">', $ban_item['hits'], '</td>
-							<td class="windowbg" align="center"><a href="', $scripturl, '?action=admin;area=ban;sa=edittrigger;bg=', $context['ban']['id'], ';bi=', $ban_item['id'], '">', $txt['ban_edit_trigger'], '</a></td>
-							<td align="center" class="windowbg2"><input type="checkbox" name="ban_items[]" value="', $ban_item['id'], '" class="input_check" /></td>
-						</tr>';
-			}
-		}
-
-		echo '
-					</tbody>
-				</table>
-				<div class="additional_rows">
-					<div class="floatleft">
-						[<a href="', $scripturl, '?action=admin;area=ban;sa=edittrigger;bg=', $context['ban']['id'], '">', $txt['ban_add_trigger'], '</a>]
-					</div>
-					<div class="floatright">
-						<input type="submit" name="remove_selection" value="', $txt['ban_remove_selected_triggers'], '" class="button_submit" />
-					</div>
-				</div>
-				<br class="clear" />
-				<input type="hidden" name="bg" value="', $context['ban']['id'], '" />
-				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			</form>';
-
+		<br>';
+		template_show_list('ban_items');
 	}
 
 	echo '
 	</div>
-	<br class="clear" />
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var fUpdateStatus = function ()
 		{
 			document.getElementById("expire_date").disabled = !document.getElementById("expires_one_day").checked;
@@ -256,8 +203,8 @@
 		echo '
 			var oAddMemberSuggest = new smc_AutoSuggest({
 			sSelf: \'oAddMemberSuggest\',
-			sSessionId: \'', $context['session_id'], '\',
-			sSessionVar: \'', $context['session_var'], '\',
+			sSessionId: smf_session_id,
+			sSessionVar: smf_session_var,
 			sSuggestId: \'user\',
 			sControlId: \'user\',
 			sSearchType: \'member\',
@@ -272,80 +219,89 @@
 		}
 		oAddMemberSuggest.registerCallback(\'onBeforeUpdate\', \'onUpdateName\');';
 
-	echo '// ]]></script>';
+	echo '
+		function confirmBan(aForm)
+		{
+			if (aForm.ban_name.value == \'\')
+			{
+				alert(\'', $txt['ban_name_empty'], '\');
+				return false;
+			}
+
+			if (aForm.partial_ban.checked && !(aForm.cannot_post.checked || aForm.cannot_register.checked || aForm.cannot_login.checked))
+			{
+				alert(\'', $txt['ban_restriction_empty'], '\');
+				return false;
+			}
+		}// ]]></script>';
 }
 
 function template_ban_edit_trigger()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $txt, $modSettings;
 
 	echo '
 	<div id="manage_bans">
-		<form action="', $scripturl, '?action=admin;area=ban;sa=edit" method="post" accept-charset="', $context['character_set'], '">
+		<form id="admin_form_wrapper" action="', $context['form_url'], '" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">
 					', $context['ban_trigger']['is_new'] ? $txt['ban_add_trigger'] : $txt['ban_edit_trigger_title'], '
 				</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<fieldset>
-						<legend>
-							', $txt['ban_triggers'], '
-						</legend>
-						<dl class="settings">
-							<dt>
-								<input type="radio" name="bantype" value="ip_ban"', $context['ban_trigger']['ip']['selected'] ? ' checked="checked"' : '', ' class="input_radio" />
-								', $txt['ban_on_ip'], '
-							</dt>
-							<dd>
-								<input type="text" name="ip" value="', $context['ban_trigger']['ip']['value'], '" size="50" onfocus="selectRadioByName(this.form.bantype, \'ip_ban\');" class="input_text" />
-							</dd>';
+				<fieldset>
+					<legend>
+						<input type="checkbox" onclick="invertAll(this, this.form, \'ban_suggestion\');" class="input_check"> ', $txt['ban_triggers'], '
+					</legend>
+					<dl class="settings">
+						<dt>
+							<input type="checkbox" name="ban_suggestions[]" id="main_ip_check" value="main_ip" class="input_check"', $context['ban_trigger']['ip']['selected'] ? ' checked' : '', '>
+							<label for="main_ip_check">', $txt['ban_on_ip'], '</label>
+						</dt>
+						<dd>
+							<input type="text" name="main_ip" value="', $context['ban_trigger']['ip']['value'], '" size="44" onfocus="document.getElementById(\'main_ip_check\').checked = true;" class="input_text">
+						</dd>';
+
 				if (empty($modSettings['disableHostnameLookup']))
-				echo '
+					echo '
 							<dt>
-								<input type="radio" name="bantype" value="hostname_ban"', $context['ban_trigger']['hostname']['selected'] ? ' checked="checked"' : '', ' class="input_radio" />
-								', $txt['ban_on_hostname'], '
+								<input type="checkbox" name="ban_suggestions[]" id="hostname_check" value="hostname" class="input_check"', $context['ban_trigger']['hostname']['selected'] ? ' checked' : '', '>
+								<label for="hostname_check">', $txt['ban_on_hostname'], '</label>
 							</dt>
 							<dd>
-								<input type="text" name="hostname" value="', $context['ban_trigger']['hostname']['value'], '" size="50" onfocus="selectRadioByName(this.form.bantype, \'hostname_ban\');" class="input_text" />
+								<input type="text" name="hostname" value="', $context['ban_trigger']['hostname']['value'], '" size="44" onfocus="document.getElementById(\'hostname_check\').checked = true;" class="input_text">
 							</dd>';
+
 				echo '
-							<dt>
-								<input type="radio" name="bantype" value="email_ban"', $context['ban_trigger']['email']['selected'] ? ' checked="checked"' : '', ' class="input_radio" />
-								', $txt['ban_on_email'], '
-							</dt>
-							<dd>
-								<input type="text" name="email" value="', $context['ban_trigger']['email']['value'], '" size="50" onfocus="selectRadioByName(this.form.bantype, \'email_ban\');" class="input_text" />
-							</dd>
-							<dt>
-								<input type="radio" name="bantype" value="user_ban"', $context['ban_trigger']['banneduser']['selected'] ? ' checked="checked"' : '', ' class="input_radio" />
-								', $txt['ban_on_username'], '
-							</dt>
-							<dd>
-								<input type="text" name="user" id="user" value="', $context['ban_trigger']['banneduser']['value'], '" size="50" onfocus="selectRadioByName(this.form.bantype, \'user_ban\');" class="input_text" />
-							</dd>
-						</dl>
-					</fieldset>
-					<div class="righttext">
-						<input type="submit" name="', $context['ban_trigger']['is_new'] ? 'add_new_trigger' : 'edit_trigger', '" value="', $context['ban_trigger']['is_new'] ? $txt['ban_add_trigger_submit'] : $txt['ban_edit_trigger_submit'], '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
+						<dt>
+							<input type="checkbox" name="ban_suggestions[]" id="email_check" value="email" class="input_check"', $context['ban_trigger']['email']['selected'] ? ' checked' : '', '>
+							<label for="email_check">', $txt['ban_on_email'], '</label>
+						</dt>
+						<dd>
+							<input type="text" name="email" value="', $context['ban_trigger']['email']['value'], '" size="44" onfocus="document.getElementById(\'email_check\').checked = true;" class="input_text">
+						</dd>
+						<dt>
+							<input type="checkbox" name="ban_suggestions[]" id="user_check" value="user" class="input_check"', $context['ban_trigger']['banneduser']['selected'] ? ' checked' : '', '>
+							<label for="user_check">', $txt['ban_on_username'], '</label>:
+						</dt>
+						<dd>
+							<input type="text" value="' . $context['ban_trigger']['banneduser']['value'] . '" name="user" id="user" size="44"  onfocus="document.getElementById(\'user_check\').checked = true;"class="input_text">
+						</dd>
+					</dl>
+				</fieldset>
+				<input type="submit" name="', $context['ban_trigger']['is_new'] ? 'add_new_trigger' : 'edit_trigger', '" value="', $context['ban_trigger']['is_new'] ? $txt['ban_add_trigger_submit'] : $txt['ban_edit_trigger_submit'], '" class="button_submit">
 			</div>
-			<input type="hidden" name="bi" value="' . $context['ban_trigger']['id'] . '" />
-			<input type="hidden" name="bg" value="' . $context['ban_trigger']['group'] . '" />
-			<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '" />
+			<input type="hidden" name="bi" value="' . $context['ban_trigger']['id'] . '">
+			<input type="hidden" name="bg" value="' . $context['ban_trigger']['group'] . '">
+			<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '">
+			<input type="hidden" name="', $context['admin-bet_token_var'], '" value="', $context['admin-bet_token'], '">
 		</form>
 	</div>
-	<br class="clear" />
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var oAddMemberSuggest = new smc_AutoSuggest({
 			sSelf: \'oAddMemberSuggest\',
-			sSessionId: \'', $context['session_id'], '\',
-			sSessionVar: \'', $context['session_var'], '\',
+			sSessionId: smf_session_id,
+			sSessionVar: smf_session_var,
 			sSuggestId: \'username\',
 			sControlId: \'user\',
 			sSearchType: \'member\',
@@ -355,7 +311,7 @@
 
 		function onUpdateName(oAutoSuggest)
 		{
-			selectRadioByName(oAutoSuggest.oTextHandle.form.bantype, \'user_ban\');
+			document.getElementById(\'user_check\').checked = true;
 			return true;
 		}
 		oAddMemberSuggest.registerCallback(\'onBeforeUpdate\', \'onUpdateName\');
diff -ru a/Themes/default/ManageBoards.template.php b/Themes/default/ManageBoards.template.php
--- a/Themes/default/ManageBoards.template.php	2011-06-10 03:42:24.000000000 -0700
+++ b/Themes/default/ManageBoards.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,40 +3,37 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Template for listing all the current categories and boards.
 function template_main()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
 	// Table header.
 	echo '
 	<div id="manage_boards">
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['boardsEdit'], '</h3>
-		</div>';
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['boardsEdit'], '</h3>
+		</div>
+		<div class="windowbg2">';
 
 	if (!empty($context['move_board']))
 		echo '
-		<div class="information">
-			<p>', $context['move_title'], ' [<a href="', $scripturl, '?action=admin;area=manageboards">', $txt['mboards_cancel_moving'], '</a>]', '</p>
+		<div class="noticebox">
+			', $context['move_title'], ' [<a href="', $scripturl, '?action=admin;area=manageboards">', $txt['mboards_cancel_moving'], '</a>]', '
 		</div>';
 
 	// No categories so show a label.
 	if (empty($context['categories']))
 		echo '
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content centertext">
-				', $txt['mboards_no_cats'], '
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg centertext">
+			', $txt['mboards_no_cats'], '
 		</div>';
 
 	// Loop through every category, listing the boards in each as we go.
@@ -44,480 +41,528 @@
 	{
 		// Link to modify the category.
 		echo '
-			<div class="cat_bar">
-				<h3 class="catbg">
-					<a href="' . $scripturl . '?action=admin;area=manageboards;sa=cat;cat=' . $category['id'] . '">', $category['name'], '</a> <a href="' . $scripturl . '?action=admin;area=manageboards;sa=cat;cat=' . $category['id'] . '">', $txt['catModify'], '</a>
+			<div class="sub_bar">
+				<h3 class="subbg">
+					<a href="', $scripturl, '?action=admin;area=manageboards;sa=cat;cat=', $category['id'], '">', $category['name'], '</a> <a href="', $scripturl, '?action=admin;area=manageboards;sa=cat;cat=', $category['id'], '">', $txt['catModify'], '</a>
 				</h3>
 			</div>';
 
 		// Boards table header.
 		echo '
 		<form action="', $scripturl, '?action=admin;area=manageboards;sa=newboard;cat=', $category['id'], '" method="post" accept-charset="', $context['character_set'], '">
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<ul id="category_', $category['id'], '" style="float:left; width:100%;">';
+				<ul id="category_', $category['id'], '" class="reset nolist">';
 
 		if (!empty($category['move_link']))
 			echo '
-						<li><a href="', $category['move_link']['href'], '" title="', $category['move_link']['label'], '"><img src="', $settings['images_url'], '/smiley_select_spot.gif" alt="', $category['move_link']['label'], '" /></a></li>';
+					<li><a href="', $category['move_link']['href'], '" title="', $category['move_link']['label'], '"><span class="generic_icons select_above"></span></a></li>';
 
-		$alternate = false;
+		$recycle_board = '<a href="' . $scripturl . '?action=admin;area=manageboards;sa=settings"> <img src="' . $settings['images_url'] . '/post/recycled.png" alt="' . $txt['recycle_board'] . '" title="' . $txt['recycle_board'] . '"></a>';
+		$redirect_board = '<img src="' . $settings['images_url'] . '/new_redirect.png" alt="' . $txt['redirect_board_desc'] . '" title="' . $txt['redirect_board_desc'] . '">';
 
 		// List through every board in the category, printing its name and link to modify the board.
 		foreach ($category['boards'] as $board)
 		{
-			$alternate = !$alternate;
 
 			echo '
-						<li', !empty($modSettings['recycle_board']) && !empty($modSettings['recycle_enable']) && $modSettings['recycle_board'] == $board['id'] ? ' id="recycle_board"' : ' ', ' class="windowbg', $alternate ? '' : '2', '" style="padding-' . ($context['right_to_left'] ? 'right' : 'left') . ': ', 5 + 30 * $board['child_level'], 'px;', $board['move'] ? 'color: red;' : '', '"><span class="floatleft"><a href="', $scripturl, '?board=', $board['id'], '">', $board['name'], '</a>', !empty($modSettings['recycle_board']) && !empty($modSettings['recycle_enable']) && $modSettings['recycle_board'] == $board['id'] ? '<a href="' . $scripturl . '?action=admin;area=manageboards;sa=settings"> <img src="' . $settings['images_url'] . '/post/recycled.gif" alt="' . $txt['recycle_board'] . '" /></a></span>' : '</span>', '
-							<span class="floatright">', $context['can_manage_permissions'] ? '<span class="modify_boards"><a href="' . $scripturl . '?action=admin;area=permissions;sa=index;pid=' . $board['permission_profile'] . ';' . $context['session_var'] . '=' . $context['session_id'] . '">' . $txt['mboards_permissions'] . '</a></span>' : '', '
-							<span class="modify_boards"><a href="', $scripturl, '?action=admin;area=manageboards;move=', $board['id'], '">', $txt['mboards_move'], '</a></span>
-							<span class="modify_boards"><a href="', $scripturl, '?action=admin;area=manageboards;sa=board;boardid=', $board['id'], '">', $txt['mboards_modify'], '</a></span></span><br style="clear: right;" />
-						</li>';
+					<li', !empty($modSettings['recycle_board']) && !empty($modSettings['recycle_enable']) && $modSettings['recycle_board'] == $board['id'] ? ' id="recycle_board"' : ' ', ' class="windowbg', $board['is_redirect'] ? ' redirect_board' : '', '" style="padding-' . ($context['right_to_left'] ? 'right' : 'left') . ': ', 5 + 30 * $board['child_level'], 'px;">
+						<span class="floatleft"><a', $board['move'] ? ' class="red"' : '', ' href="', $scripturl, '?board=', $board['id'], '.0">', $board['name'], '</a>', !empty($modSettings['recycle_board']) && !empty($modSettings['recycle_enable']) && $modSettings['recycle_board'] == $board['id'] ? $recycle_board : '', $board['is_redirect'] ? $redirect_board : '', '</span>
+						<span class="floatright">
+							', $context['can_manage_permissions'] ? '<a href="' . $scripturl . '?action=admin;area=permissions;sa=index;pid=' . $board['permission_profile'] . ';' . $context['session_var'] . '=' . $context['session_id'] . '" class="button">' . $txt['mboards_permissions'] . '</a>' : '', '
+							<a href="', $scripturl, '?action=admin;area=manageboards;move=', $board['id'], '" class="button">', $txt['mboards_move'], '</a>
+							<a href="', $scripturl, '?action=admin;area=manageboards;sa=board;boardid=', $board['id'], '" class="button">', $txt['mboards_modify'], '</a>
+						</span><br style="clear: right;">
+					</li>';
 
 			if (!empty($board['move_links']))
 			{
-				$alternate = !$alternate;
 
 				echo '
-						<li class="windowbg', $alternate ? '' : '2', '" style="padding-', $context['right_to_left'] ? 'right' : 'left', ': ', 5 + 30 * $board['move_links'][0]['child_level'], 'px;">';
+					<li class="windowbg" style="padding-', $context['right_to_left'] ? 'right' : 'left', ': ', 5 + 30 * $board['move_links'][0]['child_level'], 'px;">';
 
 				foreach ($board['move_links'] as $link)
 					echo '
-							<a href="', $link['href'], '" class="move_links" title="', $link['label'], '"><img src="', $settings['images_url'], '/board_select_spot', $link['child_level'] > 0 ? '_child' : '', '.gif" alt="', $link['label'], '" style="padding: 0px; margin: 0px;" /></a>';
+						<a href="', $link['href'], '" class="move_links" title="', $link['label'], '"><span class="generic_icons select_', $link['class'], '" title="', $link['label'], '"></span></a>';
 
 				echo '
-						</li>';
+					</li>';
 			}
 		}
 
 		// Button to add a new board.
 		echo '
-					</ul>
-					<div class="righttext">
-						<input type="submit" value="', $txt['mboards_new_board'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
+				</ul>
+				<input type="submit" value="', $txt['mboards_new_board'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 		</form>';
 	}
+
 	echo '
-	</div>
-	<br class="clear" />';
+		</div>
+	</div>';
 }
 
 // Template for editing/adding a category on the forum.
 function template_modify_category()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	// Print table header.
 	echo '
 	<div id="manage_boards">
 		<form action="', $scripturl, '?action=admin;area=manageboards;sa=cat2" method="post" accept-charset="', $context['character_set'], '">
-			<input type="hidden" name="cat" value="', $context['category']['id'], '" />
+			<input type="hidden" name="cat" value="', $context['category']['id'], '">
 				<div class="cat_bar">
 					<h3 class="catbg">
-					', isset($context['category']['is_new']) ? $txt['mboards_new_cat_name'] : $txt['catEdit'], '
+						', isset($context['category']['is_new']) ? $txt['mboards_new_cat_name'] : $txt['catEdit'], '
 					</h3>
 				</div>
-				<div class="windowbg">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<dl class="settings">';
+				<div class="windowbg2">
+					<dl class="settings">';
+
 	// If this isn't the only category, let the user choose where this category should be positioned down the board index.
 	if (count($context['category_order']) > 1)
 	{
 		echo '
-						<dt><strong>', $txt['order'], ':</strong></dt>
-						<dd>
-							<select name="cat_order">';
+					<dt><strong>', $txt['order'], ':</strong></dt>
+					<dd>
+						<select name="cat_order">';
+
 		// Print every existing category into a select box.
 		foreach ($context['category_order'] as $order)
 			echo '
-								<option', $order['selected'] ? ' selected="selected"' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
+							<option', $order['selected'] ? ' selected' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
 		echo '
-							</select>
-						</dd>';
+						</select>
+					</dd>';
 	}
+
 	// Allow the user to edit the category name and/or choose whether you can collapse the category.
 	echo '
-						<dt>
-							<strong>', $txt['full_name'], ':</strong><br />
-							<span class="smalltext">', $txt['name_on_display'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="cat_name" value="', $context['category']['editable_name'], '" size="30" tabindex="', $context['tabindex']++, '" class="input_text" />
-						</dd>
-						<dt>
-							<strong>' . $txt['collapse_enable'] . '</strong><br />
-							<span class="smalltext">' . $txt['collapse_desc'] . '</span>
-						</dt>
-						<dd>
-							<input type="checkbox" name="collapse"', $context['category']['can_collapse'] ? ' checked="checked"' : '', ' tabindex="', $context['tabindex']++, '" class="input_check" />
-						</dd>';
+					<dt>
+						<strong>', $txt['full_name'], ':</strong><br>
+						<span class="smalltext">', $txt['name_on_display'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="cat_name" value="', $context['category']['editable_name'], '" size="30" tabindex="', $context['tabindex']++, '" class="input_text">
+					</dd>
+					<dt>
+						<strong>', $txt['mboards_description'], '</strong><br>
+						<span class="smalltext">', $txt['mboards_cat_description_desc'], '</span>
+					</dt>
+					<dd>
+						<textarea name="cat_desc" rows="3" cols="35" style="width: 99%;">', $context['category']['description'], '</textarea>
+					</dd>
+					<dt>
+							<strong>', $txt['collapse_enable'], '</strong><br>
+						<span class="smalltext">', $txt['collapse_desc'], '</span>
+					</dt>
+					<dd>
+						<input type="checkbox" name="collapse"', $context['category']['can_collapse'] ? ' checked' : '', ' tabindex="', $context['tabindex']++, '" class="input_check">
+					</dd>';
 
 	// Table footer.
 	echo '
-					</dl>
-					<div class="righttext">';
+				</dl>';
 
 	if (isset($context['category']['is_new']))
 		echo '
-						<input type="submit" name="add" value="', $txt['mboards_add_cat_button'], '" onclick="return !isEmptyText(this.form.cat_name);" tabindex="', $context['tabindex']++, '" class="button_submit" />';
+					<input type="submit" name="add" value="', $txt['mboards_add_cat_button'], '" onclick="return !isEmptyText(this.form.cat_name);" tabindex="', $context['tabindex']++, '" class="button_submit">';
 	else
 		echo '
-						<input type="submit" name="edit" value="', $txt['modify'], '" onclick="return !isEmptyText(this.form.cat_name);" tabindex="', $context['tabindex']++, '" class="button_submit" />
-						<input type="submit" name="delete" value="', $txt['mboards_delete_cat'], '" onclick="return confirm(\'', $txt['catConfirm'], '\');" class="button_submit" />';
+					<input type="submit" name="edit" value="', $txt['modify'], '" onclick="return !isEmptyText(this.form.cat_name);" tabindex="', $context['tabindex']++, '" class="button_submit">
+					<input type="submit" name="delete" value="', $txt['mboards_delete_cat'], '" data-confirm="', $txt['catConfirm'], '" class="button_submit you_sure">';
 	echo '
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />';
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">';
 
 	// If this category is empty we don't bother with the next confirmation screen.
 	if ($context['category']['is_empty'])
 		echo '
-						<input type="hidden" name="empty" value="1" />';
+					<input type="hidden" name="empty" value="1">';
 
 	echo '
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // A template to confirm if a user wishes to delete a category - and whether they want to save the boards.
 function template_confirm_category_delete()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	// Print table header.
 	echo '
-	<div id="manage_boards">
+	<div id="manage_boards" class="roundframe">
 		<form action="', $scripturl, '?action=admin;area=manageboards;sa=cat2" method="post" accept-charset="', $context['character_set'], '">
-			<input type="hidden" name="cat" value="', $context['category']['id'], '" />
+			<input type="hidden" name="cat" value="', $context['category']['id'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['mboards_delete_cat'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>', $txt['mboards_delete_cat_contains'], ':</p>
-					<ul>';
+				<p>', $txt['mboards_delete_cat_contains'], ':</p>
+				<ul>';
 
 	foreach ($context['category']['children'] as $child)
 		echo '
-						<li>', $child, '</li>';
+					<li>', $child, '</li>';
 
 	echo '
-					</ul>
-				</div>
-				<span class="botslice"><span></span></span>
+				</ul>
 			</div>
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['mboards_delete_what_do'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>
-						<label for="delete_action0"><input type="radio" id="delete_action0" name="delete_action" value="0" class="input_radio" checked="checked" />', $txt['mboards_delete_option1'], '</label><br />
-						<label for="delete_action1"><input type="radio" id="delete_action1" name="delete_action" value="1" class="input_radio"', count($context['category_order']) == 1 ? ' disabled="disabled"' : '', ' />', $txt['mboards_delete_option2'], '</label>:
-						<select name="cat_to" ', count($context['category_order']) == 1 ? 'disabled="disabled"' : '', '>';
+				<p>
+					<label for="delete_action0"><input type="radio" id="delete_action0" name="delete_action" value="0" class="input_radio" checked>', $txt['mboards_delete_option1'], '</label><br>
+					<label for="delete_action1"><input type="radio" id="delete_action1" name="delete_action" value="1" class="input_radio"', count($context['category_order']) == 1 ? ' disabled' : '', '>', $txt['mboards_delete_option2'], '</label>:
+					<select name="cat_to"', count($context['category_order']) == 1 ? ' disabled' : '', '>';
 
 	foreach ($context['category_order'] as $cat)
 		if ($cat['id'] != 0)
 			echo '
-							<option value="', $cat['id'], '">', $cat['true_name'], '</option>';
+						<option value="', $cat['id'], '">', $cat['true_name'], '</option>';
 
 	echo '
-						</select>
-					</p>
-					<input type="submit" name="delete" value="', $txt['mboards_delete_confirm'], '" class="button_submit" />
-					<input type="submit" name="cancel" value="', $txt['mboards_delete_cancel'], '" class="button_submit" />
-					<input type="hidden" name="confirmation" value="1" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</div>
-				<span class="botslice"><span></span></span>
+					</select>
+				</p>
+				<input type="submit" name="delete" value="', $txt['mboards_delete_confirm'], '" class="button_submit">
+				<input type="submit" name="cancel" value="', $txt['mboards_delete_cancel'], '" class="button_submit">
+				<input type="hidden" name="confirmation" value="1">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Below is the template for adding/editing an board on the forum.
 function template_modify_board()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	// The main table header.
 	echo '
 	<div id="manage_boards">
 		<form action="', $scripturl, '?action=admin;area=manageboards;sa=board2" method="post" accept-charset="', $context['character_set'], '">
-			<input type="hidden" name="boardid" value="', $context['board']['id'], '" />
+			<input type="hidden" name="boardid" value="', $context['board']['id'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">
 					', isset($context['board']['is_new']) ? $txt['mboards_new_board_name'] : $txt['boardsEdit'], '
 				</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">';
+			<div class="windowbg2">
+				<dl class="settings">';
 
 	// Option for choosing the category the board lives in.
 	echo '
 
-						<dt>
-							<strong>', $txt['mboards_category'], ':</strong>
+					<dt>
+						<strong>', $txt['mboards_category'], ':</strong>
 
-						</dt>
-						<dd>
-							<select name="new_cat" onchange="if (this.form.order) {this.form.order.disabled = this.options[this.selectedIndex].value != 0; this.form.board_order.disabled = this.options[this.selectedIndex].value != 0 || this.form.order.options[this.form.order.selectedIndex].value == \'\';}">';
+					</dt>
+					<dd>
+						<select name="new_cat" onchange="if (this.form.order) {this.form.order.disabled = this.options[this.selectedIndex].value != 0; this.form.board_order.disabled = this.options[this.selectedIndex].value != 0 || this.form.order.options[this.form.order.selectedIndex].value == \'\';}">';
 		foreach ($context['categories'] as $category)
 			echo '
-								<option', $category['selected'] ? ' selected="selected"' : '', ' value="', $category['id'], '">', $category['name'], '</option>';
+							<option', $category['selected'] ? ' selected' : '', ' value="', $category['id'], '">', $category['name'], '</option>';
 		echo '
-							</select>
-						</dd>';
+						</select>
+					</dd>';
 
 	// If this isn't the only board in this category let the user choose where the board is to live.
 	if ((isset($context['board']['is_new']) && count($context['board_order']) > 0) || count($context['board_order']) > 1)
 	{
 		echo '
-						<dt>
-							<strong>', $txt['order'], ':</strong>
-						</dt>
-						<dd>';
+					<dt>
+						<strong>', $txt['order'], ':</strong>
+					</dt>
+					<dd>';
 
 	// The first select box gives the user the option to position it before, after or as a child of another board.
 	echo '
-							<select id="order" name="placement" onchange="this.form.board_order.disabled = this.options[this.selectedIndex].value == \'\';">
-								', !isset($context['board']['is_new']) ? '<option value="">(' . $txt['mboards_unchanged'] . ')</option>' : '', '
-								<option value="after">' . $txt['mboards_order_after'] . '...</option>
-								<option value="child">' . $txt['mboards_order_child_of'] . '...</option>
-								<option value="before">' . $txt['mboards_order_before'] . '...</option>
-							</select>';
+						<select id="order" name="placement" onchange="this.form.board_order.disabled = this.options[this.selectedIndex].value == \'\';">
+							', !isset($context['board']['is_new']) ? '<option value="">(' . $txt['mboards_unchanged'] . ')</option>' : '', '
+							<option value="after">' . $txt['mboards_order_after'] . '...</option>
+							<option value="child">' . $txt['mboards_order_child_of'] . '...</option>
+							<option value="before">' . $txt['mboards_order_before'] . '...</option>
+						</select>';
 
 	// The second select box lists all the boards in the category.
 	echo '
-							<select id="board_order" name="board_order" ', isset($context['board']['is_new']) ? '' : 'disabled="disabled"', '>
-								', !isset($context['board']['is_new']) ? '<option value="">(' . $txt['mboards_unchanged'] . ')</option>' : '';
+						<select id="board_order" name="board_order"', !isset($context['board']['is_new']) ? ' disabled' : '', '>
+							', !isset($context['board']['is_new']) ? '<option value="">(' . $txt['mboards_unchanged'] . ')</option>' : '';
 	foreach ($context['board_order'] as $order)
 		echo '
-								<option', $order['selected'] ? ' selected="selected"' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
+							<option', $order['selected'] ? ' selected' : '', ' value="', $order['id'], '">', $order['name'], '</option>';
 	echo '
-							</select>
-						</dd>';
+						</select>
+					</dd>';
 	}
 
 	// Options for board name and description.
 	echo '
-						<dt>
-							<strong>', $txt['full_name'], ':</strong><br />
-							<span class="smalltext">', $txt['name_on_display'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="board_name" value="', $context['board']['name'], '" size="30" class="input_text" />
-						</dd>
-						<dt>
-							<strong>', $txt['mboards_description'], ':</strong><br />
-							<span class="smalltext">', $txt['mboards_description_desc'], '</span>
-						</dt>
-						<dd>
-							<textarea name="desc" rows="3" cols="35" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 99%; min-width: 99%' : 'width: 99%') . ';">', $context['board']['description'], '</textarea>
-						</dd>
-						<dt>
-							<strong>', $txt['permission_profile'], ':</strong><br />
-							<span class="smalltext">', $context['can_manage_permissions'] ? sprintf($txt['permission_profile_desc'], $scripturl . '?action=admin;area=permissions;sa=profiles;' . $context['session_var'] . '=' . $context['session_id']) : strip_tags($txt['permission_profile_desc']), '</span>
-						</dt>
-						<dd>
-							<select name="profile">';
+					<dt>
+						<strong>', $txt['full_name'], ':</strong><br>
+						<span class="smalltext">', $txt['name_on_display'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="board_name" value="', $context['board']['name'], '" size="30" class="input_text">
+					</dd>
+					<dt>
+						<strong>', $txt['mboards_description'], ':</strong><br>
+						<span class="smalltext">', $txt['mboards_description_desc'], '</span>
+					</dt>
+					<dd>
+						<textarea name="desc" rows="3" cols="35" style="width:99%;">', $context['board']['description'], '</textarea>
+					</dd>
+					<dt>
+						<strong>', $txt['permission_profile'], ':</strong><br>
+						<span class="smalltext">', $context['can_manage_permissions'] ? sprintf($txt['permission_profile_desc'], $scripturl . '?action=admin;area=permissions;sa=profiles;' . $context['session_var'] . '=' . $context['session_id']) : strip_tags($txt['permission_profile_desc']), '</span>
+					</dt>
+					<dd>
+						<select name="profile">';
 
 	if (isset($context['board']['is_new']))
 		echo '
-								<option value="-1">[', $txt['permission_profile_inherit'], ']</option>';
+							<option value="-1">[', $txt['permission_profile_inherit'], ']</option>';
 
 	foreach ($context['profiles'] as $id => $profile)
 		echo '
-								<option value="', $id, '" ', $id == $context['board']['profile'] ? 'selected="selected"' : '', '>', $profile['name'], '</option>';
+							<option value="', $id, '"', $id == $context['board']['profile'] ? ' selected' : '', '>', $profile['name'], '</option>';
 
 	echo '
-							</select>
-						</dd>
-						<dt>
-							<strong>', $txt['mboards_groups'], ':</strong><br />
-							<span class="smalltext">', $txt['mboards_groups_desc'], '</span>
-						</dt>
-						<dd>';
+						</select>
+					</dd>
+					<dt>
+						<strong>', $txt['mboards_groups'], ':</strong><br>
+						<span class="smalltext">', empty($modSettings['deny_boards_access']) ? $txt['mboards_groups_desc'] : $txt['boardsaccess_option_desc'], '</span>';
+
+	echo '
+					</dt>
+					<dd>';
+
+	if (!empty($modSettings['deny_boards_access']))
+		echo '
+						<table>
+							<tr>
+								<td></td>
+								<th>', $txt['permissions_option_on'], '</th>
+								<th>', $txt['permissions_option_off'], '</th>
+								<th>', $txt['permissions_option_deny'], '</th>
+							</tr>';
 
 	// List all the membergroups so the user can choose who may access this board.
 	foreach ($context['groups'] as $group)
+		if (empty($modSettings['deny_boards_access']))
+			echo '
+						<label for="groups_', $group['id'], '">
+							<input type="checkbox" name="groups[', $group['id'], ']" value="allow" id="groups_', $group['id'], '"', in_array($group['id'], $context['board_managers']) ? ' checked disabled' : ($group['allow'] ? ' checked' : ''), ' class="input_check">
+							<span', $group['is_post_group'] ? ' class="post_group" title="' . $txt['mboards_groups_post_group'] . '"' : ($group['id'] == 0 ? ' class="regular_members" title="' . $txt['mboards_groups_regular_members'] . '"' : ''), '>
+								', $group['name'], '
+							</span>
+						</label><br>';
+		else
+			echo '
+							<tr>
+								<td>
+									<label for="groups_', $group['id'], '_a">
+										<span', $group['is_post_group'] ? ' class="post_group" title="' . $txt['mboards_groups_post_group'] . '"' : ($group['id'] == 0 ? ' class="regular_members" title="' . $txt['mboards_groups_regular_members'] . '"' : ''), '>
+											', $group['name'], '
+										</span>
+									</label>
+								</td>
+								<td>
+									<input type="radio" name="groups[', $group['id'], ']" value="allow" id="groups_', $group['id'], '_a"', in_array($group['id'], $context['board_managers']) ? ' checked disabled' : ($group['allow'] ? ' checked' : ''), ' class="input_radio">
+								</td>
+								<td>
+									<input type="radio" name="groups[', $group['id'], ']" value="ignore" id="groups_', $group['id'], '_x"', in_array($group['id'], $context['board_managers']) ? ' disabled' : (!$group['allow'] && !$group['deny'] ? ' checked' : ''), ' class="input_radio">
+								</td>
+								<td>
+									<input type="radio" name="groups[', $group['id'], ']" value="deny" id="groups_', $group['id'], '_d"', in_array($group['id'], $context['board_managers']) ? ' disabled' : ($group['deny'] ? ' checked' : ''), ' class="input_radio">
+								</td>
+								<td></td>
+							</tr>';
+
+	if (empty($modSettings['deny_boards_access']))
+		echo '
+						<span class="select_all_box">
+							<em>', $txt['check_all'], '</em> <input type="checkbox" class="input_check" onclick="invertAll(this, this.form, \'groups[\');">
+						</span>
+						<br><br>
+					</dd>';
+	else
 		echo '
-							<label for="groups_', $group['id'], '">
-								<input type="checkbox" name="groups[]" value="', $group['id'], '" id="groups_', $group['id'], '"', $group['checked'] ? ' checked="checked"' : '', ' class="input_check" />
-								<span', $group['is_post_group'] ? ' class="post_group" title="' . $txt['mboards_groups_post_group'] . '"' : '', $group['id'] == 0 ? ' class="regular_members" title="' . $txt['mboards_groups_regular_members'] . '"' : '', '>
-									', $group['name'], '
-								</span>
-							</label><br />';
-	echo '
-							<em>', $txt['check_all'], '</em> <input type="checkbox" class="input_check" onclick="invertAll(this, this.form, \'groups[]\');" /><br />
-							<br />
-						</dd>';
+							<tr class="select_all_box">
+								<td>
+								</td>
+								<td>
+									<input type="radio" name="select_all" class="input_radio" onclick="selectAllRadio(this, this.form, \'groups\', \'allow\');">
+								</td>
+								<td>
+									<input type="radio" name="select_all" class="input_radio" onclick="selectAllRadio(this, this.form, \'groups\', \'ignore\');">
+								</td>
+								<td>
+									<input type="radio" name="select_all" class="input_radio" onclick="selectAllRadio(this, this.form, \'groups\', \'deny\');">
+								</td>
+								<td>
+									<em>', $txt['check_all'], '</em>
+								</td>
+							</tr>
+						</table>
+					</dd>';
+
+	// Options to choose moderators, specify as announcement board and choose whether to count posts here.
+	echo '
+					<dt>
+						<strong>', $txt['mboards_moderators'], ':</strong><br>
+						<span class="smalltext">', $txt['mboards_moderators_desc'], '</span><br>
+					</dt>
+					<dd>
+						<input type="text" name="moderators" id="moderators" value="', $context['board']['moderator_list'], '" size="30" class="input_text">
+						<div id="moderator_container"></div>
+					</dd>
+					<dt>
+						<strong>', $txt['mboards_moderator_groups'], ':</strong><br>
+						<span class="smalltext">', $txt['mboards_moderator_groups_desc'], '</span><br>
+					</dt>
+					<dd>
+						<input type="text" name="moderator_groups" id="moderator_groups" value="', $context['board']['moderator_groups_list'], '" size="30" class="input_text">
+						<div id="moderator_group_container"></div>
+					</dd>
+				</dl>
+				<script><!-- // --><![CDATA[
+					$(document).ready(function () {
+						$(".select_all_box").each(function () {
+							$(this).removeClass(\'select_all_box\');
+						});
+					});
+				// ]]></script>
+				<hr class="hrcolor">';
 
-	// Options to choose moderators, specifiy as announcement board and choose whether to count posts here.
-	echo '
+	if (empty($context['board']['is_recycle']) && empty($context['board']['topics']))
+	{
+		echo '
+				<dl class="settings">
+					<dt>
+						<strong', $context['board']['topics'] ? ' style="color: gray;"' : '', '>', $txt['mboards_redirect'], ':</strong><br>
+						<span class="smalltext">', $txt['mboards_redirect_desc'], '</span><br>
+					</dt>
+					<dd>
+						<input type="checkbox" id="redirect_enable" name="redirect_enable"', $context['board']['redirect'] != '' ? ' checked' : '', ' onclick="refreshOptions();" class="input_check">
+					</dd>
+				</dl>
+
+				<div id="redirect_address_div">
+					<dl class="settings">
 						<dt>
-							<strong>', $txt['mboards_moderators'], ':</strong><br />
-							<span class="smalltext">', $txt['mboards_moderators_desc'], '</span><br />
+							<strong>', $txt['mboards_redirect_url'], ':</strong><br>
+							<span class="smalltext">', $txt['mboards_redirect_url_desc'], '</span><br>
 						</dt>
 						<dd>
-							<input type="text" name="moderators" id="moderators" value="', $context['board']['moderator_list'], '" size="30" class="input_text" />
-							<div id="moderator_container"></div>
+							<input type="text" name="redirect_address" value="', $context['board']['redirect'], '" size="40" class="input_text">
 						</dd>
 					</dl>
-					<hr class="hrcolor" />';
+				</div>';
 
-	if (empty($context['board']['is_recycle']) && empty($context['board']['topics']))
-		echo '
+		if ($context['board']['redirect'])
+			echo '
+				<div id="reset_redirect_div">
 					<dl class="settings">
 						<dt>
-							<strong', $context['board']['topics'] ? ' style="color: gray;"' : '', '>', $txt['mboards_redirect'], ':</strong><br />
-							<span class="smalltext">', $txt['mboards_redirect_desc'], '</span><br />
+							<strong>', $txt['mboards_redirect_reset'], ':</strong><br>
+							<span class="smalltext">', $txt['mboards_redirect_reset_desc'], '</span><br>
 						</dt>
 						<dd>
-							<input type="checkbox" id="redirect_enable" name="redirect_enable"', $context['board']['topics'] ? ' disabled="disabled"' : '', $context['board']['redirect'] != '' ? ' checked="checked"' : '', ' onclick="refreshOptions();" class="input_check" />
+							<input type="checkbox" name="reset_redirect" class="input_check">
+							<em>(', sprintf($txt['mboards_current_redirects'], $context['board']['posts']), ')</em>
 						</dd>
-					</dl>';
-
-	if (!empty($context['board']['is_recycle']))
-		echo '
-					<div class="information">', $txt['mboards_redirect_disabled_recycle'], '</div>';
-
-	if (empty($context['board']['is_recycle']) && !empty($context['board']['topics']))
-		echo '
-					<div class="information">
-						<strong>', $txt['mboards_redirect'],'</strong><br />
-						', $txt['mboards_redirect_disabled'], '
-					</div>';
-
-	if (!$context['board']['topics'] && empty($context['board']['is_recycle']))
-	{
-		echo '
-					<div id="redirect_address_div">
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['mboards_redirect_url'], ':</strong><br />
-								<span class="smalltext">', $txt['mboards_redirect_url_desc'], '</span><br />
-							</dt>
-							<dd>
-								<input type="text" name="redirect_address" value="', $context['board']['redirect'], '" size="40" class="input_text" />
-							</dd>
-						</dl>
-					</div>';
-
-		if ($context['board']['redirect'])
-			echo '
-					<div id="reset_redirect_div">
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['mboards_redirect_reset'], ':</strong><br />
-								<span class="smalltext">', $txt['mboards_redirect_reset_desc'], '</span><br />
-							</dt>
-							<dd>
-								<input type="checkbox" name="reset_redirect" class="input_check" />
-								<em>(', sprintf($txt['mboards_current_redirects'], $context['board']['posts']), ')</em>
-							</dd>
-						</dl>
-					</div>';
+					</dl>
+				</div>';
 	}
 
 	echo '
-					<div id="count_posts_div">
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['mboards_count_posts'], ':</strong><br />
-								<span class="smalltext">', $txt['mboards_count_posts_desc'], '</span><br />
-							</dt>
-							<dd>
-								<input type="checkbox" name="count" ', $context['board']['count_posts'] ? ' checked="checked"' : '', ' class="input_check" />
-							</dd>
-						</dl>
-					</div>';
+				<div id="count_posts_div">
+					<dl class="settings">
+						<dt>
+							<strong>', $txt['mboards_count_posts'], ':</strong><br>
+							<span class="smalltext">', $txt['mboards_count_posts_desc'], '</span><br>
+						</dt>
+						<dd>
+							<input type="checkbox" name="count"', $context['board']['count_posts'] ? ' checked' : '', ' class="input_check">
+						</dd>
+					</dl>
+				</div>';
 
 	// Here the user can choose to force this board to use a theme other than the default theme for the forum.
 	echo '
-					<div id="board_theme_div">
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['mboards_theme'], ':</strong><br />
-								<span class="smalltext">', $txt['mboards_theme_desc'], '</span><br />
-							</dt>
-							<dd>
-								<select name="boardtheme" id="boardtheme" onchange="refreshOptions();">
-									<option value="0"', $context['board']['theme'] == 0 ? ' selected="selected"' : '', '>', $txt['mboards_theme_default'], '</option>';
+				<div id="board_theme_div">
+					<dl class="settings">
+						<dt>
+							<strong>', $txt['mboards_theme'], ':</strong><br>
+							<span class="smalltext">', $txt['mboards_theme_desc'], '</span><br>
+						</dt>
+						<dd>
+							<select name="boardtheme" id="boardtheme" onchange="refreshOptions();">
+								<option value="0"', $context['board']['theme'] == 0 ? ' selected' : '', '>', $txt['mboards_theme_default'], '</option>';
 
 	foreach ($context['themes'] as $theme)
 		echo '
-									<option value="', $theme['id'], '"', $context['board']['theme'] == $theme['id'] ? ' selected="selected"' : '', '>', $theme['name'], '</option>';
+									<option value="', $theme['id'], '"', $context['board']['theme'] == $theme['id'] ? ' selected' : '', '>', $theme['name'], '</option>';
 
 	echo '
-								</select>
-							</dd>
-						</dl>
-					</div>
-					<div id="override_theme_div">
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['mboards_override_theme'], ':</strong><br />
-								<span class="smalltext">', $txt['mboards_override_theme_desc'], '</span><br />
-							</dt>
-							<dd>
-								<input type="checkbox" name="override_theme"', $context['board']['override_theme'] ? ' checked="checked"' : '', ' class="input_check" />
-							</dd>
-						</dl>
-					</div>';
+							</select>
+						</dd>
+					</dl>
+				</div>
+				<div id="override_theme_div">
+					<dl class="settings">
+						<dt>
+							<strong>', $txt['mboards_override_theme'], ':</strong><br>
+							<span class="smalltext">', $txt['mboards_override_theme_desc'], '</span><br>
+						</dt>
+						<dd>
+							<input type="checkbox" name="override_theme"', $context['board']['override_theme'] ? ' checked' : '', ' class="input_check">
+						</dd>
+					</dl>
+				</div>';
 
 	if (!empty($context['board']['is_recycle']))
-		echo '<div class="information">', $txt['mboards_recycle_disabled_delete'], '</div>';
+		echo '
+				<div class="noticebox">', $txt['mboards_recycle_disabled_delete'], '</div>';
 
 	echo '
-					<input type="hidden" name="rid" value="', $context['redirect_location'], '" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />';
+				<input type="hidden" name="rid" value="', $context['redirect_location'], '">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-be-' . $context['board']['id'] . '_token_var'], '" value="', $context['admin-be-' . $context['board']['id'] . '_token'], '">';
 
 	// If this board has no children don't bother with the next confirmation screen.
 	if ($context['board']['no_children'])
 		echo '
-					<input type="hidden" name="no_children" value="1" />';
+				<input type="hidden" name="no_children" value="1">';
 
 	if (isset($context['board']['is_new']))
 		echo '
-					<input type="hidden" name="cur_cat" value="', $context['board']['category'], '" />
-					<input type="submit" name="add" value="', $txt['mboards_new_board'], '" onclick="return !isEmptyText(this.form.board_name);" class="button_submit" />';
+				<input type="hidden" name="cur_cat" value="', $context['board']['category'], '">
+				<input type="submit" name="add" value="', $txt['mboards_new_board'], '" onclick="return !isEmptyText(this.form.board_name);" class="button_submit">';
 	else
 		echo '
-					<input type="submit" name="edit" value="', $txt['modify'], '" onclick="return !isEmptyText(this.form.board_name);" class="button_submit" />';
+				<input type="submit" name="edit" value="', $txt['modify'], '" onclick="return !isEmptyText(this.form.board_name);" class="button_submit">';
 
 	if (!isset($context['board']['is_new']) && empty($context['board']['is_recycle']))
 		echo '
-					<span', $context['board']['is_recycle'] ? ' style="visibility:hidden">' : '>', '<input type="submit" name="delete" value="', $txt['mboards_delete_board'], '" onclick="return confirm(\'', $txt['boardConfirm'], '\');"', ' class="button_submit" /></span>';
+				<input type="submit" name="delete" value="', $txt['mboards_delete_board'], '" data-confirm="', $txt['boardConfirm'], '" class="button_submit you_sure">';
 	echo '
-				</div>
-				<span class="botslice"><span></span></span>
 			</div>
 		</form>
 	</div>
-	<br class="clear" />
-<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-<script type="text/javascript"><!-- // --><![CDATA[
+
+<script><!-- // --><![CDATA[
 	var oModeratorSuggest = new smc_AutoSuggest({
 		sSelf: \'oModeratorSuggest\',
-		sSessionId: \'', $context['session_id'], '\',
-		sSessionVar: \'', $context['session_var'], '\',
+		sSessionId: smf_session_id,
+		sSessionVar: smf_session_var,
 		sSuggestId: \'moderators\',
 		sControlId: \'moderators\',
 		sSearchType: \'member\',
@@ -538,11 +583,36 @@
 	echo '
 		]
 	});
+
+	var oModeratorGroupSuggest = new smc_AutoSuggest({
+		sSelf: \'oModeratorGroupSuggest\',
+		sSessionId: smf_session_id,
+		sSessionVar: smf_session_var,
+		sSuggestId: \'moderator_groups\',
+		sControlId: \'moderator_groups\',
+		sSearchType: \'membergroups\',
+		bItemList: true,
+		sPostName: \'moderator_group_list\',
+		sURLMask: \'action=groups;sa=members;group=%item_id%\',
+		sTextDeleteItem: \'', $txt['autosuggest_delete_item'], '\',
+		sItemListContainerId: \'moderator_group_container\',
+		aListItems: [';
+
+	foreach ($context['board']['moderator_groups'] as $id_group => $group_name)
+		echo '
+					{
+						sItemId: ', JavaScriptEscape($id_group), ',
+						sItemName: ', JavaScriptEscape($group_name), '
+					}', $id_group == $context['board']['last_moderator_group_id'] ? '' : ',';
+
+		echo '
+			]
+		});
 // ]]></script>';
 
 	// Javascript for deciding what to show.
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		function refreshOptions()
 		{
 			var redirect = document.getElementById("redirect_enable");
@@ -573,61 +643,53 @@
 // A template used when a user is deleting a board with child boards in it - to see what they want to do with them.
 function template_confirm_board_delete()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	// Print table header.
 	echo '
-	<div id="manage_boards">
+	<div id="manage_boards" class="roundframe">
 		<form action="', $scripturl, '?action=admin;area=manageboards;sa=board2" method="post" accept-charset="', $context['character_set'], '">
-			<input type="hidden" name="boardid" value="', $context['board']['id'], '" />
+			<input type="hidden" name="boardid" value="', $context['board']['id'], '">
 
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['mboards_delete_board'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>', $txt['mboards_delete_board_contains'], '</p>
-						<ul>';
+				<p>', $txt['mboards_delete_board_contains'], '</p>
+					<ul>';
 
 	foreach ($context['children'] as $child)
 		echo '
-							<li>', $child['node']['name'], '</li>';
+						<li>', $child['node']['name'], '</li>';
 
 	echo '
-						</ul>
-				</div>
-				<span class="botslice"><span></span></span>
+					</ul>
 			</div>
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['mboards_delete_what_do'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>
-						<label for="delete_action0"><input type="radio" id="delete_action0" name="delete_action" value="0" class="input_radio" checked="checked" />', $txt['mboards_delete_board_option1'], '</label><br />
-						<label for="delete_action1"><input type="radio" id="delete_action1" name="delete_action" value="1" class="input_radio"', empty($context['can_move_children']) ? ' disabled="disabled"' : '', ' />', $txt['mboards_delete_board_option2'], '</label>:
-						<select name="board_to" ', empty($context['can_move_children']) ? 'disabled="disabled"' : '', '>';
+				<p>
+					<label for="delete_action0"><input type="radio" id="delete_action0" name="delete_action" value="0" class="input_radio" checked>', $txt['mboards_delete_board_option1'], '</label><br>
+					<label for="delete_action1"><input type="radio" id="delete_action1" name="delete_action" value="1" class="input_radio"', empty($context['can_move_children']) ? ' disabled' : '', '>', $txt['mboards_delete_board_option2'], '</label>:
+					<select name="board_to"', empty($context['can_move_children']) ? ' disabled' : '', '>';
 
 	foreach ($context['board_order'] as $board)
 		if ($board['id'] != $context['board']['id'] && empty($board['is_child']))
 			echo '
-							<option value="', $board['id'], '">', $board['name'], '</option>';
+						<option value="', $board['id'], '">', $board['name'], '</option>';
 
 	echo '
-						</select>
-					</p>
-					<input type="submit" name="delete" value="', $txt['mboards_delete_confirm'], '" class="button_submit" />
-					<input type="submit" name="cancel" value="', $txt['mboards_delete_cancel'], '" class="button_submit" />
-					<input type="hidden" name="confirmation" value="1" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</div>
-				<span class="botslice"><span></span></span>
+					</select>
+				</p>
+				<input type="submit" name="delete" value="', $txt['mboards_delete_confirm'], '" class="button_submit">
+				<input type="submit" name="cancel" value="', $txt['mboards_delete_cancel'], '" class="button_submit">
+				<input type="hidden" name="confirmation" value="1">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-be-' . $context['board']['id'] . '_token_var'], '" value="', $context['admin-be-' . $context['board']['id'] . '_token'], '"
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManageCalendar.template.php b/Themes/default/ManageCalendar.template.php
--- a/Themes/default/ManageCalendar.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/ManageCalendar.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,45 +3,17 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Editing or adding holidays.
 function template_edit_holiday()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
-
-	// Start with javascript for getting the calendar dates right.
-	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
-
-			function generateDays()
-			{
-				var days = 0, selected = 0;
-				var dayElement = document.getElementById("day"), yearElement = document.getElementById("year"), monthElement = document.getElementById("month");
-
-				monthLength[1] = 28;
-				if (yearElement.options[yearElement.selectedIndex].value % 4 == 0)
-					monthLength[1] = 29;
-
-				selected = dayElement.selectedIndex;
-				while (dayElement.options.length)
-					dayElement.options[0] = null;
-
-				days = monthLength[monthElement.value - 1];
-
-				for (i = 1; i <= days; i++)
-					dayElement.options[dayElement.length] = new Option(i, i);
-
-				if (selected < days)
-					dayElement.selectedIndex = selected;
-			}
-		// ]]></script>';
+	global $context, $scripturl, $txt, $modSettings;
 
 	// Show a form for all the holiday information.
 	echo '
@@ -50,68 +22,63 @@
 			<div class="cat_bar">
 				<h3 class="catbg">', $context['page_title'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt class="small_caption">
-							<strong>', $txt['holidays_title_label'], ':</strong>
-						</dt>
-						<dd class="small_caption">
-							<input type="text" name="title" value="', $context['holiday']['title'], '" size="55" maxlength="60" />
-						</dd>
-						<dt class="small_caption">
-							<strong>', $txt['calendar_year'], '</strong>
-						</dt>
-						<dd class="small_caption">
-							<select name="year" id="year" onchange="generateDays();">
-								<option value="0000"', $context['holiday']['year'] == '0000' ? ' selected="selected"' : '', '>', $txt['every_year'], '</option>';
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<strong>', $txt['holidays_title_label'], ':</strong>
+					</dt>
+					<dd>
+						<input type="text" name="title" value="', $context['holiday']['title'], '" size="55" maxlength="60">
+					</dd>
+					<dt>
+						<strong>', $txt['calendar_year'], '</strong>
+					</dt>
+					<dd>
+						<select name="year" id="year" onchange="generateDays();">
+							<option value="0000"', $context['holiday']['year'] == '0000' ? ' selected' : '', '>', $txt['every_year'], '</option>';
 	// Show a list of all the years we allow...
 	for ($year = $modSettings['cal_minyear']; $year <= $modSettings['cal_maxyear']; $year++)
 		echo '
-								<option value="', $year, '"', $year == $context['holiday']['year'] ? ' selected="selected"' : '', '>', $year, '</option>';
+							<option value="', $year, '"', $year == $context['holiday']['year'] ? ' selected' : '', '>', $year, '</option>';
 
 	echo '
-							</select>&nbsp;
-							', $txt['calendar_month'], '&nbsp;
-							<select name="month" id="month" onchange="generateDays();">';
+						</select>&nbsp;
+						', $txt['calendar_month'], '&nbsp;
+						<select name="month" id="month" onchange="generateDays();">';
 
 	// There are 12 months per year - ensure that they all get listed.
 	for ($month = 1; $month <= 12; $month++)
 		echo '
-								<option value="', $month, '"', $month == $context['holiday']['month'] ? ' selected="selected"' : '', '>', $txt['months'][$month], '</option>';
+							<option value="', $month, '"', $month == $context['holiday']['month'] ? ' selected' : '', '>', $txt['months'][$month], '</option>';
 
 	echo '
-							</select>&nbsp;
-							', $txt['calendar_day'], '&nbsp;
-							<select name="day" id="day" onchange="generateDays();">';
+						</select>&nbsp;
+						', $txt['calendar_day'], '&nbsp;
+						<select name="day" id="day" onchange="generateDays();">';
 
 	// This prints out all the days in the current month - this changes dynamically as we switch months.
 	for ($day = 1; $day <= $context['holiday']['last_day']; $day++)
 		echo '
-								<option value="', $day, '"', $day == $context['holiday']['day'] ? ' selected="selected"' : '', '>', $day, '</option>';
+							<option value="', $day, '"', $day == $context['holiday']['day'] ? ' selected' : '', '>', $day, '</option>';
 
 	echo '
-							</select>
-						</dd>
-					</dl>';
+						</select>
+					</dd>
+				</dl>';
 
 	if ($context['is_new'])
 		echo '
-					<input type="submit" value="', $txt['holidays_button_add'], '" class="button_submit" />';
+				<input type="submit" value="', $txt['holidays_button_add'], '" class="button_submit">';
 	else
 		echo '
-					<input type="submit" name="edit" value="', $txt['holidays_button_edit'], '" class="button_submit" />
-					<input type="submit" name="delete" value="', $txt['holidays_button_remove'], '" class="button_submit" />
-					<input type="hidden" name="holiday" value="', $context['holiday']['id'], '" />';
+				<input type="submit" name="edit" value="', $txt['holidays_button_edit'], '" class="button_submit">
+				<input type="submit" name="delete" value="', $txt['holidays_button_remove'], '" class="button_submit">
+				<input type="hidden" name="holiday" value="', $context['holiday']['id'], '">';
 	echo '
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</div>
-				<span class="botslice"><span></span></span>
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 ?>
\ No newline at end of file
Only in b/Themes/default: ManageLanguages.template.php
diff -ru a/Themes/default/ManageMail.template.php b/Themes/default/ManageMail.template.php
--- a/Themes/default/ManageMail.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/ManageMail.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,25 +3,24 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_browse()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $txt;
 
 	echo '
 	<div id="manage_mail">
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['mailqueue_stats'], '</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
+		<div id="mailqueue_stats">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['mailqueue_stats'], '</h3>
+			</div>
+			<div class="windowbg2">
 				<dl class="settings">
 					<dt><strong>', $txt['mailqueue_size'], '</strong></dt>
 					<dd>', $context['mail_queue_size'], '</dd>
@@ -29,14 +28,12 @@
 					<dd>', $context['oldest_mail'], '</dd>
 				</dl>
 			</div>
-			<span class="botslice"><span></span></span>
 		</div>';
 
 	template_show_list('mail_queue');
 
 	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManageMaintenance.template.php b/Themes/default/ManageMaintenance.template.php
--- a/Themes/default/ManageMaintenance.template.php	2011-06-06 10:06:37.000000000 -0700
+++ b/Themes/default/ManageMaintenance.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,22 +3,22 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Template for the database maintenance tasks.
 function template_maintain_database()
 {
-	global $context, $settings, $options, $txt, $scripturl, $db_type, $modSettings;
+	global $context, $txt, $scripturl, $modSettings;
 
 	// If maintenance has finished tell the user.
 	if (!empty($context['maintenance_finished']))
 		echo '
-			<div class="maintenance_finished">
+			<div class="infobox">
 				', sprintf($txt['maintain_done'], $context['maintenance_finished']), '
 			</div>';
 
@@ -27,46 +27,32 @@
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['maintain_optimize'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=optimize" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['maintain_optimize_info'], '</p>
-					<span><input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=optimize" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['maintain_optimize_info'], '</p>
+				<input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			</form>
+		</div>';
 
+	// Show an option to convert the body column of the post table to MEDIUMTEXT or TEXT
+	if (isset($context['convert_to']))
+	{
+		echo '
 		<div class="cat_bar">
-			<h3 class="catbg">
-			<span class="ie6_header floatleft"><a href="', $scripturl, '?action=helpadmin;help=maintenance_backup" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" /></a> ', $txt['maintain_backup'], '</span>
-			</h3>
+			<h3 class="catbg">', $txt[$context['convert_to'] . '_title'], '</h3>
 		</div>
-
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=backup" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['maintain_backup_info'], '</p>';
-
-	if ($db_type == 'sqlite')
-		echo '
-					<p><input type="submit" value="', $txt['maintain_backup_save'], '" id="submitDump" class="button_submit" /></p>';
-	else
-		echo '
-					<p><label for="struct"><input type="checkbox" name="struct" id="struct" onclick="document.getElementById(\'submitDump\').disabled = !document.getElementById(\'struct\').checked &amp;&amp; !document.getElementById(\'data\').checked;" class="input_check" checked="checked" /> ', $txt['maintain_backup_struct'], '</label><br />
-					<label for="data"><input type="checkbox" name="data" id="data" onclick="document.getElementById(\'submitDump\').disabled = !document.getElementById(\'struct\').checked &amp;&amp; !document.getElementById(\'data\').checked;" checked="checked" class="input_check" /> ', $txt['maintain_backup_data'], '</label><br />
-					<label for="compress"><input type="checkbox" name="compress" id="compress" value="gzip" checked="checked" class="input_check" /> ', $txt['maintain_backup_gz'], '</label></p>
-					<p><input type="submit" value="', $txt['maintain_backup_save'], '" id="submitDump" onclick="return document.getElementById(\'struct\').checked || document.getElementById(\'data\').checked;" class="button_submit" /></p>';
-
-	echo '
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertmsgbody" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['mediumtext_introduction'], '</p>',
+				$context['convert_to_suggest'] ? '<p class="infobox">' . $txt['convert_to_suggest_text'] . '</p>' : '', '
+				<input type="submit" name="evaluate_conversion" value="', $txt['maintain_run_now'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			</form>
 		</div>';
+	}
 
 	// Show an option to convert to UTF-8 if we're not on UTF-8 yet.
 	if ($context['convert_utf8'])
@@ -75,17 +61,14 @@
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['utf8_title'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertutf8" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['utf8_introduction'], '</p>
-					', !empty($modSettings['search_index']) && $modSettings['search_index'] == 'fulltext' ? '<p class="error">' . $txt['utf8_cannot_convert_fulltext'] . '</p>' : '', '
-					<span><input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit" ', !empty($modSettings['search_index']) && $modSettings['search_index'] == 'fulltext' ? 'disabled="disabled"' : '', '/></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertutf8" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['utf8_introduction'], '</p>
+				', !empty($modSettings['search_index']) && $modSettings['search_index'] == 'fulltext' ? '<div class="errorbox">' . $txt['utf8_cannot_convert_fulltext'] . '</div>' : '', '
+				<input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit" ', !empty($modSettings['search_index']) && $modSettings['search_index'] == 'fulltext' ? 'disabled' : '', '/><br class="clear_right">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			</form>
 		</div>';
 	}
 
@@ -96,127 +79,106 @@
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['entity_convert_title'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertentities" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['entity_convert_introduction'], '</p>
-					<span><input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertentities" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['entity_convert_introduction'], '</p>
+				<input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			</form>
 		</div>';
 	}
 
 	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Template for the routine maintenance tasks.
 function template_maintain_routine()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $txt, $scripturl, $modSettings;
+
+	// Starts off with general maintenance procedures.
+	echo '
+	<div id="manage_maintenance">';
 
 	// If maintenance has finished tell the user.
 	if (!empty($context['maintenance_finished']))
 		echo '
-			<div class="maintenance_finished">
+			<div class="infobox">
 				', sprintf($txt['maintain_done'], $context['maintenance_finished']), '
 			</div>';
 
-	// Starts off with general maintenance procedures.
 	echo '
-	<div id="manage_maintenance">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['maintain_version'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=version" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['maintain_version_info'], '</p>
-					<span><input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=version" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['maintain_version_info'], '
+					<input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				</p>
+			</form>
 		</div>
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['maintain_errors'], '</h3>
 		</div>
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=repairboards" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['maintain_errors_info'], '</p>
-					<span><input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+			<form action="', $scripturl, '?action=admin;area=repairboards" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['maintain_errors_info'], '
+					<input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+				</p>
+			</form>
 		</div>
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['maintain_recount'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=recount" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['maintain_recount_info'], '</p>
-					<span><input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=recount" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['maintain_recount_info'], '
+					<input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+				</p>
+			</form>
 		</div>
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['maintain_logs'], '</h3>
 		</div>
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=logs" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['maintain_logs_info'], '</p>
-					<span><input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=logs" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['maintain_logs_info'], '
+					<input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+				</p>
+			</form>
 		</div>
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['maintain_cache'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=cleancache" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['maintain_cache_info'], '</p>
-					<span><input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=routine;activity=cleancache" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['maintain_cache_info'], '
+					<input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+				</p>
+			</form>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Template for the member maintenance tasks.
 function template_maintain_members()
 {
-	global $context, $settings, $options, $txt, $scripturl;
-
-	// If maintenance has finished tell the user.
-	if (!empty($context['maintenance_finished']))
-		echo '
-			<div class="maintenance_finished">
-				', sprintf($txt['maintain_done'], $context['maintenance_finished']), '
-			</div>';
+	global $context, $settings, $txt, $scripturl;
 
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var warningMessage = \'\';
 		var membersSwap = false;
 
@@ -225,9 +187,10 @@
 			membersSwap = !membersSwap;
 			var membersForm = document.getElementById(\'membersForm\');
 
-			document.getElementById("membersIcon").src = smf_images_url + (membersSwap ? "/collapse.gif" : "/expand.gif");
+			$("#membersPanel").slideToggle(300);
+
+			document.getElementById("membersIcon").src = smf_images_url + (membersSwap ? "/selected_open.png" : "/selected.png");
 			setInnerHTML(document.getElementById("membersText"), membersSwap ? "', $txt['maintain_members_choose'], '" : "', $txt['maintain_members_all'], '");
-			document.getElementById("membersPanel").style.display = (membersSwap ? "block" : "none");
 
 			for (var i = 0; i < membersForm.length; i++)
 			{
@@ -266,89 +229,100 @@
 		}
 		setTimeout("checkAttributeValidity();", 500);
 	// ]]></script>
-	<div id="manage_maintenance">
+	<div id="manage_maintenance">';
+
+	// If maintenance has finished tell the user.
+	if (!empty($context['maintenance_finished']))
+	echo '
+		<div class="infobox">
+			', sprintf($txt['maintain_done'], $context['maintenance_finished']), '
+		</div>';
+
+	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['maintain_reattribute_posts'], '</h3>
 		</div>
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=members;activity=reattribute" method="post" accept-charset="', $context['character_set'], '">
-					<p><strong>', $txt['reattribute_guest_posts'], '</strong></p>
-					<dl class="settings">
-						<dt>
-							<label for="type_email"><input type="radio" name="type" id="type_email" value="email" checked="checked" class="input_radio" />', $txt['reattribute_email'], '</label>
-						</dt>
-						<dd>
-							<input type="text" name="from_email" id="from_email" value="" onclick="document.getElementById(\'type_email\').checked = \'checked\'; document.getElementById(\'from_name\').value = \'\';" />
-						</dd>
-						<dt>
-							<label for="type_name"><input type="radio" name="type" id="type_name" value="name" class="input_radio" />', $txt['reattribute_username'], '</label>
-						</dt>
-						<dd>
-							<input type="text" name="from_name" id="from_name" value="" onclick="document.getElementById(\'type_name\').checked = \'checked\'; document.getElementById(\'from_email\').value = \'\';" class="input_text" />
-						</dd>
-					</dl>
-					<dl class="settings">
-						<dt>
-							<label for="to"><strong>', $txt['reattribute_current_member'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="to" id="to" value="" class="input_text" />
-						</dd>
-					</dl>
-					<p class="maintain_members">
-						<input type="checkbox" name="posts" id="posts" checked="checked" class="input_check" />
-						<label for="posts">', $txt['reattribute_increase_posts'], '</label>
-					</p>
-					<span><input type="submit" id="do_attribute" value="', $txt['reattribute'], '" onclick="if (!checkAttributeValidity()) return false; return confirm(warningMessage);" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=members;activity=reattribute" method="post" accept-charset="', $context['character_set'], '">
+				<p><strong>', $txt['reattribute_guest_posts'], '</strong></p>
+				<dl class="settings">
+					<dt>
+						<label for="type_email"><input type="radio" name="type" id="type_email" value="email" checked class="input_radio">', $txt['reattribute_email'], '</label>
+					</dt>
+					<dd>
+						<input type="text" name="from_email" id="from_email" value="" onclick="document.getElementById(\'type_email\').checked = \'checked\'; document.getElementById(\'from_name\').value = \'\';">
+					</dd>
+					<dt>
+						<label for="type_name"><input type="radio" name="type" id="type_name" value="name" class="input_radio">', $txt['reattribute_username'], '</label>
+					</dt>
+					<dd>
+						<input type="text" name="from_name" id="from_name" value="" onclick="document.getElementById(\'type_name\').checked = \'checked\'; document.getElementById(\'from_email\').value = \'\';" class="input_text">
+					</dd>
+				</dl>
+				<dl class="settings">
+					<dt>
+						<label for="to"><strong>', $txt['reattribute_current_member'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="text" name="to" id="to" value="" class="input_text">
+					</dd>
+				</dl>
+				<p class="maintain_members">
+					<input type="checkbox" name="posts" id="posts" checked class="input_check">
+					<label for="posts">', $txt['reattribute_increase_posts'], '</label>
+				</p>
+				<input type="submit" id="do_attribute" value="', $txt['reattribute'], '" onclick="if (!checkAttributeValidity()) return false;
+				return confirm(warningMessage);" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			</form>
 		</div>
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<span class="ie6_header floatleft">
-					<a href="', $scripturl, '?action=helpadmin;help=maintenance_members" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" /></a> ', $txt['maintain_members'], '
-				</span>
+				<a href="', $scripturl, '?action=helpadmin;help=maintenance_members" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a> ', $txt['maintain_members'], '
 			</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=members;activity=purgeinactive" method="post" accept-charset="', $context['character_set'], '" id="membersForm">
-					<p><a id="membersLink"></a>', $txt['maintain_members_since1'], '
-					<select name="del_type">
-						<option value="activated" selected="selected">', $txt['maintain_members_activated'], '</option>
-						<option value="logged">', $txt['maintain_members_logged_in'], '</option>
-					</select> ', $txt['maintain_members_since2'], ' <input type="text" name="maxdays" value="30" size="3" class="input_text" />', $txt['maintain_members_since3'], '</p>';
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=members;activity=purgeinactive" method="post" accept-charset="', $context['character_set'], '" id="membersForm">
+				<p><a id="membersLink"></a>', $txt['maintain_members_since1'], '
+				<select name="del_type">
+					<option value="activated" selected>', $txt['maintain_members_activated'], '</option>
+					<option value="logged">', $txt['maintain_members_logged_in'], '</option>
+				</select> ', $txt['maintain_members_since2'], ' <input type="number" name="maxdays" value="30" size="3" class="input_text">', $txt['maintain_members_since3'], '</p>';
 
 	echo '
-					<p><a href="#membersLink" onclick="swapMembers();"><img src="', $settings['images_url'], '/expand.gif" alt="+" id="membersIcon" /></a> <a href="#membersLink" onclick="swapMembers();" id="membersText" style="font-weight: bold;">', $txt['maintain_members_all'], '</a></p>
-					<div style="display: none; padding: 3px" id="membersPanel">';
+				<p><a href="#membersLink" onclick="swapMembers();"><img src="', $settings['images_url'], '/selected.png" alt="+" id="membersIcon"></a> <a href="#membersLink" onclick="swapMembers();" id="membersText" style="font-weight: bold;">', $txt['maintain_members_all'], '</a></p>
+				<div style="display: none; padding: 3px" id="membersPanel">';
 
 	foreach ($context['membergroups'] as $group)
 		echo '
-						<label for="groups', $group['id'], '"><input type="checkbox" name="groups[', $group['id'], ']" id="groups', $group['id'], '" checked="checked" class="input_check" /> ', $group['name'], '</label><br />';
+					<label for="groups', $group['id'], '"><input type="checkbox" name="groups[', $group['id'], ']" id="groups', $group['id'], '" checked class="input_check"> ', $group['name'], '</label><br>';
 
 	echo '
-					</div>
-					<span><input type="submit" value="', $txt['maintain_old_remove'], '" onclick="return confirm(\'', $txt['maintain_members_confirm'], '\');" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+				</div>
+				<input type="submit" value="', $txt['maintain_old_remove'], '" data-confirm="', $txt['maintain_members_confirm'], '" class="button_submit you_sure">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			</form>
+		</div>
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['maintain_recountposts'], '</h3>
+		</div>
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=members;activity=recountposts" method="post" accept-charset="', $context['character_set'], '" id="membersRecountForm">
+				<p>', $txt['maintain_recountposts_info'], '</p>
+				<input type="submit" value="', $txt['maintain_run_now'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			</form>
 		</div>
 	</div>
-	<br class="clear" />
 
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var oAttributeMemberSuggest = new smc_AutoSuggest({
 			sSelf: \'oAttributeMemberSuggest\',
-			sSessionId: \'', $context['session_id'], '\',
-			sSessionVar: \'', $context['session_var'], '\',
+			sSessionId: smf_session_id,
+			sSessionVar: smf_session_var,
 			sSuggestId: \'attributeMember\',
 			sControlId: \'to\',
 			sSearchType: \'member\',
@@ -366,24 +340,24 @@
 	// If maintenance has finished tell the user.
 	if (!empty($context['maintenance_finished']))
 		echo '
-			<div class="maintenance_finished">
+			<div class="infobox">
 				', sprintf($txt['maintain_done'], $context['maintenance_finished']), '
 			</div>';
 
 	// Bit of javascript for showing which boards to prune in an otherwise hidden list.
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			var rotSwap = false;
 			function swapRot()
 			{
 				rotSwap = !rotSwap;
 
 				// Toggle icon
-				document.getElementById("rotIcon").src = smf_images_url + (rotSwap ? "/collapse.gif" : "/expand.gif");
+				document.getElementById("rotIcon").src = smf_images_url + (rotSwap ? "/selected_open.png" : "/selected.png");
 				setInnerHTML(document.getElementById("rotText"), rotSwap ? ', JavaScriptEscape($txt['maintain_old_choose']), ' : ', JavaScriptEscape($txt['maintain_old_all']), ');
 
 				// Toggle panel
-				document.getElementById("rotPanel").style.display = !rotSwap ? "none" : "";
+				$("#rotPanel").slideToggle(300);
 
 				// Toggle checkboxes
 				var rotPanel = document.getElementById(\'rotPanel\');
@@ -401,31 +375,25 @@
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['maintain_old'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content flow_auto">
+		<div class="windowbg2">
+			<div class="flow_auto">
 				<form action="', $scripturl, '?action=admin;area=maintain;sa=topics;activity=pruneold" method="post" accept-charset="', $context['character_set'], '">';
 
 	// The otherwise hidden "choose which boards to prune".
 	echo '
 					<p>
-						<a id="rotLink"></a>', $txt['maintain_old_since_days1'], '<input type="text" name="maxdays" value="30" size="3" />', $txt['maintain_old_since_days2'], '
+						<a id="rotLink"></a>', $txt['maintain_old_since_days1'], '<input type="number" name="maxdays" value="30" size="3">', $txt['maintain_old_since_days2'], '
 					</p>
 					<p>
-						<label for="delete_type_nothing"><input type="radio" name="delete_type" id="delete_type_nothing" value="nothing" class="input_radio" /> ', $txt['maintain_old_nothing_else'], '</label><br />
-						<label for="delete_type_moved"><input type="radio" name="delete_type" id="delete_type_moved" value="moved" class="input_radio" checked="checked" /> ', $txt['maintain_old_are_moved'], '</label><br />
-						<label for="delete_type_locked"><input type="radio" name="delete_type" id="delete_type_locked" value="locked" class="input_radio" /> ', $txt['maintain_old_are_locked'], '</label><br />
-					</p>';
-
-	if (!empty($modSettings['enableStickyTopics']))
-		echo '
+						<label for="delete_type_nothing"><input type="radio" name="delete_type" id="delete_type_nothing" value="nothing" class="input_radio"> ', $txt['maintain_old_nothing_else'], '</label><br>
+						<label for="delete_type_moved"><input type="radio" name="delete_type" id="delete_type_moved" value="moved" class="input_radio" checked> ', $txt['maintain_old_are_moved'], '</label><br>
+						<label for="delete_type_locked"><input type="radio" name="delete_type" id="delete_type_locked" value="locked" class="input_radio"> ', $txt['maintain_old_are_locked'], '</label><br>
+					</p>
 					<p>
-						<label for="delete_old_not_sticky"><input type="checkbox" name="delete_old_not_sticky" id="delete_old_not_sticky" class="input_check" checked="checked" /> ', $txt['maintain_old_are_not_stickied'], '</label><br />
-					</p>';
-
-		echo '
+						<label for="delete_old_not_sticky"><input type="checkbox" name="delete_old_not_sticky" id="delete_old_not_sticky" class="input_check" checked> ', $txt['maintain_old_are_not_stickied'], '</label><br>
+					</p>
 					<p>
-						<a href="#rotLink" onclick="swapRot();"><img src="', $settings['images_url'], '/expand.gif" alt="+" id="rotIcon" /></a> <a href="#rotLink" onclick="swapRot();" id="rotText" style="font-weight: bold;">', $txt['maintain_old_all'], '</a>
+						<a href="#rotLink" onclick="swapRot();"><img src="', $settings['images_url'], '/selected.png" alt="+" id="rotIcon"></a> <a href="#rotLink" onclick="swapRot();" id="rotText" style="font-weight: bold;">', $txt['maintain_old_all'], '</a>
 					</p>
 					<div style="display: none;" id="rotPanel" class="flow_hidden">
 						<div class="floatleft" style="width: 49%">';
@@ -444,7 +412,7 @@
 		// Display a checkbox with every board.
 		foreach ($category['boards'] as $board)
 			echo '
-									<li style="margin-', $context['right_to_left'] ? 'right' : 'left', ': ', $board['child_level'] * 1.5, 'em;"><label for="boards_', $board['id'], '"><input type="checkbox" name="boards[', $board['id'], ']" id="boards_', $board['id'], '" checked="checked" class="input_check" />', $board['name'], '</label></li>';
+									<li style="margin-', $context['right_to_left'] ? 'right' : 'left', ': ', $board['child_level'] * 1.5, 'em;"><label for="boards_', $board['id'], '"><input type="checkbox" name="boards[', $board['id'], ']" id="boards_', $board['id'], '" checked class="input_check">', $board['name'], '</label></li>';
 
 		echo '
 								</ul>
@@ -460,70 +428,87 @@
 	echo '
 						</div>
 					</div>
-					<span><input type="submit" value="', $txt['maintain_old_remove'], '" onclick="return confirm(\'', $txt['maintain_old_confirm'], '\');" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+					<input type="submit" value="', $txt['maintain_old_remove'], '" data-confirm="', $txt['maintain_old_confirm'], '" class="button_submit you_sure">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
 				</form>
 			</div>
-			<span class="botslice"><span></span></span>
+		</div>
+
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['maintain_old_drafts'], '</h3>
+		</div>
+		<div class="windowbg2">
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=topics;activity=olddrafts" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['maintain_old_drafts_days'], '&nbsp;<input type="number" name="draftdays" value="', (!empty($modSettings['drafts_keep_days']) ? $modSettings['drafts_keep_days'] : 30), '" size="3">&nbsp;', $txt['days_word'], '</p>
+				<input type="submit" value="', $txt['maintain_old_remove'], '" data-confirm="', $txt['maintain_old_drafts_confirm'], '" class="button_submit you_sure">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			</form>
 		</div>
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['move_topics_maintenance'], '</h3>
 		</div>
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=topics;activity=massmove" method="post" accept-charset="', $context['character_set'], '">
-					<p><label for="id_board_from">', $txt['move_topics_from'], ' </label>
-					<select name="id_board_from" id="id_board_from">
-						<option disabled="disabled">(', $txt['move_topics_select_board'], ')</option>';
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=topics;activity=massmove" method="post" accept-charset="', $context['character_set'], '">
+				<p><label for="id_board_from">', $txt['move_topics_from'], ' </label>
+				<select name="id_board_from" id="id_board_from">
+					<option disabled>(', $txt['move_topics_select_board'], ')</option>';
 
 	// From board
 	foreach ($context['categories'] as $category)
 	{
 		echo '
-						<option disabled="disabled">--------------------------------------</option>
-						<option disabled="disabled">', $category['name'], '</option>
-						<option disabled="disabled">--------------------------------------</option>';
+					<optgroup label="', $category['name'], '">';
 
 		foreach ($category['boards'] as $board)
 			echo '
 						<option value="', $board['id'], '"> ', str_repeat('==', $board['child_level']), '=&gt;&nbsp;', $board['name'], '</option>';
+
+		echo '
+					</optgroup>';
 	}
 
 	echo '
-					</select>
-					<label for="id_board_to">', $txt['move_topics_to'], '</label>
-					<select name="id_board_to" id="id_board_to">
-						<option disabled="disabled">(', $txt['move_topics_select_board'], ')</option>';
+				</select>
+				<label for="id_board_to">', $txt['move_topics_to'], '</label>
+				<select name="id_board_to" id="id_board_to">
+					<option disabled>(', $txt['move_topics_select_board'], ')</option>';
 
 	// To board
 	foreach ($context['categories'] as $category)
 	{
 		echo '
-						<option disabled="disabled">--------------------------------------</option>
-						<option disabled="disabled">', $category['name'], '</option>
-						<option disabled="disabled">--------------------------------------</option>';
+					<optgroup label="', $category['name'], '">';
 
 		foreach ($category['boards'] as $board)
 			echo '
 						<option value="', $board['id'], '"> ', str_repeat('==', $board['child_level']), '=&gt;&nbsp;', $board['name'], '</option>';
+
+		echo '
+					</optgroup>';
 	}
 	echo '
-					</select></p>
-					<span><input type="submit" value="', $txt['move_topics_now'], '" onclick="if (document.getElementById(\'id_board_from\').options[document.getElementById(\'id_board_from\').selectedIndex].disabled || document.getElementById(\'id_board_from\').options[document.getElementById(\'id_board_to\').selectedIndex].disabled) return false; var confirmText = \'', $txt['move_topics_confirm'] . '\'; return confirm(confirmText.replace(/%board_from%/, document.getElementById(\'id_board_from\').options[document.getElementById(\'id_board_from\').selectedIndex].text.replace(/^=+&gt;&nbsp;/, \'\')).replace(/%board_to%/, document.getElementById(\'id_board_to\').options[document.getElementById(\'id_board_to\').selectedIndex].text.replace(/^=+&gt;&nbsp;/, \'\')));" class="button_submit" /></span>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+				</select></p>
+				<p>
+					', $txt['move_topics_older_than'], '<input type="number" name="maxdays" value="30" size="3">', $txt['manageposts_days'], '&nbsp;(', $txt['move_zero_all'], ')
+				</p>
+				<p>
+					<label for="move_type_locked"><input type="checkbox" name="move_type_locked" id="move_type_locked" class="input_check" checked> ', $txt['move_type_locked'], '</label><br>
+					<label for="move_type_sticky"><input type="checkbox" name="move_type_sticky" id="move_type_sticky" class="input_check"> ', $txt['move_type_sticky'], '</label><br>
+				</p>
+				<input type="submit" value="', $txt['move_topics_now'], '" onclick="if (document.getElementById(\'id_board_from\').options[document.getElementById(\'id_board_from\').selectedIndex].disabled || document.getElementById(\'id_board_from\').options[document.getElementById(\'id_board_to\').selectedIndex].disabled) return false; var confirmText = \'', $txt['move_topics_confirm'] . '\'; return confirm(confirmText.replace(/%board_from%/, document.getElementById(\'id_board_from\').options[document.getElementById(\'id_board_from\').selectedIndex].text.replace(/^=+&gt;&nbsp;/, \'\')).replace(/%board_to%/, document.getElementById(\'id_board_to\').options[document.getElementById(\'id_board_to\').selectedIndex].text.replace(/^=+&gt;&nbsp;/, \'\')));" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			</form>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Simple template for showing results of our optimization...
 function template_optimize()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="manage_maintenance">
@@ -531,34 +516,29 @@
 			<h3 class="catbg">', $txt['maintain_optimize'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>
-					', $txt['database_numb_tables'], '<br />
-					', $txt['database_optimize_attempt'], '<br />';
+			<p>
+				', $txt['database_numb_tables'], '<br>
+				', $txt['database_optimize_attempt'], '<br>';
 
 	// List each table being optimized...
 	foreach ($context['optimized_tables'] as $table)
 		echo '
-					', sprintf($txt['database_optimizing'], $table['name'], $table['data_freed']), '<br />';
+				', sprintf($txt['database_optimizing'], $table['name'], $table['data_freed']), '<br>';
 
 	// How did we go?
 	echo '
-					<br />', $context['num_tables_optimized'] == 0 ? $txt['database_already_optimized'] : $context['num_tables_optimized'] . ' ' . $txt['database_optimized'];
+				<br>', $context['num_tables_optimized'] == 0 ? $txt['database_already_optimized'] : $context['num_tables_optimized'] . ' ' . $txt['database_optimized'];
 
 	echo '
-				</p>
-				<p><a href="', $scripturl, '?action=admin;area=maintain">', $txt['maintain_return'], '</a></p>
-			</div>
-			<span class="botslice"><span></span></span>
+			</p>
+			<p><a href="', $scripturl, '?action=admin;area=maintain">', $txt['maintain_return'], '</a></p>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_convert_utf8()
 {
-	global $context, $txt, $settings, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="manage_maintenance">
@@ -566,39 +546,35 @@
 			<h3 class="catbg">', $txt['utf8_title'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertutf8" method="post" accept-charset="', $context['character_set'], '">
-					<p>', $txt['utf8_introduction'], '</p>
-					<div>', $txt['utf8_warning'], '</div>
-
-					<dl class="settings">
-						<dt><strong>', $txt['utf8_source_charset'], ':</strong></dt>
-						<dd><select name="src_charset">';
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertutf8" method="post" accept-charset="', $context['character_set'], '">
+				<p>', $txt['utf8_introduction'], '</p>
+				<div>', $txt['utf8_warning'], '</div>
+
+				<dl class="settings">
+					<dt><strong>', $txt['utf8_source_charset'], ':</strong></dt>
+					<dd><select name="src_charset">';
 	foreach ($context['charset_list'] as $charset)
 		echo '
-							<option value="', $charset, '"', $charset === $context['charset_detected'] ? ' selected="selected"' : '', '>', $charset, '</option>';
+						<option value="', $charset, '"', $charset === $context['charset_detected'] ? ' selected' : '', '>', $charset, '</option>';
 	echo '
-							</select></dd>
-						<dt><strong>', $txt['utf8_database_charset'], ':</strong></dt>
-						<dd>', $context['database_charset'], '</dd>
-						<dt><strong>', $txt['utf8_target_charset'], ': </strong></dt>
-						<dd>', $txt['utf8_utf8'], '</dd>
-					</dl>
-					<input type="submit" value="', $txt['utf8_proceed'], '" class="button_submit" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="hidden" name="proceed" value="1" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+						</select></dd>
+					<dt><strong>', $txt['utf8_database_charset'], ':</strong></dt>
+					<dd>', $context['database_charset'], '</dd>
+					<dt><strong>', $txt['utf8_target_charset'], ': </strong></dt>
+					<dd>', $txt['utf8_utf8'], '</dd>
+				</dl>
+				<input type="submit" value="', $txt['utf8_proceed'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+				<input type="hidden" name="proceed" value="1">
+			</form>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_convert_entities()
 {
-	global $context, $txt, $settings, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="manage_maintenance">
@@ -606,17 +582,51 @@
 			<h3 class="catbg">', $txt['entity_convert_title'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $txt['entity_convert_introduction'], '</p>
-				<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertentities;start=0;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
-					<input type="submit" value="', $txt['entity_convert_proceed'], '" class="button_submit" />
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p>', $txt['entity_convert_introduction'], '</p>
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertentities;start=0;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
+			<input type="submit" value="', $txt['entity_convert_proceed'], '" class="button_submit">
+			</form>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
+}
+
+function template_convert_msgbody()
+{
+	global $context, $txt, $scripturl;
+
+	echo '
+	<div id="manage_maintenance">
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt[$context['convert_to'] . '_title'], '</h3>
+		</div>
+		<div class="windowbg">
+			<p>', $txt['body_checking_introduction'], '</p>';
+	if (!empty($context['exceeding_messages']))
+	{
+		echo '
+			<p class="noticebox">', $txt['exceeding_messages'], '
+			<ul>
+				<li>
+				', implode('</li><li>', $context['exceeding_messages']), '
+				</li>
+			</ul>';
+		if (!empty($context['exceeding_messages_morethan']))
+			echo '
+			<p>', $context['exceeding_messages_morethan'], '</p>';
+	}
+	else
+		echo '
+			<p class="infobox">', $txt['convert_to_text'], '</p>';
+
+	echo '
+			<form action="', $scripturl, '?action=admin;area=maintain;sa=database;activity=convertmsgbody" method="post" accept-charset="', $context['character_set'], '">
+			<hr class="hrcolor">
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['admin-maint_token_var'], '" value="', $context['admin-maint_token'], '">
+			<input type="submit" name="do_conversion" value="', $txt['entity_convert_proceed'], '" class="button_submit">
+			</form>
+		</div>
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManageMembergroups.template.php b/Themes/default/ManageMembergroups.template.php
--- a/Themes/default/ManageMembergroups.template.php	2011-06-10 03:42:24.000000000 -0700
+++ b/Themes/default/ManageMembergroups.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,145 +3,131 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_main()
 {
-	global $context, $settings, $options, $scripturl, $txt;
-
 	template_show_list('regular_membergroups_list');
-	echo '<br /><br />';
+	echo '<br><br>';
 	template_show_list('post_count_membergroups_list');
-
 }
 
 function template_new_group()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=membergroups;sa=add" method="post" accept-charset="', $context['character_set'], '">
+		<form id="new_group" action="', $scripturl, '?action=admin;area=membergroups;sa=add" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['membergroups_new_group'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<label for="group_name_input"><strong>', $txt['membergroups_group_name'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="group_name" id="group_name_input" size="30" class="input_text" />
-						</dd>';
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<label for="group_name_input"><strong>', $txt['membergroups_group_name'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="text" name="group_name" id="group_name_input" size="30" class="input_text">
+					</dd>';
 	if ($context['undefined_group'])
 	{
 		echo '
-						<dt>
-							<label for="group_type"><strong>', $txt['membergroups_edit_group_type'], '</strong>:</label>
-						</dt>
-						<dd>
-							<fieldset id="group_type">
-								<legend>', $txt['membergroups_edit_select_group_type'], '</legend>
-								<label for="group_type_private"><input type="radio" name="group_type" id="group_type_private" value="0" checked="checked" class="input_radio" onclick="swapPostGroup(0);" />', $txt['membergroups_group_type_private'], '</label><br />';
+					<dt>
+						<label for="group_type"><strong>', $txt['membergroups_edit_group_type'], '</strong>:</label>
+					</dt>
+					<dd>
+						<fieldset id="group_type">
+							<legend>', $txt['membergroups_edit_select_group_type'], '</legend>
+							<label for="group_type_private"><input type="radio" name="group_type" id="group_type_private" value="0" checked class="input_radio" onclick="swapPostGroup(0);">', $txt['membergroups_group_type_private'], '</label><br>';
 
 		if ($context['allow_protected'])
 			echo '
-								<label for="group_type_protected"><input type="radio" name="group_type" id="group_type_protected" value="1" class="input_radio" onclick="swapPostGroup(0);" />', $txt['membergroups_group_type_protected'], '</label><br />';
+							<label for="group_type_protected"><input type="radio" name="group_type" id="group_type_protected" value="1" class="input_radio" onclick="swapPostGroup(0);">', $txt['membergroups_group_type_protected'], '</label><br>';
 
 		echo '
-								<label for="group_type_request"><input type="radio" name="group_type" id="group_type_request" value="2" class="input_radio" onclick="swapPostGroup(0);" />', $txt['membergroups_group_type_request'], '</label><br />
-								<label for="group_type_free"><input type="radio" name="group_type" id="group_type_free" value="3" class="input_radio" onclick="swapPostGroup(0);" />', $txt['membergroups_group_type_free'], '</label><br />
-								<label for="group_type_post"><input type="radio" name="group_type" id="group_type_post" value="-1" class="input_radio" onclick="swapPostGroup(1);" />', $txt['membergroups_group_type_post'], '</label><br />
-							</fieldset>
-						</dd>';
+							<label for="group_type_request"><input type="radio" name="group_type" id="group_type_request" value="2" class="input_radio" onclick="swapPostGroup(0);">', $txt['membergroups_group_type_request'], '</label><br>
+							<label for="group_type_free"><input type="radio" name="group_type" id="group_type_free" value="3" class="input_radio" onclick="swapPostGroup(0);">', $txt['membergroups_group_type_free'], '</label><br>
+							<label for="group_type_post"><input type="radio" name="group_type" id="group_type_post" value="-1" class="input_radio" onclick="swapPostGroup(1);">', $txt['membergroups_group_type_post'], '</label><br>
+						</fieldset>
+					</dd>';
 	}
 
 	if ($context['post_group'] || $context['undefined_group'])
 		echo '
-						<dt id="min_posts_text">
-							<strong>', $txt['membergroups_min_posts'], ':</strong>
-						</dt>
-						<dd>
-							<input type="text" name="min_posts" id="min_posts_input" size="5" class="input_text" />
-						</dd>';
+					<dt id="min_posts_text">
+						<strong>', $txt['membergroups_min_posts'], ':</strong>
+					</dt>
+					<dd>
+						<input type="number" name="min_posts" id="min_posts_input" size="5" class="input_text">
+					</dd>';
 	if (!$context['post_group'] || !empty($modSettings['permission_enable_postgroups']))
 	{
 		echo '
-						<dt>
-							<label for="permission_base"><strong>', $txt['membergroups_permissions'], ':</strong></label><br />
-							<span class="smalltext">', $txt['membergroups_can_edit_later'], '</span>
-						</dt>
-						<dd>
-							<fieldset id="permission_base">
-								<legend>', $txt['membergroups_select_permission_type'], '</legend>
-								<input type="radio" name="perm_type" id="perm_type_inherit" value="inherit" checked="checked" class="input_radio" />
-								<label for="perm_type_inherit">', $txt['membergroups_new_as_inherit'], ':</label>
-								<select name="inheritperm" id="inheritperm_select" onclick="document.getElementById(\'perm_type_inherit\').checked = true;">
-									<option value="-1">', $txt['membergroups_guests'], '</option>
-									<option value="0" selected="selected">', $txt['membergroups_members'], '</option>';
+					<dt>
+						<label for="permission_base"><strong>', $txt['membergroups_permissions'], ':</strong></label><br>
+						<span class="smalltext">', $txt['membergroups_can_edit_later'], '</span>
+					</dt>
+					<dd>
+						<fieldset id="permission_base">
+							<legend>', $txt['membergroups_select_permission_type'], '</legend>
+							<input type="radio" name="perm_type" id="perm_type_inherit" value="inherit" checked class="input_radio">
+							<label for="perm_type_inherit">', $txt['membergroups_new_as_inherit'], ':</label>
+							<select name="inheritperm" id="inheritperm_select" onclick="document.getElementById(\'perm_type_inherit\').checked = true;">
+								<option value="-1">', $txt['membergroups_guests'], '</option>
+								<option value="0" selected>', $txt['membergroups_members'], '</option>';
 		foreach ($context['groups'] as $group)
 			echo '
-									<option value="', $group['id'], '">', $group['name'], '</option>';
+								<option value="', $group['id'], '">', $group['name'], '</option>';
 		echo '
-								</select><br />
-
-								<input type="radio" name="perm_type" id="perm_type_copy" value="copy" class="input_radio" />
-								<label for="perm_type_copy">', $txt['membergroups_new_as_copy'], ':</label>
-								<select name="copyperm" id="copyperm_select" onclick="document.getElementById(\'perm_type_copy\').checked = true;">
-									<option value="-1">', $txt['membergroups_guests'], '</option>
-									<option value="0" selected="selected">', $txt['membergroups_members'], '</option>';
+							</select>
+							<br>
+							<input type="radio" name="perm_type" id="perm_type_copy" value="copy" class="input_radio">
+							<label for="perm_type_copy">', $txt['membergroups_new_as_copy'], ':</label>
+							<select name="copyperm" id="copyperm_select" onclick="document.getElementById(\'perm_type_copy\').checked = true;">
+								<option value="-1">', $txt['membergroups_guests'], '</option>
+								<option value="0" selected>', $txt['membergroups_members'], '</option>';
 		foreach ($context['groups'] as $group)
 			echo '
-									<option value="', $group['id'], '">', $group['name'], '</option>';
+								<option value="', $group['id'], '">', $group['name'], '</option>';
 		echo '
-								</select><br />
-
-								<input type="radio" name="perm_type" id="perm_type_predefined" value="predefined" class="input_radio" />
-								<label for="perm_type_predefined">', $txt['membergroups_new_as_type'], ':</label>
-								<select name="level" id="level_select" onclick="document.getElementById(\'perm_type_predefined\').checked = true;">
-									<option value="restrict">', $txt['permitgroups_restrict'], '</option>
-									<option value="standard" selected="selected">', $txt['permitgroups_standard'], '</option>
-									<option value="moderator">', $txt['permitgroups_moderator'], '</option>
-									<option value="maintenance">', $txt['permitgroups_maintenance'], '</option>
-								</select>
-							</fieldset>
-						</dd>';
+							</select>
+							<br>
+							<input type="radio" name="perm_type" id="perm_type_predefined" value="predefined" class="input_radio">
+							<label for="perm_type_predefined">', $txt['membergroups_new_as_type'], ':</label>
+							<select name="level" id="level_select" onclick="document.getElementById(\'perm_type_predefined\').checked = true;">
+								<option value="restrict">', $txt['permitgroups_restrict'], '</option>
+								<option value="standard" selected>', $txt['permitgroups_standard'], '</option>
+								<option value="moderator">', $txt['permitgroups_moderator'], '</option>
+								<option value="maintenance">', $txt['permitgroups_maintenance'], '</option>
+							</select>
+						</fieldset>
+					</dd>';
 	}
+
 	echo '
-						<dt>
-							<strong>', $txt['membergroups_new_board'], ':</strong>', $context['post_group'] ? '<br />
-							<span class="smalltext" style="font-weight: normal">' . $txt['membergroups_new_board_post_groups'] . '</span>' : '', '
-						</dt>
-						<dd>
-							<fieldset id="visible_boards">
-								<legend>', $txt['membergroups_new_board_desc'], '</legend>';
-	foreach ($context['boards'] as $board)
-		echo '
-								<div style="margin-left: ', $board['child_level'], 'em;"><input type="checkbox" name="boardaccess[]" id="boardaccess_', $board['id'], '" value="', $board['id'], '" ', $board['selected'] ? ' checked="checked" disabled="disabled"' : '', ' class="input_check" /> <label for="boardaccess_', $board['id'], '">', $board['name'], '</label></div>';
+					<dt>
+						<strong>', $txt['membergroups_new_board'], ':</strong>', $context['post_group'] ? '<br>
+						<span class="smalltext" style="font-weight: normal">' . $txt['membergroups_new_board_post_groups'] . '</span>' : '', '
+					</dt>
+					<dd>';
+
+	template_add_edit_group_boards_list(false);
 
 	echo '
-								<br />
-								<input type="checkbox" id="checkall_check" class="input_check" onclick="invertAll(this, this.form, \'boardaccess\');" /> <label for="checkall_check"><em>', $txt['check_all'], '</em></label>
-							</fieldset>
-						</dd>
-					</dl>
-					<div class="righttext">
-						<input type="submit" value="', $txt['membergroups_add_group'], '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
+					</dd>
+				</dl>
+				<input type="submit" value="', $txt['membergroups_add_group'], '" class="button_submit">
 			</div>';
 	if ($context['undefined_group'])
 	{
 		echo '
-			<script type="text/javascript"><!-- // --><![CDATA[
+			<script><!-- // --><![CDATA[
 				function swapPostGroup(isChecked)
 				{
 					var min_posts_text = document.getElementById(\'min_posts_text\');
@@ -152,15 +138,15 @@
 			// ]]></script>';
 	}
 	echo '
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['admin-mmg_token_var'], '" value="', $context['admin-mmg_token'], '">
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_edit_group()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
@@ -170,177 +156,184 @@
 				</h3>
 			</div>
 			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<label for="group_name_input"><strong>', $txt['membergroups_edit_name'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="group_name" id="group_name_input" value="', $context['group']['editable_name'], '" size="30" class="input_text" />
-						</dd>';
+				<dl class="settings">
+					<dt>
+						<label for="group_name_input"><strong>', $txt['membergroups_edit_name'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="text" name="group_name" id="group_name_input" value="', $context['group']['editable_name'], '" size="30" class="input_text">
+					</dd>';
 
 	if ($context['group']['id'] != 3 && $context['group']['id'] != 4)
 		echo '
 
-						<dt id="group_desc_text">
-							<label for="group_desc_input"><strong>', $txt['membergroups_edit_desc'], ':</strong></label>
-						</dt>
-						<dd>
-							<textarea name="group_desc" id="group_desc_input" rows="4" cols="40">', $context['group']['description'], '</textarea>
-						</dd>';
+					<dt id="group_desc_text">
+						<label for="group_desc_input"><strong>', $txt['membergroups_edit_desc'], ':</strong></label>
+					</dt>
+					<dd>
+						<textarea name="group_desc" id="group_desc_input" rows="4" cols="40">', $context['group']['description'], '</textarea>
+					</dd>';
 
 	// Group type...
 	if ($context['group']['allow_post_group'])
 	{
 		echo '
-						<dt>
-							<label for="group_type"><strong>', $txt['membergroups_edit_group_type'], ':</strong></label>
-						</dt>
-						<dd>
-							<fieldset id="group_type">
-								<legend>', $txt['membergroups_edit_select_group_type'], '</legend>
-								<label for="group_type_private"><input type="radio" name="group_type" id="group_type_private" value="0" ', !$context['group']['is_post_group'] && $context['group']['type'] == 0 ? 'checked="checked"' : '', ' class="input_radio" onclick="swapPostGroup(0);" />', $txt['membergroups_group_type_private'], '</label><br />';
+					<dt>
+						<label for="group_type"><strong>', $txt['membergroups_edit_group_type'], ':</strong></label>
+					</dt>
+					<dd>
+						<fieldset id="group_type">
+							<legend>', $txt['membergroups_edit_select_group_type'], '</legend>
+							<label for="group_type_private"><input type="radio" name="group_type" id="group_type_private" value="0"', !$context['group']['is_post_group'] && $context['group']['type'] == 0 ? ' checked' : '', ' class="input_radio" onclick="swapPostGroup(0);">', $txt['membergroups_group_type_private'], '</label><br>';
 
 		if ($context['group']['allow_protected'])
 			echo '
-								<label for="group_type_protected"><input type="radio" name="group_type" id="group_type_protected" value="1" ', $context['group']['type'] == 1 ? 'checked="checked"' : '', ' class="input_radio" onclick="swapPostGroup(0);" />', $txt['membergroups_group_type_protected'], '</label><br />';
+							<label for="group_type_protected"><input type="radio" name="group_type" id="group_type_protected" value="1"', $context['group']['type'] == 1 ? ' checked' : '', ' class="input_radio" onclick="swapPostGroup(0);">', $txt['membergroups_group_type_protected'], '</label><br>';
 
 		echo '
-								<label for="group_type_request"><input type="radio" name="group_type" id="group_type_request" value="2" ', $context['group']['type'] == 2 ? 'checked="checked"' : '', ' class="input_radio" onclick="swapPostGroup(0);" />', $txt['membergroups_group_type_request'], '</label><br />
-								<label for="group_type_free"><input type="radio" name="group_type" id="group_type_free" value="3" ', $context['group']['type'] == 3 ? 'checked="checked"' : '', ' class="input_radio" onclick="swapPostGroup(0);" />', $txt['membergroups_group_type_free'], '</label><br />
-								<label for="group_type_post"><input type="radio" name="group_type" id="group_type_post" value="-1" ', $context['group']['is_post_group'] ? 'checked="checked"' : '', ' class="input_radio" onclick="swapPostGroup(1);" />', $txt['membergroups_group_type_post'], '</label><br />
-							</fieldset>
-						</dd>';
+							<label for="group_type_request"><input type="radio" name="group_type" id="group_type_request" value="2"', $context['group']['type'] == 2 ? ' checked' : '', ' class="input_radio" onclick="swapPostGroup(0);">', $txt['membergroups_group_type_request'], '</label><br>
+							<label for="group_type_free"><input type="radio" name="group_type" id="group_type_free" value="3"', $context['group']['type'] == 3 ? ' checked' : '', ' class="input_radio" onclick="swapPostGroup(0);">', $txt['membergroups_group_type_free'], '</label><br>
+							<label for="group_type_post"><input type="radio" name="group_type" id="group_type_post" value="-1"', $context['group']['is_post_group'] ? ' checked' : '', ' class="input_radio" onclick="swapPostGroup(1);">', $txt['membergroups_group_type_post'], '</label><br>
+						</fieldset>
+					</dd>';
 	}
 
 	if ($context['group']['id'] != 3 && $context['group']['id'] != 4)
 		echo '
-						<dt id="group_moderators_text">
-							<label for="group_moderators"><strong>', $txt['moderators'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="group_moderators" id="group_moderators" value="', $context['group']['moderator_list'], '" size="30" class="input_text" />
-							<div id="moderator_container"></div>
-						</dd>
-						<dt id="group_hidden_text">
-							<label for="group_hidden_input"><strong>', $txt['membergroups_edit_hidden'], ':</strong></label>
-						</dt>
-						<dd>
-							<select name="group_hidden" id="group_hidden_input" onchange="if (this.value == 2 &amp;&amp; !confirm(\'', $txt['membergroups_edit_hidden_warning'], '\')) this.value = 0;">
-								<option value="0" ', $context['group']['hidden'] ? '' : 'selected="selected"', '>', $txt['membergroups_edit_hidden_no'], '</option>
-								<option value="1" ', $context['group']['hidden'] == 1 ? 'selected="selected"' : '', '>', $txt['membergroups_edit_hidden_boardindex'], '</option>
-								<option value="2" ', $context['group']['hidden'] == 2 ? 'selected="selected"' : '', '>', $txt['membergroups_edit_hidden_all'], '</option>
-							</select>
-						</dd>';
+					<dt id="group_moderators_text">
+						<label for="group_moderators"><strong>', $txt['moderators'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="text" name="group_moderators" id="group_moderators" value="', $context['group']['moderator_list'], '" size="30" class="input_text">
+						<div id="moderator_container"></div>
+					</dd>
+					<dt id="group_hidden_text">
+						<label for="group_hidden_input"><strong>', $txt['membergroups_edit_hidden'], ':</strong></label>
+					</dt>
+					<dd>
+						<select name="group_hidden" id="group_hidden_input" onchange="if (this.value == 2 &amp;&amp; !confirm(\'', $txt['membergroups_edit_hidden_warning'], '\')) this.value = 0;">
+							<option value="0"', $context['group']['hidden'] ? '' : ' selected', '>', $txt['membergroups_edit_hidden_no'], '</option>
+							<option value="1"', $context['group']['hidden'] == 1 ? ' selected' : '', '>', $txt['membergroups_edit_hidden_boardindex'], '</option>
+							<option value="2"', $context['group']['hidden'] == 2 ? ' selected' : '', '>', $txt['membergroups_edit_hidden_all'], '</option>
+						</select>
+					</dd>';
 
 	// Can they inherit permissions?
 	if ($context['group']['id'] > 1 && $context['group']['id'] != 3)
 	{
 		echo '
-						<dt id="group_inherit_text">
-							<label for="group_inherit_input"><strong>', $txt['membergroups_edit_inherit_permissions'], '</strong></label>:<br />
-							<span class="smalltext">', $txt['membergroups_edit_inherit_permissions_desc'], '</span>
-						</dt>
-						<dd>
-							<select name="group_inherit" id="group_inherit_input">
-								<option value="-2">', $txt['membergroups_edit_inherit_permissions_no'], '</option>
-								<option value="-1" ', $context['group']['inherited_from'] == -1 ? 'selected="selected"' : '', '>', $txt['membergroups_edit_inherit_permissions_from'], ': ', $txt['membergroups_guests'], '</option>
-								<option value="0" ', $context['group']['inherited_from'] == 0 ? 'selected="selected"' : '', '>', $txt['membergroups_edit_inherit_permissions_from'], ': ', $txt['membergroups_members'], '</option>';
+					<dt id="group_inherit_text">
+						<label for="group_inherit_input"><strong>', $txt['membergroups_edit_inherit_permissions'], '</strong></label>:<br>
+						<span class="smalltext">', $txt['membergroups_edit_inherit_permissions_desc'], '</span>
+					</dt>
+					<dd>
+						<select name="group_inherit" id="group_inherit_input">
+							<option value="-2">', $txt['membergroups_edit_inherit_permissions_no'], '</option>
+							<option value="-1"', $context['group']['inherited_from'] == -1 ? ' selected' : '', '>', $txt['membergroups_edit_inherit_permissions_from'], ': ', $txt['membergroups_guests'], '</option>
+							<option value="0"', $context['group']['inherited_from'] == 0 ? ' selected' : '', '>', $txt['membergroups_edit_inherit_permissions_from'], ': ', $txt['membergroups_members'], '</option>';
 
 		// For all the inheritable groups show an option.
 		foreach ($context['inheritable_groups'] as $id => $group)
 			echo '
-								<option value="', $id, '" ', $context['group']['inherited_from'] == $id ? 'selected="selected"' : '', '>', $txt['membergroups_edit_inherit_permissions_from'], ': ', $group, '</option>';
+							<option value="', $id, '"', $context['group']['inherited_from'] == $id ? ' selected' : '', '>', $txt['membergroups_edit_inherit_permissions_from'], ': ', $group, '</option>';
 
 		echo '
-							</select>
-							<input type="hidden" name="old_inherit" value="', $context['group']['inherited_from'], '" />
-						</dd>';
+						</select>
+						<input type="hidden" name="old_inherit" value="', $context['group']['inherited_from'], '">
+					</dd>';
 	}
 
 	if ($context['group']['allow_post_group'])
 		echo '
 
-						<dt id="min_posts_text">
-							<label for="min_posts_input"><strong>', $txt['membergroups_min_posts'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="min_posts" id="min_posts_input"', $context['group']['is_post_group'] ? ' value="' . $context['group']['min_posts'] . '"' : '', ' size="6" class="input_text" />
-						</dd>';
-	echo '
-						<dt>
-							<label for="online_color_input"><strong>', $txt['membergroups_online_color'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="online_color" id="online_color_input" value="', $context['group']['color'], '" size="20" class="input_text" />
-						</dd>
-						<dt>
-							<label for="star_count_input"><strong>', $txt['membergroups_star_count'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="star_count" id="star_count_input" value="', $context['group']['star_count'], '" size="4" onkeyup="if (this.value.length > 2) this.value = 99;" onkeydown="this.onkeyup();" onchange="if (this.value != 0) this.form.star_image.onchange();" class="input_text" />
-						</dd>
-						<dt>
-							<label for="star_image_input"><strong>', $txt['membergroups_star_image'], ':</strong></label><br />
-							<span class="smalltext">', $txt['membergroups_star_image_note'], '</span>
-						</dt>
-						<dd>
-							', $txt['membergroups_images_url'], '
-							<input type="text" name="star_image" id="star_image_input" value="', $context['group']['star_image'], '" onchange="if (this.value &amp;&amp; this.form.star_count.value == 0) this.form.star_count.value = 1; else if (!this.value) this.form.star_count.value = 0; document.getElementById(\'star_preview\').src = smf_images_url + \'/\' + (this.value &amp;&amp; this.form.star_count.value > 0 ? this.value.replace(/\$language/g, \'', $context['user']['language'], '\') : \'blank.gif\');" size="20" class="input_text" />
-							<img id="star_preview" src="', $settings['images_url'], '/', $context['group']['star_image'] == '' ? 'blank.gif' : $context['group']['star_image'], '" alt="*" />
-						</dd>
-						<dt>
-							<label for="max_messages_input"><strong>', $txt['membergroups_max_messages'], ':</strong></label><br />
-							<span class="smalltext">', $txt['membergroups_max_messages_note'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="max_messages" id="max_messages_input" value="', $context['group']['id'] == 1 ? 0 : $context['group']['max_messages'], '" size="6"', $context['group']['id'] == 1 ? ' disabled="disabled"' : '', ' class="input_text" />
-						</dd>';
-	if (!empty($context['boards']))
-	{
-		echo '
-						<dt>
-							<strong>', $txt['membergroups_new_board'], ':</strong>', $context['group']['is_post_group'] ? '<br />
-							<span class="smalltext">' . $txt['membergroups_new_board_post_groups'] . '</span>' : '', '
-						</dt>
-						<dd>
-							<fieldset id="visible_boards" style="width: 95%;">
-								<legend><a href="javascript:void(0);" onclick="document.getElementById(\'visible_boards\').style.display = \'none\';document.getElementById(\'visible_boards_link\').style.display = \'block\'; return false;">', $txt['membergroups_new_board_desc'], '</a></legend>';
-		foreach ($context['boards'] as $board)
-			echo '
-								<div style="margin-left: ', $board['child_level'], 'em;"><input type="checkbox" name="boardaccess[]" id="boardaccess_', $board['id'], '" value="', $board['id'], '" ', $board['selected'] ? ' checked="checked"' : '', ' class="input_check" /> <label for="boardaccess_', $board['id'], '">', $board['name'], '</label></div>';
+					<dt id="min_posts_text">
+						<label for="min_posts_input"><strong>', $txt['membergroups_min_posts'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="number" name="min_posts" id="min_posts_input"', $context['group']['is_post_group'] ? ' value="' . $context['group']['min_posts'] . '"' : '', ' size="6" class="input_text">
+					</dd>';
+	echo '
+					<dt>
+						<label for="online_color_input"><strong>', $txt['membergroups_online_color'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="text" name="online_color" id="online_color_input" value="', $context['group']['color'], '" size="20" class="input_text">
+					</dd>
+					<dt>
+						<label for="icon_count_input"><strong>', $txt['membergroups_icon_count'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="number" name="icon_count" id="icon_count_input" value="', $context['group']['icon_count'], '" size="4" class="input_text">
+					</dd>';
 
+	// Do we have any possible icons to select from?
+	if (!empty($context['possible_icons']))
+	{
+	echo '
+					<dt>
+						<label for="icon_image_input"><strong>', $txt['membergroups_icon_image'], ':</strong></label><br>
+						<span class="smalltext">', $txt['membergroups_icon_image_note'], '</span>
+					</dt>
+					<dd>
+						', $txt['membergroups_images_url'], '
+						<select name="icon_image" id="icon_image_input">';
+
+		// For every possible icon, create an option.
+		foreach ($context['possible_icons'] as $icon)
+		{
+			echo '
+							<option value="', $icon, '"', $context['group']['icon_image'] == $icon ? ' selected' : '', '>', $icon, '</option>';
+		}
+
+		echo '
+						</select>
+						<img id="icon_preview" src="" alt="*">
+					</dd>';
+	}
+
+	// No? Hide the entire control.
+	else
 		echo '
-								<br />
-								<input type="checkbox" id="checkall_check" class="input_check" onclick="invertAll(this, this.form, \'boardaccess\');" /> <label for="checkall_check"><em>', $txt['check_all'], '</em></label>
-							</fieldset>
-							<a href="javascript:void(0);" onclick="document.getElementById(\'visible_boards\').style.display = \'block\'; document.getElementById(\'visible_boards_link\').style.display = \'none\'; return false;" id="visible_boards_link" style="display: none;">[ ', $txt['membergroups_select_visible_boards'], ' ]</a>
-							<script type="text/javascript"><!-- // --><![CDATA[
-								document.getElementById("visible_boards_link").style.display = "";
-								document.getElementById("visible_boards").style.display = "none";
-							// ]]></script>
-						</dd>';
+					<input type="hidden" name="icon_image" value="">';
+
+	echo '
+					<dt>
+						<label for="max_messages_input"><strong>', $txt['membergroups_max_messages'], ':</strong></label><br>
+						<span class="smalltext">', $txt['membergroups_max_messages_note'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="max_messages" id="max_messages_input" value="', $context['group']['id'] == 1 ? 0 : $context['group']['max_messages'], '" size="6"', $context['group']['id'] == 1 ? ' disabled' : '', ' class="input_text">
+					</dd>';
+	if (!empty($context['categories']))
+	{
+		echo '
+					<dt>
+						<strong>', $txt['membergroups_new_board'], ':</strong>', $context['group']['is_post_group'] ? '<br>
+						<span class="smalltext">' . $txt['membergroups_new_board_post_groups'] . '</span>' : '', '
+					</dt>
+					<dd>';
+		if (!empty($context['can_manage_boards']))
+			echo $txt['membergroups_can_manage_access'];
+		else
+			template_add_edit_group_boards_list();
+
+		echo '
+					</dd>';
 	}
 	echo '
-					</dl>
-					<div class="righttext">
-						<input type="submit" name="submit" value="', $txt['membergroups_edit_save'], '" class="button_submit" />', $context['group']['allow_delete'] ? '
-						<input type="submit" name="delete" value="' . $txt['membergroups_delete'] . '" onclick="return confirm(\'' . $txt['membergroups_confirm_delete'] . '\');" class="button_submit" />' : '', '
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
+				</dl>
+				<input type="submit" name="save" value="', $txt['membergroups_edit_save'], '" class="button_submit">', $context['group']['allow_delete'] ? '
+				<input type="submit" name="delete" value="'. $txt['membergroups_delete'] .'" data-confirm="'. ($context['is_moderator_group'] ? $txt['membergroups_confirm_delete_mod'] : $txt['membergroups_confirm_delete']) .'" class="button_submit you_sure">' : '', '
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['admin-mmg_token_var'], '" value="', $context['admin-mmg_token'], '">
 		</form>
 	</div>
-	<br class="clear" />
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			var oModeratorSuggest = new smc_AutoSuggest({
 				sSelf: \'oModeratorSuggest\',
-				sSessionId: \'', $context['session_id'], '\',
-				sSessionVar: \'', $context['session_var'], '\',
+				sSessionId: smf_session_id,
+				sSessionVar: smf_session_var,
 				sSuggestId: \'group_moderators\',
 				sControlId: \'group_moderators\',
 				sSearchType: \'member\',
@@ -365,13 +358,41 @@
 
 	if ($context['group']['allow_post_group'])
 		echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			function swapPostGroup(isChecked)
 			{
+				var is_moderator_group = ', $context['is_moderator_group'], ';
+				var group_type = ', $context['group']['type'], ';
 				var min_posts_text = document.getElementById(\'min_posts_text\');
 				var group_desc_text = document.getElementById(\'group_desc_text\');
 				var group_hidden_text = document.getElementById(\'group_hidden_text\');
 				var group_moderators_text = document.getElementById(\'group_moderators_text\');
+
+				// If it\'s a moderator group, warn of possible problems... and remember the group type
+				if (isChecked && is_moderator_group && !confirm(\'', $txt['membergroups_swap_mod'], '\'))
+				{
+					isChecked = false;
+
+					switch(group_type)
+					{
+						case 0:
+							document.getElementById(\'group_type_private\').checked = true;
+							break;
+						case 1:
+							document.getElementById(\'group_type_protected\').checked = true;
+							break;
+						case 2:
+							document.getElementById(\'group_type_request\').checked = true;
+							break;
+						case 3:
+							document.getElementById(\'group_type_free\').checked = true;
+							break;
+						default:
+							document.getElementById(\'group_type_private\').checked = true;
+							break;
+					}
+				}
+
 				document.forms.groupForm.min_posts.disabled = !isChecked;
 				min_posts_text.style.color = isChecked ? "" : "#888888";
 				document.forms.groupForm.group_desc_input.disabled = isChecked;
@@ -381,48 +402,136 @@
 				document.forms.groupForm.group_moderators.disabled = isChecked;
 				group_moderators_text.style.color = !isChecked ? "" : "#888888";
 			}
+
 			swapPostGroup(', $context['group']['is_post_group'] ? 'true' : 'false', ');
 		// ]]></script>';
 }
 
+function template_add_edit_group_boards_list($collapse = true)
+{
+	global $context, $txt, $modSettings;
+	echo '
+							<fieldset id="visible_boards">
+								<legend>', $txt['membergroups_new_board_desc'], '</legend>
+								<ul class="padding floatleft">';
+
+	foreach ($context['categories'] as $category)
+	{
+		if (empty($modSettings['deny_boards_access']))
+			echo '
+									<li class="category">
+										<a href="javascript:void(0);" onclick="selectBoards([', implode(', ', $category['child_ids']), '], \'new_group\'); return false;"><strong>', $category['name'], '</strong></a>
+									<ul style="width:100%">';
+		else
+			echo '
+									<li class="category">
+										<strong>', $category['name'], '</strong>
+										<span class="select_all_box">
+											<em style="margin-left:5em;">', $txt['all_boards_in_cat'], ': </em>
+											<select onchange="select_in_category(', $category['id'], ', this, [', implode(',', array_keys($category['boards'])), ']);">
+												<option>---</option>
+												<option value="allow">', $txt['board_perms_allow'], '</option>
+												<option value="ignore">', $txt['board_perms_ignore'], '</option>
+												<option value="deny">', $txt['board_perms_deny'], '</option>
+											</select>
+										</span>
+										<ul style="width:100%" id="boards_list_', $category['id'], '">';
+
+		foreach ($category['boards'] as $board)
+		{
+			if (empty($modSettings['deny_boards_access']))
+				echo '
+										<li class="board" style="margin-', $context['right_to_left'] ? 'right' : 'left', ': ', $board['child_level'], 'em;">
+											<input type="checkbox" name="boardaccess[', $board['id'], ']" id="brd', $board['id'], '" value="allow"', $board['allow'] ? ' checked' : '', ' class="input_check"> <label for="brd', $board['id'], '">', $board['name'], '</label>
+										</li>';
+			else
+				echo '
+											<li class="board" style="width:100%">
+												<span style="margin-', $context['right_to_left'] ? 'right' : 'left', ': ', $board['child_level'], 'em;">', $board['name'], ': </span>
+												<span style="width:50%;float:right">
+													<input type="radio" name="boardaccess[', $board['id'], ']" id="allow_brd', $board['id'], '" value="allow"', $board['allow'] ? ' checked' : '', ' class="input_check"> <label for="allow_brd', $board['id'], '">', $txt['permissions_option_on'], '</label>
+													<input type="radio" name="boardaccess[', $board['id'], ']" id="ignore_brd', $board['id'], '" value="ignore"', !$board['allow'] && !$board['deny'] ? ' checked' : '', ' class="input_check"> <label for="ignore_brd', $board['id'], '">', $txt['permissions_option_off'], '</label>
+													<input type="radio" name="boardaccess[', $board['id'], ']" id="deny_brd', $board['id'], '" value="deny"', $board['deny'] ? ' checked' : '', ' class="input_check"> <label for="deny_brd', $board['id'], '">', $txt['permissions_option_deny'], '</label>
+												</span>
+											</li>';
+		}
+
+		echo '
+									</ul>
+								</li>';
+	}
+
+	echo '
+							</ul>';
+
+	if (empty($modSettings['deny_boards_access']))
+		echo '
+								<br class="clear"><br>
+								<input type="checkbox" id="checkall_check" class="input_check" onclick="invertAll(this, this.form, \'boardaccess\');"> <label for="checkall_check"><em>', $txt['check_all'], '</em></label>
+							</fieldset>';
+	else
+		echo '
+								<br class="clear">
+								<span class="select_all_box">
+									<em>', $txt['all'], ': </em>
+									<input type="radio" name="select_all" id="allow_all" class="input_radio" onclick="selectAllRadio(this, this.form, \'boardaccess\', \'allow\');"> <label for="allow_all">', $txt['board_perms_allow'], '</label>
+									<input type="radio" name="select_all" id="ignore_all" class="input_radio" onclick="selectAllRadio(this, this.form, \'boardaccess\', \'ignore\');"> <label for="ignore_all">', $txt['board_perms_ignore'], '</label>
+									<input type="radio" name="select_all" id="deny_all" class="input_radio" onclick="selectAllRadio(this, this.form, \'boardaccess\', \'deny\');"> <label for="deny_all">', $txt['board_perms_deny'], '</label>
+								</span>
+							</fieldset>
+							<script><!-- // --><![CDATA[
+								$(document).ready(function () {
+									$(".select_all_box").each(function () {
+										$(this).removeClass(\'select_all_box\');
+									});
+								});
+							// ]]></script>';
+
+	if ($collapse)
+		echo '
+							<a href="javascript:void(0);" onclick="document.getElementById(\'visible_boards\').style.display = \'block\'; document.getElementById(\'visible_boards_link\').style.display = \'none\'; return false;" id="visible_boards_link" style="display: none;">[ ', $txt['membergroups_select_visible_boards'], ' ]</a>
+							<script><!-- // --><![CDATA[
+								document.getElementById("visible_boards_link").style.display = "";
+								document.getElementById("visible_boards").style.display = "none";
+							// ]]></script>';
+}
+
 // Templating for viewing the members of a group.
 function template_group_members()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
-		<form action="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : '') , ';sa=members;group=', $context['group']['id'], '" method="post" accept-charset="', $context['character_set'], '">
+		<form action="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : '') , ';sa=members;group=', $context['group']['id'], '" method="post" accept-charset="', $context['character_set'], '" id="view_group">
 			<div class="cat_bar">
 				<h3 class="catbg">', $context['page_title'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<strong>', $txt['name'], ':</strong>
-						</dt>
-						<dd>
-							<span ', $context['group']['online_color'] ? 'style="color: ' . $context['group']['online_color'] . ';"' : '', '>', $context['group']['name'], '</span> ', $context['group']['stars'], '
-						</dd>';
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<strong>', $txt['name'], ':</strong>
+					</dt>
+					<dd>
+						<span ', $context['group']['online_color'] ? 'style="color: ' . $context['group']['online_color'] . ';"' : '', '>', $context['group']['name'], '</span> ', $context['group']['icons'], '
+					</dd>';
 	//Any description to show?
 	if (!empty($context['group']['description']))
 		echo '
-						<dt>
-							<strong>' . $txt['membergroups_members_description'] . ':</strong>
-						</dt>
-						<dd>
-							', $context['group']['description'] ,'
-						</dd>';
+					<dt>
+						<strong>' . $txt['membergroups_members_description'] . ':</strong>
+					</dt>
+					<dd>
+						', $context['group']['description'] ,'
+					</dd>';
 
 	echo '
-						<dt>
-							<strong>', $txt['membergroups_members_top'], ':</strong>
-						</dt>
-						<dd>
-							', $context['total_members'] ,'
-						</dd>';
+					<dt>
+						<strong>', $txt['membergroups_members_top'], ':</strong>
+					</dt>
+					<dd>
+						', $context['total_members'] ,'
+					</dd>';
 	// Any group moderators to show?
 	if (!empty($context['group']['moderators']))
 	{
@@ -431,37 +540,40 @@
 			$moderators[] = '<a href="' . $scripturl . '?action=profile;u=' . $moderator['id'] . '">' . $moderator['name'] . '</a>';
 
 		echo '
-						<dt>
-							<strong>', $txt['membergroups_members_group_moderators'], ':</strong>
-						</dt>
-						<dd>
-							', implode(', ', $moderators) ,'
-						</dd>';
+					<dt>
+						<strong>', $txt['membergroups_members_group_moderators'], ':</strong>
+					</dt>
+					<dd>
+						', implode(', ', $moderators) ,'
+					</dd>';
 	}
 
 	echo '
-					</dl>
-				</div>
-				<span class="botslice"><span></span></span>
+				</dl>
 			</div>
 
-			<br />
-			<div class="title_bar">
-				<h4 class="titlebg">', $txt['membergroups_members_group_members'], '</h4>
+			<br>
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['membergroups_members_group_members'], '</h3>
 			</div>
-			<br />
-			<div class="pagesection">', $txt['pages'], ': ', $context['page_index'], '</div>
-			<table width="100%" class="table_grid">
+			<br>
+			<div class="pagesection">', $context['page_index'], '</div>
+			<table class="table_grid">
 				<thead>
-					<tr class="catbg">
-						<th><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=name', $context['sort_by'] == 'name' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['name'], $context['sort_by'] == 'name' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>
-						<th><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=email', $context['sort_by'] == 'email' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['email'], $context['sort_by'] == 'email' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>
-						<th><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=active', $context['sort_by'] == 'active' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['membergroups_members_last_active'], $context['sort_by'] == 'active' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>
-						<th><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=registered', $context['sort_by'] == 'registered' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['date_registered'], $context['sort_by'] == 'registered' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>
-						<th', empty($context['group']['assignable']) ? ' colspan="2"' : '', '><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=posts', $context['sort_by'] == 'posts' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['posts'], $context['sort_by'] == 'posts' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>';
+					<tr class="title_bar">
+						<th><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=name', $context['sort_by'] == 'name' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['name'], $context['sort_by'] == 'name' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a></th>';
+
+	if ($context['can_send_email'])
+		echo '
+						<th><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=email', $context['sort_by'] == 'email' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['email'], $context['sort_by'] == 'email' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a></th>';
+
+	echo '
+						<th><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=active', $context['sort_by'] == 'active' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['membergroups_members_last_active'], $context['sort_by'] == 'active' ? '<span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a></th>
+						<th><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=registered', $context['sort_by'] == 'registered' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['date_registered'], $context['sort_by'] == 'registered' ? '<span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a></th>
+						<th ', empty($context['group']['assignable']) ? ' colspan="2"' : '', '><a href="', $scripturl, '?action=', $context['current_action'], (isset($context['admin_area']) ? ';area=' . $context['admin_area'] : ''), ';sa=members;start=', $context['start'], ';sort=posts', $context['sort_by'] == 'posts' && $context['sort_direction'] == 'up' ? ';desc' : '', ';group=', $context['group']['id'], '">', $txt['posts'], $context['sort_by'] == 'posts' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '','</a></th>';
 	if (!empty($context['group']['assignable']))
 		echo '
-						<td width="4%" align="center"><input type="checkbox" class="input_check" onclick="invertAll(this, this.form);" /></td>';
+						<th style="width: 4%"><input type="checkbox" class="input_check" onclick="invertAll(this, this.form);"></th>';
 	echo '
 					</tr>
 				</thead>
@@ -469,58 +581,49 @@
 
 	if (empty($context['members']))
 		echo '
-					<tr class="windowbg2">
-						<td colspan="6" align="center">', $txt['membergroups_members_no_members'], '</td>
+					<tr class="windowbg">
+						<td colspan="6">', $txt['membergroups_members_no_members'], '</td>
 					</tr>';
 
 	foreach ($context['members'] as $member)
 	{
 		echo '
-					<tr class="windowbg2">
-						<td>', $member['name'], '</td>
-						<td', $member['show_email'] == 'no_through_forum' && $settings['use_image_buttons'] ? ' align="center"' : '', '>';
-
-		// Is it totally hidden?
-		if ($member['show_email'] == 'no')
-			echo '
-							<em>', $txt['hidden'], '</em>';
-		// ... otherwise they want it hidden but it's not to this person?
-		elseif ($member['show_email'] == 'yes_permission_override')
-			echo '
-							<a href="mailto:', $member['email'], '"><em>', $member['email'], '</em></a>';
-		// ... otherwise it's visible - but only via an image?
-		elseif ($member['show_email'] == 'no_through_forum')
-			echo '
-							<a href="', $scripturl, '?action=emailuser;sa=email;uid=', $member['id'], '" rel="nofollow">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/email_sm.gif" alt="' . $txt['email'] . '" title="' . $txt['email'] . '" />' : $txt['email']), '</a>';
-		// ... otherwise it must be a 'yes', show it and show it fully.
-		else
-			echo '
-							<a href="mailto:', $member['email'], '">', $member['email'], '</a>';
+					<tr class="windowbg">
+						<td>', $member['name'], '</td>';
+		if ($context['can_send_email'])
+		{
+			echo '
+						<td>
+								<a href="mailto:', $member['email'], '">', $member['email'], '</a>
+						</td>';
+		}
 
 		echo '
-						</td>
-						<td class="windowbg">', $member['last_online'], '</td>
-						<td class="windowbg">', $member['registered'], '</td>
+						<td>', $member['last_online'], '</td>
+						<td>', $member['registered'], '</td>
 						<td', empty($context['group']['assignable']) ? ' colspan="2"' : '', '>', $member['posts'], '</td>';
 		if (!empty($context['group']['assignable']))
 			echo '
-						<td align="center" width="4%"><input type="checkbox" name="rem[]" value="', $member['id'], '" class="input_check" ', ($context['user']['id'] == $member['id'] && $context['group']['id'] == 1 ? 'onclick="if (this.checked) return confirm(\'' . $txt['membergroups_members_deadmin_confirm'] . '\')" ' : ''), '/></td>';
+						<td style="width: 4%"><input type="checkbox" name="rem[]" value="', $member['id'], '" class="input_check" ', ($context['user']['id'] == $member['id'] && $context['group']['id'] == 1 ? 'onclick="if (this.checked) return confirm(\'' . $txt['membergroups_members_deadmin_confirm'] . '\')" ' : ''), '/></td>';
 		echo '
 					</tr>';
 	}
 
 	echo '
 				</tbody>
-			</table>
-			<div class="pagesection flow_hidden">
-				<div class="floatleft">', $txt['pages'], ': ', $context['page_index'], '</div>';
+			</table>';
 
 	if (!empty($context['group']['assignable']))
 		echo '
-				<div class="floatright"><input type="submit" name="remove" value="', $txt['membergroups_members_remove'], '" class="button_submit" /></div>';
+			<div class="floatright">
+				<input type="submit" name="remove" value="', $txt['membergroups_members_remove'], '" class="button_submit ">
+			</div>';
+
 	echo '
+			<div class="pagesection flow_hidden">
+				<div class="floatleft">', $context['page_index'], '</div>
 			</div>
-			<br />';
+			<br>';
 
 	if (!empty($context['group']['assignable']))
 	{
@@ -528,28 +631,29 @@
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['membergroups_members_add_title'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<strong>', $txt['membergroups_members_add_desc'], ':</strong>
-					<input type="text" name="toAdd" id="toAdd" value="" class="input_text" />
-					<div id="toAddItemContainer"></div>
-					<input type="submit" name="add" value="', $txt['membergroups_members_add'], '" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<strong><label for="toAdd">', $txt['membergroups_members_add_desc'], ':</label></strong>
+					</dt>
+					<dd>
+						<input type="text" name="toAdd" id="toAdd" value="" class="input_text">
+						<div id="toAddItemContainer"></div>
+					</dd>
+				</dl>
+				<input type="submit" name="add" value="', $txt['membergroups_members_add'], '" class="button_submit">
 			</div>';
 	}
 
 	echo '
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['mod-mgm_token_var'], '" value="', $context['mod-mgm_token'], '">
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 
 	if (!empty($context['group']['assignable']))
 		echo '
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			var oAddMemberSuggest = new smc_AutoSuggest({
 				sSelf: \'oAddMemberSuggest\',
 				sSessionId: \'', $context['session_id'], '\',
@@ -569,7 +673,7 @@
 // Allow the moderator to enter a reason to each user being rejected.
 function template_group_request_reason()
 {
-	global $settings, $options, $context, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	// Show a welcome message to the user.
 	echo '
@@ -579,32 +683,28 @@
 				<h3 class="catbg">', $txt['mc_groups_reason_title'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">';
+				<dl class="settings">';
 
 	// Loop through and print out a reason box for each...
 	foreach ($context['group_requests'] as $request)
 		echo '
-						<dt>
-							<strong>', sprintf($txt['mc_groupr_reason_desc'], $request['member_link'], $request['group_link']), ':</strong>
-						</dt>
-						<dd>
-							<input type="hidden" name="groupr[]" value="', $request['id'], '" />
-							<textarea name="groupreason[', $request['id'], ']" rows="3" cols="40" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 96%; min-width: 96%' : 'width: 96%') . ';"></textarea>
-						</dd>';
+					<dt>
+						<strong>', sprintf($txt['mc_groupr_reason_desc'], $request['member_link'], $request['group_link']), ':</strong>
+					</dt>
+					<dd>
+						<input type="hidden" name="groupr[]" value="', $request['id'], '">
+						<textarea name="groupreason[', $request['id'], ']" rows="3" cols="40" style="min-width: 80%; max-width: 99%;"></textarea>
+					</dd>';
 
 	echo '
-					</dl>
-					<input type="submit" name="go" value="', $txt['mc_groupr_submit'], '" class="button_submit" />
-					<input type="hidden" name="req_action" value="got_reason" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</div>
-				<span class="botslice"><span></span></span>
+				</dl>
+				<input type="submit" name="go" value="', $txt['mc_groupr_submit'], '" class="button_submit">
+				<input type="hidden" name="req_action" value="got_reason">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['mod-gr_token_var'], '" value="', $context['mod-gr_token'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManageMembers.template.php b/Themes/default/ManageMembers.template.php
--- a/Themes/default/ManageMembers.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/ManageMembers.template.php	2015-03-05 23:30:05.998011224 -0800
@@ -3,198 +3,171 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_search_members()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=viewmembers" method="post" accept-charset="', $context['character_set'], '">
+		<form action="', $scripturl, '?action=admin;area=viewmembers" method="post" accept-charset="', $context['character_set'], '" id="admin_form_wrapper">
 			<div class="cat_bar">
 				<h3 class="catbg">
 					<span class="floatleft">', $txt['search_for'], '</span>
 					<span class="smalltext floatright">', $txt['wild_cards_allowed'], '</span>
 				</h3>
 			</div>
-			<input type="hidden" name="sa" value="query" />
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<div class="flow_hidden">
-						<div class="msearch_details floatleft">
-							<dl class="settings right">
-								<dt class="righttext">
-									<strong>', $txt['member_id'], ':</strong>
-									<select name="types[mem_id]">
-										<option value="--">&lt;</option>
-										<option value="-">&lt;=</option>
-										<option value="=" selected="selected">=</option>
-										<option value="+">&gt;=</option>
-										<option value="++">&gt;</option>
-									</select>
-								</dt>
-								<dd>
-									<input type="text" name="mem_id" value="" size="6" class="input_text" />
-								</dd>
-								<dt class="righttext">
-									<strong>', $txt['age'], ':</strong>
-									<select name="types[age]">
-										<option value="--">&lt;</option>
-										<option value="-">&lt;=</option>
-										<option value="=" selected="selected">=</option>
-										<option value="+">&gt;=</option>
-										<option value="++">&gt;</option>
-									</select>
-								</dt>
-								<dd>
-									<input type="text" name="age" value="" size="6" class="input_text" />
-								</dd>
-								<dt class="righttext">
-									<strong>', $txt['member_postcount'], ':</strong>
-									<select name="types[posts]">
-										<option value="--">&lt;</option>
-										<option value="-">&lt;=</option>
-										<option value="=" selected="selected">=</option>
-										<option value="+">&gt;=</option>
-										<option value="++">&gt;</option>
-									</select>
-								</dt>
-								<dd>
-									<input type="text" name="posts" value="" size="6" class="input_text" />
-								</dd>
-								<dt class="righttext">
-									<strong>', $txt['date_registered'], ':</strong>
-									<select name="types[reg_date]">
-										<option value="--">&lt;</option>
-										<option value="-">&lt;=</option>
-										<option value="=" selected="selected">=</option>
-										<option value="+">&gt;=</option>
-										<option value="++">&gt;</option>
-									</select>
-								</dt>
-								<dd>
-									<input type="text" name="reg_date" value="" size="10" class="input_text" /><span class="smalltext">', $txt['date_format'], '</span>
-								</dd>
-								<dt class="righttext">
-									<strong>', $txt['viewmembers_online'], ':</strong>
-									<select name="types[last_online]">
-										<option value="--">&lt;</option>
-										<option value="-">&lt;=</option>
-										<option value="=" selected="selected">=</option>
-										<option value="+">&gt;=</option>
-										<option value="++">&gt;</option>
-									</select>
-								</dt>
-								<dd>
-									<input type="text" name="last_online" value="" size="10" class="input_text" /><span class="smalltext">', $txt['date_format'], '</span>
-								</dd>
-							</dl>
-						</div>
-						<div class="msearch_details floatright">
-							<dl class="settings right">
-								<dt class="righttext">
-									<strong>', $txt['username'], ':</strong>
-								</dt>
-								<dd>
-									<input type="text" name="membername" value="" class="input_text" />
-								</dd>
-								<dt class="righttext">
-									<strong>', $txt['email_address'], ':</strong>
-								</dt>
-								<dd>
-									<input type="text" name="email" value="" class="input_text" />
-								</dd>
-								<dt class="righttext">
-									<strong>', $txt['website'], ':</strong>
-								</dt>
-								<dd>
-									<input type="text" name="website" value="" class="input_text" />
-								</dd>
-								<dt class="righttext">
-									<strong>', $txt['location'], ':</strong>
-								</dt>
-								<dd>
-									<input type="text" name="location" value="" class="input_text" />
-								</dd>
-								<dt class="righttext">
-									<strong>', $txt['ip_address'], ':</strong>
-								</dt>
-								<dd>
-									<input type="text" name="ip" value="" class="input_text" />
-								</dd>
-								<dt class="righttext">
-									<strong>', $txt['messenger_address'], ':</strong>
-								</dt>
-								<dd>
-									<input type="text" name="messenger" value="" class="input_text" />
-								</dd>
-							</dl>
-						</div>
+			<input type="hidden" name="sa" value="query">
+			<div class="windowbg2">
+				<div class="flow_hidden">
+					<div class="msearch_details floatleft">
+						<dl class="settings right">
+							<dt class="righttext">
+								<strong><label for="mem_id">', $txt['member_id'], ':</label></strong>
+								<select name="types[mem_id]">
+									<option value="--">&lt;</option>
+									<option value="-">&lt;=</option>
+									<option value="=" selected>=</option>
+									<option value="+">&gt;=</option>
+									<option value="++">&gt;</option>
+								</select>
+							</dt>
+							<dd>
+								<input type="number" name="mem_id" id="mem_id" value="" size="6" class="input_text">
+							</dd>
+							<dt class="righttext">
+								<strong><label for="age">', $txt['age'], ':</label></strong>
+								<select name="types[age]">
+									<option value="--">&lt;</option>
+									<option value="-">&lt;=</option>
+									<option value="=" selected>=</option>
+									<option value="+">&gt;=</option>
+									<option value="++">&gt;</option>
+								</select>
+							</dt>
+							<dd>
+								<input type="number" name="age" id="age" value="" size="6" class="input_text">
+							</dd>
+							<dt class="righttext">
+								<strong><label for="posts">', $txt['member_postcount'], ':</label></strong>
+								<select name="types[posts]">
+									<option value="--">&lt;</option>
+									<option value="-">&lt;=</option>
+									<option value="=" selected>=</option>
+									<option value="+">&gt;=</option>
+									<option value="++">&gt;</option>
+								</select>
+							</dt>
+							<dd>
+								<input type="number" name="posts" id="posts" value="" size="6" class="input_text">
+							</dd>
+							<dt class="righttext">
+								<strong><label for="reg_date">', $txt['date_registered'], ':</label></strong>
+								<select name="types[reg_date]">
+									<option value="--">&lt;</option>
+									<option value="-">&lt;=</option>
+									<option value="=" selected>=</option>
+									<option value="+">&gt;=</option>
+									<option value="++">&gt;</option>
+								</select>
+							</dt>
+							<dd>
+								<input type="date" name="reg_date" id="reg_date" value="" size="10" class="input_text"><span class="smalltext">', $txt['date_format'], '</span>
+							</dd>
+							<dt class="righttext">
+								<strong><label for="last_online">', $txt['viewmembers_online'], ':</label></strong>
+								<select name="types[last_online]">
+									<option value="--">&lt;</option>
+									<option value="-">&lt;=</option>
+									<option value="=" selected>=</option>
+									<option value="+">&gt;=</option>
+									<option value="++">&gt;</option>
+								</select>
+							</dt>
+							<dd>
+								<input type="date" name="last_online" id="last_online" value="" size="10" class="input_text"><span class="smalltext">', $txt['date_format'], '</span>
+							</dd>
+						</dl>
+					</div>
+					<div class="msearch_details floatright">
+						<dl class="settings right">
+							<dt class="righttext">
+								<strong><label for="membername">', $txt['username'], ':</label></strong>
+							</dt>
+							<dd>
+								<input type="text" name="membername" id="membername" value="" class="input_text">
+							</dd>
+							<dt class="righttext">
+								<strong><label for="email">', $txt['email_address'], ':</label></strong>
+							</dt>
+							<dd>
+								<input type="email" name="email" id="email" value="" class="input_text">
+							</dd>
+							<dt class="righttext">
+								<strong><label for="website">', $txt['website'], ':</label></strong>
+							</dt>
+							<dd>
+								<input type="url" name="website" id="website" value="" class="input_text">
+							</dd>
+							<dt class="righttext">
+								<strong><label for="ip">', $txt['ip_address'], ':</label></strong>
+							</dt>
+							<dd>
+								<input type="text" name="ip" id="ip" value="" class="input_text">
+							</dd>
+						</dl>
 					</div>
-					<div class="flow_hidden">
-						<div class="msearch_details floatleft">
-							<fieldset>
-								<legend>', $txt['gender'], '</legend>
-								<label for="gender-0"><input type="checkbox" name="gender[]" value="0" id="gender-0" checked="checked" class="input_check" /> ', $txt['undefined_gender'], '</label>&nbsp;&nbsp;
-								<label for="gender-1"><input type="checkbox" name="gender[]" value="1" id="gender-1" checked="checked" class="input_check" /> ', $txt['male'], '</label>&nbsp;&nbsp;
-								<label for="gender-2"><input type="checkbox" name="gender[]" value="2" id="gender-2" checked="checked" class="input_check" /> ', $txt['female'], '</label>
-							</fieldset>
-						</div>
-						<div class="msearch_details floatright">
-							<fieldset>
-								<legend>', $txt['activation_status'], '</legend>
-								<label for="activated-0"><input type="checkbox" name="activated[]" value="1" id="activated-0" checked="checked" class="input_check" /> ', $txt['activated'], '</label>&nbsp;&nbsp;
-								<label for="activated-1"><input type="checkbox" name="activated[]" value="0" id="activated-1" checked="checked" class="input_check" /> ', $txt['not_activated'], '</label>
-							</fieldset>
-						</div>
+					<div class="msearch_details floatright">
+						<fieldset>
+							<legend>', $txt['activation_status'], '</legend>
+							<label for="activated-0"><input type="checkbox" name="activated[]" value="1" id="activated-0" checked class="input_check"> ', $txt['activated'], '</label>&nbsp;&nbsp;
+							<label for="activated-1"><input type="checkbox" name="activated[]" value="0" id="activated-1" checked class="input_check"> ', $txt['not_activated'], '</label>
+						</fieldset>
 					</div>
 				</div>
-				<span class="botslice clear_right"><span></span></span>
 			</div>
-			<br />
-			<div class="title_bar">
-				<h3 class="titlebg">', $txt['member_part_of_these_membergroups'], '</h3>
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['member_part_of_these_membergroups'], '</h3>
 			</div>
 			<div class="flow_hidden">
 				<table width="49%" class="table_grid floatleft">
 					<thead>
-						<tr class="catbg">
-							<th scope="col" class="first_th">', $txt['membergroups'], '</th>
-							<th scope="col">', $txt['primary'], '</th>
-							<th scope="col" class="last_th">', $txt['additional'], '</th>
+						<tr class="title_bar">
+							<th scope="col">', $txt['membergroups'], '</th>
+							<th scope="col" class="centercol">', $txt['primary'], '</th>
+							<th scope="col" class="centercol">', $txt['additional'], '</th>
 						</tr>
 					</thead>
 					<tbody>';
 
 			foreach ($context['membergroups'] as $membergroup)
 				echo '
-						<tr class="windowbg2">
+						<tr class="windowbg">
 							<td>', $membergroup['name'], '</td>
-							<td align="center">
-								<input type="checkbox" name="membergroups[1][]" value="', $membergroup['id'], '" checked="checked" class="input_check" />
+							<td class="centercol">
+								<input type="checkbox" name="membergroups[1][]" value="', $membergroup['id'], '" checked class="input_check">
 							</td>
-							<td align="center">
-								', $membergroup['can_be_additional'] ? '<input type="checkbox" name="membergroups[2][]" value="' . $membergroup['id'] . '" checked="checked" class="input_check" />' : '', '
+							<td class="centercol">
+								', $membergroup['can_be_additional'] ? '<input type="checkbox" name="membergroups[2][]" value="' . $membergroup['id'] . '" checked class="input_check">' : '', '
 							</td>
 						</tr>';
 
 			echo '
-						<tr class="windowbg2">
+						<tr class="windowbg">
 							<td>
 								<em>', $txt['check_all'], '</em>
 							</td>
-							<td align="center">
-								<input type="checkbox" onclick="invertAll(this, this.form, \'membergroups[1]\');" checked="checked" class="input_check" />
+							<td class="centercol">
+								<input type="checkbox" onclick="invertAll(this, this.form, \'membergroups[1]\');" checked class="input_check">
 							</td>
-							<td align="center">
-								<input type="checkbox" onclick="invertAll(this, this.form, \'membergroups[2]\');" checked="checked" class="input_check" />
+							<td class="centercol">
+								<input type="checkbox" onclick="invertAll(this, this.form, \'membergroups[2]\');" checked class="input_check">
 							</td>
 						</tr>
 					</tbody>
@@ -202,49 +175,47 @@
 
 				<table width="49%" class="table_grid floatright">
 					<thead>
-						<tr class="catbg">
-							<th scope="col" class="first_th">
+						<tr class="title_bar">
+							<th scope="col">
 								', $txt['membergroups_postgroups'], '
 							</th>
-							<th class="last_th">&nbsp;</th>
+							<th>&nbsp;</th>
 						</tr>
 					</thead>
-					</tbody>';
+					<tbody>';
 
 			foreach ($context['postgroups'] as $postgroup)
 				echo '
-						<tr class="windowbg2">
+						<tr class="windowbg">
 							<td>
 								', $postgroup['name'], '
 							</td>
-							<td width="40" align="center">
-								<input type="checkbox" name="postgroups[]" value="', $postgroup['id'], '" checked="checked" class="input_check" />
+							<td width="40" class="centercol">
+								<input type="checkbox" name="postgroups[]" value="', $postgroup['id'], '" checked class="input_check">
 							</td>
 						</tr>';
 
 			echo '
-						<tr class="windowbg2">
+						<tr class="windowbg">
 							<td>
 								<em>', $txt['check_all'], '</em>
 							</td>
-							<td align="center">
-								<input type="checkbox" onclick="invertAll(this, this.form, \'postgroups[]\');" checked="checked" class="input_check" />
+							<td class="centercol">
+								<input type="checkbox" onclick="invertAll(this, this.form, \'postgroups[]\');" checked class="input_check">
 							</td>
 						</tr>
 					</tbody>
 				</table>
-			</div><br />
-			<div class="righttext">
-				<input type="submit" value="', $txt['search'], '" class="button_submit" />
 			</div>
+			<br>
+			<input type="submit" value="', $txt['search'], '" class="button_submit">
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_admin_browse()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">';
@@ -255,12 +226,12 @@
 	if ($context['approve_list']['total_num_items'] > 20)
 	{
 		echo '
-		<br />
-		<form action="', $scripturl, '?action=admin;area=viewmembers" method="post" accept-charset="', $context['character_set'], '" name="postFormOutstanding" id="postFormOutstanding" onsubmit="return onOutstandingSubmit();">
+		<br>
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=viewmembers" method="post" accept-charset="', $context['character_set'], '" name="postFormOutstanding" id="postFormOutstanding" onsubmit="return onOutstandingSubmit();">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['admin_browse_outstanding'], '</h3>
 			</div>
-			<script type="text/javascript"><!-- // --><![CDATA[
+			<script><!-- // --><![CDATA[
 				function onOutstandingSubmit()
 				{
 					if (document.forms.postFormOutstanding.todo.value == "")
@@ -284,49 +255,44 @@
 			// ]]></script>
 
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							', $txt['admin_browse_outstanding_days_1'], ':
-						</dt>
-						<dd>
-							<input type="text" name="time_passed" value="14" maxlength="4" size="3" class="input_text" /> ', $txt['admin_browse_outstanding_days_2'], '.
-						</dd>
-						<dt>
-							', $txt['admin_browse_outstanding_perform'], ':
-						</dt>
-						<dd>
-							<select name="todo">
-								', $context['browse_type'] == 'activate' ? '
-								<option value="ok">' . $txt['admin_browse_w_activate'] . '</option>' : '', '
-								<option value="okemail">', $context['browse_type'] == 'approve' ? $txt['admin_browse_w_approve'] : $txt['admin_browse_w_activate'], ' ', $txt['admin_browse_w_email'], '</option>', $context['browse_type'] == 'activate' ? '' : '
-								<option value="require_activation">' . $txt['admin_browse_w_approve_require_activate'] . '</option>', '
-								<option value="reject">', $txt['admin_browse_w_reject'], '</option>
-								<option value="rejectemail">', $txt['admin_browse_w_reject'], ' ', $txt['admin_browse_w_email'], '</option>
-								<option value="delete">', $txt['admin_browse_w_delete'], '</option>
-								<option value="deleteemail">', $txt['admin_browse_w_delete'], ' ', $txt['admin_browse_w_email'], '</option>', $context['browse_type'] == 'activate' ? '
-								<option value="remind">' . $txt['admin_browse_w_remind'] . '</option>' : '', '
-							</select>
-						</dd>
-					</dl>
-					<input type="submit" value="', $txt['admin_browse_outstanding_go'], '" class="button_submit" />
-					<input type="hidden" name="type" value="', $context['browse_type'], '" />
-					<input type="hidden" name="sort" value="', $context['approve_list']['sort']['id'], '" />
-					<input type="hidden" name="start" value="', $context['approve_list']['start'], '" />
-					<input type="hidden" name="orig_filter" value="', $context['current_filter'], '" />
-					<input type="hidden" name="sa" value="approve" />', !empty($context['approve_list']['sort']['desc']) ? '
-					<input type="hidden" name="desc" value="1" />' : '', '
-				</div>
-				<span class="botslice"><span></span></span>
+				<dl class="settings">
+					<dt>
+						', $txt['admin_browse_outstanding_days_1'], ':
+					</dt>
+					<dd>
+						<input type="text" name="time_passed" value="14" maxlength="4" size="3" class="input_text"> ', $txt['admin_browse_outstanding_days_2'], '.
+					</dd>
+					<dt>
+						', $txt['admin_browse_outstanding_perform'], ':
+					</dt>
+					<dd>
+						<select name="todo">
+							', $context['browse_type'] == 'activate' ? '
+							<option value="ok">' . $txt['admin_browse_w_activate'] . '</option>' : '', '
+							<option value="okemail">', $context['browse_type'] == 'approve' ? $txt['admin_browse_w_approve'] : $txt['admin_browse_w_activate'], ' ', $txt['admin_browse_w_email'], '</option>', $context['browse_type'] == 'activate' ? '' : '
+							<option value="require_activation">' . $txt['admin_browse_w_approve_require_activate'] . '</option>', '
+							<option value="reject">', $txt['admin_browse_w_reject'], '</option>
+							<option value="rejectemail">', $txt['admin_browse_w_reject'], ' ', $txt['admin_browse_w_email'], '</option>
+							<option value="delete">', $txt['admin_browse_w_delete'], '</option>
+							<option value="deleteemail">', $txt['admin_browse_w_delete'], ' ', $txt['admin_browse_w_email'], '</option>', $context['browse_type'] == 'activate' ? '
+							<option value="remind">' . $txt['admin_browse_w_remind'] . '</option>' : '', '
+						</select>
+					</dd>
+				</dl>
+				<input type="submit" value="', $txt['admin_browse_outstanding_go'], '" class="button_submit">
+				<input type="hidden" name="type" value="', $context['browse_type'], '">
+				<input type="hidden" name="sort" value="', $context['approve_list']['sort']['id'], '">
+				<input type="hidden" name="start" value="', $context['approve_list']['start'], '">
+				<input type="hidden" name="orig_filter" value="', $context['current_filter'], '">
+				<input type="hidden" name="sa" value="approve">', !empty($context['approve_list']['sort']['desc']) ? '
+				<input type="hidden" name="desc" value="1">' : '', '
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 		</form>';
 	}
 
 	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManageNews.template.php b/Themes/default/ManageNews.template.php
--- a/Themes/default/ManageNews.template.php	2011-06-10 03:42:24.000000000 -0700
+++ b/Themes/default/ManageNews.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,102 +3,25 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
-// Form for editing current news on the site.
-function template_edit_news()
-{
-	global $context, $settings, $options, $scripturl, $txt;
-
-	echo '
-	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=news;sa=editnews" method="post" accept-charset="', $context['character_set'], '" name="postmodify" id="postmodify">
-			<table class="table_grid" width="100%">
-				<thead>
-					<tr class="catbg">
-						<th class="first_th" width="50%">', $txt['admin_edit_news'], '</th>
-						<th align="left" width="45%">', $txt['preview'], '</th>
-						<th class="last_th" align="center" width="5%"><input type="checkbox" class="input_check" onclick="invertAll(this, this.form);" /></th>
-					</tr>
-				</thead>
-				<tbody>';
-
-	// Loop through all the current news items so you can edit/remove them.
-	foreach ($context['admin_current_news'] as $admin_news)
-		echo '
-					<tr class="windowbg2">
-						<td align="center">
-
-							<div style="margin-bottom: 2ex;"><textarea rows="3" cols="65" name="news[]" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 85%; min-width: 85%' : 'width: 85%') . ';">', $admin_news['unparsed'], '</textarea></div>
-						</td><td align="left" valign="top">
-							<div style="overflow: auto; width: 100%; height: 10ex;">', $admin_news['parsed'], '</div>
-						</td><td align="center">
-							<input type="checkbox" name="remove[]" value="', $admin_news['id'], '" class="input_check" />
-						</td>
-					</tr>';
-
-	// This provides an empty text box to add a news item to the site.
-	echo '
-					<tr id="moreNews" class="windowbg2" style="display: none;">
-						<td align="center">
-							<div id="moreNewsItems"></div>
-						</td>
-						<td align="center">
-						</td>
-						<td align="center">
-						</td>
-					</tr>
-				</tbody>
-			</table>
-			<div class="floatleftpadding">
-				<div id="moreNewsItems_link" style="display: none;"><a href="javascript:void(0);" onclick="addNewsItem(); return false;">', $txt['editnews_clickadd'], '</a></div>
-				<script type="text/javascript"><!-- // --><![CDATA[
-					document.getElementById("moreNewsItems_link").style.display = "";
-					function addNewsItem()
-					{
-						document.getElementById("moreNews").style.display = "";
-						setOuterHTML(document.getElementById("moreNewsItems"), \'<div style="margin-bottom: 2ex;"><textarea rows="3" cols="65" name="news[]" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 85%; min-width: 85%' : 'width: 85%') . ';"><\' + \'/textarea><\' + \'/div><div id="moreNewsItems"><\' + \'/div>\');
-					}
-				// ]]></script>
-				<noscript>
-					<div style="margin-bottom: 2ex;"><textarea rows="3" cols="65" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 85%; min-width: 85%' : 'width: 85%') . ';" name="news[]"></textarea></div>
-				</noscript>
-			</div>
-			<div class="floatrightpadding">
-				<input type="submit" name="save_items" value="', $txt['save'], '" class="button_submit" /> <input type="submit" name="delete_selection" value="', $txt['editnews_remove_selected'], '" onclick="return confirm(\'', $txt['editnews_remove_confirm'], '\');" class="button_submit" />
-			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
-	</div>
-	<br class="clear" />';
-}
-
 function template_email_members()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
-	// This is some javascript for the simple/advanced toggling stuff.
-	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function toggleAdvanced(mode)
-		{
-			// What styles are we doing?
-			var divStyle = mode ? "" : "none";
-
-			document.getElementById("advanced_settings_div").style.display = divStyle;
-			document.getElementById("gosimple").style.display = divStyle;
-			document.getElementById("goadvanced").style.display = mode ? "none" : "";
-		}
-	// ]]></script>';
+	// Are we done sending the newsletter?
+	if (!empty($context['newsletter_sent']))
+		echo '
+	<div class="infobox">', $txt['admin_news_newsletter_'. $context['newsletter_sent']] ,'</div>';
 
 	echo '
 	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=news;sa=mailingcompose" method="post" class="flow_hidden" accept-charset="', $context['character_set'], '">
+		<form action="', $scripturl, '?action=admin;area=news;sa=mailingcompose" method="post" id="admin_newsletters" class="flow_hidden" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['admin_newsletters'], '</h3>
 			</div>
@@ -106,115 +29,126 @@
 				', $txt['admin_news_select_recipients'], '
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<strong>', $txt['admin_news_select_group'], ':</strong><br />
-							<span class="smalltext">', $txt['admin_news_select_group_desc'], '</span>
-						</dt>
-						<dd>';
+				<dl class="settings">
+					<dt>
+						<strong>', $txt['admin_news_select_group'], ':</strong><br>
+						<span class="smalltext">', $txt['admin_news_select_group_desc'], '</span>
+					</dt>
+					<dd>';
 
 	foreach ($context['groups'] as $group)
 				echo '
-							<label for="groups_', $group['id'], '"><input type="checkbox" name="groups[', $group['id'], ']" id="groups_', $group['id'], '" value="', $group['id'], '" checked="checked" class="input_check" /> ', $group['name'], '</label> <em>(', $group['member_count'], ')</em><br />';
+						<label for="groups_', $group['id'], '"><input type="checkbox" name="groups[', $group['id'], ']" id="groups_', $group['id'], '" value="', $group['id'], '" checked class="input_check"> ', $group['name'], '</label> <em>(', $group['member_count'], ')</em><br>';
 
 	echo '
-							<br />
-							<label for="checkAllGroups"><input type="checkbox" id="checkAllGroups" checked="checked" onclick="invertAll(this, this.form, \'groups\');" class="input_check" /> <em>', $txt['check_all'], '</em></label>';
+						<br>
+						<label for="checkAllGroups"><input type="checkbox" id="checkAllGroups" checked onclick="invertAll(this, this.form, \'groups\');" class="input_check"> <em>', $txt['check_all'], '</em></label>';
 
 	echo '
-						</dd>
-					</dl><br class="clear" />
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<br />
+					</dd>
+				</dl>
+				<br class="clear">
+			<br>
 
-			<div class="cat_bar">
-				<h3 class="catbg" id="advanced_select_div" style="display: none;">
-					<span class="ie6_header floatleft">
-						<a href="#" onclick="toggleAdvanced(1); return false;" id="goadvanced"><img src="', $settings['images_url'], '/selected.gif" alt="', $txt['advanced'], '" />&nbsp;<strong>', $txt['advanced'], '</strong></a>
-						<a href="#" onclick="toggleAdvanced(0); return false;" id="gosimple" style="display: none;"><img src="', $settings['images_url'], '/sort_down.gif" alt="', $txt['simple'], '" />&nbsp;<strong>', $txt['simple'], '</strong></a>
-					</span>
+			<div id="advanced_panel_header" class="title_bar">
+				<h3 class="titlebg">
+					<span id="advanced_panel_toggle" class="toggle_down floatright" style="display: none;"></span>
+					<a href="#" id="advanced_panel_link">', $txt['advanced'], '</a>
 				</h3>
 			</div>
 
-			<div class="windowbg2" id="advanced_settings_div" style="display: none;">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<strong>', $txt['admin_news_select_email'], ':</strong><br />
-							<span class="smalltext">', $txt['admin_news_select_email_desc'], '</span>
-						</dt>
-						<dd>
-							<textarea name="emails" rows="5" cols="30" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 98%; min-width: 98%' : 'width: 98%') . ';"></textarea>
-						</dd>
-						<dt>
-							<strong>', $txt['admin_news_select_members'], ':</strong><br />
-							<span class="smalltext">', $txt['admin_news_select_members_desc'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="members" id="members" value="" size="30" class="input_text" />
-							<span id="members_container"></span>
-						</dd>
-					</dl>
-					<hr class="bordercolor" />
-					<dl class="settings">
-						<dt>
-							<strong>', $txt['admin_news_select_excluded_groups'], ':</strong><br />
-							<span class="smalltext">', $txt['admin_news_select_excluded_groups_desc'], '</span>
-						</dt>
-						<dd>';
+			<div id="advanced_panel_div" class="padding">
+				<dl class="settings">
+					<dt>
+						<strong>', $txt['admin_news_select_email'], ':</strong><br>
+						<span class="smalltext">', $txt['admin_news_select_email_desc'], '</span>
+					</dt>
+					<dd>
+						<textarea name="emails" rows="5" cols="30" style="width: 98%;"></textarea>
+					</dd>
+					<dt>
+						<strong>', $txt['admin_news_select_members'], ':</strong><br>
+						<span class="smalltext">', $txt['admin_news_select_members_desc'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="members" id="members" value="" size="30" class="input_text">
+						<span id="members_container"></span>
+					</dd>
+				</dl>
+				<hr class="bordercolor">
+				<dl class="settings">
+					<dt>
+						<strong>', $txt['admin_news_select_excluded_groups'], ':</strong><br>
+						<span class="smalltext">', $txt['admin_news_select_excluded_groups_desc'], '</span>
+					</dt>
+					<dd>';
 
 	foreach ($context['groups'] as $group)
 				echo '
-							<label for="exclude_groups_', $group['id'], '"><input type="checkbox" name="exclude_groups[', $group['id'], ']" id="exclude_groups_', $group['id'], '" value="', $group['id'], '" class="input_check" /> ', $group['name'], '</label> <em>(', $group['member_count'], ')</em><br />';
+						<label for="exclude_groups_', $group['id'], '"><input type="checkbox" name="exclude_groups[', $group['id'], ']" id="exclude_groups_', $group['id'], '" value="', $group['id'], '" class="input_check"> ', $group['name'], '</label> <em>(', $group['member_count'], ')</em><br>';
 
 	echo '
-							<br />
-							<label for="checkAllGroupsExclude"><input type="checkbox" id="checkAllGroupsExclude" onclick="invertAll(this, this.form, \'exclude_groups\');" class="input_check" /> <em>', $txt['check_all'], '</em></label><br />
-						</dd>
-						<dt>
-							<strong>', $txt['admin_news_select_excluded_members'], ':</strong><br />
-							<span class="smalltext">', $txt['admin_news_select_excluded_members_desc'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="exclude_members" id="exclude_members" value="" size="30" class="input_text" />
-							<span id="exclude_members_container"></span>
-						</dd>
-					</dl>
-					<hr class="bordercolor" />
-					<dl class="settings">
-						<dt>
-							<label for="email_force"><strong>', $txt['admin_news_select_override_notify'], ':</strong></label><br />
-							<span class="smalltext">', $txt['email_force'], '</span>
-						</dt>
-						<dd>
-							<input type="checkbox" name="email_force" id="email_force" value="1" class="input_check" />
-						</dd>
-					</dl><br class="clear" />
-				</div>
-				<span class="botslice"><span></span></span>
+						<br>
+						<label for="checkAllGroupsExclude"><input type="checkbox" id="checkAllGroupsExclude" onclick="invertAll(this, this.form, \'exclude_groups\');" class="input_check"> <em>', $txt['check_all'], '</em></label><br>
+					</dd>
+					<dt>
+						<strong>', $txt['admin_news_select_excluded_members'], ':</strong><br>
+						<span class="smalltext">', $txt['admin_news_select_excluded_members_desc'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="exclude_members" id="exclude_members" value="" size="30" class="input_text">
+						<span id="exclude_members_container"></span>
+					</dd>
+				</dl>
+				<hr class="bordercolor">
+				<dl class="settings">
+					<dt>
+						<label for="email_force"><strong>', $txt['admin_news_select_override_notify'], ':</strong></label><br>
+						<span class="smalltext">', $txt['email_force'], '</span>
+					</dt>
+					<dd>
+						<input type="checkbox" name="email_force" id="email_force" value="1" class="input_check">
+					</dd>
+				</dl>
 			</div>
 			<div class="righttext">
-				<input type="submit" value="', $txt['admin_next'], '" class="button_submit" />
-				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+				<input type="submit" value="', $txt['admin_next'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			</div>
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 
-	// Make the javascript stuff visible.
+	// This is some javascript for the simple/advanced toggling and member suggest
 	echo '
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-	<script type="text/javascript"><!-- // --><![CDATA[
-		document.getElementById("advanced_select_div").style.display = "";
+	<script><!-- // --><![CDATA[
+		var oAdvancedPanelToggle = new smc_Toggle({
+			bToggleEnabled: true,
+			bCurrentlyCollapsed: true,
+			aSwappableContainers: [
+				\'advanced_panel_div\'
+			],
+			aSwapImages: [
+				{
+					sId: \'advanced_panel_toggle\',
+					altExpanded: ', JavaScriptEscape($txt['hide']), ',
+					altCollapsed: ', JavaScriptEscape($txt['show']), '
+				}
+			],
+			aSwapLinks: [
+				{
+					sId: \'advanced_panel_link\',
+					msgExpanded: ', JavaScriptEscape($txt['advanced']), ',
+					msgCollapsed: ', JavaScriptEscape($txt['advanced']), '
+				}
+			]
+		});
+	// ]]></script>
+	<script><!-- // --><![CDATA[
 		var oMemberSuggest = new smc_AutoSuggest({
 			sSelf: \'oMemberSuggest\',
-			sSessionId: \'', $context['session_id'], '\',
-			sSessionVar: \'', $context['session_var'], '\',
+			sSessionId: smf_session_id,
+			sSessionVar: smf_session_var,
 			sSuggestId: \'members\',
 			sControlId: \'members\',
 			sSearchType: \'member\',
@@ -244,96 +178,250 @@
 
 function template_email_members_compose()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $settings, $txt, $scripturl;
+
+	echo '
+		<div id="preview_section"', isset($context['preview_message']) ? '' : ' style="display: none;"', '>
+			<div class="cat_bar">
+				<h3 class="catbg">
+					<span id="preview_subject">', empty($context['preview_subject']) ? '' : $context['preview_subject'], '</span>
+				</h3>
+			</div>
+			<div class="windowbg">
+				<div class="post" id="preview_body">
+					', empty($context['preview_message']) ? '<br>' : $context['preview_message'], '
+				</div>
+			</div>
+		</div><br>';
 
 	echo '
 	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=news;sa=mailingsend" method="post" accept-charset="', $context['character_set'], '">
+		<form name="newsmodify" action="', $scripturl, '?action=admin;area=news;sa=mailingsend" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">
-					<a href="', $scripturl, '?action=helpadmin;help=email_members" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" class="icon" /></a> ', $txt['admin_newsletters'], '
+					<a href="', $scripturl, '?action=helpadmin;help=email_members" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a> ', $txt['admin_newsletters'], '
 				</h3>
 			</div>
 			<div class="information">
 				', $txt['email_variables'], '
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>
-						<input type="text" name="subject" size="60" value="', $context['default_subject'], '" class="input_text" />
-					</p>
-					<p>
-						<textarea cols="70" rows="9" name="message" class="editor">', $context['default_message'], '</textarea>
-					</p>
-					<ul class="reset">
-						<li><label for="send_pm"><input type="checkbox" name="send_pm" id="send_pm" class="input_check" onclick="if (this.checked && ', $context['total_emails'], ' != 0 && !confirm(\'', $txt['admin_news_cannot_pm_emails_js'], '\')) return false; this.form.parse_html.disabled = this.checked; this.form.send_html.disabled = this.checked; " /> ', $txt['email_as_pms'], '</label></li>
-						<li><label for="send_html"><input type="checkbox" name="send_html" id="send_html" class="input_check" onclick="this.form.parse_html.disabled = !this.checked;" /> ', $txt['email_as_html'], '</label></li>
-						<li><label for="parse_html"><input type="checkbox" name="parse_html" id="parse_html" checked="checked" disabled="disabled" class="input_check" /> ', $txt['email_parsed_html'], '</label></li>
-					</ul>
-					<p>
-						<input type="submit" value="', $txt['sendtopic_send'], '" class="button_submit" />
-					</p>
+				<div class="', empty($context['error_type']) || $context['error_type'] != 'serious' ? 'noticebox' : 'errorbox', '"', empty($context['post_error']['messages']) ? ' style="display: none"' : '', ' id="errors">
+					<dl>
+						<dt>
+							<strong id="error_serious">', $txt['error_while_submitting'] , '</strong>
+						</dt>
+						<dd class="error" id="error_list">
+							', empty($context['post_error']['messages']) ? '' : implode('<br>', $context['post_error']['messages']), '
+						</dd>
+					</dl>
 				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			<input type="hidden" name="email_force" value="', $context['email_force'], '" />
-			<input type="hidden" name="total_emails" value="', $context['total_emails'], '" />
-			<input type="hidden" name="max_id_member" value="', $context['max_id_member'], '" />';
+				<dl id="post_header">
+					<dt class="clear_left">
+						<span', (isset($context['post_error']['no_subject']) ? ' class="error"' : ''), ' id="caption_subject">', $txt['subject'], ':</span>
+					</dt>
+					<dd id="pm_subject">
+						<input type="text" name="subject" value="', $context['subject'], '" tabindex="', $context['tabindex']++, '" size="60" maxlength="60"',isset($context['post_error']['no_subject']) ? ' class="error"' : ' class="input_text"', '/>
+					</dd>
+				</dl><hr class="clear">
+				<div id="bbcBox_message"></div>';
+
+	// What about smileys?
+	if (!empty($context['smileys']['postform']) || !empty($context['smileys']['popup']))
+		echo '
+				<div id="smileyBox_message"></div>';
+
+	// Show BBC buttons, smileys and textbox.
+	echo '
+				', template_control_richedit($context['post_box_name'], 'smileyBox_message', 'bbcBox_message');
+
+					echo '
+				<ul class="reset">
+					<li><label for="send_pm"><input type="checkbox" name="send_pm" id="send_pm"', !empty($context['send_pm']) ? ' checked' : '', ' class="input_check" onclick="checkboxes_status(this);"> ', $txt['email_as_pms'], '</label></li>
+					<li><label for="send_html"><input type="checkbox" name="send_html" id="send_html"', !empty($context['send_html']) ? ' checked' : '', ' class="input_check" onclick="checkboxes_status(this);"> ', $txt['email_as_html'], '</label></li>
+					<li><label for="parse_html"><input type="checkbox" name="parse_html" id="parse_html" checked disabled class="input_check"> ', $txt['email_parsed_html'], '</label></li>
+				</ul>
+				<br class="clear_right">
+				<span id="post_confirm_buttons">
+					', template_control_richedit_buttons($context['post_box_name']), '
+				</span>
+			</div>
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="email_force" value="', $context['email_force'], '">
+			<input type="hidden" name="total_emails" value="', $context['total_emails'], '">';
 
 	foreach ($context['recipients'] as $key => $values)
 		echo '
-			<input type="hidden" name="', $key, '" value="', implode(($key == 'emails' ? ';' : ','), $values), '" />';
+			<input type="hidden" name="', $key, '" value="', implode(($key == 'emails' ? ';' : ','), $values), '">';
 
 	echo '
+		<script><!-- // --><![CDATA[';
+	// The functions used to preview a posts without loading a new page.
+	echo '
+			var txt_preview_title = "', $txt['preview_title'], '";
+			var txt_preview_fetch = "', $txt['preview_fetch'], '";
+			function previewPost()
+			{';
+	if (isBrowser('is_firefox'))
+		echo '
+				// Firefox doesn\'t render <marquee> that have been put it using javascript
+				if (document.forms.newsmodify.elements[', JavaScriptEscape($context['post_box_name']), '].value.indexOf(\'[move]\') != -1)
+				{
+					return submitThisOnce(document.forms.newsmodify);
+				}';
+	echo '
+				if (window.XMLHttpRequest)
+				{
+					// Opera didn\'t support setRequestHeader() before 8.01.
+					// @todo Remove support for old browsers
+					if (\'opera\' in window)
+					{
+						var test = new XMLHttpRequest();
+						if (!(\'setRequestHeader\' in test))
+							return submitThisOnce(document.forms.newsmodify);
+					}
+					// @todo Currently not sending poll options and option checkboxes.
+					var x = new Array();
+					var textFields = [\'subject\', ', JavaScriptEscape($context['post_box_name']), '];
+					var checkboxFields = [\'send_html\', \'send_pm\'];
+
+					for (var i = 0, n = textFields.length; i < n; i++)
+						if (textFields[i] in document.forms.newsmodify)
+						{
+							// Handle the WYSIWYG editor.
+							if (textFields[i] == ', JavaScriptEscape($context['post_box_name']), ' && ', JavaScriptEscape('oEditorHandle_' . $context['post_box_name']), ' in window && oEditorHandle_', $context['post_box_name'], '.bRichTextEnabled)
+								x[x.length] = \'message_mode=1&\' + textFields[i] + \'=\' + oEditorHandle_', $context['post_box_name'], '.getText(false).replace(/&#/g, \'&#38;#\').php_to8bit().php_urlencode();
+							else
+								x[x.length] = textFields[i] + \'=\' + document.forms.newsmodify[textFields[i]].value.replace(/&#/g, \'&#38;#\').php_to8bit().php_urlencode();
+						}
+					for (var i = 0, n = checkboxFields.length; i < n; i++)
+						if (checkboxFields[i] in document.forms.newsmodify && document.forms.newsmodify.elements[checkboxFields[i]].checked)
+							x[x.length] = checkboxFields[i] + \'=\' + document.forms.newsmodify.elements[checkboxFields[i]].value;
+
+					x[x.length] = \'item=newsletterpreview\';
+
+					sendXMLDocument(smf_prepareScriptUrl(smf_scripturl) + \'action=xmlhttp;sa=previews;xml\', x.join(\'&\'), onDocSent);
+
+					document.getElementById(\'preview_section\').style.display = \'\';
+					setInnerHTML(document.getElementById(\'preview_subject\'), txt_preview_title);
+					setInnerHTML(document.getElementById(\'preview_body\'), txt_preview_fetch);
+
+					return false;
+				}
+				else
+					return submitThisOnce(document.forms.newsmodify);
+			}
+			function onDocSent(XMLDoc)
+			{
+				if (!XMLDoc)
+				{
+					document.forms.newsmodify.preview.onclick = new function ()
+					{
+						return true;
+					}
+					document.forms.newsmodify.preview.click();
+				}
+
+				// Show the preview section.
+				var preview = XMLDoc.getElementsByTagName(\'smf\')[0].getElementsByTagName(\'preview\')[0];
+				setInnerHTML(document.getElementById(\'preview_subject\'), preview.getElementsByTagName(\'subject\')[0].firstChild.nodeValue);
+
+				var bodyText = \'\';
+				for (var i = 0, n = preview.getElementsByTagName(\'body\')[0].childNodes.length; i < n; i++)
+					bodyText += preview.getElementsByTagName(\'body\')[0].childNodes[i].nodeValue;
+
+				setInnerHTML(document.getElementById(\'preview_body\'), bodyText);
+				document.getElementById(\'preview_body\').className = \'post\';
+
+				// Show a list of errors (if any).
+				var errors = XMLDoc.getElementsByTagName(\'smf\')[0].getElementsByTagName(\'errors\')[0];
+				var errorList = new Array();
+				for (var i = 0, numErrors = errors.getElementsByTagName(\'error\').length; i < numErrors; i++)
+					errorList[errorList.length] = errors.getElementsByTagName(\'error\')[i].firstChild.nodeValue;
+				document.getElementById(\'errors\').style.display = numErrors == 0 ? \'none\' : \'\';
+				setInnerHTML(document.getElementById(\'error_list\'), numErrors == 0 ? \'\' : errorList.join(\'<br>\'));
+
+				// Adjust the color of captions if the given data is erroneous.
+				var captions = errors.getElementsByTagName(\'caption\');
+				for (var i = 0, numCaptions = errors.getElementsByTagName(\'caption\').length; i < numCaptions; i++)
+					if (document.getElementById(\'caption_\' + captions[i].getAttribute(\'name\')))
+						document.getElementById(\'caption_\' + captions[i].getAttribute(\'name\')).className = captions[i].getAttribute(\'class\');
+
+				if (errors.getElementsByTagName(\'post_error\').length == 1)
+					document.forms.newsmodify.', $context['post_box_name'], '.style.border = \'1px solid red\';
+				else if (document.forms.newsmodify.', $context['post_box_name'], '.style.borderColor == \'red\' || document.forms.newsmodify.', $context['post_box_name'], '.style.borderColor == \'red red red red\')
+				{
+					if (\'runtimeStyle\' in document.forms.newsmodify.', $context['post_box_name'], ')
+						document.forms.newsmodify.', $context['post_box_name'], '.style.borderColor = \'\';
+					else
+						document.forms.newsmodify.', $context['post_box_name'], '.style.border = null;
+				}
+				location.hash = \'#\' + \'preview_section\';
+			}';
+
+	echo '
+		// ]]></script>';
+
+	echo '
+		<script><!-- // --><![CDATA[
+			function checkboxes_status (item)
+			{
+				if (item.id == \'send_html\')
+					document.getElementById(\'parse_html\').disabled = !document.getElementById(\'parse_html\').disabled;
+				if (item.id == \'send_pm\')
+				{
+					if (!document.getElementById(\'send_html\').checked)
+						document.getElementById(\'parse_html\').disabled = true;
+					else
+						document.getElementById(\'parse_html\').disabled = false;
+					document.getElementById(\'send_html\').disabled = !document.getElementById(\'send_html\').disabled;
+				}
+			}
+		// ]]></script>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_email_members_send()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $settings, $txt, $scripturl;
 
 	echo '
 	<div id="admincenter">
 		<form action="', $scripturl, '?action=admin;area=news;sa=mailingsend" method="post" accept-charset="', $context['character_set'], '" name="autoSubmit" id="autoSubmit">
 			<div class="cat_bar">
 				<h3 class="catbg">
-					<a href="', $scripturl, '?action=helpadmin;help=email_members" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" align="top" /></a> ', $txt['admin_newsletters'], '
+					<a href="', $scripturl, '?action=helpadmin;help=email_members" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a> ', $txt['admin_newsletters'], '
 				</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>
-						<strong>', $context['percentage_done'], '% ', $txt['email_done'], '</strong>
-					</p>
-					<input type="submit" name="b" value="', $txt['email_continue'], '" class="button_submit" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="hidden" name="subject" value="', $context['subject'], '" />
-					<input type="hidden" name="message" value="', $context['message'], '" />
-					<input type="hidden" name="start" value="', $context['start'], '" />
-					<input type="hidden" name="total_emails" value="', $context['total_emails'], '" />
-					<input type="hidden" name="max_id_member" value="', $context['max_id_member'], '" />
-					<input type="hidden" name="send_pm" value="', $context['send_pm'], '" />
-					<input type="hidden" name="send_html" value="', $context['send_html'], '" />
-					<input type="hidden" name="parse_html" value="', $context['parse_html'], '" />';
+				<div class="progress_bar">
+					<div class="full_bar">', $context['percentage_done'], '% ', $txt['email_done'], '</div>
+					<div class="green_percent" style="width: ', $context['percentage_done'], '%;">&nbsp;</div>
+				</div>
+				<hr class="hrcolor">
+				<input type="submit" name="b" value="', $txt['email_continue'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="subject" value="', $context['subject'], '">
+				<input type="hidden" name="message" value="', $context['message'], '">
+				<input type="hidden" name="start" value="', $context['start'], '">
+				<input type="hidden" name="total_members" value="', $context['total_members'], '">
+				<input type="hidden" name="total_emails" value="', $context['total_emails'], '">
+				<input type="hidden" name="send_pm" value="', $context['send_pm'], '">
+				<input type="hidden" name="send_html" value="', $context['send_html'], '">
+				<input type="hidden" name="parse_html" value="', $context['parse_html'], '">';
 
 	// All the things we must remember!
 	foreach ($context['recipients'] as $key => $values)
 		echo '
-					<input type="hidden" name="', $key, '" value="', implode(($key == 'emails' ? ';' : ','), $values), '" />';
+				<input type="hidden" name="', $key, '" value="', implode(($key == 'emails' ? ';' : ','), $values), '">';
 
 	echo '
-				</div>
-				<span class="botslice"><span></span></span>
 			</div>
 		</form>
 	</div>
-	<br class="clear" />
-	<script type="text/javascript"><!-- // --><![CDATA[
+
+	<script><!-- // --><![CDATA[
 		var countdown = 2;
 		doAutoSubmit();
 
@@ -352,4 +440,15 @@
 	// ]]></script>';
 }
 
+function template_news_lists()
+{
+	global $context, $txt;
+
+	if (!empty($context['saved_successful']))
+		echo '
+					<div class="infobox">', $txt['settings_saved'], '</div>';
+
+	template_show_list('news_lists');
+}
+
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManagePaid.template.php b/Themes/default/ManagePaid.template.php
--- a/Themes/default/ManagePaid.template.php	2011-06-06 10:06:37.000000000 -0700
+++ b/Themes/default/ManagePaid.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,35 +3,17 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // The template for adding or editing a subscription.
 function template_modify_subscription()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
-
-	// Javascript for the duration stuff.
-	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			function toggleDuration(toChange)
-			{
-				if (toChange == \'fixed\')
-				{
-					document.getElementById("fixed_area").style.display = "inline";
-					document.getElementById("flexible_area").style.display = "none";
-				}
-				else
-				{
-					document.getElementById("fixed_area").style.display = "none";
-					document.getElementById("flexible_area").style.display = "inline";
-				}
-			}
-		// ]]></script>';
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="admincenter">
@@ -44,181 +26,175 @@
 		echo '
 			<div class="information">
 				<span class="alert">', $txt['paid_mod_edit_note'], '</span>
-			</div>
-			';
+			</div>';
+
 	echo '
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							', $txt['paid_mod_name'], ':
-						</dt>
-						<dd>
-							<input type="text" name="name" value="', $context['sub']['name'], '" size="30" class="input_text" />
-						</dd>
-						<dt>
-							', $txt['paid_mod_desc'], ':
-						</dt>
-						<dd>
-							<textarea name="desc" rows="3" cols="40">', $context['sub']['desc'], '</textarea>
-						</dd>
-						<dt>
-							<label for="repeatable_check">', $txt['paid_mod_repeatable'], '</label>:
-						</dt>
-						<dd>
-							<input type="checkbox" name="repeatable" id="repeatable_check"', empty($context['sub']['repeatable']) ? '' : ' checked="checked"', ' class="input_check" />
-						</dd>
-						<dt>
-							<label for="activated_check">', $txt['paid_mod_active'], '</label>:<br /><span class="smalltext">', $txt['paid_mod_active_desc'], '</span>
-						</dt>
-						<dd>
-							<input type="checkbox" name="active" id="activated_check"', empty($context['sub']['active']) ? '' : ' checked="checked"', ' class="input_check" />
-						</dd>
-					</dl>
-					<hr class="hrcolor" />
-					<dl class="settings">
-						<dt>
-							', $txt['paid_mod_prim_group'], ':<br /><span class="smalltext">', $txt['paid_mod_prim_group_desc'], '</span>
-						</dt>
-						<dd>
-							<select name="prim_group" ', !empty($context['disable_groups']) ? 'disabled="disabled"' : '', '>
-								<option value="0" ', $context['sub']['prim_group'] == 0 ? 'selected="selected"' : '', '>', $txt['paid_mod_no_group'], '</option>';
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						', $txt['paid_mod_name'], ':
+					</dt>
+					<dd>
+						<input type="text" name="name" value="', $context['sub']['name'], '" size="30" class="input_text">
+					</dd>
+					<dt>
+						', $txt['paid_mod_desc'], ':
+					</dt>
+					<dd>
+						<textarea name="desc" rows="3" cols="40">', $context['sub']['desc'], '</textarea>
+					</dd>
+					<dt>
+						<label for="repeatable_check">', $txt['paid_mod_repeatable'], '</label>:
+					</dt>
+					<dd>
+						<input type="checkbox" name="repeatable" id="repeatable_check"', empty($context['sub']['repeatable']) ? '' : ' checked', ' class="input_check">
+					</dd>
+					<dt>
+						<label for="activated_check">', $txt['paid_mod_active'], '</label>:<br><span class="smalltext">', $txt['paid_mod_active_desc'], '</span>
+					</dt>
+					<dd>
+						<input type="checkbox" name="active" id="activated_check"', empty($context['sub']['active']) ? '' : ' checked', ' class="input_check">
+					</dd>
+				</dl>
+				<hr class="hrcolor">
+				<dl class="settings">
+					<dt>
+						', $txt['paid_mod_prim_group'], ':<br><span class="smalltext">', $txt['paid_mod_prim_group_desc'], '</span>
+					</dt>
+					<dd>
+						<select name="prim_group"', !empty($context['disable_groups']) ? ' disabled' : '', '>
+							<option value="0"', $context['sub']['prim_group'] == 0 ? ' selected' : '', '>', $txt['paid_mod_no_group'], '</option>';
 
 	// Put each group into the box.
 	foreach ($context['groups'] as $id => $name)
 		echo '
-								<option value="', $id, '" ', $context['sub']['prim_group'] == $id ? 'selected="selected"' : '', '>', $name, '</option>';
+							<option value="', $id, '"', $context['sub']['prim_group'] == $id ? ' selected' : '', '>', $name, '</option>';
 
 	echo '
-							</select>
-						</dd>
-						<dt>
-							', $txt['paid_mod_add_groups'], ':<br /><span class="smalltext">', $txt['paid_mod_add_groups_desc'], '</span>
-						</dt>
-						<dd>';
+						</select>
+					</dd>
+					<dt>
+						', $txt['paid_mod_add_groups'], ':<br><span class="smalltext">', $txt['paid_mod_add_groups_desc'], '</span>
+					</dt>
+					<dd>';
 
 	// Put a checkbox in for each group
 	foreach ($context['groups'] as $id => $name)
 		echo '
-							<label for="addgroup_', $id, '"><input type="checkbox" id="addgroup_', $id, '" name="addgroup[', $id, ']"', in_array($id, $context['sub']['add_groups']) ? ' checked="checked"' : '', ' ', !empty($context['disable_groups']) ? ' disabled="disabled"' : '', ' class="input_check" />&nbsp;<span class="smalltext">', $name, '</span></label><br />';
+						<label for="addgroup_', $id, '"><input type="checkbox" id="addgroup_', $id, '" name="addgroup[', $id, ']"', in_array($id, $context['sub']['add_groups']) ? ' checked' : '', !empty($context['disable_groups']) ? ' disabled' : '', ' class="input_check">&nbsp;<span class="smalltext">', $name, '</span></label><br>';
 
 	echo '
-						</dd>
-						<dt>
-							', $txt['paid_mod_reminder'], ':<br /><span class="smalltext">', $txt['paid_mod_reminder_desc'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="reminder" value="', $context['sub']['reminder'], '" size="6" class="input_text" />
-						</dd>
-						<dt>
-							', $txt['paid_mod_email'], ':<br /><span class="smalltext">', $txt['paid_mod_email_desc'], '</span>
-						</dt>
-						<dd>
-							<textarea name="emailcomplete" rows="6" cols="40">', $context['sub']['email_complete'], '</textarea>
-						</dd>
-					</dl>
-					<hr class="hrcolor" />
-					<input type="radio" name="duration_type" id="duration_type_fixed" value="fixed" ', empty($context['sub']['duration']) || $context['sub']['duration'] == 'fixed' ? 'checked="checked"' : '', ' class="input_radio" onclick="toggleDuration(\'fixed\');" />
-					<strong>', $txt['paid_mod_fixed_price'], '</strong>
-					<br />
-					<div id="fixed_area" ', empty($context['sub']['duration']) || $context['sub']['duration'] == 'fixed' ? '' : 'style="display: none;"', '>
-						<fieldset>
-							<dl class="settings">
-								<dt>
-									', $txt['paid_cost'], ' (', str_replace('%1.2f', '', $modSettings['paid_currency_symbol']), '):
-								</dt>
-								<dd>
-									<input type="text" name="cost" value="', empty($context['sub']['cost']['fixed']) ? '0' : $context['sub']['cost']['fixed'], '" size="4" class="input_text" />
-								</dd>
-								<dt>
-									', $txt['paid_mod_span'], ':
-								</dt>
-								<dd>
-									<input type="text" name="span_value" value="', $context['sub']['span']['value'], '" size="4" class="input_text" />
-									<select name="span_unit">
-										<option value="D" ', $context['sub']['span']['unit'] == 'D' ? 'selected="selected"' : '', '>', $txt['paid_mod_span_days'], '</option>
-										<option value="W" ', $context['sub']['span']['unit'] == 'W' ? 'selected="selected"' : '', '>', $txt['paid_mod_span_weeks'], '</option>
-										<option value="M" ', $context['sub']['span']['unit'] == 'M' ? 'selected="selected"' : '', '>', $txt['paid_mod_span_months'], '</option>
-										<option value="Y" ', $context['sub']['span']['unit'] == 'Y' ? 'selected="selected"' : '', '>', $txt['paid_mod_span_years'], '</option>
-									</select>
-								</dd>
-							</dl>
-						</fieldset>
-					</div>
-					<input type="radio" name="duration_type" id="duration_type_flexible" value="flexible" ', !empty($context['sub']['duration']) && $context['sub']['duration'] == 'flexible' ? 'checked="checked"' : '', ' class="input_radio" onclick="toggleDuration(\'flexible\');" />
-					<strong>', $txt['paid_mod_flexible_price'], '</strong>
-					<br />
-					<div id="flexible_area" ', !empty($context['sub']['duration']) && $context['sub']['duration'] == 'flexible' ? '' : 'style="display: none;"', '>
-						<fieldset>';
+					</dd>
+					<dt>
+						', $txt['paid_mod_reminder'], ':<br><span class="smalltext">', $txt['paid_mod_reminder_desc'], ' ', $txt['zero_to_disable'], '</span>
+					</dt>
+					<dd>
+						<input type="number" name="reminder" value="', $context['sub']['reminder'], '" size="6" class="input_text">
+					</dd>
+					<dt>
+						', $txt['paid_mod_email'], ':<br><span class="smalltext">', $txt['paid_mod_email_desc'], '</span>
+					</dt>
+					<dd>
+						<textarea name="emailcomplete" rows="6" cols="40">', $context['sub']['email_complete'], '</textarea>
+					</dd>
+				</dl>
+				<hr class="hrcolor">
+				<input type="radio" name="duration_type" id="duration_type_fixed" value="fixed"', empty($context['sub']['duration']) || $context['sub']['duration'] == 'fixed' ? ' checked' : '', ' class="input_radio" onclick="toggleDuration(\'fixed\');">
+				<strong><label for="duration_type_fixed">', $txt['paid_mod_fixed_price'], '</label></strong>
+				<br>
+				<div id="fixed_area" ', empty($context['sub']['duration']) || $context['sub']['duration'] == 'fixed' ? '' : 'style="display: none;"', '>
+					<fieldset>
+						<dl class="settings">
+							<dt>
+								', $txt['paid_cost'], ' (', str_replace('%1.2f', '', $modSettings['paid_currency_symbol']), '):
+							</dt>
+							<dd>
+								<input type="number" name="cost" value="', empty($context['sub']['cost']['fixed']) ? '0' : $context['sub']['cost']['fixed'], '" size="4" class="input_text">
+							</dd>
+							<dt>
+								', $txt['paid_mod_span'], ':
+							</dt>
+							<dd>
+								<input type="number" name="span_value" value="', $context['sub']['span']['value'], '" size="4" class="input_text">
+								<select name="span_unit">
+									<option value="D"', $context['sub']['span']['unit'] == 'D' ? ' selected' : '', '>', $txt['paid_mod_span_days'], '</option>
+									<option value="W"', $context['sub']['span']['unit'] == 'W' ? ' selected' : '', '>', $txt['paid_mod_span_weeks'], '</option>
+									<option value="M"', $context['sub']['span']['unit'] == 'M' ? ' selected' : '', '>', $txt['paid_mod_span_months'], '</option>
+									<option value="Y"', $context['sub']['span']['unit'] == 'Y' ? ' selected' : '', '>', $txt['paid_mod_span_years'], '</option>
+								</select>
+							</dd>
+						</dl>
+					</fieldset>
+				</div>
+				<input type="radio" name="duration_type" id="duration_type_flexible" value="flexible"', !empty($context['sub']['duration']) && $context['sub']['duration'] == 'flexible' ? ' checked' : '', ' class="input_radio" onclick="toggleDuration(\'flexible\');">
+				<strong><label for="duration_type_flexible">', $txt['paid_mod_flexible_price'], '</label></strong>
+				<br>
+				<div id="flexible_area" ', !empty($context['sub']['duration']) && $context['sub']['duration'] == 'flexible' ? '' : 'style="display: none;"', '>
+					<fieldset>';
 
 	//!! Removed until implemented
 	if (!empty($sdflsdhglsdjgs))
 		echo '
-							<dl class="settings">
-								<dt>
-									<label for="allow_partial_check">', $txt['paid_mod_allow_partial'], '</label>:<br /><span class="smalltext">', $txt['paid_mod_allow_partial_desc'], '</span>
-								</dt>
-								<dd>
-									<input type="checkbox" name="allow_partial" id="allow_partial_check"', empty($context['sub']['allow_partial']) ? '' : ' checked="checked"', ' class="input_check" />
-								</dd>
-							</dl>';
-
-	echo '
-							<div class="information">
-								<strong>', $txt['paid_mod_price_breakdown'], '</strong><br />
-								', $txt['paid_mod_price_breakdown_desc'], '
-							</div>
-							<dl class="settings">
-								<dt>
-									<strong>', $txt['paid_duration'], '</strong>
-								</dt>
-								<dd>
-									<strong>', $txt['paid_cost'], ' (', preg_replace('~%[df\.\d]+~', '', $modSettings['paid_currency_symbol']), ')</strong>
-								</dd>
-								<dt>
-									', $txt['paid_per_day'], ':
-								</dt>
-								<dd>
-									<input type="text" name="cost_day" value="', empty($context['sub']['cost']['day']) ? '0' : $context['sub']['cost']['day'], '" size="5" class="input_text" />
-								</dd>
-								<dt>
-									', $txt['paid_per_week'], ':
-								</dt>
-								<dd>
-									<input type="text" name="cost_week" value="', empty($context['sub']['cost']['week']) ? '0' : $context['sub']['cost']['week'], '" size="5" class="input_text" />
-								</dd>
-								<dt>
-									', $txt['paid_per_month'], ':
-								</dt>
-								<dd>
-									<input type="text" name="cost_month" value="', empty($context['sub']['cost']['month']) ? '0' : $context['sub']['cost']['month'], '" size="5" class="input_text" />
-								</dd>
-								<dt>
-									', $txt['paid_per_year'], ':
-								</dt>
-								<dd>
-									<input type="text" name="cost_year" value="', empty($context['sub']['cost']['year']) ? '0' : $context['sub']['cost']['year'], '" size="5" class="input_text" />
-								</dd>
-							</dl>
-						</fieldset>
-					</div>
-					<div class="righttext">
-						<input type="submit" name="save" value="', $txt['paid_settings_save'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					</div>
+						<dl class="settings">
+							<dt>
+								<label for="allow_partial_check">', $txt['paid_mod_allow_partial'], '</label>:<br><span class="smalltext">', $txt['paid_mod_allow_partial_desc'], '</span>
+							</dt>
+							<dd>
+								<input type="checkbox" name="allow_partial" id="allow_partial_check"', empty($context['sub']['allow_partial']) ? '' : ' checked', ' class="input_check">
+							</dd>
+						</dl>';
+
+	echo '
+						<div class="information">
+							<strong>', $txt['paid_mod_price_breakdown'], '</strong><br>
+							', $txt['paid_mod_price_breakdown_desc'], '
+						</div>
+						<dl class="settings">
+							<dt>
+								<strong>', $txt['paid_duration'], '</strong>
+							</dt>
+							<dd>
+								<strong>', $txt['paid_cost'], ' (', preg_replace('~%[df\.\d]+~', '', $modSettings['paid_currency_symbol']), ')</strong>
+							</dd>
+							<dt>
+								', $txt['paid_per_day'], ':
+							</dt>
+							<dd>
+								<input type="number" name="cost_day" value="', empty($context['sub']['cost']['day']) ? '0' : $context['sub']['cost']['day'], '" size="5" class="input_text">
+							</dd>
+							<dt>
+								', $txt['paid_per_week'], ':
+							</dt>
+							<dd>
+								<input type="number" name="cost_week" value="', empty($context['sub']['cost']['week']) ? '0' : $context['sub']['cost']['week'], '" size="5" class="input_text">
+							</dd>
+							<dt>
+								', $txt['paid_per_month'], ':
+							</dt>
+							<dd>
+								<input type="number" name="cost_month" value="', empty($context['sub']['cost']['month']) ? '0' : $context['sub']['cost']['month'], '" size="5" class="input_text">
+							</dd>
+							<dt>
+								', $txt['paid_per_year'], ':
+							</dt>
+							<dd>
+								<input type="number" name="cost_year" value="', empty($context['sub']['cost']['year']) ? '0' : $context['sub']['cost']['year'], '" size="5" class="input_text">
+							</dd>
+						</dl>
+					</fieldset>
 				</div>
-				<span class="botslice"><span></span></span>
+				<input type="submit" name="save" value="', $txt['paid_settings_save'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-pms_token_var'], '" value="', $context['admin-pms_token'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 
 }
 
 function template_delete_subscription()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
@@ -227,52 +203,26 @@
 				<h3 class="catbg">', $txt['paid_delete_subscription'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>', $txt['paid_mod_delete_warning'], '</p>
+				<p>', $txt['paid_mod_delete_warning'], '</p>
 
-					<input type="submit" name="delete_confirm" value="', $txt['paid_delete_subscription'], '" class="button_submit" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</div>
-				<span class="botslice"><span></span></span>
+				<input type="submit" name="delete_confirm" value="', $txt['paid_delete_subscription'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-pmsd_token_var'], '" value="', $context['admin-pmsd_token'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 
 }
 
 // Add or edit an existing subscriber.
 function template_modify_user_subscription()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt;
 
 	// Some quickly stolen javascript from Post, could do with being more efficient :)
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 			var monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
-
-			function generateDays(offset)
-			{
-				var days = 0, selected = 0;
-				var dayElement = document.getElementById("day" + offset), yearElement = document.getElementById("year" + offset), monthElement = document.getElementById("month" + offset);
-
-				monthLength[1] = 28;
-				if (yearElement.options[yearElement.selectedIndex].value % 4 == 0)
-					monthLength[1] = 29;
-
-				selected = dayElement.selectedIndex;
-				while (dayElement.options.length)
-					dayElement.options[0] = null;
-
-				days = monthLength[monthElement.value - 1];
-
-				for (i = 1; i <= days; i++)
-					dayElement.options[dayElement.length] = new Option(i, i);
-
-				if (selected < days)
-					dayElement.selectedIndex = selected;
-			}
 		// ]]></script>';
 
 	echo '
@@ -285,113 +235,108 @@
 				</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">';
+				<dl class="settings">';
 
 	// Do we need a username?
 	if ($context['action_type'] == 'add')
 		echo '
 
-						<dt>
-							<strong>', $txt['paid_username'], ':</strong><br />
-							<span class="smalltext">', $txt['one_username'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="name" id="name_control" value="', $context['sub']['username'], '" size="30" class="input_text" />
-						</dd>';
-
-	echo '
-						<dt>
-							<strong>', $txt['paid_status'], ':</strong>
-						</dt>
-						<dd>
-							<select name="status">
-								<option value="0" ', $context['sub']['status'] == 0 ? 'selected="selected"' : '', '>', $txt['paid_finished'], '</option>
-								<option value="1" ', $context['sub']['status'] == 1 ? 'selected="selected"' : '', '>', $txt['paid_active'], '</option>
-							</select>
-						</dd>
-					</dl>
-					<fieldset>
-						<legend>', $txt['start_date_and_time'], '</legend>
-						<select name="year" id="year" onchange="generateDays(\'\');">';
+					<dt>
+						<strong>', $txt['paid_username'], ':</strong><br>
+						<span class="smalltext">', $txt['one_username'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="name" id="name_control" value="', $context['sub']['username'], '" size="30" class="input_text">
+					</dd>';
+
+	echo '
+					<dt>
+						<strong>', $txt['paid_status'], ':</strong>
+					</dt>
+					<dd>
+						<select name="status">
+							<option value="0"', $context['sub']['status'] == 0 ? ' selected' : '', '>', $txt['paid_finished'], '</option>
+							<option value="1"', $context['sub']['status'] == 1 ? ' selected' : '', '>', $txt['paid_active'], '</option>
+						</select>
+					</dd>
+				</dl>
+				<fieldset>
+					<legend>', $txt['start_date_and_time'], '</legend>
+					<select name="year" id="year" onchange="generateDays();">';
 
 	// Show a list of all the years we allow...
 	for ($year = 2005; $year <= 2030; $year++)
 		echo '
-							<option value="', $year, '"', $year == $context['sub']['start']['year'] ? ' selected="selected"' : '', '>', $year, '</option>';
+						<option value="', $year, '"', $year == $context['sub']['start']['year'] ? ' selected' : '', '>', $year, '</option>';
 
 	echo '
-						</select>&nbsp;
-						', (isset($txt['calendar_month']) ? $txt['calendar_month'] : $txt['calendar_month']), '&nbsp;
-						<select name="month" id="month" onchange="generateDays(\'\');">';
+					</select>&nbsp;
+					', (isset($txt['calendar_month']) ? $txt['calendar_month'] : $txt['calendar_month']), '&nbsp;
+					<select name="month" id="month" onchange="generateDays();">';
 
 	// There are 12 months per year - ensure that they all get listed.
 	for ($month = 1; $month <= 12; $month++)
 		echo '
-							<option value="', $month, '"', $month == $context['sub']['start']['month'] ? ' selected="selected"' : '', '>', $txt['months'][$month], '</option>';
+						<option value="', $month, '"', $month == $context['sub']['start']['month'] ? ' selected' : '', '>', $txt['months'][$month], '</option>';
 
 	echo '
-						</select>&nbsp;
-						', (isset($txt['calendar_day']) ? $txt['calendar_day'] : $txt['calendar_day']), '&nbsp;
-						<select name="day" id="day">';
+					</select>&nbsp;
+					', (isset($txt['calendar_day']) ? $txt['calendar_day'] : $txt['calendar_day']), '&nbsp;
+					<select name="day" id="day">';
 
 	// This prints out all the days in the current month - this changes dynamically as we switch months.
 	for ($day = 1; $day <= $context['sub']['start']['last_day']; $day++)
 		echo '
-							<option value="', $day, '"', $day == $context['sub']['start']['day'] ? ' selected="selected"' : '', '>', $day, '</option>';
+						<option value="', $day, '"', $day == $context['sub']['start']['day'] ? ' selected' : '', '>', $day, '</option>';
 
 	echo '
-						</select>
-						', $txt['hour'], ': <input type="text" name="hour" value="', $context['sub']['start']['hour'], '" size="2" class="input_text" />
-						', $txt['minute'], ': <input type="text" name="minute" value="', $context['sub']['start']['min'], '" size="2" class="input_text" />
-					</fieldset>
-					<fieldset>
-						<legend>', $txt['end_date_and_time'], '</legend>
-						<select name="yearend" id="yearend" onchange="generateDays(\'end\');">';
+					</select>
+					', $txt['hour'], ': <input type="text" name="hour" value="', $context['sub']['start']['hour'], '" size="2" class="input_text">
+					', $txt['minute'], ': <input type="text" name="minute" value="', $context['sub']['start']['min'], '" size="2" class="input_text">
+				</fieldset>
+				<fieldset>
+					<legend>', $txt['end_date_and_time'], '</legend>
+					<select name="yearend" id="yearend" onchange="generateDays(\'end\');">';
 
 	// Show a list of all the years we allow...
 	for ($year = 2005; $year <= 2030; $year++)
 		echo '
-							<option value="', $year, '"', $year == $context['sub']['end']['year'] ? ' selected="selected"' : '', '>', $year, '</option>';
+						<option value="', $year, '"', $year == $context['sub']['end']['year'] ? ' selected' : '', '>', $year, '</option>';
 
 	echo '
-						</select>&nbsp;
-						', (isset($txt['calendar_month']) ? $txt['calendar_month'] : $txt['calendar_month']), '&nbsp;
-						<select name="monthend" id="monthend" onchange="generateDays(\'end\');">';
+					</select>&nbsp;
+					', (isset($txt['calendar_month']) ? $txt['calendar_month'] : $txt['calendar_month']), '&nbsp;
+					<select name="monthend" id="monthend" onchange="generateDays(\'end\');">';
 
 	// There are 12 months per year - ensure that they all get listed.
 	for ($month = 1; $month <= 12; $month++)
 		echo '
-							<option value="', $month, '"', $month == $context['sub']['end']['month'] ? ' selected="selected"' : '', '>', $txt['months'][$month], '</option>';
+						<option value="', $month, '"', $month == $context['sub']['end']['month'] ? ' selected' : '', '>', $txt['months'][$month], '</option>';
 
 	echo '
-						</select>&nbsp;
-						', (isset($txt['calendar_day']) ? $txt['calendar_day'] : $txt['calendar_day']), '&nbsp;
-						<select name="dayend" id="dayend">';
+					</select>&nbsp;
+					', (isset($txt['calendar_day']) ? $txt['calendar_day'] : $txt['calendar_day']), '&nbsp;
+					<select name="dayend" id="dayend">';
 
 	// This prints out all the days in the current month - this changes dynamically as we switch months.
 	for ($day = 1; $day <= $context['sub']['end']['last_day']; $day++)
 		echo '
-							<option value="', $day, '"', $day == $context['sub']['end']['day'] ? ' selected="selected"' : '', '>', $day, '</option>';
+						<option value="', $day, '"', $day == $context['sub']['end']['day'] ? ' selected' : '', '>', $day, '</option>';
 
 	echo '
-						</select>
-						', $txt['hour'], ': <input type="text" name="hourend" value="', $context['sub']['end']['hour'], '" size="2" class="input_text" />
-						', $txt['minute'], ': <input type="text" name="minuteend" value="', $context['sub']['end']['min'], '" size="2" class="input_text" />
-					</fieldset>
-					<input type="submit" name="save_sub" value="', $txt['paid_settings_save'], '" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
+					</select>
+					', $txt['hour'], ': <input type="number" name="hourend" value="', $context['sub']['end']['hour'], '" size="2" class="input_text">
+					', $txt['minute'], ': <input type="number" name="minuteend" value="', $context['sub']['end']['min'], '" size="2" class="input_text">
+				</fieldset>
+				<input type="submit" name="save_sub" value="', $txt['paid_settings_save'], '" class="button_submit">
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 		</form>
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 		var oAddMemberSuggest = new smc_AutoSuggest({
 			sSelf: \'oAddMemberSuggest\',
-			sSessionId: \'', $context['session_id'], '\',
-			sSessionVar: \'', $context['session_var'], '\',
+			sSessionId: smf_session_id,
+			sSessionVar: smf_session_var,
 			sSuggestId: \'name_subscriber\',
 			sControlId: \'name_control\',
 			sSearchType: \'member\',
@@ -413,30 +358,29 @@
 			<h3 class="catbg">', $txt['pending_payments_value'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<ul class="pending_payments">';
+			<ul class="reset">';
 
 		foreach ($context['pending_payments'] as $id => $payment)
 		{
 			echo '
-					<li class="reset">
-						', $payment['desc'], '
-						<span class="floatleft"><a href="', $scripturl, '?action=admin;area=paidsubscribe;sa=modifyuser;lid=', $context['log_id'], ';pending=', $id, ';accept">', $txt['pending_payments_accept'], '</a></span>
-						<span class="floatright"><a href="', $scripturl, '?action=admin;area=paidsubscribe;sa=modifyuser;lid=', $context['log_id'], ';pending=', $id, ';remove">', $txt['pending_payments_remove'], '</a></span>
-					</li>';
+				<li>
+					', $payment['desc'], '
+					<span class="floatleft">
+						<a href="', $scripturl, '?action=admin;area=paidsubscribe;sa=modifyuser;lid=', $context['log_id'], ';pending=', $id, ';accept">', $txt['pending_payments_accept'], '</a>
+					</span>
+					<span class="floatright">
+						<a href="', $scripturl, '?action=admin;area=paidsubscribe;sa=modifyuser;lid=', $context['log_id'], ';pending=', $id, ';remove">', $txt['pending_payments_remove'], '</a>
+					</span>
+				</li>';
 		}
 
 		echo '
 				</ul>
-			</div>
-			<span class="botslice"><span></span></span>
 		</div>';
 	}
 
 	echo '
-		</div>
-	<br class="clear" />';
+		</div>';
 }
 
 // Template for a user to edit/pick their subscriptions.
@@ -466,10 +410,8 @@
 			</div>';
 
 		// Print out all the subscriptions.
-		$alternate = false;
 		foreach ($context['subscriptions'] as $id => $subscription)
 		{
-			$alternate = !$alternate;
 
 			// Ignore the inactive ones...
 			if (empty($subscription['active']))
@@ -479,11 +421,9 @@
 			<div class="cat_bar">
 				<h3 class="catbg">', $subscription['name'], '</h3>
 			</div>
-			<div class="windowbg', $alternate ? '' : '2', '">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p><strong>', $subscription['name'], '</strong></p>
-					<p class="smalltext">', $subscription['desc'], '</p>';
+			<div class="windowbg">
+				<p><strong>', $subscription['name'], '</strong></p>
+				<p class="smalltext">', $subscription['desc'], '</p>';
 
 			if (!$subscription['flexible'])
 				echo '
@@ -512,36 +452,34 @@
 					', sprintf($modSettings['paid_currency_symbol'], $subscription['costs']['fixed']);
 
 				echo '
-					<br />
-					<input type="submit" name="sub_id[', $subscription['id'], ']" value="', $txt['paid_order'], '" class="button_submit" />';
+					<hr class="hrcolor">
+					<input type="submit" name="sub_id[', $subscription['id'], ']" value="', $txt['paid_order'], '" class="button_submit">';
 			}
 			else
 				echo '
 					<a href="', $scripturl, '?action=admin;area=paidsubscribe;sa=modifyuser;sid=', $subscription['id'], ';uid=', $context['member']['id'], (empty($context['current'][$subscription['id']]) ? '' : ';lid=' . $context['current'][$subscription['id']]['id']), '">', empty($context['current'][$subscription['id']]) ? $txt['paid_admin_add'] : $txt['paid_edit_subscription'], '</a>';
 
 			echo '
-				</div>
-				<span class="botslice"><span></span></span>
 			</div>';
 		}
 	}
 
 	echo '
 		</form>
-		<br />
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['paid_current'], '</h3>
+		<br class="clear"/>
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['paid_current'], '</h3>
 		</div>
 		<div class="information">
 			', $txt['paid_current_desc'], '
 		</div>
-		<table width="100%" class="table_grid">
+		<table class="table_grid">
 			<thead>
-				<tr class="catbg">
-					<th class="first_th" width="30%">', $txt['paid_name'], '</th>
-					<th align="center">', $txt['paid_status'], '</th>
-					<th align="center">', $txt['start_date'], '</th>
-					<th class="last_th" align="center">', $txt['end_date'], '</th>
+				<tr class="title_bar">
+					<th style="width: 30%">', $txt['paid_name'], '</th>
+					<th>', $txt['paid_status'], '</th>
+					<th>', $txt['start_date'], '</th>
+					<th>', $txt['end_date'], '</th>
 				</tr>
 			</thead>
 			<tbody>';
@@ -549,19 +487,17 @@
 	if (empty($context['current']))
 		echo '
 				<tr class="windowbg">
-					<td align="center" colspan="4">
+					<td colspan="4">
 						', $txt['paid_none_yet'], '
 					</td>
 				</tr>';
 
-	$alternate = false;
 	foreach ($context['current'] as $sub)
 	{
-		$alternate = !$alternate;
 
 		if (!$sub['hide'])
 			echo '
-				<tr class="windowbg', $alternate ? '' : '2', '">
+				<tr class="windowbg">
 					<td>
 						', (allowedTo('admin_forum') ? '<a href="' . $scripturl . '?action=admin;area=paidsubscribe;sa=modifyuser;lid=' . $sub['id'] . '">' . $sub['name'] . '</a>' : $sub['name']), '
 					</td><td>
@@ -576,14 +512,13 @@
 	echo '
 			</tbody>
 		</table>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // The "choose payment" dialog.
 function template_choose_payment()
 {
-	global $context, $txt, $modSettings, $scripturl;
+	global $context, $txt;
 
 	echo '
 	<div id="paid_subscription">
@@ -594,24 +529,20 @@
 			', $txt['paid_confirm_desc'], '
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl class="settings">
-					<dt>
-						<strong>', $txt['subscription'], ':</strong>
-					</dt>
-					<dd>
-						', $context['sub']['name'], '
-					</dd>
-					<dt>
-						<strong>', $txt['paid_cost'], ':</strong>
-					</dt>
-					<dd>
-						', $context['cost'], '
-					</dd>
-				</dl>
-			</div>
-			<span class="botslice"><span></span></span>
+			<dl class="settings">
+				<dt>
+					<strong>', $txt['subscription'], ':</strong>
+				</dt>
+				<dd>
+					', $context['sub']['name'], '
+				</dd>
+				<dt>
+					<strong>', $txt['paid_cost'], ':</strong>
+				</dt>
+				<dd>
+					', $context['cost'], '
+				</dd>
+			</dl>
 		</div>';
 
 	// Do all the gateway options.
@@ -622,55 +553,46 @@
 			<h3 class="catbg">', $gateway['title'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				', $gateway['desc'], '<br />
-					<form action="', $gateway['form'], '" method="post">';
+			', $gateway['desc'], '<br>
+				<form action="', $gateway['form'], '" method="post">';
 
 		if (!empty($gateway['javascript']))
 			echo '
-						<script type="text/javascript"><!-- // --><![CDATA[
-							', $gateway['javascript'], '
-						// ]]></script>';
+					<script><!-- // --><![CDATA[
+						', $gateway['javascript'], '
+					// ]]></script>';
 
 		foreach ($gateway['hidden'] as $name => $value)
 			echo '
-						<input type="hidden" id="', $gateway['id'], '_', $name, '" name="', $name, '" value="', $value, '" />';
+					<input type="hidden" id="', $gateway['id'], '_', $name, '" name="', $name, '" value="', $value, '">';
 
 		echo '
-						<br /><input type="submit" value="', $gateway['submit'], '" class="button_submit" />
-					</form>
-			</div>
-			<span class="botslice"><span></span></span>
+					<br><input type="submit" value="', $gateway['submit'], '" class="button_submit">
+				</form>
 		</div>';
 	}
 
 	echo '
 	</div>
-	<br class="clear" />';
+	<br class="clear">';
 }
 
 // The "thank you" bit...
 function template_paid_done()
 {
-	global $context, $txt, $modSettings, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="paid_subscription">
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['paid_done'], '</h3>
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['paid_done'], '</h3>
 		</div>
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $txt['paid_done_desc'], '</p>
-				<br />
-				<a href="', $scripturl, '?action=profile;u=', $context['member']['id'], ';area=subscriptions">', $txt['paid_sub_return'], '</a>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p>', $txt['paid_done_desc'], '</p>
+			<br>
+			<a href="', $scripturl, '?action=profile;u=', $context['member']['id'], ';area=subscriptions">', $txt['paid_sub_return'], '</a>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManagePermissions.template.php b/Themes/default/ManagePermissions.template.php
--- a/Themes/default/ManagePermissions.template.php	2014-09-17 14:47:11.000000000 -0700
+++ b/Themes/default/ManagePermissions.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -1,18 +1,19 @@
 <?php
+
 /**
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0.9
+ * @version 2.1 Beta 1
  */
 
 function template_permission_index()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
 	// Not allowed to edit?
 	if (!$context['can_modify'])
@@ -22,74 +23,78 @@
 	</div>';
 
 	echo '
-	<div id="admincenter">
+	<div id="admin_form_wrapper">
 		<form action="', $scripturl, '?action=admin;area=permissions;sa=quick" method="post" accept-charset="', $context['character_set'], '" name="permissionForm" id="permissionForm">';
 
 		if (!empty($context['profile']))
 			echo '
-			<div class="title_bar">
-				<h3 class="titlebg">', $txt['permissions_for_profile'], ': &quot;', $context['profile']['name'], '&quot;</h3>
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['permissions_for_profile'], ': &quot;', $context['profile']['name'], '&quot;</h3>
+			</div>';
+		else
+			echo '
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['permissions_title'], '</h3>
 			</div>';
 
 		echo '
-			<table width="100%" class="table_grid">
+			<table class="table_grid">
 				<thead>
-					<tr class="catbg">
-						<th class="first_th">', $txt['membergroups_name'], '</th>
-						<th width="10%" align="center" valign="middle">', $txt['membergroups_members_top'], '</th>';
+					<tr class="title_bar">
+						<th>', $txt['membergroups_name'], '</th>
+						<th width="10%" style="text-align:center">', $txt['membergroups_members_top'], '</th>';
 
 			if (empty($modSettings['permission_enable_deny']))
 				echo '
-						<th width="16%" align="center">', $txt['membergroups_permissions'], '</th>';
+						<th width="16%" style="text-align:center">', $txt['membergroups_permissions'], '</th>';
 			else
 				echo '
-						<th width="8%" align="center">', $txt['permissions_allowed'], '</th>
-						<th width="8%" align="center">', $txt['permissions_denied'], '</th>';
+						<th width="8%" style="text-align:center">', $txt['permissions_allowed'], '</th>
+						<th width="8%" style="text-align:center">', $txt['permissions_denied'], '</th>';
 
 			echo '
-						<th width="10%" align="center" valign="middle">', $context['can_modify'] ? $txt['permissions_modify'] : $txt['permissions_view'], '</th>
-						<th class="last_th" width="4%" align="center" valign="middle">
-							', $context['can_modify'] ? '<input type="checkbox" class="input_check" onclick="invertAll(this, this.form, \'group\');" />' : '', '
+						<th width="10%" style="text-align:center">', $context['can_modify'] ? $txt['permissions_modify'] : $txt['permissions_view'], '</th>
+						<th width="4%" style="text-align: center">
+							', $context['can_modify'] ? '<input type="checkbox" class="input_check" onclick="invertAll(this, this.form, \'group\');">' : '', '
 						</th>
 					</tr>
 				</thead>
 				<tbody>';
 
-	$alternate = false;
 	foreach ($context['groups'] as $group)
 	{
-		$alternate = !$alternate;
 		echo '
-					<tr class="windowbg', $alternate ? '2' : '', '">
+					<tr class="windowbg">
 						<td>
-							', $group['name'], $group['id'] == -1 ? ' (<a href="' . $scripturl . '?action=helpadmin;help=membergroup_guests" onclick="return reqWin(this.href);">?</a>)' : ($group['id'] == 0 ? ' (<a href="' . $scripturl . '?action=helpadmin;help=membergroup_regular_members" onclick="return reqWin(this.href);">?</a>)' : ($group['id'] == 1 ? ' (<a href="' . $scripturl . '?action=helpadmin;help=membergroup_administrator" onclick="return reqWin(this.href);">?</a>)' : ($group['id'] == 3 ? ' (<a href="' . $scripturl . '?action=helpadmin;help=membergroup_moderator" onclick="return reqWin(this.href);">?</a>)' : '')));
+							', !empty($group['help']) ? ' <a class="help" href="' . $scripturl . '?action=helpadmin;help=' . $group['help'] . '" onclick="return reqOverlayDiv(this.href);"><span class="generic_icons help" title="'. $txt['help'].'"></span></a>' : '<img class="icon" src="' . $settings['images_url'] . '/blank.png" alt="' . $txt['help'] . '">', '&nbsp;<span>', $group['name'], '</span>';
 
 		if (!empty($group['children']))
 			echo '
-							<br /><span class="smalltext">', $txt['permissions_includes_inherited'], ': &quot;', implode('&quot;, &quot;', $group['children']), '&quot;</span>';
+							<br>
+							<span class="smalltext">', $txt['permissions_includes_inherited'], ': &quot;', implode('&quot;, &quot;', $group['children']), '&quot;</span>';
 
 		echo '
 						</td>
-						<td align="center">', $group['can_search'] ? $group['link'] : $group['num_members'], '</td>';
+						<td>', $group['can_search'] ? $group['link'] : $group['num_members'], '</td>';
 
 		if (empty($modSettings['permission_enable_deny']))
 			echo '
-						<td width="16%" align="center">', $group['num_permissions']['allowed'], '</td>';
+						<td width="16%">', $group['num_permissions']['allowed'], '</td>';
 		else
 			echo '
-						<td width="8%" align="center"', $group['id'] == 1 ? ' style="font-style: italic;"' : '', '>', $group['num_permissions']['allowed'], '</td>
-						<td width="8%" align="center"', $group['id'] == 1 || $group['id'] == -1 ? ' style="font-style: italic;"' : (!empty($group['num_permissions']['denied']) ? ' style="color: red;"' : ''), '>', $group['num_permissions']['denied'], '</td>';
+						<td width="8%"', $group['id'] == 1 ? ' style="font-style: italic;"' : '', '>', $group['num_permissions']['allowed'], '</td>
+						<td width="8%"', $group['id'] == 1 || $group['id'] == -1 ? ' style="font-style: italic;"' : (!empty($group['num_permissions']['denied']) ? ' class="red"' : ''), '>', $group['num_permissions']['denied'], '</td>';
 
 		echo '
-						<td align="center">', $group['allow_modify'] ? '<a href="' . $scripturl . '?action=admin;area=permissions;sa=modify;group=' . $group['id'] . (empty($context['profile']) ? '' : ';pid=' . $context['profile']['id']) . '">' . ($context['can_modify'] ? $txt['permissions_modify'] : $txt['permissions_view']). '</a>' : '', '</td>
-						<td align="center">', $group['allow_modify'] && $context['can_modify'] ? '<input type="checkbox" name="group[]" value="' . $group['id'] . '" class="input_check" />' : '', '</td>
+						<td>', $group['allow_modify'] ? '<a href="' . $scripturl . '?action=admin;area=permissions;sa=modify;group=' . $group['id'] . (empty($context['profile']) ? '' : ';pid=' . $context['profile']['id']) . '">' . ($context['can_modify'] ? $txt['permissions_modify'] : $txt['permissions_view']). '</a>' : '', '</td>
+						<td>', $group['allow_modify'] && $context['can_modify'] ? '<input type="checkbox" name="group[]" value="' . $group['id'] . '" class="input_check">' : '', '</td>
 					</tr>';
 	}
 
 	echo '
 				</tbody>
 			</table>
-			<br />';
+			<br>';
 
 	// Advanced stuff...
 	if ($context['can_modify'])
@@ -97,58 +102,55 @@
 		echo '
 			<div class="cat_bar">
 				<h3 class="catbg">
-					<span class="ie6_header floatleft">
-						<img src="', $settings['images_url'], '/', empty($context['show_advanced_options']) ? 'selected' : 'sort_down', '.gif" id="permissions_panel_toggle" alt="*" /> ', $txt['permissions_advanced_options'], '
-					</span>
+					<span id="permissions_panel_toggle" class="', empty($context['show_advanced_options']) ? 'toggle_down' : 'toggle_up', ' floatright" style="display: none;"></span>
+					<a href="#" id="permissions_panel_link">', $txt['permissions_advanced_options'], '</a>
 				</h3>
 			</div>
-			<div id="permissions_panel_advanced" class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<fieldset>
-						<legend>', $txt['permissions_with_selection'], '</legend>
-						<dl class="settings admin_permissions">
-							<dt>
-								', $txt['permissions_apply_pre_defined'], ' <a href="', $scripturl, '?action=helpadmin;help=permissions_quickgroups" onclick="return reqWin(this.href);">(?)</a>:
-							</dt>
-							<dd>
-								<select name="predefined">
-									<option value="">(', $txt['permissions_select_pre_defined'], ')</option>
-									<option value="restrict">', $txt['permitgroups_restrict'], '</option>
-									<option value="standard">', $txt['permitgroups_standard'], '</option>
-									<option value="moderator">', $txt['permitgroups_moderator'], '</option>
-									<option value="maintenance">', $txt['permitgroups_maintenance'], '</option>
-								</select>
-							</dd>
-							<dt>
-								', $txt['permissions_like_group'], ':
-							</dt>
-							<dd>
-								<select name="copy_from">
-									<option value="empty">(', $txt['permissions_select_membergroup'], ')</option>';
+			<div id="permissions_panel_advanced" class="windowbg2">
+				<fieldset>
+					<legend>', $txt['permissions_with_selection'], '</legend>
+					<dl class="settings">
+						<dt>
+							<a class="help" href="', $scripturl, '?action=helpadmin;help=permissions_quickgroups" onclick="return reqOverlayDiv(this.href);"><span class="generic_icons help" title="', $txt['help'],'"></span></a>', $txt['permissions_apply_pre_defined'], ':
+						</dt>
+						<dd>
+							<select name="predefined">
+								<option value="">(', $txt['permissions_select_pre_defined'], ')</option>
+								<option value="restrict">', $txt['permitgroups_restrict'], '</option>
+								<option value="standard">', $txt['permitgroups_standard'], '</option>
+								<option value="moderator">', $txt['permitgroups_moderator'], '</option>
+								<option value="maintenance">', $txt['permitgroups_maintenance'], '</option>
+							</select>
+						</dd>
+						<dt>
+							', $txt['permissions_like_group'], ':
+						</dt>
+						<dd>
+							<select name="copy_from">
+								<option value="empty">(', $txt['permissions_select_membergroup'], ')</option>';
 		foreach ($context['groups'] as $group)
 		{
 			if ($group['id'] != 1)
 				echo '
-									<option value="', $group['id'], '">', $group['name'], '</option>';
+								<option value="', $group['id'], '">', $group['name'], '</option>';
 		}
 
 		echo '
-								</select>
-							</dd>
-							<dt>
-								<select name="add_remove">
-									<option value="add">', $txt['permissions_add'], '...</option>
-									<option value="clear">', $txt['permissions_remove'], '...</option>';
+							</select>
+						</dd>
+						<dt>
+							<select name="add_remove">
+								<option value="add">', $txt['permissions_add'], '...</option>
+								<option value="clear">', $txt['permissions_remove'], '...</option>';
 		if (!empty($modSettings['permission_enable_deny']))
 			echo '
-									<option value="deny">', $txt['permissions_deny'], '...</option>';
+								<option value="deny">', $txt['permissions_deny'], '...</option>';
 		echo '
-								</select>
-							</dt>
-							<dd style="overflow:auto;">
-								<select name="permissions">
-									<option value="">(', $txt['permissions_select_permission'], ')</option>';
+							</select>
+						</dt>
+						<dd style="overflow:auto;">
+							<select name="permissions">
+								<option value="">(', $txt['permissions_select_permission'], ')</option>';
 		foreach ($context['permissions'] as $permissionType)
 		{
 			if ($permissionType['id'] == 'membergroup' && !empty($context['profile']))
@@ -162,7 +164,7 @@
 						continue;
 
 					echo '
-									<option value="" disabled="disabled">[', $permissionGroup['name'], ']</option>';
+								<option value="" disabled>[', $permissionGroup['name'], ']</option>';
 					foreach ($permissionGroup['permissions'] as $perm)
 					{
 						if ($perm['hidden'])
@@ -170,30 +172,26 @@
 
 						if ($perm['has_own_any'])
 							echo '
-									<option value="', $permissionType['id'], '/', $perm['own']['id'], '">&nbsp;&nbsp;&nbsp;', $perm['name'], ' (', $perm['own']['name'], ')</option>
-									<option value="', $permissionType['id'], '/', $perm['any']['id'], '">&nbsp;&nbsp;&nbsp;', $perm['name'], ' (', $perm['any']['name'], ')</option>';
+								<option value="', $permissionType['id'], '/', $perm['own']['id'], '">&nbsp;&nbsp;&nbsp;', $perm['name'], ' (', $perm['own']['name'], ')</option>
+								<option value="', $permissionType['id'], '/', $perm['any']['id'], '">&nbsp;&nbsp;&nbsp;', $perm['name'], ' (', $perm['any']['name'], ')</option>';
 						else
 							echo '
-									<option value="', $permissionType['id'], '/', $perm['id'], '">&nbsp;&nbsp;&nbsp;', $perm['name'], '</option>';
+								<option value="', $permissionType['id'], '/', $perm['id'], '">&nbsp;&nbsp;&nbsp;', $perm['name'], '</option>';
 					}
 				}
 			}
 		}
 		echo '
-								</select>
-							</dd>
-						</dl>
-					</fieldset>
-					<div class="righttext">
-						<input type="submit" value="', $txt['permissions_set_permissions'], '" onclick="return checkSubmit();" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
+							</select>
+						</dd>
+					</dl>
+				</fieldset>
+				<input type="submit" value="', $txt['permissions_set_permissions'], '" onclick="return checkSubmit();" class="button_submit">
 			</div>';
 
 		// Javascript for the advanced stuff.
 		echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var oPermissionsPanelToggle = new smc_Toggle({
 			bToggleEnabled: true,
 			bCurrentlyCollapsed: ', empty($context['show_advanced_options']) ? 'true' : 'false', ',
@@ -203,17 +201,22 @@
 			aSwapImages: [
 				{
 					sId: \'permissions_panel_toggle\',
-					srcExpanded: smf_images_url + \'/sort_down.gif\',
-					altExpanded: ', JavaScriptEscape($txt['upshrink_description']), ',
-					srcCollapsed: smf_images_url + \'/selected.gif\',
-					altCollapsed: ', JavaScriptEscape($txt['upshrink_description']), '
+					altExpanded: ', JavaScriptEscape($txt['hide']), ',
+					altCollapsed: ', JavaScriptEscape($txt['show']), '
+				}
+			],
+			aSwapLinks: [
+				{
+					sId: \'permissions_panel_link\',
+					msgExpanded: ', JavaScriptEscape($txt['permissions_advanced_options']), ',
+					msgCollapsed: ', JavaScriptEscape($txt['permissions_advanced_options']), '
 				}
 			],
 			oThemeOptions: {
-				bUseThemeSettings: ', $context['user']['is_guest'] ? 'false' : 'true', ',
+				bUseThemeSettings: true,
 				sOptionName: \'admin_preferences\',
-				sSessionVar: ', JavaScriptEscape($context['session_var']), ',
-				sSessionId: ', JavaScriptEscape($context['session_id']), ',
+				sSessionVar: smf_session_var,
+				sSessionId: smf_session_id,
 				sThemeId: \'1\',
 				sAdditionalVars: \';admin_key=app\'
 			}
@@ -242,10 +245,11 @@
 
 		if (!empty($context['profile']))
 			echo '
-			<input type="hidden" name="pid" value="', $context['profile']['id'], '" />';
+			<input type="hidden" name="pid" value="', $context['profile']['id'], '">';
 
 		echo '
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />';
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['admin-mpq_token_var'], '" value="', $context['admin-mpq_token'], '">';
 	}
 	else
 		echo '
@@ -253,62 +257,53 @@
 
 	echo '
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_by_board()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt;
 
 	echo '
-	<form id="admincenter" action="', $scripturl, '?action=admin;area=permissions;sa=board" method="post" accept-charset="', $context['character_set'], '">
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['permissions_boards'], '</h3>
-		</div>
-		<div class="information">
-			', $txt['permissions_boards_desc'], '
-		</div>
-		<div class="title_bar">
-			<h3 id="board_permissions" class="titlebg flow_hidden">
-				<span class="perm_name floatleft">', $txt['board_name'], '</span>
-				<span class="perm_profile floatleft">', $txt['permission_profile'], '</span>
-			</h3>
-		</div>';
+	<div id="admincenter">
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=permissions;sa=board" method="post" accept-charset="', $context['character_set'], '">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['permissions_boards'], '</h3>
+			</div>
+			<div class="information">
+				', $txt['permissions_boards_desc'], '
+			</div>
 
-	if (!$context['edit_all'])
-		echo '
-		<div class="righttext">
-			<a href="', $scripturl, '?action=admin;area=permissions;sa=board;edit;', $context['session_var'], '=', $context['session_id'], '">[', $txt['permissions_board_all'], ']</a>
-		</div>';
+			<div class="cat_bar">
+				<h3 id="board_permissions" class="catbg flow_hidden">
+					<span class="perm_name floatleft">', $txt['board_name'], '</span>
+					<span class="perm_profile floatleft">', $txt['permission_profile'], '</span>';
+					echo '
+				</h3>
+			</div>
+			<div class="windowbg2">';
 
 	foreach ($context['categories'] as $category)
 	{
 		echo '
-		<div class="cat_bar">
-			<h3 class="catbg"><strong>', $category['name'], '</strong></h3>
-		</div>';
+			<div class="sub_bar">
+				<h3 class="subbg">', $category['name'], '</h3>
+			</div>';
 
 		if (!empty($category['boards']))
 			echo '
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
 				<ul class="perm_boards flow_hidden">';
 
-		$alternate = false;
-
 		foreach ($category['boards'] as $board)
 		{
-			$alternate = !$alternate;
 
 			echo '
-
-					<li class="flow_hidden' ,' windowbg', $alternate ? '' : '2','">
+					<li class="flow_hidden">
 						<span class="perm_board floatleft">
 							<a href="', $scripturl, '?action=admin;area=manageboards;sa=board;boardid=', $board['id'], ';rid=permissions;', $context['session_var'], '=', $context['session_id'], '">', str_repeat('-', $board['child_level']), ' ', $board['name'], '</a>
 						</span>
 						<span class="perm_boardprofile floatleft">';
+
 			if ($context['edit_all'])
 			{
 				echo '
@@ -316,14 +311,14 @@
 
 				foreach ($context['profiles'] as $id => $profile)
 					echo '
-								<option value="', $id, '" ', $id == $board['profile'] ? 'selected="selected"' : '', '>', $profile['name'], '</option>';
+								<option value="', $id, '"', $id == $board['profile'] ? ' selected' : '', '>', $profile['name'], '</option>';
 
 				echo '
 							</select>';
 			}
 			else
 				echo '
-							<a href="', $scripturl, '?action=admin;area=permissions;sa=index;pid=', $board['profile'], ';', $context['session_var'], '=', $context['session_id'], '"> [', $board['profile_name'], ']</a>';
+							<a href="', $scripturl, '?action=admin;area=permissions;sa=index;pid=', $board['profile'], ';', $context['session_var'], '=', $context['session_id'], '">', $board['profile_name'], '</a>';
 
 			echo '
 						</span>
@@ -332,60 +327,55 @@
 
 		if (!empty($category['boards']))
 			echo '
-				</ul>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
+				</ul>';
 	}
 
-	echo '
-		<div class="righttext">';
-
 	if ($context['edit_all'])
 		echo '
-			<input type="submit" name="save_changes" value="', $txt['save'], '" class="button_submit" />';
+			<input type="submit" name="save_changes" value="', $txt['save'], '" class="button_submit">';
 	else
 		echo '
-			<a href="', $scripturl, '?action=admin;area=permissions;sa=board;edit;', $context['session_var'], '=', $context['session_id'], '">[', $txt['permissions_board_all'], ']</a>';
+			<a class="button_link" href="', $scripturl, '?action=admin;area=permissions;sa=board;edit;', $context['session_var'], '=', $context['session_id'], '">', $txt['permissions_board_all'], '</a>';
 
 	echo '
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</div>
-	</form>
-	<br class="clear" />';
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['admin-mpb_token_var'], '" value="', $context['admin-mpb_token'], '">
+			</div>
+		</form>
+	</div>';
 }
 
 // Edit permission profiles (predefined).
 function template_edit_profiles()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt;
 
 	echo '
-	<div id="admincenter">
+	<div id="admin_form_wrapper">
 		<form action="', $scripturl, '?action=admin;area=permissions;sa=profiles" method="post" accept-charset="', $context['character_set'], '">
-			<div class="title_bar">
-				<h3 class="titlebg">', $txt['permissions_profile_edit'], '</h3>
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['permissions_profile_edit'], '</h3>
 			</div>
 
-			<table width="100%" class="table_grid">
+			<table class="table_grid">
 				<thead>
-					<tr class="catbg">
-						<th class="first_th">', $txt['permissions_profile_name'], '</th>
+					<tr class="title_bar">
+						<th>', $txt['permissions_profile_name'], '</th>
 						<th>', $txt['permissions_profile_used_by'], '</th>
-						<th class="last_th" width="5%">', $txt['delete'], '</th>
+						<th', !empty($context['show_rename_boxes']) ? ' style="display:none"' : '', ' width="5%">', $txt['delete'], '</th>
 					</tr>
 				</thead>
 				<tbody>';
-	$alternate = false;
+
 	foreach ($context['profiles'] as $profile)
 	{
 		echo '
-					<tr class="', $alternate ? 'windowbg' : 'windowbg2', '">
+					<tr class="windowbg">
 						<td>';
 
 		if (!empty($context['show_rename_boxes']) && $profile['can_edit'])
 			echo '
-							<input type="text" name="rename_profile[', $profile['id'], ']" value="', $profile['name'], '" class="input_text" />';
+							<input type="text" name="rename_profile[', $profile['id'], ']" value="', $profile['name'], '" class="input_text">';
 		else
 			echo '
 							<a href="', $scripturl, '?action=admin;area=permissions;sa=index;pid=', $profile['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $profile['name'], '</a>';
@@ -395,71 +385,65 @@
 						<td>
 							', !empty($profile['boards_text']) ? $profile['boards_text'] : $txt['permissions_profile_used_by_none'], '
 						</td>
-						<td align="center">
-							<input type="checkbox" name="delete_profile[]" value="', $profile['id'], '" ', $profile['can_delete'] ? '' : 'disabled="disabled"', ' class="input_check" />
+						<td', !empty($context['show_rename_boxes']) ? ' style="display:none"' : '', '>
+							<input type="checkbox" name="delete_profile[]" value="', $profile['id'], '" ', $profile['can_delete'] ? '' : 'disabled', ' class="input_check">
 						</td>
 					</tr>';
-		$alternate = !$alternate;
 	}
 
 	echo '
 				</tbody>
 			</table>
-			<div class="righttext padding">
-				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />';
+			<div class="flow_auto righttext padding">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-mpp_token_var'], '" value="', $context['admin-mpp_token'], '">';
 
 	if ($context['can_edit_something'])
 		echo '
-				<input type="submit" name="rename" value="', empty($context['show_rename_boxes']) ? $txt['permissions_profile_rename'] : $txt['permissions_commit'], '" class="button_submit" />';
+				<input type="submit" name="rename" value="', empty($context['show_rename_boxes']) ? $txt['permissions_profile_rename'] : $txt['permissions_commit'], '" class="button_submit">';
 
 	echo '
-				<input type="submit" name="delete" value="', $txt['quickmod_delete_selected'], '" class="button_submit" />
+				<input type="submit" name="delete" value="', $txt['quickmod_delete_selected'], '" class="button_submit" ', !empty($context['show_rename_boxes']) ? ' style="display:none"' : '', '/>
 			</div>
 		</form>
-		<br />
+		<br>
 		<form action="', $scripturl, '?action=admin;area=permissions;sa=profiles" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['permissions_profile_new'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<strong>', $txt['permissions_profile_name'], ':</strong>
-						</dt>
-						<dd>
-							<input type="text" name="profile_name" value="" class="input_text" />
-						</dd>
-						<dt>
-							<strong>', $txt['permissions_profile_copy_from'], ':</strong>
-						</dt>
-						<dd>
-							<select name="copy_from">';
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<strong>', $txt['permissions_profile_name'], ':</strong>
+					</dt>
+					<dd>
+						<input type="text" name="profile_name" value="" class="input_text">
+					</dd>
+					<dt>
+						<strong>', $txt['permissions_profile_copy_from'], ':</strong>
+					</dt>
+					<dd>
+						<select name="copy_from">';
 
 	foreach ($context['profiles'] as $id => $profile)
 		echo '
-								<option value="', $id, '">', $profile['name'], '</option>';
+							<option value="', $id, '">', $profile['name'], '</option>';
 
 	echo '
-							</select>
-						</dd>
-					</dl>
-					<div class="righttext">
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="submit" name="create" value="', $txt['permissions_profile_new_create'], '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
+						</select>
+					</dd>
+				</dl>
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-mpp_token_var'], '" value="', $context['admin-mpp_token'], '">
+				<input type="submit" name="create" value="', $txt['permissions_profile_new_create'], '" class="button_submit">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_modify_group()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	// Cannot be edited?
 	if (!$context['profile']['can_modify'])
@@ -472,7 +456,7 @@
 	else
 	{
 		echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			window.smf_usedDeny = false;
 
 			function warnAboutDeny()
@@ -487,7 +471,7 @@
 
 	echo '
 	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=permissions;sa=modify2;group=', $context['group']['id'], ';pid=', $context['profile']['id'], '" method="post" accept-charset="', $context['character_set'], '" name="permissionForm" id="permissionForm" onsubmit="return warnAboutDeny();">';
+		<form id="permissions" action="', $scripturl, '?action=admin;area=permissions;sa=modify2;group=', $context['group']['id'], ';pid=', $context['profile']['id'], '" method="post" accept-charset="', $context['character_set'], '" name="permissionForm" onsubmit="return warnAboutDeny();">';
 
 	if (!empty($modSettings['permission_enable_deny']) && $context['group']['id'] != -1)
 		echo '
@@ -506,363 +490,55 @@
 				', $context['permission_type'] == 'membergroup' ? $txt['permissions_general'] : $txt['permissions_board'], ' - &quot;', $context['group']['name'], '&quot;';
 	echo '
 				</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					', $txt['permissions_change_view'], ': ', ($context['view_type'] == 'simple' ? '<img src="' . $settings['images_url'] . '/selected.gif" alt="*" />' : ''), '<a href="', $scripturl, '?action=admin;area=permissions;sa=modify;group=', $context['group']['id'], ($context['permission_type'] == 'board' ? ';pid=' . $context['profile']['id'] : ''), ';view=simple">', $txt['permissions_view_simple'], '</a> |
-					', ($context['view_type'] == 'classic' ? '<img src="' . $settings['images_url'] . '/selected.gif" alt="*" />' : ''), '<a href="', $scripturl, '?action=admin;area=permissions;sa=modify;group=', $context['group']['id'], ($context['permission_type'] == 'board' ? ';pid=' . $context['profile']['id'] : ''), ';view=classic">', $txt['permissions_view_classic'], '</a>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<div class="flow_hidden">';
+			</div>';
 
 	// Draw out the main bits.
-	if ($context['view_type'] == 'simple')
-		template_modify_group_simple($context['permission_type']);
-	else
-		template_modify_group_classic($context['permission_type']);
-
-	echo '
-			</div>';
+	template_modify_group_display($context['permission_type']);
 
 	// If this is general permissions also show the default profile.
 	if ($context['permission_type'] == 'membergroup')
 	{
 		echo '
-			<br />
+			<br>
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['permissions_board'], '</h3>
 			</div>
 			<div class="information">
 				', $txt['permissions_board_desc'], '
-			</div>
-			<div class="flow_hidden">';
-
-		if ($context['view_type'] == 'simple')
-			template_modify_group_simple('board');
-		else
-			template_modify_group_classic('board');
-
-		echo '
 			</div>';
+
+		template_modify_group_display('board');
 	}
 
 	if ($context['profile']['can_modify'])
 		echo '
-			<div class="righttext padding">
-				<input type="submit" value="', $txt['permissions_commit'], '" class="button_submit" />
+			<div class="padding">
+				<input type="submit" value="', $txt['permissions_commit'], '" class="button_submit">
 			</div>';
 
-	echo '
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
-	</div>
-	<br class="clear" />';
-
-}
-
-// A javascript enabled clean permissions view.
-function template_modify_group_simple($type)
-{
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
-
-	// Simple only has one column so we only need bother ourself with that one.
-	$permission_data = &$context['permissions'][$type]['columns'][0];
-
-	// Short cut for disabling fields we can't change.
-	$disable_field = $context['profile']['can_modify'] ? '' : 'disabled="disabled" ';
-
-	echo '
-			<table width="100%" class="table_grid">
-				<thead>
-					<tr class="catbg">
-						<th colspan="2" width="100%" align="left" class="first_th"></th>';
-				if (empty($modSettings['permission_enable_deny']) || $context['group']['id'] == -1)
-					echo '
-						<th colspan="3" width="9" class="last_th">&nbsp;</th>';
-				else
-					echo '
-						<th>', $txt['permissions_option_on'], '</th>
-						<th>', $txt['permissions_option_off'], '</th>
-						<th class="last_th">', $txt['permissions_option_deny'], '</th>';
-					echo '
-					</tr>
-				</thead>
-				<tbody>';
-
-	foreach ($permission_data as $id_group => $permissionGroup)
-	{
-		if (empty($permissionGroup['permissions']))
-			continue;
-
-		// Are we likely to have something in this group to display or is it all hidden?
-		$has_display_content = false;
-		if (!$permissionGroup['hidden'])
-		{
-			// Before we go any further check we are going to have some data to print otherwise we just have a silly heading.
-			foreach ($permissionGroup['permissions'] as $permission)
-				if (!$permission['hidden'])
-					$has_display_content = true;
-
-			if ($has_display_content)
-			{
-				echo '
-					<tr class="windowbg">
-						<td colspan="2" width="100%" align="left">
-							<a href="#" onclick="return toggleBreakdown(\'', $id_group, '\');">
-								<img src="', $settings['images_url'], '/sort_down.gif" id="group_toggle_img_', $id_group, '" alt="*" />&nbsp;<strong>', $permissionGroup['name'], '</strong>
-							</a>
-						</td>';
-				if (empty($modSettings['permission_enable_deny']) || $context['group']['id'] == -1)
-					echo '
-						<td colspan="3" width="10">
-							<div id="group_select_div_', $id_group, '">
-								<input type="checkbox" id="group_select_', $id_group, '" name="group_select_', $id_group, '" class="input_check" onclick="determineGroupState(\'', $id_group, '\', this.checked ? \'on\' : \'off\');" style="display: none;" ', $disable_field, '/>
-							</div>
-						</td>';
-				else
-					echo '
-						<td align="center">
-							<div id="group_select_div_on_', $id_group, '">
-								<input type="radio" id="group_select_on_', $id_group, '" name="group_select_', $id_group, '" value="on" onclick="determineGroupState(\'', $id_group, '\', \'on\');" style="display: none;" ', $disable_field, ' class="input_radio" />
-							</div>
-						</td>
-						<td align="center">
-							<div id="group_select_div_off_', $id_group, '">
-								<input type="radio" id="group_select_off_', $id_group, '" name="group_select_', $id_group, '" value="off" onclick="determineGroupState(\'', $id_group, '\', \'off\');" style="display: none;" ', $disable_field, ' class="input_radio" />
-							</div>
-						</td>
-						<td align="center">
-							<div id="group_select_div_deny_', $id_group, '">
-								<input type="radio" id="group_select_deny_', $id_group, '" name="group_select_', $id_group, '" value="deny" onclick="determineGroupState(\'', $id_group, '\', \'deny\');" style="display: none;" ', $disable_field, ' class="input_radio" />
-							</div>
-						</td>';
-					echo '
-					</tr>';
-			}
-		}
-
-		$alternate = false;
-		foreach ($permissionGroup['permissions'] as $permission)
-		{
-			// If it's hidden keep the last value.
-			if ($permission['hidden'] || $permissionGroup['hidden'])
-			{
-				echo '
-					<tr style="display: none;">
-						<td>
-							<input type="hidden" name="perm[', $type, '][', $permission['id'], ']" value="', $permission['select'] == 'denied' && !empty($modSettings['permission_enable_deny']) ? 'deny' : $permission['select'], '" />
-						</td>
-					</tr>';
-			}
-			else
-			{
-				echo '
-					<tr id="perm_div_', $id_group, '_', $permission['id'], '" class="', $alternate ? 'windowbg' : 'windowbg2', '">
-						<td valign="top" width="10" style="padding-right: 1ex;">
-							', $permission['help_index'] ? '<a href="' . $scripturl . '?action=helpadmin;help=' . $permission['help_index'] . '" onclick="return reqWin(this.href);" class="help"><img src="' . $settings['images_url'] . '/helptopics.gif" alt="' . $txt['help'] . '" /></a>' : '', '
-						</td>
-						<td valign="top" width="100%" align="left" style="padding-bottom: 2px;">', $permission['name'], '</td>';
-
-					if (empty($modSettings['permission_enable_deny']) || $context['group']['id'] == -1)
-						echo '
-						<td valign="top" style="padding-bottom: 2px;"><input type="checkbox" id="select_', $permission['id'], '" name="perm[', $type, '][', $permission['id'], ']"', $permission['select'] == 'on' ? ' checked="checked"' : '', ' onclick="determineGroupState(\'', $id_group, '\');" value="on" class="input_check" ', $disable_field, '/></td>';
-					else
-						echo '
-						<td valign="top" width="10" style="padding-bottom: 2px;"><input type="radio" id="select_on_', $permission['id'], '" name="perm[', $type, '][', $permission['id'], ']"', $permission['select'] == 'on' ? ' checked="checked"' : '', ' value="on" onclick="determineGroupState(\'', $id_group, '\');" class="input_radio" ', $disable_field, '/></td>
-						<td valign="top" width="10" style="padding-bottom: 2px;"><input type="radio" id="select_off_', $permission['id'], '" name="perm[', $type, '][', $permission['id'], ']"', $permission['select'] == 'off' ? ' checked="checked"' : '', ' value="off" onclick="determineGroupState(\'', $id_group, '\');" class="input_radio" ', $disable_field, '/></td>
-						<td valign="top" width="10" style="padding-bottom: 2px;"><input type="radio" id="select_deny_', $permission['id'], '" name="perm[', $type, '][', $permission['id'], ']"', $permission['select'] == 'denied' ? ' checked="checked"' : '', ' value="deny" onclick="window.smf_usedDeny = true; determineGroupState(\'', $id_group, '\');" class="input_radio" ', $disable_field, '/></td>';
-
-					echo '
-					</tr>';
-			}
-				$alternate = !$alternate;
-		}
-
-		if (!$permissionGroup['hidden'] && $has_display_content)
-			echo '
-					<tr id="group_hr_div_', $id_group, '" class="windowbg2 perm_groups">
-						<td colspan="5" width="100%"></td>
-					</tr>';
-	}
-	echo '
-				</tbody>
-			</table>
-	<script type="text/javascript"><!-- // --><![CDATA[';
-
-	if ($context['profile']['can_modify'] && empty($context['simple_javascript_displayed']))
-	{
-		// Only show this once.
-		$context['simple_javascript_displayed'] = true;
-
-		// Manually toggle the breakdown.
-		echo '
-	function toggleBreakdown(id_group, forcedisplayType)
-	{
-		displayType = document.getElementById("group_hr_div_" + id_group).style.display == "none" ? "" : "none";
-		if (typeof(forcedisplayType) != "undefined")
-			displayType = forcedisplayType;
-
-		for (i = 0; i < groupPermissions[id_group].length; i++)
-		{
-			document.getElementById("perm_div_" + id_group + "_" + groupPermissions[id_group][i]).style.display = displayType
-		}
-		document.getElementById("group_hr_div_" + id_group).style.display = displayType
-		document.getElementById("group_toggle_img_" + id_group).src = "', $settings['images_url'], '/" + (displayType == "none" ? "selected" : "sort_down") + ".gif";
-
-		return false;
-	}';
-
-		// This function decides what to do when ANYTHING is touched!
-		echo '
-		var groupPermissions = new Array();
-		function determineGroupState(id_group, forceState)
-		{
-			if (typeof(forceState) != "undefined")
-				thisState = forceState;
-
-			// Cycle through this groups elements.
-			var curState = false, thisState;
-			for (var i = 0; i < groupPermissions[id_group].length; i++)
-			{';
-
-		if (empty($modSettings['permission_enable_deny']) || $context['group']['id'] == -1)
-			echo '
-				if (typeof(forceState) != "undefined")
-				{
-					document.getElementById(\'select_\' + groupPermissions[id_group][i]).checked = forceState == \'on\' ? 1 : 0;
-				}
-
-				thisState = document.getElementById(\'select_\' + groupPermissions[id_group][i]).checked ? \'on\' : \'off\';';
-		else
-			echo '
-				if (typeof(forceState) != "undefined")
-				{
-					document.getElementById(\'select_on_\' + groupPermissions[id_group][i]).checked = forceState == \'on\' ? 1 : 0;
-					document.getElementById(\'select_off_\' + groupPermissions[id_group][i]).checked = forceState == \'off\' ? 1 : 0;
-					document.getElementById(\'select_deny_\' + groupPermissions[id_group][i]).checked = forceState == \'deny\' ? 1 : 0;
-				}
-
-				if (document.getElementById(\'select_on_\' + groupPermissions[id_group][i]).checked)
-					thisState = \'on\';
-				else if (document.getElementById(\'select_off_\' + groupPermissions[id_group][i]).checked)
-					thisState = \'off\';
-				else
-					thisState = \'deny\';';
-
-		echo '
-				// Unless this is the first element, or it\'s the same state as the last we\'re buggered.
-				if (curState == false || thisState == curState)
-				{
-					curState = thisState;
-				}
-				else
-				{
-					curState = \'fudged\';
-					i = 999;
-				}
-			}
-
-			// First check the right master is selected!';
-		if (empty($modSettings['permission_enable_deny']) || $context['group']['id'] == -1)
-			echo '
-			document.getElementById("group_select_" + id_group).checked = curState == \'on\' ? 1 : 0;';
-		else
-			echo '
-			document.getElementById("group_select_on_" + id_group).checked = curState == \'on\' ? 1 : 0;
-			document.getElementById("group_select_off_" + id_group).checked = curState == \'off\' ? 1 : 0;
-			document.getElementById("group_select_deny_" + id_group).checked = curState == \'deny\' ? 1 : 0;';
-
-		// Force the display?
-		echo '
-			if (curState != \'fudged\')
-				toggleBreakdown(id_group, "none");';
+	foreach ($context['hidden_perms'] as $hidden_perm)
 		echo '
-		}';
-	}
-
-	// Some more javascript to be displayed as long as we are editing.
-	if ($context['profile']['can_modify'])
-	{
-		foreach ($permission_data as $id_group => $permissionGroup)
-		{
-			if (empty($permissionGroup['permissions']))
-				continue;
-
-			// As before...
-			$has_display_content = false;
-			if (!$permissionGroup['hidden'])
-			{
-				// Make sure we can show it.
-				foreach ($permissionGroup['permissions'] as $permission)
-					if (!$permission['hidden'])
-						$has_display_content = true;
-
-				// Make all the group indicators visible on JS only.
-				if ($has_display_content)
-				{
-					if (empty($modSettings['permission_enable_deny']) || $context['group']['id'] == -1)
-						echo '
-			document.getElementById("group_select_div_', $id_group, '").parentNode.className = "lockedbg";
-			document.getElementById("group_select_', $id_group, '").style.display = "";';
-					else
-						echo '
-			document.getElementById("group_select_div_on_', $id_group, '").parentNode.className = "lockedbg";
-			document.getElementById("group_select_div_off_', $id_group, '").parentNode.className = "lockedbg";
-			document.getElementById("group_select_div_deny_', $id_group, '").parentNode.className = "lockedbg";
-			document.getElementById("group_select_on_', $id_group, '").style.display = "";
-			document.getElementById("group_select_off_', $id_group, '").style.display = "";
-			document.getElementById("group_select_deny_', $id_group, '").style.display = "";';
-				}
-
-				$perm_ids = array();
-				$count = 0;
-				foreach ($permissionGroup['permissions'] as $permission)
-				{
-					if (!$permission['hidden'])
-					{
-						// Need this for knowing what can be tweaked.
-						$perm_ids[] = "'$permission[id]'";
-					}
-				}
-				// Declare this groups permissions into an array.
-				if (!empty($perm_ids))
-					echo '
-			groupPermissions[\'', $id_group, '\'] = new Array(', count($perm_ids), ');';
-				foreach ($perm_ids as $count => $id)
-					echo '
-			groupPermissions[\'', $id_group, '\'][', $count, '] = ', $id, ';';
-
-				// Show the group as required.
-				if ($has_display_content)
-				echo '
-			determineGroupState(\'', $id_group, '\');';
-			}
-		}
-	}
+			<input type="hidden" name="perm[', $hidden_perm[0], '][', $hidden_perm[1], ']" value="', $hidden_perm[2], '">';
 
 	echo '
-		// ]]></script>';
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['admin-mp_token_var'], '" value="', $context['admin-mp_token'], '">
+		</form>
+	</div>';
 }
 
-// The SMF 1.x way of looking at permissions.
-function template_modify_group_classic($type)
+// The way of looking at permissions.
+function template_modify_group_display($type)
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
 	$permission_type = &$context['permissions'][$type];
-	$disable_field = $context['profile']['can_modify'] ? '' : 'disabled="disabled" ';
-
-	echo '
-				<div class="windowbg2">
-					<span class="topslice"><span></span></span>
-					<div class="content">';
+	$disable_field = $context['profile']['can_modify'] ? '' : 'disabled ';
 
 	foreach ($permission_type['columns'] as $column)
 	{
 		echo '
-						<table width="49%" class="table_grid perm_classic floatleft">';
+					<table class="table_grid half_content">';
 
 		foreach ($column as $permissionGroup)
 		{
@@ -881,314 +557,337 @@
 				if ($has_display_content)
 				{
 					echo '
-							<tr class="catbg">
-								<th colspan="2" width="100%" align="left"><strong class="smalltext">', $permissionGroup['name'], '</strong></th>';
-					if (empty($modSettings['permission_enable_deny']) || $context['group']['id'] == -1)
+						<tr class="title_bar">
+							<th width="10"></th>
+							<th', $context['group']['id'] == -1 ? ' colspan="2"' : '', ' class="smalltext">', $permissionGroup['name'], '</th>';
+
+					if ($context['group']['id'] != -1)
 						echo '
-								<th colspan="3" width="10"></th>';
-					else
+							<th>', $txt['permissions_option_own'], '</th>
+							<th>', $txt['permissions_option_any'], '</th>';
+
 						echo '
-								<th align="center"><div>', $txt['permissions_option_on'], '</div></th>
-								<th align="center"><div>', $txt['permissions_option_off'], '</div></th>
-								<th align="center"><div>', $txt['permissions_option_deny'], '</div></th>';
-					echo '
-							</tr>';
+						</tr>';
 				}
 			}
 
-			$alternate = false;
 			foreach ($permissionGroup['permissions'] as $permission)
 			{
-				// If it's hidden keep the last value.
-				if ($permission['hidden'] || $permissionGroup['hidden'])
-				{
-					echo '
-							<tr style="display: none;">
-								<td>';
-
-					if ($permission['has_own_any'])
-					{
-						// Guests can't have own permissions.
-						if ($context['group']['id'] != -1)
-							echo '
-									<input type="hidden" name="perm[', $permission_type['id'], '][', $permission['own']['id'], ']" value="', $permission['own']['select'] == 'denied' && !empty($modSettings['permission_enable_deny']) ? 'deny' : $permission['own']['select'], '" />';
-
-						echo '
-									<input type="hidden" name="perm[', $permission_type['id'], '][', $permission['any']['id'], ']" value="', $permission['any']['select'] == 'denied' && !empty($modSettings['permission_enable_deny']) ? 'deny' : $permission['any']['select'], '" />';
-					}
-					else
-						echo '
-									<input type="hidden" name="perm[', $permission_type['id'], '][', $permission['id'], ']" value="', $permission['select'] == 'denied' && !empty($modSettings['permission_enable_deny']) ? 'deny' : $permission['select'], '" />';
-					echo '
-								</td>
-							</tr>';
-				}
-				else
+				if (!$permission['hidden'] && !$permissionGroup['hidden'])
 				{
 					echo '
-							<tr class="', $alternate ? 'windowbg' : 'windowbg2', '">
-								<td width="10">
-									', $permission['show_help'] ? '<a href="' . $scripturl . '?action=helpadmin;help=permissionhelp_' . $permission['id'] . '" onclick="return reqWin(this.href);" class="help"><img src="' . $settings['images_url'] . '/helptopics.gif" alt="' . $txt['help'] . '" /></a>' : '', '
-								</td>';
+						<tr class="windowbg">
+							<td width="10">
+								', $permission['show_help'] ? '<a href="' . $scripturl . '?action=helpadmin;help=permissionhelp_' . $permission['id'] . '" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="'. $txt['help'].'"></span></a>' : '', '
+							</td>
+							<td class="lefttext full_width">', $permission['name'], '</td><td>';
 
 					if ($permission['has_own_any'])
 					{
-						echo '
-								<td colspan="4" width="100%" align="left">', $permission['name'], '</td>
-							</tr><tr class="', $alternate ? 'windowbg' : 'windowbg2', '">';
-
 						// Guests can't do their own thing.
 						if ($context['group']['id'] != -1)
 						{
-							echo '
-								<td></td>
-								<td width="100%" class="smalltext" align="right">', $permission['own']['name'], ':</td>';
-
 							if (empty($modSettings['permission_enable_deny']))
 								echo '
-								<td colspan="3"><input type="checkbox" name="perm[', $permission_type['id'], '][', $permission['own']['id'], ']"', $permission['own']['select'] == 'on' ? ' checked="checked"' : '', ' value="on" id="', $permission['own']['id'], '_on" class="input_check" ', $disable_field, '/></td>';
+								<input type="checkbox" name="perm[', $permission_type['id'], '][', $permission['own']['id'], ']"', $permission['own']['select'] == 'on' ? ' checked="checked"' : '', ' value="on" id="', $permission['own']['id'], '_on" class="input_check" ', $disable_field, '/>';
 							else
+							{
 								echo '
-								<td width="10"><input type="radio" name="perm[', $permission_type['id'], '][', $permission['own']['id'], ']"', $permission['own']['select'] == 'on' ? ' checked="checked"' : '', ' value="on" id="', $permission['own']['id'], '_on" class="input_radio" ', $disable_field, '/></td>
-								<td width="10"><input type="radio" name="perm[', $permission_type['id'], '][', $permission['own']['id'], ']"', $permission['own']['select'] == 'off' ? ' checked="checked"' : '', ' value="off" class="input_radio" ', $disable_field, '/></td>
-								<td width="10"><input type="radio" name="perm[', $permission_type['id'], '][', $permission['own']['id'], ']"', $permission['own']['select'] == 'denied' ? ' checked="checked"' : '', ' value="deny" class="input_radio" ', $disable_field, '/></td>';
+								<select name="perm[', $permission_type['id'], '][', $permission['own']['id'], ']" ', $disable_field, '>';
 
+								foreach (array('on', 'off', 'deny') as $c)
+									echo '
+									<option ', $permission['own']['select'] == $c ? ' selected' : '', ' value="', $c, '">', $txt['permissions_option_' . $c], '</option>';
 							echo '
-							</tr><tr class="', $alternate ? 'windowbg' : 'windowbg2', '">';
-						}
+								</select>';
+							}
 
 						echo '
-								<td></td>
-								<td width="100%" class="smalltext" align="right">', $permission['any']['name'], ':</td>';
+							</td>
+							<td>';
+						}
 
 						if (empty($modSettings['permission_enable_deny']) || $context['group']['id'] == -1)
 							echo '
-								<td colspan="3"><input type="checkbox" name="perm[', $permission_type['id'], '][', $permission['any']['id'], ']"', $permission['any']['select'] == 'on' ? ' checked="checked"' : '', ' value="on" class="input_check" ', $disable_field, '/></td>';
+								<input type="checkbox" name="perm[', $permission_type['id'], '][', $permission['any']['id'], ']"', $permission['any']['select'] == 'on' ? ' checked="checked"' : '', ' value="on" class="input_check" ', $disable_field, '/>';
 						else
+						{
 							echo '
-								<td><input type="radio" name="perm[', $permission_type['id'], '][', $permission['any']['id'], ']"', $permission['any']['select'] == 'on' ? ' checked="checked"' : '', ' value="on" onclick="document.forms.permissionForm.', $permission['own']['id'], '_on.checked = true;" class="input_radio" ', $disable_field, '/></td>
-								<td><input type="radio" name="perm[', $permission_type['id'], '][', $permission['any']['id'], ']"', $permission['any']['select'] == 'off' ? ' checked="checked"' : '', ' value="off" class="input_radio" ', $disable_field, '/></td>
-								<td><input type="radio" name="perm[', $permission_type['id'], '][', $permission['any']['id'], ']"', $permission['any']['select']== 'denied' ? ' checked="checked"' : '', ' value="deny" id="', $permission['any']['id'], '_deny" onclick="window.smf_usedDeny = true;" class="input_radio" ', $disable_field, '/></td>';
+								<select name="perm[', $permission_type['id'], '][', $permission['any']['id'], ']" ', $disable_field, '>';
 
-						echo '
-							</tr>';
+							foreach (array('on', 'off', 'deny') as $c)
+								echo '
+									<option ', $permission['any']['select'] == $c ? ' selected' : '', ' value="', $c, '">', $txt['permissions_option_' . $c], '</option>';
+							echo '
+								</select>';
+						}
 					}
 					else
 					{
-						echo '
-								<td width="100%" align="left">', $permission['name'], '</td>';
+						if ($context['group']['id'] != -1)
+							echo '
+							</td>
+							<td>';
 
 						if (empty($modSettings['permission_enable_deny']) || $context['group']['id'] == -1)
 							echo '
-								<td><input type="checkbox" name="perm[', $permission_type['id'], '][', $permission['id'], ']"', $permission['select'] == 'on' ? ' checked="checked"' : '', ' value="on" class="input_check" ', $disable_field, '/></td>';
+								<input type="checkbox" name="perm[', $permission_type['id'], '][', $permission['id'], ']"', $permission['select'] == 'on' ? ' checked="checked"' : '', ' value="on" class="input_check" ', $disable_field, '/>';
 						else
+						{
 							echo '
-								<td><input type="radio" name="perm[', $permission_type['id'], '][', $permission['id'], ']"', $permission['select'] == 'on' ? ' checked="checked"' : '', ' value="on" class="input_radio" ', $disable_field, '/></td>
-								<td><input type="radio" name="perm[', $permission_type['id'], '][', $permission['id'], ']"', $permission['select'] == 'off' ? ' checked="checked"' : '', ' value="off" class="input_radio" ', $disable_field, '/></td>
-								<td><input type="radio" name="perm[', $permission_type['id'], '][', $permission['id'], ']"', $permission['select'] == 'denied' ? ' checked="checked"' : '', ' value="deny" onclick="window.smf_usedDeny = true;" class="input_radio" ', $disable_field, '/></td>';
+								<select name="perm[', $permission_type['id'], '][', $permission['id'], ']" ', $disable_field, '>';
 
-						echo '
-							</tr>';
+							foreach (array('on', 'off', 'deny') as $c)
+								echo '
+									<option ', $permission['select'] == $c ? ' selected' : '', ' value="', $c, '">', $txt['permissions_option_' . $c], '</option>';
+							echo '
+								</select>';
+						}
 					}
+					echo '
+							</td>
+						</tr>';
 				}
-				$alternate = !$alternate;
 			}
-
-			if (!$permissionGroup['hidden'] && $has_display_content)
-				echo '
-							<tr class="windowbg2">
-								<td colspan="5" width="100%"><!--separator--></td>
-							</tr>';
 		}
-	echo '
-						</table>';
+		echo '
+					</table>';
 	}
+
 	echo '
-				<br class="clear" />
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
+				<br class="clear">';
 }
 
 function template_inline_permissions()
 {
-	global $context, $settings, $options, $txt, $modSettings;
+	global $context, $txt, $modSettings;
 
+	// This looks really weird, but it keeps things nested properly...
 	echo '
-		<fieldset id="', $context['current_permission'], '">
-			<legend><a href="javascript:void(0);" onclick="document.getElementById(\'', $context['current_permission'], '\').style.display = \'none\';document.getElementById(\'', $context['current_permission'], '_groups_link\').style.display = \'block\'; return false;">', $txt['avatar_select_permission'], '</a></legend>';
+											<fieldset id="', $context['current_permission'], '">
+												<legend><a href="javascript:void(0);" onclick="document.getElementById(\'', $context['current_permission'], '\').style.display = \'none\';document.getElementById(\'', $context['current_permission'], '_groups_link\').style.display = \'block\'; return false;" class="toggle_up"> ', $txt['avatar_select_permission'], '</a></legend>';
 	if (empty($modSettings['permission_enable_deny']))
 		echo '
-			<ul class="permission_groups">';
+												<ul class="reset">';
 	else
 		echo '
-			<div class="information">', $txt['permissions_option_desc'], '</div>
-			<dl class="settings">
-				<dt>
-					<span class="perms"><strong>', $txt['permissions_option_on'], '</strong></span>
-					<span class="perms"><strong>', $txt['permissions_option_off'], '</strong></span>
-					<span class="perms" style="color: red;"><strong>', $txt['permissions_option_deny'], '</strong></span>
-				</dt>
-				<dd>
-				</dd>';
+												<div class="information">', $txt['permissions_option_desc'], '</div>
+												<dl class="settings">
+													<dt>
+														<span class="perms"><strong>', $txt['permissions_option_on'], '</strong></span>
+														<span class="perms"><strong>', $txt['permissions_option_off'], '</strong></span>
+														<span class="perms red"><strong>', $txt['permissions_option_deny'], '</strong></span>
+													</dt>
+													<dd>
+													</dd>';
 	foreach ($context['member_groups'] as $group)
 	{
 		if (!empty($modSettings['permission_enable_deny']))
 			echo '
-				<dt>';
+													<dt>';
 		else
 			echo '
-				<li>';
+													<li>';
 
 		if (empty($modSettings['permission_enable_deny']))
 			echo '
-					<input type="checkbox" name="', $context['current_permission'], '[', $group['id'], ']" value="on"', $group['status'] == 'on' ? ' checked="checked"' : '', ' class="input_check" />';
+														<input type="checkbox" name="', $context['current_permission'], '[', $group['id'], ']" value="on"', $group['status'] == 'on' ? ' checked' : '', ' class="input_check">';
 		else
 			echo '
-					<span class="perms"><input type="radio" name="', $context['current_permission'], '[', $group['id'], ']" value="on"', $group['status'] == 'on' ? ' checked="checked"' : '', ' class="input_radio" /></span>
-					<span class="perms"><input type="radio" name="', $context['current_permission'], '[', $group['id'], ']" value="off"', $group['status'] == 'off' ? ' checked="checked"' : '', ' class="input_radio" /></span>
-					<span class="perms"><input type="radio" name="', $context['current_permission'], '[', $group['id'], ']" value="deny"', $group['status'] == 'deny' ? ' checked="checked"' : '', ' class="input_radio" /></span>';
+														<span class="perms"><input type="radio" name="', $context['current_permission'], '[', $group['id'], ']" value="on"', $group['status'] == 'on' ? ' checked' : '', ' class="input_radio"></span>
+														<span class="perms"><input type="radio" name="', $context['current_permission'], '[', $group['id'], ']" value="off"', $group['status'] == 'off' ? ' checked' : '', ' class="input_radio"></span>
+														<span class="perms"><input type="radio" name="', $context['current_permission'], '[', $group['id'], ']" value="deny"', $group['status'] == 'deny' ? ' checked' : '', ' class="input_radio"></span>';
 
 		if (!empty($modSettings['permission_enable_deny']))
 			echo '
-				</dt>
-				<dd>
-					<span', $group['is_postgroup'] ? ' style="font-style: italic;"' : '', '>', $group['name'], '</span>
-				</dd>';
+													</dt>
+													<dd>
+														<span', $group['is_postgroup'] ? ' style="font-style: italic;"' : '', '>', $group['name'], '</span>
+													</dd>';
 		else
 			echo '
-					<span', $group['is_postgroup'] ? ' style="font-style: italic;"' : '', '>', $group['name'], '</span>
-				</li>';
+														<span', $group['is_postgroup'] ? ' style="font-style: italic;"' : '', '>', $group['name'], '</span>
+													</li>';
 	}
 
 	if (empty($modSettings['permission_enable_deny']))
 		echo '
-			</ul>';
+												</ul>';
 	else
 		echo '
-			</dl>';
+												</dl>';
 
 	echo '
-		</fieldset>
+											</fieldset>
 
-		<a href="javascript:void(0);" onclick="document.getElementById(\'', $context['current_permission'], '\').style.display = \'block\'; document.getElementById(\'', $context['current_permission'], '_groups_link\').style.display = \'none\'; return false;" id="', $context['current_permission'], '_groups_link" style="display: none;">[ ', $txt['avatar_select_permission'], ' ]</a>
+											<a href="javascript:void(0);" onclick="document.getElementById(\'', $context['current_permission'], '\').style.display = \'block\'; document.getElementById(\'', $context['current_permission'], '_groups_link\').style.display = \'none\'; return false;" id="', $context['current_permission'], '_groups_link" style="display: none;" class="toggle_down"> ', $txt['avatar_select_permission'], '</a>
 
-		<script type="text/javascript"><!-- // --><![CDATA[
-			document.getElementById("', $context['current_permission'], '").style.display = "none";
-			document.getElementById("', $context['current_permission'], '_groups_link").style.display = "";
-		// ]]></script>';
+											<script><!-- // --><![CDATA[
+												document.getElementById("', $context['current_permission'], '").style.display = "none";
+												document.getElementById("', $context['current_permission'], '_groups_link").style.display = "";
+											// ]]></script>';
 }
 
 // Edit post moderation permissions.
 function template_postmod_permissions()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
 	echo '
-	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=permissions;sa=postmod;', $context['session_var'], '=', $context['session_id'], '" method="post" name="postmodForm" id="postmodForm" accept-charset="', $context['character_set'], '">
-			<div class="title_bar">
-				<h3 class="titlebg">', $txt['permissions_post_moderation'], '</h3>
-			</div>';
-
-	// Got advanced permissions - if so warn!
-	if (!empty($modSettings['permission_enable_deny']))
-		echo '
-				<div class="information">', $txt['permissions_post_moderation_deny_note'], '</div>';
+					<div id="admin_form_wrapper">
+						<form action="', $scripturl, '?action=admin;area=permissions;sa=postmod;', $context['session_var'], '=', $context['session_id'], '" method="post" name="postmodForm" id="postmodForm" accept-charset="', $context['character_set'], '">
+							<div class="cat_bar">
+								<h3 class="catbg">', $txt['permissions_post_moderation'], '</h3>
+							</div>';
 
+	// First, we have the bit where we can enable or disable this bad boy.
 	echo '
-				<div class="righttext padding">
-					', $txt['permissions_post_moderation_select'], ':
-					<select name="pid" onchange="document.forms.postmodForm.submit();">';
+							<div class="windowbg2">
+								<dl class="settings">
+									<dt>', $txt['permissions_post_moderation_enable'], '</dt>
+									<dd><input type="checkbox" name="postmod_active"', !empty($modSettings['postmod_active']) ? ' checked' : '', '></dd>
+								</dl>
+							</div>';
 
-	foreach ($context['profiles'] as $profile)
-		if ($profile['can_modify'])
+	// If we're not active, there's a bunch of stuff we don't need to show.
+	if (!empty($modSettings['postmod_active']))
+	{
+		// Got advanced permissions - if so warn!
+		if (!empty($modSettings['permission_enable_deny']))
 			echo '
-						<option value="', $profile['id'], '" ', $profile['id'] == $context['current_profile'] ? 'selected="selected"' : '', '>', $profile['name'], '</option>';
-
-	echo '
-					</select>
-					<input type="submit" value="', $txt['go'], '" class="button_submit" />
-			</div>
-			<table width="100%" class="table_grid">
-				<thead>
-					<tr class="catbg">
-						<th class="first_th"></th>
-						<th align="center" colspan="3">
-							', $txt['permissions_post_moderation_new_topics'], '
-						</th>
-						<th align="center" colspan="3">
-							', $txt['permissions_post_moderation_replies_own'], '
-						</th>
-						<th align="center" colspan="3">
-							', $txt['permissions_post_moderation_replies_any'], '
-						</th>
-						<th class="last_th" align="center" colspan="3">
-							', $txt['permissions_post_moderation_attachments'], '
-						</th>
-					</tr>
-					<tr class="titlebg">
-						<th width="30%">
-							', $txt['permissions_post_moderation_group'], '
-						</th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_allow.gif" alt="', $txt['permissions_post_moderation_allow'], '" title="', $txt['permissions_post_moderation_allow'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_moderate.gif" alt="', $txt['permissions_post_moderation_moderate'], '" title="', $txt['permissions_post_moderation_moderate'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_deny.gif" alt="', $txt['permissions_post_moderation_disallow'], '" title="', $txt['permissions_post_moderation_disallow'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_allow.gif" alt="', $txt['permissions_post_moderation_allow'], '" title="', $txt['permissions_post_moderation_allow'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_moderate.gif" alt="', $txt['permissions_post_moderation_moderate'], '" title="', $txt['permissions_post_moderation_moderate'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_deny.gif" alt="', $txt['permissions_post_moderation_disallow'], '" title="', $txt['permissions_post_moderation_disallow'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_allow.gif" alt="', $txt['permissions_post_moderation_allow'], '" title="', $txt['permissions_post_moderation_allow'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_moderate.gif" alt="', $txt['permissions_post_moderation_moderate'], '" title="', $txt['permissions_post_moderation_moderate'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_deny.gif" alt="', $txt['permissions_post_moderation_disallow'], '" title="', $txt['permissions_post_moderation_disallow'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_allow.gif" alt="', $txt['permissions_post_moderation_allow'], '" title="', $txt['permissions_post_moderation_allow'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_moderate.gif" alt="', $txt['permissions_post_moderation_moderate'], '" title="', $txt['permissions_post_moderation_moderate'], '" /></th>
-						<th align="center"><img src="', $settings['default_images_url'], '/admin/post_moderation_deny.gif" alt="', $txt['permissions_post_moderation_disallow'], '" title="', $txt['permissions_post_moderation_disallow'], '" /></th>
-					</tr>
-				</thead>
-				<tbody>';
+							<div class="information">', $txt['permissions_post_moderation_deny_note'], '</div>';
 
-	foreach ($context['profile_groups'] as $group)
-	{
 		echo '
-					<tr>
-						<td width="40%" class="windowbg">
-							<span ', ($group['color'] ? 'style="color: ' . $group['color'] . '"' : ''), '>', $group['name'], '</span>';
-			if (!empty($group['children']))
-				echo '
-							<br /><span class="smalltext">', $txt['permissions_includes_inherited'], ': &quot;', implode('&quot;, &quot;', $group['children']), '&quot;</span>';
+							<div class="padding">
+								<p class="smalltext floatleft">
+									<strong>', $txt['permissions_post_moderation_legend'], ':</strong><br>
+									<span class="generic_icons post_moderation_allow"></span>', $txt['permissions_post_moderation_allow'], '<br>
+									<span class="generic_icons post_moderation_moderate"></span>', $txt['permissions_post_moderation_moderate'], '<br>
+									<span class="generic_icons post_moderation_deny"></span>', $txt['permissions_post_moderation_disallow'], '
+								</p>
+								<span class="righttext floatright">
+									<br><br><br>
+									', $txt['permissions_post_moderation_select'], ':
+									<select name="pid" onchange="document.forms.postmodForm.submit();">';
+
+		foreach ($context['profiles'] as $profile)
+			if ($profile['can_modify'])
+				echo '
+										<option value="', $profile['id'], '"', $profile['id'] == $context['current_profile'] ? ' selected' : '', '>', $profile['name'], '</option>';
+
+		echo '
+									</select>
+									<input type="submit" value="', $txt['go'], '" class="button_submit">
+								</span>
+							</div>
+							<table class="table_grid" id="postmod">
+								<thead>
+									<tr class="title_bar">
+										<th></th>
+										<th class="centercol" colspan="3">
+											', $txt['permissions_post_moderation_new_topics'], '
+										</th>
+										<th class="centercol" colspan="3">
+											', $txt['permissions_post_moderation_replies_own'], '
+										</th>
+										<th class="centercol" colspan="3">
+											', $txt['permissions_post_moderation_replies_any'], '
+										</th>';
+
+		if ($modSettings['attachmentEnable'] == 1)
+			echo '
+										<th class="centercol" colspan="3">
+											', $txt['permissions_post_moderation_attachments'], '
+										</th>';
+
+		echo '
+									</tr>
+									<tr class="windowbg">
+										<th width="30%">
+											', $txt['permissions_post_moderation_group'], '
+										</th>
+										<th><span class="generic_icons post_moderation_allow"></span></th>
+										<th><span class="generic_icons post_moderation_moderate"></span></th>
+										<th><span class="generic_icons post_moderation_deny"></span></th>
+										<th><span class="generic_icons post_moderation_allow"></span></th>
+										<th><span class="generic_icons post_moderation_moderate"></span></th>
+										<th><span class="generic_icons post_moderation_deny"></span></th>
+										<th><span class="generic_icons post_moderation_allow"></span></th>
+										<th><span class="generic_icons post_moderation_moderate"></span></th>
+										<th><span class="generic_icons post_moderation_deny"></span></th>';
+
+		if ($modSettings['attachmentEnable'] == 1)
+			echo '
+										<th><span class="generic_icons post_moderation_allow"></span></th>
+										<th><span class="generic_icons post_moderation_moderate"></span></th>
+										<th><span class="generic_icons post_moderation_deny"></span></th>';
+
+		echo '
+									</tr>
+								</thead>
+								<tbody>';
 
+		foreach ($context['profile_groups'] as $group)
+		{
 			echo '
-						</td>
-						<td align="center" class="windowbg2"><input type="radio" name="new_topic[', $group['id'], ']" value="allow" ', $group['new_topic'] == 'allow' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg2"><input type="radio" name="new_topic[', $group['id'], ']" value="moderate" ', $group['new_topic'] == 'moderate' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg2"><input type="radio" name="new_topic[', $group['id'], ']" value="disallow" ', $group['new_topic'] == 'disallow' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg"><input type="radio" name="replies_own[', $group['id'], ']" value="allow" ', $group['replies_own'] == 'allow' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg"><input type="radio" name="replies_own[', $group['id'], ']" value="moderate" ', $group['replies_own'] == 'moderate' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg"><input type="radio" name="replies_own[', $group['id'], ']" value="disallow" ', $group['replies_own'] == 'disallow' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg2"><input type="radio" name="replies_any[', $group['id'], ']" value="allow" ', $group['replies_any'] == 'allow' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg2"><input type="radio" name="replies_any[', $group['id'], ']" value="moderate" ', $group['replies_any'] == 'moderate' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg2"><input type="radio" name="replies_any[', $group['id'], ']" value="disallow" ', $group['replies_any'] == 'disallow' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg"><input type="radio" name="attachment[', $group['id'], ']" value="allow" ', $group['attachment'] == 'allow' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg"><input type="radio" name="attachment[', $group['id'], ']" value="moderate" ', $group['attachment'] == 'moderate' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-						<td align="center" class="windowbg"><input type="radio" name="attachment[', $group['id'], ']" value="disallow" ', $group['attachment'] == 'disallow' ? 'checked="checked"' : '', ' class="input_radio" /></td>
-					</tr>';
+									<tr class="windowbg">
+										<td width="40%">
+											<span ', ($group['color'] ? 'style="color: ' . $group['color'] . '"' : ''), '>', $group['name'], '</span>';
+				if (!empty($group['children']))
+					echo '
+											<br><span class="smalltext">', $txt['permissions_includes_inherited'], ': &quot;', implode('&quot;, &quot;', $group['children']), '&quot;</span>';
+
+				echo '
+										</td>
+										<td class="centercol"><input type="radio" name="new_topic[', $group['id'], ']" value="allow"', $group['new_topic'] == 'allow' ? ' checked' : '', ' class="input_radio"></td>
+										<td class="centercol"><input type="radio" name="new_topic[', $group['id'], ']" value="moderate"', $group['new_topic'] == 'moderate' ? ' checked' : '', ' class="input_radio"></td>
+										<td class="centercol"><input type="radio" name="new_topic[', $group['id'], ']" value="disallow"', $group['new_topic'] == 'disallow' ? ' checked' : '', ' class="input_radio"></td>';
+
+				// Guests can't have "own" permissions
+				if ($group['id'] == '-1')
+				{
+				echo '
+										<td colspan="3"></td>';
+				}
+				else
+				{
+					echo '
+										<td class="centercol"><input type="radio" name="replies_own[', $group['id'], ']" value="allow"', $group['replies_own'] == 'allow' ? ' checked' : '', ' class="input_radio"></td>
+										<td class="centercol"><input type="radio" name="replies_own[', $group['id'], ']" value="moderate"', $group['replies_own'] == 'moderate' ? ' checked' : '', ' class="input_radio"></td>
+										<td class="centercol"><input type="radio" name="replies_own[', $group['id'], ']" value="disallow"', $group['replies_own'] == 'disallow' ? ' checked' : '', ' class="input_radio"></td>';
+				}
+
+				echo '
+										<td class="centercol"><input type="radio" name="replies_any[', $group['id'], ']" value="allow"', $group['replies_any'] == 'allow' ? ' checked' : '', ' class="input_radio"></td>
+										<td class="centercol"><input type="radio" name="replies_any[', $group['id'], ']" value="moderate"', $group['replies_any'] == 'moderate' ? ' checked' : '', ' class="input_radio"></td>
+										<td class="centercol"><input type="radio" name="replies_any[', $group['id'], ']" value="disallow"', $group['replies_any'] == 'disallow' ? ' checked' : '', ' class="input_radio"></td>';
+
+				if ($modSettings['attachmentEnable'] == 1)
+				{
+					echo '
+										<td class="centercol"><input type="radio" name="attachment[', $group['id'], ']" value="allow"', $group['attachment'] == 'allow' ? ' checked' : '', ' class="input_radio"></td>
+										<td class="centercol"><input type="radio" name="attachment[', $group['id'], ']" value="moderate"', $group['attachment'] == 'moderate' ? ' checked' : '', ' class="input_radio"></td>
+										<td class="centercol"><input type="radio" name="attachment[', $group['id'], ']" value="disallow"', $group['attachment'] == 'disallow' ? ' checked' : '', ' class="input_radio"></td>';
+				}
+
+				echo '
+									</tr>';
+		}
+
+		echo '
+								</tbody>
+							</table>';
 	}
 
 	echo '
-				</tbody>
-			</table>
-			<div class="righttext padding">
-				<input type="submit" name="save_changes" value="', $txt['permissions_commit'], '" class="button_submit" />
-			</div>
-		</form>
-		<p class="smalltext" style="padding-left: 10px;">
-			<strong>', $txt['permissions_post_moderation_legend'], ':</strong><br />
-			<img src="', $settings['default_images_url'], '/admin/post_moderation_allow.gif" alt="', $txt['permissions_post_moderation_allow'], '" /> - ', $txt['permissions_post_moderation_allow'], '<br />
-			<img src="', $settings['default_images_url'], '/admin/post_moderation_moderate.gif" alt="', $txt['permissions_post_moderation_moderate'], '" /> - ', $txt['permissions_post_moderation_moderate'], '<br />
-			<img src="', $settings['default_images_url'], '/admin/post_moderation_deny.gif" alt="', $txt['permissions_post_moderation_disallow'], '" /> - ', $txt['permissions_post_moderation_disallow'], '
-		</p>
-	</div>
-	<br class="clear" />';
+							<div class="righttext padding">
+								<input type="submit" name="save_changes" value="', $txt['permissions_commit'], '" class="button_submit">
+								<input type="hidden" name="', $context['admin-mppm_token_var'], '" value="', $context['admin-mppm_token'], '">
+							</div>
+						</form>';
+
+	echo '
+					</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManageScheduledTasks.template.php b/Themes/default/ManageScheduledTasks.template.php
--- a/Themes/default/ManageScheduledTasks.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/ManageScheduledTasks.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,24 +3,49 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Template for listing all scheduled tasks.
 function template_view_scheduled_tasks()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $txt;
 
 	// We completed some tasks?
 	if (!empty($context['tasks_were_run']))
-		echo '
-	<div id="task_completed">
+	{
+		if (empty($context['scheduled_errors']))
+			echo '
+	<div class="infobox">
 		', $txt['scheduled_tasks_were_run'], '
 	</div>';
+		else
+		{
+			echo '
+	<div class="errorbox" id="errors">
+			<dl>
+				<dt>
+					<strong id="error_serious">', $txt['scheduled_tasks_were_run_errors'], '</strong>
+				</dt>';
+
+			foreach ($context['scheduled_errors'] as $task => $errors)
+			{
+				echo '
+				<dd class="error">
+					<strong>', isset($txt['scheduled_task_' . $task]) ? $txt['scheduled_task_' . $task] : $task, '</strong>
+					<ul><li>', implode('</li><li>', $errors), '</li></ul>
+				</dd>';
+			}
+
+			echo '
+			</dl>
+		</div>';
+		}
+	}
 
 	template_show_list('scheduled_tasks');
 }
@@ -28,7 +53,7 @@
 // A template for, you guessed it, editing a task!
 function template_edit_scheduled_tasks()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $txt, $scripturl;
 
 	// Starts off with general maintenance procedures.
 	echo '
@@ -41,55 +66,49 @@
 				<em>', sprintf($txt['scheduled_task_time_offset'], $context['server_time']), ' </em>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<strong>', $txt['scheduled_tasks_name'], ':</strong>
-						</dt>
-						<dd>
-							', $context['task']['name'], '<br />
-							<span class="smalltext">', $context['task']['desc'], '</span>
-						</dd>
-						<dt>
-							<strong>', $txt['scheduled_task_edit_interval'], ':</strong>
-						</dt>
-						<dd>
-							', $txt['scheduled_task_edit_repeat'], '
-							<input type="text" name="regularity" value="', empty($context['task']['regularity']) ? 1 : $context['task']['regularity'], '" onchange="if (this.value < 1) this.value = 1;" size="2" maxlength="2" class="input_text" />
-							<select name="unit">
-								<option value="0">', $txt['scheduled_task_edit_pick_unit'], '</option>
-								<option value="0">---------------------</option>
-								<option value="m" ', empty($context['task']['unit']) || $context['task']['unit'] == 'm' ? 'selected="selected"' : '', '>', $txt['scheduled_task_reg_unit_m'], '</option>
-								<option value="h" ', $context['task']['unit'] == 'h' ? 'selected="selected"' : '', '>', $txt['scheduled_task_reg_unit_h'], '</option>
-								<option value="d" ', $context['task']['unit'] == 'd' ? 'selected="selected"' : '', '>', $txt['scheduled_task_reg_unit_d'], '</option>
-								<option value="w" ', $context['task']['unit'] == 'w' ? 'selected="selected"' : '', '>', $txt['scheduled_task_reg_unit_w'], '</option>
-							</select>
-						</dd>
-						<dt>
-							<strong>', $txt['scheduled_task_edit_start_time'], ':</strong><br />
-							<span class="smalltext">', $txt['scheduled_task_edit_start_time_desc'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="offset" value="', $context['task']['offset_formatted'], '" size="6" maxlength="5" class="input_text" />
-						</dd>
-						<dt>
-							<strong>', $txt['scheduled_tasks_enabled'], ':</strong>
-						</dt>
-						<dd>
-							<input type="checkbox" name="enabled" id="enabled" ', !$context['task']['disabled'] ? 'checked="checked"' : '', ' class="input_check" />
-						</dd>
-					</dl>
-					<div class="righttext">
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="submit" name="save" value="', $txt['scheduled_tasks_save_changes'], '" class="button_submit" />
-					</div>
+				<dl class="settings">
+					<dt>
+						<strong>', $txt['scheduled_tasks_name'], ':</strong>
+					</dt>
+					<dd>
+						', $context['task']['name'], '<br>
+						<span class="smalltext">', $context['task']['desc'], '</span>
+					</dd>
+					<dt>
+						<strong><label for="regularity">', $txt['scheduled_task_edit_interval'], ':</label></strong>
+					</dt>
+					<dd>
+						', $txt['scheduled_task_edit_repeat'], '
+						<input type="text" name="regularity" id="regularity" value="', empty($context['task']['regularity']) ? 1 : $context['task']['regularity'], '" onchange="if (this.value < 1) this.value = 1;" size="2" maxlength="2" class="input_text">
+						<select name="unit">
+							<option value="m"', empty($context['task']['unit']) || $context['task']['unit'] == 'm' ? ' selected' : '', '>', $txt['scheduled_task_reg_unit_m'], '</option>
+							<option value="h"', $context['task']['unit'] == 'h' ? ' selected' : '', '>', $txt['scheduled_task_reg_unit_h'], '</option>
+							<option value="d"', $context['task']['unit'] == 'd' ? ' selected' : '', '>', $txt['scheduled_task_reg_unit_d'], '</option>
+							<option value="w"', $context['task']['unit'] == 'w' ? ' selected' : '', '>', $txt['scheduled_task_reg_unit_w'], '</option>
+						</select>
+					</dd>
+					<dt>
+						<strong><label for="start_time">', $txt['scheduled_task_edit_start_time'], ':</label></strong><br>
+						<span class="smalltext">', $txt['scheduled_task_edit_start_time_desc'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="offset" id="start_time" value="', $context['task']['offset_formatted'], '" size="6" maxlength="5" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="enabled">', $txt['scheduled_tasks_enabled'], ':</label></strong>
+					</dt>
+					<dd>
+						<input type="checkbox" name="enabled" id="enabled"', !$context['task']['disabled'] ? ' checked' : '', ' class="input_check">
+					</dd>
+				</dl>
+				<div class="righttext">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['admin-st_token_var'], '" value="', $context['admin-st_token'], '">
+					<input type="submit" name="save" value="', $txt['scheduled_tasks_save_changes'], '" class="button_submit">
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManageSearch.template.php b/Themes/default/ManageSearch.template.php
--- a/Themes/default/ManageSearch.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/ManageSearch.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,198 +3,179 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_modify_weights()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=managesearch;sa=weights" method="post" accept-charset="', $context['character_set'], '">
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=managesearch;sa=weights" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['search_weights'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt class="large_caption">
-							<a href="', $scripturl, '?action=helpadmin;help=search_weight_frequency" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" align="top" /></a>
-							', $txt['search_weight_frequency'], ':
-						</dt>
-						<dd class="large_caption">
-							<span class="search_weight"><input type="text" name="search_weight_frequency" id="weight1_val" value="', empty($modSettings['search_weight_frequency']) ? '0' : $modSettings['search_weight_frequency'], '" onchange="calculateNewValues()" size="3" class="input_text" /></span>
-							<span id="weight1" class="search_weight">', $context['relative_weights']['search_weight_frequency'], '%</span>
-						</dd>
-						<dt class="large_caption">
-							<a href="', $scripturl, '?action=helpadmin;help=search_weight_age" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" align="top" /></a>
-							', $txt['search_weight_age'], ':
-						</dt>
-						<dd class="large_caption">
-							<span class="search_weight"><input type="text" name="search_weight_age" id="weight2_val" value="', empty($modSettings['search_weight_age']) ? '0' : $modSettings['search_weight_age'], '" onchange="calculateNewValues()" size="3" class="input_text" /></span>
-							<span id="weight2" class="search_weight">', $context['relative_weights']['search_weight_age'], '%</span>
-						</dd>
-						<dt class="large_caption">
-							<a href="', $scripturl, '?action=helpadmin;help=search_weight_length" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" align="top" /></a>
-							', $txt['search_weight_length'], ':
-						</dt>
-						<dd class="large_caption">
-							<span class="search_weight"><input type="text" name="search_weight_length" id="weight3_val" value="', empty($modSettings['search_weight_length']) ? '0' : $modSettings['search_weight_length'], '" onchange="calculateNewValues()" size="3" class="input_text" /></span>
-							<span id="weight3" class="search_weight">', $context['relative_weights']['search_weight_length'], '%</span>
-						</dd>
-						<dt class="large_caption">
-							<a href="', $scripturl, '?action=helpadmin;help=search_weight_subject" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" align="top" /></a>
-							', $txt['search_weight_subject'], ':
-						</dt>
-						<dd class="large_caption">
-							<span class="search_weight"><input type="text" name="search_weight_subject" id="weight4_val" value="', empty($modSettings['search_weight_subject']) ? '0' : $modSettings['search_weight_subject'], '" onchange="calculateNewValues()" size="3" class="input_text" /></span>
-							<span id="weight4" class="search_weight">', $context['relative_weights']['search_weight_subject'], '%</span>
-						</dd>
-						<dt class="large_caption">
-							<a href="', $scripturl, '?action=helpadmin;help=search_weight_first_message" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" align="top" /></a>
-							', $txt['search_weight_first_message'], ':
-						</dt>
-						<dd class="large_caption">
-							<span class="search_weight"><input type="text" name="search_weight_first_message" id="weight5_val" value="', empty($modSettings['search_weight_first_message']) ? '0' : $modSettings['search_weight_first_message'], '" onchange="calculateNewValues()" size="3" class="input_text" /></span>
-							<span id="weight5" class="search_weight">', $context['relative_weights']['search_weight_first_message'], '%</span>
-						</dd>
-						<dt class="large_caption">
-							<a href="', $scripturl, '?action=helpadmin;help=search_weight_frequency" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" align="top" /></a>
-							', $txt['search_weight_sticky'], ':
-						</dt>
-						<dd class="large_caption">
-							<span class="search_weight"><input type="text" name="search_weight_sticky" id="weight6_val" value="', empty($modSettings['search_weight_sticky']) ? '0' : $modSettings['search_weight_sticky'], '" onchange="calculateNewValues()" size="3" class="input_text" /></span>
-							<span id="weight6" class="search_weight">', $context['relative_weights']['search_weight_sticky'], '%</span>
-						</dd>
-						<dt class="large_caption">
-							<strong>', $txt['search_weights_total'], '</strong>
-						</dt>
-						<dd class="large_caption">
-							<span id="weighttotal" class="search_weight"><strong>', $context['relative_weights']['total'], '</strong></span>
-							<span class="search_weight"><strong>100%</strong></span>
-						</dd>
-					</dl>
-					<input type="submit" name="save" value="', $txt['search_weights_save'], '" class="button_submit floatright" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" /><br class="clear" />
-				</div>
-				<span class="botslice"><span></span></span>
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<a href="', $scripturl, '?action=helpadmin;help=search_weight_frequency" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a><label for="weight1_val">
+						', $txt['search_weight_frequency'], ':</label>
+					</dt>
+					<dd>
+						<span class="search_weight"><input type="text" name="search_weight_frequency" id="weight1_val" value="', empty($modSettings['search_weight_frequency']) ? '0' : $modSettings['search_weight_frequency'], '" onchange="calculateNewValues()" size="3" class="input_text"></span>
+						<span id="weight1" class="search_weight">', $context['relative_weights']['search_weight_frequency'], '%</span>
+					</dd>
+					<dt>
+						<a href="', $scripturl, '?action=helpadmin;help=search_weight_age" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a><label for="weight2_val">
+						', $txt['search_weight_age'], ':</label>
+					</dt>
+					<dd>
+						<span class="search_weight"><input type="text" name="search_weight_age" id="weight2_val" value="', empty($modSettings['search_weight_age']) ? '0' : $modSettings['search_weight_age'], '" onchange="calculateNewValues()" size="3" class="input_text"></span>
+						<span id="weight2" class="search_weight">', $context['relative_weights']['search_weight_age'], '%</span>
+					</dd>
+					<dt>
+						<a href="', $scripturl, '?action=helpadmin;help=search_weight_length" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a><label for="weight3_val">
+						', $txt['search_weight_length'], ':</label>
+					</dt>
+					<dd>
+						<span class="search_weight"><input type="text" name="search_weight_length" id="weight3_val" value="', empty($modSettings['search_weight_length']) ? '0' : $modSettings['search_weight_length'], '" onchange="calculateNewValues()" size="3" class="input_text"></span>
+						<span id="weight3" class="search_weight">', $context['relative_weights']['search_weight_length'], '%</span>
+					</dd>
+					<dt>
+						<a href="', $scripturl, '?action=helpadmin;help=search_weight_subject" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a><label for="weight4_val">
+						', $txt['search_weight_subject'], ':</label>
+					</dt>
+					<dd>
+						<span class="search_weight"><input type="text" name="search_weight_subject" id="weight4_val" value="', empty($modSettings['search_weight_subject']) ? '0' : $modSettings['search_weight_subject'], '" onchange="calculateNewValues()" size="3" class="input_text"></span>
+						<span id="weight4" class="search_weight">', $context['relative_weights']['search_weight_subject'], '%</span>
+					</dd>
+					<dt>
+						<a href="', $scripturl, '?action=helpadmin;help=search_weight_first_message" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a><label for="weight5_val">
+						', $txt['search_weight_first_message'], ':</label>
+					</dt>
+					<dd>
+						<span class="search_weight"><input type="text" name="search_weight_first_message" id="weight5_val" value="', empty($modSettings['search_weight_first_message']) ? '0' : $modSettings['search_weight_first_message'], '" onchange="calculateNewValues()" size="3" class="input_text"></span>
+						<span id="weight5" class="search_weight">', $context['relative_weights']['search_weight_first_message'], '%</span>
+					</dd>
+					<dt>
+						<a href="', $scripturl, '?action=helpadmin;help=search_weight_sticky" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a><label for="weight6_val">
+						', $txt['search_weight_sticky'], ':</label>
+					</dt>
+					<dd>
+						<span class="search_weight"><input type="text" name="search_weight_sticky" id="weight6_val" value="', empty($modSettings['search_weight_sticky']) ? '0' : $modSettings['search_weight_sticky'], '" onchange="calculateNewValues()" size="3" class="input_text"></span>
+						<span id="weight6" class="search_weight">', $context['relative_weights']['search_weight_sticky'], '%</span>
+					</dd>
+					<dt>
+						<strong>', $txt['search_weights_total'], '</strong>
+					</dt>
+					<dd>
+						<span id="weighttotal" class="search_weight"><strong>', $context['relative_weights']['total'], '</strong></span>
+						<span class="search_weight"><strong>100%</strong></span>
+					</dd>
+				</dl>
+				<input type="submit" name="save" value="', $txt['search_weights_save'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-msw_token_var'], '" value="', $context['admin-msw_token'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function calculateNewValues()
-		{
-			var total = 0;
-			for (var i = 1; i <= 6; i++)
-			{
-				total += parseInt(document.getElementById(\'weight\' + i + \'_val\').value);
-			}
-			setInnerHTML(document.getElementById(\'weighttotal\'), total);
-			for (var i = 1; i <= 6; i++)
-			{
-				setInnerHTML(document.getElementById(\'weight\' + i), (Math.round(1000 * parseInt(document.getElementById(\'weight\' + i + \'_val\').value) / total) / 10) + \'%\');
-			}
-		}
-	// ]]></script>';
+	</div>';
 }
 
 function template_select_search_method()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=managesearch;sa=method" method="post" accept-charset="', $context['character_set'], '">
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['search_method'], '</h3>
+		</div>
+		<div class="information">
+			<div class="smalltext" style="font-weight: normal;"><a href="', $scripturl, '?action=helpadmin;help=search_why_use_index" onclick="return reqOverlayDiv(this.href);">', $txt['search_create_index_why'], '</a></div>
+		</div>
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=managesearch;sa=method" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['search_method'], '</h3>
 			</div>
-			<div class="information">
-				<div class="smalltext" style="font-weight: normal;"><a href="', $scripturl, '?action=helpadmin;help=search_why_use_index" onclick="return reqWin(this.href);">', $txt['search_create_index_why'], '</a></div>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
+			<div class="windowbg2">
+				<dl class="settings">';
 
-			';
 	if (!empty($context['table_info']))
 		echo '
-						<dt>
-							<strong>', $txt['search_method_messages_table_space'], ':</strong>
-						</dt>
-						<dd>
-							', $context['table_info']['data_length'], '
-						</dd>
-						<dt>
-							<strong>', $txt['search_method_messages_index_space'], ':</strong>
-						</dt>
-						<dd>
-							', $context['table_info']['index_length'], '
-						</dd>';
-	echo '
-					</dl>
-					', $context['double_index'] ? '<div class="information">
-					' . $txt['search_double_index'] . '</div>' : '', '
-					<fieldset class="search_settings floatleft">
-						<legend>', $txt['search_index'], '</legend>
-						<dl>
-							<dt><input type="radio" name="search_index" value=""', empty($modSettings['search_index']) ? ' checked="checked"' : '', ' class="input_radio" />
-							', $txt['search_index_none'], '
-							</dt>';
+					<dt>
+						<strong>', $txt['search_method_messages_table_space'], ':</strong>
+					</dt>
+					<dd>
+						', $context['table_info']['data_length'], '
+					</dd>
+					<dt>
+						<strong>', $txt['search_method_messages_index_space'], ':</strong>
+					</dt>
+					<dd>
+						', $context['table_info']['index_length'], '
+					</dd>';
+	echo '
+				</dl>
+				', $context['double_index'] ? '<div class="noticebox">
+				' . $txt['search_double_index'] . '</div>' : '', '
+				<fieldset class="search_settings floatleft">
+					<legend>', $txt['search_index'], '</legend>
+					<dl>
+						<dt><input type="radio" name="search_index" value=""', empty($modSettings['search_index']) ? ' checked' : '', ' class="input_radio">
+						', $txt['search_index_none'], '
+						</dt>';
 
 	if ($context['supports_fulltext'])
 	{
 		echo '
-							<dt>
-								<input type="radio" name="search_index" value="fulltext"', !empty($modSettings['search_index']) && $modSettings['search_index'] == 'fulltext' ? ' checked="checked"' : '', empty($context['fulltext_index']) ? ' onclick="alert(\'' . $txt['search_method_fulltext_warning'] . '\'); selectRadioByName(this.form.search_index, \'fulltext\');"': '', ' class="input_radio" />
-								', $txt['search_method_fulltext_index'], '
-							</dt>
-							<dd>
+						<dt>
+							<input type="radio" name="search_index" value="fulltext"', !empty($modSettings['search_index']) && $modSettings['search_index'] == 'fulltext' ? ' checked' : '', empty($context['fulltext_index']) ? ' onclick="alert(\'' . $txt['search_method_fulltext_warning'] . '\'); selectRadioByName(this.form.search_index, \'fulltext\');"': '', ' class="input_radio">
+							', $txt['search_method_fulltext_index'], '
+						</dt>
+						<dd>
 
-								<span class="smalltext">';
+							<span class="smalltext">';
 	if (empty($context['fulltext_index']) && empty($context['cannot_create_fulltext']))
 		echo '
-									<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_no_index_exists'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=createfulltext;', $context['session_var'], '=', $context['session_id'], '">', $txt['search_method_fulltext_create'], '</a>]';
+								<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_no_index_exists'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=createfulltext;', $context['session_var'], '=', $context['session_id'], ';', $context['admin-msm_token_var'], '=', $context['admin-msm_token'], '">', $txt['search_method_fulltext_create'], '</a>]';
 	elseif (empty($context['fulltext_index']) && !empty($context['cannot_create_fulltext']))
 		echo '
-									<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_fulltext_cannot_create'];
+								<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_fulltext_cannot_create'];
 	else
 		echo '
-									<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_index_already_exists'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=removefulltext;', $context['session_var'], '=', $context['session_id'], '">', $txt['search_method_fulltext_remove'], '</a>]<br />
-									<strong>', $txt['search_index_size'], ':</strong> ', $context['table_info']['fulltext_length'];
+								<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_index_already_exists'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=removefulltext;', $context['session_var'], '=', $context['session_id'], ';', $context['admin-msm_token_var'], '=', $context['admin-msm_token'], '">', $txt['search_method_fulltext_remove'], '</a>]<br>
+								<strong>', $txt['search_index_size'], ':</strong> ', $context['table_info']['fulltext_length'];
 	echo '
-									</span>
-							</dd>';
+								</span>
+						</dd>';
 	}
 
 	echo '
-							<dt>
-								<input type="radio" name="search_index" value="custom"', !empty($modSettings['search_index']) && $modSettings['search_index'] == 'custom' ? ' checked="checked"' : '', $context['custom_index'] ? '' : ' onclick="alert(\'' . $txt['search_index_custom_warning'] . '\'); selectRadioByName(this.form.search_method, \'1\');"', ' class="input_radio" />
-								', $txt['search_index_custom'], '
-							</dt>
-							<dd>
-								<span class="smalltext">';
+						<dt>
+							<input type="radio" name="search_index" value="custom"', !empty($modSettings['search_index']) && $modSettings['search_index'] == 'custom' ? ' checked' : '', $context['custom_index'] ? '' : ' onclick="alert(\'' . $txt['search_index_custom_warning'] . '\'); selectRadioByName(this.form.search_method, \'1\');"', ' class="input_radio">
+							', $txt['search_index_custom'], '
+						</dt>
+						<dd>
+							<span class="smalltext">';
 	if ($context['custom_index'])
 		echo '
-									<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_index_already_exists'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=removecustom;', $context['session_var'], '=', $context['session_id'], '">', $txt['search_index_custom_remove'], '</a>]<br />
-									<strong>', $txt['search_index_size'], ':</strong> ', $context['table_info']['custom_index_length'];
+								<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_index_already_exists'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=removecustom;', $context['session_var'], '=', $context['session_id'], ';', $context['admin-msm_token_var'], '=', $context['admin-msm_token'], '">', $txt['search_index_custom_remove'], '</a>]<br>
+								<strong>', $txt['search_index_size'], ':</strong> ', $context['table_info']['custom_index_length'];
 	elseif ($context['partial_custom_index'])
 		echo '
-									<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_index_partial'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=removecustom;', $context['session_var'], '=', $context['session_id'], '">', $txt['search_index_custom_remove'], '</a>] [<a href="', $scripturl, '?action=admin;area=managesearch;sa=createmsgindex;resume;', $context['session_var'], '=', $context['session_id'], '">', $txt['search_index_custom_resume'], '</a>]<br />
-									<strong>', $txt['search_index_size'], ':</strong> ', $context['table_info']['custom_index_length'];
+								<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_index_partial'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=removecustom;', $context['session_var'], '=', $context['session_id'], ';', $context['admin-msm_token_var'], '=', $context['admin-msm_token'], '">', $txt['search_index_custom_remove'], '</a>] [<a href="', $scripturl, '?action=admin;area=managesearch;sa=createmsgindex;resume;', $context['session_var'], '=', $context['session_id'], ';', $context['admin-msm_token_var'], '=', $context['admin-msm_token'], '">', $txt['search_index_custom_resume'], '</a>]<br>
+								<strong>', $txt['search_index_size'], ':</strong> ', $context['table_info']['custom_index_length'];
 	else
 		echo '
-									<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_no_index_exists'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=createmsgindex">', $txt['search_index_create_custom'], '</a>]';
+								<strong>', $txt['search_index_label'], ':</strong> ', $txt['search_method_no_index_exists'], ' [<a href="', $scripturl, '?action=admin;area=managesearch;sa=createmsgindex">', $txt['search_index_create_custom'], '</a>]';
 	echo '
-								</span>
-							</dd>';
+							</span>
+						</dd>';
 
 	foreach ($context['search_apis'] as $api)
 	{
@@ -202,41 +183,38 @@
 			continue;
 
 		echo '
-							<dt>
-								<input type="radio" name="search_index" value="', $api['setting_index'], '"', !empty($modSettings['search_index']) && $modSettings['search_index'] == $api['setting_index'] ? ' checked="checked"' : '', ' class="input_radio" />
-								', $api['label'] ,'
-							</dt>';
+						<dt>
+							<input type="radio" name="search_index" value="', $api['setting_index'], '"', !empty($modSettings['search_index']) && $modSettings['search_index'] == $api['setting_index'] ? ' checked' : '', ' class="input_radio">
+							', $api['label'] ,'
+						</dt>';
 
 	if ($api['desc'])
 		echo '
-							<dd>
-								<span class="smalltext">', $api['desc'], '</span>
-							</dd>';
+						<dd>
+							<span class="smalltext">', $api['desc'], '</span>
+						</dd>';
 	}
 
 	echo '
-						</dl>
-					</fieldset>
-					<fieldset class="search_settings floatright">
-					<legend>', $txt['search_method'], '</legend>
-						<input type="checkbox" name="search_force_index" id="search_force_index_check" value="1"', empty($modSettings['search_force_index']) ? '' : ' checked="checked"', ' class="input_check" /><label for="search_force_index_check">', $txt['search_force_index'], '</label><br />
-						<input type="checkbox" name="search_match_words" id="search_match_words_check" value="1"', empty($modSettings['search_match_words']) ? '' : ' checked="checked"', ' class="input_check" /><label for="search_match_words_check">', $txt['search_match_words'], '</label>
-					</fieldset>
-					<div class="clear">
-						<input type="submit" name="save" value="', $txt['search_method_save'], '" class="button_submit floatright" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					</div>
-				</div>
-				<span class="botslice clear"><span></span></span>
+					</dl>
+				</fieldset>
+				<fieldset class="search_settings floatright">
+				<legend>', $txt['search_method'], '</legend>
+					<input type="checkbox" name="search_force_index" id="search_force_index_check" value="1"', empty($modSettings['search_force_index']) ? '' : ' checked', ' class="input_check"><label for="search_force_index_check">', $txt['search_force_index'], '</label><br>
+					<input type="checkbox" name="search_match_words" id="search_match_words_check" value="1"', empty($modSettings['search_match_words']) ? '' : ' checked', ' class="input_check"><label for="search_match_words_check">', $txt['search_match_words'], '</label>
+				</fieldset>
+				<br class="clear"/>
+				<input type="submit" name="save" value="', $txt['search_method_save'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-msmpost_token_var'], '" value="', $context['admin-msmpost_token'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_create_index()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
@@ -245,34 +223,29 @@
 				<h3 class="catbg">', $txt['search_create_index'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<label for="predefine_select">', $txt['search_predefined'], ':</label>
-						</dt>
-						<dd>
-							<select name="bytes_per_word" id="predefine_select">
-								<option value="2">', $txt['search_predefined_small'], '</option>
-								<option value="4" selected="selected">', $txt['search_predefined_moderate'], '</option>
-								<option value="5">', $txt['search_predefined_large'], '</option>
-							</select>
-						</dd>
-					</dl>
-					<input type="submit" name="save" value="', $txt['search_create_index_start'], '" class="button_submit" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</div>
-				<span class="botslice"><span></span></span>
+				<dl class="settings">
+					<dt>
+						<label for="predefine_select">', $txt['search_predefined'], ':</label>
+					</dt>
+					<dd>
+						<select name="bytes_per_word" id="predefine_select">
+							<option value="2">', $txt['search_predefined_small'], '</option>
+							<option value="4" selected>', $txt['search_predefined_moderate'], '</option>
+							<option value="5">', $txt['search_predefined_large'], '</option>
+						</select>
+					</dd>
+				</dl>
+				<hr class="hrcolor">
+				<input type="submit" name="save" value="', $txt['search_create_index_start'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 			</div>
-
 	</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_create_index_progress()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 	echo '
 	<div id="admincenter">
 		<form action="', $scripturl, '?action=admin;area=managesearch;sa=createmsgindex;step=1" name="autoSubmit" method="post" accept-charset="', $context['character_set'], '">
@@ -280,26 +253,23 @@
 				<h3 class="catbg">', $txt['search_create_index'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>
-						', $txt['search_create_index_not_ready'], '
-					</p>
-					<p>
-						<strong>', $txt['search_create_index_progress'], ': ', $context['percentage'], '%</strong>
-					</p>
-					<input type="submit" name="b" value="', $txt['search_create_index_continue'], '" class="button_submit" />
+				<div><p>',
+					$txt['search_create_index_not_ready'], '</p>
+					<div class="progress_bar">
+						<div class="full_bar">', $context['percentage'], '%</div>
+						<div class="green_percent" style="width: ', $context['percentage'], '%;">&nbsp;</div>
+					</div>
 				</div>
-				<span class="botslice"><span></span></span>
+				<hr class="hrcolor">
+				<input type="submit" name="b" value="', $txt['search_create_index_continue'], '" class="button_submit">
 			</div>
-			<input type="hidden" name="step" value="', $context['step'], '" />
-			<input type="hidden" name="start" value="', $context['start'], '" />
-			<input type="hidden" name="bytes_per_word" value="', $context['index_settings']['bytes_per_word'], '" />
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<input type="hidden" name="step" value="', $context['step'], '">
+			<input type="hidden" name="start" value="', $context['start'], '">
+			<input type="hidden" name="bytes_per_word" value="', $context['index_settings']['bytes_per_word'], '">
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 		</form>
 	</div>
-	<br class="clear" />
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var countdown = 10;
 		doAutoSubmit();
 
@@ -321,79 +291,71 @@
 
 function template_create_index_done()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $scripturl, $txt;
 	echo '
 	<div id="admincenter">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['search_create_index'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $txt['search_create_index_done'], '</p>
-				<p>
-					<strong><a href="', $scripturl, '?action=admin;area=managesearch;sa=method">', $txt['search_create_index_done_link'], '</a></strong>
-				</p>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p>', $txt['search_create_index_done'], '</p>
+			<p>
+				<strong><a href="', $scripturl, '?action=admin;area=managesearch;sa=method">', $txt['search_create_index_done_link'], '</a></strong>
+			</p>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Add or edit a search engine spider.
 function template_spider_edit()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 	echo '
 	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=sengines;sa=editspiders;sid=', $context['spider']['id'], '" method="post" accept-charset="', $context['character_set'], '">
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=sengines;sa=editspiders;sid=', $context['spider']['id'], '" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $context['page_title'], '</h3>
 			</div>
-			<div class="information">
+			<div class="information winfo">
 				', $txt['add_spider_desc'], '
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<strong>', $txt['spider_name'], ':</strong><br />
-							<span class="smalltext">', $txt['spider_name_desc'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="spider_name" value="', $context['spider']['name'], '" class="input_text" />
-						</dd>
-						<dt>
-							<strong>', $txt['spider_agent'], ':</strong><br />
-							<span class="smalltext">', $txt['spider_agent_desc'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="spider_agent" value="', $context['spider']['agent'], '" class="input_text" />
-						</dd>
-						<dt>
-							<strong>', $txt['spider_ip_info'], ':</strong><br />
-							<span class="smalltext">', $txt['spider_ip_info_desc'], '</span>
-						</dt>
-						<dd>
-							<textarea name="spider_ip" rows="4" cols="20">', $context['spider']['ip_info'], '</textarea>
-						</dd>
-					</dl>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="submit" name="save" value="', $context['page_title'], '" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<strong><label for="spider_name">', $txt['spider_name'], ':</label></strong><br>
+						<span class="smalltext">', $txt['spider_name_desc'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="spider_name" id="spider_name" value="', $context['spider']['name'], '" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="spider_agent">', $txt['spider_agent'], ':</label></strong><br>
+						<span class="smalltext">', $txt['spider_agent_desc'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="spider_agent" id="spider_agent" value="', $context['spider']['agent'], '" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="spider_ip">', $txt['spider_ip_info'], ':</label></strong><br>
+						<span class="smalltext">', $txt['spider_ip_info_desc'], '</span>
+					</dt>
+					<dd>
+						<textarea name="spider_ip" id="spider_ip" rows="4" cols="20">', $context['spider']['ip_info'], '</textarea>
+					</dd>
+				</dl>
+				<hr class="hrcolor">
+				<input type="submit" name="save" value="', $context['page_title'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-ses_token_var'], '" value="', $context['admin-ses_token'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Show... spider... logs...
 function template_show_spider_logs()
 {
-	global $context, $txt, $settings, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="admincenter">';
@@ -402,27 +364,52 @@
 	template_show_list('spider_logs');
 
 	echo '
-		<br />
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['spider_logs_delete'], '</h3>
-		</div>
-		<form action="', $scripturl, '?action=admin;area=sengines;sa=logs;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>
-						', $txt['spider_logs_delete_older'], '
-						<input type="text" name="older" id="older" value="7" size="3" class="input_text" />
-						', $txt['spider_logs_delete_day'], '
-					</p>
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="submit" name="delete_entries" value="', $txt['spider_logs_delete_submit'], '" onclick="if (document.getElementById(\'older\').value &lt; 1 &amp;&amp; !confirm(\'' . addcslashes($txt['spider_logs_delete_confirm'], "'") . '\')) return false; return true;" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
+		<br class="clear">
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=sengines;sa=logs" method="post" accept-charset="', $context['character_set'], '">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['spider_logs_delete'], '</h3>
+			</div>
+			<div class="windowbg2">
+				<p>
+					', $txt['spider_logs_delete_older'], '
+					<input type="text" name="older" id="older" value="7" size="3" class="input_text">
+					', $txt['spider_logs_delete_day'], '
+				</p>
+				<input type="submit" name="delete_entries" value="', $txt['spider_logs_delete_submit'], '" onclick="if (document.getElementById(\'older\').value &lt; 1 &amp;&amp; !confirm(\'' . addcslashes($txt['spider_logs_delete_confirm'], "'") . '\')) return false; return true;" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-sl_token_var'], '" value="', $context['admin-sl_token'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
+}
+
+// Show... spider... stats...
+function template_show_spider_stats()
+{
+	global $context, $txt, $scripturl;
+
+	echo '
+	<div id="admincenter">';
+
+	// Standard fields.
+	template_show_list('spider_stat_list');
+
+	echo '
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=sengines;sa=stats" method="post" accept-charset="', $context['character_set'], '">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['spider_logs_delete'], '</h3>
+			</div>
+			<div class="windowbg2">
+				<p>
+					', sprintf($txt['spider_stats_delete_older'], '<input type="text" name="older" id="older" value="90" size="3" class="input_text">'), '
+				</p>
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-ss_token_var'], '" value="', $context['admin-ss_token'], '">
+				<input type="submit" name="delete_entries" value="', $txt['spider_logs_delete_submit'], '" onclick="if (document.getElementById(\'older\').value &lt; 1 &amp;&amp; !confirm(\'' . addcslashes($txt['spider_logs_delete_confirm'], "'") . '\')) return false; return true;" class="button_submit">
+				<br>
+			</div>
+		</form>
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ManageSmileys.template.php b/Themes/default/ManageSmileys.template.php
--- a/Themes/default/ManageSmileys.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/ManageSmileys.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,17 +3,17 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Editing the smiley sets.
 function template_editsets()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="admincenter">';
@@ -21,64 +21,13 @@
 	template_show_list('smiley_set_list');
 
 	echo '
-		<br />
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['smiley_sets_latest'], '</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<div id="smileysLatest">', $txt['smiley_sets_latest_fetch'], '</div>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-	</div>
-	<br class="clear" />
-	<script type="text/javascript"><!-- // --><![CDATA[
-		window.smfForum_scripturl = "', $scripturl, '";
-		window.smfForum_sessionid = "', $context['session_id'], '";
-		window.smfForum_sessionvar = "', $context['session_var'], '";
-	// ]]></script>';
-
-	if (empty($modSettings['disable_smf_js']))
-		echo '
-	<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=latest-smileys.js"></script>';
-
-	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function smfSetLatestSmileys()
-		{
-			if (typeof(window.smfLatestSmileys) != "undefined")
-				setInnerHTML(document.getElementById("smileysLatest"), window.smfLatestSmileys);';
-
-		if (!empty($context['selected_set']))
-			echo '
-
-			changeSet("', $context['selected_set'], '");';
-		if (!empty($context['selected_smiley']))
-			echo '
-			loadSmiley(', $context['selected_smiley'], ');';
-
-		echo '
-		}';
-
-		// Oh well, could be worse - at least it's only IE4.
-		if ($context['browser']['is_ie4'])
-			echo '
-			addLoadEvent(smfSetLatestSmileys);';
-		else
-			echo '
-
-			smfSetLatestSmileys();';
-
-		echo '
-	// ]]></script>';
+	</div>';
 }
 
 // Modifying a smiley set.
 function template_modifyset()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="admincenter">
@@ -94,78 +43,75 @@
 		{
 			echo '
 			<div class="information">
-				', $context['current_set']['can_import'] == 1 ? $txt['smiley_set_import_single'] : $txt['smiley_set_import_multiple'], ' <a href="', $scripturl, '?action=admin;area=smileys;sa=import;set=', $context['current_set']['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['here'], '</a> ', $context['current_set']['can_import'] == 1 ? $txt['smiley_set_to_import_single'] : $txt['smiley_set_to_import_multiple'], '
+				', $context['current_set']['can_import'] == 1 ? sprintf($txt['smiley_set_import_single'], $context['current_set']['import_url']) : sprintf($txt['smiley_set_import_multiple'], $context['current_set']['can_import'], $context['current_set']['import_url']), '
 			</div>';
 		}
 
 		echo '
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<strong><label for="smiley_sets_name">', $txt['smiley_sets_name'], '</label>: </strong>
-						</dt>
-						<dd>
-							<input type="text" name="smiley_sets_name" id="smiley_sets_name" value="', $context['current_set']['name'], '" class="input_text" />
-						</dd>
-						<dt>
-							<strong><label for="smiley_sets_path">', $txt['smiley_sets_url'], '</label>: </strong>
-						</dt>
-						<dd>
-							', $modSettings['smileys_url'], '/';
+				<dl class="settings">
+					<dt>
+						<strong><label for="smiley_sets_name">', $txt['smiley_sets_name'], '</label>: </strong>
+					</dt>
+					<dd>
+						<input type="text" name="smiley_sets_name" id="smiley_sets_name" value="', $context['current_set']['name'], '" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="smiley_sets_path">', $txt['smiley_sets_url'], '</label>: </strong>
+					</dt>
+					<dd>
+						', $modSettings['smileys_url'], '/';
 		if ($context['current_set']['id'] == 'default')
-			echo '<strong>default</strong><input type="hidden" name="smiley_sets_path" id="smiley_sets_path" value="default" />';
+			echo '<strong>default</strong><input type="hidden" name="smiley_sets_path" id="smiley_sets_path" value="default">';
 		elseif (empty($context['smiley_set_dirs']))
 			echo '
-							<input type="text" name="smiley_sets_path" id="smiley_sets_path" value="', $context['current_set']['path'], '" class="input_text" /> ';
+						<input type="text" name="smiley_sets_path" id="smiley_sets_path" value="', $context['current_set']['path'], '" class="input_text"> ';
 		else
 		{
 			echo '
-							<select name="smiley_sets_path" id="smiley_sets_path">';
+						<select name="smiley_sets_path" id="smiley_sets_path">';
 			foreach ($context['smiley_set_dirs'] as $smiley_set_dir)
 				echo '
-								<option value="', $smiley_set_dir['id'], '"', $smiley_set_dir['current'] ? ' selected="selected"' : '', $smiley_set_dir['selectable'] ? '' : ' disabled="disabled"', '>', $smiley_set_dir['id'], '</option>';
+							<option value="', $smiley_set_dir['id'], '"', $smiley_set_dir['current'] ? ' selected' : '', $smiley_set_dir['selectable'] ? '' : ' disabled', '>', $smiley_set_dir['id'], '</option>';
 			echo '
-							</select> ';
+						</select> ';
 		}
 		echo '
-							/..
-						</dd>
-						<dt>
-							<strong><label for="smiley_sets_default">', $txt['smiley_set_select_default'], '</label>: </strong>
-						</dt>
-						<dd>
-							<input type="checkbox" name="smiley_sets_default" id="smiley_sets_default" value="1"', $context['current_set']['selected'] ? ' checked="checked"' : '', ' class="input_check" />
-						</dd>';
+						/..
+					</dd>
+					<dt>
+						<strong><label for="smiley_sets_default">', $txt['smiley_set_select_default'], '</label>: </strong>
+					</dt>
+					<dd>
+						<input type="checkbox" name="smiley_sets_default" id="smiley_sets_default" value="1"', $context['current_set']['selected'] ? ' checked' : '', ' class="input_check">
+					</dd>';
 
 		// If this is a new smiley set they have the option to import smileys already in the directory.
 		if ($context['current_set']['is_new'] && !empty($modSettings['smiley_enable']))
 			echo '
-						<dt>
-							<strong><label for="smiley_sets_import">', $txt['smiley_set_import_directory'], '</label>: </strong>
-						</dt>
-						<dd>
-							<input type="checkbox" name="smiley_sets_import" id="smiley_sets_import" value="1" class="input_check" />
-						</dd>';
+					<dt>
+						<strong><label for="smiley_sets_import">', $txt['smiley_set_import_directory'], '</label>: </strong>
+					</dt>
+					<dd>
+						<input type="checkbox" name="smiley_sets_import" id="smiley_sets_import" value="1" class="input_check">
+					</dd>';
 
 		echo '
-					</dl>
-					<input type="submit" value="', $txt['smiley_sets_save'], '" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			<input type="hidden" name="set" value="', $context['current_set']['id'], '" />
+				</dl>
+				<hr class="hrcolor">
+				<input type="submit" name="smiley_save" value="', $txt['smiley_sets_save'], '" class="button_submit">
+			</div>
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['admin-mss_token_var'], '" value="', $context['admin-mss_token'], '">
+			<input type="hidden" name="set" value="', $context['current_set']['id'], '">
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Editing an individual smiley
 function template_modifysmiley()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="admincenter">
@@ -173,262 +119,211 @@
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['smiley_modify_existing'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<strong>', $txt['smiley_preview'], ': </strong>
-						</dt>
-						<dd>
-							<img src="', $modSettings['smileys_url'], '/', $modSettings['smiley_sets_default'], '/', $context['current_smiley']['filename'], '" id="preview" alt="" /> (', $txt['smiley_preview_using'], ': <select name="set" onchange="updatePreview();">';
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<strong>', $txt['smiley_preview'], ': </strong>
+					</dt>
+					<dd>
+						<img src="', $modSettings['smileys_url'], '/', $modSettings['smiley_sets_default'], '/', $context['current_smiley']['filename'], '" id="preview" alt=""> (', $txt['smiley_preview_using'], ': <select name="set" onchange="updatePreview();">';
 
 		foreach ($context['smiley_sets'] as $smiley_set)
 			echo '
-							<option value="', $smiley_set['path'], '"', $context['selected_set'] == $smiley_set['path'] ? ' selected="selected"' : '', '>', $smiley_set['name'], '</option>';
+						<option value="', $smiley_set['path'], '"', $context['selected_set'] == $smiley_set['path'] ? ' selected' : '', '>', $smiley_set['name'], '</option>';
 
 		echo '
-							</select>)
-						</dd>
-						<dt>
-							<strong><label for="smiley_code">', $txt['smileys_code'], '</label>: </strong>
-						</dt>
-						<dd>
-							<input type="text" name="smiley_code" id="smiley_code" value="', $context['current_smiley']['code'], '" class="input_text" />
-						</dd>
-						<dt>
-							<strong><label for="smiley_filename">', $txt['smileys_filename'], '</label>: </strong>
-						</dt>
-						<dd>';
+						</select>)
+					</dd>
+					<dt>
+						<strong><label for="smiley_code">', $txt['smileys_code'], '</label>: </strong>
+					</dt>
+					<dd>
+						<input type="text" name="smiley_code" id="smiley_code" value="', $context['current_smiley']['code'], '" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="smiley_filename">', $txt['smileys_filename'], '</label>: </strong>
+					</dt>
+					<dd>';
 			if (empty($context['filenames']))
 				echo '
-							<input type="text" name="smiley_filename" id="smiley_filename" value="', $context['current_smiley']['filename'], '" class="input_text" />';
+						<input type="text" name="smiley_filename" id="smiley_filename" value="', $context['current_smiley']['filename'], '" class="input_text">';
 			else
 			{
 				echo '
-							<select name="smiley_filename" id="smiley_filename" onchange="updatePreview();">';
+						<select name="smiley_filename" id="smiley_filename" onchange="updatePreview();">';
 				foreach ($context['filenames'] as $filename)
 					echo '
-								<option value="', $filename['id'], '"', $filename['selected'] ? ' selected="selected"' : '', '>', $filename['id'], '</option>';
+							<option value="', $filename['id'], '"', $filename['selected'] ? ' selected' : '', '>', $filename['id'], '</option>';
 				echo '
-							</select>';
+						</select>';
 			}
 			echo '
-						</dd>
-						<dt>
-							<strong><label for="smiley_description">', $txt['smileys_description'], '</label>: </strong>
-						</dt>
-						<dd>
-							<input type="text" name="smiley_description" id="smiley_description" value="', $context['current_smiley']['description'], '" class="input_text" />
-						</dd>
-						<dt>
-							<strong><label for="smiley_location">', $txt['smileys_location'], '</label>: </strong>
-						</dt>
-						<dd>
-							<select name="smiley_location" id="smiley_location">
-								<option value="0"', $context['current_smiley']['location'] == 0 ? ' selected="selected"' : '', '>
-									', $txt['smileys_location_form'], '
-								</option>
-								<option value="1"', $context['current_smiley']['location'] == 1 ? ' selected="selected"' : '', '>
-									', $txt['smileys_location_hidden'], '
-								</option>
-								<option value="2"', $context['current_smiley']['location'] == 2 ? ' selected="selected"' : '', '>
-									', $txt['smileys_location_popup'], '
-								</option>
-							</select>
-						</dd>
-					</dl>
-					<input type="submit" value="', $txt['smileys_save'], '" class="button_submit" />
-					<input type="submit" name="deletesmiley" value="', $txt['smileys_delete'], '" onclick="return confirm(\'', $txt['smileys_delete_confirm'], '\');" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
+					</dd>
+					<dt>
+						<strong><label for="smiley_description">', $txt['smileys_description'], '</label>: </strong>
+					</dt>
+					<dd>
+						<input type="text" name="smiley_description" id="smiley_description" value="', $context['current_smiley']['description'], '" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="smiley_location">', $txt['smileys_location'], '</label>: </strong>
+					</dt>
+					<dd>
+						<select name="smiley_location" id="smiley_location">
+							<option value="0"', $context['current_smiley']['location'] == 0 ? ' selected' : '', '>
+								', $txt['smileys_location_form'], '
+							</option>
+							<option value="1"', $context['current_smiley']['location'] == 1 ? ' selected' : '', '>
+								', $txt['smileys_location_hidden'], '
+							</option>
+							<option value="2"', $context['current_smiley']['location'] == 2 ? ' selected' : '', '>
+								', $txt['smileys_location_popup'], '
+							</option>
+						</select>
+					</dd>
+				</dl>
+				<input type="submit" name="smiley_save" value="', $txt['smileys_save'], '" class="button_submit">
+				<input type="submit" name="deletesmiley" value="', $txt['smileys_delete'], '" data-confirm="', $txt['smileys_delete_confirm'] ,'" class="button_submit you_sure">
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			<input type="hidden" name="smiley" value="', $context['current_smiley']['id'], '" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="smiley" value="', $context['current_smiley']['id'], '">
 		</form>
-	</div>
-	<br class="clear" />
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function updatePreview()
-		{
-			var currentImage = document.getElementById("preview");
-			currentImage.src = "', $modSettings['smileys_url'], '/" + document.forms.smileyForm.set.value + "/" + document.forms.smileyForm.smiley_filename.value;
-		}
-	// ]]></script>';
+	</div>';
 }
 
 // Adding a new smiley.
 function template_addsmiley()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function switchType()
-		{
-			document.getElementById("ul_settings").style.display = document.getElementById("method-existing").checked ? "none" : "";
-			document.getElementById("ex_settings").style.display = document.getElementById("method-upload").checked ? "none" : "";
-		}
-
-		function swapUploads()
-		{
-			document.getElementById("uploadMore").style.display = document.getElementById("uploadSmiley").disabled ? "none" : "";
-			document.getElementById("uploadSmiley").disabled = !document.getElementById("uploadSmiley").disabled;
-		}
-
-		function selectMethod(element)
-		{
-			document.getElementById("method-existing").checked = element != "upload";
-			document.getElementById("method-upload").checked = element == "upload";
-		}
-	// ]]></script>
 	<div id="admincenter">
 		<form action="', $scripturl, '?action=admin;area=smileys;sa=addsmiley" method="post" accept-charset="', $context['character_set'], '" name="smileyForm" id="smileyForm" enctype="multipart/form-data">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['smileys_add_method'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<ul class="reset">
-						<li>
-							<label for="method-existing"><input type="radio" onclick="switchType();" name="method" id="method-existing" value="existing" checked="checked" class="input_radio" /> ', $txt['smileys_add_existing'], '</label>
-						</li>
-						<li>
-							<label for="method-upload"><input type="radio" onclick="switchType();" name="method" id="method-upload" value="upload" class="input_radio" /> ', $txt['smileys_add_upload'], '</label>
-						</li>
-					</ul>
-					<br />
-					<fieldset id="ex_settings">
-						<dl class="settings">
-							<dt>
-								<img src="', $modSettings['smileys_url'], '/', $modSettings['smiley_sets_default'], '/', $context['filenames'][0]['id'], '" id="preview" alt="" />
-							</dt>
-							<dd>
-								', $txt['smiley_preview_using'], ': <select name="set" onchange="updatePreview();selectMethod(\'existing\');">
-
-							';
+			<div class="windowbg2">
+				<ul class="reset">
+					<li>
+						<label for="method-existing"><input type="radio" onclick="switchType();" name="method" id="method-existing" value="existing" checked class="input_radio"> ', $txt['smileys_add_existing'], '</label>
+					</li>
+					<li>
+						<label for="method-upload"><input type="radio" onclick="switchType();" name="method" id="method-upload" value="upload" class="input_radio"> ', $txt['smileys_add_upload'], '</label>
+					</li>
+				</ul>
+				<br>
+				<fieldset id="ex_settings">
+					<dl class="settings">
+						<dt>
+							<img src="', $modSettings['smileys_url'], '/', $modSettings['smiley_sets_default'], '/', $context['filenames'][0]['id'], '" id="preview" alt="">
+						</dt>
+						<dd>
+							', $txt['smiley_preview_using'], ': <select name="set" onchange="updatePreview();selectMethod(\'existing\');">';
 
 		foreach ($context['smiley_sets'] as $smiley_set)
 			echo '
-								<option value="', $smiley_set['path'], '"', $context['selected_set'] == $smiley_set['path'] ? ' selected="selected"' : '', '>', $smiley_set['name'], '</option>';
+							<option value="', $smiley_set['path'], '"', $context['selected_set'] == $smiley_set['path'] ? ' selected' : '', '>', $smiley_set['name'], '</option>';
 
 		echo '
-								</select>
-							</dd>
-							<dt>
-								<strong><label for="smiley_filename">', $txt['smileys_filename'], '</label>: </strong>
-							</dt>
-							<dd>';
+							</select>
+						</dd>
+						<dt>
+							<strong><label for="smiley_filename">', $txt['smileys_filename'], '</label>: </strong>
+						</dt>
+						<dd>';
 	if (empty($context['filenames']))
 		echo '
-								<input type="text" name="smiley_filename" id="smiley_filename" value="', $context['current_smiley']['filename'], '" onchange="selectMethod(\'existing\');" class="input_text" />';
+							<input type="text" name="smiley_filename" id="smiley_filename" value="', $context['current_smiley']['filename'], '" onchange="selectMethod(\'existing\');" class="input_text">';
 	else
 	{
 		echo '
-									<select name="smiley_filename" id="smiley_filename" onchange="updatePreview();selectMethod(\'existing\');">';
+								<select name="smiley_filename" id="smiley_filename" onchange="updatePreview();selectMethod(\'existing\');">';
 		foreach ($context['filenames'] as $filename)
 			echo '
-									<option value="', $filename['id'], '"', $filename['selected'] ? ' selected="selected"' : '', '>', $filename['id'], '</option>';
+								<option value="', $filename['id'], '"', $filename['selected'] ? ' selected' : '', '>', $filename['id'], '</option>';
 		echo '
-								</select>';
+							</select>';
 	}
 
 	echo '
-							</dd>
-						</dl>
-					</fieldset>
-					<fieldset id="ul_settings" style="display: none;">
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['smileys_add_upload_choose'], ':</strong><br />
-								<span class="smalltext">', $txt['smileys_add_upload_choose_desc'], '</span>
-							</dt>
-							<dd>
-								<input type="file" name="uploadSmiley" id="uploadSmiley" onchange="selectMethod(\'upload\');" class="input_file" />
-							</dd>
-							<dt>
-								<strong><label for="sameall">', $txt['smileys_add_upload_all'], ':</label></strong>
-							</dt>
-							<dd>
-								<input type="checkbox" name="sameall" id="sameall" checked="checked" class="input_check" onclick="swapUploads(); selectMethod(\'upload\');" />
-							</dd>
-						</dl>
-					</fieldset>
-
-					<dl id="uploadMore" style="display: none;" class="settings">';
-	foreach ($context['smiley_sets'] as $smiley_set)
-		echo '
-						<dt>
-							', $txt['smileys_add_upload_for1'], ' <strong>', $smiley_set['name'], '</strong> ', $txt['smileys_add_upload_for2'], ':
-						</dt>
-						<dd>
-							<input type="file" name="individual_', $smiley_set['name'], '" onchange="selectMethod(\'upload\');" class="input_file" />
-						</dd>';
-	echo '
+						</dd>
 					</dl>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<br />
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['smiley_new'], '</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
+				</fieldset>
+				<fieldset id="ul_settings" style="display: none;">
 					<dl class="settings">
 						<dt>
-							<strong><label for="smiley_code">', $txt['smileys_code'], '</label>: </strong>
+							<strong>', $txt['smileys_add_upload_choose'], ':</strong><br>
+							<span class="smalltext">', $txt['smileys_add_upload_choose_desc'], '</span>
 						</dt>
 						<dd>
-							<input type="text" name="smiley_code" id="smiley_code" value="" class="input_text" />
+							<input type="file" name="uploadSmiley" id="uploadSmiley" onchange="selectMethod(\'upload\');" class="input_file">
 						</dd>
 						<dt>
-							<strong><label for="smiley_description">', $txt['smileys_description'], '</label>: </strong>
+							<strong><label for="sameall">', $txt['smileys_add_upload_all'], ':</label></strong>
 						</dt>
 						<dd>
-							<input type="text" name="smiley_description" id="smiley_description" value="" class="input_text" />
-						</dd>
-						<dt>
-							<strong><label for="smiley_location">', $txt['smileys_location'], '</label>: </strong>
-						</dt>
-						<dd>
-							<select name="smiley_location" id="smiley_location">
-								<option value="0" selected="selected">
-									', $txt['smileys_location_form'], '
-								</option>
-								<option value="1">
-									', $txt['smileys_location_hidden'], '
-								</option>
-								<option value="2">
-									', $txt['smileys_location_popup'], '
-								</option>
-							</select>
+							<input type="checkbox" name="sameall" id="sameall" checked class="input_check" onclick="swapUploads(); selectMethod(\'upload\');">
 						</dd>
 					</dl>
-					<input type="submit" value="', $txt['smileys_save'], '" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
+				</fieldset>
+
+				<dl id="uploadMore" style="display: none;" class="settings">';
+	foreach ($context['smiley_sets'] as $smiley_set)
+		echo '
+					<dt>
+						', $txt['smileys_add_upload_for1'], ' <strong>', $smiley_set['name'], '</strong> ', $txt['smileys_add_upload_for2'], ':
+					</dt>
+					<dd>
+						<input type="file" name="individual_', $smiley_set['name'], '" onchange="selectMethod(\'upload\');" class="input_file">
+					</dd>';
+	echo '
+				</dl>
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['smiley_new'], '</h3>
+			</div>
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<strong><label for="smiley_code">', $txt['smileys_code'], '</label>: </strong>
+					</dt>
+					<dd>
+						<input type="text" name="smiley_code" id="smiley_code" value="" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="smiley_description">', $txt['smileys_description'], '</label>: </strong>
+					</dt>
+					<dd>
+						<input type="text" name="smiley_description" id="smiley_description" value="" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="smiley_location">', $txt['smileys_location'], '</label>: </strong>
+					</dt>
+					<dd>
+						<select name="smiley_location" id="smiley_location">
+							<option value="0" selected>
+								', $txt['smileys_location_form'], '
+							</option>
+							<option value="1">
+								', $txt['smileys_location_hidden'], '
+							</option>
+							<option value="2">
+								', $txt['smileys_location_popup'], '
+							</option>
+						</select>
+					</dd>
+				</dl>
+				<input type="submit" name="smiley_save" value="', $txt['smileys_save'], '" class="button_submit">
+			</div>
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 		</form>
-	</div>
-	<br class="clear" />
-	<script type="text/javascript"><!-- // --><![CDATA[
-
-		function updatePreview()
-		{
-			var currentImage = document.getElementById("preview");
-			currentImage.src = "', $modSettings['smileys_url'], '/" + document.forms.smileyForm.set.value + "/" + document.forms.smileyForm.smiley_filename.value;
-		}
-	// ]]></script>';
+	</div>';
 }
 
 // Ordering smileys.
 function template_setorder()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="admincenter">';
@@ -440,58 +335,51 @@
 			<div class="cat_bar">
 				<h3 class="catbg">', $location['title'], '</h3>
 			</div>
-			<div class="information">
+			<div class="information winfo">
 				', $location['description'], '
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<strong>', empty($context['move_smiley']) ? $txt['smileys_move_select_smiley'] : $txt['smileys_move_select_destination'], '...</strong><br />';
+			<div class="windowbg2">
+				<strong>', empty($context['move_smiley']) ? $txt['smileys_move_select_smiley'] : $txt['smileys_move_select_destination'], '...</strong><br>';
 		foreach ($location['rows'] as $row)
 		{
 			if (!empty($context['move_smiley']))
 				echo '
-					<a href="', $scripturl, '?action=admin;area=smileys;sa=setorder;location=', $location['id'], ';source=', $context['move_smiley'], ';row=', $row[0]['row'], ';reorder=1;', $context['session_var'], '=', $context['session_id'], '"><img src="', $settings['images_url'], '/smiley_select_spot.gif" alt="', $txt['smileys_move_here'], '" /></a>';
+					<a href="', $scripturl, '?action=admin;area=smileys;sa=setorder;location=', $location['id'], ';source=', $context['move_smiley'], ';row=', $row[0]['row'], ';reorder=1;', $context['session_var'], '=', $context['session_id'], '"><span class="generic_icons select_below" title="', $txt['smileys_move_here'], '"></span></a>';
 
 			foreach ($row as $smiley)
 			{
 				if (empty($context['move_smiley']))
-					echo '<a href="', $scripturl, '?action=admin;area=smileys;sa=setorder;move=', $smiley['id'], '"><img src="', $modSettings['smileys_url'], '/', $modSettings['smiley_sets_default'], '/', $smiley['filename'], '" style="padding: 2px; border: 0px solid black;" alt="', $smiley['description'], '" /></a>';
+					echo '<a href="', $scripturl, '?action=admin;area=smileys;sa=setorder;move=', $smiley['id'], '"><img src="', $modSettings['smileys_url'], '/', $modSettings['smiley_sets_default'], '/', $smiley['filename'], '" style="padding: 2px; border: 0px solid black;" alt="', $smiley['description'], '"></a>';
 				else
-					echo '<img src="', $modSettings['smileys_url'], '/', $modSettings['smiley_sets_default'], '/', $smiley['filename'], '" style="padding: 2px; border: ', $smiley['selected'] ? '2px solid red' : '0px solid black', ';" alt="', $smiley['description'], '" /><a href="', $scripturl, '?action=admin;area=smileys;sa=setorder;location=', $location['id'], ';source=', $context['move_smiley'], ';after=', $smiley['id'], ';reorder=1;', $context['session_var'], '=', $context['session_id'], '" title="', $txt['smileys_move_here'], '"><img src="', $settings['images_url'], '/smiley_select_spot.gif" alt="', $txt['smileys_move_here'], '" /></a>';
+					echo '<img src="', $modSettings['smileys_url'], '/', $modSettings['smiley_sets_default'], '/', $smiley['filename'], '" style="padding: 2px;', $smiley['selected'] ? ' border: 2px solid red' : '', ';" alt="', $smiley['description'], '"><a href="', $scripturl, '?action=admin;area=smileys;sa=setorder;location=', $location['id'], ';source=', $context['move_smiley'], ';after=', $smiley['id'], ';reorder=1;', $context['session_var'], '=', $context['session_id'], '" title="', $txt['smileys_move_here'], '"><span class="generic_icons select_below" title="', $txt['smileys_move_here'], '"></span></a>';
 			}
 
 			echo '
-					<br />';
+				<br>';
 		}
 		if (!empty($context['move_smiley']))
 			echo '
-					<a href="', $scripturl, '?action=admin;area=smileys;sa=setorder;location=', $location['id'], ';source=', $context['move_smiley'], ';row=', $location['last_row'], ';reorder=1;', $context['session_var'], '=', $context['session_id'], '"><img src="', $settings['images_url'], '/smiley_select_spot.gif" alt="', $txt['smileys_move_here'], '" /></a>';
+				<a href="', $scripturl, '?action=admin;area=smileys;sa=setorder;location=', $location['id'], ';source=', $context['move_smiley'], ';row=', $location['last_row'], ';reorder=1;', $context['session_var'], '=', $context['session_id'], '"><span class="generic_icons select_below" title="', $txt['smileys_move_here'], '"></span></a>';
 		echo '
-				</div>
-				<span class="botslice"><span></span></span>
 			</div>
-		<input type="hidden" name="reorder" value="1" />
-	</form>
-	<br />';
+		<input type="hidden" name="reorder" value="1">
+	</form>';
 	}
+
 	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Editing Message Icons
 function template_editicons()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
-
 	template_show_list('message_icon_list');
 }
 
 // Editing an individual message icon
 function template_editicon()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
@@ -501,83 +389,77 @@
 					', $context['new_icon'] ? $txt['icons_new_icon'] : $txt['icons_edit_icon'], '
 				</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">';
+			<div class="windowbg2">
+				<dl class="settings">';
 	if (!$context['new_icon'])
 		echo '
-						<dt>
-							<strong>', $txt['smiley_preview'], ': </strong>
-						</dt>
-						<dd>
-							<img src="', $context['icon']['image_url'], '" alt="', $context['icon']['title'], '" />
-						</dd>';
-	echo '
-						<dt>
-							<strong><label for="icon_filename">', $txt['smileys_filename'], '</label>: </strong><br /><span class="smalltext">', $txt['icons_filename_all_gif'], '</span>
-						</dt>
-						<dd>
-							<input type="text" name="icon_filename" id="icon_filename" value="', !empty($context['icon']['filename']) ? $context['icon']['filename'] . '.gif' : '', '" class="input_text" />
-						</dd>
-						<dt>
-							<strong><label for="icon_description">', $txt['smileys_description'], '</label>: </strong>
-						</dt>
-						<dd>
-							<input type="text" name="icon_description" id="icon_description" value="', !empty($context['icon']['title']) ? $context['icon']['title'] : '', '" class="input_text" />
-						</dd>
-						<dt>
-							<strong><label for="icon_board_select">', $txt['icons_board'], '</label>: </strong>
-						</dt>
-						<dd>
-							<select name="icon_board" id="icon_board_select">
-								<option value="0"', empty($context['icon']['board_id']) ? ' selected="selected"' : '', '>', $txt['icons_edit_icons_all_boards'], '</option>';
+					<dt>
+						<strong>', $txt['smiley_preview'], ': </strong>
+					</dt>
+					<dd>
+						<img src="', $context['icon']['image_url'], '" alt="', $context['icon']['title'], '">
+					</dd>';
+	echo '
+					<dt>
+						<strong><label for="icon_filename">', $txt['smileys_filename'], '</label>: </strong><br><span class="smalltext">', $txt['icons_filename_all_png'], '</span>
+					</dt>
+					<dd>
+						<input type="text" name="icon_filename" id="icon_filename" value="', !empty($context['icon']['filename']) ? $context['icon']['filename'] . '.png' : '', '" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="icon_description">', $txt['smileys_description'], '</label>: </strong>
+					</dt>
+					<dd>
+						<input type="text" name="icon_description" id="icon_description" value="', !empty($context['icon']['title']) ? $context['icon']['title'] : '', '" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="icon_board_select">', $txt['icons_board'], '</label>: </strong>
+					</dt>
+					<dd>
+						<select name="icon_board" id="icon_board_select">
+							<option value="0"', empty($context['icon']['board_id']) ? ' selected' : '', '>', $txt['icons_edit_icons_all_boards'], '</option>';
 
 	foreach ($context['categories'] as $category)
 	{
 		echo '
-								<optgroup label="', $category['name'], '">';
+							<optgroup label="', $category['name'], '">';
 		foreach ($category['boards'] as $board)
 			echo '
-									<option value="', $board['id'], '"', $board['selected'] ? ' selected="selected"' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level'] - 1) . '=&gt;' : '', ' ', $board['name'], '</option>';
+								<option value="', $board['id'], '"', $board['selected'] ? ' selected' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level'] - 1) . '=&gt;' : '', ' ', $board['name'], '</option>';
 		echo '
-								</optgroup>';
+							</optgroup>';
 	}
 	echo '
-							</select>
-						</dd>
-						<dt>
-							<strong><label for="icon_location">', $txt['smileys_location'], '</label>: </strong>
-						</dt>
-						<dd>
-							<select name="icon_location" id="icon_location">
-								<option value="0"', empty($context['icon']['after']) ? ' selected="selected"' : '', '>', $txt['icons_location_first_icon'], '</option>';
+						</select>
+					</dd>
+					<dt>
+						<strong><label for="icon_location">', $txt['smileys_location'], '</label>: </strong>
+					</dt>
+					<dd>
+						<select name="icon_location" id="icon_location">
+							<option value="0"', empty($context['icon']['after']) ? ' selected' : '', '>', $txt['icons_location_first_icon'], '</option>';
 
 	// Print the list of all the icons it can be put after...
 	foreach ($context['icons'] as $id => $data)
 		if (empty($context['icon']['id']) || $id != $context['icon']['id'])
 			echo '
-								<option value="', $id, '"', !empty($context['icon']['after']) && $id == $context['icon']['after'] ? ' selected="selected"' : '', '>', $txt['icons_location_after'], ': ', $data['title'], '</option>';
+							<option value="', $id, '"', !empty($context['icon']['after']) && $id == $context['icon']['after'] ? ' selected' : '', '>', $txt['icons_location_after'], ': ', $data['title'], '</option>';
 
 	echo '
-							</select>
-						</dd>
-					</dl>';
+						</select>
+					</dd>
+				</dl>';
 
 	if (!$context['new_icon'])
 		echo '
-					<input type="hidden" name="icon" value="', $context['icon']['id'], '" />';
+				<input type="hidden" name="icon" value="', $context['icon']['id'], '">';
 
 	echo '
-
-					<input type="submit" value="', $txt['smileys_save'], '" class="button_submit" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</div>
-				<span class="botslice"><span></span></span>
+				<input type="submit" name="icons_save" value="', $txt['smileys_save'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Memberlist.template.php b/Themes/default/Memberlist.template.php
--- a/Themes/default/Memberlist.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Memberlist.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,63 +3,56 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Displays a sortable listing of all members registered on the forum.
 function template_main()
 {
-	global $context, $settings, $options, $scripturl, $txt;
-
-	// Build the memberlist button array.
-	$memberlist_buttons = array(
-			'view_all_members' => array('text' => 'view_all_members', 'image' => 'mlist.gif', 'lang' => true, 'url' => $scripturl . '?action=mlist' . ';sa=all', 'active'=> true),
-			'mlist_search' => array('text' => 'mlist_search', 'image' => 'mlist.gif', 'lang' => true, 'url' => $scripturl . '?action=mlist' . ';sa=search'),
-		);
+	global $context, $settings, $scripturl, $txt;
 
 	echo '
 	<div class="main_section" id="memberlist">
+		<div class="pagesection">
+			', template_button_strip($context['memberlist_buttons'], 'right'), '
+			<div class="pagelinks floatleft">', $context['page_index'], '</div>
+		</div>
 		<div class="cat_bar">
-			<h4 class="catbg">
+			<h3 class="catbg">
 				<span class="floatleft">', $txt['members_list'], '</span>';
 		if (!isset($context['old_search']))
 				echo '
 				<span class="floatright">', $context['letter_links'], '</span>';
 		echo '
-			</h4>
-		</div>
-		<div class="pagesection">
-			', template_button_strip($memberlist_buttons, 'right'), '
-			<div class="pagelinks floatleft">', $txt['pages'], ': ', $context['page_index'], '</div>
+			</h3>
 		</div>';
 
 	echo '
-		<div id="mlist" class="tborder topic_table">
-			<table class="table_grid" cellspacing="0" width="100%">
+		<div id="mlist">
+			<table class="table_grid">
 			<thead>
-				<tr class="catbg">';
+				<tr class="title_bar">';
 
 	// Display each of the column headers of the table.
-	foreach ($context['columns'] as $column)
+	foreach ($context['columns'] as $key => $column)
 	{
-		// We're not able (through the template) to sort the search results right now...
-		if (isset($context['old_search']))
-			echo '
-					<th scope="col" class="', isset($column['class']) ? ' ' . $column['class'] : '', '"', isset($column['width']) ? ' width="' . $column['width'] . '"' : '', isset($column['colspan']) ? ' colspan="' . $column['colspan'] . '"' : '', '>
-						', $column['label'], '</th>';
+		// @TODO maybe find something nicer?
+		if ($key == 'email_address' && !$context['can_send_email'])
+			continue;
+
 		// This is a selected column, so underline it or some such.
-		elseif ($column['selected'])
+		if ($column['selected'])
 			echo '
-					<th scope="col" class="', isset($column['class']) ? ' ' . $column['class'] : '', '" style="width: auto;"' . (isset($column['colspan']) ? ' colspan="' . $column['colspan'] . '"' : '') . ' nowrap="nowrap">
-						<a href="' . $column['href'] . '" rel="nofollow">' . $column['label'] . ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" /></a></th>';
+					<th scope="col" class="', $key, isset($column['class']) ? ' ' . $column['class'] : '', ' selected" style="width: auto;"' . (isset($column['colspan']) ? ' colspan="' . $column['colspan'] . '"' : '') . '>
+						<a href="' . $column['href'] . '" rel="nofollow">' . $column['label'] . '</a><span class="generic_icons sort_' . $context['sort_direction'] . '"></span></th>';
 		// This is just some column... show the link and be done with it.
 		else
 			echo '
-					<th scope="col" class="', isset($column['class']) ? ' ' . $column['class'] : '', '"', isset($column['width']) ? ' width="' . $column['width'] . '"' : '', isset($column['colspan']) ? ' colspan="' . $column['colspan'] . '"' : '', '>
+					<th scope="col" class="', $key, isset($column['class']) ? ' ' . $column['class'] : '', '"', isset($column['width']) ? ' style="width: ' . $column['width'] . '"' : '', isset($column['colspan']) ? ' colspan="' . $column['colspan'] . '"' : '', '>
 						', $column['link'], '</th>';
 	}
 	echo '
@@ -73,47 +66,26 @@
 		foreach ($context['members'] as $member)
 		{
 			echo '
-				<tr ', empty($member['sort_letter']) ? '' : ' id="letter' . $member['sort_letter'] . '"', '>
-					<td class="windowbg2">
-						', $context['can_send_pm'] ? '<a href="' . $member['online']['href'] . '" title="' . $member['online']['text'] . '">' : '', $settings['use_image_buttons'] ? '<img src="' . $member['online']['image_href'] . '" alt="' . $member['online']['text'] . '" align="middle" />' : $member['online']['label'], $context['can_send_pm'] ? '</a>' : '', '
+				<tr class="windowbg"', empty($member['sort_letter']) ? '' : ' id="letter' . $member['sort_letter'] . '"', '>
+					<td>
+						', $context['can_send_pm'] ? '<a href="' . $member['online']['href'] . '" title="' . $member['online']['text'] . '">' : '', $settings['use_image_buttons'] ? '<span class="' . ($member['online']['is_online'] == 1 ? 'on' : 'off') . '" title="' . $member['online']['text'] . '"></span>' : $member['online']['label'], $context['can_send_pm'] ? '</a>' : '', '
 					</td>
-					<td class="windowbg lefttext">', $member['link'], '</td>
-					<td class="windowbg2">', $member['show_email'] == 'no' ? '' : '<a href="' . $scripturl . '?action=emailuser;sa=email;uid=' . $member['id'] . '" rel="nofollow"><img src="' . $settings['images_url'] . '/email_sm.gif" alt="' . $txt['email'] . '" title="' . $txt['email'] . ' ' . $member['name'] . '" /></a>', '</td>';
+					<td class="lefttext">', $member['link'], '</td>';
 
 		if (!isset($context['disabled_fields']['website']))
 			echo '
-					<td class="windowbg">', $member['website']['url'] != '' ? '<a href="' . $member['website']['url'] . '" target="_blank" class="new_win"><img src="' . $settings['images_url'] . '/www.gif" alt="' . $member['website']['title'] . '" title="' . $member['website']['title'] . '" /></a>' : '', '</td>';
-
-		// ICQ?
-		if (!isset($context['disabled_fields']['icq']))
-			echo '
-					<td class="windowbg2">', $member['icq']['link'], '</td>';
-
-		// AIM?
-		if (!isset($context['disabled_fields']['aim']))
-			echo '
-					<td class="windowbg2">', $member['aim']['link'], '</td>';
-
-		// YIM?
-		if (!isset($context['disabled_fields']['yim']))
-			echo '
-					<td class="windowbg2">', $member['yim']['link'], '</td>';
-
-		// MSN?
-		if (!isset($context['disabled_fields']['msn']))
-			echo '
-					<td class="windowbg2">', $member['msn']['link'], '</td>';
+					<td class="centertext website_url">', $member['website']['url'] != '' ? '<a href="' . $member['website']['url'] . '" target="_blank" class="new_win"><span class="generic_icons www" title="' . $member['website']['title'] . '"></span></a>' : '', '</td>';
 
 		// Group and date.
 		echo '
-					<td class="windowbg lefttext">', empty($member['group']) ? $member['post_group'] : $member['group'], '</td>
-					<td class="windowbg lefttext">', $member['registered_date'], '</td>';
+					<td class="lefttext reg_group">', empty($member['group']) ? $member['post_group'] : $member['group'], '</td>
+					<td class="lefttext reg_date">', $member['registered_date'], '</td>';
 
 		if (!isset($context['disabled_fields']['posts']))
 		{
 			echo '
-					<td class="windowbg2" style="white-space: nowrap" width="15">', $member['posts'], '</td>
-					<td class="windowbg statsbar" width="120">';
+					<td style="white-space: nowrap; width: 15px">', $member['posts'], '</td>
+					<td class="statsbar" style="width: 120px">';
 
 			if (!empty($member['post_percent']))
 				echo '
@@ -125,6 +97,14 @@
 					</td>';
 		}
 
+		// Show custom fields marked to be shown here
+		if (!empty($context['custom_profile_fields']['columns']))
+		{
+			foreach ($context['custom_profile_fields']['columns'] as $key => $column)
+				echo '
+					<td class="lefttext">', $member['options'][$key], '</td>';
+		}
+
 		echo '
 				</tr>';
 		}
@@ -136,22 +116,20 @@
 					<td colspan="', $context['colspan'], '" class="windowbg">', $txt['search_no_results'], '</td>
 				</tr>';
 
-	// Show the page numbers again. (makes 'em easier to find!)
-	echo '
+				echo '
 			</tbody>
 			</table>
 		</div>';
 
+	// Show the page numbers again. (makes 'em easier to find!)
 	echo '
 		<div class="pagesection">
-			<div class="pagelinks floatleft">', $txt['pages'], ': ', $context['page_index'], '</div>';
+			<div class="pagelinks floatleft">', $context['page_index'], '</div>';
 
 	// If it is displaying the result of a search show a "search again" link to edit their criteria.
 	if (isset($context['old_search']))
 		echo '
-			<div class="floatright">
-				<a href="', $scripturl, '?action=mlist;sa=search;search=', $context['old_search_value'], '">', $txt['mlist_search_again'], '</a>
-			</div>';
+			<a class="button_link" href="', $scripturl, '?action=mlist;sa=search;search=', $context['old_search_value'], '">', $txt['mlist_search_again'], '</a>';
 	echo '
 		</div>
 	</div>';
@@ -161,53 +139,47 @@
 // A page allowing people to search the member list.
 function template_search()
 {
-	global $context, $settings, $options, $scripturl, $txt;
-
-	// Build the memberlist button array.
-	$memberlist_buttons = array(
-			'view_all_members' => array('text' => 'view_all_members', 'image' => 'mlist.gif', 'lang' => true, 'url' => $scripturl . '?action=mlist' . ';sa=all'),
-			'mlist_search' => array('text' => 'mlist_search', 'image' => 'mlist.gif', 'lang' => true, 'url' => $scripturl . '?action=mlist' . ';sa=search', 'active' => true),
-		);
+	global $context, $scripturl, $txt;
 
 	// Start the submission form for the search!
 	echo '
 	<form action="', $scripturl, '?action=mlist;sa=search" method="post" accept-charset="', $context['character_set'], '">
 		<div id="memberlist">
+			<div class="pagesection">
+				', template_button_strip($context['memberlist_buttons'], 'right'), '
+			</div>
 			<div class="cat_bar">
 				<h3 class="catbg mlist">
-					<span class="ie6_header floatleft">', !empty($settings['use_buttons']) ? '<img src="' . $settings['images_url'] . '/buttons/search.gif" alt="" class="icon" />' : '', $txt['mlist_search'], '</span>
+					<span class="generic_icons filter"></span>', $txt['mlist_search'], '
 				</h3>
 			</div>
-			<div class="pagesection">
-				', template_button_strip($memberlist_buttons, 'right'), '
-			</div>';
-	// Display the input boxes for the form.
-	echo '	<div id="memberlist_search" class="clear">
-				<span class="upperframe"><span></span></span>
+			<div id="memberlist_search" class="clear">
 				<div class="roundframe">
-					<div id="mlist_search" class="flow_hidden">
-						<div id="search_term_input"><br />
-							<strong>', $txt['search_for'], ':</strong>
-							<input type="text" name="search" value="', $context['old_search'], '" size="35" class="input_text" /> <input type="submit" name="submit" value="' . $txt['search'] . '" class="button_submit" />
-						</div>
-						<span class="floatleft">';
+					<dl id="mlist_search" class="settings">
+						<dt>
+							<label><strong>', $txt['search_for'], ':</strong></label>
+						</dt>
+						<dd>
+							<input type="text" name="search" value="', $context['old_search'], '" size="40" class="input_text">
+						</dd>
+						<dt>
+							<label><strong>', $txt['mlist_search_filter'], ':</strong></label>
+						</dt>';
 
-	$count = 0;
 	foreach ($context['search_fields'] as $id => $title)
 	{
 		echo '
-							<label for="fields-', $id, '"><input type="checkbox" name="fields[]" id="fields-', $id, '" value="', $id, '" ', in_array($id, $context['search_defaults']) ? 'checked="checked"' : '', ' class="input_check" />', $title, '</label><br />';
-	// Half way through?
-		if (round(count($context['search_fields']) / 2) == ++$count)
-			echo '
-						</span>
-						<span class="floatleft">';
+						<dd>
+							<label for="fields-', $id, '"><input type="checkbox" name="fields[]" id="fields-', $id, '" value="', $id, '"', in_array($id, $context['search_defaults']) ? ' checked' : '', ' class="input_check floatright">', $title, '</label>
+						</dd>';
 	}
-		echo '
-						</span>
+
+	echo '
+					</dl>
+					<div class="flow_auto">
+						<input type="submit" name="submit" value="' . $txt['search'] . '" class="button_submit">
 					</div>
 				</div>
-				<span class="lowerframe"><span></span></span>
 			</div>
 		</div>
 	</form>';
diff -ru a/Themes/default/MessageIndex.template.php b/Themes/default/MessageIndex.template.php
--- a/Themes/default/MessageIndex.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/MessageIndex.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,56 +3,36 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_main()
 {
 	global $context, $settings, $options, $scripturl, $modSettings, $txt;
 
-	echo '
-	<a id="top"></a>';
-
 	if (!empty($context['boards']) && (!empty($options['show_children']) || $context['start'] == 0))
 	{
 		echo '
-	<div class="tborder childboards" id="board_', $context['current_board'], '_childboards">
+	<div id="board_', $context['current_board'], '_childboards" class="boardindex_table">
 		<div class="cat_bar">
-			<h3 class="catbg">', $txt['parent_boards'], '</h3>
-		</div>
-		<div class="table_frame">
-			<table class="table_list">
-				<tbody id="board_', $context['current_board'], '_children" class="content">';
+			<h3 class="catbg">', $txt['sub_boards'], '</h3>
+		</div>';
 
 		foreach ($context['boards'] as $board)
 		{
 			echo '
-				<tr id="board_', $board['id'], '" class="windowbg2">
-					<td class="icon windowbg"', !empty($board['children']) ? ' rowspan="2"' : '', '>
-						<a href="', ($board['is_redirect'] || $context['user']['is_guest'] ? $board['href'] : $scripturl . '?action=unread;board=' . $board['id'] . '.0;children'), '">';
-
-			// If the board or children is new, show an indicator.
-			if ($board['new'] || $board['children_new'])
-				echo '
-							<img src="', $settings['images_url'], '/' .$context['theme_variant_url'], 'on', $board['new'] ? '' : '2', '.png" alt="', $txt['new_posts'], '" title="', $txt['new_posts'], '" />';
-			// Is it a redirection board?
-			elseif ($board['is_redirect'])
-				echo '
-							<img src="', $settings['images_url'], '/' .$context['theme_variant_url'], 'redirect.png" alt="*" title="*" />';
-			// No new posts at all! The agony!!
-			else
-				echo '
-							<img src="', $settings['images_url'], '/' .$context['theme_variant_url'], 'off.png" alt="', $txt['old_posts'], '" title="', $txt['old_posts'], '" />';
-
-			echo '
+				<div id="board_', $board['id'], '" class="up_contain">
+					<div class="icon">
+						<a href="', ($board['is_redirect'] || $context['user']['is_guest'] ? $board['href'] : $scripturl . '?action=unread;board=' . $board['id'] . '.0;children'), '">
+							<span class="board_', $board['board_class'], '"', !empty($board['board_tooltip']) ? ' title="' . $board['board_tooltip'] . '"' : '', '></span>
 						</a>
-					</td>
-					<td class="info">
-						<a class="subject" href="', $board['href'], '" name="b', $board['id'], '">', $board['name'], '</a>';
+					</div>
+					<div class="info">
+						<a class="subject" href="', $board['href'], '" id="b', $board['id'], '">', $board['name'], '</a>';
 
 			// Has it outstanding posts for approval?
 			if ($board['can_approve_posts'] && ($board['unapproved_posts'] || $board['unapproved_topics']))
@@ -60,38 +40,28 @@
 						<a href="', $scripturl, '?action=moderate;area=postmod;sa=', ($board['unapproved_topics'] > 0 ? 'topics' : 'posts'), ';brd=', $board['id'], ';', $context['session_var'], '=', $context['session_id'], '" title="', sprintf($txt['unapproved_posts'], $board['unapproved_topics'], $board['unapproved_posts']), '" class="moderation_link">(!)</a>';
 
 			echo '
-
 						<p>', $board['description'] , '</p>';
 
 			// Show the "Moderators: ". Each has name, href, link, and id. (but we're gonna use link_moderators.)
-			if (!empty($board['moderators']))
+			if (!empty($board['moderators']) || !empty($board['moderator_groups']))
 				echo '
-						<p class="moderators">', count($board['moderators']) === 1 ? $txt['moderator'] : $txt['moderators'], ': ', implode(', ', $board['link_moderators']), '</p>';
+						<p class="moderators">', count($board['link_moderators']) === 1 ? $txt['moderator'] : $txt['moderators'], ': ', implode(', ', $board['link_moderators']), '</p>';
 
 			// Show some basic information about the number of posts, etc.
 			echo '
-					</td>
-					<td class="stats windowbg">
-						<p>', comma_format($board['posts']), ' ', $board['is_redirect'] ? $txt['redirects'] : $txt['posts'], ' <br />
+					</div>
+					<div class="stats">
+						<p>', comma_format($board['posts']), ' ', $board['is_redirect'] ? $txt['redirects'] : $txt['posts'], ' <br>
 						', $board['is_redirect'] ? '' : comma_format($board['topics']) . ' ' . $txt['board_topics'], '
 						</p>
-					</td>
-					<td class="lastpost">';
+					</div>
+					<div class="lastpost">';
 
-			/* The board's and children's 'last_post's have:
-			time, timestamp (a number that represents the time.), id (of the post), topic (topic id.),
-			link, href, subject, start (where they should go for the first unread post.),
-			and member. (which has id, name, link, href, username in it.) */
 			if (!empty($board['last_post']['id']))
 				echo '
-						<p><strong>', $txt['last_post'], '</strong>  ', $txt['by'], ' ', $board['last_post']['member']['link'], '<br />
-						', $txt['in'], ' ', $board['last_post']['link'], '<br />
-						', $txt['on'], ' ', $board['last_post']['time'],'
-						</p>';
-
+						<p>', $board['last_post']['last_post_message'], '</p>';
 			echo '
-					</td>
-				</tr>';
+					</div>';
 
 			// Show the "Child Boards: ". (there's a link_children but we're going to bold the new ones...)
 			if (!empty($board['children']))
@@ -103,7 +73,7 @@
 				foreach ($board['children'] as $child)
 				{
 					if (!$child['is_redirect'])
-						$child['link'] = '<a href="' . $child['href'] . '" ' . ($child['new'] ? 'class="new_posts" ' : '') . 'title="' . ($child['new'] ? $txt['new_posts'] : $txt['old_posts']) . ' (' . $txt['board_topics'] . ': ' . comma_format($child['topics']) . ', ' . $txt['posts'] . ': ' . comma_format($child['posts']) . ')">' . $child['name'] . ($child['new'] ? '</a> <a href="' . $scripturl . '?action=unread;board=' . $child['id'] . '" title="' . $txt['new_posts'] . ' (' . $txt['board_topics'] . ': ' . comma_format($child['topics']) . ', ' . $txt['posts'] . ': ' . comma_format($child['posts']) . ')"><img src="' . $settings['lang_images_url'] . '/new.gif" class="new_posts" alt="" />' : '') . '</a>';
+						$child['link'] = '<a href="' . $child['href'] . '" ' . ($child['new'] ? 'class="board_new_posts" ' : '') . 'title="' . ($child['new'] ? $txt['new_posts'] : $txt['old_posts']) . ' (' . $txt['board_topics'] . ': ' . comma_format($child['topics']) . ', ' . $txt['posts'] . ': ' . comma_format($child['posts']) . ')">' . $child['name'] . ($child['new'] ? '</a> <a  ' . ($child['new'] ? 'class="new_posts" ' : '') . 'href="' . $scripturl . '?action=unread;board=' . $child['id'] . '" title="' . $txt['new_posts'] . ' (' . $txt['board_topics'] . ': ' . comma_format($child['topics']) . ', ' . $txt['posts'] . ': ' . comma_format($child['posts']) . ')"><span class="new_posts">' . $txt['new'] . '</span>' : '') . '</a>';
 					else
 						$child['link'] = '<a href="' . $child['href'] . '" title="' . comma_format($child['posts']) . ' ' . $txt['redirects'] . '">' . $child['name'] . '</a>';
 
@@ -113,295 +83,321 @@
 
 					$children[] = $child['new'] ? '<strong>' . $child['link'] . '</strong>' : $child['link'];
 				}
-				echo '
-				<tr id="board_', $board['id'], '_children"><td colspan="3" class="children windowbg"><strong>', $txt['parent_boards'], '</strong>: ', implode(', ', $children), '</td></tr>';
+
+			echo '
+				<div id="board_', $board['id'], '_children" class="children">
+					<p><strong>', $txt['sub_boards'], '</strong>: ', implode(', ', $children), '</p>
+				</div>';
 			}
+
+			echo '
+				</div>';
 		}
 		echo '
-				</tbody>
-			</table>
-		</div>
 	</div>';
 	}
 
-	if (!empty($options['show_board_desc']) && $context['description'] != '')
-		echo '
-	<p class="description_board">', $context['description'], '</p>';
-
-	// Create the button set...
-	$normal_buttons = array(
-		'new_topic' => array('test' => 'can_post_new', 'text' => 'new_topic', 'image' => 'new_topic.gif', 'lang' => true, 'url' => $scripturl . '?action=post;board=' . $context['current_board'] . '.0', 'active' => true),
-		'post_poll' => array('test' => 'can_post_poll', 'text' => 'new_poll', 'image' => 'new_poll.gif', 'lang' => true, 'url' => $scripturl . '?action=post;board=' . $context['current_board'] . '.0;poll'),
-		'notify' => array('test' => 'can_mark_notify', 'text' => $context['is_marked_notify'] ? 'unnotify' : 'notify', 'image' => ($context['is_marked_notify'] ? 'un' : ''). 'notify.gif', 'lang' => true, 'custom' => 'onclick="return confirm(\'' . ($context['is_marked_notify'] ? $txt['notification_disable_board'] : $txt['notification_enable_board']) . '\');"', 'url' => $scripturl . '?action=notifyboard;sa=' . ($context['is_marked_notify'] ? 'off' : 'on') . ';board=' . $context['current_board'] . '.' . $context['start'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-		'markread' => array('text' => 'mark_read_short', 'image' => 'markread.gif', 'lang' => true, 'url' => $scripturl . '?action=markasread;sa=board;board=' . $context['current_board'] . '.0;' . $context['session_var'] . '=' . $context['session_id']),
-	);
-
 	// They can only mark read if they are logged in and it's enabled!
-	if (!$context['user']['is_logged'] || !$settings['show_mark_read'])
-		unset($normal_buttons['markread']);
-
-	// Allow adding new buttons easily.
-	call_integration_hook('integrate_messageindex_buttons', array(&$normal_buttons));
+	if (!$context['user']['is_logged'])
+		unset($context['normal_buttons']['markread']);
 
 	if (!$context['no_topic_listing'])
 	{
 		echo '
 	<div class="pagesection">
-		<div class="pagelinks floatleft">', $txt['pages'], ': ', $context['page_index'], !empty($modSettings['topbottomEnable']) ? $context['menu_separator'] . '&nbsp;&nbsp;<a href="#bot"><strong>' . $txt['go_down'] . '</strong></a>' : '', '</div>
-		', template_button_strip($normal_buttons, 'right'), '
+		', $context['menu_separator'], '<a href="#bot" class="topbottom floatleft">', $txt['go_down'], '</a>
+		<div class="pagelinks floatleft">', $context['page_index'], '</div>
+		', template_button_strip($context['normal_buttons'], 'right'), '
 	</div>';
 
+	if ($context['description'] != '' || !empty($context['moderators']))
+		{
+		echo '
+	<div id="description_board" class="generic_list_wrapper">
+		<h3 class="floatleft">', $context['name'], '&nbsp;-&nbsp;</h3>
+		<p>';
+	if ($context['description'] != '')
+	echo '
+		', $context['description'], '&nbsp;';
+
+	if (!empty($context['moderators']))
+	echo '
+		', count($context['moderators']) === 1 ? $txt['moderator'] : $txt['moderators'], ': ', implode(', ', $context['link_moderators']), '.';
+
+	echo '
+		</p>
+	</div>';
+		}
+
 		// If Quick Moderation is enabled start the form.
 		if (!empty($context['can_quick_mod']) && $options['display_quick_mod'] > 0 && !empty($context['topics']))
 			echo '
 	<form action="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], '" method="post" accept-charset="', $context['character_set'], '" class="clear" name="quickModForm" id="quickModForm">';
 
 		echo '
-	<div class="tborder topic_table" id="messageindex">
-		<table class="table_grid" cellspacing="0">
-			<thead>
-				<tr class="catbg">';
+		<div id="messageindex">';
+		if (!empty($settings['display_who_viewing']))
+		{
+		echo '
+			<div class="information">';
+			if ($settings['display_who_viewing'] == 1)
+				echo count($context['view_members']), ' ', count($context['view_members']) === 1 ? $txt['who_member'] : $txt['members'];
+		else
+				echo empty($context['view_members_list']) ? '0 ' . $txt['members'] : implode(', ', $context['view_members_list']) . (empty($context['view_num_hidden']) || $context['can_moderate_forum'] ? '' : ' (+ ' . $context['view_num_hidden'] . ' ' . $txt['hidden'] . ')');
+			echo $txt['who_and'], $context['view_num_guests'], ' ', $context['view_num_guests'] == 1 ? $txt['guest'] : $txt['guests'], $txt['who_viewing_board'];
+
+		echo '
+			</div>';
+		}
+	echo '
+		<div class="title_bar" id="topic_header">';
 
 		// Are there actually any topics to show?
 		if (!empty($context['topics']))
 		{
 			echo '
-					<th scope="col" class="first_th" width="8%" colspan="2">&nbsp;</th>
-					<th scope="col" class="lefttext"><a href="', $scripturl, '?board=', $context['current_board'], '.', $context['start'], ';sort=subject', $context['sort_by'] == 'subject' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['subject'], $context['sort_by'] == 'subject' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a> / <a href="', $scripturl, '?board=', $context['current_board'], '.', $context['start'], ';sort=starter', $context['sort_by'] == 'starter' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['started_by'], $context['sort_by'] == 'starter' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>
-					<th scope="col" width="14%"><a href="', $scripturl, '?board=', $context['current_board'], '.', $context['start'], ';sort=replies', $context['sort_by'] == 'replies' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['replies'], $context['sort_by'] == 'replies' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a> / <a href="', $scripturl, '?board=', $context['current_board'], '.', $context['start'], ';sort=views', $context['sort_by'] == 'views' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['views'], $context['sort_by'] == 'views' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>';
-			// Show a "select all" box for quick moderation?
-			if (empty($context['can_quick_mod']))
-				echo '
-					<th scope="col" class="lefttext last_th" width="22%"><a href="', $scripturl, '?board=', $context['current_board'], '.', $context['start'], ';sort=last_post', $context['sort_by'] == 'last_post' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['last_post'], $context['sort_by'] == 'last_post' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>';
-			else
-				echo '
-					<th scope="col" class="lefttext" width="22%"><a href="', $scripturl, '?board=', $context['current_board'], '.', $context['start'], ';sort=last_post', $context['sort_by'] == 'last_post' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['last_post'], $context['sort_by'] == 'last_post' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>';
+					<div class="icon">&nbsp;</div>
+					<div class="info">', $context['topics_headers']['subject'], ' / ', $context['topics_headers']['starter'], '</div>
+					<div class="stats">', $context['topics_headers']['replies'], ' / ', $context['topics_headers']['views'], '</div>
+					<div class="lastpost">', $context['topics_headers']['last_post'], '</div>';
 
 			// Show a "select all" box for quick moderation?
 			if (!empty($context['can_quick_mod']) && $options['display_quick_mod'] == 1)
 				echo '
-					<th scope="col" class="last_th" width="24"><input type="checkbox" onclick="invertAll(this, this.form, \'topics[]\');" class="input_check" /></th>';
+					<div class="moderation"><input type="checkbox" onclick="invertAll(this, this.form, \'topics[]\');" class="input_check"></div>';
 
 			// If it's on in "image" mode, don't show anything but the column.
 			elseif (!empty($context['can_quick_mod']))
 				echo '
-					<th class="last_th" width="4%">&nbsp;</th>';
+					<div class="moderation">&nbsp;</div>';
 		}
 		// No topics.... just say, "sorry bub".
 		else
 			echo '
-					<th scope="col" class="first_th" width="8%">&nbsp;</th>
-					<th colspan="3"><strong>', $txt['msg_alert_none'], '</strong></th>
-					<th scope="col" class="last_th" width="8%">&nbsp;</th>';
+					<h3 class="titlebg">', $txt['topic_alert_none'], '</h3>';
 
 		echo '
-				</tr>
-			</thead>
-			<tbody>';
-
-		if (!empty($settings['display_who_viewing']))
-		{
-			echo '
-				<tr class="windowbg2 whos_viewing">
-					<td colspan="', !empty($context['can_quick_mod']) ? '6' : '5', '" class="smalltext">';
-			if ($settings['display_who_viewing'] == 1)
-				echo count($context['view_members']), ' ', count($context['view_members']) === 1 ? $txt['who_member'] : $txt['members'];
-			else
-				echo empty($context['view_members_list']) ? '0 ' . $txt['members'] : implode(', ', $context['view_members_list']) . ((empty($context['view_num_hidden']) or $context['can_moderate_forum']) ? '' : ' (+ ' . $context['view_num_hidden'] . ' ' . $txt['hidden'] . ')');
-			echo $txt['who_and'], $context['view_num_guests'], ' ', $context['view_num_guests'] == 1 ? $txt['guest'] : $txt['guests'], $txt['who_viewing_board'], '
-					</td>
-				</tr>';
-		}
+		</div>';
 
 		// If this person can approve items and we have some awaiting approval tell them.
 		if (!empty($context['unapproved_posts_message']))
 		{
 			echo '
-				<tr class="windowbg2">
-					<td colspan="', !empty($context['can_quick_mod']) ? '6' : '5', '">
-						<span class="alert">!</span> ', $context['unapproved_posts_message'], '
-					</td>
-				</tr>';
+				<div class="information">
+					<span class="alert">!</span> ', $context['unapproved_posts_message'], '
+				</div>';
 		}
 
+		// Contain the topic list
+		echo '
+			<div id="topic_container">';
+
 		foreach ($context['topics'] as $topic)
 		{
+			$color_class = 'windowbg';
+
 			// Is this topic pending approval, or does it have any posts pending approval?
 			if ($context['can_approve_posts'] && $topic['unapproved_posts'])
-				$color_class = !$topic['approved'] ? 'approvetbg' : 'approvebg';
-			// We start with locked and sticky topics.
-			elseif ($topic['is_sticky'] && $topic['is_locked'])
-				$color_class = 'stickybg locked_sticky';
+				$color_class = (!$topic['approved'] ? 'approvetopic ' : 'approvepost ') . $color_class;
+
 			// Sticky topics should get a different color, too.
-			elseif ($topic['is_sticky'])
-				$color_class = 'stickybg';
+			if ($topic['is_sticky'])
+				$color_class = 'sticky ' . $color_class;
 			// Locked topics get special treatment as well.
-			elseif ($topic['is_locked'])
-				$color_class = 'lockedbg';
-			// Last, but not least: regular topics.
-			else
-				$color_class = 'windowbg';
+			if ($topic['is_locked'])
+				$color_class = 'locked ' . $color_class;
 
 			// Some columns require a different shade of the color class.
 			$alternate_class = $color_class . '2';
 
 			echo '
-				<tr>
-					<td class="icon1 ', $color_class, '">
-						<img src="', $settings['images_url'], '/topic/', $topic['class'], '.gif" alt="" />
-					</td>
-					<td class="icon2 ', $color_class, '">
-						<img src="', $topic['first_post']['icon_url'], '" alt="" />
-					</td>
-					<td class="subject ', $alternate_class, '">
-						<div ', (!empty($topic['quick_mod']['modify']) ? 'id="topic_' . $topic['first_post']['id'] . '" onmouseout="mouse_on_div = 0;" onmouseover="mouse_on_div = 1;" ondblclick="modify_topic(\'' . $topic['id'] . '\', \'' . $topic['first_post']['id'] . '\');"' : ''), '>
-							', $topic['is_sticky'] ? '<strong>' : '', '<span id="msg_' . $topic['first_post']['id'] . '">', $topic['first_post']['link'], (!$context['can_approve_posts'] && !$topic['approved'] ? '&nbsp;<em>(' . $txt['awaiting_approval'] . ')</em>' : ''), '</span>', $topic['is_sticky'] ? '</strong>' : '';
+			<div class="', $color_class, '">
+				<div class="icon">
+					<img src="', $topic['first_post']['icon_url'], '" alt="">
+					', $topic['is_posted_in'] ? '<img class="posted" src="' . $settings['images_url'] . '/icons/profile_sm.png" alt="">' : '', '
+				</div>
+					<div class="info">
+						<div ', (!empty($topic['quick_mod']['modify']) ? 'id="topic_' . $topic['first_post']['id'] . '"  ondblclick="oQuickModifyTopic.modify_topic(\'' . $topic['id'] . '\', \'' . $topic['first_post']['id'] . '\');"' : ''), '>';
 
-			// Is this topic new? (assuming they are logged in!)
-			if ($topic['new'] && $context['user']['is_logged'])
-					echo '
-							<a href="', $topic['new_href'], '" id="newicon' . $topic['first_post']['id'] . '"><img src="', $settings['lang_images_url'], '/new.gif" alt="', $txt['new'], '" /></a>';
+			// Now we handle the icons
+			echo '
+							<div class="icons">';
+			if ($topic['is_watched'])
+				echo '
+								<span class="generic_icons watch floatright" title="', $txt['watching_this_topic'], '"></span>';
+			if ($topic['is_locked'])
+				echo '
+								<span class="generic_icons lock floatright"></span>';
+			if ($topic['is_sticky'])
+				echo '
+								<span class="generic_icons sticky floatright"></span>';
+			if ($topic['is_redirect'])
+				echo '
+								<span class="generic_icons move floatright"></span>';
+			if ($topic['is_poll'])
+				echo '
+								<span class="generic_icons poll floatright"></span>';
+			echo '
+							</div>';
 
 			echo '
-							<p>', $txt['started_by'], ' ', $topic['first_post']['member']['link'], '
-								<small id="pages' . $topic['first_post']['id'] . '">', $topic['pages'], '</small>
-							</p>
+							<div class="message_index_title">
+								', $topic['new'] && $context['user']['is_logged'] ? '<a href="' . $topic['new_href'] . '" id="newicon' . $topic['first_post']['id'] . '"><span class="new_posts">' . $txt['new'] . '</span></a>' : '', '
+								<span class="preview', $topic['is_sticky'] ? ' bold_text' : '', '" title="', $topic[(empty($modSettings['message_index_preview_first']) ? 'last_post' : 'first_post')]['preview'], '">
+									<span id="msg_', $topic['first_post']['id'], '">', $topic['first_post']['link'], ($context['can_approve_posts'] && !$topic['approved'] ? '&nbsp;<em>(' . $txt['awaiting_approval'] . ')</em>' : ''), '</span>
+								</span>
+							</div>
+							<p class="floatleft">', $txt['started_by'], ' ', $topic['first_post']['member']['link'], '</p>
+							<small id="pages', $topic['first_post']['id'], '">&nbsp;', $topic['pages'], '</small>
+							<br class="clear">
 						</div>
-					</td>
-					<td class="stats ', $color_class, '">
-						', $topic['replies'], ' ', $txt['replies'], '
-						<br />
-						', $topic['views'], ' ', $txt['views'], '
-					</td>
-					<td class="lastpost ', $alternate_class, '">
-						<a href="', $topic['last_post']['href'], '"><img src="', $settings['images_url'], '/icons/last_post.gif" alt="', $txt['last_post'], '" title="', $txt['last_post'], '" /></a>
-						', $topic['last_post']['time'], '<br />
-						', $txt['by'], ' ', $topic['last_post']['member']['link'], '
-					</td>';
+					</div>
+					<div class="stats"><p>', $topic['replies'], ' ', $txt['replies'], '<br>', $topic['views'], ' ', $txt['views'], '</p></div>
+					<div class="lastpost">
+						<p>', sprintf($txt['last_post_topic'], '<a href="' . $topic['last_post']['href'] . '">' . $topic['last_post']['time'] . '</a>', $topic['last_post']['member']['link']), '</p>
+					</div>';
 
 			// Show the quick moderation options?
 			if (!empty($context['can_quick_mod']))
 			{
 				echo '
-					<td class="moderation ', $color_class, '" align="center">';
+					<div class="moderation">';
 				if ($options['display_quick_mod'] == 1)
 					echo '
-						<input type="checkbox" name="topics[]" value="', $topic['id'], '" class="input_check" />';
+						<input type="checkbox" name="topics[]" value="', $topic['id'], '" class="input_check">';
 				else
 				{
 					// Check permissions on each and show only the ones they are allowed to use.
 					if ($topic['quick_mod']['remove'])
-						echo '<a href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions[', $topic['id'], ']=remove;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_remove.gif" width="16" alt="', $txt['remove_topic'], '" title="', $txt['remove_topic'], '" /></a>';
+						echo '<a href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions%5B', $topic['id'], '%5D=remove;', $context['session_var'], '=', $context['session_id'], '" class="you_sure"><span class="generic_icons delete" title="', $txt['remove_topic'], '"></span></a>';
 
 					if ($topic['quick_mod']['lock'])
-						echo '<a href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions[', $topic['id'], ']=lock;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_lock.gif" width="16" alt="', $txt['set_lock'], '" title="', $txt['set_lock'], '" /></a>';
+						echo '<a href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions%5B', $topic['id'], '%5D=lock;', $context['session_var'], '=', $context['session_id'], '" class="you_sure"><span class="generic_icons lock" title="', $topic['is_locked'] ? $txt['set_unlock'] : $txt['set_lock'], '"></span></a>';
 
 					if ($topic['quick_mod']['lock'] || $topic['quick_mod']['remove'])
-						echo '<br />';
+						echo '<br>';
 
 					if ($topic['quick_mod']['sticky'])
-						echo '<a href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions[', $topic['id'], ']=sticky;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_sticky.gif" width="16" alt="', $txt['set_sticky'], '" title="', $txt['set_sticky'], '" /></a>';
+						echo '<a href="', $scripturl, '?action=quickmod;board=', $context['current_board'], '.', $context['start'], ';actions%5B', $topic['id'], '%5D=sticky;', $context['session_var'], '=', $context['session_id'], '" class="you_sure"><span class="generic_icons sticky" title="', $topic['is_sticky'] ? $txt['set_nonsticky'] : $txt['set_sticky'], '"></span></a>';
 
 					if ($topic['quick_mod']['move'])
-						echo '<a href="', $scripturl, '?action=movetopic;board=', $context['current_board'], '.', $context['start'], ';topic=', $topic['id'], '.0"><img src="', $settings['images_url'], '/icons/quick_move.gif" width="16" alt="', $txt['move_topic'], '" title="', $txt['move_topic'], '" /></a>';
+						echo '<a href="', $scripturl, '?action=movetopic;current_board=', $context['current_board'], ';board=', $context['current_board'], '.', $context['start'], ';topic=', $topic['id'], '.0"><span class="generic_icons move" title="', $txt['move_topic'], '"></span></a>';
 				}
 				echo '
-					</td>';
+					</div>';
 			}
 			echo '
-				</tr>';
+				</div>';
 		}
+		echo '
+			</div>';
 
 		if (!empty($context['can_quick_mod']) && $options['display_quick_mod'] == 1 && !empty($context['topics']))
 		{
 			echo '
-				<tr class="titlebg">
-					<td colspan="6" align="right">
-						<select class="qaction" name="qaction"', $context['can_move'] ? ' onchange="this.form.moveItTo.disabled = (this.options[this.selectedIndex].value != \'move\');"' : '', '>
-							<option value="">--------</option>', $context['can_remove'] ? '
-							<option value="remove">' . $txt['quick_mod_remove'] . '</option>' : '', $context['can_lock'] ? '
-							<option value="lock">' . $txt['quick_mod_lock'] . '</option>' : '', $context['can_sticky'] ? '
-							<option value="sticky">' . $txt['quick_mod_sticky'] . '</option>' : '', $context['can_move'] ? '
-							<option value="move">' . $txt['quick_mod_move'] . ': </option>' : '', $context['can_merge'] ? '
-							<option value="merge">' . $txt['quick_mod_merge'] . '</option>' : '', $context['can_restore'] ? '
-							<option value="restore">' . $txt['quick_mod_restore'] . '</option>' : '', $context['can_approve'] ? '
-							<option value="approve">' . $txt['quick_mod_approve'] . '</option>' : '', $context['user']['is_logged'] ? '
-							<option value="markread">' . $txt['quick_mod_markread'] . '</option>' : '', '
-						</select>';
+				<div class="righttext" id="quick_actions">
+					<select class="qaction" name="qaction"', $context['can_move'] ? ' onchange="this.form.move_to.disabled = (this.options[this.selectedIndex].value != \'move\');"' : '', '>
+						<option value="">--------</option>';
 
-			// Show a list of boards they can move the topic to.
-			if ($context['can_move'])
-			{
+			foreach ($context['qmod_actions'] as $qmod_action)
+				if ($context['can_' . $qmod_action])
 					echo '
-						<select class="qaction" id="moveItTo" name="move_to" disabled="disabled">';
+						<option value="' . $qmod_action . '">' . $txt['quick_mod_'  . $qmod_action] . '</option>';
 
-					foreach ($context['move_to_boards'] as $category)
-					{
-						echo '
-							<optgroup label="', $category['name'], '">';
-						foreach ($category['boards'] as $board)
-								echo '
-								<option value="', $board['id'], '"', $board['selected'] ? ' selected="selected"' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level'] - 1) . '=&gt;' : '', ' ', $board['name'], '</option>';
-						echo '
-							</optgroup>';
-					}
-					echo '
-						</select>';
-			}
+			echo '
+					</select>';
+
+			// Show a list of boards they can move the topic to.
+			if ($context['can_move'])
+				echo '
+			<span id="quick_mod_jump_to">&nbsp;</span>';
 
 			echo '
-						<input type="submit" value="', $txt['quick_mod_go'], '" onclick="return document.forms.quickModForm.qaction.value != \'\' &amp;&amp; confirm(\'', $txt['quickmod_confirm'], '\');" class="button_submit qaction" />
-					</td>
-				</tr>';
+					<input type="submit" value="', $txt['quick_mod_go'], '" onclick="return document.forms.quickModForm.qaction.value != \'\' &amp;&amp; confirm(\'', $txt['quickmod_confirm'], '\');" class="button_submit qaction">
+				</div>';
 		}
 
 		echo '
-			</tbody>
-		</table>
-	</div>
-	<a id="bot"></a>';
+	</div>';
 
 		// Finish off the form - again.
 		if (!empty($context['can_quick_mod']) && $options['display_quick_mod'] > 0 && !empty($context['topics']))
 			echo '
-	<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '" />
+	<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '">
 	</form>';
 
 		echo '
 	<div class="pagesection">
-		', template_button_strip($normal_buttons, 'right'), '
-		<div class="pagelinks">', $txt['pages'], ': ', $context['page_index'], !empty($modSettings['topbottomEnable']) ? $context['menu_separator'] . '&nbsp;&nbsp;<a href="#top"><strong>' . $txt['go_up'] . '</strong></a>' : '', '</div>
+		', template_button_strip($context['normal_buttons'], 'right'), '
+		', $context['menu_separator'], '<a href="#main_content_section" class="topbottom floatleft" id="bot">', $txt['go_up'], '</a>
+		<div class="pagelinks">', $context['page_index'], '</div>
 	</div>';
 	}
 
 	// Show breadcrumbs at the bottom too.
 	theme_linktree();
 
+	if (!empty($context['can_quick_mod']) && $options['display_quick_mod'] == 1 && !empty($context['topics']) && $context['can_move'])
+		echo '
+			<script><!-- // --><![CDATA[
+				if (typeof(window.XMLHttpRequest) != "undefined")
+					aJumpTo[aJumpTo.length] = new JumpTo({
+						sContainerId: "quick_mod_jump_to",
+						sClassName: "qaction",
+						sJumpToTemplate: "%dropdown_list%",
+						iCurBoardId: ', $context['current_board'], ',
+						iCurBoardChildLevel: ', $context['jump_to']['child_level'], ',
+						sCurBoardName: "', $context['jump_to']['board_name'], '",
+						sBoardChildLevelIndicator: "==",
+						sBoardPrefix: "=> ",
+						sCatSeparator: "-----------------------------",
+						sCatPrefix: "",
+						bNoRedirect: true,
+						bDisabled: true,
+						sCustomName: "move_to"
+					});
+			// ]]></script>';
+
+	// Javascript for inline editing.
+	echo '
+<script><!-- // --><![CDATA[
+	var oQuickModifyTopic = new QuickModifyTopic({
+		aHidePrefixes: Array("lockicon", "stickyicon", "pages", "newicon"),
+		bMouseOnDiv: false,
+	});
+// ]]></script>';
+
+	template_topic_legend();
+}
+
+function template_topic_legend()
+{
+	global $context, $settings, $txt, $modSettings;
+
 	echo '
 	<div class="tborder" id="topic_icons">
-		<div class="description">
+		<div class="information">
 			<p class="floatright" id="message_index_jump_to">&nbsp;</p>';
 
-	if (!$context['no_topic_listing'])
+	if (empty($context['no_topic_listing']))
 		echo '
-			<p class="floatleft smalltext">', !empty($modSettings['enableParticipation']) && $context['user']['is_logged'] ? '
-				<img src="' . $settings['images_url'] . '/topic/my_normal_post.gif" alt="" align="middle" /> ' . $txt['participation_caption'] . '<br />' : '', '
-				<img src="' . $settings['images_url'] . '/topic/normal_post.gif" alt="" align="middle" /> ' . $txt['normal_topic'] . '<br />
-				<img src="' . $settings['images_url'] . '/topic/hot_post.gif" alt="" align="middle" /> ' . sprintf($txt['hot_topics'], $modSettings['hotTopicPosts']) . '<br />
-				<img src="' . $settings['images_url'] . '/topic/veryhot_post.gif" alt="" align="middle" /> ' . sprintf($txt['very_hot_topics'], $modSettings['hotTopicVeryPosts']) . '
+			<p class="floatleft">', !empty($modSettings['enableParticipation']) && $context['user']['is_logged'] ? '
+				<img src="' . $settings['images_url'] . '/icons/profile_sm.png" alt="" class="centericon"> ' . $txt['participation_caption'] . '<br>' : '', '
+				'. ($modSettings['pollMode'] == '1' ? '<span class="generic_icons poll centericon"></span> ' . $txt['poll'] : '') . '<br>
+				<img src="' . $settings['images_url'] . '/post/moved.png" alt="" class="centericon sizefix"> ' . $txt['moved_topic'] . '<br>
 			</p>
-			<p class="smalltext">
-				<img src="' . $settings['images_url'] . '/icons/quick_lock.gif" alt="" align="middle" /> ' . $txt['locked_topic'] . '<br />' . ($modSettings['enableStickyTopics'] == '1' ? '
-				<img src="' . $settings['images_url'] . '/icons/quick_sticky.gif" alt="" align="middle" /> ' . $txt['sticky_topic'] . '<br />' : '') . ($modSettings['pollMode'] == '1' ? '
-				<img src="' . $settings['images_url'] . '/topic/normal_poll.gif" alt="" align="middle" /> ' . $txt['poll'] : '') . '
+			<p>
+				<span class="generic_icons lock centericon"></span> ' . $txt['locked_topic'] . '<br>
+				<span class="generic_icons sticky centericon"></span> ' . $txt['sticky_topic'] . '<br>
 			</p>';
 
-	echo '
-			<script type="text/javascript"><!-- // --><![CDATA[
+	if (!empty($context['jump_to']))
+		echo '
+			<script><!-- // --><![CDATA[
 				if (typeof(window.XMLHttpRequest) != "undefined")
 					aJumpTo[aJumpTo.length] = new JumpTo({
 						sContainerId: "message_index_jump_to",
-						sJumpToTemplate: "<label class=\"smalltext\" for=\"%select_id%\">', $context['jump_to']['label'], ':<" + "/label> %dropdown_list%",
+						sJumpToTemplate: "<label class=\"smalltext jump_to\" for=\"%select_id%\">', $context['jump_to']['label'], '<" + "/label> %dropdown_list%",
 						iCurBoardId: ', $context['current_board'], ',
 						iCurBoardChildLevel: ', $context['jump_to']['child_level'], ',
 						sCurBoardName: "', $context['jump_to']['board_name'], '",
@@ -411,56 +407,12 @@
 						sCatPrefix: "",
 						sGoButtonLabel: "', $txt['quick_mod_go'], '"
 					});
-			// ]]></script>
-			<br class="clear" />
-		</div>
-	</div>';
+			// ]]></script>';
 
-	// Javascript for inline editing.
 	echo '
-<script type="text/javascript" src="' . $settings['default_theme_url'] . '/scripts/topic.js"></script>
-<script type="text/javascript"><!-- // --><![CDATA[
-
-	// Hide certain bits during topic edit.
-	hide_prefixes.push("lockicon", "stickyicon", "pages", "newicon");
-
-	// Use it to detect when we\'ve stopped editing.
-	document.onclick = modify_topic_click;
-
-	var mouse_on_div;
-	function modify_topic_click()
-	{
-		if (in_edit_mode == 1 && mouse_on_div == 0)
-			modify_topic_save("', $context['session_id'], '", "', $context['session_var'], '");
-	}
-
-	function modify_topic_keypress(oEvent)
-	{
-		if (typeof(oEvent.keyCode) != "undefined" && oEvent.keyCode == 13)
-		{
-			modify_topic_save("', $context['session_id'], '", "', $context['session_var'], '");
-			if (typeof(oEvent.preventDefault) == "undefined")
-				oEvent.returnValue = false;
-			else
-				oEvent.preventDefault();
-		}
-	}
-
-	// For templating, shown when an inline edit is made.
-	function modify_topic_show_edit(subject)
-	{
-		// Just template the subject.
-		setInnerHTML(cur_subject_div, \'<input type="text" name="subject" value="\' + subject + \'" size="60" style="width: 95%;" maxlength="80" onkeypress="modify_topic_keypress(event)" class="input_text" /><input type="hidden" name="topic" value="\' + cur_topic_id + \'" /><input type="hidden" name="msg" value="\' + cur_msg_id.substr(4) + \'" />\');
-	}
-
-	// And the reverse for hiding it.
-	function modify_topic_hide_edit(subject)
-	{
-		// Re-template the subject!
-		setInnerHTML(cur_subject_div, \'<a href="', $scripturl, '?topic=\' + cur_topic_id + \'.0">\' + subject + \'<\' +\'/a>\');
-	}
-
-// ]]></script>';
+			<br class="clear">
+		</div>
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/ModerationCenter.template.php b/Themes/default/ModerationCenter.template.php
--- a/Themes/default/ModerationCenter.template.php	2011-06-10 03:42:24.000000000 -0700
+++ b/Themes/default/ModerationCenter.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,154 +3,189 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_moderation_center()
 {
-	global $settings, $options, $context, $txt, $scripturl;
+	global $context;
+
+	// Show moderators notes.
+	template_notes();
 
 	// Show a welcome message to the user.
 	echo '
-	<div id="modcenter">
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['moderation_center'], '</h3>
-		</div>
-		<div class="information">
-			<strong>', $txt['hello_guest'], ' ', $context['user']['name'], '!</strong>
-			<p>
-				', $txt['mc_description'], '
-			</p>
-
-		</div>';
+	<div id="modcenter">';
 
-	$alternate = true;
 	// Show all the blocks they want to see.
 	foreach ($context['mod_blocks'] as $block)
 	{
 		$block_function = 'template_' . $block;
 
 		echo '
-		<div class="modblock_', $alternate ? 'left' : 'right', '">', function_exists($block_function) ? $block_function() : '', '</div>';
-
-		if (!$alternate)
-			echo '
-		<br class="clear" />';
-
-		$alternate = !$alternate;
+		<div class="half_content">', function_exists($block_function) ? $block_function() : '', '</div>';
 	}
 
 	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
-function template_latest_news()
+// Show all the group requests the user can see.
+function template_group_requests_block()
 {
-	global $settings, $options, $context, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<span class="ie6_header floatleft"><a href="', $scripturl, '?action=helpadmin;help=live_news" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" class="icon" /></a> ', $txt['mc_latest_news'], '</span>
+				<span id="group_requests_toggle" class="', !empty($context['admin_prefs']['mcgr']) ? 'toggle_down' : 'toggle_up', ' floatright" style="display: none;"></span>
+				<a href="', $scripturl, '?action=groups;sa=requests" id="group_requests_link">', $txt['mc_group_requests'], '</a>
 			</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<div id="smfAnnouncements" class="smalltext">', $txt['mc_cannot_connect_sm'], '</div>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
+		<div class="windowbg2" id="group_requests_panel">
+			<div class="modbox">
+				<ul class="reset">';
 
-	// This requires a lot of javascript...
-	//!!! Put this in it's own file!!
-	echo '
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=current-version.js"></script>
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=latest-news.js"></script>
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/admin.js?fin20"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var oAdminIndex = new smf_AdminIndex({
-				sSelf: \'oAdminCenter\',
+		foreach ($context['group_requests'] as $request)
+			echo '
+				<li class="smalltext">
+					<a href="', $request['request_href'], '">', $request['group']['name'], '</a> ', $txt['mc_groupr_by'], ' ', $request['member']['link'], '
+				</li>';
 
-				bLoadAnnouncements: true,
-				sAnnouncementTemplate: ', JavaScriptEscape('
-					<dl>
-						%content%
-					</dl>
-				'), ',
-				sAnnouncementMessageTemplate: ', JavaScriptEscape('
-					<dt><a href="%href%">%subject%</a> ' . $txt['on'] . ' %time%</dt>
-					<dd>
-						%message%
-					</dd>
-				'), ',
-				sAnnouncementContainerId: \'smfAnnouncements\'
-			});
-		// ]]></script>';
+		// Don't have any watched users right now?
+		if (empty($context['group_requests']))
+			echo '
+				<li>
+					<strong class="smalltext">', $txt['mc_group_requests_none'], '</strong>
+				</li>';
+
+		echo '
+				</ul>
+			</div>
+		</div>
 
+	<script><!-- // --><![CDATA[
+		var oGroupRequestsPanelToggle = new smc_Toggle({
+			bToggleEnabled: true,
+			bCurrentlyCollapsed: ', !empty($context['admin_prefs']['mcgr']) ? 'true' : 'false', ',
+			aSwappableContainers: [
+				\'group_requests_panel\'
+			],
+			aSwapImages: [
+				{
+					sId: \'group_requests_toggle\',
+					altExpanded: ', JavaScriptEscape($txt['hide']), ',
+					altCollapsed: ', JavaScriptEscape($txt['show']), '
+				}
+			],
+			aSwapLinks: [
+				{
+					sId: \'group_requests_link\',
+					msgExpanded: ', JavaScriptEscape($txt['mc_group_requests']), ',
+					msgCollapsed: ', JavaScriptEscape($txt['mc_group_requests']), '
+				}
+			],
+			oThemeOptions: {
+				bUseThemeSettings: true,
+				sOptionName: \'admin_preferences\',
+				sSessionVar: smf_session_var,
+				sSessionId: smf_session_id,
+				sThemeId: \'1\',
+				sAdditionalVars: \';admin_key=mcgr\'
+			}
+		});
+	// ]]></script>';
 }
 
-// Show all the group requests the user can see.
-function template_group_requests_block()
+function template_watched_users()
 {
-	global $settings, $options, $context, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<a href="', $scripturl, '?action=groups;sa=requests">', $txt['mc_group_requests'], '</a>
+				<span id="watched_users_toggle" class="', !empty($context['admin_prefs']['mcwu']) ? 'toggle_down' : 'toggle_up', ' floatright" style="display: none;"></span>
+				<a href="', $scripturl, '?action=moderate;area=userwatch" id="watched_users_link">', $txt['mc_watched_users'], '</a>
 			</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content modbox">
+		<div class="windowbg2" id="watched_users_panel">
+			<div class="modbox">
 				<ul class="reset">';
 
-		foreach ($context['group_requests'] as $request)
+		foreach ($context['watched_users'] as $user)
 			echo '
-				<li class="smalltext">
-					<a href="', $request['request_href'], '">', $request['group']['name'], '</a> ', $txt['mc_groupr_by'], ' ', $request['member']['link'], '
-				</li>';
+					<li>
+						<span class="smalltext">', sprintf(!empty($user['last_login']) ? $txt['mc_seen'] : $txt['mc_seen_never'], $user['link'], $user['last_login']), '</span>
+					</li>';
 
 		// Don't have any watched users right now?
-		if (empty($context['group_requests']))
+		if (empty($context['watched_users']))
 			echo '
-				<li>
-					<strong class="smalltext">', $txt['mc_group_requests_none'], '</strong>
-				</li>';
+					<li>
+						<strong class="smalltext">', $txt['mc_watched_users_none'], '</strong>
+					</li>';
 
 		echo '
 				</ul>
 			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
+		</div>
+
+	<script><!-- // --><![CDATA[
+		var oWatchedUsersToggle = new smc_Toggle({
+			bToggleEnabled: true,
+			bCurrentlyCollapsed: ', !empty($context['admin_prefs']['mcwu']) ? 'true' : 'false', ',
+			aSwappableContainers: [
+				\'watched_users_panel\'
+			],
+			aSwapImages: [
+				{
+					sId: \'watched_users_toggle\',
+					altExpanded: ', JavaScriptEscape($txt['hide']), ',
+					altCollapsed: ', JavaScriptEscape($txt['show']), '
+				}
+			],
+			aSwapLinks: [
+				{
+					sId: \'watched_users_link\',
+					msgExpanded: ', JavaScriptEscape($txt['mc_watched_users']), ',
+					msgCollapsed: ', JavaScriptEscape($txt['mc_watched_users']), '
+				}
+			],
+			oThemeOptions: {
+				bUseThemeSettings: true,
+				sOptionName: \'admin_preferences\',
+				sSessionVar: smf_session_var,
+				sSessionId: smf_session_id,
+				sThemeId: \'1\',
+				sAdditionalVars: \';admin_key=mcwu\'
+			}
+		});
+	// ]]></script>';
 }
 
-// A block to show the current top reported posts.
 function template_reported_posts_block()
 {
-	global $settings, $options, $context, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<a href="', $scripturl, '?action=moderate;area=reports">', $txt['mc_recent_reports'], '</a>
+				<span id="reported_posts_toggle" class="', !empty($context['admin_prefs']['mcrp']) ? 'toggle_down' : 'toggle_up', ' floatright" style="display: none;"></span>
+				<a href="', $scripturl, '?action=moderate;area=reportedposts" id="reported_posts_link">', $txt['mc_recent_reports'], '</a>
 			</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content modbox">
+		<div class="windowbg2" id="reported_posts_panel">
+			<div class="modbox">
 				<ul class="reset">';
 
-		foreach ($context['reported_posts'] as $report)
+		foreach ($context['reported_posts'] as $post)
 			echo '
-					<li class="smalltext">
-						<a href="', $report['report_href'], '">', $report['subject'], '</a> ', $txt['mc_reportedp_by'], ' ', $report['author']['link'], '
+					<li>
+						<span class="smalltext">', sprintf($txt['mc_post_report'], $post['report_link'], $post['author']['link']), '</span>
 					</li>';
 
 		// Don't have any watched users right now?
@@ -163,176 +198,164 @@
 		echo '
 				</ul>
 			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
+		</div>
+
+	<script><!-- // --><![CDATA[
+		var oWatchedUsersToggle = new smc_Toggle({
+			bToggleEnabled: true,
+			bCurrentlyCollapsed: ', !empty($context['admin_prefs']['mcrp']) ? 'true' : 'false', ',
+			aSwappableContainers: [
+				\'reported_posts_panel\'
+			],
+			aSwapImages: [
+				{
+					sId: \'reported_posts_toggle\',
+					altExpanded: ', JavaScriptEscape($txt['hide']), ',
+					altCollapsed: ', JavaScriptEscape($txt['show']), '
+				}
+			],
+			aSwapLinks: [
+				{
+					sId: \'reported_posts_link\',
+					msgExpanded: ', JavaScriptEscape($txt['mc_recent_reports']), ',
+					msgCollapsed: ', JavaScriptEscape($txt['mc_recent_reports']), '
+				}
+			],
+			oThemeOptions: {
+				bUseThemeSettings: true,
+				sOptionName: \'admin_preferences\',
+				sSessionVar: smf_session_var,
+				sSessionId: smf_session_id,
+				sThemeId: \'1\',
+				sAdditionalVars: \';admin_key=mcrp\'
+			}
+		});
+	// ]]></script>';
 }
 
-function template_watched_users()
+function template_reported_users_block()
 {
-	global $settings, $options, $context, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<a href="', $scripturl, '?action=moderate;area=userwatch">', $txt['mc_watched_users'], '</a>
+				<span id="reported_users_toggle" class="', !empty($context['admin_prefs']['mcur']) ? 'toggle_down' : 'toggle_up', ' floatright" style="display: none;"></span>
+				<a href="', $scripturl, '?action=moderate;area=userwatch" id="reported_users_link">', $txt['mc_recent_user_reports'], '</a>
 			</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content modbox">
+		<div class="windowbg2" id="reported_users_panel">
+			<div class="modbox">
 				<ul class="reset">';
 
-		foreach ($context['watched_users'] as $user)
+		foreach ($context['reported_users'] as $user)
 			echo '
 					<li>
-						<span class="smalltext">', sprintf(!empty($user['last_login']) ? $txt['mc_seen'] : $txt['mc_seen_never'], $user['link'], $user['last_login']), '</span>
+						<span class="smalltext">', $user['user']['link'], '</span>
 					</li>';
 
 		// Don't have any watched users right now?
-		if (empty($context['watched_users']))
+		if (empty($context['reported_users']))
 			echo '
 					<li>
-						<strong class="smalltext">', $txt['mc_watched_users_none'], '</strong>
+						<strong class="smalltext">', $txt['mc_reported_users_none'], '</strong>
 					</li>';
 
 		echo '
 				</ul>
 			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
+		</div>
+
+	<script><!-- // --><![CDATA[
+		var oWatchedUsersToggle = new smc_Toggle({
+			bToggleEnabled: true,
+			bCurrentlyCollapsed: ', !empty($context['admin_prefs']['mcur']) ? 'true' : 'false', ',
+			aSwappableContainers: [
+				\'reported_users_panel\'
+			],
+			aSwapImages: [
+				{
+					sId: \'reported_users_toggle\',
+					altExpanded: ', JavaScriptEscape($txt['hide']), ',
+					altCollapsed: ', JavaScriptEscape($txt['show']), '
+				}
+			],
+			aSwapLinks: [
+				{
+					sId: \'reported_users_link\',
+					msgExpanded: ', JavaScriptEscape($txt['mc_recent_user_reports']), ',
+					msgCollapsed: ', JavaScriptEscape($txt['mc_recent_user_reports']), '
+				}
+			],
+			oThemeOptions: {
+				bUseThemeSettings: true,
+				sOptionName: \'admin_preferences\',
+				sSessionVar: smf_session_var,
+				sSessionId: smf_session_id,
+				sThemeId: \'1\',
+				sAdditionalVars: \';admin_key=mcur\'
+			}
+		});
+	// ]]></script>';
 }
 
 // Little section for making... notes.
 function template_notes()
 {
-	global $settings, $options, $context, $txt, $scripturl;
+	global $context, $txt, $scripturl;
+
+	// Let them know the action was a success.
+	if (!empty($context['report_post_action']))
+	{
+		echo '
+			<div class="infobox">
+				', $txt['report_action_'. $context['report_post_action']], '
+			</div>';
+	}
 
 	echo '
-		<form action="', $scripturl, '?action=moderate;area=index" method="post">
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['mc_notes'], '</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content modbox">';
+		<div class="modnotes">
+			<form action="', $scripturl, '?action=moderate;area=index;modnote" method="post">
+				<div class="cat_bar">
+					<h3 class="catbg">', $txt['mc_notes'], '</h3>
+				</div>
+				<div class="windowbg2">
+					<div class="modbox">';
 
 		if (!empty($context['notes']))
 		{
 			echo '
-					<ul class="reset moderation_notes">';
+						<ul class="reset moderation_notes">';
 
 			// Cycle through the notes.
 			foreach ($context['notes'] as $note)
 				echo '
-						<li class="smalltext"><a href="', $note['delete_href'], '"><img src="', $settings['images_url'], '/pm_recipient_delete.gif" alt="" /></a> <strong>', $note['author']['link'], ':</strong> ', $note['text'], '</li>';
+							<li class="smalltext">', ($note['can_delete'] ? '<a href="'. $note['delete_href'] .';'. $context['mod-modnote-del_token_var'] .'='. $context['mod-modnote-del_token'] .'" class="delete_modnote"><span class="generic_icons delete"></span></a>' : ''), $note['time'] ,' <strong>', $note['author']['link'], ':</strong> ', $note['text'], '</li>';
 
 			echo '
-					</ul>
-					<div class="pagesection notes">
-						<span class="smalltext">', $txt['pages'], ': ', $context['page_index'], '</span>
-					</div>';
+						</ul>
+						<div class="pagesection notes">
+							<span class="smalltext">', $context['page_index'], '</span>
+						</div>';
 		}
 
 		echo '
-					<div class="floatleft post_note">
-						<input type="text" name="new_note" value="', $txt['mc_click_add_note'], '" style="width: 95%;" onclick="if (this.value == \'', $txt['mc_click_add_note'], '\') this.value = \'\';" class="input_text" />
-					</div>
-					<div class="floatright">
-						<input type="submit" name="makenote" value="', $txt['mc_add_note'], '" class="button_submit" />
-					</div>
-					<br class="clear" />
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>';
-}
-
-function template_reported_posts()
-{
-	global $settings, $options, $context, $txt, $scripturl;
-
-	echo '
-	<form action="', $scripturl, '?action=moderate;area=reports', $context['view_closed'] ? ';sa=closed' : '', ';start=', $context['start'], '" method="post" accept-charset="', $context['character_set'], '">
-		<div class="cat_bar">
-			<h3 class="catbg">
-				', $context['view_closed'] ? $txt['mc_reportedp_closed'] : $txt['mc_reportedp_active'], '
-			</h3>
-		</div>
-		<div class="pagesection">
-			<div class="pages">', $txt['pages'], ': ', $context['page_index'], '</div>
-		</div>';
-
-	// Make the buttons.
-	$close_button = create_button('close.gif', $context['view_closed'] ? 'mc_reportedp_open' : 'mc_reportedp_close', $context['view_closed'] ? 'mc_reportedp_open' : 'mc_reportedp_close', 'align="middle"');
-	$details_button = create_button('details.gif', 'mc_reportedp_details', 'mc_reportedp_details', 'align="middle"');
-	$ignore_button = create_button('ignore.gif', 'mc_reportedp_ignore', 'mc_reportedp_ignore', 'align="middle"');
-	$unignore_button = create_button('ignore.gif', 'mc_reportedp_unignore', 'mc_reportedp_unignore', 'align="middle"');
-
-	foreach ($context['reports'] as $report)
-	{
-		echo '
-		<div class="', $report['alternate'] ? 'windowbg' : 'windowbg2', '">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<div>
-					<div class="floatleft">
-						<strong><a href="', $report['topic_href'], '">', $report['subject'], '</a></strong> ', $txt['mc_reportedp_by'], ' <strong>', $report['author']['link'], '</strong>
-					</div>
-					<div class="floatright">
-						<a href="', $report['report_href'], '">', $details_button, '</a>
-						<a href="', $scripturl, '?action=moderate;area=reports', $context['view_closed'] ? ';sa=closed' : '', ';ignore=', (int) !$report['ignore'], ';rid=', $report['id'], ';start=', $context['start'], ';', $context['session_var'], '=', $context['session_id'], '" ', !$report['ignore'] ? 'onclick="return confirm(\'' . $txt['mc_reportedp_ignore_confirm'] . '\');"' : '', '>', $report['ignore'] ? $unignore_button : $ignore_button, '</a>
-						<a href="', $scripturl, '?action=moderate;area=reports', $context['view_closed'] ? ';sa=closed' : '', ';close=', (int) !$report['closed'], ';rid=', $report['id'], ';start=', $context['start'], ';', $context['session_var'], '=', $context['session_id'], '">', $close_button, '</a>
-						', !$context['view_closed'] ? '<input type="checkbox" name="close[]" value="' . $report['id'] . '" class="input_check" />' : '', '
+						<div class="floatleft post_note">
+						<input type="text" name="new_note" placeholder="', $txt['mc_click_add_note'], '" style="width: 95%;" class="input_text">
+						</div>
+						<input type="hidden" name="', $context['mod-modnote-add_token_var'], '" value="', $context['mod-modnote-add_token'], '">
+						<input type="submit" name="makenote" value="', $txt['mc_add_note'], '" class="button_submit">
 					</div>
-				</div><br />
-				<div class="smalltext">
-					&#171; ', $txt['mc_reportedp_last_reported'], ': ', $report['last_updated'], ' &#187;<br />';
-
-		// Prepare the comments...
-		$comments = array();
-		foreach ($report['comments'] as $comment)
-			$comments[$comment['member']['id']] = $comment['member']['link'];
-
-		echo '
-					&#171; ', $txt['mc_reportedp_reported_by'], ': ', implode(', ', $comments), ' &#187;
 				</div>
-				<hr />
-				', $report['body'], '
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
-	}
-
-	// Were none found?
-	if (empty($context['reports']))
-		echo '
-		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p class="centertext">', $txt['mc_reportedp_none_found'], '</p>
-			</div>
-			<span class="botslice"><span></span></span>
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			</form>
 		</div>';
-
-	echo '
-		<div class="pagesection">
-			<div class="floatleft">
-				', $txt['pages'], ': ', $context['page_index'], '
-			</div>
-			<div class="floatright">
-				', !$context['view_closed'] ? '<input type="submit" name="close_selected" value="' . $txt['mc_reportedp_close_selected'] . '" class="button_submit" />' : '', '
-			</div>
-		</div>
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-	</form>
-	<br class="clear" />';
 }
 
 // Show a list of all the unapproved posts
 function template_unapproved_posts()
 {
-	global $settings, $options, $context, $txt, $scripturl;
+	global $options, $context, $txt, $scripturl;
 
 	// Just a big table of it all really...
 	echo '
@@ -343,60 +366,55 @@
 		</div>';
 
 	// Make up some buttons
-	$approve_button = create_button('approve.gif', 'approve', 'approve', 'align="middle"');
-	$remove_button = create_button('delete.gif', 'remove_message', 'remove', 'align="middle"');
+	$approve_button = create_button('approve', 'approve', 'approve');
+	$remove_button = create_button('delete', 'remove_message', 'remove');
 
 	// No posts?
 	if (empty($context['unapproved_items']))
 		echo '
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p class="centertext">', $txt['mc_unapproved_' . $context['current_view'] . '_none_found'], '</p>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p class="centertext">', $txt['mc_unapproved_' . $context['current_view'] . '_none_found'], '</p>
 		</div>';
 	else
 		echo '
-			<div class="pagesection">
-				<div class="pagelinks">', $txt['pages'], ': ', $context['page_index'], '</div>
+			<div class="pagesection floatleft">
+				', $context['page_index'], '
 			</div>';
 
 	foreach ($context['unapproved_items'] as $item)
 	{
 		echo '
-		<div class="cat_bar">
-			<h3 class="catbg">
-				<span class="smalltext floatleft">', $item['counter'], '&nbsp;</span>
-				<span class="smalltext floatleft"><a href="', $scripturl, '#c', $item['category']['id'], '">', $item['category']['name'], '</a> / <a href="', $scripturl, '?board=', $item['board']['id'], '.0">', $item['board']['name'], '</a> / <a href="', $scripturl, '?topic=', $item['topic']['id'], '.msg', $item['id'], '#msg', $item['id'], '">', $item['subject'], '</a></span>
-				<span class="smalltext floatright">', $txt['mc_unapproved_by'], ' ', $item['poster']['link'], ' ', $txt['on'], ': ', $item['time'], '</span>
-			</h3>
-		</div>
-		<div class="', $item['alternate'] ? 'windowbg' : 'windowbg2', '">
-			<span class="topslice"><span></span></span>
-			<div class="content">
+		<div class="windowbg clear">
+			<div class="counter">', $item['counter'], '</div>
+			<div class="topic_details">
+				<h5><strong>', $item['category']['link'], ' / ', $item['board']['link'], ' / ', $item['link'], '</strong></h5>
+				<span class="smalltext"><strong>', $txt['mc_unapproved_by'], ' ', $item['poster']['link'], ' ', $txt['on'], ':</strong> ', $item['time'], '</span>
+			</div>
+			<div class="list_posts">
 				<div class="post">', $item['body'], '</div>
-				<span class="floatright">
-					<a href="', $scripturl, '?action=moderate;area=postmod;sa=', $context['current_view'], ';start=', $context['start'], ';', $context['session_var'], '=', $context['session_id'], ';approve=', $item['id'], '">', $approve_button, '</a>';
-
-			if ($item['can_delete'])
-				echo '
-					', $context['menu_separator'], '
-					<a href="', $scripturl, '?action=moderate;area=postmod;sa=', $context['current_view'], ';start=', $context['start'], ';', $context['session_var'], '=', $context['session_id'], ';delete=', $item['id'], '">', $remove_button, '</a>';
+			</div>
+			<span class="floatright">
+				<a href="', $scripturl, '?action=moderate;area=postmod;sa=', $context['current_view'], ';start=', $context['start'], ';', $context['session_var'], '=', $context['session_id'], ';approve=', $item['id'], '">', $approve_button, '</a>';
 
+		if ($item['can_delete'])
 			echo '
-					<input type="checkbox" name="item[]" value="', $item['id'], '" checked="checked" class="input_check" /> ';
+			', $context['menu_separator'], '
+				<a href="', $scripturl, '?action=moderate;area=postmod;sa=', $context['current_view'], ';start=', $context['start'], ';', $context['session_var'], '=', $context['session_id'], ';delete=', $item['id'], '">', $remove_button, '</a>';
 
+		if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1)
 			echo '
-				</span>
-				<br class="clear" />
-			</div>
-			<span class="botslice"><span></span></span>
+				<input type="checkbox" name="item[]" value="', $item['id'], '" checked class="input_check"> ';
+
+		echo '
+			</span>
 		</div>';
 	}
 
 	echo '
-		<div class="pagesection">
+		<div class="pagesection">';
+
+	if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1)
+		echo '
 			<div class="floatright">
 				<select name="do" onchange="if (this.value != 0 &amp;&amp; confirm(\'', $txt['mc_unapproved_sure'], '\')) submit();">
 					<option value="0">', $txt['with_selected'], ':</option>
@@ -404,252 +422,20 @@
 					<option value="approve">&nbsp;--&nbsp;', $txt['approve'], '</option>
 					<option value="delete">&nbsp;--&nbsp;', $txt['delete'], '</option>
 				</select>
-				<noscript><input type="submit" name="submit" value="', $txt['go'], '" class="button_submit" /></noscript>
+				<noscript><input type="submit" name="mc_go" value="', $txt['go'], '" class="button_submit"></noscript>
 			</div>';
 
 	if (!empty($context['unapproved_items']))
 		echo '
 			<div class="floatleft">
-				<div class="pagelinks">', $txt['pages'], ': ', $context['page_index'], '</div>
+				<div class="pagelinks">', $context['page_index'], '</div>
 			</div>';
 
 	echo '
 		</div>
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 	</form>
-	</div>
-	<br class="clear" />';
-}
-
-// List all attachments awaiting approval.
-function template_unapproved_attachments()
-{
-	global $settings, $options, $context, $txt, $scripturl;
-
-	// Show all the attachments still oustanding.
-	echo '
-	<div id="modcenter">
-		<form action="', $scripturl, '?action=moderate;area=attachmod;sa=attachments;start=', $context['start'], '" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['mc_unapproved_attachments'], '</h3>
-			</div>';
-
-	// The ever popular approve button, with the massively unpopular delete.
-	$approve_button = create_button('approve.gif', 'approve', 'approve', 'align="middle"');
-	$remove_button = create_button('delete.gif', 'remove_message', 'remove', 'align="middle"');
-
-	// None awaiting?
-	if (empty($context['unapproved_items']))
-		echo '
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p class="centertext">', $txt['mc_unapproved_attachments_none_found'], '</p>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
-	else
-		echo '
-			<div class="pagesection">
-				<div class="pagelinks">', $txt['pages'], ': ', $context['page_index'], '</div>
-			</div>
-			<table class="table_grid" width="100%">
-			<thead>
-				<tr class="catbg">
-					<th>', $txt['mc_unapproved_attach_name'], '</th>
-					<th>', $txt['mc_unapproved_attach_size'], '</th>
-					<th>', $txt['mc_unapproved_attach_poster'], '</th>
-					<th>', $txt['date'], '</th>
-					<th nowrap="nowrap" align="center"><input type="checkbox" onclick="invertAll(this, this.form);" class="input_check" checked="checked" /></th>
-				</tr>
-			</thead>
-			<tbody>';
-
-	foreach ($context['unapproved_items'] as $item)
-	{
-		echo '
-				<tr class="', $item['alternate'] ? 'windowbg' : 'windowbg2', '">
-					<td>
-						', $item['filename'], '
-					</td>
-					<td align="right">
-						', $item['size'], $txt['kilobyte'], '
-					</td>
-					<td>
-						', $item['poster']['link'], '
-					</td>
-					<td class="smalltext">
-						', $item['time'], '<br />', $txt['in'], ' <a href="', $item['message']['href'], '">', $item['message']['subject'], '</a>
-					</td>
-					<td width="4%" align="center">
-						<input type="checkbox" name="item[]" value="', $item['id'], '" checked="checked" class="input_check" />
-					</td>
-				</tr>';
-	}
-
-	if (!empty($context['unapproved_items']))
-		echo '
-			</tbody>
-			</table>';
-
-		echo '
-			<div class="pagesection">
-				<div class="floatright">
-					<select name="do" onchange="if (this.value != 0 &amp;&amp; confirm(\'', $txt['mc_unapproved_sure'], '\')) submit();">
-						<option value="0">', $txt['with_selected'], ':</option>
-						<option value="0">-------------------</option>
-						<option value="approve">&nbsp;--&nbsp;', $txt['approve'], '</option>
-						<option value="delete">&nbsp;--&nbsp;', $txt['delete'], '</option>
-					</select>
-					<noscript><input type="submit" name="submit" value="', $txt['go'], '" class="button_submit" /></noscript>
-				</div>';
-
-	if (!empty($context['unapproved_items']))
-		echo '
-				<div class="floatleft">
-					<div class="pagelinks">', $txt['pages'], ': ', $context['page_index'], '</div>
-				</div>';
-
-	echo '
-			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
-	</div>
-	<br class="clear" />';
-}
-
-function template_viewmodreport()
-{
-	global $context, $scripturl, $txt;
-
-	echo '
-	<div id="modcenter">
-		<form action="', $scripturl, '?action=moderate;area=reports;report=', $context['report']['id'], '" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					', sprintf($txt['mc_viewmodreport'], $context['report']['message_link'], $context['report']['author']['link']), '
-				</h3>
-			</div>
-			<div class="title_bar">
-				<h3 class="titlebg">
-					<span class="floatleft">
-						', sprintf($txt['mc_modreport_summary'], $context['report']['num_reports'], $context['report']['last_updated']), '
-					</span>
-					<span class="floatright">';
-
-		// Make the buttons.
-		$close_button = create_button('close.gif', $context['report']['closed'] ? 'mc_reportedp_open' : 'mc_reportedp_close', $context['report']['closed'] ? 'mc_reportedp_open' : 'mc_reportedp_close', 'align="middle"');
-		$ignore_button = create_button('ignore.gif', 'mc_reportedp_ignore', 'mc_reportedp_ignore', 'align="middle"');
-		$unignore_button = create_button('ignore.gif', 'mc_reportedp_unignore', 'mc_reportedp_unignore', 'align="middle"');
-
-		echo '
-						<a href="', $scripturl, '?action=moderate;area=reports;ignore=', (int) !$context['report']['ignore'], ';rid=', $context['report']['id'], ';', $context['session_var'], '=', $context['session_id'], '" ', !$context['report']['ignore'] ? 'onclick="return confirm(\'' . $txt['mc_reportedp_ignore_confirm'] . '\');"' : '', '>', $context['report']['ignore'] ? $unignore_button : $ignore_button, '</a>
-						<a href="', $scripturl, '?action=moderate;area=reports;close=', (int) !$context['report']['closed'], ';rid=', $context['report']['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $close_button, '</a>
-					</span>
-				</h3>
-			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					', $context['report']['body'], '
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<br />
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['mc_modreport_whoreported_title'], '</h3>
-			</div>';
-
-	foreach ($context['report']['comments'] as $comment)
-		echo '
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p class="smalltext">', sprintf($txt['mc_modreport_whoreported_data'], $comment['member']['link'] . (empty($comment['member']['id']) && !empty($comment['member']['ip']) ? ' (' . $comment['member']['ip'] . ')' : ''), $comment['time']), '</p>
-					<p>', $comment['message'], '</p>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>';
-
-	echo '
-			<br />
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['mc_modreport_mod_comments'], '</h3>
-			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">';
-
-	if (empty($context['report']['mod_comments']))
-		echo '
-					<p class="centertext">', $txt['mc_modreport_no_mod_comment'], '</p>';
-
-	foreach ($context['report']['mod_comments'] as $comment)
-		echo
-					'<p>', $comment['member']['link'], ': ', $comment['message'], ' <em class="smalltext">(', $comment['time'], ')</em></p>';
-
-	echo '
-					<textarea rows="2" cols="60" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 60%; min-width: 60%' : 'width: 60%') . ';" name="mod_comment"></textarea>
-					<div>
-						<input type="submit" name="add_comment" value="', $txt['mc_modreport_add_mod_comment'], '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<br />';
-
-	$alt = false;
-
-	template_show_list('moderation_actions_list');
-
-	if (!empty($context['entries']))
-	{
-		echo '
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['mc_modreport_modactions'], '</h3>
-			</div>
-			<table width="100%" class="table_grid">
-				<thead>
-					<tr class="catbg">
-						<th>', $txt['modlog_action'], '</th>
-						<th>', $txt['modlog_date'], '</th>
-						<th>', $txt['modlog_member'], '</th>
-						<th>', $txt['modlog_position'], '</th>
-						<th>', $txt['modlog_ip'], '</th>
-					</tr>
-				</thead>
-				<tbody>';
-
-		foreach ($context['entries'] as $entry)
-		{
-			echo '
-					<tr class="', $alt ? 'windowbg2' : 'windowbg', '">
-						<td>', $entry['action'], '</td>
-						<td>', $entry['time'], '</td>
-						<td>', $entry['moderator']['link'], '</td>
-						<td>', $entry['position'], '</td>
-						<td>', $entry['ip'], '</td>
-					</tr>
-					<tr>
-						<td colspan="5" class="', $alt ? 'windowbg2' : 'windowbg', '">';
-
-			foreach ($entry['extra'] as $key => $value)
-				echo '
-							<em>', $key, '</em>: ', $value;
-			echo '
-						</td>
-					</tr>';
-		}
-		echo '
-				</tbody>
-			</table>';
-	}
-
-	echo '
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Callback function for showing a watched users post in the table.
@@ -659,7 +445,7 @@
 
 	// We'll have a delete please bob.
 	if (empty($delete_button))
-		$delete_button = create_button('delete.gif', 'remove_message', 'remove', 'align="middle"');
+		$delete_button = create_button('delete', 'remove_message', 'remove', 'class="centericon"');
 
 	$output_html = '
 					<div>
@@ -670,16 +456,16 @@
 
 	if ($post['can_delete'])
 		$output_html .= '
-							<a href="' . $scripturl . '?action=moderate;area=userwatch;sa=post;delete=' . $post['id'] . ';start=' . $context['start'] . ';' . $context['session_var'] . '=' . $context['session_id'] . '" onclick="return confirm(\'' . $txt['mc_watched_users_delete_post'] . '\');">' . $delete_button . '</a>
-							<input type="checkbox" name="delete[]" value="' . $post['id'] . '" class="input_check" />';
+							<a href="' . $scripturl . '?action=moderate;area=userwatch;sa=post;delete=' . $post['id'] . ';start=' . $context['start'] . ';' . $context['session_var'] . '=' . $context['session_id'] . '" data-confirm="'. $txt['mc_watched_users_delete_post'] . '" class="you_sure">' . $delete_button . '</a>
+							<input type="checkbox" name="delete[]" value="' . $post['id'] . '" class="input_check">';
 
 	$output_html .= '
 						</div>
-					</div><br />
+					</div><br>
 					<div class="smalltext">
 						&#171; ' . $txt['mc_watched_users_posted'] . ': ' . $post['poster_time'] . ' &#187;
 					</div>
-					<hr />
+					<hr>
 					' . $post['body'];
 
 	return $output_html;
@@ -688,94 +474,52 @@
 // Moderation settings
 function template_moderation_settings()
 {
-	global $settings, $options, $context, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
-	<div id="modcenter">
-		<form action="', $scripturl, '?action=moderate;area=settings" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['mc_prefs_title'], '</h3>
-			</div>
-			<div class="information">
-				', $txt['mc_prefs_desc'], '
-			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<strong>', $txt['mc_prefs_homepage'], ':</strong>
-						</dt>
-						<dd>';
+	<div id="modcenter">';
 
-	foreach ($context['homepage_blocks'] as $k => $v)
-		echo '
-							<label for="mod_homepage_', $k, '"><input type="checkbox" id="mod_homepage_', $k, '" name="mod_homepage[', $k, ']"', in_array($k, $context['mod_settings']['user_blocks']) ? ' checked="checked"' : '', ' class="input_check" /> ', $v, '</label><br />';
-
-	echo '
-						</dd>';
-
-	// If they can moderate boards they have more options!
-	if ($context['can_moderate_boards'])
+	if (!empty($context['can_moderate_approvals']))
 	{
 		echo '
-						<dt>
-							<strong><label for="mod_show_reports">', $txt['mc_prefs_show_reports'], '</label>:</strong>
-						</dt>
-						<dd>
-							<input type="checkbox" id="mod_show_reports" name="mod_show_reports" ', $context['mod_settings']['show_reports'] ? 'checked="checked"' : '', ' class="input_check" />
-						</dd>
-						<dt>
-							<strong><label for="mod_notify_report">', $txt['mc_prefs_notify_report'], '</label>:</strong>
-						</dt>
-						<dd>
-							<select id="mod_notify_report" name="mod_notify_report">
-								<option value="0" ', $context['mod_settings']['notify_report'] == 0 ? 'selected="selected"' : '', '>', $txt['mc_prefs_notify_report_never'], '</option>
-								<option value="1" ', $context['mod_settings']['notify_report'] == 1 ? 'selected="selected"' : '', '>', $txt['mc_prefs_notify_report_moderator'], '</option>
-								<option value="2" ', $context['mod_settings']['notify_report'] == 2 ? 'selected="selected"' : '', '>', $txt['mc_prefs_notify_report_always'], '</option>
-							</select>
-						</dd>';
-
+		<form action="', $scripturl, '?action=moderate;area=settings" method="post" accept-charset="', $context['character_set'], '">
+			<div class="windowbg">
+				<dl class="settings">
+					<dt>
+						<strong><label for="mod_notify_approval">', $txt['mc_prefs_notify_approval'], '</label>:</strong>
+					</dt>
+					<dd>
+						<input type="checkbox" id="mod_notify_approval" name="mod_notify_approval"', $context['mod_settings']['notify_approval'] ? ' checked' : '', ' class="input_check">
+					</dd>
+				</dl>
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['mod-set_token_var'], '" value="', $context['mod-set_token'], '">
+				<input type="submit" name="save" value="', $txt['save'], '" class="button_submit">
+			</div>
+		</form>';
 	}
-
-	if ($context['can_moderate_approvals'])
-	{
+	else
 		echo '
-
-						<dt>
-							<strong><label for="mod_notify_approval">', $txt['mc_prefs_notify_approval'], '</label>:</strong>
-						</dt>
-						<dd>
-							<input type="checkbox" id="mod_notify_approval" name="mod_notify_approval" ', $context['mod_settings']['notify_approval'] ? 'checked="checked"' : '', ' class="input_check" />
-						</dd>';
-	}
+		<div class="windowbg">
+			<div class="centertext">', $txt['mc_no_settings'], '</div>
+		</div>';
 
 	echo '
-					</dl>
-					<div class="righttext">
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="submit" name="save" value="', $txt['save'], '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Show a notice sent to a user.
 function template_show_notice()
 {
-	global $txt, $settings, $options, $context;
+	global $txt, $settings, $context, $modSettings;
 
 	// We do all the HTML for this one!
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
+		<meta charset="', $context['character_set'], '">
 		<title>', $context['page_title'], '</title>
-		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index.css" />
+		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index', $context['theme_variant'], '.css', $modSettings['browser_cache'] ,'">
 	</head>
 	<body>
 		<div class="cat_bar">
@@ -785,18 +529,14 @@
 			<h3 class="titlebg">', $txt['show_notice_subject'], ': ', $context['notice_subject'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl>
-					<dt>
-						<strong>', $txt['show_notice_text'], ':</strong>
-					</dt>
-					<dd>
-						', $context['notice_body'], '
-					</dd>
-				</dl>
-			</div>
-			<span class="botslice"><span></span></span>
+			<dl>
+				<dt>
+					<strong>', $txt['show_notice_text'], ':</strong>
+				</dt>
+				<dd>
+					', $context['notice_body'], '
+				</dd>
+			</dl>
 		</div>
 	</body>
 </html>';
@@ -806,7 +546,7 @@
 // Add or edit a warning template.
 function template_warn_template()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="modcenter">
@@ -818,43 +558,100 @@
 				', $txt['mc_warning_template_desc'], '
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
+				<div class="errorbox"', empty($context['warning_errors']) ? ' style="display: none"' : '', ' id="errors">
+					<dl>
 						<dt>
-							<strong><label for="template_title">', $txt['mc_warning_template_title'], '</label>:</strong>
+							<strong id="error_serious">', $txt['error_while_submitting'] , '</strong>
 						</dt>
-						<dd>
-							<input type="text" id="template_title" name="template_title" value="', $context['template_data']['title'], '" size="30" class="input_text" />
+						<dd class="error" id="error_list">
+							', empty($context['warning_errors']) ? '' : implode('<br>', $context['warning_errors']), '
 						</dd>
+					</dl>
+				</div>
+				<div id="box_preview"', !empty($context['template_preview']) ? '' : ' style="display:none"', '>
+					<dl class="settings">
 						<dt>
-							<strong><label for="template_body">', $txt['profile_warning_notify_body'], '</label>:</strong><br />
-							<span class="smalltext">', $txt['mc_warning_template_body_desc'], '</span>
+							<strong>', $txt['preview'] , '</strong>
 						</dt>
-						<dd>
-							<textarea id="template_body" name="template_body" rows="10" cols="45" class="smalltext">', $context['template_data']['body'], '</textarea>
+						<dd id="template_preview">
+							', !empty($context['template_preview']) ? $context['template_preview'] : '', '
 						</dd>
-					</dl>';
+					</dl>
+				</div>
+				<dl class="settings">
+					<dt>
+						<strong><label for="template_title">', $txt['mc_warning_template_title'], '</label>:</strong>
+					</dt>
+					<dd>
+						<input type="text" id="template_title" name="template_title" value="', $context['template_data']['title'], '" size="30" class="input_text">
+					</dd>
+					<dt>
+						<strong><label for="template_body">', $txt['profile_warning_notify_body'], '</label>:</strong><br>
+						<span class="smalltext">', $txt['mc_warning_template_body_desc'], '</span>
+					</dt>
+					<dd>
+						<textarea id="template_body" name="template_body" rows="10" cols="45" class="smalltext">', $context['template_data']['body'], '</textarea>
+					</dd>
+				</dl>';
 
 	if ($context['template_data']['can_edit_personal'])
 		echo '
-					<input type="checkbox" name="make_personal" id="make_personal" ', $context['template_data']['personal'] ? 'checked="checked"' : '', ' class="input_check" />
-						<label for="make_personal">
-							<strong>', $txt['mc_warning_template_personal'], '</strong>
-						</label>
-						<br />
-						<span class="smalltext">', $txt['mc_warning_template_personal_desc'], '</span>
-						<br />';
+				<input type="checkbox" name="make_personal" id="make_personal"', $context['template_data']['personal'] ? ' checked' : '', ' class="input_check">
+					<label for="make_personal">
+						<strong>', $txt['mc_warning_template_personal'], '</strong>
+					</label>
+					<br>
+					<span class="smalltext">', $txt['mc_warning_template_personal_desc'], '</span>
+					<br>';
 
 	echo '
-					<input type="submit" name="save" value="', $context['page_title'], '" class="button_submit" />
-				</div>
-				<span class="botslice"><span></span></span>
+				<hr class="hrcolor">
+				<input type="submit" name="preview" id="preview_button" value="', $txt['preview'], '" class="button_submit">
+				<input type="submit" name="save" value="', $context['page_title'], '" class="button_submit">
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['mod-wt_token_var'], '" value="', $context['mod-wt_token'], '">
 		</form>
 	</div>
-	<br class="clear" />';
+
+	<script><!-- // --><![CDATA[
+		$(document).ready(function() {
+			$("#preview_button").click(function() {
+				return ajax_getTemplatePreview();
+			});
+		});
+
+		function ajax_getTemplatePreview ()
+		{
+			$.ajax({
+				type: "POST",
+				url: "' . $scripturl . '?action=xmlhttp;sa=previews;xml",
+				data: {item: "warning_preview", title: $("#template_title").val(), body: $("#template_body").val(), user: $(\'input[name="u"]\').attr("value")},
+				context: document.body,
+				success: function(request){
+					$("#box_preview").css({display:""});
+					$("#template_preview").html($(request).find(\'body\').text());
+					if ($(request).find("error").text() != \'\')
+					{
+						$("#errors").css({display:""});
+						var errors_html = \'\';
+						var errors = $(request).find(\'error\').each(function() {
+							errors_html += $(this).text() + \'<br>\';
+						});
+
+						$(document).find("#error_list").html(errors_html);
+					}
+					else
+					{
+						$("#errors").css({display:"none"});
+						$("#error_list").html(\'\');
+					}
+				return false;
+				},
+			});
+			return false;
+		}
+	// ]]></script>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/MoveTopic.template.php b/Themes/default/MoveTopic.template.php
--- a/Themes/default/MoveTopic.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/MoveTopic.template.php	2015-03-05 23:33:03.409394841 -0800
@@ -3,88 +3,384 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
-// Show an interface for selecting which board to move a post to.
-function template_main()
+/**
+ * Show an interface for selecting which board to move a post to.
+ */
+function template_move()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="move_topic" class="lower_padding">
-		<form action="', $scripturl, '?action=movetopic2;topic=', $context['current_topic'], '.0" method="post" accept-charset="', $context['character_set'], '" onsubmit="submitonce(this);">
+		<form action="', $scripturl, '?action=movetopic2;current_board=' . $context['current_board'] . ';topic=', $context['current_topic'], '.0" method="post" accept-charset="', $context['character_set'], '" onsubmit="submitonce(this);">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['move_topic'], '</h3>
 			</div>
 			<div class="windowbg centertext">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<div class="move_topic">
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['move_to'], ':</strong>
-							</dt>
-							<dd>
-								<select name="toboard">';
+				<div class="move_topic">
+					<dl class="settings">
+						<dt>
+							<strong>', $txt['move_to'], ':</strong>
+						</dt>
+						<dd>
+							<select name="toboard">';
 
 	foreach ($context['categories'] as $category)
 	{
 		echo '
-									<optgroup label="', $category['name'], '">';
+								<optgroup label="', $category['name'], '">';
 
 		foreach ($category['boards'] as $board)
 			echo '
-										<option value="', $board['id'], '"', $board['selected'] ? ' selected="selected"' : '', $board['id'] == $context['current_board'] ? ' disabled="disabled"' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level']-1) . '=&gt; ' : '', $board['name'], '</option>';
+									<option value="', $board['id'], '"', $board['selected'] ? ' selected' : '', $board['id'] == $context['current_board'] ? ' disabled' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level']-1) . '=&gt; ' : '', $board['name'], '</option>';
 		echo '
-									</optgroup>';
+								</optgroup>';
 	}
 
 	echo '
-								</select>
-							</dd>';
+							</select>
+						</dd>';
 
 	// Disable the reason textarea when the postRedirect checkbox is unchecked...
 	echo '
+					</dl>
+					<label for="reset_subject"><input type="checkbox" name="reset_subject" id="reset_subject" onclick="document.getElementById(\'subjectArea\').style.display = this.checked ? \'block\' : \'none\';" class="input_check"> ', $txt['movetopic_change_subject'], '.</label><br>
+   					<fieldset id="subjectArea" style="display: none;">
+						<dl class="settings">
+							<dt><strong>', $txt['movetopic_new_subject'], ':</strong></dt>
+							<dd><input type="text" name="custom_subject" size="30" value="', $context['subject'], '" class="input_text"></dd>
 						</dl>
-						<label for="reset_subject"><input type="checkbox" name="reset_subject" id="reset_subject" onclick="document.getElementById(\'subjectArea\').style.display = this.checked ? \'block\' : \'none\';" class="input_check" /> ', $txt['moveTopic2'], '.</label><br />
-						<fieldset id="subjectArea" style="display: none;">
-							<dl class="settings">
-								<dt><strong>', $txt['moveTopic3'], ':</strong></dt>
-								<dd><input type="text" name="custom_subject" size="30" value="', $context['subject'], '" class="input_text" /></dd>
-							</dl>
-							<label for="enforce_subject"><input type="checkbox" name="enforce_subject" id="enforce_subject" class="input_check" /> ', $txt['moveTopic4'], '.</label>
-						</fieldset>
-						<label for="postRedirect"><input type="checkbox" name="postRedirect" id="postRedirect" ', $context['is_approved'] ? 'checked="checked"' : '', ' onclick="', $context['is_approved'] ? '' : 'if (this.checked && !confirm(\'' . $txt['move_topic_unapproved_js'] . '\')) return false; ', 'document.getElementById(\'reasonArea\').style.display = this.checked ? \'block\' : \'none\';" class="input_check" /> ', $txt['moveTopic1'], '.</label>
-						<fieldset id="reasonArea" style="margin-top: 1ex;', $context['is_approved'] ? '' : 'display: none;', '">
-							<dl class="settings">
-								<dt>
-									', $txt['moved_why'], '
-								</dt>
-								<dd>
-									<textarea name="reason" rows="3" cols="40">', $txt['movetopic_default'], '</textarea>
-								</dd>
-							</dl>
-						</fieldset>
-						<div class="righttext">
-							<input type="submit" value="', $txt['move_topic'], '" onclick="return submitThisOnce(this);" accesskey="s" class="button_submit" />
-						</div>
-					</div>
+						<label for="enforce_subject"><input type="checkbox" name="enforce_subject" id="enforce_subject" class="input_check"> ', $txt['movetopic_change_all_subjects'], '.</label>
+					</fieldset>';
+
+	// Stick our "create a redirection topic" template in here...
+	template_redirect_options('move');
+    
+    echo '
+					<input type="submit" value="', $txt['move_topic'], '" onclick="return submitThisOnce(this);" accesskey="s" class="button_submit">
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>';
 
 	if ($context['back_to_topic'])
 		echo '
-			<input type="hidden" name="goback" value="1" />';
+			<input type="hidden" name="goback" value="1">';
+
+	echo '
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '">
+		</form>
+	</div>';
+}
+
+/**
+ * @var string $type What type of topic this is for - currently 'merge' or 'move'. Used to display appropriate text strings...
+ */
+function template_redirect_options($type)
+{
+    global $txt, $context, $modSettings;
+
+    echo '
+					<label for="postRedirect"><input type="checkbox" name="postRedirect" id="postRedirect"', $context['is_approved'] ? ' checked' : '', ' onclick="', $context['is_approved'] ? '' : 'if (this.checked && !confirm(\'' . $txt[$type . '_topic_unapproved_js'] . '\')) return false; ', 'document.getElementById(\'reasonArea\').style.display = this.checked ? \'block\' : \'none\';" class="input_check"> ', $txt['post_redirection'], '.</label>
+					<fieldset id="reasonArea" style="margin-top: 1ex;', $context['is_approved'] ? '' : 'display: none;', '">
+						<dl class="settings">
+							<dt>
+								', $txt[$type . '_why'], '
+							</dt>
+							<dd>
+								<textarea name="reason">', $txt[$type . 'topic_default'], '</textarea>
+							</dd>
+							<dt>
+								<label for="redirect_topic">', $txt[$type . 'topic_redirect'], '</label>
+							</dt>
+							<dd>
+								<input type="checkbox" name="redirect_topic" id="redirect_topic" checked class="input_check">
+							</dd>';
+	if (!empty($modSettings['allow_expire_redirect']))
+	{
+		echo '
+							<dt>
+								', $txt['redirect_topic_expires'], '
+							</dt>
+							<dd>
+								<select name="redirect_expires">
+									<option value="0">', $txt['never'], '</option>
+									<option value="1440">', $txt['one_day'], '</option>
+									<option value="10080" selected>', $txt['one_week'], '</option>
+									<option value="20160">', $txt['two_weeks'], '</option>
+									<option value="43200">', $txt['one_month'], '</option>
+									<option value="86400">', $txt['two_months'], '</option>
+								</select>
+							</dd>';
+	}
+	else
+	{
+		echo '
+							<input type="hidden" name="redirect_expires" value="0">';
+	}
+
+	echo '
+						</dl>
+					</fieldset>';
+}
+
+function template_merge_done()
+{
+	global $context, $txt, $scripturl;
+
+	echo '
+		<div id="merge_topics">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['merge'], '</h3>
+			</div>
+			<div class="windowbg">
+				<p>', $txt['merge_successful'], '</p>
+				<br>
+				<ul class="reset">
+					<li>
+						<a href="', $scripturl, '?board=', $context['target_board'], '.0">', $txt['message_index'], '</a>
+					</li>
+					<li>
+						<a href="', $scripturl, '?topic=', $context['target_topic'], '.0">', $txt['new_merged_topic'], '</a>
+					</li>
+				</ul>
+			</div>
+		</div>
+	<br class="clear">';
+}
+
+function template_merge()
+{
+	global $context, $txt, $scripturl;
+
+	echo '
+		<div id="merge_topics">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['merge'], '</h3>
+			</div>
+			<div class="information">
+				', $txt['merge_desc'], '
+			</div>
+			<div class="windowbg">
+				<dl class="settings merge_topic">
+					<dt>
+						<strong>', $txt['topic_to_merge'], ':</strong>
+					</dt>
+					<dd>
+						', $context['origin_subject'], '
+					</dd>
+				</dl>
+			</div><br>
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['target_topic'], '</h3>
+			</div>
+			<div class="title_bar">
+				<h4 class="titlebg">';
+
+	if (isset($context['merge_categories']))
+	{
+		echo '
+					<form action="' . $scripturl . '?action=mergetopics;from=' . $context['origin_topic'] . ';targetboard=' . $context['target_board'] . ';board=' . $context['current_board'] . '.0" method="post" accept-charset="', $context['character_set'], '" id="mergeSelectBoard">
+						', $txt['target_below'], ' (', $txt['board'], ':&nbsp;
+						<select name="targetboard" onchange="this.form.submit();">';
+		foreach ($context['merge_categories'] as $cat)
+		{
+			echo '
+							<optgroup label="', $cat['name'], '">';
+
+			foreach ($cat['boards'] as $board)
+			{
+				echo '
+								<option value="', $board['id'], '"', $board['selected'] ? ' selected' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level'] - 1) . '=&gt;' : '', ' ', $board['name'], '&nbsp;</option>';
+			}
+
+			echo '
+							</optgroup>';
+		}
+		echo '
+						</select>)
+						<input type="hidden" name="from" value="' . $context['origin_topic'] . '">
+						<input type="submit" value="', $txt['go'], '" class="button_submit">
+					</form>';
+
+	}
+	else
+		echo $txt['target_below'];
+
+	echo '				</h4>
+			</div>';
+
+	// Don't show this if there aren't any topics...
+	if (!empty($context['topics']))
+	{
+		echo '
+			<form action="', $scripturl, '?action=mergetopics;sa=options" method="post" accept-charset="', $context['character_set'], '">
+				<div class="pagesection">
+					', $context['page_index'], '
+				</div>
+				<div class="windowbg2">
+					<ul class="reset merge_topics">';
+
+		$merge_button = create_button('merge', 'merge', '');
+
+		foreach ($context['topics'] as $topic)
+			echo '
+						<li>
+							<a href="', $scripturl, '?action=mergetopics;sa=options;board=', $context['current_board'], '.0;from=', $context['origin_topic'], ';to=', $topic['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $merge_button, '</a>&nbsp;
+							<a href="', $scripturl, '?topic=', $topic['id'], '.0" target="_blank" class="new_win">', $topic['subject'], '</a> ', $txt['started_by'], ' ', $topic['poster']['link'], '
+						</li>';
+
+		echo '
+					</ul>
+					<input type="submit" value="', $txt['merge'], '" class="button_submit">
+				</div>
+				<div class="pagesection">
+					', $context['page_index'], '
+				</div>';
+	}
+	else
+	{
+		// Just a nice "There aren't any topics" message
+		echo '
+				<div class="windowbg2">', $txt['topic_alert_none'], '</div>';
+	}
+
+	echo '
+				<br>
+				<div class="title_bar">
+					<h4 class="titlebg">', $txt['target_id'], '</h4>
+				</div>
+				<div class="windowbg">
+					<dl class="settings merge_topic">
+						<dt>
+							<strong>', $txt['merge_to_topic_id'], ': </strong>
+						</dt>
+						<dd>
+								<input type="hidden" name="topics[]" value="', $context['origin_topic'], '">
+								<input type="text" name="topics[]" class="input_text">
+								<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+
+						</dd>
+					</dl>
+					<input type="submit" value="', $txt['merge'], '" class="button_submit">
+				</div>
+			</form>
+		</div>';
+}
+
+function template_merge_extra_options()
+{
+	global $context, $txt, $scripturl;
+
+	echo '
+	<div id="merge_topics">
+		<form action="', $scripturl, '?action=mergetopics;sa=execute;" method="post" accept-charset="', $context['character_set'], '">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['merge_topic_list'], '</h3>
+			</div>
+			<table class="bordercolor table_grid">
+				<thead>
+					<tr class="title_bar">
+						<th scope="col" width="10px">', $txt['merge_check'], '</th>
+						<th scope="col" class="lefttext">', $txt['subject'], '</th>
+						<th scope="col" class="lefttext">', $txt['started_by'], '</th>
+						<th scope="col" class="lefttext">', $txt['last_post'], '</th>
+						<th scope="col" width="20px">' . $txt['merge_include_notifications'] . '</th>
+					</tr>
+				</thead>
+				<tbody>';
+		foreach ($context['topics'] as $topic)
+			echo '
+					<tr class="windowbg">
+						<td>
+							<input type="checkbox" class="input_check" name="topics[]" value="' . $topic['id'] . '" checked>
+						</td>
+						<td>
+							<a href="' . $scripturl . '?topic=' . $topic['id'] . '.0" target="_blank" class="new_win">' . $topic['subject'] . '</a>
+						</td>
+						<td>
+							', $topic['started']['link'], '<br>
+							<span class="smalltext">', $topic['started']['time'], '</span>
+						</td>
+						<td>
+							' . $topic['updated']['link'] . '<br>
+							<span class="smalltext">', $topic['updated']['time'], '</span>
+						</td>
+						<td>
+							<input type="checkbox" class="input_check" name="notifications[]" value="' . $topic['id'] . '" checked>
+						</td>
+					</tr>';
+		echo '
+				</tbody>
+			</table>
+			<br>
+			<div class="windowbg">';
 
 	echo '
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '" />
+				<fieldset id="merge_subject" class="merge_options">
+					<legend>', $txt['merge_select_subject'], '</legend>
+					<select name="subject" onchange="this.form.custom_subject.style.display = (this.options[this.selectedIndex].value != 0) ? \'none\': \'\' ;">';
+	foreach ($context['topics'] as $topic)
+		echo '
+						<option value="', $topic['id'], '"' . ($topic['selected'] ? ' selected' : '') . '>', $topic['subject'], '</option>';
+	echo '
+						<option value="0">', $txt['merge_custom_subject'], ':</option>
+					</select>
+					<br><input type="text" name="custom_subject" size="60" id="custom_subject" class="input_text custom_subject" style="display: none;">
+					<br>
+					<label for="enforce_subject"><input type="checkbox" class="input_check" name="enforce_subject" id="enforce_subject" value="1"> ', $txt['movetopic_change_all_subjects'], '</label>
+				</fieldset>';
+
+	// Show an option to create a redirection topic as well...
+	template_redirect_options('merge');
+
+	if (!empty($context['boards']) && count($context['boards']) > 1)
+	{
+		echo '
+				<fieldset id="merge_board" class="merge_options">
+					<legend>', $txt['merge_select_target_board'], '</legend>
+					<ul class="reset">';
+		foreach ($context['boards'] as $board)
+			echo '
+						<li>
+							<input type="radio" name="board" value="' . $board['id'] . '"' . ($board['selected'] ? ' checked' : '') . ' class="input_radio"> ' . $board['name'] . '
+						</li>';
+		echo '
+					</ul>
+				</fieldset>';
+	}
+	if (!empty($context['polls']))
+	{
+		echo '
+				<fieldset id="merge_poll" class="merge_options">
+					<legend>' . $txt['merge_select_poll'] . '</legend>
+					<ul class="reset">';
+		foreach ($context['polls'] as $poll)
+			echo '
+						<li>
+							<input type="radio" name="poll" value="' . $poll['id'] . '"' . ($poll['selected'] ? ' checked' : '') . ' class="input_radio"> ' . $poll['question'] . ' (' . $txt['topic'] . ': <a href="' . $scripturl . '?topic=' . $poll['topic']['id'] . '.0" target="_blank" class="new_win">' . $poll['topic']['subject'] . '</a>)
+						</li>';
+		echo '
+						<li>
+							<input type="radio" name="poll" value="-1" class="input_radio"> (' . $txt['merge_no_poll'] . ')
+						</li>
+					</ul>
+				</fieldset>';
+	}
+
+	echo '
+				<div class="auto_flow">
+					<input type="submit" value="' . $txt['merge'] . '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="sa" value="execute">
+				</div>
+			</div>
 		</form>
 	</div>';
 }
diff -ru a/Themes/default/Notify.template.php b/Themes/default/Notify.template.php
--- a/Themes/default/Notify.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Notify.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,51 +3,47 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_main()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/email_sm.gif" alt="" class="icon" />', $txt['notify'], '</span>
+				<span class="generic_icons mail icon"></span>', $txt['notify'], '
 			</h3>
 		</div>
-		<span class="upperframe"><span></span></span>
 		<div class="roundframe centertext">
 			<p>', $context['notification_set'] ? $txt['notify_deactivate'] : $txt['notify_request'], '</p>
 			<p>
 				<strong><a href="', $scripturl, '?action=notify;sa=', $context['notification_set'] ? 'off' : 'on', ';topic=', $context['current_topic'], '.', $context['start'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['yes'], '</a> - <a href="', $context['topic_href'], '">', $txt['no'], '</a></strong>
 			</p>
-		</div>
-		<span class="lowerframe"><span></span></span>';
+		</div>';
 }
 
 function template_notify_board()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/email_sm.gif" alt="" class="icon" />', $txt['notify'], '</span>
+				<span class="generic_icons mail icon"></span>', $txt['notify'], '
 			</h3>
 		</div>
-		<span class="upperframe"><span></span></span>
 		<div class="roundframe centertext">
 			<p>', $context['notification_set'] ? $txt['notifyboard_turnoff'] : $txt['notifyboard_turnon'], '</p>
 			<p>
 				<strong><a href="', $scripturl, '?action=notifyboard;sa=', $context['notification_set'] ? 'off' : 'on', ';board=', $context['current_board'], '.', $context['start'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['yes'], '</a> - <a href="', $context['board_href'], '">', $txt['no'], '</a></strong>
 			</p>
-		</div>
-		<span class="lowerframe"><span></span></span>';
+		</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Packages.template.php b/Themes/default/Packages.template.php
--- a/Themes/default/Packages.template.php	2011-06-06 10:06:37.000000000 -0700
+++ b/Themes/default/Packages.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,21 +3,20 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_main()
 {
-	global $context, $settings, $options;
 }
 
 function template_view_package()
 {
-	global $context, $settings, $options, $txt, $scripturl, $smcFunc;
+	global $context, $settings, $txt, $scripturl;
 
 	echo '
 	<div id="admincenter">
@@ -28,24 +27,26 @@
 
 	if ($context['is_installed'])
 		echo '
-			<strong>', $txt['package_installed_warning1'], '</strong><br />
-			<br />
-			', $txt['package_installed_warning2'], '<br />
-			<br />';
+			<strong>', $txt['package_installed_warning1'], '</strong><br>
+			<br>
+			', $txt['package_installed_warning2'], '<br>
+			<br>';
 
 	echo $txt['package_installed_warning3'], '
-		</div>';
+		</div><br>';
 
 	// Do errors exist in the install? If so light them up like a christmas tree.
 	if ($context['has_failure'])
 	{
 		echo '
 		<div class="errorbox">
-			<strong>', $txt['package_will_fail_title'], '</strong><br />
-			', $txt['package_will_fail_warning'], '
+			', sprintf($txt['package_will_fail_title'], $txt['package_' . ($context['uninstalling'] ? 'uninstall' : 'install')]), '<br>
+			', sprintf($txt['package_will_fail_warning'], $txt['package_' . ($context['uninstalling'] ? 'uninstall' : 'install')]),
+			!empty($context['failure_details']) ? '<br><br><strong>' . $context['failure_details'] . '</strong>' : '', '
 		</div>';
 	}
 
+	// Display the package readme if one exists
 	if (isset($context['package_readme']))
 	{
 		echo '
@@ -53,24 +54,40 @@
 				<h3 class="catbg">', $txt['package_' . ($context['uninstalling'] ? 'un' : '') . 'install_readme'], '</h3>
 			</div>
 			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					', $context['package_readme'], '
-					<span class="floatright">', $txt['package_available_readme_language'], '
-						<select name="readme_language" id="readme_language" onchange="if (this.options[this.selectedIndex].value) window.location.href = smf_prepareScriptUrl(smf_scripturl + \'', '?action=admin;area=packages;sa=', $context['uninstalling'] ? 'uninstall' : 'install', ';package=', $context['filename'], ';readme=\' + this.options[this.selectedIndex].value);">';
-							foreach ($context['readmes'] as $a => $b)
-								echo '<option value="', $b, '"', $a === 'selected' ? ' selected="selected"' : '', '>', $b == 'default' ? $txt['package_readme_default'] : ucfirst($b), '</option>';
+				', $context['package_readme'], '
+				<span class="floatright">', $txt['package_available_readme_language'], '
+					<select name="readme_language" id="readme_language" onchange="if (this.options[this.selectedIndex].value) window.location.href = smf_prepareScriptUrl(smf_scripturl + \'', '?action=admin;area=packages;sa=', $context['uninstalling'] ? 'uninstall' : 'install', ';package=', $context['filename'], ';readme=\' + this.options[this.selectedIndex].value + \';license=\' + get_selected(\'license_language\'));">';
+						foreach ($context['readmes'] as $a => $b)
+							echo '<option value="', $b, '"', $a === 'selected' ? ' selected' : '', '>', $b == 'default' ? $txt['package_readme_default'] : ucfirst($b), '</option>';
 			echo '
-						</select>
-					</span>
-				</div>
-				<span class="botslice"><span></span></span>
+					</select>
+				</span>
+			</div>
+			<br>';
+	}
+
+	// Did they specify a license to display?
+	if (isset($context['package_license']))
+	{
+		echo '
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['package_install_license'], '</h3>
+			</div>
+			<div class="windowbg2">
+				', $context['package_license'], '
+				<span class="floatright">', $txt['package_available_license_language'], '
+					<select name="license_language" id="license_language" onchange="if (this.options[this.selectedIndex].value) window.location.href = smf_prepareScriptUrl(smf_scripturl + \'', '?action=admin;area=packages;sa=install', ';package=', $context['filename'], ';license=\' + this.options[this.selectedIndex].value + \';readme=\' + get_selected(\'readme_language\'));">';
+						foreach ($context['licenses'] as $a => $b)
+							echo '<option value="', $b, '"', $a === 'selected' ? ' selected' : '', '>', $b == 'default' ? $txt['package_license_default'] : ucfirst($b), '</option>';
+			echo '
+					</select>
+				</span>
 			</div>
-			<br />';
+			<br>';
 	}
 
 	echo '
-		<form action="', $scripturl, '?action=admin;area=packages;sa=', $context['uninstalling'] ? 'uninstall' : 'install', $context['ftp_needed'] ? '' : '2', ';package=', $context['filename'], ';pid=', $context['install_id'], '" onsubmit="submitonce(this);" method="post" accept-charset="', $context['character_set'], '">
+		<form action="', !empty($context['post_url']) ? $context['post_url'] : '#', '" onsubmit="submitonce(this);" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">
 					', $context['uninstalling'] ? $txt['package_uninstall_actions'] : $txt['package_install_actions'], ' &quot;', $context['package_name'], '&quot;
@@ -81,22 +98,18 @@
 	if ($context['uninstalling'] && !empty($context['database_changes']))
 	{
 		echo '
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<label for="do_db_changes"><input type="checkbox" name="do_db_changes" id="do_db_changes" class="input_check" />', $txt['package_db_uninstall'], '</label> [<a href="#" onclick="return swap_database_changes();">', $txt['package_db_uninstall_details'], '</a>]
-					<div id="db_changes_div">
-						', $txt['package_db_uninstall_actions'], ':
-						<ul>';
+			<div class="windowbg2 winfo">
+				<label for="do_db_changes"><input type="checkbox" name="do_db_changes" id="do_db_changes" class="input_check">', $txt['package_db_uninstall'], '</label> [<a href="#" onclick="return swap_database_changes();">', $txt['package_db_uninstall_details'], '</a>]
+				<div id="db_changes_div">
+					', $txt['package_db_uninstall_actions'], ':
+					<ul>';
 
 		foreach ($context['database_changes'] as $change)
 			echo '
-							<li>', $change, '</li>';
+						<li>', $change, '</li>';
 		echo '
-						</ul>
-					</div>
+					</ul>
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>';
 	}
 
@@ -105,26 +118,28 @@
 
 	if (empty($context['actions']) && empty($context['database_changes']))
 		echo '
-				<strong>', $txt['corrupt_compatible'], '</strong>
+				<br>
+				<div class="errorbox">
+					', $txt['corrupt_compatible'], '
+				</div>
 			</div>';
 	else
 	{
 		echo '
 					', $txt['perform_actions'], '
-			</div>
-			<table class="table_grid" width="100%">
+			</div><br>
+			<table class="table_grid">
 			<thead>
-				<tr class="catbg">
+				<tr class="title_bar">
 					<th scope="col" width="20"></th>
 					<th scope="col" width="30"></th>
 					<th scope="col" class="lefttext">', $txt['package_install_type'], '</th>
 					<th scope="col" class="lefttext" width="50%">', $txt['package_install_action'], '</th>
-					<th scope="col" class="lefttext" width="20%">', $txt['package_install_desc'], '</th>
+					<th class="lefttext" scope="col" width="20%">', $txt['package_install_desc'], '</th>
 				</tr>
 			</thead>
 			<tbody>';
 
-		$alternate = true;
 		$i = 1;
 		$action_num = 1;
 		$js_operations = array();
@@ -134,8 +149,8 @@
 			$js_operations[$action_num] = isset($packageaction['failed']) ? $packageaction['failed'] : 0;
 
 			echo '
-				<tr class="windowbg', $alternate ? '' : '2', '">
-					<td>', isset($packageaction['operations']) ? '<img id="operation_img_' . $action_num . '" src="' . $settings['images_url'] . '/sort_down.gif" alt="*" style="display: none;" />' : '', '</td>
+				<tr class="windowbg">
+					<td>', isset($packageaction['operations']) ? '<img id="operation_img_' . $action_num . '" src="' . $settings['images_url'] . '/selected_open.png" alt="*" style="display: none;">' : '', '</td>
 					<td>', $i++, '.</td>
 					<td>', $packageaction['type'], '</td>
 					<td>', $packageaction['action'], '</td>
@@ -147,11 +162,10 @@
 			{
 				echo '
 				<tr id="operation_', $action_num, '">
-					<td colspan="5" class="windowbg3">
-						<table border="0" cellpadding="3" cellspacing="0" width="100%">';
+					<td colspan="5" class="windowbg2">
+						<table width="100%">';
 
 				// Show the operations.
-				$alternate2 = true;
 				$operation_num = 1;
 				foreach ($packageaction['operations'] as $operation)
 				{
@@ -159,9 +173,9 @@
 					$operation_text = $operation['position'] == 'replace' ? 'operation_replace' : ($operation['position'] == 'before' ? 'operation_after' : 'operation_before');
 
 					echo '
-							<tr class="windowbg', $alternate2 ? '' : '2', '">
+							<tr class="windowbg">
 								<td width="0"></td>
-								<td width="30" class="smalltext"><a href="' . $scripturl . '?action=admin;area=packages;sa=showoperations;operation_key=', $operation['operation_key'], ';package=', $_REQUEST['package'], ';filename=', $operation['filename'], ($operation['is_boardmod'] ? ';boardmod' : ''), (isset($_REQUEST['sa']) && $_REQUEST['sa'] == 'uninstall' ? ';reverse' : ''), '" onclick="return reqWin(this.href, 680, 400, false);"><img src="', $settings['default_images_url'], '/admin/package_ops.gif" alt="" /></a></td>
+								<td width="30" class="smalltext"><a href="' . $scripturl . '?action=admin;area=packages;sa=showoperations;operation_key=', $operation['operation_key'], !empty($context['install_id']) ? ';install_id=' . $context['install_id'] : '', ';package=', $_REQUEST['package'], ';filename=', $operation['filename'], ($operation['is_boardmod'] ? ';boardmod' : ''), (isset($_REQUEST['sa']) && $_REQUEST['sa'] == 'uninstall' ? ';reverse' : ''), '" onclick="return reqWin(this.href, 680, 400, false);"><span class="generic_icons package_ops"></span></a></td>
 								<td width="30" class="smalltext">', $operation_num, '.</td>
 								<td width="23%" class="smalltext">', $txt[$operation_text], '</td>
 								<td width="50%" class="smalltext">', $operation['action'], '</td>
@@ -169,7 +183,6 @@
 							</tr>';
 
 					$operation_num++;
-					$alternate2 = !$alternate2;
 				}
 
 				echo '
@@ -180,18 +193,16 @@
 				// Increase it.
 				$action_num++;
 			}
-			$alternate = !$alternate;
 		}
 					echo '
 			</tbody>
-			</table>
-			';
+			</table>';
 
 		// What if we have custom themes we can install into? List them too!
 		if (!empty($context['theme_actions']))
 		{
 			echo '
-			<br />
+			<br>
 			<div class="cat_bar">
 				<h3 class="catbg">
 					', $context['uninstalling'] ? $txt['package_other_themes_uninstall'] : $txt['package_other_themes'], '
@@ -201,7 +212,7 @@
 				<div class="information">
 					', $txt['package_other_themes_desc'], '
 				</div>
-				<table class="table_grid" width="100%">';
+				<table class="table_grid">';
 
 			// Loop through each theme and display it's name, and then it's details.
 			foreach ($context['theme_actions'] as $id => $theme)
@@ -210,14 +221,14 @@
 				$js_operations[$action_num] = !empty($theme['has_failure']);
 
 				echo '
-					<tr class="catbg">
+					<tr class="title_bar">
 						<td></td>
-						<td align="center">';
+						<td>';
 				if (!empty($context['themes_locked']))
 					echo '
-							<input type="hidden" name="custom_theme[]" value="', $id, '" />';
+							<input type="hidden" name="custom_theme[]" value="', $id, '">';
 				echo '
-							<input type="checkbox" name="custom_theme[]" id="custom_theme_', $id, '" value="', $id, '" class="input_check" onclick="', (!empty($theme['has_failure']) ? 'if (this.form.custom_theme_' . $id . '.checked && !confirm(\'' . $txt['package_theme_failure_warning'] . '\')) return false;' : ''), 'invertAll(this, this.form, \'dummy_theme_', $id, '\', true);" ', !empty($context['themes_locked']) ? 'disabled="disabled" checked="checked"' : '', '/>
+							<input type="checkbox" name="custom_theme[]" id="custom_theme_', $id, '" value="', $id, '" class="input_check" onclick="', (!empty($theme['has_failure']) ? 'if (this.form.custom_theme_' . $id . '.checked && !confirm(\'' . $txt['package_theme_failure_warning'] . '\')) return false;' : ''), 'invertAll(this, this.form, \'dummy_theme_', $id, '\', true);"', !empty($context['themes_locked']) ? ' disabled checked' : '', '>
 						</td>
 						<td colspan="3">
 							', $theme['name'], '
@@ -227,10 +238,10 @@
 				foreach ($theme['actions'] as $action)
 				{
 					echo '
-					<tr class="windowbg', $alternate ? '' : '2', '">
-						<td>', isset($packageaction['operations']) ? '<img id="operation_img_' . $action_num . '" src="' . $settings['images_url'] . '/sort_down.gif" alt="*" style="display: none;" />' : '', '</td>
-						<td width="30" align="center">
-							<input type="checkbox" name="theme_changes[]" value="', !empty($action['value']) ? $action['value'] : '', '" id="dummy_theme_', $id, '" class="input_check" ', (!empty($action['not_mod']) ? '' : 'disabled="disabled"'), ' ', !empty($context['themes_locked']) ? 'checked="checked"' : '', '/>
+					<tr class="windowbg">
+						<td>', isset($packageaction['operations']) ? '<img id="operation_img_' . $action_num . '" src="' . $settings['images_url'] . '/selected_open.png" alt="*" style="display: none;">' : '', '</td>
+						<td width="30">
+							<input type="checkbox" name="theme_changes[]" value="', !empty($action['value']) ? $action['value'] : '', '" id="dummy_theme_', $id, '" class="input_check"', (!empty($action['not_mod']) ? '' : ' disabled'), !empty($context['themes_locked']) ? ' checked' : '', '>
 						</td>
 						<td>', $action['type'], '</td>
 						<td width="50%">', $action['action'], '</td>
@@ -242,10 +253,9 @@
 					{
 						echo '
 					<tr id="operation_', $action_num, '">
-						<td colspan="5" class="windowbg3">
-							<table border="0" cellpadding="3" cellspacing="0" width="100%">';
+						<td colspan="5" class="windowbg2">
+							<table width="100%">';
 
-						$alternate2 = true;
 						$operation_num = 1;
 						foreach ($action['operations'] as $operation)
 						{
@@ -253,16 +263,15 @@
 							$operation_text = $operation['position'] == 'replace' ? 'operation_replace' : ($operation['position'] == 'before' ? 'operation_after' : 'operation_before');
 
 							echo '
-								<tr class="windowbg', $alternate2 ? '' : '2', '">
+								<tr class="windowbg">
 									<td width="0"></td>
-									<td width="30" class="smalltext"><a href="' . $scripturl . '?action=admin;area=packages;sa=showoperations;operation_key=', $operation['operation_key'], ';package=', $_REQUEST['package'], ';filename=', $operation['filename'], ($operation['is_boardmod'] ? ';boardmod' : ''), (isset($_REQUEST['sa']) && $_REQUEST['sa'] == 'uninstall' ? ';reverse' : ''), '" onclick="return reqWin(this.href, 600, 400, false);"><img src="', $settings['default_images_url'], '/admin/package_ops.gif" alt="" /></a></td>
+									<td width="30" class="smalltext"><a href="' . $scripturl . '?action=admin;area=packages;sa=showoperations;operation_key=', $operation['operation_key'], !empty($context['install_id']) ? ';install_id=' . $context['install_id'] : '', ';package=', $_REQUEST['package'], ';filename=', $operation['filename'], ($operation['is_boardmod'] ? ';boardmod' : ''), (isset($_REQUEST['sa']) && $_REQUEST['sa'] == 'uninstall' ? ';reverse' : ''), '" onclick="return reqWin(this.href, 600, 400, false);"><span class="generic_icons package_ops"></span></a></td>
 									<td width="30" class="smalltext">', $operation_num, '.</td>
 									<td width="23%" class="smalltext">', $txt[$operation_text], '</td>
 									<td width="50%" class="smalltext">', $operation['action'], '</td>
 									<td width="20%" class="smalltext">', $operation['description'], !empty($operation['ignore_failure']) ? ' (' . $txt['operation_ignore'] . ')' : '', '</td>
 								</tr>';
 							$operation_num++;
-							$alternate2 = !$alternate2;
 						}
 
 						echo '
@@ -274,8 +283,6 @@
 						$action_num++;
 					}
 				}
-
-				$alternate = !$alternate;
 			}
 
 			echo '
@@ -289,7 +296,7 @@
 	{
 		echo '
 			<div class="righttext padding">
-				<input type="submit" value="', $context['uninstalling'] ? $txt['package_uninstall_now'] : $txt['package_install_now'], '" onclick="return ', !empty($context['has_failure']) ? '(submitThisOnce(this) &amp;&amp; confirm(\'' . ($context['uninstalling'] ? $txt['package_will_fail_popup_uninstall'] : $txt['package_will_fail_popup']) . '\'))' : 'submitThisOnce(this)', ';" class="button_submit" />
+				<input type="submit" value="', $context['uninstalling'] ? $txt['package_uninstall_now'] : $txt['package_install_now'], '" onclick="return ', !empty($context['has_failure']) ? '(submitThisOnce(this) &amp;&amp; confirm(\'' . ($context['uninstalling'] ? $txt['package_will_fail_popup_uninstall'] : $txt['package_will_fail_popup']) . '\'))' : 'submitThisOnce(this)', ';" class="button_submit">
 			</div>';
 	}
 	// If we need ftp information then demand it!
@@ -305,15 +312,14 @@
 	}
 		echo '
 
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />', (isset($context['form_sequence_number']) && !$context['ftp_needed']) ? '
-			<input type="hidden" name="seqnum" value="' . $context['form_sequence_number'] . '" />' : '', '
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">', (isset($context['form_sequence_number']) && !$context['ftp_needed']) ? '
+			<input type="hidden" name="seqnum" value="' . $context['form_sequence_number'] . '">' : '', '
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 
 	// Toggle options.
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var aOperationElements = new Array();';
 
 		// Operations.
@@ -324,6 +330,7 @@
 				echo '
 			aOperationElements[', $key, '] = new smc_Toggle({
 				bToggleEnabled: true,
+				bNoAnimate: true,
 				bCurrentlyCollapsed: ', $operation ? 'false' : 'true', ',
 				aSwappableContainers: [
 					\'operation_', $key, '\'
@@ -331,9 +338,9 @@
 				aSwapImages: [
 					{
 						sId: \'operation_img_', $key, '\',
-						srcExpanded: smf_images_url + \'/sort_down.gif\',
+						srcExpanded: smf_images_url + \'/selected_open.png\',
 						altExpanded: \'*\',
-						srcCollapsed: smf_images_url + \'/selected.gif\',
+						srcCollapsed: smf_images_url + \'/selected.png\',
 						altCollapsed: \'*\'
 					}
 				]
@@ -344,29 +351,39 @@
 	echo '
 	// ]]></script>';
 
+	// Get the currently selected item from a select list
+	echo '
+	<script><!-- // --><![CDATA[
+	function get_selected(id)
+	{
+		var aSelected = document.getElementById(id);
+		for (var i = 0; i < aSelected.options.length; i++)
+		{
+			if (aSelected.options[i].selected == true)
+				return aSelected.options[i].value;
+		}
+		return aSelected.options[0];
+	}
+	// ]]></script>';
+
 	// And a bit more for database changes.
 	if (!empty($context['database_changes']))
 		echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var database_changes_area = document.getElementById(\'db_changes_div\');
 		var db_vis = false;
 		database_changes_area.style.display = "none";
-		function swap_database_changes()
-		{
-			db_vis = !db_vis;
-			database_changes_area.style.display = db_vis ? "" : "none";
-			return false;
-		}
 	// ]]></script>';
 }
+
 function template_extract_package()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	if (!empty($context['redirect_url']))
 	{
 		echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		setTimeout("doRedirect();", ', empty($context['redirect_timeout']) ? '5000' : $context['redirect_timeout'], ');
 
 		function doRedirect()
@@ -394,20 +411,18 @@
 			</div>';
 
 	echo '
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">';
+		<div class="windowbg">';
 
 	// If we are going to redirect we have a slightly different agenda.
 	if (!empty($context['redirect_url']))
 	{
 		echo '
-				', $context['redirect_text'], '<br /><br />
-				<a href="', $context['redirect_url'], '">', $txt['package_installed_redirect_go_now'], '</a> | <a href="', $scripturl, '?action=admin;area=packages;sa=browse">', $txt['package_installed_redirect_cancel'], '</a>';
+			', $context['redirect_text'], '<br><br>
+			<a href="', $context['redirect_url'], '">', $txt['package_installed_redirect_go_now'], '</a> | <a href="', $scripturl, '?action=admin;area=packages;sa=browse">', $txt['package_installed_redirect_cancel'], '</a>';
 	}
 	elseif ($context['uninstalling'])
 		echo '
-				', $txt['package_uninstall_done'];
+			', $txt['package_uninstall_done'];
 	elseif ($context['install_finished'])
 	{
 		if ($context['extract_type'] == 'avatar')
@@ -422,501 +437,272 @@
 	}
 	else
 		echo '
-				', $txt['corrupt_compatible'];
+			', $txt['corrupt_compatible'];
 
 	echo '
-			</div>
-			<span class="botslice"><span></span></span>
 		</div>';
 
 	// Show the "restore permissions" screen?
 	if (function_exists('template_show_list') && !empty($context['restore_file_permissions']['rows']))
 	{
-		echo '<br />';
+		echo '<br>';
 		template_show_list('restore_file_permissions');
 	}
 
 	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_list()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="admincenter">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['list_file'], '</h3>
 		</div>
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['files_archive'], ' ', $context['filename'], ':</h3>
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['files_archive'], ' ', $context['filename'], ':</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<ol>';
+			<ol>';
 
 	foreach ($context['files'] as $fileinfo)
 		echo '
-					<li><a href="', $scripturl, '?action=admin;area=packages;sa=examine;package=', $context['filename'], ';file=', $fileinfo['filename'], '" title="', $txt['view'], '">', $fileinfo['filename'], '</a> (', $fileinfo['size'], ' ', $txt['package_bytes'], ')</li>';
+				<li><a href="', $scripturl, '?action=admin;area=packages;sa=examine;package=', $context['filename'], ';file=', $fileinfo['filename'], '" title="', $txt['view'], '">', $fileinfo['filename'], '</a> (', $fileinfo['size'], ' ', $txt['package_bytes'], ')</li>';
 
 	echo '
-				</ol>
-				<br />
-				<a href="', $scripturl, '?action=admin;area=packages">[ ', $txt['back'], ' ]</a>
-			</div>
-			<span class="botslice"><span></span></span>
+			</ol>
+			<br>
+			<a href="', $scripturl, '?action=admin;area=packages">[ ', $txt['back'], ' ]</a>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_examine()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="admincenter">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['package_examine_file'], '</h3>
 		</div>
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['package_file_contents'], ' ', $context['filename'], ':</h3>
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['package_file_contents'], ' ', $context['filename'], ':</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<pre class="file_content">', $context['filedata'], '</pre>
-				<a href="', $scripturl, '?action=admin;area=packages;sa=list;package=', $context['package'], '">[ ', $txt['list_files'], ' ]</a>
-			</div>
-			<span class="botslice"><span></span></span>
+			<pre class="file_content">', $context['filedata'], '</pre>
+			<a href="', $scripturl, '?action=admin;area=packages;sa=list;package=', $context['package'], '">[ ', $txt['list_files'], ' ]</a>
 		</div>
-	</div>
-	<br class="clear" />';
-}
-
-function template_view_installed()
-{
-	global $context, $settings, $options, $txt, $scripturl;
-
-	echo '
-	<div id="admincenter">
-		<div class="title_bar">
-			<h3 class="titlebg">' . $txt['view_and_remove'] . '</h3>
-		</div>';
-
-	if (empty($context['installed_mods']))
-	{
-		echo '
-		<div class="information">
-			', $txt['no_mods_installed'], '
-		</div>';
-	}
-	else
-	{
-		echo '
-		<table class="table_grid" width="100%">
-		<thead>
-			<tr class="catbg">
-				<th scope="col" width="32"></th>
-				<th scope="col" width="25%">', $txt['mod_name'], '</th>
-				<th scope="col" width="25%">', $txt['mod_version'], '</th>
-				<th scope="col" width="49%"></th>
-			</tr>
-		</thead>
-		<tbody>';
-
-		$alt = false;
-		foreach ($context['installed_mods'] as $i => $file)
-		{
-			echo '
-			<tr class="', $alt ? 'windowbg' : 'windowbg2', '">
-				<td><span class="smalltext">', ++$i, '.</span></td>
-				<td><span class="smalltext">', $file['name'], '</span></td>
-				<td><span class="smalltext">', $file['version'], '</span></td>
-				<td align="right"><span class="smalltext"><a href="', $scripturl, '?action=admin;area=packages;sa=uninstall;package=', $file['filename'], ';pid=', $file['id'], '">[ ', $txt['uninstall'], ' ]</a></span></td>
-			</tr>';
-			$alt = !$alt;
-		}
-
-		echo '
-		</tbody>
-		</table>
-		<br />
-		<a href="', $scripturl, '?action=admin;area=packages;sa=flush;', $context['session_var'], '=', $context['session_id'], '">[ ', $txt['delete_list'], ' ]</a>';
-	}
-
-	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_browse()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings, $forum_version;
+	global $context, $txt, $scripturl, $modSettings, $forum_version;
 
 	echo '
 	<div id="admincenter">
-		<div class="cat_bar">
-			<h3 class="catbg">
-				<span class="ie6_header floatleft"><a href="', $scripturl, '?action=helpadmin;help=latest_packages" onclick="return reqWin(this.href);" class="help"><img class="icon" src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" align="top" /></a> ', $txt['packages_latest'], '</span>
-			</h3>
-		</div>
-		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<div id="packagesLatest">', $txt['packages_latest_fetch'], '</div>
+		<div id="update_section"></div>
+		<div id="admin_form_wrapper">
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $txt['packages_adding_title'], '
+				</h3>
+			</div>
+			<div class="windowbg2">
+				', $txt['packages_adding'], '
 			</div>
-			<span class="botslice clear_right"><span></span></span>
-		</div>
 
-		<script type="text/javascript"><!-- // --><![CDATA[
-			window.smfForum_scripturl = "', $scripturl, '";
-			window.smfForum_sessionid = "', $context['session_id'], '";
-			window.smfForum_sessionvar = "', $context['session_var'], '";';
+			<script><!-- // --><![CDATA[
+				window.smfForum_scripturl = smf_scripturl;
+				window.smfForum_sessionid = smf_session_id;
+				window.smfForum_sessionvar = smf_session_var;';
 
 	// Make a list of already installed mods so nothing is listed twice ;).
 	echo '
-			window.smfInstalledPackages = ["', implode('", "', $context['installed_mods']), '"];
-			window.smfVersion = "', $context['forum_version'], '";
-		// ]]></script>';
+				window.smfInstalledPackages = ["', implode('", "', $context['installed_mods']), '"];
+				window.smfVersion = "', $context['forum_version'], '";
+			// ]]></script>
+			<div id="yourVersion" style="display:none">', $context['forum_version'], '</div>';
 
 	if (empty($modSettings['disable_smf_js']))
 		echo '
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=latest-packages.js"></script>';
+			<script src="', $scripturl, '?action=viewsmfile;filename=latest-news.js"></script>';
 
+	// This sets the announcements and current versions themselves ;).
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var tempOldOnload;
-
-			function smfSetLatestPackages()
-			{
-				if (typeof(window.smfLatestPackages) != "undefined")
-					setInnerHTML(document.getElementById("packagesLatest"), window.smfLatestPackages);
-
-				if (tempOldOnload)
-				tempOldOnload();
-			}
-		// ]]></script>';
+			<script><!-- // --><![CDATA[
+				var oAdminIndex = new smf_AdminIndex({
+					sSelf: \'oAdminCenter\',
+					bLoadAnnouncements: false,
+					bLoadVersions: false,
+					bLoadUpdateNotification: true,
+					sUpdateNotificationContainerId: \'update_section\',
+					sUpdateNotificationDefaultTitle: ', JavaScriptEscape($txt['update_available']), ',
+					sUpdateNotificationDefaultMessage: ', JavaScriptEscape($txt['update_message']), ',
+					sUpdateNotificationTemplate: ', JavaScriptEscape('
+						<h3 id="update_title">
+							%title%
+						</h3>
+						<div id="update_message" class="smalltext">
+							%message%
+						</div>
+					'), ',
+					sUpdateNotificationLink: smf_scripturl + ', JavaScriptEscape('?action=admin;area=packages;pgdownload;auto;package=%package%;' . $context['session_var'] . '=' . $context['session_id']), '
 
-		echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			smfSetLatestPackages();
-		// ]]></script>';
+				});
+			// ]]></script>';
 
 	echo '
-		<br />
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['browse_packages'], '</h3>
 		</div>';
 
-	if (!empty($context['available_mods']))
-	{
-		echo '
-		<br />
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['modification_package'], '</h3>
-		</div>
-
-		<table class="table_grid" width="100%">
-		<thead>
-			<tr class="catbg">
-				<th class="first_th" width="32"></th>
-				<th class="lefttext" width="25%">', $txt['mod_name'], '</th>
-				<th class="lefttext" width="25%">', $txt['mod_version'], '</th>
-				<th class="last_th" width="49%"></th>
-			</tr>
-		</thead>
-		<tbody>';
-
-		$alt = false;
-		foreach ($context['available_mods'] as $i => $package)
-		{
-			echo '
-			<tr class="', $alt ? 'windowbg2' : 'windowbg', '">
-				<td>', ++$i, '.</td>
-				<td>', $package['name'], '</td>
-				<td>
-					', $package['version'];
-
-			if ($package['is_installed'] && !$package['is_newer'])
-				echo '
-					<img src="', $settings['images_url'], '/icons/package_', $package['is_current'] ? 'installed' : 'old', '.gif" alt="" align="middle" style="margin-left: 2ex;" />';
-
-			echo '
-				</td>
-				<td align="right">';
-
-			if ($package['can_uninstall'])
-				echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=uninstall;package=', $package['filename'], ';pid=', $package['installed_id'], '">[ ', $txt['uninstall'], ' ]</a>';
-			elseif ($package['can_upgrade'])
-				echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=install;package=', $package['filename'], '">[ ', $txt['package_upgrade'], ' ]</a>';
-			elseif ($package['can_install'])
-				echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=install;package=', $package['filename'], '">[ ', $txt['install_mod'], ' ]</a>';
-
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=list;package=', $package['filename'], '">[ ', $txt['list_files'], ' ]</a>
-					<a href="', $scripturl, '?action=admin;area=packages;sa=remove;package=', $package['filename'], ';', $context['session_var'], '=', $context['session_id'], '"', $package['is_installed'] && $package['is_current'] ? ' onclick="return confirm(\'' . $txt['package_delete_bad'] . '\');"' : '', '>[ ', $txt['package_delete'], ' ]</a>
-				</td>
-			</tr>';
-			$alt = !$alt;
-		}
-
-		echo '
-		</tbody>
-		</table>';
-	}
-
-	if (!empty($context['available_avatars']))
+	$mods_available = false;
+	foreach ($context['modification_types'] as $type)
 	{
-		echo '
-		<br />
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['avatar_package'], '</h3>
-		</div>
-		<table class="table_grid" width="100%">
-		<thead>
-			<tr class="catbg">
-				<th width="32"></th>
-				<th width="25%">', $txt['mod_name'], '</th>
-				<th width="25%">', $txt['mod_version'], '</th>
-				<th width="49%"></th>
-			</tr>
-		</thead>
-		<tbody>';
-
-		foreach ($context['available_avatars'] as $i => $package)
-		{
-			echo '
-			<tr class="windowbg2">
-				<td>', ++$i, '.</td>
-				<td>', $package['name'], '</td>
-				<td>', $package['version'];
-
-			if ($package['is_installed'] && !$package['is_newer'])
-				echo '
-					<img src="', $settings['images_url'], '/icons/package_', $package['is_current'] ? 'installed' : 'old', '.gif" alt="" align="middle" style="margin-left: 2ex;" />';
-
-			echo '
-				</td>
-				<td align="right">';
-
-		if ($package['can_uninstall'])
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=uninstall;package=', $package['filename'], ';pid=', $package['installed_id'], '">[ ', $txt['uninstall'], ' ]</a>';
-		elseif ($package['can_upgrade'])
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=install;package=', $package['filename'], '">[ ', $txt['package_upgrade'], ' ]</a>';
-		elseif ($package['can_install'])
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=install;package=', $package['filename'], '">[ ', $txt['install_mod'], ' ]</a>';
-
-		echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=list;package=', $package['filename'], '">[ ', $txt['list_files'], ' ]</a>
-					<a href="', $scripturl, '?action=admin;area=packages;sa=remove;package=', $package['filename'], ';', $context['session_var'], '=', $context['session_id'], '"', $package['is_installed'] && $package['is_current'] ? ' onclick="return confirm(\'' . $txt['package_delete_bad'] . '\');"' : '', '>[ ', $txt['package_delete'], ' ]</a>
-				</td>
-			</tr>';
-		}
-
-		echo '
-		</tbody>
-		</table>';
-	}
-
-	if (!empty($context['available_languages']))
-	{
-		echo '
-		<br />
-		<div class="title_bar">
-			<h3 class="titlebg">' . $txt['language_package'] . '</h3>
-		</div>
-		<table class="table_grid" width="100%">
-		<thead>
-			<tr class="catbg">
-				<th width="32"></th>
-				<th width="25%">', $txt['mod_name'], '</th>
-				<th width="25%">', $txt['mod_version'], '</th>
-				<th width="49%"></th>
-			</tr>
-		</thead>
-		<tbody>';
-
-		foreach ($context['available_languages'] as $i => $package)
+		if (!empty($context['available_' . $type]))
 		{
-			echo '
-			<tr class="windowbg">
-				<td>' . ++$i . '.</td>
-				<td>' . $package['name'] . '</td>
-				<td>' . $package['version'];
-
-			if ($package['is_installed'] && !$package['is_newer'])
-				echo '
-					<img src="', $settings['images_url'], '/icons/package_', $package['is_current'] ? 'installed' : 'old', '.gif" alt="" align="middle" style="margin-left: 2ex;" />';
-
-			echo '
-				</td>
-				<td align="right">';
-
-		if ($package['can_uninstall'])
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=uninstall;package=', $package['filename'], ';pid=', $package['installed_id'], '">[ ', $txt['uninstall'], ' ]</a>';
-		elseif ($package['can_upgrade'])
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=install;package=', $package['filename'], '">[ ', $txt['package_upgrade'], ' ]</a>';
-		elseif ($package['can_install'])
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=install;package=', $package['filename'], '">[ ', $txt['install_mod'], ' ]</a>';
-
-		echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=list;package=', $package['filename'], '">[ ', $txt['list_files'], ' ]</a>
-					<a href="', $scripturl, '?action=admin;area=packages;sa=remove;package=', $package['filename'], ';', $context['session_var'], '=', $context['session_id'], '"', $package['is_installed'] && $package['is_current'] ? ' onclick="return confirm(\'' . $txt['package_delete_bad'] . '\');"' : '', '>[ ', $txt['package_delete'], ' ]</a>
-				</td>
-			</tr>';
+			template_show_list('packages_lists_' . $type);
+			$mods_available = true;
 		}
-
-		echo '
-		</tbody>
-		</table>';
 	}
 
-	if (!empty($context['available_other']))
-	{
+	if (!$mods_available)
 		echo '
-		<br />
-		<div class="title_bar">
-			<h3 class="titlebg">' . $txt['unknown_package'] . '</h3>
-		</div>
-		<table class="table_grid" width="100%">
-		<thead>
-			<tr class="catbg">
-				<th width="32"></th>
-				<th width="25%">', $txt['mod_name'], '</th>
-				<th width="25%">', $txt['mod_version'], '</th>
-				<th width="49%"></th>
-			</tr>
-		</thead>
-		<tbody>';
-
-		foreach ($context['available_other'] as $i => $package)
-		{
-			echo '
-			<tr class="windowbg2">
-				<td>' . ++$i . '.</td>
-				<td>' . $package['name'] . '</td>
-				<td>' . $package['version'];
-
-			if ($package['is_installed'] && !$package['is_newer'])
-				echo '
-					<img src="', $settings['images_url'], '/icons/package_', $package['is_current'] ? 'installed' : 'old', '.gif" alt="" align="middle" style="margin-left: 2ex;" />';
-
-			echo '
-				</td>
-				<td align="right">';
-
-		if ($package['can_uninstall'])
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=uninstall;package=', $package['filename'], ';pid=', $package['installed_id'], '">[ ', $txt['uninstall'], ' ]</a>';
-		elseif ($package['can_upgrade'])
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=install;package=', $package['filename'], '">[ ', $txt['package_upgrade'], ' ]</a>';
-		elseif ($package['can_install'])
-			echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=install;package=', $package['filename'], '">[ ', $txt['install_mod'], ' ]</a>';
-
-		echo '
-					<a href="', $scripturl, '?action=admin;area=packages;sa=list;package=', $package['filename'], '">[ ', $txt['list_files'], ' ]</a>
-					<a href="', $scripturl, '?action=admin;area=packages;sa=remove;package=', $package['filename'], ';', $context['session_var'], '=', $context['session_id'], '"', $package['is_installed'] && $package['is_current'] ? ' onclick="return confirm(\'' . $txt['package_delete_bad'] . '\');"' : '', '>[ ', $txt['package_delete'], ' ]</a>
-				</td>
-			</tr>';
-		}
-
-		echo '
-		</tbody>
-		</table>';
-	}
-
-	if (empty($context['available_mods']) && empty($context['available_avatars']) && empty($context['available_languages']) && empty($context['available_other']))
+		<div class="noticebox">', $txt['no_packages'], '</div>';
+	else
 		echo '
-		<div class="information">', $txt['no_packages'], '</div>';
+		<br>';
 
+	// the advanced (emulation) box, collapsed by default
 	echo '
-		<div class="flow_auto">
-			<div class="padding smalltext floatleft">
-				', $txt['package_installed_key'], '
-				<img src="', $settings['images_url'], '/icons/package_installed.gif" alt="" align="middle" style="margin-left: 1ex;" /> ', $txt['package_installed_current'], '
-				<img src="', $settings['images_url'], '/icons/package_old.gif" alt="" align="middle" style="margin-left: 2ex;" /> ', $txt['package_installed_old'], '
-			</div>
-			<div class="padding smalltext floatright">
-				<a href="#" onclick="document.getElementById(\'advanced_box\').style.display = document.getElementById(\'advanced_box\').style.display == \'\' ? \'none\' : \'\'; return false;">', $txt['package_advanced_button'], '</a>
-			</div>
-		</div>
 		<form action="', $scripturl, '?action=admin;area=packages;sa=browse" method="get">
-			<div id="advanced_box" style="display: none;">
+			<div id="advanced_box" >
 				<div class="cat_bar">
-					<h3 class="catbg">', $txt['package_advanced_options'], '</h3>
+					<h3 class="catbg">
+						<span id="advanced_panel_toggle" class="floatright" style="display: none;"></span>
+						<a href="#" id="advanced_panel_link">', $txt['package_advanced_button'], '</a>
+					</h3>
 				</div>
-				<div class="windowbg">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<p>
-							', $txt['package_emulate_desc'], '
-						</p>
-						<dl class="settings">
-							<dt>
-								<strong>', $txt['package_emulate'], ':</strong><br />
-								<span class="smalltext">
-									<a href="#" onclick="document.getElementById(\'ve\').value = \'', $forum_version, '\'; return false">', $txt['package_emulate_revert'], '</a>
-								</span>
-							</dt>
-							<dd>
-								<input type="text" name="version_emulate" id="ve" value="', $context['forum_version'], '" size="25" class="input_text" />
-							</dd>
-						</dl>
-						<div class="righttext padding">
-							<input type="submit" value="', $txt['package_apply'], '" class="button_submit" />
-						</div>
+				<div id="advanced_panel_div" class="windowbg2">
+					<p>
+						', $txt['package_emulate_desc'], '
+					</p>
+					<dl class="settings">
+						<dt>
+							<strong>', $txt['package_emulate'], ':</strong><br>
+							<span class="smalltext">
+								<a href="#" onclick="return revert();">', $txt['package_emulate_revert'], '</a>
+							</span>
+						</dt>
+						<dd>
+							<a id="revert" name="revert"></a>
+							<select name="version_emulate" id="ve">';
+
+						foreach ($context['emulation_versions'] as $version)
+						{
+							echo '
+								<option value="', $version, '"', ($version == $context['selected_version'] ? ' selected="selected"' : ''), '>', $version, '</option>';
+						}
+
+				echo '
+							</select>
+						</dd>
+					</dl>
+					<div class="righttext padding">
+						<input type="submit" value="', $txt['package_apply'], '" class="button_submit">
 					</div>
-					<span class="botslice"><span></span></span>
 				</div>
 			</div>
-			<input type="hidden" name="action" value="admin" />
-			<input type="hidden" name="area" value="packages" />
-			<input type="hidden" name="sa" value="browse" />
-		</form>
+			<input type="hidden" name="action" value="admin">
+			<input type="hidden" name="area" value="packages">
+			<input type="hidden" name="sa" value="browse">
+		</form>';
+
+	echo '
 	</div>
-	<br class="clear" />';
+	<script><!-- // --><![CDATA[
+		var oAdvancedPanelToggle = new smc_Toggle({
+			bToggleEnabled: true,
+			bCurrentlyCollapsed: true,
+			aSwappableContainers: [
+				\'advanced_panel_div\'
+			],
+			aSwapImages: [
+				{
+					sId: \'advanced_panel_toggle\',
+					altExpanded: ', JavaScriptEscape($txt['hide']), ',
+					altCollapsed: ', JavaScriptEscape($txt['show']), '
+				}
+			],
+			aSwapLinks: [
+				{
+					sId: \'advanced_panel_link\',
+					msgExpanded: ', JavaScriptEscape($txt['package_advanced_button']), ',
+					msgCollapsed: ', JavaScriptEscape($txt['package_advanced_button']), '
+				}
+			]
+		});
+		function revert()
+		{
+			var default_version = "', $context['default_version'], '";
+			$("#ve").find("option").filter(function(index) {
+    			return default_version === $(this).text();
+			}).attr("selected", "selected");
+			return false;
+		}
+	// ]]></script>';
 }
 
 function template_servers()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	if (!empty($context['package_ftp']['error']))
 			echo '
 					<div class="errorbox">
-						<tt>', $context['package_ftp']['error'], '</tt>
+						<pre>', $context['package_ftp']['error'], '</pre>
 					</div>';
 
 	echo '
-	<div id="admincenter">
+	<div id="admin_form_wrapper">
 		<div class="cat_bar">
-			<h3 class="catbg">', $txt['download_new_package'], '</h3>
-		</div>';
+			<h3 class="catbg">' . $txt['package_upload_title'] . '</h3>
+		</div>
+		<div class="windowbg2">
+			<form action="' . $scripturl . '?action=admin;area=packages;get;sa=upload" method="post" accept-charset="', $context['character_set'], '" enctype="multipart/form-data" style="margin-bottom: 0;">
+				<dl class="settings">
+					<dt>
+						<strong>' . $txt['package_upload_select'] . ':</strong>
+					</dt>
+					<dd>
+						<input type="file" name="package" size="38" class="input_file">
+					</dd>
+				</dl>
+				<input type="submit" value="' . $txt['upload'] . '" class="button_submit">
+				<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '">
+			</form>
+		</div>
+		<br>
+		<div class="cat_bar">
+			<h3 class="catbg">
+				<a class="download_new_package">
+					<span class="toggle_down floatright" alt="*" title="', $txt['show'], '"></span>
+					', $txt['download_new_package'], '
+				</a>
+			</h3>
+		</div>
+		<div class="new_package_content">';
 
 	if ($context['package_download_broken'])
 	{
 		echo '
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['package_ftp_necessary'], '</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['package_ftp_necessary'], '</h3>
+			</div>
+			<div class="windowbg">
 				<p>
 					', $txt['package_ftp_why_download'], '
 				</p>
@@ -926,41 +712,37 @@
 							<label for="ftp_server">', $txt['package_ftp_server'], ':</label>
 						</dt>
 						<dd>
-							<input type="text" size="30" name="ftp_server" id="ftp_server" value="', $context['package_ftp']['server'], '" class="input_text" />
-							<label for="ftp_port">', $txt['package_ftp_port'], ':&nbsp;</label> <input type="text" size="3" name="ftp_port" id="ftp_port" value="', $context['package_ftp']['port'], '" class="input_text" />
+							<input type="text" size="30" name="ftp_server" id="ftp_server" value="', $context['package_ftp']['server'], '" class="input_text">
+							<label for="ftp_port">', $txt['package_ftp_port'], ':&nbsp;</label> <input type="text" size="3" name="ftp_port" id="ftp_port" value="', $context['package_ftp']['port'], '" class="input_text">
 						</dd>
 						<dt>
 							<label for="ftp_username">', $txt['package_ftp_username'], ':</label>
 						</dt>
 						<dd>
-							<input type="text" size="50" name="ftp_username" id="ftp_username" value="', $context['package_ftp']['username'], '" style="width: 99%;" class="input_text" />
+							<input type="text" size="50" name="ftp_username" id="ftp_username" value="', $context['package_ftp']['username'], '" style="width: 99%;" class="input_text">
 						</dd>
 						<dt>
 							<label for="ftp_password">', $txt['package_ftp_password'], ':</label>
 						</dt>
 						<dd>
-							<input type="password" size="50" name="ftp_password" id="ftp_password" style="width: 99%;" class="input_password" />
+							<input type="password" size="50" name="ftp_password" id="ftp_password" style="width: 99%;" class="input_password">
 						</dd>
 						<dt>
 							<label for="ftp_path">', $txt['package_ftp_path'], ':</label>
 						</dt>
 						<dd>
-							<input type="text" size="50" name="ftp_path" id="ftp_path" value="', $context['package_ftp']['path'], '" style="width: 99%;" class="input_text" />
+							<input type="text" size="50" name="ftp_path" id="ftp_path" value="', $context['package_ftp']['path'], '" style="width: 99%;" class="input_text">
 						</dd>
 					</dl>
 					<div class="righttext">
-						<input type="submit" value="', $txt['package_proceed'], '" class="button_submit" />
+						<input type="submit" value="', $txt['package_proceed'], '" class="button_submit">
 					</div>
 				</form>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
+			</div>';
 	}
 
 	echo '
-		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
+			<div class="windowbg2">
 				<fieldset>
 					<legend>' . $txt['package_servers'] . '</legend>
 					<ul class="package_servers">';
@@ -982,18 +764,18 @@
 								<strong>' . $txt['server_name'] . ':</strong>
 							</dt>
 							<dd>
-								<input type="text" name="servername" size="44" value="SMF" class="input_text" />
+								<input type="text" name="servername" size="44" value="SMF" class="input_text">
 							</dd>
 							<dt>
 								<strong>' . $txt['serverurl'] . ':</strong>
 							</dt>
 							<dd>
-								<input type="text" name="serverurl" size="44" value="http://" class="input_text" />
+								<input type="text" name="serverurl" size="44" value="http://" class="input_text">
 							</dd>
 						</dl>
 						<div class="righttext">
-							<input type="submit" value="' . $txt['add_server'] . '" class="button_submit" />
-							<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '" />
+							<input type="submit" value="' . $txt['add_server'] . '" class="button_submit">
+							<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '">
 						</div>
 					</form>
 				</fieldset>
@@ -1005,55 +787,29 @@
 								<strong>' . $txt['serverurl'] . ':</strong>
 							</dt>
 							<dd>
-								<input type="text" name="package" size="44" value="http://" class="input_text" />
+								<input type="text" name="package" size="44" value="http://" class="input_text">
 							</dd>
 							<dt>
 								<strong>', $txt['package_download_filename'], ':</strong>
 							</dt>
 							<dd>
-								<input type="text" name="filename" size="44" class="input_text" /><br />
+								<input type="text" name="filename" size="44" class="input_text"><br>
 								<span class="smalltext">', $txt['package_download_filename_info'], '</span>
 							</dd>
 						</dl>
 						<div class="righttext">
-							<input type="submit" value="', $txt['download'], '" class="button_submit" />
+							<input type="submit" value="', $txt['download'], '" class="button_submit">
 						</div>
 					</form>
 				</fieldset>
 			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-		<br />
-		<div class="cat_bar">
-			<h3 class="catbg">' . $txt['package_upload_title'] . '</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="' . $scripturl . '?action=admin;area=packages;get;sa=upload" method="post" accept-charset="', $context['character_set'], '" enctype="multipart/form-data" style="margin-bottom: 0;">
-					<dl class="settings">
-						<dt>
-							<strong>' . $txt['package_upload_select'] . ':</strong>
-						</dt>
-						<dd>
-							<input type="file" name="package" size="38" class="input_file" />
-						</dd>
-					</dl>
-					<div class="righttext">
-						<input type="submit" value="' . $txt['package_upload'] . '" class="button_submit" />
-						<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '" />
-					</div>
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_package_confirm()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt;
 
 	echo '
 	<div id="admincenter">
@@ -1061,143 +817,121 @@
 			<h3 class="catbg">', $context['page_title'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $context['confirm_message'], '</p>
-				<a href="', $context['proceed_href'], '">[ ', $txt['package_confirm_proceed'], ' ]</a> <a href="JavaScript:history.go(-1);">[ ', $txt['package_confirm_go_back'], ' ]</a>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p>', $context['confirm_message'], '</p>
+			<a href="', $context['proceed_href'], '">[ ', $txt['package_confirm_proceed'], ' ]</a> <a href="JavaScript:history.go(-1);">[ ', $txt['package_confirm_go_back'], ' ]</a>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_package_list()
 {
-	global $context, $settings, $options, $txt, $scripturl, $smcFunc;
+	global $context, $txt, $smcFunc;
 
 	echo '
 	<div id="admincenter">
 		<div class="cat_bar">
 			<h3 class="catbg">' . $context['page_title'] . '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">';
+		<div class="windowbg2">';
 
 	// No packages, as yet.
 	if (empty($context['package_list']))
 		echo '
-				<ul>
-					<li>', $txt['no_packages'], '</li>
-				</ul>';
+			<ul>
+				<li>', $txt['no_packages'], '</li>
+			</ul>';
 	// List out the packages...
 	else
 	{
 		echo '
-				<ul id="package_list">';
+			<ul id="package_list">';
 		foreach ($context['package_list'] as $i => $packageSection)
 		{
 			echo '
-					<li>
-						<strong><img id="ps_img_', $i, '" src="', $settings['images_url'], '/upshrink.png" alt="*" style="display: none;" /> ', $packageSection['title'], '</strong>';
+				<li>
+					<strong><span id="ps_img_', $i, '" class="toggle_up" alt="*" style="display: none;"></span> ', $packageSection['title'], '</strong>';
 
 			if (!empty($packageSection['text']))
 				echo '
-						<div class="information">', $packageSection['text'], '</div>';
+					<div class="sub_bar">
+						<h3 class="subbg">', $packageSection['text'], '</h3>
+					</div>';
 
 			echo '
-						<', $context['list_type'], ' id="package_section_', $i, '" class="packages">';
-
-			$alt = false;
+					<', $context['list_type'], ' id="package_section_', $i, '" class="packages">';
 
 			foreach ($packageSection['items'] as $id => $package)
 			{
 				echo '
-							<li>';
+						<li>';
 				// Textual message. Could be empty just for a blank line...
 				if ($package['is_text'])
 					echo '
-								', empty($package['name']) ? '&nbsp;' : $package['name'];
+							', empty($package['name']) ? '&nbsp;' : $package['name'];
 				// This is supposed to be a rule..
 				elseif ($package['is_line'])
 					echo '
-							<hr class="hrcolor" />';
+						<hr class="hrcolor">';
 				// A remote link.
 				elseif ($package['is_remote'])
 				{
 					echo '
-							<strong>', $package['link'], '</strong>';
+						<strong>', $package['link'], '</strong>';
 				}
 				// A title?
 				elseif ($package['is_heading'] || $package['is_title'])
 				{
 					echo '
-							<strong>', $package['name'], '</strong>';
+						<strong>', $package['name'], '</strong>';
 				}
 				// Otherwise, it's a package.
 				else
 				{
 					// 1. Some mod [ Download ].
 					echo '
-							<strong><img id="ps_img_', $i, '_pkg_', $id, '" src="', $settings['images_url'], '/upshrink.png" alt="*" style="display: none;" /> ', $package['can_install'] ? '<strong>' . $package['name'] . '</strong> <a href="' . $package['download']['href'] . '">[ ' . $txt['download'] . ' ]</a>': $package['name'];
-
-					// Mark as installed and current?
-					if ($package['is_installed'] && !$package['is_newer'])
-						echo '<img src="', $settings['images_url'], '/icons/package_', $package['is_current'] ? 'installed' : 'old', '.gif" width="12" height="11" align="middle" style="margin-left: 2ex;" alt="', $package['is_current'] ? $txt['package_installed_current'] : $txt['package_installed_old'], '" />';
-
-					echo '
-							</strong>
-							<ul id="package_section_', $i, '_pkg_', $id, '" class="package_section">';
+						<strong><span id="ps_img_', $i, '_pkg_', $id, '" class="toggle_up" alt="*" style="display: none;"></span> ', $package['can_install'] || !empty($package['can_emulate_install']) ? '<strong>' . $package['name'] . '</strong> <a href="' . $package['download']['href'] . '">[ ' . $txt['download'] . ' ]</a>': $package['name'], '</strong>
+						<ul id="package_section_', $i, '_pkg_', $id, '" class="package_section">';
 
 					// Show the mod type?
 					if ($package['type'] != '')
 						echo '
-								<li class="package_section">', $txt['package_type'], ':&nbsp; ', $smcFunc['ucwords']($smcFunc['strtolower']($package['type'])), '</li>';
+							<li class="package_section">', $txt['package_type'], ':&nbsp; ', $smcFunc['ucwords']($smcFunc['strtolower']($package['type'])), '</li>';
 					// Show the version number?
 					if ($package['version'] != '')
 						echo '
-								<li class="package_section">', $txt['mod_version'], ':&nbsp; ', $package['version'], '</li>';
+							<li class="package_section">', $txt['mod_version'], ':&nbsp; ', $package['version'], '</li>';
 					// How 'bout the author?
 					if (!empty($package['author']) && $package['author']['name'] != '' && isset($package['author']['link']))
 						echo '
-								<li class="package_section">', $txt['mod_author'], ':&nbsp; ', $package['author']['link'], '</li>';
+							<li class="package_section">', $txt['mod_author'], ':&nbsp; ', $package['author']['link'], '</li>';
 					// The homepage....
 					if ($package['author']['website']['link'] != '')
 						echo '
-								<li class="package_section">', $txt['author_website'], ':&nbsp; ', $package['author']['website']['link'], '</li>';
+							<li class="package_section">', $txt['author_website'], ':&nbsp; ', $package['author']['website']['link'], '</li>';
 
 					// Desciption: bleh bleh!
 					// Location of file: http://someplace/.
 					echo '
-								<li class="package_section">', $txt['file_location'], ':&nbsp; <a href="', $package['href'], '">', $package['href'], '</a></li>
-								<li class="package_section"><div class="information">', $txt['package_description'], ':&nbsp; ', $package['description'], '</div></li>
-							</ul>';
+							<li class="package_section">', $txt['file_location'], ':&nbsp; <a href="', $package['href'], '">', $package['href'], '</a></li>
+							<li class="package_section"><div class="information">', $txt['package_description'], ':&nbsp; ', $package['description'], '</div></li>
+						</ul>';
 				}
-				$alt = !$alt;
+
 				echo '
-						</li>';
+					</li>';
 			}
 			echo '
-					</', $context['list_type'], '>
-						</li>';
+				</', $context['list_type'], '>
+					</li>';
 		}
 		echo '
-				</ul>';
+			</ul>';
 
 	}
 
 	echo '
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-		<div class="padding smalltext floatleft">
-			', $txt['package_installed_key'], '
-			<img src="', $settings['images_url'], '/icons/package_installed.gif" alt="" align="middle" style="margin-left: 1ex;" /> ', $txt['package_installed_current'], '
-			<img src="', $settings['images_url'], '/icons/package_old.gif" alt="" align="middle" style="margin-left: 2ex;" /> ', $txt['package_installed_old'], '
 		</div>
 	</div>
-	<br class="clear" />
 
 		';
 		// Now go through and turn off all the sections.
@@ -1205,7 +939,7 @@
 		{
 			$section_count = count($context['package_list']);
 			echo '
-			<script type="text/javascript"><!-- // --><![CDATA[';
+			<script><!-- // --><![CDATA[';
 			foreach ($context['package_list'] as $section => $ps)
 			{
 				echo '
@@ -1218,9 +952,7 @@
 					aSwapImages: [
 						{
 							sId: \'ps_img_', $section, '\',
-							srcExpanded: smf_images_url + \'/upshrink.png\',
 							altExpanded: \'*\',
-							srcCollapsed: smf_images_url + \'/upshrink2.png\',
 							altCollapsed: \'*\'
 						}
 					]
@@ -1239,9 +971,7 @@
 					aSwapImages: [
 						{
 							sId: \'ps_img_', $section, '_pkg_', $id, '\',
-							srcExpanded: smf_images_url + \'/upshrink.png\',
 							altExpanded: \'*\',
-							srcCollapsed: smf_images_url + \'/upshrink2.png\',
 							altCollapsed: \'*\'
 						}
 					]
@@ -1255,7 +985,7 @@
 
 function template_downloaded()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="admincenter">
@@ -1263,27 +993,26 @@
 			<h3 class="catbg">', $context['page_title'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', (empty($context['package_server']) ? $txt['package_uploaded_successfully'] : $txt['package_downloaded_successfully']), '</p>
-				<ul class="reset">
-					<li class="reset"><span class="floatleft"><strong>', $context['package']['name'], '</strong></span>
-						<span class="package_server floatright">', $context['package']['list_files']['link'], '</span>
-						<span class="package_server floatright">', $context['package']['install']['link'], '</span>
-					</li>
-				</ul>
-				<br /><br />
-				<p><a href="', $scripturl, '?action=admin;area=packages;get', (isset($context['package_server']) ? ';sa=browse;server=' . $context['package_server'] : ''), '">[ ', $txt['back'], ' ]</a></p>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p>', (empty($context['package_server']) ? $txt['package_uploaded_successfully'] : $txt['package_downloaded_successfully']), '</p>
+			<ul class="reset">
+				<li class="reset"><span class="floatleft"><strong>', $context['package']['name'], '</strong></span>
+					<span class="package_server floatright">', $context['package']['list_files']['link'], '</span>
+					<span class="package_server floatright">', $context['package']['install']['link'], '</span>
+				</li>
+			</ul>
+			<br><br>
+			<p><a href="', $scripturl, '?action=admin;area=packages;get', (isset($context['package_server']) ? ';sa=browse;server=' . $context['package_server'] : ''), '">[ ', $txt['back'], ' ]</a></p>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_install_options()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
+
+	if (!empty($context['saved_successful']))
+		echo '
+	<div class="infobox">', $txt['settings_saved'], '</div>';
 
 	echo '
 	<div id="admincenter">
@@ -1295,45 +1024,50 @@
 		</div>
 
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<form action="', $scripturl, '?action=admin;area=packages;sa=options" method="post" accept-charset="', $context['character_set'], '">
-					<dl class="settings">
-						<dt>
-							<label for="pack_server"><strong>', $txt['package_install_options_ftp_server'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="pack_server" id="pack_server" value="', $context['package_ftp_server'], '" size="30" class="input_text" />
-						</dd>
-						<dt>
-							<label for="pack_port"><strong>', $txt['package_install_options_ftp_port'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="pack_port" id="pack_port" size="3" value="', $context['package_ftp_port'], '" class="input_text" />
-						</dd>
-						<dt>
-							<label for="pack_user"><strong>', $txt['package_install_options_ftp_user'], ':</strong></label>
-						</dt>
-						<dd>
-							<input type="text" name="pack_user" id="pack_user" value="', $context['package_ftp_username'], '" size="30" class="input_text" />
-						</dd>
-					</dl>
-					<label for="package_make_backups"><input type="checkbox" name="package_make_backups" id="package_make_backups" value="1" class="input_check"', $context['package_make_backups'] ? ' checked="checked"' : '', ' /> ', $txt['package_install_options_make_backups'], '</label><br /><br />
-					<div class="righttext">
-						<input type="submit" name="submit" value="', $txt['save'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					</div>
-				</form>
-			</div>
-			<span class="botslice"><span></span></span>
+			<form action="', $scripturl, '?action=admin;area=packages;sa=options" method="post" accept-charset="', $context['character_set'], '">
+				<dl class="settings">
+					<dt>
+						<label for="pack_server"><strong>', $txt['package_install_options_ftp_server'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="text" name="pack_server" id="pack_server" value="', $context['package_ftp_server'], '" size="30" class="input_text">
+					</dd>
+					<dt>
+						<label for="pack_port"><strong>', $txt['package_install_options_ftp_port'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="text" name="pack_port" id="pack_port" size="3" value="', $context['package_ftp_port'], '" class="input_text">
+					</dd>
+					<dt>
+						<label for="pack_user"><strong>', $txt['package_install_options_ftp_user'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="text" name="pack_user" id="pack_user" value="', $context['package_ftp_username'], '" size="30" class="input_text">
+					</dd>
+					<dt>
+						<label for="package_make_backups">', $txt['package_install_options_make_backups'], '</label>
+					</dt>
+					<dd>
+						<input type="checkbox" name="package_make_backups" id="package_make_backups" value="1" class="input_check"', $context['package_make_backups'] ? ' checked' : '', '>
+					</dd>
+					<dt>
+						<label for="package_make_full_backups">', $txt['package_install_options_make_full_backups'], '</label>
+					</dt>
+					<dd>
+						<input type="checkbox" name="package_make_full_backups" id="package_make_full_backups" value="1" class="input_check"', $context['package_make_full_backups'] ? ' checked' : '', '>
+					</dd>
+				</dl>
+
+				<input type="submit" name="save" value="', $txt['save'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			</form>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_control_chmod()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt;
 
 	// Nothing to do? Brilliant!
 	if (empty($context['package_ftp']))
@@ -1342,7 +1076,7 @@
 	if (empty($context['package_ftp']['form_elements_only']))
 	{
 		echo '
-				', sprintf($txt['package_ftp_why'], 'document.getElementById(\'need_writable_list\').style.display = \'\'; return false;'), '<br />
+				', sprintf($txt['package_ftp_why'], 'document.getElementById(\'need_writable_list\').style.display = \'\'; return false;'), '<br>
 				<div id="need_writable_list" class="smalltext">
 					', $txt['package_ftp_why_file_list'], '
 					<ul style="display: inline;">';
@@ -1372,26 +1106,26 @@
 							<label for="ftp_server">', $txt['package_ftp_server'], ':</label>
 						</dt>
 						<dd>
-							<input type="text" size="30" name="ftp_server" id="ftp_server" value="', $context['package_ftp']['server'], '" class="input_text" />
-							<label for="ftp_port">', $txt['package_ftp_port'], ':&nbsp;</label> <input type="text" size="3" name="ftp_port" id="ftp_port" value="', $context['package_ftp']['port'], '" class="input_text" />
+							<input type="text" size="30" name="ftp_server" id="ftp_server" value="', $context['package_ftp']['server'], '" class="input_text">
+							<label for="ftp_port">', $txt['package_ftp_port'], ':&nbsp;</label> <input type="text" size="3" name="ftp_port" id="ftp_port" value="', $context['package_ftp']['port'], '" class="input_text">
 						</dd>
 						<dt>
 							<label for="ftp_username">', $txt['package_ftp_username'], ':</label>
 						</dt>
 						<dd>
-							<input type="text" size="50" name="ftp_username" id="ftp_username" value="', $context['package_ftp']['username'], '" style="width: 98%;" class="input_text" />
+							<input type="text" size="50" name="ftp_username" id="ftp_username" value="', $context['package_ftp']['username'], '" style="width: 98%;" class="input_text">
 						</dd>
 						<dt>
 							<label for="ftp_password">', $txt['package_ftp_password'], ':</label>
 						</dt>
 						<dd>
-							<input type="password" size="50" name="ftp_password" id="ftp_password" style="width: 98%;" class="input_password" />
+							<input type="password" size="50" name="ftp_password" id="ftp_password" style="width: 98%;" class="input_password">
 						</dd>
 						<dt>
 							<label for="ftp_path">', $txt['package_ftp_path'], ':</label>
 						</dt>
 						<dd>
-							<input type="text" size="50" name="ftp_path" id="ftp_path" value="', $context['package_ftp']['path'], '" style="width: 98%;" class="input_text" />
+							<input type="text" size="50" name="ftp_path" id="ftp_path" value="', $context['package_ftp']['path'], '" style="width: 98%;" class="input_text">
 						</dd>
 					</dl>
 					</fieldset>';
@@ -1401,24 +1135,24 @@
 
 					<div class="righttext" style="margin: 1ex;">
 						<span id="test_ftp_placeholder_full"></span>
-						<input type="submit" value="', $txt['package_proceed'], '" class="button_submit" />
+						<input type="submit" value="', $txt['package_proceed'], '" class="button_submit">
 					</div>';
 
 	if (!empty($context['package_ftp']['destination']))
 		echo '
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 				</form>';
 
 	// Hide the details of the list.
 	if (empty($context['package_ftp']['form_elements_only']))
 		echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			document.getElementById(\'need_writable_list\').style.display = \'none\';
 		// ]]></script>';
 
 	// Quick generate the test button.
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		// Generate a "test ftp" button.
 		var generatedButton = false;
 		function generateFTPTest()
@@ -1447,26 +1181,6 @@
 				document.getElementById("test_ftp_placeholder_full").appendChild(ftpTest);
 			}
 		}
-		function testFTP()
-		{
-			ajax_indicator(true);
-
-			// What we need to post.
-			var oPostData = {
-				0: "ftp_server",
-				1: "ftp_port",
-				2: "ftp_username",
-				3: "ftp_password",
-				4: "ftp_path"
-			}
-
-			var sPostData = "";
-			for (i = 0; i < 5; i++)
-				sPostData = sPostData + (sPostData.length == 0 ? "" : "&") + oPostData[i] + "=" + escape(document.getElementById(oPostData[i]).value);
-
-			// Post the data out.
-			sendXMLDocument(smf_prepareScriptUrl(smf_scripturl) + \'action=admin;area=packages;sa=ftptest;xml;', $context['session_var'], '=', $context['session_id'], '\', sPostData, testFTPResults);
-		}
 		function testFTPResults(oXMLDoc)
 		{
 			ajax_indicator(false);
@@ -1494,14 +1208,14 @@
 
 	// Make sure the button gets generated last.
 	$context['insert_after_template'] .= '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		generateFTPTest();
 	// ]]></script>';
 }
 
 function template_ftp_required()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $txt;
 
 	echo '
 		<fieldset>
@@ -1516,17 +1230,17 @@
 
 function template_view_operations()
 {
-	global $context, $txt, $settings;
+	global $context, $txt, $settings, $modSettings;
 
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
+		<meta charset="', $context['character_set'], '">
 		<title>', $txt['operation_title'], '</title>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
-		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index.css" />
-		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/admin.css" />
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/script.js?fin20"></script>
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/theme.js?fin20"></script>
+		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index', $context['theme_variant'], '.css', $modSettings['browser_cache'] ,'">
+		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/admin.css', $modSettings['browser_cache'] ,'">
+		<script src="', $settings['default_theme_url'], '/scripts/script.js', $modSettings['browser_cache'] ,'"></script>
+		<script src="', $settings['default_theme_url'], '/scripts/theme.js', $modSettings['browser_cache'] ,'"></script>
 	</head>
 	<body>
 		<div class="padding windowbg">
@@ -1547,7 +1261,7 @@
 
 	// This will handle expanding the selection.
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var oRadioColors = {
 			0: "#D1F7BF",
 			1: "#FFBBBB",
@@ -1562,82 +1276,13 @@
 			3: "custom",
 			4: "no_change"
 		}
-		function expandFolder(folderIdent, folderReal)
-		{
-			// See if it already exists.
-			var possibleTags = document.getElementsByTagName("tr");
-			var foundOne = false;
-
-			for (var i = 0; i < possibleTags.length; i++)
-			{
-				if (possibleTags[i].id.indexOf("content_" + folderIdent + ":-:") == 0)
-				{
-					possibleTags[i].style.display = possibleTags[i].style.display == "none" ? "" : "none";
-					foundOne = true;
-				}
-			}
-
-			// Got something then we\'re done.
-			if (foundOne)
-			{
-				return false;
-			}
-			// Otherwise we need to get the wicked thing.
-			else if (window.XMLHttpRequest)
-			{
-				ajax_indicator(true);
-				getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + \'action=admin;area=packages;onlyfind=\' + escape(folderReal) + \';sa=perms;xml;', $context['session_var'], '=', $context['session_id'], '\', onNewFolderReceived);
-			}
-			// Otherwise reload.
-			else
-				return true;
-
-			return false;
-		}
-		function dynamicExpandFolder()
-		{
-			expandFolder(this.ident, this.path);
-
-			return false;
-		}
 		function dynamicAddMore()
 		{
 			ajax_indicator(true);
 
 			getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + \'action=admin;area=packages;fileoffset=\' + (parseInt(this.offset) + ', $context['file_limit'], ') + \';onlyfind=\' + escape(this.path) + \';sa=perms;xml;', $context['session_var'], '=', $context['session_id'], '\', onNewFolderReceived);
 		}
-		function repeatString(sString, iTime)
-		{
-			if (iTime < 1)
-				return \'\';
-			else
-				return sString + repeatString(sString, iTime - 1);
-		}
-		// Create a named element dynamically - thanks to: http://www.thunderguy.com/semicolon/2005/05/23/setting-the-name-attribute-in-internet-explorer/
-		function createNamedElement(type, name, customFields)
-		{
-			var element = null;
-
-			if (!customFields)
-				customFields = "";
-
-			// Try the IE way; this fails on standards-compliant browsers
-			try
-			{
-				element = document.createElement("<" + type + \' name="\' + name + \'" \' + customFields + ">");
-			}
-			catch (e)
-			{
-			}
-			if (!element || element.nodeName != type.toUpperCase())
-			{
-				// Non-IE browser; use canonical method to create named element
-				element = document.createElement(type);
-				element.name = name;
-			}
 
-			return element;
-		}
 		// Getting something back?
 		function onNewFolderReceived(oXMLDoc)
 		{
@@ -1712,7 +1357,7 @@
 						linkData.onclick = dynamicExpandFolder;
 
 						var folderImage = document.createElement("img");
-						folderImage.src = \'', addcslashes($settings['default_images_url'], "\\"), '/board.gif\';
+						folderImage.src = \'', addcslashes($settings['default_images_url'], "\\"), '/board.png\';
 						linkData.appendChild(folderImage);
 
 						linkData.appendChild(fileName);
@@ -1747,7 +1392,7 @@
 						curCol.style.backgroundColor = oRadioColors[j];
 						curCol.align = "center";
 
-						var curInput = createNamedElement("input", "permStatus[" + curPath + "/" + fileItems[i].firstChild.nodeValue + "]", j == 4 ? \'checked="checked"\' : "");
+						var curInput = createNamedElement("input", "permStatus[" + curPath + "/" + fileItems[i].firstChild.nodeValue + "]", j == 4 ? "checked" : "");
 						curInput.type = "radio";
 						curInput.checked = "checked";
 						curInput.value = oRadioValues[j];
@@ -1820,7 +1465,7 @@
 	// ]]></script>';
 
 		echo '
-	<div class="information">
+	<div class="noticebox">
 		<div>
 			<strong>', $txt['package_file_perms_warning'], ':</strong>
 			<div class="smalltext">
@@ -1832,34 +1477,34 @@
 	</div>
 
 	<form action="', $scripturl, '?action=admin;area=packages;sa=perms;', $context['session_var'], '=', $context['session_id'], '" method="post" accept-charset="', $context['character_set'], '">
-		<div class="title_bar">
-			<h3 class="titlebg">
+		<div class="cat_bar">
+			<h3 class="catbg">
 				<span class="floatleft">', $txt['package_file_perms'], '</span><span class="fperm floatright">', $txt['package_file_perms_new_status'], '</span>
 			</h3>
 		</div>
-		<table width="100%" class="table_grid">
+		<table class="table_grid">
 			<thead>
-				<tr class="catbg">
-					<th class="first_th lefttext" width="30%">&nbsp;', $txt['package_file_perms_name'], '&nbsp;</th>
+				<tr class="title_bar">
+					<th class="lefttext" width="30%">&nbsp;', $txt['package_file_perms_name'], '&nbsp;</th>
 					<th width="30%" class="lefttext">', $txt['package_file_perms_status'], '</th>
-					<th align="center" width="8%"><span class="filepermissions">', $txt['package_file_perms_status_read'], '</span></th>
-					<th align="center" width="8%"><span class="filepermissions">', $txt['package_file_perms_status_write'], '</span></th>
-					<th align="center" width="8%"><span class="filepermissions">', $txt['package_file_perms_status_execute'], '</span></th>
-					<th align="center" width="8%"><span class="filepermissions">', $txt['package_file_perms_status_custom'], '</span></th>
-					<th class="last_th" align="center" width="8%"><span class="filepermissions">', $txt['package_file_perms_status_no_change'], '</span></th>
+					<th width="8%"><span class="filepermissions">', $txt['package_file_perms_status_read'], '</span></th>
+					<th width="8%"><span class="filepermissions">', $txt['package_file_perms_status_write'], '</span></th>
+					<th width="8%"><span class="filepermissions">', $txt['package_file_perms_status_execute'], '</span></th>
+					<th width="8%"><span class="filepermissions">', $txt['package_file_perms_status_custom'], '</span></th>
+					<th width="8%"><span class="filepermissions">', $txt['package_file_perms_status_no_change'], '</span></th>
 				</tr>
-			</thead>';
+			</thead>
+			<tbody>';
 
 	foreach ($context['file_tree'] as $name => $dir)
 	{
 		echo '
-			<tbody>
-				<tr class="windowbg2">
+				<tr class="windowbg">
 					<td width="30%"><strong>';
 
 				if (!empty($dir['type']) && ($dir['type'] == 'dir' || $dir['type'] == 'dir_recursive'))
 					echo '
-						<img src="', $settings['default_images_url'], '/board.gif" alt="*" />';
+						<img src="', $settings['default_images_url'], '/board.png" alt="*">';
 
 				echo '
 						', $name, '
@@ -1868,83 +1513,78 @@
 						<span style="color: ', ($dir['perms']['chmod'] ? 'green' : 'red'), '">', ($dir['perms']['chmod'] ? $txt['package_file_perms_writable'] : $txt['package_file_perms_not_writable']), '</span>
 						', ($dir['perms']['perms'] ? '&nbsp;(' . $txt['package_file_perms_chmod'] . ': ' . substr(sprintf('%o', $dir['perms']['perms']), -4) . ')' : ''), '
 					</td>
-					<td align="center" class="perm_read" width="8%"><input type="radio" name="permStatus[', $name, ']" value="read" class="input_radio" /></td>
-					<td align="center" class="perm_write" width="8%"><input type="radio" name="permStatus[', $name, ']" value="writable" class="input_radio" /></td>
-					<td align="center" class="perm_execute" width="8%"><input type="radio" name="permStatus[', $name, ']" value="execute" class="input_radio" /></td>
-					<td align="center" class="perm_custom" width="8%"><input type="radio" name="permStatus[', $name, ']" value="custom" class="input_radio" /></td>
-					<td align="center" class="perm_nochange" width="8%"><input type="radio" name="permStatus[', $name, ']" value="no_change" checked="checked" class="input_radio" /></td>
+					<td class="centertext perm_read"><input type="radio" name="permStatus[', $name, ']" value="read" class="centertext input_radio"></td>
+					<td class="centertext perm_write"><input type="radio" name="permStatus[', $name, ']" value="writable" class="centertext input_radio"></td>
+					<td class="centertext perm_execute"><input type="radio" name="permStatus[', $name, ']" value="execute" class="centertext input_radio"></td>
+					<td class="centertext perm_custom"><input type="radio" name="permStatus[', $name, ']" value="custom" class="centertext input_radio"></td>
+					<td class="centertext perm_nochange"><input type="radio" name="permStatus[', $name, ']" value="no_change" checked class="centertext input_radio"></td>
 				</tr>
-			</tbody>';
+			';
 
 		if (!empty($dir['contents']))
 			template_permission_show_contents($name, $dir['contents'], 1);
 	}
 
 	echo '
-
+			</tbody>
 		</table>
-		<br />
+		<br>
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['package_file_perms_change'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<fieldset>
-					<dl>
-						<dt>
-							<input type="radio" name="method" value="individual" checked="checked" id="method_individual" class="input_radio" />
-							<label for="method_individual"><strong>', $txt['package_file_perms_apply'], '</strong></label>
-						</dt>
-						<dd>
-							<em class="smalltext">', $txt['package_file_perms_custom'], ': <input type="text" name="custom_value" value="0755" maxlength="4" size="5" class="input_text" />&nbsp;<a href="', $scripturl, '?action=helpadmin;help=chmod_flags" onclick="return reqWin(this.href);" class="help">(?)</a></em>
-						</dd>
-						<dt>
-							<input type="radio" name="method" value="predefined" id="method_predefined" class="input_radio" />
-							<label for="method_predefined"><strong>', $txt['package_file_perms_predefined'], ':</strong></label>
-							<select name="predefined" onchange="document.getElementById(\'method_predefined\').checked = \'checked\';">
-								<option value="restricted" selected="selected">', $txt['package_file_perms_pre_restricted'], '</option>
-								<option value="standard">', $txt['package_file_perms_pre_standard'], '</option>
-								<option value="free">', $txt['package_file_perms_pre_free'], '</option>
-							</select>
-						</dt>
-						<dd>
-							<em class="smalltext">', $txt['package_file_perms_predefined_note'], '</em>
-						</dd>
-					</dl>
-				</fieldset>';
+		<div class="windowbg2">
+			<fieldset>
+				<dl>
+					<dt>
+						<input type="radio" name="method" value="individual" checked id="method_individual" class="input_radio">
+						<label for="method_individual"><strong>', $txt['package_file_perms_apply'], '</strong></label>
+					</dt>
+					<dd>
+						<em class="smalltext">', $txt['package_file_perms_custom'], ': <input type="text" name="custom_value" value="0755" maxlength="4" size="5" class="input_text">&nbsp;<a href="', $scripturl, '?action=helpadmin;help=chmod_flags" onclick="return reqOverlayDiv(this.href);" class="help">(?)</a></em>
+					</dd>
+					<dt>
+						<input type="radio" name="method" value="predefined" id="method_predefined" class="input_radio">
+						<label for="method_predefined"><strong>', $txt['package_file_perms_predefined'], ':</strong></label>
+						<select name="predefined" onchange="document.getElementById(\'method_predefined\').checked = \'checked\';">
+							<option value="restricted" selected>', $txt['package_file_perms_pre_restricted'], '</option>
+							<option value="standard">', $txt['package_file_perms_pre_standard'], '</option>
+							<option value="free">', $txt['package_file_perms_pre_free'], '</option>
+						</select>
+					</dt>
+					<dd>
+						<em class="smalltext">', $txt['package_file_perms_predefined_note'], '</em>
+					</dd>
+				</dl>
+			</fieldset>';
 
 	// Likely to need FTP?
 	if (empty($context['ftp_connected']))
 		echo '
-				<p>
-					', $txt['package_file_perms_ftp_details'], ':
-				</p>
-				', template_control_chmod(), '
-				<div class="information">', $txt['package_file_perms_ftp_retain'], '</div>';
+			<p>
+				', $txt['package_file_perms_ftp_details'], ':
+			</p>
+			', template_control_chmod(), '
+			<div class="noticebox">', $txt['package_file_perms_ftp_retain'], '</div>';
 
 	echo '
-				<span id="test_ftp_placeholder_full"></span>
-				<div class="righttext padding">
-					<input type="hidden" name="action_changes" value="1" />
-					<input type="submit" value="', $txt['package_file_perms_go'], '" name="go" class="button_submit" />
-				</div>
-			</div>
-			<span class="botslice"><span></span></span>
+			<span id="test_ftp_placeholder_full"></span>
+			<input type="hidden" name="action_changes" value="1">
+			<input type="submit" value="', $txt['package_file_perms_go'], '" name="go" class="button_submit">
 		</div>';
 
 	// Any looks fors we've already done?
 	foreach ($context['look_for'] as $path)
 		echo '
-			<input type="hidden" name="back_look[]" value="', $path, '" />';
+			<input type="hidden" name="back_look[]" value="', $path, '">';
 	echo '
-	</form><br />';
+	</form><br>';
 }
 
 function template_permission_show_contents($ident, $contents, $level, $has_more = false)
 {
 	global $settings, $txt, $scripturl, $context;
 	$js_ident = preg_replace('~[^A-Za-z0-9_\-=:]~', ':-:', $ident);
+
 	// Have we actually done something?
 	$drawn_div = false;
 
@@ -1956,8 +1596,8 @@
 			{
 				$drawn_div = true;
 				echo '
-			</table>
-			<table border="0" width="100%" class="table_grid" id="', $js_ident, '">';
+			</tbody>
+			<tbody class="table_grid" id="', $js_ident, '">';
 			}
 
 			$cur_ident = preg_replace('~[^A-Za-z0-9_\-=:]~', ':-:', $ident . '/' . $name);
@@ -1967,8 +1607,7 @@
 					', (!empty($dir['type']) && $dir['type'] == 'dir_recursive') || !empty($dir['list_contents']) ? '<a id="link_' . $cur_ident . '" href="' . $scripturl . '?action=admin;area=packages;sa=perms;find=' . base64_encode($ident . '/' . $name) . ';back_look=' . $context['back_look_data'] . ';' . $context['session_var'] . '=' . $context['session_id'] . '#fol_' . $cur_ident . '" onclick="return expandFolder(\'' . $cur_ident . '\', \'' . addcslashes($ident . '/' . $name, "'\\") . '\');">' : '';
 
 			if (!empty($dir['type']) && ($dir['type'] == 'dir' || $dir['type'] == 'dir_recursive'))
-				echo '
-					<img src="', $settings['default_images_url'], '/board.gif" alt="*" />';
+				echo '<img src="', $settings['default_images_url'], '/board.png" alt="*">';
 
 			echo '
 					', $name, '
@@ -1978,18 +1617,17 @@
 					<span class="', ($dir['perms']['chmod'] ? 'success' : 'error'), '">', ($dir['perms']['chmod'] ? $txt['package_file_perms_writable'] : $txt['package_file_perms_not_writable']), '</span>
 					', ($dir['perms']['perms'] ? '&nbsp;(' . $txt['package_file_perms_chmod'] . ': ' . substr(sprintf('%o', $dir['perms']['perms']), -4) . ')' : ''), '
 				</td>
-				<td align="center" width="8%" class="perm_read"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="read" class="input_radio" /></td>
-				<td align="center" width="8%" class="perm_write"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="writable" class="input_radio" /></td>
-				<td align="center" width="8%" class="perm_execute"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="execute" class="input_radio" /></td>
-				<td align="center" width="8%" class="perm_custom"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="custom" class="input_radio" /></td>
-				<td align="center" width="8%" class="perm_nochange"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="no_change" checked="checked" class="input_radio" /></td>
+				<td class="centertext perm_read"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="read" class="input_radio"></td>
+				<td class="centertext perm_write"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="writable" class="input_radio"></td>
+				<td class="centertext perm_execute"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="execute" class="input_radio"></td>
+				<td class="centertext perm_custom"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="custom" class="input_radio"></td>
+				<td class="centertext perm_nochange"><input type="radio" name="permStatus[', $ident . '/' . $name, ']" value="no_change" checked class="input_radio"></td>
 			</tr>
 			<tr id="insert_div_loc_' . $cur_ident . '" style="display: none;"><td></td></tr>';
 
 			if (!empty($dir['contents']))
 			{
 				template_permission_show_contents($ident . '/' . $name, $dir['contents'], $level + 1, !empty($dir['more_files']));
-
 			}
 		}
 	}
@@ -2016,17 +1654,15 @@
 
 		if ($level > 1 && !$isFound)
 			echo '
-		</table><script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			expandFolder(\'', $js_ident, '\', \'\');
-		// ]]></script>
-		<table border="0" width="100%" class="table_grid">
-			<tr style="display: none;"><td></td></tr>';
+		// ]]></script>';
 	}
 }
 
 function template_action_permissions()
 {
-	global $txt, $scripturl, $context, $settings;
+	global $txt, $scripturl, $context;
 
 	$countDown = 3;
 
@@ -2050,15 +1686,13 @@
 
 	echo '
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<div style="padding-left: 20%; padding-right: 20%; margin-top: 1ex;">
-						<strong>', $progress_message, '</strong>
-						<div style="font-size: 8pt; height: 12pt; border: 1px solid black; background-color: white; padding: 1px; position: relative;">
-							<div style="padding-top: ', $context['browser']['is_webkit'] || $context['browser']['is_konqueror'] ? '2pt' : '1pt', '; width: 100%; z-index: 2; color: black; position: absolute; text-align: center; font-weight: bold;">', $progress_percent, '%</div>
-							<div style="width: ', $progress_percent, '%; height: 12pt; z-index: 1; background-color: #98b8f4;">&nbsp;</div>
-						</div>
-					</div>';
+				<div>
+					<strong>', $progress_message, '</strong><br><br>
+					<div class="progress_bar">
+						<div class="full_bar">', $progress_percent, '%</div>
+						<div class="blue_percent" style="width: ', $progress_percent, '%;">&nbsp;</div>
+					</div>
+				</div>';
 
 	// Second progress bar for a specific directory?
 	if ($context['method'] != 'individual' && !empty($context['total_files']))
@@ -2067,59 +1701,56 @@
 		$file_progress_percent = round($context['file_offset'] / $context['total_files'] * 100, 1);
 
 		echo '
-					<br />
-					<div style="padding-left: 20%; padding-right: 20%; margin-top: 1ex;">
-						<strong>', $file_progress_message, '</strong>
-						<div style="font-size: 8pt; height: 12pt; border: 1px solid black; background-color: white; padding: 1px; position: relative;">
-							<div style="padding-top: ', $context['browser']['is_webkit'] || $context['browser']['is_konqueror'] ? '2pt' : '1pt', '; width: 100%; z-index: 2; color: black; position: absolute; text-align: center; font-weight: bold;">', $file_progress_percent, '%</div>
-							<div style="width: ', $file_progress_percent, '%; height: 12pt; z-index: 1; background-color: #c1ffc1;">&nbsp;</div>
-						</div>
-					</div>';
+				<br>
+				<div>
+					<strong>', $file_progress_message, '</strong><br><br>
+					<div class="progress_bar">
+						<div class="full_bar">', $file_progress_percent, '%</div>
+						<div class="green_percent" style="width: ', $file_progress_percent, '%;">&nbsp;</div>
+					</div>
+				</div>';
 	}
 
 	echo '
-					<br />';
+				<br>';
 
 	// Put out the right hidden data.
 	if ($context['method'] == 'individual')
 		echo '
-					<input type="hidden" name="custom_value" value="', $context['custom_value'], '" />
-					<input type="hidden" name="totalItems" value="', $context['total_items'], '" />
-					<input type="hidden" name="toProcess" value="', base64_encode(serialize($context['to_process'])), '" />';
+				<input type="hidden" name="custom_value" value="', $context['custom_value'], '">
+				<input type="hidden" name="totalItems" value="', $context['total_items'], '">
+				<input type="hidden" name="toProcess" value="', base64_encode(serialize($context['to_process'])), '">';
 	else
 		echo '
-					<input type="hidden" name="predefined" value="', $context['predefined_type'], '" />
-					<input type="hidden" name="fileOffset" value="', $context['file_offset'], '" />
-					<input type="hidden" name="totalItems" value="', $context['total_items'], '" />
-					<input type="hidden" name="dirList" value="', base64_encode(serialize($context['directory_list'])), '" />
-					<input type="hidden" name="specialFiles" value="', base64_encode(serialize($context['special_files'])), '" />';
+				<input type="hidden" name="predefined" value="', $context['predefined_type'], '">
+				<input type="hidden" name="fileOffset" value="', $context['file_offset'], '">
+				<input type="hidden" name="totalItems" value="', $context['total_items'], '">
+				<input type="hidden" name="dirList" value="', base64_encode(serialize($context['directory_list'])), '">
+				<input type="hidden" name="specialFiles" value="', base64_encode(serialize($context['special_files'])), '">';
 
 	// Are we not using FTP for whatever reason.
 	if (!empty($context['skip_ftp']))
 		echo '
-					<input type="hidden" name="skip_ftp" value="1" />';
+				<input type="hidden" name="skip_ftp" value="1">';
 
 	// Retain state.
 	foreach ($context['back_look_data'] as $path)
 		echo '
-					<input type="hidden" name="back_look[]" value="', $path, '" />';
+				<input type="hidden" name="back_look[]" value="', $path, '">';
 
 	echo '
-					<input type="hidden" name="method" value="', $context['method'], '" />
-					<input type="hidden" name="action_changes" value="1" />
-					<div class="righttext padding">
-						<input type="submit" name="go" id="cont" value="', $txt['not_done_continue'], '" class="button_submit" />
-					</div>
+				<input type="hidden" name="method" value="', $context['method'], '">
+				<input type="hidden" name="action_changes" value="1">
+				<div class="righttext padding">
+					<input type="submit" name="go" id="cont" value="', $txt['not_done_continue'], '" class="button_submit">
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 
 	// Just the countdown stuff
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var countdown = ', $countDown, ';
 		doAutoSubmit();
 
diff -ru a/Themes/default/PersonalMessage.template.php b/Themes/default/PersonalMessage.template.php
--- a/Themes/default/PersonalMessage.template.php	2011-06-10 03:42:24.000000000 -0700
+++ b/Themes/default/PersonalMessage.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,17 +3,18 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
-// This is the main sidebar for the personal messages section.
+
+// This is for stuff above the menu in the personal messages section.
 function template_pm_above()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 
 	echo '
 	<div id="personal_messages">';
@@ -21,8 +22,8 @@
 	// Show the capacity bar, if available.
 	if (!empty($context['limit_bar']))
 		echo '
-		<div class="title_bar">
-			<h3 class="titlebg">
+		<div class="cat_bar">
+			<h3 class="catbg">
 				<span class="floatleft">', $txt['pm_capacity'], ':</span>
 				<span class="floatleft capacity_bar">
 					<span class="', $context['limit_bar']['percent'] > 85 ? 'full' : ($context['limit_bar']['percent'] > 40 ? 'filled' : 'empty'), '" style="width: ', $context['limit_bar']['percent'] / 10, 'em;"></span>
@@ -34,7 +35,7 @@
 	// Message sent? Show a small indication.
 	if (isset($context['pm_sent']))
 		echo '
-		<div class="windowbg" id="profile_success">
+		<div class="infobox">
 			', $txt['pm_sent'], '
 		</div>';
 }
@@ -42,19 +43,62 @@
 // Just the end of the index bar, nothing special.
 function template_pm_below()
 {
-	global $context, $settings, $options;
-
 	echo '
 	</div>';
 }
 
+function template_pm_popup()
+{
+	global $context, $txt, $scripturl;
+
+	// Unlike almost every other template, this is designed to be included into the HTML directly via $().load()
+	echo '
+		<div class="pm_bar">
+			<div class="pm_sending floatright">
+				', $context['can_send_pm'] ? '<a href="' . $scripturl . '?action=pm;sa=send">' . $txt['pm_new_short'] . '</a> | ' : '', '
+				', $context['can_draft'] ? '<a href="' . $scripturl . '?action=pm;sa=showpmdrafts">' . $txt['pm_drafts_short'] . '</a> | ' : '', '
+				<a href="', $scripturl, '?action=pm;sa=settings">', $txt['pm_settings_short'], '</a>
+			</div>
+			<div class="pm_mailbox floatleft">
+				<a href="', $scripturl, '?action=pm">', $txt['inbox'], '</a>
+				| <a href="', $scripturl, '?action=pm;f=sent">', $txt['pm_sent_short'], '</a>
+			</div>
+		</div>
+		<div class="pm_unread">';
+
+	if (empty($context['unread_pms']))
+	{
+		echo '
+			<div class="no_unread">', $txt['pm_no_unread'], '</div>';
+	}
+	else
+	{
+		foreach ($context['unread_pms'] as $id_pm => $pm_details)
+		{
+			echo '
+			<div class="unread">
+				<div class="avatar floatleft">', !empty($pm_details['member']) ? $pm_details['member']['avatar']['image'] : '', '</div>
+				<div class="details floatleft">
+					<div class="subject">', $pm_details['pm_link'], '</div>
+					<div class="sender">', $pm_details['replied_to_you'] ? '<span class="generic_icons replied centericon" style="margin-right: 4px" title="' . $txt['pm_you_were_replied_to'] . '"></span>' : '<span class="generic_icons im_off centericon" style="margin-right: 4px" title="' . $txt['pm_was_sent_to_you'] . '"></span>',
+					!empty($pm_details['member']) ? $pm_details['member']['link'] : $pm_details['member_from'], ' - ', $pm_details['time'], '</div>
+				</div>
+				<br class="clear">
+			</div>';
+		}
+	}
+
+	echo '
+		</div>';
+}
+
 function template_folder()
 {
 	global $context, $settings, $options, $scripturl, $modSettings, $txt;
 
 	// The every helpful javascript!
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var allLabels = {};
 		var currentLabels = {};
 		function loadLabelChoices()
@@ -64,10 +108,9 @@
 			var add, remove, toAdd = {length: 0}, toRemove = {length: 0};
 
 			if (theSelect.childNodes.length == 0)
-				return;';
+				return;
 
-	// This is done this way for internationalization reasons.
-	echo '
+			// This is done this way for internationalization reasons.
 			if (!(\'-1\' in allLabels))
 			{
 				for (var o = 0; o < theSelect.options.length; o++)
@@ -139,7 +182,7 @@
 	if ($context['display_mode'] != 1)
 	{
 		template_subject_list();
-		echo '<div class="clear_right"><br /></div>';
+		echo '<div class="clear_right"><br></div>';
 	}
 
 	// Got some messages to display?
@@ -158,17 +201,11 @@
 		// Show a few buttons if we are in conversation mode and outputting the first message.
 		if ($context['display_mode'] == 2)
 		{
-			// Build the normal button array.
-			$conversation_buttons = array(
-				'reply' => array('text' => 'reply_to_all', 'image' => 'reply.gif', 'lang' => true, 'url' => $scripturl . '?action=pm;sa=send;f=' . $context['folder'] . ($context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '') . ';pmsg=' . $context['current_pm'] . ';u=all', 'active' => true),
-				'delete' => array('text' => 'delete_conversation', 'image' => 'delete.gif', 'lang' => true, 'url' => $scripturl . '?action=pm;sa=pmactions;pm_actions[' . $context['current_pm'] . ']=delete;conversation;f=' . $context['folder'] . ';start=' . $context['start'] . ($context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '') . ';' . $context['session_var'] . '=' . $context['session_id'], 'custom' => 'onclick="return confirm(\'' . addslashes($txt['remove_message']) . '?\');"'),
-			);
-
 			// Show the conversation buttons.
 			echo '
 					<div class="pagesection">';
 
-			template_button_strip($conversation_buttons, 'right');
+			template_button_strip($context['conversation_buttons'], 'right');
 
 			echo '
 					</div>';
@@ -176,164 +213,169 @@
 
 		while ($message = $context['get_pmessage']('message'))
 		{
-			$window_class = $message['alternate'] == 0 ? 'windowbg' : 'windowbg2';
 
 			echo '
-	<div class="', $window_class, ' clear">
-		<span class="topslice"><span></span></span>
-		<div class="poster">
-			<a id="msg', $message['id'], '"></a>
-			<h4>';
+	<div class="windowbg">
+		<div class="poster">';
+
+		// Are there any custom fields above the member name?
+		if (!empty($message['custom_fields']['above_member']))
+		{
+			echo '
+			<div class="custom_fields_above_member">
+				<ul class="reset nolist">';
 
-			// Show online and offline buttons?
-			if (!empty($modSettings['onlineEnable']) && !$message['member']['is_guest'])
+			foreach ($message['custom_fields']['above_member'] as $custom)
 				echo '
-				<img src="', $message['member']['online']['image_href'], '" alt="', $message['member']['online']['text'], '" />';
+					<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
 
 			echo '
-				', $message['member']['link'], '
-			</h4>
-			<ul class="reset smalltext" id="msg_', $message['id'], '_extra_info">';
+				</ul>
+			</div>';
+		}
 
-			// Show the member's custom title, if they have one.
-			if (isset($message['member']['title']) && $message['member']['title'] != '')
+			echo '
+			<h4>
+				<a id="msg', $message['id'], '"></a>';
+
+		// Show online and offline buttons?
+		if (!empty($modSettings['onlineEnable']) && !$message['member']['is_guest'])
+			echo '
+				<span class="' . ($message['member']['online']['is_online'] == 1 ? 'on' : 'off') . '" title="' . $message['member']['online']['text'] . '"></span>';
+
+		// Show a link to the member's profile (but only if the sender isn't a guest).
 				echo '
-				<li class="title">', $message['member']['title'], '</li>';
+					', $message['member']['link'], '';
+
+		echo '
+			</h4>';
+
+		echo '
+			<ul class="user_info">';
+
+			// Show the user's avatar.
+			if (!empty($modSettings['show_user_images']) && empty($options['show_no_avatars']) && !empty($message['member']['avatar']['image']))
+				echo '
+				<li class="avatar">
+					<a href="', $scripturl, '?action=profile;u=', $message['member']['id'], '">', $message['member']['avatar']['image'], '</a>
+				</li>';
+
+		// Are there any custom fields below the avatar?
+		if (!empty($message['custom_fields']['below_avatar']))
+			foreach ($message['custom_fields']['below_avatar'] as $custom)
+				echo '
+				<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
 
+			if (!$message['member']['is_guest'])
+				echo '
+				<li class="icons">', $message['member']['group_icons'], '</li>';
 			// Show the member's primary group (like 'Administrator') if they have one.
 			if (isset($message['member']['group']) && $message['member']['group'] != '')
 				echo '
 				<li class="membergroup">', $message['member']['group'], '</li>';
 
+			// Show the member's custom title, if they have one.
+			if (isset($message['member']['title']) && $message['member']['title'] != '')
+				echo '
+				<li class="title">', $message['member']['title'], '</li>';
+
 			// Don't show these things for guests.
 			if (!$message['member']['is_guest'])
 			{
 				// Show the post group if and only if they have no other group or the option is on, and they are in a post group.
-				if ((empty($settings['hide_post_group']) || $message['member']['group'] == '') && $message['member']['post_group'] != '')
+				if ((empty($modSettings['hide_post_group']) || $message['member']['group'] == '') && $message['member']['post_group'] != '')
 					echo '
 				<li class="postgroup">', $message['member']['post_group'], '</li>';
-				echo '
-				<li class="stars">', $message['member']['group_stars'], '</li>';
-
-				// Show avatars, images, etc.?
-				if (!empty($settings['show_user_images']) && empty($options['show_no_avatars']) && !empty($message['member']['avatar']['image']))
-					echo '
-				<li class="avatar">
-					<a href="', $scripturl, '?action=profile;u=', $message['member']['id'], '">
-						', $message['member']['avatar']['image'], '
-					</a>
-				</li>';
 
 				// Show how many posts they have made.
 				if (!isset($context['disabled_fields']['posts']))
 					echo '
 				<li class="postcount">', $txt['member_postcount'], ': ', $message['member']['posts'], '</li>';
 
-				// Is karma display enabled?  Total or +/-?
-				if ($modSettings['karmaMode'] == '1')
-					echo '
-				<li class="karma">', $modSettings['karmaLabel'], ' ', $message['member']['karma']['good'] - $message['member']['karma']['bad'], '</li>';
-				elseif ($modSettings['karmaMode'] == '2')
-					echo '
-				<li class="karma">', $modSettings['karmaLabel'], ' +', $message['member']['karma']['good'], '/-', $message['member']['karma']['bad'], '</li>';
-
-				// Is this user allowed to modify this member's karma?
-				if ($message['member']['karma']['allow'])
-					echo '
-				<li class="karma_allow">
-					<a href="', $scripturl, '?action=modifykarma;sa=applaud;uid=', $message['member']['id'], ';f=', $context['folder'], ';start=', $context['start'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pm=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $modSettings['karmaApplaudLabel'], '</a> <a href="', $scripturl, '?action=modifykarma;sa=smite;uid=', $message['member']['id'], ';f=', $context['folder'], ';start=', $context['start'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pm=', $message['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $modSettings['karmaSmiteLabel'], '</a>
-				</li>';
-
-				// Show the member's gender icon?
-				if (!empty($settings['show_gender']) && $message['member']['gender']['image'] != '' && !isset($context['disabled_fields']['gender']))
-					echo '
-				<li class="gender">', $txt['gender'], ': ', $message['member']['gender']['image'], '</li>';
-
 				// Show their personal text?
-				if (!empty($settings['show_blurb']) && $message['member']['blurb'] != '')
+				if (!empty($modSettings['show_blurb']) && $message['member']['blurb'] != '')
 					echo '
 				<li class="blurb">', $message['member']['blurb'], '</li>';
 
 				// Any custom fields to show as icons?
-				if (!empty($message['member']['custom_fields']))
+				if (!empty($message['custom_fields']['icons']))
 				{
-					$shown = false;
-					foreach ($message['member']['custom_fields'] as $custom)
-					{
-						if ($custom['placement'] != 1 || empty($custom['value']))
-							continue;
-						if (empty($shown))
-						{
-							$shown = true;
-							echo '
+					echo '
 				<li class="im_icons">
-					<ul>';
-						}
+					<ol>';
+
+					foreach ($message['custom_fields']['icons'] as $custom)
 						echo '
-						<li>', $custom['value'], '</li>';
-					}
-					if ($shown)
+						<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
+
 					echo '
-					</ul>
+					</ol>
 				</li>';
 				}
 
-				// This shows the popular messaging icons.
-				if ($message['member']['has_messenger'] && $message['member']['can_view_profile'])
-					echo '
-				<li class="im_icons">
-					<ul>', !isset($context['disabled_fields']['icq']) && !empty($message['member']['icq']['link']) ? '
-						<li>' . $message['member']['icq']['link'] . '</li>' : '', !isset($context['disabled_fields']['msn']) && !empty($message['member']['msn']['link']) ? '
-						<li>' . $message['member']['msn']['link'] . '</li>' : '', !isset($context['disabled_fields']['aim']) && !empty($message['member']['aim']['link']) ? '
-						<li>' . $message['member']['aim']['link'] . '</li>' : '', !isset($context['disabled_fields']['yim']) && !empty($message['member']['yim']['link']) ? '
-						<li>' . $message['member']['yim']['link'] . '</li>' : '', '
-					</ul>
-				</li>';
+		// Show the IP to this user for this post - because you can moderate?
+		if (!empty($context['can_moderate_forum']) && !empty($message['member']['ip']))
+			echo '
+				<li class="poster_ip"><a href="', $scripturl, '?action=', !empty($message['member']['is_guest']) ? 'trackip' : 'profile;area=tracking;sa=ip;u=' . $message['member']['id'], ';searchip=', $message['member']['ip'], '">', $message['member']['ip'], '</a> <a href="', $scripturl, '?action=helpadmin;help=see_admin_ip" onclick="return reqOverlayDiv(this.href);" class="help">(?)</a></li>';
+
+		// Or, should we show it because this is you?
+		elseif ($message['can_see_ip'])
+			echo '
+				<li class="poster_ip"><a href="', $scripturl, '?action=helpadmin;help=see_member_ip" onclick="return reqOverlayDiv(this.href);" class="help">', $message['member']['ip'], '</a></li>';
+
+		// Okay, you are logged in, then we can show something about why IPs are logged...
+		else
+			echo '
+				<li class="poster_ip"><a href="', $scripturl, '?action=helpadmin;help=see_member_ip" onclick="return reqOverlayDiv(this.href);" class="help">', $txt['logged'], '</a></li>';
 
 				// Show the profile, website, email address, and personal message buttons.
-				if ($settings['show_profile_buttons'])
+				if ($message['member']['show_profile_buttons'])
 				{
 					echo '
 				<li class="profile">
-					<ul>';
+					<ol class="profile_icons">';
 
 					// Show the profile button
-					echo '
-						<li><a href="', $message['member']['href'], '">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/icons/profile_sm.gif" alt="' . $txt['view_profile'] . '" title="' . $txt['view_profile'] . '" />' : $txt['view_profile']), '</a></li>';
+					if ($message['member']['can_view_profile'])
+						echo '
+						<li><a href="', $message['member']['href'], '">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/icons/profile_sm.png" alt="' . $txt['view_profile'] . '" title="' . $txt['view_profile'] . '">' : $txt['view_profile']), '</a></li>';
 
 					// Don't show an icon if they haven't specified a website.
 					if ($message['member']['website']['url'] != '' && !isset($context['disabled_fields']['website']))
 						echo '
-						<li><a href="', $message['member']['website']['url'], '" title="' . $message['member']['website']['title'] . '" target="_blank" class="new_win">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/www_sm.gif" alt="' . $message['member']['website']['title'] . '" />' : $txt['www']), '</a></li>';
+						<li><a href="', $message['member']['website']['url'], '" title="' . $message['member']['website']['title'] . '" target="_blank" class="new_win">', ($settings['use_image_buttons'] ? '<span class="generic_icons www centericon" title="' . $message['member']['website']['title'] . '"></span>' : $txt['www']), '</a></li>';
 
 					// Don't show the email address if they want it hidden.
-					if (in_array($message['member']['show_email'], array('yes', 'yes_permission_override', 'no_through_forum')))
+					if ($message['member']['show_email'])
 						echo '
-						<li><a href="', $scripturl, '?action=emailuser;sa=email;uid=', $message['member']['id'], '" rel="nofollow">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/email_sm.gif" alt="' . $txt['email'] . '" title="' . $txt['email'] . '" />' : $txt['email']), '</a></li>';
+						<li><a href="mailto:', $message['member']['email'], '" rel="nofollow">', ($settings['use_image_buttons'] ? '<span class="generic_icons mail centericon" title="' . $txt['email'] . '"></span>' : $txt['email']), '</a></li>';
 
 					// Since we know this person isn't a guest, you *can* message them.
 					if ($context['can_send_pm'])
 						echo '
-						<li><a href="', $scripturl, '?action=pm;sa=send;u=', $message['member']['id'], '" title="', $message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline'], '">', $settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/im_' . ($message['member']['online']['is_online'] ? 'on' : 'off') . '.gif" alt="' . ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']) . '" />' : ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']), '</a></li>';
+						<li><a href="', $scripturl, '?action=pm;sa=send;u=', $message['member']['id'], '" title="', $message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline'], '">', $settings['use_image_buttons'] ? '<span class="generic_icons im_' . ($message['member']['online']['is_online'] ? 'on' : 'off') . ' centericon" title="' . ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']) . '"></span> ' : ($message['member']['online']['is_online'] ? $txt['pm_online'] : $txt['pm_offline']), '</a></li>';
 
 					echo '
-					</ul>
+					</ol>
 				</li>';
 				}
 
 				// Any custom fields for standard placement?
-				if (!empty($message['member']['custom_fields']))
-				{
-					foreach ($message['member']['custom_fields'] as $custom)
-						if (empty($custom['placement']) || empty($custom['value']))
-							echo '
-				<li class="custom">', $custom['title'], ': ', $custom['value'], '</li>';
-				}
+				if (!empty($message['custom_fields']['standard']))
+					foreach ($message['custom_fields']['standard'] as $custom)
+						echo '
+				<li class="custom ', $custom['col_name'] ,'">', $custom['title'], ': ', $custom['value'], '</li>';
 
 				// Are we showing the warning status?
 				if ($message['member']['can_see_warning'])
-				echo '
-				<li class="warning">', $context['can_issue_warning'] ? '<a href="' . $scripturl . '?action=profile;area=issuewarning;u=' . $message['member']['id'] . '">' : '', '<img src="', $settings['images_url'], '/warning_', $message['member']['warning_status'], '.gif" alt="', $txt['user_warn_' . $message['member']['warning_status']], '" />', $context['can_issue_warning'] ? '</a>' : '', '<span class="warn_', $message['member']['warning_status'], '">', $txt['warn_' . $message['member']['warning_status']], '</span></li>';
+					echo '
+				<li class="warning">', $context['can_issue_warning'] ? '<a href="' . $scripturl . '?action=profile;area=issuewarning;u=' . $message['member']['id'] . '">' : '', '<span class="generic_icons warning_', $message['member']['warning_status'], '"></span>', $context['can_issue_warning'] ? '</a>' : '', '<span class="warn_', $message['member']['warning_status'], '">', $txt['warn_' . $message['member']['warning_status']], '</span></li>';
+
+				// Are there any custom fields to show at the bottom of the poster info?
+				if (!empty($message['custom_fields']['bottom_poster']))
+					foreach ($message['custom_fields']['bottom_poster'] as $custom)
+						echo '
+				<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
 			}
 
 			// Done with the information about the poster... on to the post itself.
@@ -365,14 +407,23 @@
 			// If we're in the sent items, show who it was sent to besides the "To:" people.
 			if (!empty($message['recipients']['bcc']))
 				echo '
-					<br /><span class="smalltext">&#171; <strong> ', $txt['pm_bcc'], ':</strong> ', implode(', ', $message['recipients']['bcc']), ' &#187;</span>';
+					<br><span class="smalltext">&#171; <strong> ', $txt['pm_bcc'], ':</strong> ', implode(', ', $message['recipients']['bcc']), ' &#187;</span>';
 
 			if (!empty($message['is_replied_to']))
 				echo '
-					<br /><span class="smalltext">&#171; ', $txt['pm_is_replied_to'], ' &#187;</span>';
+					<br><span class="smalltext">&#171; ', $txt['pm_is_replied_to'], ' &#187;</span>';
 
 			echo '
 				</div>
+			</div>
+			<div class="post">
+				<div class="inner" id="msg_', $message['id'], '"', '>', $message['body'], '</div>';
+
+			if ($message['can_report'])
+			echo '
+				<a href="' . $scripturl . '?action=pm;sa=report;l=' . $context['current_label_id'] . ';pmsg=' . $message['id'] . '" class="floatright">' . $txt['pm_report_to_admin'] . '</a>';
+
+			echo '
 				<ul class="reset smalltext quickbuttons">';
 
 			// Show reply buttons if you have the permission to send PMs.
@@ -382,59 +433,43 @@
 				if (!$message['member']['is_guest'])
 				{
 					// Is there than more than one recipient you can reply to?
-					if ($message['number_recipients'] > 1 && $context['display_mode'] != 2)
+					if ($message['number_recipients'] > 1)
 						echo '
-					<li class="reply_all_button"><a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote;u=all">', $txt['reply_to_all'], '</a></li>';
+					<li><a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote;u=all" class="reply_all_button">', $txt['reply_to_all'], '</a></li>';
 
 					echo '
-					<li class="reply_button"><a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';u=', $message['member']['id'], '">', $txt['reply'], '</a></li>
-					<li class="quote_button"><a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote', $context['folder'] == 'sent' ? '' : ';u=' . $message['member']['id'], '">', $txt['quote'], '</a></li>';
+					<li><a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';u=', $message['member']['id'], '" class="reply_button">', $txt['reply'], '</a></li>
+					<li><a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote', $context['folder'] == 'sent' ? '' : ';u=' . $message['member']['id'], '" class="quote_button">', $txt['quote_action'], '</a></li>';
 				}
 				// This is for "forwarding" - even if the member is gone.
 				else
 					echo '
-					<li class="forward_button"><a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote">', $txt['reply_quote'], '</a></li>';
+					<li><a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote" class="quote_button">', $txt['reply_quote'], '</a></li>';
 			}
 			echo '
-					<li class="remove_button"><a href="', $scripturl, '?action=pm;sa=pmactions;pm_actions[', $message['id'], ']=delete;f=', $context['folder'], ';start=', $context['start'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', addslashes($txt['remove_message']), '?\');">', $txt['delete'], '</a></li>';
+					<li><a href="', $scripturl, '?action=pm;sa=pmactions;pm_actions%5b', $message['id'], '%5D=delete;f=', $context['folder'], ';start=', $context['start'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';', $context['session_var'], '=', $context['session_id'], '" data-confirm="', addslashes($txt['remove_message_question']), '" class="remove_button you_sure">', $txt['delete'], '</a></li>';
 
 			if (empty($context['display_mode']))
 				echo '
-					<li class="inline_mod_check"><input type="checkbox" name="pms[]" id="deletedisplay', $message['id'], '" value="', $message['id'], '" onclick="document.getElementById(\'deletelisting', $message['id'], '\').checked = this.checked;" class="input_check" /></li>';
+					<li><input type="checkbox" name="pms[]" id="deletedisplay', $message['id'], '" value="', $message['id'], '" onclick="document.getElementById(\'deletelisting', $message['id'], '\').checked = this.checked;" class="input_check"></li>';
 
 			echo '
-				</ul>
-			</div>
-			<div class="post">
-				<div class="inner" id="msg_', $message['id'], '"', '>', $message['body'], '</div>
-				<div class="smalltext reportlinks">
-					', (!empty($modSettings['enableReportPM']) && $context['folder'] != 'sent' ? '<div class="righttext"><a href="' . $scripturl . '?action=pm;sa=report;l=' . $context['current_label_id'] . ';pmsg=' . $message['id'] . '">' . $txt['pm_report_to_admin'] . '</a></div>' : '');
-
-			echo '
-				</div>';
+				</ul>';
 
 			// Are there any custom profile fields for above the signature?
-			if (!empty($message['member']['custom_fields']))
+			if (!empty($message['custom_fields']['above_signature']))
 			{
-				$shown = false;
-				foreach ($message['member']['custom_fields'] as $custom)
-				{
-					if ($custom['placement'] != 2 || empty($custom['value']))
-						continue;
-					if (!$shown)
-					{
-						$shown = true;
-						echo '
-				<div class="custom_fields_above_signature">
-					<ul class="reset nolist">';
-					}
-					echo '
-						<li>', $custom['value'], '</li>';
-				}
-				if ($shown)
+				echo '
+					<div class="custom_fields_above_signature">
+						<ul class="reset nolist">';
+
+				foreach ($message['custom_fields']['above_signature'] as $custom)
 					echo '
-					</ul>
-				</div>';
+							<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
+
+				echo '
+						</ul>
+					</div>';
 			}
 
 			// Show the member's signature?
@@ -442,24 +477,40 @@
 				echo '
 				<div class="signature">', $message['member']['signature'], '</div>';
 
+			// Are there any custom profile fields for below the signature?
+			if (!empty($message['custom_fields']['below_signature']))
+			{
+				echo '
+					<div class="custom_fields_below_signature">
+						<ul class="reset nolist">';
+
+				foreach ($message['custom_fields']['below_signature'] as $custom)
+					echo '
+							<li class="custom ', $custom['col_name'] ,'">', $custom['value'], '</li>';
+
+				echo '
+						</ul>
+					</div>';
+			}
+
 			// Add an extra line at the bottom if we have labels enabled.
 			if ($context['folder'] != 'sent' && !empty($context['currently_using_labels']) && $context['display_mode'] != 2)
 			{
 				echo '
-				<div class="labels righttext">';
+				<div class="labels righttext flow_auto">';
 				// Add the label drop down box.
 				if (!empty($context['currently_using_labels']))
 				{
 					echo '
 					<select name="pm_actions[', $message['id'], ']" onchange="if (this.options[this.selectedIndex].value) form.submit();">
 						<option value="">', $txt['pm_msg_label_title'], ':</option>
-						<option value="" disabled="disabled">---------------</option>';
+						<option value="" disabled>---------------</option>';
 
 					// Are there any labels which can be added to this?
 					if (!$message['fully_labeled'])
 					{
 						echo '
-						<option value="" disabled="disabled">', $txt['pm_msg_label_apply'], ':</option>';
+						<option value="" disabled>', $txt['pm_msg_label_apply'], ':</option>';
 						foreach ($context['labels'] as $label)
 							if (!isset($message['labels'][$label['id']]))
 								echo '
@@ -469,7 +520,7 @@
 					if (!empty($message['labels']) && (count($message['labels']) > 1 || !isset($message['labels'][-1])))
 					{
 						echo '
-						<option value="" disabled="disabled">', $txt['pm_msg_label_remove'], ':</option>';
+						<option value="" disabled>', $txt['pm_msg_label_remove'], ':</option>';
 						foreach ($message['labels'] as $label)
 							echo '
 							<option value="', $label['id'], '">&nbsp;', $label['name'], '</option>';
@@ -477,7 +528,7 @@
 					echo '
 					</select>
 					<noscript>
-						<input type="submit" value="', $txt['pm_apply'], '" class="button_submit" />
+						<input type="submit" value="', $txt['pm_apply'], '" class="button_submit" style="float: none">
 					</noscript>';
 				}
 				echo '
@@ -486,11 +537,9 @@
 
 			echo '
 			</div>
-			<br class="clear" />
 		</div>
 		<div class="moderatorbar">
 		</div>
-		<span class="botslice"><span></span></span>
 	</div>';
 		}
 
@@ -498,79 +547,78 @@
 			echo '
 
 	<div class="pagesection">
-		<div class="floatleft">', $txt['pages'], ': ', $context['page_index'], '</div>
-		<div class="floatright"><input type="submit" name="del_selected" value="', $txt['quickmod_delete_selected'], '" style="font-weight: normal;" onclick="if (!confirm(\'', $txt['delete_selected_confirm'], '\')) return false;" class="button_submit" /></div>
+		<div class="floatleft">', $context['page_index'], '</div>
+		<div class="floatright"><input type="submit" name="del_selected" value="', $txt['quickmod_delete_selected'], '" style="font-weight: normal;" onclick="if (!confirm(\'', $txt['delete_selected_confirm'], '\')) return false;" class="button_submit"></div>
 	</div>';
 
 		// Show a few buttons if we are in conversation mode and outputting the first message.
-		elseif ($context['display_mode'] == 2 && isset($conversation_buttons))
+		elseif ($context['display_mode'] == 2 && isset($context['conversation_buttons']))
 		{
 			echo '
 
 	<div class="pagesection">';
 
-			template_button_strip($conversation_buttons, 'right');
+			template_button_strip($context['conversation_buttons'], 'right');
 
 			echo '
 	</div>';
 		}
 
 		echo '
-		<br />';
+		<br>';
 	}
 
 	// Individual messages = buttom list!
 	if ($context['display_mode'] == 1)
 	{
 		template_subject_list();
-		echo '<br />';
+		echo '<br>';
 	}
 
 	echo '
-	<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+	<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 </form>';
 }
 
 // Just list all the personal message subjects - to make templates easier.
 function template_subject_list()
 {
-	global $context, $options, $settings, $modSettings, $txt, $scripturl;
+	global $context, $settings, $txt, $scripturl;
 
 	echo '
-	<table width="100%" class="table_grid">
+	<table class="table_grid">
 	<thead>
-		<tr class="catbg">
-			<th align="center" width="4%" class="first_th">
-				<a href="', $scripturl, '?action=pm;view;f=', $context['folder'], ';start=', $context['start'], ';sort=', $context['sort_by'], ($context['sort_direction'] == 'up' ? '' : ';desc'), ($context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : ''), '"><img src="', $settings['images_url'], '/im_switch.gif" alt="', $txt['pm_change_view'], '" title="', $txt['pm_change_view'], '" width="16" height="16" /></a>
+		<tr class="title_bar">
+			<th width="4%" class="centercol">
+				<a href="', $scripturl, '?action=pm;view;f=', $context['folder'], ';start=', $context['start'], ';sort=', $context['sort_by'], ($context['sort_direction'] == 'up' ? '' : ';desc'), ($context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : ''), '"> <span class="generic_icons switch" title="', $txt['pm_change_view'], '"></span></a>
 			</th>
 			<th class="lefttext" width="22%">
-				<a href="', $scripturl, '?action=pm;f=', $context['folder'], ';start=', $context['start'], ';sort=date', $context['sort_by'] == 'date' && $context['sort_direction'] == 'up' ? ';desc' : '', $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', '">', $txt['date'], $context['sort_by'] == 'date' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
+				<a href="', $scripturl, '?action=pm;f=', $context['folder'], ';start=', $context['start'], ';sort=date', $context['sort_by'] == 'date' && $context['sort_direction'] == 'up' ? ';desc' : '', $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', '">', $txt['date'], $context['sort_by'] == 'date' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a>
 			</th>
 			<th class="lefttext" width="46%">
-				<a href="', $scripturl, '?action=pm;f=', $context['folder'], ';start=', $context['start'], ';sort=subject', $context['sort_by'] == 'subject' && $context['sort_direction'] == 'up' ? ';desc' : '', $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', '">', $txt['subject'], $context['sort_by'] == 'subject' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
+				<a href="', $scripturl, '?action=pm;f=', $context['folder'], ';start=', $context['start'], ';sort=subject', $context['sort_by'] == 'subject' && $context['sort_direction'] == 'up' ? ';desc' : '', $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', '">', $txt['subject'], $context['sort_by'] == 'subject' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a>
 			</th>
 			<th class="lefttext">
-				<a href="', $scripturl, '?action=pm;f=', $context['folder'], ';start=', $context['start'], ';sort=name', $context['sort_by'] == 'name' && $context['sort_direction'] == 'up' ? ';desc' : '', $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', '">', ($context['from_or_to'] == 'from' ? $txt['from'] : $txt['to']), $context['sort_by'] == 'name' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
+				<a href="', $scripturl, '?action=pm;f=', $context['folder'], ';start=', $context['start'], ';sort=name', $context['sort_by'] == 'name' && $context['sort_direction'] == 'up' ? ';desc' : '', $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', '">', ($context['from_or_to'] == 'from' ? $txt['from'] : $txt['to']), $context['sort_by'] == 'name' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a>
 			</th>
-			<th align="center" width="4%" class="last_th">
-				<input type="checkbox" onclick="invertAll(this, this.form);" class="input_check" />
+			<th width="4%" class="centercol">
+				<input type="checkbox" onclick="invertAll(this, this.form);" class="input_check">
 			</th>
 		</tr>
 	</thead>
 	<tbody>';
 	if (!$context['show_delete'])
 		echo '
-		<tr class="windowbg2">
-			<td colspan="5">', $txt['msg_alert_none'], '</td>
+		<tr class="windowbg">
+			<td colspan="5">', $txt['pm_alert_none'], '</td>
 		</tr>';
-	$next_alternate = false;
 
 	while ($message = $context['get_pmessage']('subject'))
 	{
 		echo '
-		<tr class="', $next_alternate ? 'windowbg' : 'windowbg2', '">
-			<td align="center" width="4%">
-			<script type="text/javascript"><!-- // --><![CDATA[
+		<tr class="windowbg">
+			<td width="4%">
+			<script><!-- // --><![CDATA[
 				currentLabels[', $message['id'], '] = {';
 
 		if (!empty($message['labels']))
@@ -587,20 +635,19 @@
 		echo '
 				};
 			// ]]></script>
-				', $message['is_replied_to'] ? '<img src="' . $settings['images_url'] . '/icons/pm_replied.gif" style="margin-right: 4px;" alt="' . $txt['pm_replied'] . '" />' : '<img src="' . $settings['images_url'] . '/icons/pm_read.gif" style="margin-right: 4px;" alt="' . $txt['pm_read'] . '" />', '</td>
+				', $message['is_replied_to'] ? '<span class="generic_icons replied" title="' . $txt['pm_replied'] . '"></span>' : '<span class="generic_icons im_off" title="' . $txt['pm_read'] . '"></span>', '</td>
 			<td>', $message['time'], '</td>
-			<td>', ($context['display_mode'] != 0 && $context['current_pm'] == $message['id'] ? '<img src="' . $settings['images_url'] . '/selected.gif" alt="*" />' : ''), '<a href="', ($context['display_mode'] == 0 || $context['current_pm'] == $message['id'] ? '' : ($scripturl . '?action=pm;pmid=' . $message['id'] . ';kstart;f=' . $context['folder'] . ';start=' . $context['start'] . ';sort=' . $context['sort_by'] . ($context['sort_direction'] == 'up' ? ';' : ';desc') . ($context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : ''))), '#msg', $message['id'], '">', $message['subject'], '</a>', $message['is_unread'] ? '&nbsp;<img src="' . $settings['lang_images_url'] . '/new.gif" alt="' . $txt['new'] . '" />' : '', '</td>
+			<td>', ($context['display_mode'] != 0 && $context['current_pm'] == $message['id'] ? '<img src="' . $settings['images_url'] . '/selected.png" alt="*">' : ''), '<a href="', ($context['display_mode'] == 0 || $context['current_pm'] == $message['id'] ? '' : ($scripturl . '?action=pm;pmid=' . $message['id'] . ';kstart;f=' . $context['folder'] . ';start=' . $context['start'] . ';sort=' . $context['sort_by'] . ($context['sort_direction'] == 'up' ? ';' : ';desc') . ($context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : ''))), '#msg', $message['id'], '">', $message['subject'], $message['is_unread'] ? '&nbsp;<span class="new_posts">' . $txt['new'] . '</span>' : '', '</a></td>
 			<td>', ($context['from_or_to'] == 'from' ? $message['member']['link'] : (empty($message['recipients']['to']) ? '' : implode(', ', $message['recipients']['to']))), '</td>
-			<td align="center" width="4%"><input type="checkbox" name="pms[]" id="deletelisting', $message['id'], '" value="', $message['id'], '"', $message['is_selected'] ? ' checked="checked"' : '', ' onclick="if (document.getElementById(\'deletedisplay', $message['id'], '\')) document.getElementById(\'deletedisplay', $message['id'], '\').checked = this.checked;" class="input_check" /></td>
+			<td class="centercol" width="4%"><input type="checkbox" name="pms[]" id="deletelisting', $message['id'], '" value="', $message['id'], '"', $message['is_selected'] ? ' checked' : '', ' onclick="if (document.getElementById(\'deletedisplay', $message['id'], '\')) document.getElementById(\'deletedisplay', $message['id'], '\').checked = this.checked;" class="input_check"></td>
 		</tr>';
-			$next_alternate = !$next_alternate;
 	}
 
 	echo '
 	</tbody>
 	</table>
 	<div class="pagesection">
-		<div class="floatleft">', $txt['pages'], ': ', $context['page_index'], '</div>
+		<div class="floatleft">', $context['page_index'], '</div>
 		<div class="floatright">&nbsp;';
 
 	if ($context['show_delete'])
@@ -610,28 +657,36 @@
 			echo '
 				<select name="pm_action" onchange="if (this.options[this.selectedIndex].value) this.form.submit();" onfocus="loadLabelChoices();">
 					<option value="">', $txt['pm_sel_label_title'], ':</option>
-					<option value="" disabled="disabled">---------------</option>';
+					<option value="" disabled>---------------</option>';
 
 			echo '
-									<option value="" disabled="disabled">', $txt['pm_msg_label_apply'], ':</option>';
+					<option value="" disabled>', $txt['pm_msg_label_apply'], ':</option>';
+
 			foreach ($context['labels'] as $label)
+			{
 				if ($label['id'] != $context['current_label_id'])
 					echo '
 					<option value="add_', $label['id'], '">&nbsp;', $label['name'], '</option>';
+			}
+
 			echo '
-					<option value="" disabled="disabled">', $txt['pm_msg_label_remove'], ':</option>';
+					<option value="" disabled>', $txt['pm_msg_label_remove'], ':</option>';
+
 			foreach ($context['labels'] as $label)
+			{
 				echo '
 					<option value="rem_', $label['id'], '">&nbsp;', $label['name'], '</option>';
+			}
+
 			echo '
 				</select>
 				<noscript>
-					<input type="submit" value="', $txt['pm_apply'], '" class="button_submit" />
+					<input type="submit" value="', $txt['pm_apply'], '" class="button_submit" style="float: none">
 				</noscript>';
 		}
 
 		echo '
-				<input type="submit" name="del_selected" value="', $txt['quickmod_delete_selected'], '" onclick="if (!confirm(\'', $txt['delete_selected_confirm'], '\')) return false;" class="button_submit" />';
+				<input type="submit" name="del_selected" value="', $txt['quickmod_delete_selected'], '" onclick="if (!confirm(\'', $txt['delete_selected_confirm'], '\')) return false;" class="button_submit" style="float: none">';
 	}
 
 	echo '
@@ -641,18 +696,9 @@
 
 function template_search()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function expandCollapseLabels()
-		{
-			var current = document.getElementById("searchLabelsExpand").style.display != "none";
-
-			document.getElementById("searchLabelsExpand").style.display = current ? "none" : "";
-			document.getElementById("expandLabelsIcon").src = smf_images_url + (current ? "/expand.gif" : "/collapse.gif");
-		}
-	// ]]></script>
 	<form action="', $scripturl, '?action=pm;sa=search2" method="post" accept-charset="', $context['character_set'], '" name="searchform" id="searchform">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['pm_search_title'], '</h3>
@@ -662,56 +708,30 @@
 	{
 		echo '
 		<div class="errorbox">
-			', implode('<br />', $context['search_errors']['messages']), '
+			', implode('<br>', $context['search_errors']['messages']), '
 		</div>';
 	}
 
-	if ($context['simple_search'])
-	{
-		echo '
-		<fieldset id="simple_search">
-			<span class="upperframe"><span></span></span>
-			<div class="roundframe">
-				<div id="search_term_input">
-					<strong>', $txt['pm_search_text'], ':</strong>
-					<input type="text" name="search"', !empty($context['search_params']['search']) ? ' value="' . $context['search_params']['search'] . '"' : '', ' size="40" class="input_text" />
-					<input type="submit" name="submit" value="', $txt['pm_search_go'], '" class="button_submit" />
-				</div>
-				<a href="', $scripturl, '?action=pm;sa=search;advanced" onclick="this.href += \';search=\' + escape(document.forms.searchform.search.value);">', $txt['pm_search_advanced'], '</a>
-				<input type="hidden" name="advanced" value="0" />
-			</div>
-			<span class="lowerframe"><span></span></span>
-		</fieldset>';
-	}
 
-	// Advanced search!
-	else
-	{
-		echo '
+	echo '
 		<fieldset id="advanced_search">
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
-				<input type="hidden" name="advanced" value="1" />
+				<input type="hidden" name="advanced" value="1">
 				<span class="enhanced">
 					<strong>', $txt['pm_search_text'], ':</strong>
-					<input type="text" name="search"', !empty($context['search_params']['search']) ? ' value="' . $context['search_params']['search'] . '"' : '', ' size="40" class="input_text" />
-					<script type="text/javascript"><!-- // --><![CDATA[
-						function initSearch()
-						{
-							if (document.forms.searchform.search.value.indexOf("%u") != -1)
-								document.forms.searchform.search.value = unescape(document.forms.searchform.search.value);
-						}
+					<input type="search" name="search"', !empty($context['search_params']['search']) ? ' value="' . $context['search_params']['search'] . '"' : '', ' size="40" class="input_text">
+					<script><!-- // --><![CDATA[
 						createEventListener(window);
 						window.addEventListener("load", initSearch, false);
 					// ]]></script>
 					<select name="searchtype">
-						<option value="1"', empty($context['search_params']['searchtype']) ? ' selected="selected"' : '', '>', $txt['pm_search_match_all'], '</option>
-						<option value="2"', !empty($context['search_params']['searchtype']) ? ' selected="selected"' : '', '>', $txt['pm_search_match_any'], '</option>
+						<option value="1"', empty($context['search_params']['searchtype']) ? ' selected' : '', '>', $txt['pm_search_match_all'], '</option>
+						<option value="2"', !empty($context['search_params']['searchtype']) ? ' selected' : '', '>', $txt['pm_search_match_any'], '</option>
 					</select>
 				</span>
 				<dl id="search_options">
 					<dt>', $txt['pm_search_user'], ':</dt>
-					<dd><input type="text" name="userspec" value="', empty($context['search_params']['userspec']) ? '*' : $context['search_params']['userspec'], '" size="40" class="input_text" /></dd>
+					<dd><input type="text" name="userspec" value="', empty($context['search_params']['userspec']) ? '*' : $context['search_params']['userspec'], '" size="40" class="input_text"></dd>
 					<dt>', $txt['pm_search_order'], ':</dt>
 					<dd>
 						<select name="sort">
@@ -722,52 +742,77 @@
 					</dd>
 					<dt class="options">', $txt['pm_search_options'], ':</dt>
 					<dd class="options">
-						<label for="show_complete"><input type="checkbox" name="show_complete" id="show_complete" value="1"', !empty($context['search_params']['show_complete']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['pm_search_show_complete'], '</label><br />
-						<label for="subject_only"><input type="checkbox" name="subject_only" id="subject_only" value="1"', !empty($context['search_params']['subject_only']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['pm_search_subject_only'], '</label>
+						<label for="show_complete"><input type="checkbox" name="show_complete" id="show_complete" value="1"', !empty($context['search_params']['show_complete']) ? ' checked' : '', ' class="input_check"> ', $txt['pm_search_show_complete'], '</label><br>
+						<label for="subject_only"><input type="checkbox" name="subject_only" id="subject_only" value="1"', !empty($context['search_params']['subject_only']) ? ' checked' : '', ' class="input_check"> ', $txt['pm_search_subject_only'], '</label>
 					</dd>
 					<dt class="between">', $txt['pm_search_post_age'], ':</dt>
-					<dd>', $txt['pm_search_between'], ' <input type="text" name="minage" value="', empty($context['search_params']['minage']) ? '0' : $context['search_params']['minage'], '" size="5" maxlength="5" class="input_text" />&nbsp;', $txt['pm_search_between_and'], '&nbsp;<input type="text" name="maxage" value="', empty($context['search_params']['maxage']) ? '9999' : $context['search_params']['maxage'], '" size="5" maxlength="5" class="input_text" /> ', $txt['pm_search_between_days'], '</dd>
+					<dd>', $txt['pm_search_between'], ' <input type="number" name="minage" value="', empty($context['search_params']['minage']) ? '0' : $context['search_params']['minage'], '" size="5" maxlength="5" class="input_text" min="0" max="9999">&nbsp;', $txt['pm_search_between_and'], '&nbsp;<input type="number" name="maxage" value="', empty($context['search_params']['maxage']) ? '9999' : $context['search_params']['maxage'], '" size="5" maxlength="5" class="input_text" min="0" max="9999"> ', $txt['pm_search_between_days'], '</dd>
 				</dl>';
-		if (!$context['currently_using_labels'])
-			echo '
-				<input type="submit" name="submit" value="', $txt['pm_search_go'], '" class="button_submit floatright" />';
-			echo '
-				<br class="clear" />
+	if (!$context['currently_using_labels'])
+		echo '
+				<input type="submit" name="pm_search" value="', $txt['pm_search_go'], '" class="button_submit">';
+		echo '
+				<br class="clear_right">
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</fieldset>';
 
-		// Do we have some labels setup? If so offer to search by them!
-		if ($context['currently_using_labels'])
-		{
-			echo '
+	// Do we have some labels setup? If so offer to search by them!
+	if ($context['currently_using_labels'])
+	{
+		echo '
 		<fieldset class="labels">
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
-				<div class="title_bar">
-					<h4 class="titlebg">
-						<span class="ie6_header floatleft"><a href="javascript:void(0);" onclick="expandCollapseLabels(); return false;"><img src="', $settings['images_url'], '/expand.gif" id="expandLabelsIcon" alt="" /></a> <a href="javascript:void(0);" onclick="expandCollapseLabels(); return false;"><strong>', $txt['pm_search_choose_label'], '</strong></a></span>
-					</h4>
+				<div class="cat_bar">
+					<h3 class="catbg">
+						<span id="advanced_panel_toggle" class="toggle_up floatright" style="display: none;"></span><a href="#" id="advanced_panel_link">', $txt['pm_search_choose_label'], '</a>
+					</h3>
 				</div>
-				<ul id="searchLabelsExpand" class="reset" ', $context['check_all'] ? 'style="display: none;"' : '', '>';
-
-			foreach ($context['search_labels'] as $label)
-				echo '
-					<li>
-						<label for="searchlabel_', $label['id'], '"><input type="checkbox" id="searchlabel_', $label['id'], '" name="searchlabel[', $label['id'], ']" value="', $label['id'], '" ', $label['checked'] ? 'checked="checked"' : '', ' class="input_check" />
-						', $label['name'], '</label>
-					</li>';
+				<div id="advanced_panel_div">
+					<ul id="searchLabelsExpand" class="reset">';
 
+		foreach ($context['search_labels'] as $label)
 			echo '
-				</ul>
+						<li>
+							<label for="searchlabel_', $label['id'], '"><input type="checkbox" id="searchlabel_', $label['id'], '" name="searchlabel[', $label['id'], ']" value="', $label['id'], '"', $label['checked'] ? ' checked' : '', ' class="input_check">
+							', $label['name'], '</label>
+						</li>';
+
+		echo '
+					</ul>
+				</div>
 				<p>
-					<span class="floatleft"><input type="checkbox" name="all" id="check_all" value="" ', $context['check_all'] ? 'checked="checked"' : '', ' onclick="invertAll(this, this.form, \'searchlabel\');" class="input_check" /><em> <label for="check_all">', $txt['check_all'], '</label></em></span>
-					<input type="submit" name="submit" value="', $txt['pm_search_go'], '" class="button_submit floatright" />
-				</p><br class="clear" />
+					<span class="floatleft"><input type="checkbox" name="all" id="check_all" value=""', $context['check_all'] ? ' checked' : '', ' onclick="invertAll(this, this.form, \'searchlabel\');" class="input_check"><em> <label for="check_all">', $txt['check_all'], '</label></em></span>
+					<input type="submit" name="pm_search" value="', $txt['pm_search_go'], '" class="button_submit">
+				</p>
+				<br class="clear_right">
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</fieldset>';
-		}
+
+		// Some javascript for the advanced toggling
+		echo '
+		<script><!-- // --><![CDATA[
+			var oAdvancedPanelToggle = new smc_Toggle({
+				bToggleEnabled: true,
+				bCurrentlyCollapsed: true,
+				aSwappableContainers: [
+					\'advanced_panel_div\'
+				],
+				aSwapImages: [
+					{
+						sId: \'advanced_panel_toggle\',
+						altExpanded: ', JavaScriptEscape($txt['hide']), ',
+						altCollapsed: ', JavaScriptEscape($txt['show']), '
+					}
+				],
+				aSwapLinks: [
+					{
+						sId: \'advanced_panel_link\',
+						msgExpanded: ', JavaScriptEscape($txt['pm_search_choose_label']), ',
+						msgCollapsed: ', JavaScriptEscape($txt['pm_search_choose_label']), '
+					}
+				]
+			});
+		// ]]></script>';
 	}
 
 	echo '
@@ -776,30 +821,29 @@
 
 function template_search_results()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['pm_search_results'], '</h3>
 		</div>
 		<div class="pagesection">
-			<strong>', $txt['pages'], ':</strong> ', $context['page_index'], '
+			', $context['page_index'], '
 		</div>';
 
 	// complete results ?
 	if (empty($context['search_params']['show_complete']) && !empty($context['personal_messages']))
 		echo '
-	<table width="100%" class="table_grid">
+	<table class="table_grid">
 	<thead>
-		<tr class="catbg">
-			<th class="lefttext first_th" width="30%">', $txt['date'], '</th>
+		<tr class="title_bar">
+			<th class="lefttext" width="30%">', $txt['date'], '</th>
 			<th class="lefttext" width="50%">', $txt['subject'], '</th>
-			<th class="lefttext last_th" width="20%">', $txt['from'], '</th>
+			<th class="lefttext" width="20%">', $txt['from'], '</th>
 		</tr>
 	</thead>
 	<tbody>';
 
-	$alternate = true;
 	// Print each message out...
 	foreach ($context['personal_messages'] as $message)
 	{
@@ -807,8 +851,8 @@
 		if (!empty($context['search_params']['show_complete']))
 		{
 			echo '
-			<div class="title_bar">
-				<h3 class="titlebg">
+			<div class="cat_bar">
+				<h3 class="catbg">
 					<span class="floatright">', $txt['search_on'], ': ', $message['time'], '</span>
 					<span class="floatleft">', $message['counter'], '&nbsp;&nbsp;<a href="', $message['href'], '">', $message['subject'], '</a></span>
 				</h3>
@@ -817,7 +861,7 @@
 				<h3 class="catbg">', $txt['from'], ': ', $message['member']['link'], ', ', $txt['to'], ': ';
 
 				// Show the recipients.
-				// !!! This doesn't deal with the sent item searching quite right for bcc.
+				// @todo This doesn't deal with the sent item searching quite right for bcc.
 				if (!empty($message['recipients']['to']))
 					echo implode(', ', $message['recipients']['to']);
 				// Otherwise, we're just going to say "some people"...
@@ -827,46 +871,40 @@
 					echo '
 				</h3>
 			</div>
-			<div class="windowbg', $alternate ? '2': '', '">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					', $message['body'], '
-					<p class="pm_reply righttext middletext">';
+			<div class="windowbg">
+				', $message['body'], '
+				<p class="pm_reply righttext">';
 
 				if ($context['can_send_pm'])
 				{
-					$quote_button = create_button('quote.gif', 'reply_quote', 'reply_quote', 'align="middle"');
-					$reply_button = create_button('im_reply.gif', 'reply', 'reply', 'align="middle"');
+					$quote_button = create_button('quote.png', 'reply_quote', 'reply_quote', 'class="centericon"');
+					$reply_button = create_button('im_reply.png', 'reply', 'reply', 'class="centericon"');
 					// You can only reply if they are not a guest...
 					if (!$message['member']['is_guest'])
 						echo '
-								<a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote;u=', $context['folder'] == 'sent' ? '' : $message['member']['id'], '">', $quote_button , '</a>', $context['menu_separator'], '
-								<a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';u=', $message['member']['id'], '">', $reply_button , '</a> ', $context['menu_separator'];
+							<a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote;u=', $context['folder'] == 'sent' ? '' : $message['member']['id'], '">', $quote_button , '</a>', $context['menu_separator'], '
+							<a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';u=', $message['member']['id'], '">', $reply_button , '</a> ', $context['menu_separator'];
 					// This is for "forwarding" - even if the member is gone.
 					else
 						echo '
-								<a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote">', $quote_button , '</a>', $context['menu_separator'];
+							<a href="', $scripturl, '?action=pm;sa=send;f=', $context['folder'], $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';pmsg=', $message['id'], ';quote">', $quote_button , '</a>', $context['menu_separator'];
 				}
 
 				echo '
-					</p>
-				</div>
-				<span class="botslice"><span></span></span>
+				</p>
 			</div>';
 		}
 		// Otherwise just a simple list!
 		else
 		{
-			// !!! No context at all of the search?
+			// @todo No context at all of the search?
 			echo '
-			<tr class="', $alternate ? 'windowbg' : 'windowbg2', '" valign="top">
+			<tr class="windowbg">
 				<td>', $message['time'], '</td>
 				<td>', $message['link'], '</td>
 				<td>', $message['member']['link'], '</td>
 			</tr>';
 		}
-
-		$alternate = !$alternate;
 	}
 
 	// Finish off the page...
@@ -879,23 +917,19 @@
 	if (empty($context['personal_messages']))
 		echo '
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p class="centertext">', $txt['pm_search_none_found'], '</p>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p class="centertext">', $txt['pm_search_none_found'], '</p>
 		</div>';
 
 	echo '
 		<div class="pagesection">
-			<strong>', $txt['pages'], ':</strong> ', $context['page_index'], '
+			', $context['page_index'], '
 		</div>';
 
 }
 
 function template_send()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $options, $scripturl, $modSettings, $txt;
 
 	// Show which messages were sent successfully and which failed.
 	if (!empty($context['send_log']))
@@ -904,67 +938,67 @@
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['pm_send_report'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">';
+			<div class="windowbg">';
 				if (!empty($context['send_log']['sent']))
 					foreach ($context['send_log']['sent'] as $log_entry)
-						echo '<span class="error">', $log_entry, '</span><br />';
+						echo '<span class="error">', $log_entry, '</span><br>';
 				if (!empty($context['send_log']['failed']))
 					foreach ($context['send_log']['failed'] as $log_entry)
-						echo '<span class="error">', $log_entry, '</span><br />';
+						echo '<span class="error">', $log_entry, '</span><br>';
 				echo '
-				</div>
-				<span class="botslice"><span></span></span>
 			</div>
-			<br />';
+			<br>';
 	}
 
 	// Show the preview of the personal message.
-	if (isset($context['preview_message']))
 	echo '
-		<div class="cat_bar">
-			<h3 class="catbg">', $context['preview_subject'], '</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				', $context['preview_message'], '
+		<div id="preview_section"', isset($context['preview_message']) ? '' : ' style="display: none;"', '>
+			<div class="cat_bar">
+				<h3 class="catbg">
+					<span id="preview_subject">', empty($context['preview_subject']) ? '' : $context['preview_subject'], '</span>
+				</h3>
 			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-		<br />';
+			<div class="windowbg">
+				<div class="post" id="preview_body">
+					', empty($context['preview_message']) ? '<br>' : $context['preview_message'], '
+				</div>
+			</div>
+			<br class="clear">
+		</div>';
 
 	// Main message editing box.
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/im_newmsg.gif" alt="', $txt['new_message'], '" title="', $txt['new_message'], '" />&nbsp;', $txt['new_message'], '</span>
+					<span class="generic_icons inbox icon" title="', $txt['new_message'], '"></span> ', $txt['new_message'], '
 			</h3>
 		</div>';
 
 	echo '
 	<form action="', $scripturl, '?action=pm;sa=send2" method="post" accept-charset="', $context['character_set'], '" name="postmodify" id="postmodify" class="flow_hidden" onsubmit="submitonce(this);smc_saveEntities(\'postmodify\', [\'subject\', \'message\']);">
 		<div>
-			<span class="upperframe"><span></span></span>
-			<div class="roundframe"><br class="clear" />';
+			<div class="roundframe">
+				<br class="clear">';
 
 	// If there were errors for sending the PM, show them.
-	if (!empty($context['post_error']['messages']))
-	{
-		echo '
-				<div class="errorbox">
-					<strong>', $txt['error_while_submitting'], '</strong>
-					<ul class="reset">';
-
-		foreach ($context['post_error']['messages'] as $error)
-			echo '
-						<li class="error">', $error, '</li>';
+	echo '
+				<div class="', empty($context['error_type']) || $context['error_type'] != 'serious' ? 'noticebox' : 'errorbox', '"', empty($context['post_error']['messages']) ? ' style="display: none"' : '', ' id="errors">
+					<dl>
+						<dt>
+							<strong id="error_serious">', $txt['error_while_submitting'] , '</strong>
+						</dt>
+						<dd class="error" id="error_list">
+							', empty($context['post_error']['messages']) ? '' : implode('<br>', $context['post_error']['messages']), '
+						</dd>
+					</dl>
+				</div>';
 
+	if (!empty($modSettings['drafts_pm_enabled']))
 		echo '
-					</ul>
+				<div id="draft_section" class="infobox"', isset($context['draft_saved']) ? '' : ' style="display: none;"', '>',
+					sprintf($txt['draft_pm_saved'], $scripturl . '?action=pm;sa=showpmdrafts'), '
+					', (!empty($modSettings['drafts_keep_days']) ? ' <strong>' . sprintf($txt['draft_save_warning'], $modSettings['drafts_keep_days']) . '</strong>' : ''), '
 				</div>';
-	}
 
 	echo '
 				<dl id="post_header">';
@@ -972,13 +1006,13 @@
 	// To and bcc. Include a button to search for members.
 	echo '
 					<dt>
-						<span', (isset($context['post_error']['no_to']) || isset($context['post_error']['bad_to']) ? ' class="error"' : ''), '>', $txt['pm_to'], ':</span>
+						<span', (isset($context['post_error']['no_to']) || isset($context['post_error']['bad_to']) ? ' class="error"' : ''), ' id="caption_to">', $txt['pm_to'], ':</span>
 					</dt>';
 
 	// Autosuggest will be added by the JavaScript later on.
 	echo '
 					<dd id="pm_to" class="clear_right">
-						<input type="text" name="to" id="to_control" value="', $context['to_value'], '" tabindex="', $context['tabindex']++, '" size="40" style="width: 130px;" class="input_text" />';
+						<input type="text" name="to" id="to_control" value="', $context['to_value'], '" tabindex="', $context['tabindex']++, '" size="40" style="width: 130px;" class="input_text">';
 
 	// A link to add BCC, only visible with JavaScript enabled.
 	echo '
@@ -994,22 +1028,22 @@
 	// This BCC row will be hidden by default if JavaScript is enabled.
 	echo '
 					<dt  class="clear_left" id="bcc_div">
-						<span', (isset($context['post_error']['no_to']) || isset($context['post_error']['bad_bcc']) ? ' class="error"' : ''), '>', $txt['pm_bcc'], ':</span>
+						<span', (isset($context['post_error']['no_to']) || isset($context['post_error']['bad_bcc']) ? ' class="error"' : ''), ' id="caption_bbc">', $txt['pm_bcc'], ':</span>
 					</dt>
 					<dd id="bcc_div2">
-						<input type="text" name="bcc" id="bcc_control" value="', $context['bcc_value'], '" tabindex="', $context['tabindex']++, '" size="40" style="width: 130px;" class="input_text" />
+						<input type="text" name="bcc" id="bcc_control" value="', $context['bcc_value'], '" tabindex="', $context['tabindex']++, '" size="40" style="width: 130px;" class="input_text">
 						<div id="bcc_item_list_container"></div>
 					</dd>';
 
 	// The subject of the PM.
 	echo '
 					<dt class="clear_left">
-						<span', (isset($context['post_error']['no_subject']) ? ' class="error"' : ''), '>', $txt['subject'], ':</span>
+						<span', (isset($context['post_error']['no_subject']) ? ' class="error"' : ''), ' id="caption_subject">', $txt['subject'], ':</span>
 					</dt>
 					<dd id="pm_subject">
-						<input type="text" name="subject" value="', $context['subject'], '" tabindex="', $context['tabindex']++, '" size="60" maxlength="60" />
+						<input type="text" name="subject" value="', $context['subject'], '" tabindex="', $context['tabindex']++, '" size="80" maxlength="80"',isset($context['post_error']['no_subject']) ? ' class="error"' : ' class="input_text"', '/>
 					</dd>
-				</dl><hr class="clear" />';
+				</dl><hr class="clear">';
 
 	// Showing BBC?
 	if ($context['show_bbc'])
@@ -1039,53 +1073,203 @@
 
 	// Send, Preview, spellcheck buttons.
 	echo '
-				<p><label for="outbox"><input type="checkbox" name="outbox" id="outbox" value="1" tabindex="', $context['tabindex']++, '"', $context['copy_to_outbox'] ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['pm_save_outbox'], '</label></p>
-				<p id="shortcuts" class="smalltext">
-					', $context['browser']['is_firefox'] ? $txt['shortcuts_firefox'] : $txt['shortcuts'], '
-				</p>
-				<p id="post_confirm_strip" class="righttext">
+				<hr class="hrcolor">
+				<span id="post_confirm_strip" class="righttext">
 					', template_control_richedit_buttons($context['post_box_name']), '
-				</p>
-				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '" />
-				<input type="hidden" name="replied_to" value="', !empty($context['quoted_message']['id']) ? $context['quoted_message']['id'] : 0, '" />
-				<input type="hidden" name="pm_head" value="', !empty($context['quoted_message']['pm_head']) ? $context['quoted_message']['pm_head'] : 0, '" />
-				<input type="hidden" name="f" value="', isset($context['folder']) ? $context['folder'] : '', '" />
-				<input type="hidden" name="l" value="', isset($context['current_label_id']) ? $context['current_label_id'] : -1, '" />
-				<br class="clear" />
-				</div>
-			<span class="lowerframe"><span></span></span>
+				</span>
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '">
+				<input type="hidden" name="replied_to" value="', !empty($context['quoted_message']['id']) ? $context['quoted_message']['id'] : 0, '">
+				<input type="hidden" name="pm_head" value="', !empty($context['quoted_message']['pm_head']) ? $context['quoted_message']['pm_head'] : 0, '">
+				<input type="hidden" name="f" value="', isset($context['folder']) ? $context['folder'] : '', '">
+				<input type="hidden" name="l" value="', isset($context['current_label_id']) ? $context['current_label_id'] : -1, '">
+				<br class="clear_right">
+			</div>
 		</div>
 	</form>';
 
+	// If the admin enabled the pm drafts feature, show a draft selection box
+	if (!empty($context['drafts_pm_save']) && !empty($context['drafts']) && !empty($options['drafts_show_saved_enabled']))
+	{
+		echo '
+			<br>
+			<div id="postDraftOptionsHeader" class="cat_bar">
+				<h3 class="catbg">
+					<span id="postDraftExpand" class="toggle_up floatright" style="display: none;"></span> <strong><a href="#" id="postDraftExpandLink">', $txt['draft_load'], '</a></strong>
+				</h3>
+			</div>
+			<div id="postDraftOptions" class="load_drafts padding">
+				<dl class="settings">
+					<dt><strong>', $txt['subject'], '</strong></dt>
+					<dd><strong>', $txt['draft_saved_on'], '</strong></dd>';
+
+		foreach ($context['drafts'] as $draft)
+			echo '
+					<dt>', $draft['link'], '</dt>
+					<dd>', $draft['poster_time'], '</dd>';
+		echo '
+				</dl>
+			</div>';
+	}
+
+	echo '
+		<script><!-- // --><![CDATA[';
+	// The functions used to preview a personal message without loading a new page.
+	echo '
+			var txt_preview_title = "', $txt['preview_title'], '";
+			var txt_preview_fetch = "', $txt['preview_fetch'], '";
+			function previewPost()
+			{';
+	if (isBrowser('is_firefox'))
+		echo '
+				// Firefox doesn\'t render <marquee> that have been put it using javascript
+				if (document.forms.postmodify.elements[', JavaScriptEscape($context['post_box_name']), '].value.indexOf(\'[move]\') != -1)
+				{
+					return submitThisOnce(document.forms.postmodify);
+				}';
+	echo '
+				if (window.XMLHttpRequest)
+				{
+					// Opera didn\'t support setRequestHeader() before 8.01.
+					// @todo Remove support for old browsers
+					if (\'opera\' in window)
+					{
+						var test = new XMLHttpRequest();
+						if (!(\'setRequestHeader\' in test))
+							return submitThisOnce(document.forms.postmodify);
+					}
+					// @todo Currently not sending poll options and option checkboxes.
+					var x = new Array();
+					var textFields = [\'subject\', ', JavaScriptEscape($context['post_box_name']), ', \'to\', \'bcc\'];
+					var numericFields = [\'recipient_to[]\', \'recipient_bcc[]\'];
+					var checkboxFields = [];
+
+					for (var i = 0, n = textFields.length; i < n; i++)
+						if (textFields[i] in document.forms.postmodify)
+						{
+							// Handle the WYSIWYG editor.
+							if (textFields[i] == ', JavaScriptEscape($context['post_box_name']), ' && ', JavaScriptEscape('oEditorHandle_' . $context['post_box_name']), ' in window && oEditorHandle_', $context['post_box_name'], '.bRichTextEnabled)
+								x[x.length] = \'message_mode=1&\' + textFields[i] + \'=\' + oEditorHandle_', $context['post_box_name'], '.getText(false).replace(/&#/g, \'&#38;#\').php_to8bit().php_urlencode();
+							else
+								x[x.length] = textFields[i] + \'=\' + document.forms.postmodify[textFields[i]].value.replace(/&#/g, \'&#38;#\').php_to8bit().php_urlencode();
+						}
+					for (var i = 0, n = numericFields.length; i < n; i++)
+						if (numericFields[i] in document.forms.postmodify && \'value\' in document.forms.postmodify[numericFields[i]])
+							x[x.length] = numericFields[i] + \'=\' + parseInt(document.forms.postmodify.elements[numericFields[i]].value);
+					for (var i = 0, n = checkboxFields.length; i < n; i++)
+						if (checkboxFields[i] in document.forms.postmodify && document.forms.postmodify.elements[checkboxFields[i]].checked)
+							x[x.length] = checkboxFields[i] + \'=\' + document.forms.postmodify.elements[checkboxFields[i]].value;
+
+					sendXMLDocument(smf_prepareScriptUrl(smf_scripturl) + \'action=pm;sa=send2;preview;xml\', x.join(\'&\'), onDocSent);
+
+					document.getElementById(\'preview_section\').style.display = \'\';
+					setInnerHTML(document.getElementById(\'preview_subject\'), txt_preview_title);
+					setInnerHTML(document.getElementById(\'preview_body\'), txt_preview_fetch);
+
+					return false;
+				}
+				else
+					return submitThisOnce(document.forms.postmodify);
+			}
+			function onDocSent(XMLDoc)
+			{
+				if (!XMLDoc)
+				{
+					document.forms.postmodify.preview.onclick = new function ()
+					{
+						return true;
+					}
+					document.forms.postmodify.preview.click();
+				}
+
+				// Show the preview section.
+				var preview = XMLDoc.getElementsByTagName(\'smf\')[0].getElementsByTagName(\'preview\')[0];
+				setInnerHTML(document.getElementById(\'preview_subject\'), preview.getElementsByTagName(\'subject\')[0].firstChild.nodeValue);
+
+				var bodyText = \'\';
+				for (var i = 0, n = preview.getElementsByTagName(\'body\')[0].childNodes.length; i < n; i++)
+					bodyText += preview.getElementsByTagName(\'body\')[0].childNodes[i].nodeValue;
+
+				setInnerHTML(document.getElementById(\'preview_body\'), bodyText);
+				document.getElementById(\'preview_body\').className = \'post\';
+
+				// Show a list of errors (if any).
+				var errors = XMLDoc.getElementsByTagName(\'smf\')[0].getElementsByTagName(\'errors\')[0];
+				var errorList = new Array();
+				for (var i = 0, numErrors = errors.getElementsByTagName(\'error\').length; i < numErrors; i++)
+					errorList[errorList.length] = errors.getElementsByTagName(\'error\')[i].firstChild.nodeValue;
+				document.getElementById(\'errors\').style.display = numErrors == 0 ? \'none\' : \'\';
+				setInnerHTML(document.getElementById(\'error_list\'), numErrors == 0 ? \'\' : errorList.join(\'<br>\'));
+
+				// Adjust the color of captions if the given data is erroneous.
+				var captions = errors.getElementsByTagName(\'caption\');
+				for (var i = 0, numCaptions = errors.getElementsByTagName(\'caption\').length; i < numCaptions; i++)
+					if (document.getElementById(\'caption_\' + captions[i].getAttribute(\'name\')))
+						document.getElementById(\'caption_\' + captions[i].getAttribute(\'name\')).className = captions[i].getAttribute(\'class\');
+
+				if (errors.getElementsByTagName(\'post_error\').length == 1)
+					document.forms.postmodify.', $context['post_box_name'], '.style.border = \'1px solid red\';
+				else if (document.forms.postmodify.', $context['post_box_name'], '.style.borderColor == \'red\' || document.forms.postmodify.', $context['post_box_name'], '.style.borderColor == \'red red red red\')
+				{
+					if (\'runtimeStyle\' in document.forms.postmodify.', $context['post_box_name'], ')
+						document.forms.postmodify.', $context['post_box_name'], '.style.borderColor = \'\';
+					else
+						document.forms.postmodify.', $context['post_box_name'], '.style.border = null;
+				}
+				location.hash = \'#\' + \'preview_section\';
+			}';
+
+	// Code for showing and hiding drafts
+	if (!empty($context['drafts']))
+		echo '
+			var oSwapDraftOptions = new smc_Toggle({
+				bToggleEnabled: true,
+				bCurrentlyCollapsed: true,
+				aSwappableContainers: [
+					\'postDraftOptions\',
+				],
+				aSwapImages: [
+					{
+						sId: \'postDraftExpand\',
+						altExpanded: \'-\',
+						altCollapsed: \'+\'
+					}
+				],
+				aSwapLinks: [
+					{
+						sId: \'postDraftExpandLink\',
+						msgExpanded: ', JavaScriptEscape($txt['draft_hide']), ',
+						msgCollapsed: ', JavaScriptEscape($txt['draft_load']), '
+					}
+				]
+			});';
+
+	echo '
+		// ]]></script>';
+
 	// Show the message you're replying to.
 	if ($context['reply'])
 		echo '
-	<br />
-	<br />
+	<br>
+	<br>
 	<div class="cat_bar">
 		<h3 class="catbg">', $txt['subject'], ': ', $context['quoted_message']['subject'], '</h3>
 	</div>
 	<div class="windowbg2">
-		<span class="topslice"><span></span></span>
-		<div class="content">
-			<div class="clear">
-				<span class="smalltext floatright">', $txt['on'], ': ', $context['quoted_message']['time'], '</span>
-				<strong>', $txt['from'], ': ', $context['quoted_message']['member']['name'], '</strong>
-			</div><hr />
-			', $context['quoted_message']['body'], '
-		</div>
-		<span class="botslice"><span></span></span>
-	</div><br class="clear" />';
+		<div class="clear">
+			<span class="smalltext floatright">', $txt['on'], ': ', $context['quoted_message']['time'], '</span>
+			<strong>', $txt['from'], ': ', $context['quoted_message']['member']['name'], '</strong>
+		</div>
+		<hr>
+		', $context['quoted_message']['body'], '
+	</div><br class="clear">';
 
 	echo '
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/PersonalMessage.js?fin20"></script>
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			var oPersonalMessageSend = new smf_PersonalMessageSend({
 				sSelf: \'oPersonalMessageSend\',
-				sSessionId: \'', $context['session_id'], '\',
-				sSessionVar: \'', $context['session_var'], '\',
+				sSessionId: smf_session_id,
+				sSessionVar: smf_session_var,
 				sTextDeleteItem: \'', $txt['autosuggest_delete_item'], '\',
 				sToControlId: \'to_control\',
 				aToRecipients: [';
@@ -1115,7 +1299,7 @@
 				sBccLinkContainerId: \'bcc_link_container\',
 				bBccShowByDefault: ', empty($context['recipients']['bcc']) && empty($context['bcc_value']) ? 'false' : 'true', ',
 				sShowBccLinkTemplate: ', JavaScriptEscape('
-					<a href="#" id="bcc_link">' . $txt['make_bcc'] . '</a> <a href="' . $scripturl . '?action=helpadmin;help=pm_bcc" onclick="return reqWin(this.href);">(?)</a>'
+					<a href="#" id="bcc_link">' . $txt['make_bcc'] . '</a> <a href="' . $scripturl . '?action=helpadmin;help=pm_bcc" onclick="return reqOverlayDiv(this.href);">(?)</a>'
 				), '
 			});
 		';
@@ -1127,70 +1311,67 @@
 // This template asks the user whether they wish to empty out their folder/messages.
 function template_ask_delete()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">', ($context['delete_all'] ? $txt['delete_message'] : $txt['delete_all']), '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $txt['delete_all_confirm'], '</p><br />
-				<strong><a href="', $scripturl, '?action=pm;sa=removeall2;f=', $context['folder'], ';', $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';', $context['session_var'], '=', $context['session_id'], '">', $txt['yes'], '</a> - <a href="javascript:history.go(-1);">', $txt['no'], '</a></strong>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p>', $txt['delete_all_confirm'], '</p><br>
+			<strong><a href="', $scripturl, '?action=pm;sa=removeall2;f=', $context['folder'], ';', $context['current_label_id'] != -1 ? ';l=' . $context['current_label_id'] : '', ';', $context['session_var'], '=', $context['session_id'], '">', $txt['yes'], '</a> - <a href="javascript:history.go(-1);">', $txt['no'], '</a></strong>
 		</div>';
 }
 
 // This template asks the user what messages they want to prune.
 function template_prune()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
-	<form action="', $scripturl, '?action=pm;sa=prune" method="post" accept-charset="', $context['character_set'], '" onsubmit="return confirm(\'', $txt['pm_prune_warning'], '\');">
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['pm_prune'], '</h3>
-		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $txt['pm_prune_desc1'], ' <input type="text" name="age" size="3" value="14" class="input_text" /> ', $txt['pm_prune_desc2'], '</p>
-				<div class="righttext">
-					<input type="submit" value="', $txt['delete'], '" class="button_submit" />
-				</div>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-	</form>';
+	<div class="cat_bar">
+		<h3 class="catbg">', $txt['pm_prune'], '</h3>
+	</div>
+	<div class="windowbg">
+		<form action="', $scripturl, '?action=pm;sa=prune" method="post" accept-charset="', $context['character_set'], '" onsubmit="return confirm(\'', $txt['pm_prune_warning'], '\');">
+			<p>', $txt['pm_prune_desc1'], ' <input type="text" name="age" size="3" value="14" class="input_text"> ', $txt['pm_prune_desc2'], '</p>
+			<input type="submit" value="', $txt['delete'], '" class="button_submit">
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+		</form>
+	</div>
+	<div class="windowbg">
+		<form action="', $scripturl, '?action=pm;sa=removeall2" method="post" onsubmit="return confirm(\'', $txt['pm_remove_all_warning'], '\');">
+			<p>', $txt['pm_remove_all'], '</p>
+			<input type="submit" value="', $txt['delete_all_prune'], '" class="button_submit">
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+		</form>
+	</div>';
 }
 
 // Here we allow the user to setup labels, remove labels and change rules for labels (i.e, do quite a bit)
 function template_labels()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<form action="', $scripturl, '?action=pm;sa=manlabels" method="post" accept-charset="', $context['character_set'], '">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['pm_manage_labels'], '</h3>
 		</div>
-		<div class="description">
+		<div class="information">
 			', $txt['pm_labels_desc'], '
 		</div>
-		<table width="100%" class="table_grid">
+		<table class="table_grid">
 		<thead>
-			<tr class="catbg">
-				<th class="lefttext first_th">
+			<tr class="title_bar">
+				<th class="lefttext">
 					', $txt['pm_label_name'], '
 				</th>
-				<th class="centertext last_th" width="4%">';
+				<th class="centertext" width="4%">';
 
 	if (count($context['labels']) > 2)
 		echo '
-					<input type="checkbox" class="input_check" onclick="invertAll(this, this.form);" />';
+					<input type="checkbox" class="input_check" onclick="invertAll(this, this.form);">';
 
 	echo '
 				</th>
@@ -1199,26 +1380,23 @@
 		<tbody>';
 	if (count($context['labels']) < 2)
 		echo '
-			<tr class="windowbg2">
-				<td colspan="2" align="center">', $txt['pm_labels_no_exist'], '</td>
+			<tr class="windowbg">
+				<td colspan="2">', $txt['pm_labels_no_exist'], '</td>
 			</tr>';
 	else
 	{
-		$alternate = true;
 		foreach ($context['labels'] as $label)
 		{
 			if ($label['id'] == -1)
 				continue;
 
 				echo '
-			<tr class="', $alternate ? 'windowbg2' : 'windowbg', '">
+			<tr class="windowbg">
 				<td>
-					<input type="text" name="label_name[', $label['id'], ']" value="', $label['name'], '" size="30" maxlength="30" class="input_text" />
+					<input type="text" name="label_name[', $label['id'], ']" value="', $label['name'], '" size="30" maxlength="30" class="input_text">
 				</td>
-				<td width="4%" align="center"><input type="checkbox" class="input_check" name="delete_label[', $label['id'], ']" /></td>
+				<td width="4%"><input type="checkbox" class="input_check" name="delete_label[', $label['id'], ']"></td>
 			</tr>';
-
-			$alternate = !$alternate;
 		}
 	}
 	echo '
@@ -1227,138 +1405,125 @@
 
 	if (!count($context['labels']) < 2)
 		echo '
-		<div class="padding righttext">
-			<input type="submit" name="save" value="', $txt['save'], '" class="button_submit" />
-			<input type="submit" name="delete" value="', $txt['quickmod_delete_selected'], '" onclick="return confirm(\'', $txt['pm_labels_delete'], '\');" class="button_submit" />
+		<div class="padding">
+			<input type="submit" name="save" value="', $txt['save'], '" class="button_submit">
+			<input type="submit" name="delete" value="', $txt['quickmod_delete_selected'], '" data-confirm="', $txt['pm_labels_delete'] ,'" class="button_submit you_sure">
 		</div>';
 
 	echo '
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 	</form>
+	<br class="clear">
 	<form action="', $scripturl, '?action=pm;sa=manlabels" method="post" accept-charset="', $context['character_set'], '" style="margin-top: 1ex;">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['pm_label_add_new'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl class="settings">
-					<dt>
-						<strong><label for="add_label">', $txt['pm_label_name'], '</label>:</strong>
-					</dt>
-					<dd>
-						<input type="text" id="add_label" name="label" value="" size="30" maxlength="30" class="input_text" />
-					</dd>
-				</dl>
-				<div class="righttext">
-					<input type="submit" name="add" value="', $txt['pm_label_add_new'], '" class="button_submit" />
-				</div>
-			</div>
-			<span class="botslice"><span></span></span>
+			<dl class="settings">
+				<dt>
+					<strong><label for="add_label">', $txt['pm_label_name'], '</label>:</strong>
+				</dt>
+				<dd>
+					<input type="text" id="add_label" name="label" value="" size="30" maxlength="30" class="input_text">
+				</dd>
+			</dl>
+			<input type="submit" name="add" value="', $txt['pm_label_add_new'], '" class="button_submit">
 		</div>
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-	</form><br />';
+		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+	</form><br>';
 }
 
 // Template for reporting a personal message.
 function template_report_message()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<form action="', $scripturl, '?action=pm;sa=report;l=', $context['current_label_id'], '" method="post" accept-charset="', $context['character_set'], '">
-		<input type="hidden" name="pmsg" value="', $context['pm_id'], '" />
+		<input type="hidden" name="pmsg" value="', $context['pm_id'], '">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['pm_report_title'], '</h3>
 		</div>
-		<div class="description">
+		<div class="information">
 			', $txt['pm_report_desc'], '
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl class="settings">';
+			<dl class="settings">';
 
 	// If there is more than one admin on the forum, allow the user to choose the one they want to direct to.
-	// !!! Why?
+	// @todo Why?
 	if ($context['admin_count'] > 1)
 	{
 		echo '
-					<dt>
-						<strong>', $txt['pm_report_admins'], ':</strong>
-					</dt>
-					<dd>
-						<select name="ID_ADMIN">
-							<option value="0">', $txt['pm_report_all_admins'], '</option>';
+				<dt>
+					<strong>', $txt['pm_report_admins'], ':</strong>
+				</dt>
+				<dd>
+					<select name="id_admin">
+						<option value="0">', $txt['pm_report_all_admins'], '</option>';
 		foreach ($context['admins'] as $id => $name)
 			echo '
-							<option value="', $id, '">', $name, '</option>';
+						<option value="', $id, '">', $name, '</option>';
 		echo '
-						</select>
-					</dd>';
+					</select>
+				</dd>';
 	}
 
 	echo '
-					<dt>
-						<strong>', $txt['pm_report_reason'], ':</strong>
-					</dt>
-					<dd>
-						<textarea name="reason" rows="4" cols="70" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 80%; min-width: 80%' : 'width: 80%') . ';"></textarea>
-					</dd>
-				</dl>
-				<div class="righttext">
-					<input type="submit" name="report" value="', $txt['pm_report_message'], '" class="button_submit" />
-				</div>
+				<dt>
+					<strong>', $txt['pm_report_reason'], ':</strong>
+				</dt>
+				<dd>
+					<textarea name="reason" rows="4" cols="70" style="width: 80%;"></textarea>
+				</dd>
+			</dl>
+			<div class="righttext">
+				<input type="submit" name="report" value="', $txt['pm_report_message'], '" class="button_submit">
 			</div>
-			<span class="botslice"><span></span></span>
 		</div>
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 	</form>';
 }
 
 // Little template just to say "Yep, it's been submitted"
 function template_report_message_complete()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['pm_report_title'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $txt['pm_report_done'], '</p>
-				<a href="', $scripturl, '?action=pm;l=', $context['current_label_id'], '">', $txt['pm_report_return'], '</a>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p>', $txt['pm_report_done'], '</p>
+			<a href="', $scripturl, '?action=pm;l=', $context['current_label_id'], '">', $txt['pm_report_return'], '</a>
 		</div>';
 }
 
 // Manage rules.
 function template_rules()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<form action="', $scripturl, '?action=pm;sa=manrules" method="post" accept-charset="', $context['character_set'], '" name="manRules" id="manrules">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['pm_manage_rules'], '</h3>
 		</div>
-		<div class="description">
+		<div class="information">
 			', $txt['pm_manage_rules_desc'], '
 		</div>
-		<table width="100%" class="table_grid">
+		<table class="table_grid">
 		<thead>
-			<tr class="catbg">
-				<th class="lefttext first_th">
+			<tr class="title_bar">
+				<th class="lefttext">
 					', $txt['pm_rule_title'], '
 				</th>
-				<th width="4%" class="centertext last_th">';
+				<th width="4%" class="centertext">';
 
 	if (!empty($context['rules']))
 		echo '
-					<input type="checkbox" onclick="invertAll(this, this.form);" class="input_check" />';
+					<input type="checkbox" onclick="invertAll(this, this.form);" class="input_check">';
 
 	echo '
 				</th>
@@ -1368,32 +1533,30 @@
 
 	if (empty($context['rules']))
 		echo '
-			<tr class="windowbg2">
-				<td colspan="2" align="center">
+			<tr class="windowbg">
+				<td colspan="2">
 					', $txt['pm_rules_none'], '
 				</td>
 			</tr>';
 
-	$alternate = false;
 	foreach ($context['rules'] as $rule)
 	{
 		echo '
-			<tr class="', $alternate ? 'windowbg' : 'windowbg2', '">
+			<tr class="windowbg">
 				<td>
 					<a href="', $scripturl, '?action=pm;sa=manrules;add;rid=', $rule['id'], '">', $rule['name'], '</a>
 				</td>
-				<td width="4%" align="center">
-					<input type="checkbox" name="delrule[', $rule['id'], ']" class="input_check" />
+				<td width="4%">
+					<input type="checkbox" name="delrule[', $rule['id'], ']" class="input_check">
 				</td>
 			</tr>';
-		$alternate = !$alternate;
 	}
 
 	echo '
 		</tbody>
 		</table>
 		<div class="righttext">
-			[<a href="', $scripturl, '?action=pm;sa=manrules;add;rid=0">', $txt['pm_add_rule'], '</a>]';
+			<a class="button_link" href="', $scripturl, '?action=pm;sa=manrules;add;rid=0">', $txt['pm_add_rule'], '</a>';
 
 	if (!empty($context['rules']))
 		echo '
@@ -1401,8 +1564,8 @@
 
 	if (!empty($context['rules']))
 		echo '
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			<input type="submit" name="delselected" value="', $txt['pm_delete_selected_rule'], '" onclick="return confirm(\'', $txt['pm_js_delete_rule_confirm'], '\');" class="button_submit smalltext" />';
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="submit" name="delselected" value="', $txt['pm_delete_selected_rule'], '" data-confirm="', $txt['pm_js_delete_rule_confirm'] ,'" class="button_submit smalltext you_sure">';
 
 	echo '
 		</div>
@@ -1413,10 +1576,10 @@
 // Template for adding/editing a rule.
 function template_add_rule()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 			var criteriaNum = 0;
 			var actionNum = 0;
 			var groups = new Array()
@@ -1429,7 +1592,7 @@
 	foreach ($context['labels'] as $label)
 		if ($label['id'] != -1)
 			echo '
-			labels[', ($label['id'] + 1), '] = "', addslashes($label['name']), '";';
+			labels[', ($label['id']), '] = "', addslashes($label['name']), '";';
 
 	echo '
 			function addCriteriaOption()
@@ -1442,7 +1605,7 @@
 				}
 				criteriaNum++
 
-				setOuterHTML(document.getElementById("criteriaAddHere"), \'<br /><select name="ruletype[\' + criteriaNum + \']" id="ruletype\' + criteriaNum + \'" onchange="updateRuleDef(\' + criteriaNum + \'); rebuildRuleDesc();"><option value="">', addslashes($txt['pm_rule_criteria_pick']), ':<\' + \'/option><option value="mid">', addslashes($txt['pm_rule_mid']), '<\' + \'/option><option value="gid">', addslashes($txt['pm_rule_gid']), '<\' + \'/option><option value="sub">', addslashes($txt['pm_rule_sub']), '<\' + \'/option><option value="msg">', addslashes($txt['pm_rule_msg']), '<\' + \'/option><option value="bud">', addslashes($txt['pm_rule_bud']), '<\' + \'/option><\' + \'/select>&nbsp;<span id="defdiv\' + criteriaNum + \'" style="display: none;"><input type="text" name="ruledef[\' + criteriaNum + \']" id="ruledef\' + criteriaNum + \'" onkeyup="rebuildRuleDesc();" value="" class="input_text" /><\' + \'/span><span id="defseldiv\' + criteriaNum + \'" style="display: none;"><select name="ruledefgroup[\' + criteriaNum + \']" id="ruledefgroup\' + criteriaNum + \'" onchange="rebuildRuleDesc();"><option value="">', addslashes($txt['pm_rule_sel_group']), '<\' + \'/option>';
+				setOuterHTML(document.getElementById("criteriaAddHere"), \'<br><select name="ruletype[\' + criteriaNum + \']" id="ruletype\' + criteriaNum + \'" onchange="updateRuleDef(\' + criteriaNum + \'); rebuildRuleDesc();"><option value="">', addslashes($txt['pm_rule_criteria_pick']), ':<\' + \'/option><option value="mid">', addslashes($txt['pm_rule_mid']), '<\' + \'/option><option value="gid">', addslashes($txt['pm_rule_gid']), '<\' + \'/option><option value="sub">', addslashes($txt['pm_rule_sub']), '<\' + \'/option><option value="msg">', addslashes($txt['pm_rule_msg']), '<\' + \'/option><option value="bud">', addslashes($txt['pm_rule_bud']), '<\' + \'/option><\' + \'/select>&nbsp;<span id="defdiv\' + criteriaNum + \'" style="display: none;"><input type="text" name="ruledef[\' + criteriaNum + \']" id="ruledef\' + criteriaNum + \'" onkeyup="rebuildRuleDesc();" value="" class="input_text"><\' + \'/span><span id="defseldiv\' + criteriaNum + \'" style="display: none;"><select name="ruledefgroup[\' + criteriaNum + \']" id="ruledefgroup\' + criteriaNum + \'" onchange="rebuildRuleDesc();"><option value="">', addslashes($txt['pm_rule_sel_group']), '<\' + \'/option>';
 
 	foreach ($context['groups'] as $id => $group)
 		echo '<option value="', $id, '">', strtr($group, array("'" => "\'")), '<\' + \'/option>';
@@ -1460,46 +1623,15 @@
 				}
 				actionNum++
 
-				setOuterHTML(document.getElementById("actionAddHere"), \'<br /><select name="acttype[\' + actionNum + \']" id="acttype\' + actionNum + \'" onchange="updateActionDef(\' + actionNum + \'); rebuildRuleDesc();"><option value="">', addslashes($txt['pm_rule_sel_action']), ':<\' + \'/option><option value="lab">', addslashes($txt['pm_rule_label']), '<\' + \'/option><option value="del">', addslashes($txt['pm_rule_delete']), '<\' + \'/option><\' + \'/select>&nbsp;<span id="labdiv\' + actionNum + \'" style="display: none;"><select name="labdef[\' + actionNum + \']" id="labdef\' + actionNum + \'" onchange="rebuildRuleDesc();"><option value="">', addslashes($txt['pm_rule_sel_label']), '<\' + \'/option>';
+				setOuterHTML(document.getElementById("actionAddHere"), \'<br><select name="acttype[\' + actionNum + \']" id="acttype\' + actionNum + \'" onchange="updateActionDef(\' + actionNum + \'); rebuildRuleDesc();"><option value="">', addslashes($txt['pm_rule_sel_action']), ':<\' + \'/option><option value="lab">', addslashes($txt['pm_rule_label']), '<\' + \'/option><option value="del">', addslashes($txt['pm_rule_delete']), '<\' + \'/option><\' + \'/select>&nbsp;<span id="labdiv\' + actionNum + \'" style="display: none;"><select name="labdef[\' + actionNum + \']" id="labdef\' + actionNum + \'" onchange="rebuildRuleDesc();"><option value="">', addslashes($txt['pm_rule_sel_label']), '<\' + \'/option>';
 
 	foreach ($context['labels'] as $label)
 		if ($label['id'] != -1)
-			echo '<option value="', ($label['id'] + 1), '">', addslashes($label['name']), '<\' + \'/option>';
+			echo '<option value="', ($label['id']), '">', addslashes($label['name']), '<\' + \'/option>';
 
 	echo '<\' + \'/select><\' + \'/span><span id="actionAddHere"><\' + \'/span>\');
 			}
 
-			function updateRuleDef(optNum)
-			{
-				if (document.getElementById("ruletype" + optNum).value == "gid")
-				{
-					document.getElementById("defdiv" + optNum).style.display = "none";
-					document.getElementById("defseldiv" + optNum).style.display = "";
-				}
-				else if (document.getElementById("ruletype" + optNum).value == "bud" || document.getElementById("ruletype" + optNum).value == "")
-				{
-					document.getElementById("defdiv" + optNum).style.display = "none";
-					document.getElementById("defseldiv" + optNum).style.display = "none";
-				}
-				else
-				{
-					document.getElementById("defdiv" + optNum).style.display = "";
-					document.getElementById("defseldiv" + optNum).style.display = "none";
-				}
-			}
-
-			function updateActionDef(optNum)
-			{
-				if (document.getElementById("acttype" + optNum).value == "lab")
-				{
-					document.getElementById("labdiv" + optNum).style.display = "";
-				}
-				else
-				{
-					document.getElementById("labdiv" + optNum).style.display = "none";
-				}
-			}
-
 			// Rebuild the rule description!
 			function rebuildRuleDesc()
 			{
@@ -1590,19 +1722,17 @@
 			<h3 class="catbg">', $context['rid'] == 0 ? $txt['pm_add_rule'] : $txt['pm_edit_rule'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl class="addrules">
-					<dt class="floatleft">
-						<strong>', $txt['pm_rule_name'], ':</strong><br />
-						<span class="smalltext">', $txt['pm_rule_name_desc'], '</span>
-					</dt>
-					<dd class="floatleft">
-						<input type="text" name="rule_name" value="', empty($context['rule']['name']) ? $txt['pm_rule_name_default'] : $context['rule']['name'], '" size="50" class="input_text" />
-					</dd>
-				</dl>
-				<fieldset>
-					<legend>', $txt['pm_rule_criteria'], '</legend>';
+			<dl class="addrules">
+				<dt class="floatleft">
+					<strong>', $txt['pm_rule_name'], ':</strong><br>
+					<span class="smalltext">', $txt['pm_rule_name_desc'], '</span>
+				</dt>
+				<dd class="floatleft">
+					<input type="text" name="rule_name" value="', empty($context['rule']['name']) ? $txt['pm_rule_name_default'] : $context['rule']['name'], '" size="50" class="input_text">
+				</dd>
+			</dl>
+			<fieldset>
+				<legend>', $txt['pm_rule_criteria'], '</legend>';
 
 	// Add a dummy criteria to allow expansion for none js users.
 	$context['rule']['criteria'][] = array('t' => '', 'v' => '');
@@ -1614,30 +1744,31 @@
 		if (!$isFirst && $criteria['t'] == '')
 			echo '<div id="removeonjs1">';
 		elseif (!$isFirst)
-			echo '<br />';
+			echo '<br>';
 
 		echo '
-					<select name="ruletype[', $k, ']" id="ruletype', $k, '" onchange="updateRuleDef(', $k, '); rebuildRuleDesc();">
-						<option value="">', $txt['pm_rule_criteria_pick'], ':</option>
-						<option value="mid" ', $criteria['t'] == 'mid' ? 'selected="selected"' : '', '>', $txt['pm_rule_mid'], '</option>
-						<option value="gid" ', $criteria['t'] == 'gid' ? 'selected="selected"' : '', '>', $txt['pm_rule_gid'], '</option>
-						<option value="sub" ', $criteria['t'] == 'sub' ? 'selected="selected"' : '', '>', $txt['pm_rule_sub'], '</option>
-						<option value="msg" ', $criteria['t'] == 'msg' ? 'selected="selected"' : '', '>', $txt['pm_rule_msg'], '</option>
-						<option value="bud" ', $criteria['t'] == 'bud' ? 'selected="selected"' : '', '>', $txt['pm_rule_bud'], '</option>
-					</select>
-					<span id="defdiv', $k, '" ', !in_array($criteria['t'], array('gid', 'bud')) ? '' : 'style="display: none;"', '>
-						<input type="text" name="ruledef[', $k, ']" id="ruledef', $k, '" onkeyup="rebuildRuleDesc();" value="', in_array($criteria['t'], array('mid', 'sub', 'msg')) ? $criteria['v'] : '', '" class="input_text" />
-					</span>
-					<span id="defseldiv', $k, '" ', $criteria['t'] == 'gid' ? '' : 'style="display: none;"', '>
-						<select name="ruledefgroup[', $k, ']" id="ruledefgroup', $k, '" onchange="rebuildRuleDesc();">
-							<option value="">', $txt['pm_rule_sel_group'], '</option>';
+				<select name="ruletype[', $k, ']" id="ruletype', $k, '" onchange="updateRuleDef(', $k, '); rebuildRuleDesc();">
+					<option value="">', $txt['pm_rule_criteria_pick'], ':</option>';
+
+		foreach (array('mid', 'gid', 'sub', 'msg', 'bud') as $cr)
+			echo '
+					<option value="', $cr, '"', $criteria['t'] == $cr ? ' selected' : '', '>', $txt['pm_rule_' . $cr], '</option>';
+
+		echo '
+				</select>
+				<span id="defdiv', $k, '" ', !in_array($criteria['t'], array('gid', 'bud')) ? '' : 'style="display: none;"', '>
+					<input type="text" name="ruledef[', $k, ']" id="ruledef', $k, '" onkeyup="rebuildRuleDesc();" value="', in_array($criteria['t'], array('mid', 'sub', 'msg')) ? $criteria['v'] : '', '" class="input_text">
+				</span>
+				<span id="defseldiv', $k, '" ', $criteria['t'] == 'gid' ? '' : 'style="display: none;"', '>
+					<select name="ruledefgroup[', $k, ']" id="ruledefgroup', $k, '" onchange="rebuildRuleDesc();">
+						<option value="">', $txt['pm_rule_sel_group'], '</option>';
 
 		foreach ($context['groups'] as $id => $group)
 			echo '
-							<option value="', $id, '" ', $criteria['t'] == 'gid' && $criteria['v'] == $id ? 'selected="selected"' : '', '>', $group, '</option>';
+						<option value="', $id, '"', $criteria['t'] == 'gid' && $criteria['v'] == $id ? ' selected' : '', '>', $group, '</option>';
 		echo '
-						</select>
-					</span>';
+					</select>
+				</span>';
 
 		// If this is the dummy we add a means to hide for non js users.
 		if ($isFirst)
@@ -1647,17 +1778,17 @@
 	}
 
 	echo '
-					<span id="criteriaAddHere"></span><br />
-					<a href="#" onclick="addCriteriaOption(); return false;" id="addonjs1" style="display: none;">(', $txt['pm_rule_criteria_add'], ')</a>
-					<br /><br />
-					', $txt['pm_rule_logic'], ':
-					<select name="rule_logic" id="logic" onchange="rebuildRuleDesc();">
-						<option value="and" ', $context['rule']['logic'] == 'and' ? 'selected="selected"' : '', '>', $txt['pm_rule_logic_and'], '</option>
-						<option value="or" ', $context['rule']['logic'] == 'or' ? 'selected="selected"' : '', '>', $txt['pm_rule_logic_or'], '</option>
-					</select>
-				</fieldset>
-				<fieldset>
-					<legend>', $txt['pm_rule_actions'], '</legend>';
+				<span id="criteriaAddHere"></span><br>
+				<a href="#" onclick="addCriteriaOption(); return false;" id="addonjs1" style="display: none;">(', $txt['pm_rule_criteria_add'], ')</a>
+				<br><br>
+				', $txt['pm_rule_logic'], ':
+				<select name="rule_logic" id="logic" onchange="rebuildRuleDesc();">
+					<option value="and"', $context['rule']['logic'] == 'and' ? ' selected' : '', '>', $txt['pm_rule_logic_and'], '</option>
+					<option value="or"', $context['rule']['logic'] == 'or' ? ' selected' : '', '>', $txt['pm_rule_logic_or'], '</option>
+				</select>
+			</fieldset>
+			<fieldset>
+				<legend>', $txt['pm_rule_actions'], '</legend>';
 
 	// As with criteria - add a dummy action for "expansion".
 	$context['rule']['actions'][] = array('t' => '', 'v' => '');
@@ -1669,55 +1800,53 @@
 		if (!$isFirst && $action['t'] == '')
 			echo '<div id="removeonjs2">';
 		elseif (!$isFirst)
-			echo '<br />';
+			echo '<br>';
 
 		echo '
-					<select name="acttype[', $k, ']" id="acttype', $k, '" onchange="updateActionDef(', $k, '); rebuildRuleDesc();">
-						<option value="">', $txt['pm_rule_sel_action'] , ':</option>
-						<option value="lab" ', $action['t'] == 'lab' ? 'selected="selected"' : '', '>', $txt['pm_rule_label'] , '</option>
-						<option value="del" ', $action['t'] == 'del' ? 'selected="selected"' : '', '>', $txt['pm_rule_delete'] , '</option>
-					</select>
-					<span id="labdiv', $k, '">
-						<select name="labdef[', $k, ']" id="labdef', $k, '" onchange="rebuildRuleDesc();">
-							<option value="">', $txt['pm_rule_sel_label'], '</option>';
+				<select name="acttype[', $k, ']" id="acttype', $k, '" onchange="updateActionDef(', $k, '); rebuildRuleDesc();">
+					<option value="">', $txt['pm_rule_sel_action'] , ':</option>
+					<option value="lab"', $action['t'] == 'lab' ? ' selected' : '', '>', $txt['pm_rule_label'] , '</option>
+					<option value="del"', $action['t'] == 'del' ? ' selected' : '', '>', $txt['pm_rule_delete'] , '</option>
+				</select>
+				<span id="labdiv', $k, '">
+					<select name="labdef[', $k, ']" id="labdef', $k, '" onchange="rebuildRuleDesc();">
+						<option value="">', $txt['pm_rule_sel_label'], '</option>';
 		foreach ($context['labels'] as $label)
 			if ($label['id'] != -1)
 				echo '
-							<option value="', ($label['id'] + 1), '" ', $action['t'] == 'lab' && $action['v'] == $label['id'] ? 'selected="selected"' : '', '>', $label['name'], '</option>';
+						<option value="', ($label['id']), '"', $action['t'] == 'lab' && $action['v'] == $label['id'] ? ' selected' : '', '>', $label['name'], '</option>';
 
 		echo '
-						</select>
-					</span>';
+					</select>
+				</span>';
 
 		if ($isFirst)
 			$isFirst = false;
 		elseif ($action['t'] == '')
 			echo '
-				</div>';
+			</div>';
 	}
 
 	echo '
-					<span id="actionAddHere"></span><br />
+					<span id="actionAddHere"></span><br>
 					<a href="#" onclick="addActionOption(); return false;" id="addonjs2" style="display: none;">(', $txt['pm_rule_add_action'], ')</a>
 				</fieldset>
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['pm_rule_description'], '</h3>
+			</div>
+			<div class="information">
+				<div id="ruletext">', $txt['pm_rule_js_disabled'], '</div>
+			</div>
+			<div class="righttext">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="submit" name="save" value="', $txt['pm_rule_save'], '" class="button_submit">
 			</div>
-			<span class="botslice"><span></span></span>
-		</div><br class="clear" />
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['pm_rule_description'], '</h3>
-		</div>
-		<div class="information">
-			<div id="ruletext">', $txt['pm_rule_js_disabled'], '</div>
-		</div>
-		<div class="righttext">
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			<input type="submit" name="save" value="', $txt['pm_rule_save'], '" class="button_submit" />
 		</div>
 	</form>';
 
 	// Now setup all the bits!
 		echo '
-	<script type="text/javascript"><!-- // --><![CDATA[';
+	<script><!-- // --><![CDATA[';
 
 	foreach ($context['rule']['criteria'] as $k => $c)
 		echo '
@@ -1744,4 +1873,65 @@
 		// ]]></script>';
 }
 
+// Template for showing all the PM drafts of the user.
+function template_showPMDrafts()
+{
+	global $context, $scripturl, $txt;
+
+	echo '
+		<div class="cat_bar">
+			<h3 class="catbg">
+				<span class="generic_icons inbox"></span> ', $txt['drafts_show'], '
+			</h3>
+		</div>
+		<div class="pagesection">
+			<span>', $context['page_index'], '</span>
+		</div>';
+
+	// Button shortcuts
+	$edit_button = create_button('modify_inline.png', 'draft_edit', 'draft_edit', 'class="centericon"');
+	$remove_button = create_button('delete.png', 'draft_delete', 'draft_delete', 'class="centericon"');
+
+
+	// No drafts? Just show an informative message.
+	if (empty($context['drafts']))
+		echo '
+		<div class="windowbg2 centertext">
+			', $txt['draft_none'], '
+		</div>';
+	else
+	{
+		// For every draft to be displayed, give it its own div, and show the important details of the draft.
+		foreach ($context['drafts'] as $draft)
+		{
+			echo '
+				<div class="windowbg">
+					<div class="counter">', $draft['counter'], '</div>
+					<div class="topic_details">
+						<h5><strong>', $draft['subject'], '</strong>&nbsp;';
+
+			echo '
+						</h5>
+						<span class="smalltext">&#171;&nbsp;<strong>', $txt['draft_saved_on'], ':</strong> ', sprintf($txt['draft_days_ago'], $draft['age']), (!empty($draft['remaining']) ? ', ' . sprintf($txt['draft_retain'], $draft['remaining']) : ''), '&#187;</span><br>
+						<span class="smalltext">&#171;&nbsp;<strong>', $txt['to'], ':</strong> ', implode(', ', $draft['recipients']['to']), '&nbsp;&#187;</span><br>
+						<span class="smalltext">&#171;&nbsp;<strong>', $txt['pm_bcc'], ':</strong> ', implode(', ', $draft['recipients']['bcc']), '&nbsp;&#187;</span>
+					</div>
+					<div class="list_posts">
+						', $draft['body'], '
+					</div>
+					<ul class="reset smalltext quickbuttons">
+						<li><a href="', $scripturl, '?action=pm;sa=showpmdrafts;id_draft=', $draft['id_draft'], ';', $context['session_var'], '=', $context['session_id'], '"  class="modifybutton"><span>', $txt['draft_edit'], '</span></a></li>
+						<li><a href="', $scripturl, '?action=pm;sa=showpmdrafts;delete=', $draft['id_draft'], ';', $context['session_var'], '=', $context['session_id'], '" data-confirm="', $txt['draft_remove'] ,'?" class="remove_button you_sure"><span>', $txt['draft_delete'], '</span></a></li>
+					</ul>
+				</div>';
+		}
+	}
+
+	// Show page numbers.
+	echo '
+		<div class="pagesection">
+			<span>', $context['page_index'], '</span>
+		</div>';
+}
+
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Poll.template.php b/Themes/default/Poll.template.php
--- a/Themes/default/Poll.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Poll.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,21 +3,22 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_main()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	// Some javascript for adding more options.
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			var pollOptionNum = 0;
+			var pollOptionId = ', $context['last_choice_id'], ';
 
 			function addPollOption()
 			{
@@ -28,8 +29,9 @@
 							pollOptionNum++;
 				}
 				pollOptionNum++
+				pollOptionId++
 
-				setOuterHTML(document.getElementById("pollMoreOptions"), \'<li><label for="options-\' + pollOptionNum + \'" ', (isset($context['poll_error']['no_question']) ? ' class="error"' : ''), '>', $txt['option'], ' \' + pollOptionNum + \'</label>: <input type="text" name="options[\' + (pollOptionNum - 1) + \']" id="options-\' + (pollOptionNum - 1) + \'" value="" size="80" maxlength="255" class="input_text" /></li><li id="pollMoreOptions"></li\');
+				setOuterHTML(document.getElementById("pollMoreOptions"), \'<li><label for="options-\' + pollOptionId + \'" ', (isset($context['poll_error']['no_question']) ? ' class="error"' : ''), '>', $txt['option'], ' \' + pollOptionNum + \'</label>: <input type="text" name="options[\' + (pollOptionId) + \']" id="options-\' + (pollOptionId) + \'" value="" size="80" maxlength="255" class="input_text"></li><li id="pollMoreOptions"></li\');
 			}
 		// ]]></script>';
 
@@ -49,19 +51,18 @@
 						', $context['is_edit'] ? $txt['error_while_editing_poll'] : $txt['error_while_adding_poll'], ':
 					</dt>
 					<dt>
-						', empty($context['poll_error']['messages']) ? '' : implode('<br />', $context['poll_error']['messages']), '
+						', empty($context['poll_error']['messages']) ? '' : implode('<br>', $context['poll_error']['messages']), '
 					</dt>
 				</dl>
 			</div>';
 
 	echo '
 			<div>
-			<span class="upperframe"><span></span></span>
 				<div class="roundframe">
-					<input type="hidden" name="poll" value="', $context['poll']['id'], '" />
+					<input type="hidden" name="poll" value="', $context['poll']['id'], '">
 					<fieldset id="poll_main">
 						<legend><span ', (isset($context['poll_error']['no_question']) ? ' class="error"' : ''), '>', $txt['poll_question'], ':</span></legend>
-						<input type="text" name="question" size="80" value="', $context['poll']['question'], '" class="input_text" />
+						<input type="text" name="question" size="80" value="', $context['poll']['question'], '" class="input_text">
 						<ul class="poll_main">';
 
 	foreach ($context['choices'] as $choice)
@@ -69,7 +70,7 @@
 		echo '
 							<li>
 								<label for="options-', $choice['id'], '" ', (isset($context['poll_error']['poll_few']) ? ' class="error"' : ''), '>', $txt['option'], ' ', $choice['number'], '</label>:
-								<input type="text" name="options[', $choice['id'], ']" id="options-', $choice['id'], '" value="', $choice['label'], '" class="input_text" size="80" maxlength="255" />';
+								<input type="text" name="options[', $choice['id'], ']" id="options-', $choice['id'], '" value="', $choice['label'], '" class="input_text" size="80" maxlength="255">';
 
 		// Does this option have a vote count yet, or is it new?
 		if ($choice['votes'] != -1)
@@ -95,20 +96,20 @@
 								<label for="poll_max_votes">', $txt['poll_max_votes'], ':</label>
 							</dt>
 							<dd>
-								<input type="text" name="poll_max_votes" id="poll_max_votes" size="2" value="', $context['poll']['max_votes'], '" class="input_text" />
+								<input type="text" name="poll_max_votes" id="poll_max_votes" size="2" value="', $context['poll']['max_votes'], '" class="input_text">
 							</dd>
 							<dt>
-								<label for="poll_expire">', $txt['poll_run'], ':</label><br />
+								<label for="poll_expire">', $txt['poll_run'], ':</label><br>
 								<em class="smalltext">', $txt['poll_run_limit'], '</em>
 							</dt>
 							<dd>
-								<input type="text" name="poll_expire" id="poll_expire" size="2" value="', $context['poll']['expiration'], '" onchange="this.form.poll_hide[2].disabled = isEmptyText(this) || this.value == 0; if (this.form.poll_hide[2].checked) this.form.poll_hide[1].checked = true;" maxlength="4" class="input_text" /> ', $txt['days_word'], '
+								<input type="text" name="poll_expire" id="poll_expire" size="2" value="', $context['poll']['expiration'], '" onchange="this.form.poll_hide[2].disabled = isEmptyText(this) || this.value == 0; if (this.form.poll_hide[2].checked) this.form.poll_hide[1].checked = true;" maxlength="4" class="input_text"> ', $txt['days_word'], '
 							</dd>
 							<dt>
 								<label for="poll_change_vote">', $txt['poll_do_change_vote'], ':</label>
 							</dt>
 							<dd>
-								<input type="checkbox" id="poll_change_vote" name="poll_change_vote"', !empty($context['poll']['change_vote']) ? ' checked="checked"' : '', ' class="input_check" />
+								<input type="checkbox" id="poll_change_vote" name="poll_change_vote"', !empty($context['poll']['change_vote']) ? ' checked' : '', ' class="input_check">
 							</dd>';
 
 		if ($context['poll']['guest_vote_allowed'])
@@ -117,7 +118,7 @@
 								<label for="poll_guest_vote">', $txt['poll_guest_vote'], ':</label>
 							</dt>
 							<dd>
-								<input type="checkbox" id="poll_guest_vote" name="poll_guest_vote"', !empty($context['poll']['guest_vote']) ? ' checked="checked"' : '', ' class="input_check" />
+								<input type="checkbox" id="poll_guest_vote" name="poll_guest_vote"', !empty($context['poll']['guest_vote']) ? ' checked' : '', ' class="input_check">
 							</dd>';
 	}
 
@@ -126,9 +127,9 @@
 								', $txt['poll_results_visibility'], ':
 							</dt>
 							<dd>
-								<input type="radio" name="poll_hide" id="poll_results_anyone" value="0"', $context['poll']['hide_results'] == 0 ? ' checked="checked"' : '', ' class="input_radio" /> <label for="poll_results_anyone">', $txt['poll_results_anyone'], '</label><br />
-								<input type="radio" name="poll_hide" id="poll_results_voted" value="1"', $context['poll']['hide_results'] == 1 ? ' checked="checked"' : '', ' class="input_radio" /> <label for="poll_results_voted">', $txt['poll_results_voted'], '</label><br />
-								<input type="radio" name="poll_hide" id="poll_results_expire" value="2"', $context['poll']['hide_results'] == 2 ? ' checked="checked"' : '', empty($context['poll']['expiration']) ? 'disabled="disabled"' : '', ' class="input_radio" /> <label for="poll_results_expire">', $txt['poll_results_after'], '</label>
+								<input type="radio" name="poll_hide" id="poll_results_anyone" value="0"', $context['poll']['hide_results'] == 0 ? ' checked' : '', ' class="input_radio"> <label for="poll_results_anyone">', $txt['poll_results_anyone'], '</label><br>
+								<input type="radio" name="poll_hide" id="poll_results_voted" value="1"', $context['poll']['hide_results'] == 1 ? ' checked' : '', ' class="input_radio"> <label for="poll_results_voted">', $txt['poll_results_voted'], '</label><br>
+								<input type="radio" name="poll_hide" id="poll_results_expire" value="2"', $context['poll']['hide_results'] == 2 ? ' checked' : '', empty($context['poll']['expiration']) ? ' disabled' : '', ' class="input_radio"> <label for="poll_results_expire">', $txt['poll_results_after'], '</label>
 							</dd>
 						</dl>
 					</fieldset>';
@@ -137,20 +138,19 @@
 		echo '
 					<fieldset id="poll_reset">
 						<legend>', $txt['reset_votes'], '</legend>
-						<input type="checkbox" name="resetVoteCount" value="on" class="input_check" /> ' . $txt['reset_votes_check'] . '
+						<input type="checkbox" name="resetVoteCount" value="on" class="input_check"> ' . $txt['reset_votes_check'] . '
 					</fieldset>';
 	echo '
-					<div class="righttext padding">
-						<input type="submit" name="post" value="', $txt['save'], '" onclick="return submitThisOnce(this);" accesskey="s" class="button_submit" />
+					<div class="padding flow_auto">
+						<input type="submit" name="post" value="', $txt['save'], '" onclick="return submitThisOnce(this);" accesskey="s" class="button_submit">
 					</div>
 				</div>
-				<span class="lowerframe"><span></span></span>
 			</div>
-			<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '" />
-			<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '" />
+			<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '">
+			<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '">
 		</form>
 	</div>
-	<br class="clear" />';
+';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Post.template.php b/Themes/default/Post.template.php
--- a/Themes/default/Post.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Post.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,29 +3,25 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // The main template for the post page.
 function template_main()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings, $counter;
+	global $context, $options, $txt, $scripturl, $modSettings, $counter;
 
 	// Start the javascript... and boy is there a lot.
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[';
+		<script><!-- // --><![CDATA[';
 
 	// When using Go Back due to fatal_error, allow the form to be re-submitted with changes.
-	if ($context['browser']['is_firefox'])
+	if (isBrowser('is_firefox'))
 		echo '
-			function reActivate()
-			{
-				document.forms.postmodify.message.readOnly = false;
-			}
 			window.addEventListener("pageshow", reActivate, false);';
 
 	// Start with message icons - and any missing from this theme.
@@ -37,31 +33,11 @@
 	echo '
 			};';
 
-	// The actual message icon selector.
-	echo '
-			function showimage()
-			{
-				document.images.icons.src = icon_urls[document.forms.postmodify.icon.options[document.forms.postmodify.icon.selectedIndex].value];
-			}';
-
 	// If this is a poll - use some javascript to ensure the user doesn't create a poll with illegal option combinations.
 	if ($context['make_poll'])
 		echo '
-			function pollOptions()
-			{
-				var expire_time = document.getElementById(\'poll_expire\');
-
-				if (isEmptyText(expire_time) || expire_time.value == 0)
-				{
-					document.forms.postmodify.poll_hide[2].disabled = true;
-					if (document.forms.postmodify.poll_hide[2].checked)
-						document.forms.postmodify.poll_hide[1].checked = true;
-				}
-				else
-					document.forms.postmodify.poll_hide[2].disabled = false;
-			}
-
 			var pollOptionNum = 0, pollTabIndex;
+			var pollOptionId = ', $context['last_choice_id'], ';
 			function addPollOption()
 			{
 				if (pollOptionNum == 0)
@@ -74,32 +50,15 @@
 						}
 				}
 				pollOptionNum++
+				pollOptionId++
 
-				setOuterHTML(document.getElementById(\'pollMoreOptions\'), ', JavaScriptEscape('<li><label for="options-'), ' + pollOptionNum + ', JavaScriptEscape('">' . $txt['option'] . ' '), ' + pollOptionNum + ', JavaScriptEscape('</label>: <input type="text" name="options['), ' + pollOptionNum + ', JavaScriptEscape(']" id="options-'), ' + pollOptionNum + ', JavaScriptEscape('" value="" size="80" maxlength="255" tabindex="'), ' + pollTabIndex + ', JavaScriptEscape('" class="input_text" /></li><li id="pollMoreOptions"></li>'), ');
+				setOuterHTML(document.getElementById(\'pollMoreOptions\'), ', JavaScriptEscape('<li><label for="options-'), ' + pollOptionId + ', JavaScriptEscape('">' . $txt['option'] . ' '), ' + pollOptionNum + ', JavaScriptEscape('</label>: <input type="text" name="options['), ' + pollOptionId + ', JavaScriptEscape(']" id="options-'), ' + pollOptionId + ', JavaScriptEscape('" value="" size="80" maxlength="255" tabindex="'), ' + pollTabIndex + ', JavaScriptEscape('" class="input_text"></li><li id="pollMoreOptions"></li>'), ');
 			}';
 
 	// If we are making a calendar event we want to ensure we show the current days in a month etc... this is done here.
 	if ($context['make_event'])
 		echo '
-			var monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
-
-			function generateDays()
-			{
-				var dayElement = document.getElementById(\'day\'), yearElement = document.getElementById(\'year\'), monthElement = document.getElementById(\'month\');
-				var days, selected = dayElement.selectedIndex;
-
-				monthLength[1] = yearElement.options[yearElement.selectedIndex].value % 4 == 0 ? 29 : 28;
-				days = monthLength[monthElement.value - 1];
-
-				while (dayElement.options.length)
-					dayElement.options[0] = null;
-
-				for (i = 1; i <= days; i++)
-					dayElement.options[dayElement.length] = new Option(i, i);
-
-				if (selected < days)
-					dayElement.selectedIndex = selected;
-			}';
+			var monthLength = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];';
 
 	// End of the javascript, start the form and display the link tree.
 	echo '
@@ -111,44 +70,37 @@
 			<div id="preview_section"', isset($context['preview_message']) ? '' : ' style="display: none;"', '>
 				<div class="cat_bar">
 					<h3 class="catbg">
-						<span id="preview_subject">', empty($context['preview_subject']) ? '' : $context['preview_subject'], '</span>
+						<span id="preview_subject">', empty($context['preview_subject']) ? '&nbsp;' : $context['preview_subject'], '</span>
 					</h3>
 				</div>
-				<div class="windowbg">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<div class="post" id="preview_body">
-							', empty($context['preview_message']) ? '<br />' : $context['preview_message'], '
-						</div>
-					</div>
-					<span class="botslice"><span></span></span>
+				<div id="preview_body" class="windowbg">
+					', empty($context['preview_message']) ? '<br>' : $context['preview_message'], '
 				</div>
-			</div><br />';
+			</div><br>';
 
 	if ($context['make_event'] && (!$context['event']['new'] || !empty($context['current_board'])))
 		echo '
-			<input type="hidden" name="eventid" value="', $context['event']['id'], '" />';
+			<input type="hidden" name="eventid" value="', $context['event']['id'], '">';
 
 	// Start the main table.
 	echo '
 			<div class="cat_bar">
 				<h3 class="catbg">', $context['page_title'], '</h3>
 			</div>
-			<div>
-				<span class="upperframe"><span></span></span>
+			<div id="post_area">
 				<div class="roundframe">', isset($context['current_topic']) ? '
-					<input type="hidden" name="topic" value="' . $context['current_topic'] . '" />' : '';
+					<input type="hidden" name="topic" value="' . $context['current_topic'] . '">' : '';
 
 	// If an error occurred, explain what happened.
 	echo '
-					<div class="errorbox"', empty($context['post_error']['messages']) ? ' style="display: none"' : '', ' id="errors">
+					<div class="', empty($context['error_type']) || $context['error_type'] != 'serious' ? 'noticebox' : 'errorbox', '"', empty($context['post_error']) ? ' style="display: none"' : '', ' id="errors">
 						<dl>
 							<dt>
-								<strong style="', empty($context['error_type']) || $context['error_type'] != 'serious' ? 'display: none;' : '', '" id="error_serious">', $txt['error_while_submitting'], '</strong>
-							</dt>
-							<dt class="error" id="error_list">
-								', empty($context['post_error']['messages']) ? '' : implode('<br />', $context['post_error']['messages']), '
+								<strong id="error_serious">', $txt['error_while_submitting'], '</strong>
 							</dt>
+							<dd class="error" id="error_list">
+								', empty($context['post_error']) ? '' : implode('<br>', $context['post_error']), '
+							</dd>
 						</dl>
 					</div>';
 
@@ -158,16 +110,24 @@
 		echo '
 					<p class="information">
 						<em>', $txt['wait_for_approval'], '</em>
-						<input type="hidden" name="not_approved" value="1" />
+						<input type="hidden" name="not_approved" value="1">
 					</p>';
 	}
 
-	// If it's locked, show a message to warn the replyer.
+	// If it's locked, show a message to warn the replier.
+	if (!empty($context['locked']))
 	echo '
-					<p class="information"', $context['locked'] ? '' : ' style="display: none"', ' id="lock_warning">
+					<p class="errorbox">
 						', $txt['topic_locked_no_reply'], '
 					</p>';
 
+	if (!empty($modSettings['drafts_post_enabled']))
+		echo '
+					<div id="draft_section" class="infobox"', isset($context['draft_saved']) ? '' : ' style="display: none;"', '>',
+						sprintf($txt['draft_saved'], $scripturl . '?action=profile;u=' . $context['user']['id'] . ';area=showdrafts'), '
+						', (!empty($modSettings['drafts_keep_days']) ? ' <strong>' . sprintf($txt['draft_save_warning'], $modSettings['drafts_keep_days']) . '</strong>' : ''), '
+					</div>';
+
 	// The post header... important stuff
 	echo '
 					<dl id="post_header">';
@@ -180,7 +140,7 @@
 							<span', isset($context['post_error']['long_name']) || isset($context['post_error']['no_name']) || isset($context['post_error']['bad_name']) ? ' class="error"' : '', ' id="caption_guestname">', $txt['name'], ':</span>
 						</dt>
 						<dd>
-							<input type="text" name="guestname" size="25" value="', $context['name'], '" tabindex="', $context['tabindex']++, '" class="input_text" />
+							<input type="text" name="guestname" size="25" value="', $context['name'], '" tabindex="', $context['tabindex']++, '" class="input_text">
 						</dd>';
 
 		if (empty($modSettings['guest_post_no_email']))
@@ -189,17 +149,17 @@
 							<span', isset($context['post_error']['no_email']) || isset($context['post_error']['bad_email']) ? ' class="error"' : '', ' id="caption_email">', $txt['email'], ':</span>
 						</dt>
 						<dd>
-							<input type="text" name="email" size="25" value="', $context['email'], '" tabindex="', $context['tabindex']++, '" class="input_text" />
+							<input type="email" name="email" size="25" value="', $context['email'], '" tabindex="', $context['tabindex']++, '" class="input_text" required>
 						</dd>';
 	}
 
 	// Now show the subject box for this post.
 	echo '
-						<dt>
+						<dt class="clear">
 							<span', isset($context['post_error']['no_subject']) ? ' class="error"' : '', ' id="caption_subject">', $txt['subject'], ':</span>
 						</dt>
 						<dd>
-							<input type="text" name="subject"', $context['subject'] == '' ? '' : ' value="' . $context['subject'] . '"', ' tabindex="', $context['tabindex']++, '" size="80" maxlength="80" class="input_text" />
+							<input type="text" name="subject"', $context['subject'] == '' ? '' : ' value="' . $context['subject'] . '"', ' tabindex="', $context['tabindex']++, '" size="80" maxlength="80"', isset($context['post_error']['no_subject']) ? ' class="error"' : ' class="input_text"', ' required>
 						</dd>
 						<dt class="clear_left">
 							', $txt['message_icon'], ':
@@ -210,30 +170,31 @@
 	// Loop through each message icon allowed, adding it to the drop down list.
 	foreach ($context['icons'] as $icon)
 		echo '
-								<option value="', $icon['value'], '"', $icon['value'] == $context['icon'] ? ' selected="selected"' : '', '>', $icon['name'], '</option>';
+								<option value="', $icon['value'], '"', $icon['value'] == $context['icon'] ? ' selected' : '', '>', $icon['name'], '</option>';
 
 	echo '
 							</select>
-							<img src="', $context['icon_url'], '" name="icons" hspace="15" alt="" />
+							<img src="', $context['icon_url'], '" id="icons" alt="">
 						</dd>
-					</dl><hr class="clear" />';
+					</dl>';
 
 	// Are you posting a calendar event?
 	if ($context['make_event'])
 	{
 		echo '
+					<hr class="clear">
 					<div id="post_event">
 						<fieldset id="event_main">
 							<legend><span', isset($context['post_error']['no_event']) ? ' class="error"' : '', ' id="caption_evtitle">', $txt['calendar_event_title'], '</span></legend>
-							<input type="text" name="evtitle" maxlength="255" size="60" value="', $context['event']['title'], '" tabindex="', $context['tabindex']++, '" class="input_text" />
-							<div class="smalltext">
-								<input type="hidden" name="calendar" value="1" />', $txt['calendar_year'], '
+							<input type="text" name="evtitle" maxlength="255" size="55" value="', $context['event']['title'], '" tabindex="', $context['tabindex']++, '" class="input_text">
+							<div class="smalltext" style="white-space: nowrap;">
+								<input type="hidden" name="calendar" value="1">', $txt['calendar_year'], '
 								<select name="year" id="year" tabindex="', $context['tabindex']++, '" onchange="generateDays();">';
 
 		// Show a list of all the years we allow...
 		for ($year = $modSettings['cal_minyear']; $year <= $modSettings['cal_maxyear']; $year++)
 			echo '
-									<option value="', $year, '"', $year == $context['event']['year'] ? ' selected="selected"' : '', '>', $year, '&nbsp;</option>';
+									<option value="', $year, '"', $year == $context['event']['year'] ? ' selected' : '', '>', $year, '&nbsp;</option>';
 
 		echo '
 								</select>
@@ -243,7 +204,7 @@
 		// There are 12 months per year - ensure that they all get listed.
 		for ($month = 1; $month <= 12; $month++)
 			echo '
-									<option value="', $month, '"', $month == $context['event']['month'] ? ' selected="selected"' : '', '>', $txt['months'][$month], '&nbsp;</option>';
+									<option value="', $month, '"', $month == $context['event']['month'] ? ' selected' : '', '>', $txt['months'][$month], '&nbsp;</option>';
 
 		echo '
 								</select>
@@ -253,7 +214,7 @@
 		// This prints out all the days in the current month - this changes dynamically as we switch months.
 		for ($day = 1; $day <= $context['event']['last_day']; $day++)
 			echo '
-									<option value="', $day, '"', $day == $context['event']['day'] ? ' selected="selected"' : '', '>', $day, '&nbsp;</option>';
+									<option value="', $day, '"', $day == $context['event']['day'] ? ' selected' : '', '>', $day, '&nbsp;</option>';
 
 		echo '
 								</select>
@@ -278,7 +239,7 @@
 
 				for ($days = 1; $days <= $modSettings['cal_maxspan']; $days++)
 					echo '
-											<option value="', $days, '"', $days == $context['event']['span'] ? ' selected="selected"' : '', '>', $days, '&nbsp;</option>';
+											<option value="', $days, '"', $days == $context['event']['span'] ? ' selected' : '', '>', $days, '&nbsp;</option>';
 
 				echo '
 										</select>
@@ -298,7 +259,7 @@
 											<optgroup label="', $category['name'], '">';
 					foreach ($category['boards'] as $board)
 						echo '
-												<option value="', $board['id'], '"', $board['selected'] ? ' selected="selected"' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level'] - 1) . '=&gt;' : '', ' ', $board['name'], '&nbsp;</option>';
+												<option value="', $board['id'], '"', $board['selected'] ? ' selected' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level'] - 1) . '=&gt;' : '', ' ', $board['name'], '&nbsp;</option>';
 					echo '
 											</optgroup>';
 				}
@@ -321,10 +282,11 @@
 	if ($context['make_poll'])
 	{
 		echo '
+					<hr class="clear">
 					<div id="edit_poll">
 						<fieldset id="poll_main">
 							<legend><span ', (isset($context['poll_error']['no_question']) ? ' class="error"' : ''), '>', $txt['poll_question'], '</span></legend>
-							<input type="text" name="question" value="', isset($context['question']) ? $context['question'] : '', '" tabindex="', $context['tabindex']++, '" size="80" class="input_text" />
+							<input type="text" name="question" value="', isset($context['question']) ? $context['question'] : '', '" tabindex="', $context['tabindex']++, '" size="80" class="input_text">
 							<ul class="poll_main">';
 
 		// Loop through all the choices and print them out.
@@ -333,7 +295,7 @@
 			echo '
 								<li>
 									<label for="options-', $choice['id'], '">', $txt['option'], ' ', $choice['number'], '</label>:
-									<input type="text" name="options[', $choice['id'], ']" id="options-', $choice['id'], '" value="', $choice['label'], '" tabindex="', $context['tabindex']++, '" size="80" maxlength="255" class="input_text" />
+									<input type="text" name="options[', $choice['id'], ']" id="options-', $choice['id'], '" value="', $choice['label'], '" tabindex="', $context['tabindex']++, '" size="80" maxlength="255" class="input_text">
 								</li>';
 		}
 
@@ -349,20 +311,20 @@
 									<label for="poll_max_votes">', $txt['poll_max_votes'], ':</label>
 								</dt>
 								<dd>
-									<input type="text" name="poll_max_votes" id="poll_max_votes" size="2" value="', $context['poll_options']['max_votes'], '" class="input_text" />
+									<input type="text" name="poll_max_votes" id="poll_max_votes" size="2" value="', $context['poll_options']['max_votes'], '" class="input_text">
 								</dd>
 								<dt>
-									<label for="poll_expire">', $txt['poll_run'], ':</label><br />
+									<label for="poll_expire">', $txt['poll_run'], ':</label><br>
 									<em class="smalltext">', $txt['poll_run_limit'], '</em>
 								</dt>
 								<dd>
-									<input type="text" name="poll_expire" id="poll_expire" size="2" value="', $context['poll_options']['expire'], '" onchange="pollOptions();" maxlength="4" class="input_text" /> ', $txt['days_word'], '
+									<input type="text" name="poll_expire" id="poll_expire" size="2" value="', $context['poll_options']['expire'], '" onchange="pollOptions();" maxlength="4" class="input_text"> ', $txt['days_word'], '
 								</dd>
 								<dt>
 									<label for="poll_change_vote">', $txt['poll_do_change_vote'], ':</label>
 								</dt>
 								<dd>
-									<input type="checkbox" id="poll_change_vote" name="poll_change_vote"', !empty($context['poll']['change_vote']) ? ' checked="checked"' : '', ' class="input_check" />
+									<input type="checkbox" id="poll_change_vote" name="poll_change_vote"', !empty($context['poll']['change_vote']) ? ' checked' : '', ' class="input_check">
 								</dd>';
 
 		if ($context['poll_options']['guest_vote_enabled'])
@@ -371,7 +333,7 @@
 									<label for="poll_guest_vote">', $txt['poll_guest_vote'], ':</label>
 								</dt>
 								<dd>
-									<input type="checkbox" id="poll_guest_vote" name="poll_guest_vote"', !empty($context['poll_options']['guest_vote']) ? ' checked="checked"' : '', ' class="input_check" />
+									<input type="checkbox" id="poll_guest_vote" name="poll_guest_vote"', !empty($context['poll_options']['guest_vote']) ? ' checked' : '', ' class="input_check">
 								</dd>';
 
 		echo '
@@ -379,9 +341,9 @@
 									', $txt['poll_results_visibility'], ':
 								</dt>
 								<dd>
-									<input type="radio" name="poll_hide" id="poll_results_anyone" value="0"', $context['poll_options']['hide'] == 0 ? ' checked="checked"' : '', ' class="input_radio" /> <label for="poll_results_anyone">', $txt['poll_results_anyone'], '</label><br />
-									<input type="radio" name="poll_hide" id="poll_results_voted" value="1"', $context['poll_options']['hide'] == 1 ? ' checked="checked"' : '', ' class="input_radio" /> <label for="poll_results_voted">', $txt['poll_results_voted'], '</label><br />
-									<input type="radio" name="poll_hide" id="poll_results_expire" value="2"', $context['poll_options']['hide'] == 2 ? ' checked="checked"' : '', empty($context['poll_options']['expire']) ? 'disabled="disabled"' : '', ' class="input_radio" /> <label for="poll_results_expire">', $txt['poll_results_after'], '</label>
+									<input type="radio" name="poll_hide" id="poll_results_anyone" value="0"', $context['poll_options']['hide'] == 0 ? ' checked' : '', ' class="input_radio"> <label for="poll_results_anyone">', $txt['poll_results_anyone'], '</label><br>
+									<input type="radio" name="poll_hide" id="poll_results_voted" value="1"', $context['poll_options']['hide'] == 1 ? ' checked' : '', ' class="input_radio"> <label for="poll_results_voted">', $txt['poll_results_voted'], '</label><br>
+									<input type="radio" name="poll_hide" id="poll_results_expire" value="2"', $context['poll_options']['hide'] == 2 ? ' checked' : '', empty($context['poll_options']['expire']) ? ' disabled' : '', ' class="input_radio"> <label for="poll_results_expire">', $txt['poll_results_after'], '</label>
 								</dd>
 							</dl>
 						</fieldset>
@@ -389,123 +351,174 @@
 	}
 
 	// Show the actual posting area...
-	if ($context['show_bbc'])
-	{
-		echo '
-					<div id="bbcBox_message"></div>';
-	}
-
-	// What about smileys?
-	if (!empty($context['smileys']['postform']) || !empty($context['smileys']['popup']))
-		echo '
-					<div id="smileyBox_message"></div>';
-
 	echo '
 					', template_control_richedit($context['post_box_name'], 'smileyBox_message', 'bbcBox_message');
 
+	// If we're editing and displaying edit details, show a box where they can say why
+	if (isset($context['editing']) && $modSettings['show_modify'])
+		echo '
+					<dl>
+						<dt class="clear">
+							<span id="caption_edit_reason">', $txt['reason_for_edit'], ':</span>
+						</dt>
+						<dd>
+							<input type="text" name="modify_reason"', isset($context['last_modified_reason']) ? ' value="' . $context['last_modified_reason'] . '"' : '', ' tabindex="', $context['tabindex']++, '" size="80" maxlength="80" class="input_text">
+						</dd>
+					</dl>';
+
 	// If this message has been edited in the past - display when it was.
 	if (isset($context['last_modified']))
 		echo '
 					<div class="padding smalltext">
-						<strong>', $txt['last_edit'], ':</strong>
-						', $context['last_modified'], '
+						', $context['last_modified_text'], '
 					</div>';
 
 	// If the admin has enabled the hiding of the additional options - show a link and image for it.
-	if (!empty($settings['additional_options_collapsable']))
+	if (!empty($modSettings['additional_options_collapsable']))
 		echo '
 					<div id="postAdditionalOptionsHeader">
-						<img src="', $settings['images_url'], '/collapse.gif" alt="-" id="postMoreExpand" style="display: none;" /> <strong><a href="#" id="postMoreExpandLink">', $txt['post_additionalopt'], '</a></strong>
+						<strong><a href="#" id="postMoreExpandLink"> ', $context['can_post_attachment'] ? $txt['post_additionalopt_attach'] : $txt['post_additionalopt'], '</a></strong>
 					</div>';
 
+	echo '
+					<div id="postAdditionalOptions">';
+
 	// Display the check boxes for all the standard options - if they are available to the user!
 	echo '
-					<div id="postMoreOptions" class="smalltext">
-						<ul class="post_options">
-							', $context['can_notify'] ? '<li><input type="hidden" name="notify" value="0" /><label for="check_notify"><input type="checkbox" name="notify" id="check_notify"' . ($context['notify'] || !empty($options['auto_notify']) ? ' checked="checked"' : '') . ' value="1" class="input_check" /> ' . $txt['notify_replies'] . '</label></li>' : '', '
-							', $context['can_lock'] ? '<li><input type="hidden" name="lock" value="0" /><label for="check_lock"><input type="checkbox" name="lock" id="check_lock"' . ($context['locked'] ? ' checked="checked"' : '') . ' value="1" class="input_check" /> ' . $txt['lock_topic'] . '</label></li>' : '', '
-							<li><label for="check_back"><input type="checkbox" name="goback" id="check_back"' . ($context['back_to_topic'] || !empty($options['return_to_post']) ? ' checked="checked"' : '') . ' value="1" class="input_check" /> ' . $txt['back_to_topic'] . '</label></li>
-							', $context['can_sticky'] ? '<li><input type="hidden" name="sticky" value="0" /><label for="check_sticky"><input type="checkbox" name="sticky" id="check_sticky"' . ($context['sticky'] ? ' checked="checked"' : '') . ' value="1" class="input_check" /> ' . $txt['sticky_after'] . '</label></li>' : '', '
-							<li><label for="check_smileys"><input type="checkbox" name="ns" id="check_smileys"', $context['use_smileys'] ? '' : ' checked="checked"', ' value="NS" class="input_check" /> ', $txt['dont_use_smileys'], '</label></li>', '
-							', $context['can_move'] ? '<li><input type="hidden" name="move" value="0" /><label for="check_move"><input type="checkbox" name="move" id="check_move" value="1" class="input_check" ' . (!empty($context['move']) ? 'checked="checked" ' : '') . '/> ' . $txt['move_after2'] . '</label></li>' : '', '
-							', $context['can_announce'] && $context['is_first_post'] ? '<li><label for="check_announce"><input type="checkbox" name="announce_topic" id="check_announce" value="1" class="input_check" ' . (!empty($context['announce']) ? 'checked="checked" ' : '') . '/> ' . $txt['announce_topic'] . '</label></li>' : '', '
-							', $context['show_approval'] ? '<li><label for="approve"><input type="checkbox" name="approve" id="approve" value="2" class="input_check" ' . ($context['show_approval'] === 2 ? 'checked="checked"' : '') . ' /> ' . $txt['approve_this_post'] . '</label></li>' : '', '
-						</ul>
-					</div>';
+						<div id="postMoreOptions" class="smalltext">
+							<ul class="post_options">
+								', $context['can_notify'] ? '<li><input type="hidden" name="notify" value="0"><label for="check_notify"><input type="checkbox" name="notify" id="check_notify"' . ($context['notify'] || !empty($options['auto_notify']) || $context['auto_notify'] ? ' checked' : '') . ' value="1" class="input_check"> ' . $txt['notify_replies'] . '</label></li>' : '', '
+								', $context['can_lock'] ? '<li><input type="hidden" name="already_locked" value="' . $context['already_locked'] . '"><input type="hidden" name="lock" value="0"><label for="check_lock"><input type="checkbox" name="lock" id="check_lock"' . ($context['locked'] ? ' checked' : '') . ' value="1" class="input_check"> ' . $txt['lock_topic'] . '</label></li>' : '', '
+								<li><label for="check_back"><input type="checkbox" name="goback" id="check_back"' . ($context['back_to_topic'] || !empty($options['return_to_post']) ? ' checked' : '') . ' value="1" class="input_check"> ' . $txt['back_to_topic'] . '</label></li>
+								', $context['can_sticky'] ? '<li><input type="hidden" name="already_sticky" value="' . $context['already_sticky'] . '"><input type="hidden" name="sticky" value="0"><label for="check_sticky"><input type="checkbox" name="sticky" id="check_sticky"' . ($context['sticky'] ? ' checked' : '') . ' value="1" class="input_check"> ' . $txt['sticky_after'] . '</label></li>' : '', '
+								<li><label for="check_smileys"><input type="checkbox" name="ns" id="check_smileys"', $context['use_smileys'] ? '' : ' checked', ' value="NS" class="input_check"> ', $txt['dont_use_smileys'], '</label></li>', '
+								', $context['can_move'] ? '<li><input type="hidden" name="move" value="0"><label for="check_move"><input type="checkbox" name="move" id="check_move" value="1" class="input_check"' . (!empty($context['move']) ? ' checked" ' : '') . '> ' . $txt['move_after2'] . '</label></li>' : '', '
+								', $context['can_announce'] && $context['is_first_post'] ? '<li><label for="check_announce"><input type="checkbox" name="announce_topic" id="check_announce" value="1" class="input_check"' . (!empty($context['announce']) ? ' checked' : '') . '> ' . $txt['announce_topic'] . '</label></li>' : '', '
+								', $context['show_approval'] ? '<li><label for="approve"><input type="checkbox" name="approve" id="approve" value="2" class="input_check"' . ($context['show_approval'] === 2 ? ' checked' : '') . '> ' . $txt['approve_this_post'] . '</label></li>' : '', '
+							</ul>
+						</div>';
 
 	// If this post already has attachments on it - give information about them.
 	if (!empty($context['current_attachments']))
 	{
 		echo '
-					<dl id="postAttachment">
-						<dt>
-							', $txt['attached'], ':
-						</dt>
-						<dd class="smalltext">
-							<input type="hidden" name="attach_del[]" value="0" />
-							', $txt['uncheck_unwatchd_attach'], ':
-						</dd>';
+						<dl id="postAttachment">
+							<dt>
+								', $txt['attached'], ':
+							</dt>
+							<dd class="smalltext" style="width: 100%;">
+								<input type="hidden" name="attach_del[]" value="0">
+								', $txt['uncheck_unwatchd_attach'], ':
+							</dd>';
 		foreach ($context['current_attachments'] as $attachment)
 			echo '
-						<dd class="smalltext">
-							<label for="attachment_', $attachment['id'], '"><input type="checkbox" id="attachment_', $attachment['id'], '" name="attach_del[]" value="', $attachment['id'], '"', empty($attachment['unchecked']) ? ' checked="checked"' : '', ' class="input_check" /> ', $attachment['name'], (empty($attachment['approved']) ? ' (' . $txt['awaiting_approval'] . ')' : ''), '</label>
-						</dd>';
+							<dd class="smalltext">
+								<label for="attachment_', $attachment['id'], '"><input type="checkbox" id="attachment_', $attachment['id'], '" name="attach_del[]" value="', $attachment['id'], '"', empty($attachment['unchecked']) ? ' checked' : '', ' class="input_check"> ', $attachment['name'], (empty($attachment['approved']) ? ' (' . $txt['awaiting_approval'] . ')' : ''),
+								!empty($modSettings['attachmentPostLimit']) || !empty($modSettings['attachmentSizeLimit']) ? sprintf($txt['attach_kb'], comma_format(round(max($attachment['size'], 1028) / 1028), 0)) : '', '</label>
+							</dd>';
+
 		echo '
-					</dl>';
+						</dl>';
+
+		if (!empty($context['files_in_session_warning']))
+			echo '
+						<div class="smalltext">', $context['files_in_session_warning'], '</div>';
 	}
 
 	// Is the user allowed to post any additional ones? If so give them the boxes to do it!
 	if ($context['can_post_attachment'])
 	{
 		echo '
-					<dl id="postAttachment2">
-						<dt>
-							', $txt['attach'], ':
-						</dt>
-						<dd class="smalltext">
-							<input type="file" size="60" name="attachment[]" id="attachment1" class="input_file" /> (<a href="javascript:void(0);" onclick="cleanFileInput(\'attachment1\');">', $txt['clean_attach'], '</a>)';
+						<dl id="postAttachment2">';
 
-		// Show more boxes only if they aren't approaching their limit.
-		if ($context['num_allowed_attachments'] > 1)
+		// But, only show them if they haven't reached a limit. Or a mod author hasn't hidden them.
+		if ($context['num_allowed_attachments'] > 0 || !empty($context['dont_show_them']))
+		{
 			echo '
-							<script type="text/javascript"><!-- // --><![CDATA[
-								var allowed_attachments = ', $context['num_allowed_attachments'], ';
-								var current_attachment = 1;
-
-								function addAttachment()
-								{
-									allowed_attachments = allowed_attachments - 1;
-									current_attachment = current_attachment + 1;
-									if (allowed_attachments <= 0)
-										return alert("', $txt['more_attachments_error'], '");
+							<dt>
+								', $txt['attach'], ':
+							</dt>
+							<dd class="smalltext">
+								', empty($modSettings['attachmentSizeLimit']) ? '' : ('<input type="hidden" name="MAX_FILE_SIZE" value="' . $modSettings['attachmentSizeLimit'] * 1028 . '">'), '
+								<input type="file" multiple="multiple" name="attachment[]" id="attachment1" class="input_file"> (<a href="javascript:void(0);" onclick="cleanFileInput(\'attachment1\');">', $txt['clean_attach'], '</a>)';
 
-									setOuterHTML(document.getElementById("moreAttachments"), \'<dd class="smalltext"><input type="file" size="60" name="attachment[]" id="attachment\' + current_attachment + \'" class="input_file" /> (<a href="javascript:void(0);" onclick="cleanFileInput(\\\'attachment\' + current_attachment + \'\\\');">', $txt['clean_attach'], '</a>)\' + \'</dd><dd class="smalltext" id="moreAttachments"><a href="#" onclick="addAttachment(); return false;">(', $txt['more_attachments'], ')<\' + \'/a><\' + \'/dd>\');
+			// Show more boxes if they aren't approaching that limit.
+			if ($context['num_allowed_attachments'] > 1)
+				echo '
+								<script><!-- // --><![CDATA[
+									var allowed_attachments = ', $context['num_allowed_attachments'], ';
+									var current_attachment = 1;
+
+									function addAttachment()
+									{
+										allowed_attachments = allowed_attachments - 1;
+										current_attachment = current_attachment + 1;
+										if (allowed_attachments <= 0)
+											return alert("', $txt['more_attachments_error'], '");
+
+										setOuterHTML(document.getElementById("moreAttachments"), \'<dd class="smalltext"><input type="file" name="attachment[]" id="attachment\' + current_attachment + \'" class="input_file"> (<a href="javascript:void(0);" onclick="cleanFileInput(\\\'attachment\' + current_attachment + \'\\\');">', $txt['clean_attach'], '<\/a>)\' + \'<\/dd><dd class="smalltext" id="moreAttachments"><a href="#" onclick="addAttachment(); return false;">(', $txt['more_attachments'], ')<\' + \'/a><\' + \'/dd>\');
+
+										return true;
+									}
+								// ]]></script>
+							</dd>
+							<dd class="smalltext" id="moreAttachments"><a href="#" onclick="addAttachment(); return false;">(', $txt['more_attachments'], ')</a></dd>';
+			else
+				echo '
+							</dd>';
+		}
 
-									return true;
-								}
-							// ]]></script>
-						</dd>
-						<dd class="smalltext" id="moreAttachments"><a href="#" onclick="addAttachment(); return false;">(', $txt['more_attachments'], ')</a></dd>';
+		// Add any template changes for an alternative upload system here.
+		call_integration_hook('integrate_upload_template');
 
 		echo '
-						<dd class="smalltext">';
+							<dd class="smalltext">';
 
 		// Show some useful information such as allowed extensions, maximum size and amount of attachments allowed.
 		if (!empty($modSettings['attachmentCheckExtensions']))
 			echo '
-							', $txt['allowed_types'], ': ', $context['allowed_extensions'], '<br />';
+								', $txt['allowed_types'], ': ', $context['allowed_extensions'], '<br>';
 
 		if (!empty($context['attachment_restrictions']))
 			echo '
-							', $txt['attach_restrictions'], ' ', implode(', ', $context['attachment_restrictions']), '<br />';
+								', $txt['attach_restrictions'], ' ', implode(', ', $context['attachment_restrictions']), '<br>';
+
+		if ($context['num_allowed_attachments'] == 0)
+			echo '
+								', $txt['attach_limit_nag'], '<br>';
 
 		if (!$context['can_post_attachment_unapproved'])
 			echo '
-							<span class="alert">', $txt['attachment_requires_approval'], '</span>', '<br />';
+								<span class="alert">', $txt['attachment_requires_approval'], '</span>', '<br>';
 
 		echo '
-						</dd>
-					</dl>';
+							</dd>
+						</dl>';
+	}
+
+		echo '
+					</div>';
+	// If the admin enabled the drafts feature, show a draft selection box
+	if (!empty($modSettings['drafts_post_enabled']) && !empty($context['drafts']) && !empty($options['drafts_show_saved_enabled']))
+	{
+		echo '
+					<div id="postDraftOptionsHeader" class="title_bar title_top">
+						<h4 class="titlebg">
+							<span id="postDraftExpand" class="toggle_up floatright" style="display: none;"></span> <strong><a href="#" id="postDraftExpandLink">', $txt['draft_load'], '</a></strong>
+						</h4>
+					</div>
+					<div id="postDraftOptions">
+						<dl class="settings">
+							<dt><strong>', $txt['subject'], '</strong></dt>
+							<dd><strong>', $txt['draft_saved_on'], '</strong></dd>';
+
+		foreach ($context['drafts'] as $draft)
+			echo '
+							<dt>', $draft['link'], '</dt>
+							<dd>', $draft['poster_time'], '</dd>';
+		echo '
+						</dl>
+					</div>';
 	}
 
 	// Is visual verification enabled?
@@ -522,37 +535,34 @@
 
 	// Finally, the submit buttons.
 	echo '
-					<p class="smalltext" id="shortcuts">
-						', $context['browser']['is_firefox'] ? $txt['shortcuts_firefox'] : $txt['shortcuts'], '
-					</p>
-					<p id="post_confirm_buttons" class="righttext">
+					<br class="clear_right">
+					<span id="post_confirm_buttons">
 						', template_control_richedit_buttons($context['post_box_name']);
 
 	// Option to delete an event if user is editing one.
 	if ($context['make_event'] && !$context['event']['new'])
 		echo '
-						<input type="submit" name="deleteevent" value="', $txt['event_delete'], '" onclick="return confirm(\'', $txt['event_delete_confirm'], '\');" class="button_submit" />';
+						<input type="submit" name="deleteevent" value="', $txt['event_delete'], '" data-confirm="', $txt['event_delete_confirm'] ,'" class="button_submit you_sure">';
 
 	echo '
-					</p>
+					</span>
 				</div>
-				<span class="lowerframe"><span></span></span>
 			</div>
-			<br class="clear" />';
+			<br class="clear">';
 
 	// Assuming this isn't a new topic pass across the last message id.
 	if (isset($context['topic_last_message']))
 		echo '
-			<input type="hidden" name="last_msg" value="', $context['topic_last_message'], '" />';
+			<input type="hidden" name="last_msg" value="', $context['topic_last_message'], '">';
 
 	echo '
-			<input type="hidden" name="additional_options" id="additional_options" value="', $context['show_additional_options'] ? '1' : '0', '" />
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '" />
+			<input type="hidden" name="additional_options" id="additional_options" value="', $context['show_additional_options'] ? '1' : '0', '">
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '">
 		</form>';
 
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[';
+		<script><!-- // --><![CDATA[';
 
 	// The functions used to preview a posts without loading a new page.
 	echo '
@@ -564,7 +574,7 @@
 			var reply_counter = ', empty($counter) ? 0 : $counter, ';
 			function previewPost()
 			{';
-	if ($context['browser']['is_firefox'])
+	if (isBrowser('is_firefox'))
 		echo '
 				// Firefox doesn\'t render <marquee> that have been put it using javascript
 				if (document.forms.postmodify.elements[', JavaScriptEscape($context['post_box_name']), '].value.indexOf(\'[move]\') != -1)
@@ -581,9 +591,9 @@
 						if (!(\'setRequestHeader\' in test))
 							return submitThisOnce(document.forms.postmodify);
 					}
-					// !!! Currently not sending poll options and option checkboxes.
+					// @todo Currently not sending poll options and option checkboxes.
 					var x = new Array();
-					var textFields = [\'subject\', ', JavaScriptEscape($context['post_box_name']), ', \'icon\', \'guestname\', \'email\', \'evtitle\', \'question\', \'topic\'];
+					var textFields = [\'subject\', ', JavaScriptEscape($context['post_box_name']), ', ', JavaScriptEscape($context['session_var']), ', \'icon\', \'guestname\', \'email\', \'evtitle\', \'question\', \'topic\'];
 					var numericFields = [
 						\'board\', \'topic\', \'last_msg\',
 						\'eventid\', \'calendar\', \'year\', \'month\', \'day\',
@@ -597,8 +607,8 @@
 						if (textFields[i] in document.forms.postmodify)
 						{
 							// Handle the WYSIWYG editor.
-							if (textFields[i] == ', JavaScriptEscape($context['post_box_name']), ' && ', JavaScriptEscape('oEditorHandle_' . $context['post_box_name']), ' in window && oEditorHandle_', $context['post_box_name'], '.bRichTextEnabled)
-								x[x.length] = \'message_mode=1&\' + textFields[i] + \'=\' + oEditorHandle_', $context['post_box_name'], '.getText(false).replace(/&#/g, \'&#38;#\').php_to8bit().php_urlencode();
+							if (textFields[i] == ', JavaScriptEscape($context['post_box_name']), ' && $("#', $context['post_box_name'], '").data("sceditor") != undefined)
+								x[x.length] = textFields[i] + \'=\' + $("#', $context['post_box_name'], '").data("sceditor").getText().replace(/&#/g, \'&#38;#\').php_to8bit().php_urlencode();
 							else
 								x[x.length] = textFields[i] + \'=\' + document.forms.postmodify[textFields[i]].value.replace(/&#/g, \'&#38;#\').php_to8bit().php_urlencode();
 						}
@@ -640,7 +650,7 @@
 					bodyText += preview.getElementsByTagName(\'body\')[0].childNodes[i].nodeValue;
 
 				setInnerHTML(document.getElementById(\'preview_body\'), bodyText);
-				document.getElementById(\'preview_body\').className = \'post\';
+				document.getElementById(\'preview_body\').className = \'windowbg\';
 
 				// Show a list of errors (if any).
 				var errors = XMLDoc.getElementsByTagName(\'smf\')[0].getElementsByTagName(\'errors\')[0];
@@ -648,11 +658,9 @@
 				for (var i = 0, numErrors = errors.getElementsByTagName(\'error\').length; i < numErrors; i++)
 					errorList[errorList.length] = errors.getElementsByTagName(\'error\')[i].firstChild.nodeValue;
 				document.getElementById(\'errors\').style.display = numErrors == 0 ? \'none\' : \'\';
-				document.getElementById(\'error_serious\').style.display = errors.getAttribute(\'serious\') == 1 ? \'\' : \'none\';
-				setInnerHTML(document.getElementById(\'error_list\'), numErrors == 0 ? \'\' : errorList.join(\'<br />\'));
-
-				// Show a warning if the topic has been locked.
-				document.getElementById(\'lock_warning\').style.display = errors.getAttribute(\'topic_locked\') == 1 ? \'\' : \'none\';
+				document.getElementById(\'errors\').className = errors.getAttribute(\'serious\') == 1 ? \'errorbox\' : \'noticebox\';
+				document.getElementById(\'error_serious\').style.display = numErrors == 0 ? \'none\' : \'\';
+				setInnerHTML(document.getElementById(\'error_list\'), numErrors == 0 ? \'\' : errorList.join(\'<br>\'));
 
 				// Adjust the color of captions if the given data is erroneous.
 				var captions = errors.getElementsByTagName(\'caption\');
@@ -693,19 +701,19 @@
 						if (newPosts[i].getElementsByTagName("is_ignored")[0].firstChild.nodeValue != 0)
 							ignored_replies[ignored_replies.length] = ignoring = newPosts[i].getAttribute("id");
 
-						newPostsHTML += \'<div class="windowbg\' + (++reply_counter % 2 == 0 ? \'2\' : \'\') + \' core_posts"><span class="topslice"><span></span></span><div class="content" id="msg\' + newPosts[i].getAttribute("id") + \'"><div class="floatleft"><h5>', $txt['posted_by'], ': \' + newPosts[i].getElementsByTagName("poster")[0].firstChild.nodeValue + \'</h5><span class="smalltext">&#171;&nbsp;<strong>', $txt['on'], ':</strong> \' + newPosts[i].getElementsByTagName("time")[0].firstChild.nodeValue + \'&nbsp;&#187;</span> <img src="\' + smf_images_url + \'/', $context['user']['language'], '/new.gif" alt="', $txt['preview_new'], '" id="image_new_\' + newPosts[i].getAttribute("id") + \'" /></div>\';';
+						newPostsHTML += \'<div class="windowbg\' + (++reply_counter % 2 == 0 ? \'2\' : \'\') + \'"><div id="msg\' + newPosts[i].getAttribute("id") + \'"><div class="floatleft"><h5>', $txt['posted_by'], ': \' + newPosts[i].getElementsByTagName("poster")[0].firstChild.nodeValue + \'</h5><span class="smalltext">&#171;&nbsp;<strong>', $txt['on'], ':</strong> \' + newPosts[i].getElementsByTagName("time")[0].firstChild.nodeValue + \'&nbsp;&#187;</span> <span class="new_posts" id="image_new_\' + newPosts[i].getAttribute("id") + \'">', $txt['new'], '</span></div>\';';
 
 	if ($context['can_quote'])
 		echo '
-						newPostsHTML += \'<ul class="reset smalltext quickbuttons" id="msg_\' + newPosts[i].getAttribute("id") + \'_quote"><li class="quote_button"><a href="#postmodify" onclick="return insertQuoteFast(\\\'\' + newPosts[i].getAttribute("id") + \'\\\');"><span>',$txt['bbc_quote'],'</span><\' + \'/a></li></ul>\';';
+						newPostsHTML += \'<ul class="reset smalltext quickbuttons" id="msg_\' + newPosts[i].getAttribute("id") + \'_quote"><li><a href="#postmodify" onclick="return insertQuoteFast(\\\'\' + newPosts[i].getAttribute("id") + \'\\\');" class="quote_button"><span>', $txt['quote'], '</span><\' + \'/a></li></ul>\';';
 
 	echo '
-						newPostsHTML += \'<br class="clear" />\';
+						newPostsHTML += \'<br class="clear">\';
 
 						if (ignoring)
 							newPostsHTML += \'<div id="msg_\' + newPosts[i].getAttribute("id") + \'_ignored_prompt" class="smalltext">', $txt['ignoring_user'], '<a href="#" id="msg_\' + newPosts[i].getAttribute("id") + \'_ignored_link" style="display: none;">', $txt['show_ignore_user_post'], '</a></div>\';
 
-						newPostsHTML += \'<div class="list_posts smalltext" id="msg_\' + newPosts[i].getAttribute("id") + \'_body">\' + newPosts[i].getElementsByTagName("message")[0].firstChild.nodeValue + \'<\' + \'/div></div><span class="botslice"><span></span></span></div>\';
+						newPostsHTML += \'<div class="list_posts smalltext" id="msg_\' + newPosts[i].getAttribute("id") + \'_body">\' + newPosts[i].getElementsByTagName("message")[0].firstChild.nodeValue + \'<\' + \'/div></div></div>\';
 					}
 					setOuterHTML(document.getElementById(\'new_replies\'), newPostsHTML);
 				}
@@ -733,12 +741,14 @@
 					}
 				}
 
+				location.hash = \'#\' + \'preview_section\';
+
 				if (typeof(smf_codeFix) != \'undefined\')
 					smf_codeFix();
 			}';
 
 	// Code for showing and hiding additional options.
-	if (!empty($settings['additional_options_collapsable']))
+	if (!empty($modSettings['additional_options_collapsable']))
 		echo '
 			var oSwapAdditionalOptions = new smc_Toggle({
 				bToggleEnabled: true,
@@ -750,25 +760,45 @@
 					document.getElementById(\'additional_options\').value = \'1\';
 				},
 				aSwappableContainers: [
-					\'postMoreOptions\',
-					\'postAttachment\',
-					\'postAttachment2\',
-					\'postAttachment3\'
+					\'postAdditionalOptions\',
 				],
 				aSwapImages: [
 					{
-						sId: \'postMoreExpand\',
-						srcExpanded: smf_images_url + \'/collapse.gif\',
+						sId: \'postMoreExpandLink\',
 						altExpanded: \'-\',
-						srcCollapsed: smf_images_url + \'/expand.gif\',
 						altCollapsed: \'+\'
 					}
 				],
 				aSwapLinks: [
 					{
 						sId: \'postMoreExpandLink\',
-						msgExpanded: ', JavaScriptEscape($txt['post_additionalopt']), ',
-						msgCollapsed: ', JavaScriptEscape($txt['post_additionalopt']), '
+						msgExpanded: ', JavaScriptEscape($context['can_post_attachment'] ? $txt['post_additionalopt_attach'] : $txt['post_additionalopt']), ',
+						msgCollapsed: ', JavaScriptEscape($context['can_post_attachment'] ? $txt['post_additionalopt_attach'] : $txt['post_additionalopt']), '
+					}
+				]
+			});';
+
+	// Code for showing and hiding drafts
+	if (!empty($context['drafts']))
+		echo '
+			var oSwapDraftOptions = new smc_Toggle({
+				bToggleEnabled: true,
+				bCurrentlyCollapsed: true,
+				aSwappableContainers: [
+					\'postDraftOptions\',
+				],
+				aSwapImages: [
+					{
+						sId: \'postDraftExpand\',
+						altExpanded: \'-\',
+						altCollapsed: \'+\'
+					}
+				],
+				aSwapLinks: [
+					{
+						sId: \'postDraftExpandLink\',
+						msgExpanded: ', JavaScriptEscape($txt['draft_hide']), ',
+						msgCollapsed: ', JavaScriptEscape($txt['draft_load']), '
 					}
 				]
 			});';
@@ -794,24 +824,22 @@
 				$ignored_posts[] = $ignoring = $post['id'];
 
 			echo '
-				<div class="', $post['alternate'] == 0 ? 'windowbg' : 'windowbg2', ' core_posts">
-				<span class="topslice"><span></span></span>
-				<div class="content" id="msg', $post['id'], '">
-					<div class="floatleft">
-						<h5>', $txt['posted_by'], ': ', $post['poster'], '</h5>
-						<span class="smalltext">&#171;&nbsp;<strong>', $txt['on'], ':</strong> ', $post['time'], '&nbsp;&#187;</span>
-					</div>';
+			<div class="windowbg">
+				<div id="msg', $post['id'], '">
+					<h5 class="floatleft">
+						<span>', $txt['posted_by'], '</span>&nbsp;', $post['poster'], '
+					</h5>&nbsp;-&nbsp;', $post['time'];
 
 			if ($context['can_quote'])
 			{
 				echo '
-					<ul class="reset smalltext quickbuttons" id="msg_', $post['id'], '_quote">
-						<li class="quote_button"><a href="#postmodify" onclick="return insertQuoteFast(', $post['id'], ');"><span>',$txt['bbc_quote'],'</span></a></li>
+					<ul class="quickbuttons" id="msg_', $post['id'], '_quote">
+						<li id="post_modify"><a href="#postmodify" onclick="return insertQuoteFast(', $post['id'], ');" class="quote_button">', $txt['quote'], '</a></li>
 					</ul>';
 			}
 
 			echo '
-					<br class="clear" />';
+					<br class="clear">';
 
 			if ($ignoring)
 			{
@@ -825,13 +853,12 @@
 			echo '
 					<div class="list_posts smalltext" id="msg_', $post['id'], '_body">', $post['message'], '</div>
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>';
 		}
 
 		echo '
 		</div>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			var aIgnoreToggles = new Array();';
 
 		foreach ($ignored_posts as $post_id)
@@ -858,17 +885,23 @@
 			function insertQuoteFast(messageid)
 			{
 				if (window.XMLHttpRequest)
-					getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + \'action=quotefast;quote=\' + messageid + \';xml;pb=', $context['post_box_name'], ';mode=\' + (oEditorHandle_', $context['post_box_name'], '.bRichTextEnabled ? 1 : 0), onDocReceived);
+					getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + \'action=quotefast;quote=\' + messageid + \';xml;pb=', $context['post_box_name'], ';mode=0\', onDocReceived);
 				else
-					reqWin(smf_prepareScriptUrl(smf_scripturl) + \'action=quotefast;quote=\' + messageid + \';pb=', $context['post_box_name'], ';mode=\' + (oEditorHandle_', $context['post_box_name'], '.bRichTextEnabled ? 1 : 0), 240, 90);
+					reqWin(smf_prepareScriptUrl(smf_scripturl) + \'action=quotefast;quote=\' + messageid + \';pb=', $context['post_box_name'], ';mode=0\', 240, 90);
+
 				return true;
 			}
 			function onDocReceived(XMLDoc)
 			{
 				var text = \'\';
+
 				for (var i = 0, n = XMLDoc.getElementsByTagName(\'quote\')[0].childNodes.length; i < n; i++)
 					text += XMLDoc.getElementsByTagName(\'quote\')[0].childNodes[i].nodeValue;
-				oEditorHandle_', $context['post_box_name'], '.insertText(text, false, true);
+				$("#', $context['post_box_name'], '").data("sceditor").InsertText(text);
+			}
+			function onReceiveOpener(text)
+			{
+				$("#', $context['post_box_name'], '").data("sceditor").InsertText(text);
 			}
 		// ]]></script>';
 	}
@@ -877,15 +910,15 @@
 // The template for the spellchecker.
 function template_spellcheck()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $settings, $txt, $modSettings;
 
 	// The style information that makes the spellchecker look... like the forum hopefully!
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
+		<meta charset="', $context['character_set'], '">
 		<title>', $txt['spell_check'], '</title>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
-		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index.css" />
+		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index', $context['theme_variant'], '.css', $modSettings['browser_cache'] ,'">
 		<style type="text/css">
 			body, td
 			{
@@ -914,35 +947,35 @@
 	// As you may expect - we need a lot of javascript for this... load it form the separate files.
 	echo '
 		</style>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			var spell_formname = window.opener.spell_formname;
 			var spell_fieldname = window.opener.spell_fieldname;
 		// ]]></script>
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/spellcheck.js"></script>
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/script.js"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script src="', $settings['default_theme_url'], '/scripts/spellcheck.js', $modSettings['browser_cache'] ,'"></script>
+		<script src="', $settings['default_theme_url'], '/scripts/script.js', $modSettings['browser_cache'] ,'"></script>
+		<script><!-- // --><![CDATA[
 			', $context['spell_js'], '
 		// ]]></script>
 	</head>
 	<body onload="nextWord(false);">
 		<form action="#" method="post" accept-charset="', $context['character_set'], '" name="spellingForm" id="spellingForm" onsubmit="return false;" style="margin: 0;">
 			<div id="spellview">&nbsp;</div>
-			<table border="0" cellpadding="4" cellspacing="0" width="100%"><tr class="windowbg">
-				<td width="50%" valign="top">
-					', $txt['spellcheck_change_to'], '<br />
-					<input type="text" name="changeto" style="width: 98%;" class="input_text" />
+			<table width="100%"><tr class="windowbg">
+				<td style="width: 50%; vertical-align: top">
+					', $txt['spellcheck_change_to'], '<br>
+					<input type="text" name="changeto" style="width: 98%;" class="input_text">
 				</td>
-				<td width="50%">
-					', $txt['spellcheck_suggest'], '<br />
+				<td style="width: 50%">
+					', $txt['spellcheck_suggest'], '<br>
 					<select name="suggestions" style="width: 98%;" size="5" onclick="if (this.selectedIndex != -1) this.form.changeto.value = this.options[this.selectedIndex].text;" ondblclick="replaceWord();">
 					</select>
 				</td>
 			</tr></table>
 			<div class="righttext" style="padding: 4px;">
-				<input type="button" name="change" value="', $txt['spellcheck_change'], '" onclick="replaceWord();" class="button_submit" />
-				<input type="button" name="changeall" value="', $txt['spellcheck_change_all'], '" onclick="replaceAll();" class="button_submit" />
-				<input type="button" name="ignore" value="', $txt['spellcheck_ignore'], '" onclick="nextWord(false);" class="button_submit" />
-				<input type="button" name="ignoreall" value="', $txt['spellcheck_ignore_all'], '" onclick="nextWord(true);" class="button_submit" />
+				<input type="button" name="change" value="', $txt['spellcheck_change'], '" onclick="replaceWord();" class="button_submit">
+				<input type="button" name="changeall" value="', $txt['spellcheck_change_all'], '" onclick="replaceAll();" class="button_submit">
+				<input type="button" name="ignore" value="', $txt['spellcheck_ignore'], '" onclick="nextWord(false);" class="button_submit">
+				<input type="button" name="ignoreall" value="', $txt['spellcheck_ignore_all'], '" onclick="nextWord(true);" class="button_submit">
 			</div>
 		</form>
 	</body>
@@ -951,19 +984,19 @@
 
 function template_quotefast()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $settings, $txt, $modSettings;
 
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
+		<meta charset="', $context['character_set'], '">
 		<title>', $txt['retrieving_quote'], '</title>
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/script.js"></script>
+		<script src="', $settings['default_theme_url'], '/scripts/script.js', $modSettings['browser_cache'] ,'"></script>
 	</head>
 	<body>
 		', $txt['retrieving_quote'], '
 		<div id="temporary_posting_area" style="display: none;"></div>
-		<script type="text/javascript"><!-- // --><![CDATA[';
+		<script><!-- // --><![CDATA[';
 
 	if ($context['close_window'])
 		echo '
@@ -989,7 +1022,7 @@
 			if (\'opera\' in window)
 				quote = quote.replace(/&lt;/g, "<").replace(/&gt;/g, ">").replace(/&quot;/g, \'"\').replace(/&amp;/g, "&");
 
-			window.opener.oEditorHandle_', $context['post_box_name'], '.InsertText(quote);
+			window.opener.onReceiveOpener(quote);
 
 			window.focus();
 			setTimeout("window.close();", 400);';
@@ -1002,7 +1035,7 @@
 
 function template_announce()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="announcement">
@@ -1014,67 +1047,66 @@
 				', $txt['announce_desc'], '
 			</div>
 			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>
-						', $txt['announce_this_topic'], ' <a href="', $scripturl, '?topic=', $context['current_topic'], '.0">', $context['topic_subject'], '</a>
-					</p>
-					<ul class="reset">';
+				<p>
+					', $txt['announce_this_topic'], ' <a href="', $scripturl, '?topic=', $context['current_topic'], '.0">', $context['topic_subject'], '</a>
+				</p>
+				<ul class="reset">';
 
 	foreach ($context['groups'] as $group)
 		echo '
-						<li>
-							<label for="who_', $group['id'], '"><input type="checkbox" name="who[', $group['id'], ']" id="who_', $group['id'], '" value="', $group['id'], '" checked="checked" class="input_check" /> ', $group['name'], '</label> <em>(', $group['member_count'], ')</em>
-						</li>';
-
-	echo '
-						<li>
-							<label for="checkall"><input type="checkbox" id="checkall" class="input_check" onclick="invertAll(this, this.form);" checked="checked" /> <em>', $txt['check_all'], '</em></label>
-						</li>
-					</ul>
-					<div id="confirm_buttons">
-						<input type="submit" value="', $txt['post'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="hidden" name="topic" value="', $context['current_topic'], '" />
-						<input type="hidden" name="move" value="', $context['move'], '" />
-						<input type="hidden" name="goback" value="', $context['go_back'], '" />
-					</div>
+					<li>
+						<label for="who_', $group['id'], '"><input type="checkbox" name="who[', $group['id'], ']" id="who_', $group['id'], '" value="', $group['id'], '" checked class="input_check"> ', $group['name'], '</label> <em>(', $group['member_count'], ')</em>
+					</li>';
+
+	echo '
+					<li>
+						<label for="checkall"><input type="checkbox" id="checkall" class="input_check" onclick="invertAll(this, this.form);" checked> <em>', $txt['check_all'], '</em></label>
+					</li>
+				</ul>
+				<hr class="hrcolor">
+				<div id="confirm_buttons">
+					<input type="submit" value="', $txt['post'], '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="topic" value="', $context['current_topic'], '">
+					<input type="hidden" name="move" value="', $context['move'], '">
+					<input type="hidden" name="goback" value="', $context['go_back'], '">
 				</div>
-				<span class="botslice"><span></span></span>
+				<br class="clear_right">
 			</div>
 		</form>
 	</div>
-	<br />';
+	<br>';
 }
 
 function template_announcement_send()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="announcement">
 		<form action="' . $scripturl . '?action=announce;sa=send" method="post" accept-charset="', $context['character_set'], '" name="autoSubmit" id="autoSubmit">
 			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>', $txt['announce_sending'], ' <a href="', $scripturl, '?topic=', $context['current_topic'], '.0" target="_blank" class="new_win">', $context['topic_subject'], '</a></p>
-					<p><strong>', $context['percentage_done'], '% ', $txt['announce_done'], '</strong></p>
-					<div id="confirm_buttons">
-						<input type="submit" name="b" value="', $txt['announce_continue'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="hidden" name="topic" value="', $context['current_topic'], '" />
-						<input type="hidden" name="move" value="', $context['move'], '" />
-						<input type="hidden" name="goback" value="', $context['go_back'], '" />
-						<input type="hidden" name="start" value="', $context['start'], '" />
-						<input type="hidden" name="membergroups" value="', $context['membergroups'], '" />
-					</div>
+				<p>', $txt['announce_sending'], ' <a href="', $scripturl, '?topic=', $context['current_topic'], '.0" target="_blank" class="new_win">', $context['topic_subject'], '</a></p>
+				<div class="progress_bar">
+					<div class="full_bar">', $context['percentage_done'], '% ', $txt['announce_done'], '</div>
+					<div class="green_percent" style="width: ', $context['percentage_done'], '%;">&nbsp;</div>
+				</div>
+				<hr class="hrcolor">
+				<div id="confirm_buttons">
+					<input type="submit" name="b" value="', $txt['announce_continue'], '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="topic" value="', $context['current_topic'], '">
+					<input type="hidden" name="move" value="', $context['move'], '">
+					<input type="hidden" name="goback" value="', $context['go_back'], '">
+					<input type="hidden" name="start" value="', $context['start'], '">
+					<input type="hidden" name="membergroups" value="', $context['membergroups'], '">
 				</div>
-				<span class="botslice"><span></span></span>
+				<br class="clear_right">
 			</div>
 		</form>
 	</div>
-	<br />
-		<script type="text/javascript"><!-- // --><![CDATA[
+	<br>
+		<script><!-- // --><![CDATA[
 			var countdown = 2;
 			doAutoSubmit();
 
diff -ru a/Themes/default/Printpage.template.php b/Themes/default/Printpage.template.php
--- a/Themes/default/Printpage.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Printpage.template.php	2015-03-05 23:30:06.001344647 -0800
@@ -3,130 +3,190 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_print_above()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt, $topic, $scripturl;
 
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	$url_text = $scripturl . '?action=printpage;topic=' . $topic . '.0';
+	$url_images = $url_text . ';images';
+
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
-		<meta name="robots" content="noindex" />
-		<link rel="canonical" href="', $context['canonical_url'], '" />
+		<meta charset="', $context['character_set'], '">
+		<meta name="robots" content="noindex">
+		<link rel="canonical" href="', $context['canonical_url'], '">
 		<title>', $txt['print_page'], ' - ', $context['topic_subject'], '</title>
 		<style type="text/css">
-			body, a
-			{
+			body, a {
 				color: #000;
 				background: #fff;
 			}
-			body, td, .normaltext
-			{
+			body, td, .normaltext {
 				font-family: Verdana, arial, helvetica, serif;
 				font-size: small;
 			}
-			h1#title
-			{
+			h1#title {
 				font-size: large;
 				font-weight: bold;
 			}
-			h2#linktree
-			{
+			h2#linktree {
 				margin: 1em 0 2.5em 0;
 				font-size: small;
 				font-weight: bold;
 			}
-			dl#posts
-			{
+			dl#posts {
 				width: 90%;
 				margin: 0;
 				padding: 0;
 				list-style: none;
 			}
-			dt.postheader
-			{
+			div.postheader, #poll_data {
 				border: solid #000;
 				border-width: 1px 0;
 				padding: 4px 0;
 			}
-			dd.postbody
-			{
+			div.postbody {
 				margin: 1em 0 2em 2em;
 			}
-			table
-			{
+			table {
 				empty-cells: show;
 			}
-			blockquote, code
-			{
+			blockquote, code {
 				border: 1px solid #000;
 				margin: 3px;
 				padding: 1px;
 				display: block;
 			}
-			code
-			{
+			code {
 				font: x-small monospace;
 			}
-			blockquote
-			{
+			blockquote {
 				font-size: x-small;
 			}
-			.smalltext, .quoteheader, .codeheader
-			{
+			.smalltext, .quoteheader, .codeheader {
 				font-size: x-small;
 			}
-			.largetext
-			{
+			.largetext {
 				font-size: large;
 			}
-			.centertext
-			{
+			.centertext {
 				text-align: center;
 			}
-			hr
-			{
+			hr {
 				height: 1px;
 				border: 0;
 				color: black;
 				background-color: black;
 			}
+			.voted {
+				font-weight: bold;
+			}
+			@media print {
+				.print_options {
+					display:none;
+				}
+			}
+			@media screen {
+				.print_options {
+					margin:1em;
+				}
+			}
 		</style>
 	</head>
 	<body>
+		<div class="print_options">';
+
+	// which option is set, text or text&images
+	if (isset($_REQUEST['images']))
+		echo '
+			<a href="', $url_text, '">', $txt['print_page_text'], '</a> | <strong><a href="', $url_images, '">', $txt['print_page_images'], '</a></strong>';
+	else
+		echo '
+			<strong><a href="', $url_text, '">', $txt['print_page_text'], '</a></strong> | <a href="', $url_images, '">', $txt['print_page_images'], '</a>';
+
+	echo '
+		</div>
 		<h1 id="title">', $context['forum_name_html_safe'], '</h1>
 		<h2 id="linktree">', $context['category_name'], ' => ', (!empty($context['parent_boards']) ? implode(' => ', $context['parent_boards']) . ' => ' : ''), $context['board_name'], ' => ', $txt['topic_started'], ': ', $context['poster_name'], ' ', $txt['search_on'], ' ', $context['post_time'], '</h2>
-		<dl id="posts">';
+		<div id="posts">';
 }
 
 function template_main()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $options, $txt, $scripturl, $topic;
+
+	if (!empty($context['poll']))
+	{
+		echo '
+			<div id="poll_data">', $txt['poll'], '
+				<div class="question">', $txt['poll_question'], ': <strong>', $context['poll']['question'], '</strong>';
+
+		$options = 1;
+		foreach ($context['poll']['options'] as $option)
+			echo '
+					<div class="', $option['voted_this'] ? 'voted' : '', '">', $txt['option'], ' ', $options++, ': <strong>', $option['option'], '</strong>
+						', $context['allow_poll_view'] ? $txt['votes'] . ': ' . $option['votes'] . '' : '', '
+					</div>';
+
+		echo '
+			</div>';
+	}
 
 	foreach ($context['posts'] as $post)
+	{
 		echo '
-			<dt class="postheader">
-				', $txt['title'], ': <strong>', $post['subject'], '</strong><br />
+			<div class="postheader">
+				', $txt['title'], ': <strong>', $post['subject'], '</strong><br>
 				', $txt['post_by'], ': <strong>', $post['member'], '</strong> ', $txt['search_on'], ' <strong>', $post['time'], '</strong>
-			</dt>
-			<dd class="postbody">
-				', $post['body'], '
-			</dd>';
+			</div>
+			<div class="postbody">
+				', $post['body'];
+
+		// Show attachment images
+		if (isset($_GET['images']) && !empty($context['printattach'][$post['id_msg']]))
+		{
+			echo '
+				<hr>';
+
+			foreach ($context['printattach'][$post['id_msg']] as $attach)
+				echo '
+					<img width="' . $attach['width'] . '" height="' . $attach['height'] . '" src="', $scripturl . '?action=dlattach;topic=' . $topic . '.0;attach=' . $attach['id_attach'] . '" alt="">';
+		}
+
+		echo '
+			</div>';
+	}
 }
 
 function template_print_below()
 {
-	global $context, $settings, $options;
+	global $topic, $txt, $scripturl;
+
+	$url_text = $scripturl . '?action=printpage;topic=' . $topic . '.0';
+	$url_images = $url_text . ';images';
+
+	echo '
+		</div>
+		<div class="print_options">';
+
+	// Show the text / image links
+	if (isset($_GET['images']))
+		echo '
+			<a href="', $url_text, '">', $txt['print_page_text'], '</a> | <strong><a href="', $url_images, '">', $txt['print_page_images'], '</a></strong>';
+	else
+		echo '
+			<strong><a href="', $url_text, '">', $txt['print_page_text'], '</a></strong> | <a href="', $url_images, '">', $txt['print_page_images'], '</a>';
 
 	echo '
-		</dl>
+		</div>
 		<div id="footer" class="smalltext">
 			', theme_copyright(), '
 		</div>
diff -ru a/Themes/default/Profile.template.php b/Themes/default/Profile.template.php
--- a/Themes/default/Profile.template.php	2011-06-10 03:42:24.000000000 -0700
+++ b/Themes/default/Profile.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,37 +3,33 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Template for the profile side bar - goes before any other profile template.
 function template_profile_above()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
-
-	echo '
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/profile.js"></script>';
+	global $context;
 
 	// Prevent Chrome from auto completing fields when viewing/editing other members profiles
-	if ($context['browser']['is_chrome'] && !$context['user']['is_owner'])
+	if (isBrowser('is_chrome') && !$context['user']['is_owner'])
 		echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		disableAutoComplete();
 	// ]]></script>';
 
 	// If an error occurred while trying to save previously, give the user a clue!
-	if (!empty($context['post_errors']))
-		echo '
+	echo '
 					', template_error_message();
 
 	// If the profile was update successfully, let the user know this.
 	if (!empty($context['profile_updated']))
 		echo '
-					<div class="windowbg" id="profile_success">
+					<div class="infobox">
 						', $context['profile_updated'], '
 					</div>';
 }
@@ -43,167 +39,273 @@
 {
 }
 
+// Template for showing off the spiffy popup of the menu
+function template_profile_popup()
+{
+	global $context, $scripturl;
+
+	// Unlike almost every other template, this is designed to be included into the HTML directly via $().load()
+
+	echo '
+		<div class="profile_user_avatar">
+			<a href="', $scripturl, '?action=profile;u=', $context['user']['id'], '">', $context['member']['avatar']['image'],'</a>
+		</div>
+		<div class="profile_user_info">
+			<span class="profile_username"><a href="', $scripturl, '?action=profile;u=', $context['user']['id'], '">', $context['user']['name'], '</a></span>
+			<span class="profile_group">', $context['member']['group'], '</span>
+		</div>
+		<br class="clear">
+		<div class="profile_user_links">
+			<ol>';
+
+	$menu_context = &$context[$context['profile_menu_name']];
+	foreach ($context['profile_items'] as $item)
+	{
+		$area = &$menu_context['sections'][$item['menu']]['areas'][$item['area']];
+		$item_url = (isset($item['url']) ? $item['url'] : (isset($area['url']) ? $area['url'] : $menu_context['base_url'] . ';area=' . $item['area'])) . $menu_context['extra_parameters'];
+		echo '
+				<li>
+					', $area['icon'], '<a href="', $item_url, '">', !empty($item['title']) ? $item['title'] : $area['label'], '</a>
+				</li>';
+	}
+
+	echo '
+			</ol>
+			<br class="clear">
+		</div>';
+}
+
+function template_alerts_popup()
+{
+	global $context, $txt, $scripturl;
+
+	// Unlike almost every other template, this is designed to be included into the HTML directly via $().load()
+	echo '
+		<div class="alert_bar">
+			<div class="alerts_opts floatright">
+				<a href="' . $scripturl . '?action=profile;area=notification;sa=markread;', $context['session_var'], '=', $context['session_id'], '" onclick="return markAlertsRead(this)">', $txt['mark_alerts_read'], '</a>
+				| <a href="', $scripturl, '?action=profile;area=notification;sa=alerts">', $txt['alert_settings'], '</a>
+			</div>
+			<div class="alerts_box floatleft">
+				<a href="', $scripturl, '?action=profile;area=showalerts">', $txt['all_alerts'], '</a>
+			</div>
+		</div>
+		<div class="alerts_unread">';
+
+	if (empty($context['unread_alerts']))
+	{
+		template_alerts_all_read();
+	}
+	else
+	{
+		foreach ($context['unread_alerts'] as $id_alert => $details)
+		{
+			echo '
+			<div class="unread">
+				<div class="avatar floatleft">', !empty($details['sender']) ? $details['sender']['avatar']['image'] : '', '</div>
+				<div class="details floatleft">
+					', !empty($details['icon']) ? $details['icon'] : '', '<span>', $details['text'], '</span> - ', $details['time'], '
+				</div>
+				<br class="clear">
+			</div>';
+		}
+	}
+
+	echo '
+		</div>
+		<script><!-- // --><![CDATA[
+		function markAlertsRead(obj) {
+			ajax_indicator(true);
+			$.get(
+				obj.href,
+				function(data) {
+					ajax_indicator(false);
+					$("#alerts_menu_top span.amt").remove();
+					$("#alerts_menu div.alerts_unread").html(data);
+				}
+			);
+			return false;
+		}
+		// ]]></script>';
+}
+
+function template_alerts_all_read()
+{
+	global $txt;
+
+	echo '<div class="no_unread">', $txt['alerts_no_unread'], '</div>';
+}
+
 // This template displays users details without any option to edit them.
 function template_summary()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $settings, $scripturl, $modSettings, $txt;
 
 	// Display the basic information about the user
 	echo '
-<div id="profileview" class="flow_auto">
-	<div class="cat_bar">
-		<h3 class="catbg">
-			<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />', $txt['summary'], '</span>
-		</h3>
-	</div>
-	<div id="basicinfo">
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content flow_auto">
-				<div class="username"><h4>', $context['member']['name'], ' <span class="position">', (!empty($context['member']['group']) ? $context['member']['group'] : $context['member']['post_group']), '</span></h4></div>
-				', $context['member']['avatar']['image'], '
-				<ul class="reset">';
+	<div id="profileview" class="roundframe flow_auto">
+		<div id="basicinfo">';
 
-	// What about if we allow email only via the forum??
-	if ($context['member']['show_email'] === 'yes' || $context['member']['show_email'] === 'no_through_forum' || $context['member']['show_email'] === 'yes_permission_override')
+	// Are there any custom profile fields for above the name?
+	if (!empty($context['print_custom_fields']['above_member']))
+	{
 		echo '
-					<li><a href="', $scripturl, '?action=emailuser;sa=email;uid=', $context['member']['id'], '" title="', $context['member']['show_email'] == 'yes' || $context['member']['show_email'] == 'yes_permission_override' ? $context['member']['email'] : '', '" rel="nofollow"><img src="', $settings['images_url'], '/email_sm.gif" alt="', $txt['email'], '" /></a></li>';
+			<div class="custom_fields_above_name">
+				<ul >';
+
+		foreach ($context['print_custom_fields']['above_member'] as $field)
+			if (!empty($field['output_html']))
+				echo '
+					<li>', $field['output_html'], '</li>';
+
+		echo '
+				</ul>
+			</div>
+			<br>';
+	}
+
+	echo '
+			<div class="username clear">
+				<h4>', $context['member']['name'], '<span class="position">', (!empty($context['member']['group']) ? $context['member']['group'] : $context['member']['post_group']), '</span></h4>
+			</div>
+			', $context['member']['avatar']['image'];
+
+	// Are there any custom profile fields for below the avatar?
+	if (!empty($context['print_custom_fields']['below_avatar']))
+	{
+		echo '
+			<div class="custom_fields_below_avatar">
+				<ul >';
+
+		foreach ($context['print_custom_fields']['below_avatar'] as $field)
+			if (!empty($field['output_html']))
+				echo '
+					<li>', $field['output_html'], '</li>';
+
+		echo '
+				</ul>
+			</div>
+			<br>';
+	}
+
+		echo '
+			<ul class="reset clear">';
+	// Email is only visible if it's your profile or you have the moderate_forum permission
+	if ($context['member']['show_email'])
+		echo '
+				<li><a href="mailto:', $context['member']['email'], '" title="', $context['member']['email'], '" rel="nofollow"><span class="generic_icons mail" title="' . $txt['email'] . '"></span></a></li>';
 
 	// Don't show an icon if they haven't specified a website.
 	if ($context['member']['website']['url'] !== '' && !isset($context['disabled_fields']['website']))
 		echo '
-					<li><a href="', $context['member']['website']['url'], '" title="' . $context['member']['website']['title'] . '" target="_blank" class="new_win">', ($settings['use_image_buttons'] ? '<img src="' . $settings['images_url'] . '/www_sm.gif" alt="' . $context['member']['website']['title'] . '" />' : $txt['www']), '</a></li>';
+				<li><a href="', $context['member']['website']['url'], '" title="' . $context['member']['website']['title'] . '" target="_blank" class="new_win">', ($settings['use_image_buttons'] ? '<span class="generic_icons www" title="' . $context['member']['website']['title'] . '"></span>' : $txt['www']), '</a></li>';
 
-	// Are there any custom profile fields for the summary?
-	if (!empty($context['custom_fields']))
+	// Are there any custom profile fields as icons?
+	if (!empty($context['print_custom_fields']['icons']))
 	{
-		foreach ($context['custom_fields'] as $field)
-			if (($field['placement'] == 1 || empty($field['output_html'])) && !empty($field['value']))
+		foreach ($context['print_custom_fields']['icons'] as $field)
+			if (!empty($field['output_html']))
 				echo '
 					<li class="custom_field">', $field['output_html'], '</li>';
 	}
 
 	echo '
-				', !isset($context['disabled_fields']['icq']) && !empty($context['member']['icq']['link']) ? '<li>' . $context['member']['icq']['link'] . '</li>' : '', '
-				', !isset($context['disabled_fields']['msn']) && !empty($context['member']['msn']['link']) ? '<li>' . $context['member']['msn']['link'] . '</li>' : '', '
-				', !isset($context['disabled_fields']['aim']) && !empty($context['member']['aim']['link']) ? '<li>' . $context['member']['aim']['link'] . '</li>' : '', '
-				', !isset($context['disabled_fields']['yim']) && !empty($context['member']['yim']['link']) ? '<li>' . $context['member']['yim']['link'] . '</li>' : '', '
 			</ul>
-			<span id="userstatus">', $context['can_send_pm'] ? '<a href="' . $context['member']['online']['href'] . '" title="' . $context['member']['online']['label'] . '" rel="nofollow">' : '', $settings['use_image_buttons'] ? '<img src="' . $context['member']['online']['image_href'] . '" alt="' . $context['member']['online']['text'] . '" align="middle" />' : $context['member']['online']['text'], $context['can_send_pm'] ? '</a>' : '', $settings['use_image_buttons'] ? '<span class="smalltext"> ' . $context['member']['online']['text'] . '</span>' : '';
+			<span id="userstatus">', $context['can_send_pm'] ? '<a href="' . $context['member']['online']['href'] . '" title="' . $context['member']['online']['text'] . '" rel="nofollow">' : '', $settings['use_image_buttons'] ? '<span class="' . ($context['member']['online']['is_online'] == 1 ? 'on' : 'off') . '" title="' . $context['member']['online']['text'] . '"></span>' : $context['member']['online']['label'], $context['can_send_pm'] ? '</a>' : '', $settings['use_image_buttons'] ? '<span class="smalltext"> ' . $context['member']['online']['label'] . '</span>' : '';
 
 	// Can they add this member as a buddy?
 	if (!empty($context['can_have_buddy']) && !$context['user']['is_owner'])
 		echo '
-				<br /><a href="', $scripturl, '?action=buddy;u=', $context['id_member'], ';', $context['session_var'], '=', $context['session_id'], '">[', $txt['buddy_' . ($context['member']['is_buddy'] ? 'remove' : 'add')], ']</a>';
-
-	echo '
-				</span>';
+				<br><a href="', $scripturl, '?action=buddy;u=', $context['id_member'], ';', $context['session_var'], '=', $context['session_id'], '">[', $txt['buddy_' . ($context['member']['is_buddy'] ? 'remove' : 'add')], ']</a>';
 
 	echo '
-				<p id="infolinks">';
+			</span>';
 
 	if (!$context['user']['is_owner'] && $context['can_send_pm'])
 		echo '
-					<a href="', $scripturl, '?action=pm;sa=send;u=', $context['id_member'], '">', $txt['profile_sendpm_short'], '</a><br />';
-	echo '
-					<a href="', $scripturl, '?action=profile;area=showposts;u=', $context['id_member'], '">', $txt['showPosts'], '</a><br />
-					<a href="', $scripturl, '?action=profile;area=statistics;u=', $context['id_member'], '">', $txt['statPanel'], '</a>
-				</p>';
+			<a href="', $scripturl, '?action=pm;sa=send;u=', $context['id_member'], '" class="infolinks">', $txt['profile_sendpm_short'], '</a>';
 
 	echo '
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-	</div>
-	<div id="detailedinfo">
-		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl>';
+			<a href="', $scripturl, '?action=profile;area=showposts;u=', $context['id_member'], '" class="infolinks">', $txt['showPosts'], '</a>';
 
-	if ($context['user']['is_owner'] || $context['user']['is_admin'])
+	if ($context['user']['is_owner'] && !empty($modSettings['drafts_post_enabled']))
 		echo '
-					<dt>', $txt['username'], ': </dt>
-					<dd>', $context['member']['username'], '</dd>';
+			<a href="', $scripturl, '?action=profile;area=showdrafts;u=', $context['id_member'], '" class="infolinks">', $txt['drafts_show'], '</a>';
 
-	if (!isset($context['disabled_fields']['posts']))
-		echo '
-					<dt>', $txt['profile_posts'], ': </dt>
-					<dd>', $context['member']['posts'], ' (', $context['member']['posts_per_day'], ' ', $txt['posts_per_day'], ')</dd>';
+	echo '
+			<a href="', $scripturl, '?action=profile;area=statistics;u=', $context['id_member'], '" class="infolinks">', $txt['statPanel'], '</a>';
 
-	// Only show the email address fully if it's not hidden - and we reveal the email.
-	if ($context['member']['show_email'] == 'yes')
+	// Are there any custom profile fields for bottom?
+	if (!empty($context['print_custom_fields']['bottom_poster']))
+	{
 		echo '
-					<dt>', $txt['email'], ': </dt>
-					<dd><a href="', $scripturl, '?action=emailuser;sa=email;uid=', $context['member']['id'], '">', $context['member']['email'], '</a></dd>';
+			<div class="custom_fields_bottom">
+				<ul class="reset nolist">';
+
+		foreach ($context['print_custom_fields']['bottom_poster'] as $field)
+			if (!empty($field['output_html']))
+				echo '
+					<li>', $field['output_html'], '</li>';
 
-	// ... Or if the one looking at the profile is an admin they can see it anyway.
-	elseif ($context['member']['show_email'] == 'yes_permission_override')
 		echo '
-					<dt>', $txt['email'], ': </dt>
-					<dd><em><a href="', $scripturl, '?action=emailuser;sa=email;uid=', $context['member']['id'], '">', $context['member']['email'], '</a></em></dd>';
+				</ul>
+			</div>';
+	}
 
-	if (!empty($modSettings['titlesEnable']) && !empty($context['member']['title']))
+	echo '
+		</div>';
+
+	echo '
+		<div id="detailedinfo">
+			<dl>';
+
+	if ($context['user']['is_owner'] || $context['user']['is_admin'])
 		echo '
-					<dt>', $txt['custom_title'], ': </dt>
-					<dd>', $context['member']['title'], '</dd>';
+				<dt>', $txt['username'], ': </dt>
+				<dd>', $context['member']['username'], '</dd>';
 
-	if (!empty($context['member']['blurb']))
+	if (!isset($context['disabled_fields']['posts']))
 		echo '
-					<dt>', $txt['personal_text'], ': </dt>
-					<dd>', $context['member']['blurb'], '</dd>';
+				<dt>', $txt['profile_posts'], ': </dt>
+				<dd>', $context['member']['posts'], ' (', $context['member']['posts_per_day'], ' ', $txt['posts_per_day'], ')</dd>';
 
-	// If karma enabled show the members karma.
-	if ($modSettings['karmaMode'] == '1')
+	if ($context['member']['show_email'])
+	{
 		echo '
-					<dt>', $modSettings['karmaLabel'], ' </dt>
-					<dd>', ($context['member']['karma']['good'] - $context['member']['karma']['bad']), '</dd>';
+				<dt>', $txt['email'], ': </dt>
+				<dd><a href="mailto:', $context['member']['email'], '">', $context['member']['email'], '</a></dd>';
+	}
 
-	elseif ($modSettings['karmaMode'] == '2')
+	if (!empty($modSettings['titlesEnable']) && !empty($context['member']['title']))
 		echo '
-					<dt>', $modSettings['karmaLabel'], ' </dt>
-					<dd>+', $context['member']['karma']['good'], '/-', $context['member']['karma']['bad'], '</dd>';
+				<dt>', $txt['custom_title'], ': </dt>
+				<dd>', $context['member']['title'], '</dd>';
 
-	if (!isset($context['disabled_fields']['gender']) && !empty($context['member']['gender']['name']))
+	if (!empty($context['member']['blurb']))
 		echo '
-					<dt>', $txt['gender'], ': </dt>
-					<dd>', $context['member']['gender']['name'], '</dd>';
+				<dt>', $txt['personal_text'], ': </dt>
+				<dd>', $context['member']['blurb'], '</dd>';
 
 	echo '
-					<dt>', $txt['age'], ':</dt>
-					<dd>', $context['member']['age'] . ($context['member']['today_is_birthday'] ? ' &nbsp; <img src="' . $settings['images_url'] . '/cake.png" alt="" />' : ''), '</dd>';
-
-	if (!isset($context['disabled_fields']['location']) && !empty($context['member']['location']))
-		echo '
-					<dt>', $txt['location'], ':</dt>
-					<dd>', $context['member']['location'], '</dd>';
+				<dt>', $txt['age'], ':</dt>
+				<dd>', $context['member']['age'] . ($context['member']['today_is_birthday'] ? ' &nbsp; <img src="' . $settings['images_url'] . '/cake.png" alt="">' : ''), '</dd>';
 
 	echo '
-				</dl>';
+			</dl>';
 
 	// Any custom fields for standard placement?
-	if (!empty($context['custom_fields']))
+	if (!empty($context['print_custom_fields']['standard']))
 	{
-		$shown = false;
-		foreach ($context['custom_fields'] as $field)
-		{
-			if ($field['placement'] != 0 || empty($field['output_html']))
-				continue;
-
-			if (empty($shown))
-			{
-				echo '
+		echo '
 				<dl>';
-				$shown = true;
-			}
 
-			echo '
+		foreach ($context['print_custom_fields']['standard'] as $field)
+			if (!empty($field['output_html']))
+				echo '
 					<dt>', $field['name'], ':</dt>
 					<dd>', $field['output_html'], '</dd>';
-		}
 
-		if (!empty($shown))
-			echo '
+		echo '
 				</dl>';
 	}
 
@@ -216,7 +318,7 @@
 		echo '
 					<dt>', $txt['profile_warning_level'], ': </dt>
 					<dd>
-						<a href="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=', $context['can_issue_warning'] ? 'issuewarning' : 'viewwarning', '">', $context['member']['warning'], '%</a>';
+						<a href="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=', ($context['can_issue_warning'] && !$context['user']['is_owner'] ? 'issuewarning' : 'viewwarning') , '">', $context['member']['warning'], '%</a>';
 
 		// Can we provide information on what this means?
 		if (!empty($context['warning_status']))
@@ -234,7 +336,7 @@
 		// If the person looking at the summary has permission, and the account isn't activated, give the viewer the ability to do it themselves.
 		if (!empty($context['activate_message']))
 			echo '
-					<dt class="clear"><span class="alert">', $context['activate_message'], '</span>&nbsp;(<a href="' . $scripturl . '?action=profile;save;area=activateaccount;u=' . $context['id_member'] . ';' . $context['session_var'] . '=' . $context['session_id'] . '"', ($context['activate_type'] == 4 ? ' onclick="return confirm(\'' . $txt['profileConfirm'] . '\');"' : ''), '>', $context['activate_link_text'], '</a>)</dt>';
+					<dt class="clear"><span class="alert">', $context['activate_message'], '</span>&nbsp;(<a href="', $context['activate_link'], '"', ($context['activate_type'] == 4 ? ' class="you_sure" data-confirm="'. $txt['profileConfirm'] .'"' : ''), '>', $context['activate_link_text'], '</a>)</dt>';
 
 		// If the current member is banned, show a message and possibly a link to the ban.
 		if (!empty($context['member']['bans']))
@@ -246,7 +348,7 @@
 
 			foreach ($context['member']['bans'] as $ban)
 				echo '
-						<br /><span class="smalltext">', $ban['explanation'], '</span>';
+						<br><span class="smalltext">', $ban['explanation'], '</span>';
 
 			echo '
 					</dt>';
@@ -280,31 +382,27 @@
 					<dt>', $txt['language'], ':</dt>
 					<dd>', $context['member']['language'], '</dd>';
 
-	echo '
+	if ($context['member']['online']['is_online'])
+		echo '
 					<dt>', $txt['lastLoggedIn'], ': </dt>
-					<dd>', $context['member']['last_login'], '</dd>
+					<dd>', $context['member']['last_login'], (!empty($context['member']['is_hidden']) ? ' (' . $txt['hidden'] . ')' : ''), '</dd>';
+
+	echo '
 				</dl>';
 
-	// Are there any custom profile fields for the summary?
-	if (!empty($context['custom_fields']))
+	// Are there any custom profile fields for above the signature?
+	if (!empty($context['print_custom_fields']['above_signature']))
 	{
-		$shown = false;
-		foreach ($context['custom_fields'] as $field)
-		{
-			if ($field['placement'] != 2 || empty($field['output_html']))
-				continue;
-			if (empty($shown))
-			{
-				$shown = true;
-				echo '
+		echo '
 				<div class="custom_fields_above_signature">
 					<ul class="reset nolist">';
-			}
-			echo '
-						<li>', $field['output_html'], '</li>';
-		}
-		if ($shown)
+
+		foreach ($context['print_custom_fields']['above_signature'] as $field)
+			if (!empty($field['output_html']))
 				echo '
+						<li>', $field['output_html'], '</li>';
+
+		echo '
 					</ul>
 				</div>';
 	}
@@ -317,35 +415,43 @@
 					', $context['member']['signature'], '
 				</div>';
 
+	// Are there any custom profile fields for below the signature?
+	if (!empty($context['print_custom_fields']['below_signature']))
+	{
+		echo '
+				<div class="custom_fields_below_signature">
+					<ul class="reset nolist">';
+
+		foreach ($context['print_custom_fields']['below_signature'] as $field)
+			if (!empty($field['output_html']))
+				echo '
+						<li>', $field['output_html'], '</li>';
+
+		echo '
+					</ul>
+				</div>';
+	}
+
 	echo '
-			</div>
-			<span class="botslice"><span></span></span>
 		</div>
 	</div>
-<div class="clear"></div>
-</div>';
+<div class="clear"></div>';
 }
 
 // Template for showing all the posts of the user, in chronological order.
 function template_showPosts()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">
 				', (!isset($context['attachments']) && empty($context['is_topics']) ? $txt['showMessages'] : (!empty($context['is_topics']) ? $txt['showTopics'] : $txt['showAttachments'])), ' - ', $context['member']['name'], '
 			</h3>
-		</div>
+		</div>', !empty($context['page_index']) ? '
 		<div class="pagesection">
-			<span>', $txt['pages'], ': ', $context['page_index'], '</span>
-		</div>';
-
-	// Button shortcuts
-	$quote_button = create_button('quote.gif', 'reply_quote', 'quote', 'align="middle"');
-	$reply_button = create_button('reply_sm.gif', 'reply', 'reply', 'align="middle"');
-	$remove_button = create_button('delete.gif', 'remove_message', 'remove', 'align="middle"');
-	$notify_button = create_button('notify_sm.gif', 'notify_replies', 'notify', 'align="middle"');
+			<div class="pagelinks">' . $context['page_index'] . '</div>
+		</div>' : '';
 
 	// Are we displaying posts or attachments?
 	if (!isset($context['attachments']))
@@ -354,16 +460,13 @@
 		foreach ($context['posts'] as $post)
 		{
 			echo '
-		<div class="topic">
-			<div class="', $post['alternate'] == 0 ? 'windowbg2' : 'windowbg', ' core_posts">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<div class="counter">', $post['counter'], '</div>
-					<div class="topic_details">
-						<h5><strong><a href="', $scripturl, '?board=', $post['board']['id'], '.0">', $post['board']['name'], '</a> / <a href="', $scripturl, '?topic=', $post['topic'], '.', $post['start'], '#msg', $post['id'], '">', $post['subject'], '</a></strong></h5>
-						<span class="smalltext">&#171;&nbsp;<strong>', $txt['on'], ':</strong> ', $post['time'], '&nbsp;&#187;</span>
-					</div>
-					<div class="list_posts">';
+			<div class="windowbg">
+				<div class="counter">', $post['counter'], '</div>
+				<div class="topic_details">
+					<h5><strong><a href="', $scripturl, '?board=', $post['board']['id'], '.0">', $post['board']['name'], '</a> / <a href="', $scripturl, '?topic=', $post['topic'], '.', $post['start'], '#msg', $post['id'], '">', $post['subject'], '</a></strong></h5>
+					<span class="smalltext">', $post['time'], '</span>
+				</div>
+				<div class="list_posts">';
 
 			if (!$post['approved'])
 				echo '
@@ -373,10 +476,9 @@
 
 			echo '
 					', $post['body'], '
-					</div>
 				</div>';
 
-			if ($post['can_reply'] || $post['can_mark_notify'] || $post['can_delete'])
+			if ($post['can_reply'] || $post['can_delete'])
 				echo '
 				<div class="floatright">
 					<ul class="reset smalltext quickbuttons">';
@@ -384,180 +486,277 @@
 			// If they *can* reply?
 			if ($post['can_reply'])
 				echo '
-						<li class="reply_button"><a href="', $scripturl, '?action=post;topic=', $post['topic'], '.', $post['start'], '"><span>', $txt['reply'], '</span></a></li>';
+						<li><a href="', $scripturl, '?action=post;topic=', $post['topic'], '.', $post['start'], '" class="reply_button"><span>', $txt['reply'], '</span></a></li>';
 
 			// If they *can* quote?
 			if ($post['can_quote'])
 				echo '
-						<li class="quote_button"><a href="', $scripturl . '?action=post;topic=', $post['topic'], '.', $post['start'], ';quote=', $post['id'], '"><span>', $txt['quote'], '</span></a></li>';
-
-			// Can we request notification of topics?
-			if ($post['can_mark_notify'])
-				echo '
-						<li class="notify_button"><a href="', $scripturl, '?action=notify;topic=', $post['topic'], '.', $post['start'], '"><span>', $txt['notify'], '</span></a></li>';
+						<li><a href="', $scripturl . '?action=post;topic=', $post['topic'], '.', $post['start'], ';quote=', $post['id'], '" class="quote_button"><span>', $txt['quote_action'], '</span></a></li>';
 
 			// How about... even... remove it entirely?!
 			if ($post['can_delete'])
 				echo '
-						<li class="remove_button"><a href="', $scripturl, '?action=deletemsg;msg=', $post['id'], ';topic=', $post['topic'], ';profile;u=', $context['member']['id'], ';start=', $context['start'], ';', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['remove_message'], '?\');"><span>', $txt['remove'], '</span></a></li>';
+						<li><a href="', $scripturl, '?action=deletemsg;msg=', $post['id'], ';topic=', $post['topic'], ';profile;u=', $context['member']['id'], ';start=', $context['start'], ';', $context['session_var'], '=', $context['session_id'], '" data-confirm="', $txt['remove_message'] ,'" class="remove_button you_sure"><span>', $txt['remove'], '</span></a></li>';
 
-			if ($post['can_reply'] || $post['can_mark_notify'] || $post['can_delete'])
+			if ($post['can_reply'] || $post['can_delete'])
 				echo '
 					</ul>
 				</div>';
 
 			echo '
-				<br class="clear" />
-				<span class="botslice"><span></span></span>
-			</div>
-		</div>';
+			</div>';
 		}
 	}
 	else
+		template_show_list('attachments');
+
+	// No posts? Just end with a informative message.
+	if ((isset($context['attachments']) && empty($context['attachments'])) || (!isset($context['attachments']) && empty($context['posts'])))
+		echo '
+			<div class="windowbg2">
+				', isset($context['attachments']) ? $txt['show_attachments_none'] : ($context['is_topics'] ? $txt['show_topics_none'] : $txt['show_posts_none']), '
+			</div>
+		</div>';
+
+	// Show more page numbers.
+	if (!empty($context['page_index']))
+		echo '
+		<div class="pagesection">
+			<div class="pagelinks">', $context['page_index'], '</div>
+		</div>';
+}
+
+function template_showAlerts()
+{
+	global $context, $txt, $scripturl;
+
+	// Do we have an update message?
+	if (!empty($context['update_message']))
+		echo '
+		<div class="infobox">
+			', $context['update_message'], '.
+		</div>';
+
+	echo '
+		<div class="cat_bar">
+			<h3 class="catbg">
+			', $txt['alerts'], ' - ', $context['member']['name'], '
+			</h3>
+		</div>';
+
+	if (empty($context['alerts']))
+		echo '
+		<div class="information">
+			', $txt['alerts_none'], '
+		</div>';
+
+	else
 	{
+		// Start the form.
 		echo '
-		<table border="0" width="100%" cellspacing="1" cellpadding="2" class="table_grid" align="center">
-			<thead>
-				<tr class="titlebg">
-					<th class="first_th lefttext" scope="col" width="25%">
-						<a href="', $scripturl, '?action=profile;u=', $context['current_member'], ';area=showposts;sa=attach;sort=filename', ($context['sort_direction'] == 'down' && $context['sort_order'] == 'filename' ? ';asc' : ''), '">
-							', $txt['show_attach_filename'], '
-							', ($context['sort_order'] == 'filename' ? '<img src="' . $settings['images_url'] . '/sort_' . ($context['sort_direction'] == 'down' ? 'down' : 'up') . '.gif" alt="" />' : ''), '
-						</a>
-					</th>
-					<th scope="col" width="12%">
-						<a href="', $scripturl, '?action=profile;u=', $context['current_member'], ';area=showposts;sa=attach;sort=downloads', ($context['sort_direction'] == 'down' && $context['sort_order'] == 'downloads' ? ';asc' : ''), '">
-							', $txt['show_attach_downloads'], '
-							', ($context['sort_order'] == 'downloads' ? '<img src="' . $settings['images_url'] . '/sort_' . ($context['sort_direction'] == 'down' ? 'down' : 'up') . '.gif" alt="" />' : ''), '
-						</a>
-					</th>
-					<th class="lefttext" scope="col" width="30%">
-						<a href="', $scripturl, '?action=profile;u=', $context['current_member'], ';area=showposts;sa=attach;sort=subject', ($context['sort_direction'] == 'down' && $context['sort_order'] == 'subject' ? ';asc' : ''), '">
-							', $txt['message'], '
-							', ($context['sort_order'] == 'subject' ? '<img src="' . $settings['images_url'] . '/sort_' . ($context['sort_direction'] == 'down' ? 'down' : 'up') . '.gif" alt="" />' : ''), '
-						</a>
-					</th>
-					<th class="last_th lefttext" scope="col">
-						<a href="', $scripturl, '?action=profile;u=', $context['current_member'], ';area=showposts;sa=attach;sort=posted', ($context['sort_direction'] == 'down' && $context['sort_order'] == 'posted' ? ';asc' : ''), '">
-						', $txt['show_attach_posted'], '
-						', ($context['sort_order'] == 'posted' ? '<img src="' . $settings['images_url'] . '/sort_' . ($context['sort_direction'] == 'down' ? 'down' : 'up') . '.gif" alt="" />' : ''), '
-						</a>
-					</th>
-				</tr>
-			</thead>
-			<tbody>';
+		<form action="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=showalerts;save" method="post" accept-charset="', $context['character_set'], '" id="mark_all">
+			<table id="alerts" class="table_grid">';
 
-		// Looks like we need to do all the attachments instead!
-		$alternate = false;
-		foreach ($context['attachments'] as $attachment)
+		foreach ($context['alerts'] as $id => $alert)
 		{
 			echo '
-				<tr class="', $attachment['approved'] ? ($alternate ? 'windowbg' : 'windowbg2') : 'approvebg', '">
-					<td><a href="', $scripturl, '?action=dlattach;topic=', $attachment['topic'], '.0;attach=', $attachment['id'], '">', $attachment['filename'], '</a>', !$attachment['approved'] ? '&nbsp;<em>(' . $txt['awaiting_approval'] . ')</em>' : '', '</td>
-					<td align="center">', $attachment['downloads'], '</td>
-					<td><a href="', $scripturl, '?topic=', $attachment['topic'], '.msg', $attachment['msg'], '#msg', $attachment['msg'], '" rel="nofollow">', $attachment['subject'], '</a></td>
-					<td>', $attachment['posted'], '</td>
+				<tr class="windowbg">
+					<td>', $alert['text'], '</td>
+					<td>', $alert['time'], '</td>
+					<td>
+						<ul class="quickbuttons">
+							<li><a href="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=showalerts;do=remove;aid= ', $id ,';', $context['session_var'], '=', $context['session_id'], '" class="remove_button you_sure">', $txt['delete'] ,'</a></li>
+							<li><a href="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=showalerts;do=', ($alert['is_read'] != 0 ? 'unread' : 'read') ,';aid= ', $id ,';', $context['session_var'], '=', $context['session_id'], '" class="', $alert['is_read'] != 0 ? 'unread_button' : 'read_button','">', ($alert['is_read'] != 0 ? $txt['mark_unread'] : $txt['mark_read_short']),'</a></li>
+							<li><input type="checkbox" name="mark[', $id ,']" value="', $id ,'"></li>
+						</ul>
+					</td>
 				</tr>';
-			$alternate = !$alternate;
 		}
 
-	// No posts? Just end the table with a informative message.
-	if ((isset($context['attachments']) && empty($context['attachments'])) || (!isset($context['attachments']) && empty($context['posts'])))
 		echo '
-				<tr>
-					<td class="tborder windowbg2 padding centertext" colspan="4">
-						', isset($context['attachments']) ? $txt['show_attachments_none'] : ($context['is_topics'] ? $txt['show_topics_none'] : $txt['show_posts_none']), '
-					</td>
-				</tr>';
+			</table>
+			<div class="pagesection">
+				<div class="floatleft">
+					', $context['pagination'] ,'
+				</div>
+				<div class="floatright">
+					', $txt['check_all'] ,': <input type="checkbox" name="select_all" id="select_all">
+					<select name="mark_as">
+						<option value="read">', $txt['quick_mod_markread'] ,'</option>
+						<option value="unread">', $txt['quick_mod_markunread'] ,'</option>
+						<option value="remove">', $txt['quick_mod_remove'] ,'</option>
+					</select>
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="submit" name="req" value="', $txt['quick_mod_go'] ,'" class="button_submit you_sure">
+				</div>
+			</div>
+		</form>';
+	}
+}
 
+// Template for showing all the drafts of the user.
+function template_showDrafts()
+{
+	global $context, $scripturl, $txt;
+
+	echo '
+		<div class="cat_bar">
+			<h3 class="catbg">
+				', $txt['drafts'], ' - ', $context['member']['name'], '
+			</h3>
+		</div>', !empty($context['page_index']) ? '
+		<div class="pagesection">
+			<div class="pagelinks">' . $context['page_index'] . '</div>
+		</div>' : '';
+
+	// No drafts? Just show an informative message.
+	if (empty($context['drafts']))
 		echo '
-			</tbody>
-		</table>';
+		<div class="tborder windowbg2 padding centertext">
+			', $txt['draft_none'], '
+		</div>';
+	else
+	{
+		// For every draft to be displayed, give it its own div, and show the important details of the draft.
+		foreach ($context['drafts'] as $draft)
+		{
+			echo '
+				<div class="windowbg">
+					<div class="counter">', $draft['counter'], '</div>
+					<div class="topic_details">
+						<h5><strong><a href="', $scripturl, '?board=', $draft['board']['id'], '.0">', $draft['board']['name'], '</a> / ', $draft['topic']['link'], '</strong> &nbsp; &nbsp;';
+
+			if (!empty($draft['sticky']))
+				echo '<span class="generic_icons sticky" title="', $txt['sticky_topic'], '"></span>';
+
+			if (!empty($draft['locked']))
+				echo '<span class="generic_icons lock" title="', $txt['locked_topic'], '"></span>';
+
+			echo '
+						</h5>
+						<span class="smalltext">&#171;&nbsp;<strong>', $txt['on'], ':</strong> ', $draft['time'], '&nbsp;&#187;</span>
+					</div>
+					<div class="list_posts">
+						', $draft['body'], '
+					</div>
+				<div class="floatright">
+					<ul class="reset smalltext quickbuttons">
+						<li><a href="', $scripturl, '?action=post;', (empty($draft['topic']['id']) ? 'board=' . $draft['board']['id'] : 'topic=' . $draft['topic']['id']), '.0;id_draft=', $draft['id_draft'], '" class="reply_button"><span>', $txt['draft_edit'], '</span></a></li>
+						<li><a href="', $scripturl, '?action=profile;u=', $context['member']['id'], ';area=showdrafts;delete=', $draft['id_draft'], ';', $context['session_var'], '=', $context['session_id'], '" data-confirm="', $txt['draft_remove'] ,'" class="remove_button you_sure"><span>', $txt['draft_delete'], '</span></a></li>
+					</ul>
+				</div>
+			</div>';
+		}
 	}
-	// Show more page numbers.
+
+	// Show page numbers.
 	echo '
-		<div class="pagesection" style="margin-bottom: 0;">
-			<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+		<div class="pagesection">
+			<div class="pagelinks">', $context['page_index'], '</div>
 		</div>';
 }
 
 // Template for showing all the buddies of the current user.
 function template_editBuddies()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $scripturl, $txt;
+
+	if (!empty($context['saved_successful']))
+		echo '
+					<div class="infobox">', $context['user']['is_owner'] ? $txt['profile_updated_own'] : sprintf($txt['profile_updated_else'], $context['member']['name']), '</div>';
+	elseif (!empty($context['saved_failed']))
+		echo '
+					<div class="errorbox">', $context['saved_failed'], '</div>';
 
 	echo '
-		<div class="title_bar">
-			<h3 class="titlebg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/online.gif" alt="" class="icon" />', $txt['editBuddies'], '</span>
+	<div id="edit_buddies">
+		<div class="cat_bar">
+			<h3 class="catbg">
+				<span class="generic_icons people icon"></span> ', $txt['editBuddies'], '
 			</h3>
 		</div>
-		<table border="0" width="100%" cellspacing="1" cellpadding="4" class="table_grid" align="center">
-			<tr class="catbg">
-				<th class="first_th lefttext" scope="col" width="20%">', $txt['name'], '</th>
-				<th scope="col">', $txt['status'], '</th>
-				<th scope="col">', $txt['email'], '</th>
-				<th scope="col">', $txt['icq'], '</th>
-				<th scope="col">', $txt['aim'], '</th>
-				<th scope="col">', $txt['yim'], '</th>
-				<th scope="col">', $txt['msn'], '</th>
-				<th class="last_th" scope="col"></th>
+		<table class="table_grid">
+			<tr class="title_bar">
+				<th scope="col" width="15%">', $txt['name'], '</th>
+				<th scope="col">', $txt['status'], '</th>';
+
+	if (allowedTo('moderate_forum'))
+		echo '
+				<th scope="col">', $txt['email'], '</th>';
+
+	if (!empty($context['custom_pf']))
+		foreach ($context['custom_pf'] as $column)
+				echo '<th scope="col">', $column['label'], '</th>';
+
+	echo '
+				<th scope="col">', $txt['remove'], '</th>
 			</tr>';
 
 	// If they don't have any buddies don't list them!
 	if (empty($context['buddies']))
 		echo '
-			<tr class="windowbg2">
-				<td colspan="8" align="center"><strong>', $txt['no_buddies'], '</strong></td>
+			<tr class="windowbg">
+				<td colspan="10"><strong>', $txt['no_buddies'], '</strong></td>
 			</tr>';
 
-	// Now loop through each buddy showing info on each.
-	$alternate = false;
-	foreach ($context['buddies'] as $buddy)
+		// Now loop through each buddy showing info on each.
+	else
 	{
-		echo '
-			<tr class="', $alternate ? 'windowbg' : 'windowbg2', '">
-				<td>', $buddy['link'], '</td>
-				<td align="center"><a href="', $buddy['online']['href'], '"><img src="', $buddy['online']['image_href'], '" alt="', $buddy['online']['label'], '" title="', $buddy['online']['label'], '" /></a></td>
-				<td align="center">', ($buddy['show_email'] == 'no' ? '' : '<a href="' . $scripturl . '?action=emailuser;sa=email;uid=' . $buddy['id'] . '" rel="nofollow"><img src="' . $settings['images_url'] . '/email_sm.gif" alt="' . $txt['email'] . '" title="' . $txt['email'] . ' ' . $buddy['name'] . '" /></a>'), '</td>
-				<td align="center">', $buddy['icq']['link'], '</td>
-				<td align="center">', $buddy['aim']['link'], '</td>
-				<td align="center">', $buddy['yim']['link'], '</td>
-				<td align="center">', $buddy['msn']['link'], '</td>
-				<td align="center"><a href="', $scripturl, '?action=profile;area=lists;sa=buddies;u=', $context['id_member'], ';remove=', $buddy['id'], ';', $context['session_var'], '=', $context['session_id'], '"><img src="', $settings['images_url'], '/icons/delete.gif" alt="', $txt['buddy_remove'], '" title="', $txt['buddy_remove'], '" /></a></td>
-			</tr>';
+		foreach ($context['buddies'] as $buddy)
+		{
+			echo '
+				<tr class="windowbg">
+					<td>', $buddy['link'], '</td>
+					<td><a href="', $buddy['online']['href'], '"><span class="' . ($buddy['online']['is_online'] == 1 ? 'on' : 'off') . '" title="' . $buddy['online']['text'] . '"></span></a></td>';
 
-		$alternate = !$alternate;
+			if ($buddy['show_email'])
+				echo '
+					<td><a href="mailto:' . $buddy['email'] . '" rel="nofollow"><span class="generic_icons mail icon" title="' . $txt['email'] . ' ' . $buddy['name'] . '"></span></a></td>';
+
+			// Show the custom profile fields for this user.
+			if (!empty($context['custom_pf']))
+				foreach ($context['custom_pf'] as $key => $column)
+					echo '
+						<td class="lefttext">', $buddy['options'][$key], '</td>';
+
+			echo '
+					<td><a href="', $scripturl, '?action=profile;area=lists;sa=buddies;u=', $context['id_member'], ';remove=', $buddy['id'], ';', $context['session_var'], '=', $context['session_id'], '"><span class="generic_icons delete" title="', $txt['buddy_remove'], '"></span></a></td>
+				</tr>';
+		}
 	}
 
 	echo '
-		</table>';
+		</table>
+	</div>';
 
 	// Add a new buddy?
 	echo '
-	<br />
 	<form action="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=lists;sa=buddies" method="post" accept-charset="', $context['character_set'], '">
-		<div class="tborder add_buddy">
-			<div class="title_bar">
-				<h3 class="titlebg">', $txt['buddy_add'], '</h3>
-			</div>
-			<span class="upperframe"><span></span></span>
-			<div class="roundframe">
-					<label for="new_buddy">
-						<strong>', $txt['who_member'], ':</strong>
-					</label>
-					<input type="text" name="new_buddy" id="new_buddy" size="25" class="input_text" />
-					<input type="submit" value="', $txt['buddy_add_button'], '" class="button_submit" />
-			</div>
-			<span class="lowerframe"><span></span></span>
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['buddy_add'], '</h3>
 		</div>
+		<dl class="settings windowbg">
+			<dt>
+				<label for="new_buddy"><strong>', $txt['who_member'], ':</strong></label>
+			</dt>
+			<dd>
+				<input type="text" name="new_buddy" id="new_buddy" size="30" class="input_text">
+				<input type="submit" value="', $txt['buddy_add_button'], '" class="button_submit floatnone">
+			</dd>
+		</dl>';
+
+	if (!empty($context['token_check']))
+		echo '
+			<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">';
+
+	echo '
+		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 	</form>
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var oAddBuddySuggest = new smc_AutoSuggest({
 			sSelf: \'oAddBuddySuggest\',
-			sSessionId: \'', $context['session_id'], '\',
-			sSessionVar: \'', $context['session_var'], '\',
+			sSessionId: smf_session_id,
+			sSessionVar: smf_session_var,
 			sSuggestId: \'new_buddy\',
 			sControlId: \'new_buddy\',
 			sSearchType: \'member\',
@@ -570,76 +769,86 @@
 // Template for showing the ignore list of the current user.
 function template_editIgnoreList()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $scripturl, $txt;
+
+	if (!empty($context['saved_successful']))
+		echo '
+					<div class="infobox">', $context['user']['is_owner'] ? $txt['profile_updated_own'] : sprintf($txt['profile_updated_else'], $context['member']['name']), '</div>';
+	elseif (!empty($context['saved_failed']))
+		echo '
+					<div class="errorbox">', $context['saved_failed'], '</div>';
 
 	echo '
-		<div class="title_bar">
-			<h3 class="titlebg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />', $txt['editIgnoreList'], '</span>
+	<div id="edit_buddies">
+		<div class="cat_bar">
+			<h3 class="catbg profile_hd">
+				', $txt['editIgnoreList'], '
 			</h3>
 		</div>
-		<table border="0" width="100%" cellspacing="1" cellpadding="4" class="table_grid" align="center">
-			<tr class="catbg">
-				<th class="first_th" scope="col" width="20%">', $txt['name'], '</th>
-				<th scope="col">', $txt['status'], '</th>
-				<th scope="col">', $txt['email'], '</th>
-				<th scope="col">', $txt['icq'], '</th>
-				<th scope="col">', $txt['aim'], '</th>
-				<th scope="col">', $txt['yim'], '</th>
-				<th scope="col">', $txt['msn'], '</th>
-				<th class="last_th" scope="col"></th>
+		<table class="table_grid">
+			<tr class="title_bar">
+				<th scope="col" width="20%">', $txt['name'], '</th>
+				<th scope="col">', $txt['status'], '</th>';
+
+	if (allowedTo('moderate_forum'))
+		echo '
+				<th scope="col">', $txt['email'], '</th>';
+
+	echo '
+				<th scope="col">', $txt['ignore_remove'] ,'</th>
 			</tr>';
 
 	// If they don't have anyone on their ignore list, don't list it!
 	if (empty($context['ignore_list']))
 		echo '
-			<tr class="windowbg2">
-				<td colspan="8" align="center"><strong>', $txt['no_ignore'], '</strong></td>
+			<tr class="windowbg">
+				<td colspan="8"><strong>', $txt['no_ignore'], '</strong></td>
 			</tr>';
 
 	// Now loop through each buddy showing info on each.
-	$alternate = false;
 	foreach ($context['ignore_list'] as $member)
 	{
 		echo '
-			<tr class="', $alternate ? 'windowbg' : 'windowbg2', '">
+			<tr class="windowbg">
 				<td>', $member['link'], '</td>
-				<td align="center"><a href="', $member['online']['href'], '"><img src="', $member['online']['image_href'], '" alt="', $member['online']['label'], '" title="', $member['online']['label'], '" /></a></td>
-				<td align="center">', ($member['show_email'] == 'no' ? '' : '<a href="' . $scripturl . '?action=emailuser;sa=email;uid=' . $member['id'] . '" rel="nofollow"><img src="' . $settings['images_url'] . '/email_sm.gif" alt="' . $txt['email'] . '" title="' . $txt['email'] . ' ' . $member['name'] . '" /></a>'), '</td>
-				<td align="center">', $member['icq']['link'], '</td>
-				<td align="center">', $member['aim']['link'], '</td>
-				<td align="center">', $member['yim']['link'], '</td>
-				<td align="center">', $member['msn']['link'], '</td>
-				<td align="center"><a href="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=lists;sa=ignore;remove=', $member['id'], ';', $context['session_var'], '=', $context['session_id'], '"><img src="', $settings['images_url'], '/icons/delete.gif" alt="', $txt['ignore_remove'], '" title="', $txt['ignore_remove'], '" /></a></td>
-			</tr>';
+				<td><a href="', $member['online']['href'], '"><span class="' . ($member['online']['is_online'] == 1 ? 'on' : 'off') . '" title="' . $member['online']['text'] . '"></span></a></td>';
 
-		$alternate = !$alternate;
+		if ($member['show_email'])
+			echo '
+				<td><a href="mailto:' . $member['email'] . '" rel="nofollow"><span class="generic_icons mail icon" title="' . $txt['email'] . ' ' . $member['name'] . '"></span></a></td>';
+		echo '
+				<td><a href="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=lists;sa=ignore;remove=', $member['id'], ';', $context['session_var'], '=', $context['session_id'], '"><span class="generic_icons delete" title="', $txt['ignore_remove'], '"></span></a></td>
+			</tr>';
 	}
 
 	echo '
-		</table>';
+		</table>
+	</div>';
 
-	// Add a new buddy?
+	// Add to the ignore list?
 	echo '
-	<br />
 	<form action="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=lists;sa=ignore" method="post" accept-charset="', $context['character_set'], '">
-		<div class="tborder add_buddy">
-			<div class="title_bar">
-				<h3 class="titlebg">', $txt['ignore_add'], '</h3>
-			</div>
-			<span class="upperframe"><span></span></span>
-			<div class="roundframe">
-					<label for="new_buddy">
-						<strong>', $txt['who_member'], ':</strong>
-					</label>
-					<input type="text" name="new_ignore" id="new_ignore" size="25" class="input_text" />
-					<input type="submit" value="', $txt['ignore_add_button'], '" class="button_submit" />
-			</div>
-			<span class="lowerframe"><span></span></span>
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['ignore_add'], '</h3>
 		</div>
+		<dl class="settings windowbg">
+			<dt>
+				<label for="new_buddy"><strong>', $txt['who_member'], ':</strong></label>
+			</dt>
+			<dd>
+				<input type="text" name="new_ignore" id="new_ignore" size="25" class="input_text">
+			</dd>
+		</dl>';
+
+	if (!empty($context['token_check']))
+		echo '
+		<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">';
+
+	echo '
+		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+		<input type="submit" value="', $txt['ignore_add_button'], '" class="button_submit">
 	</form>
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/suggest.js?fin20"></script>
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var oAddIgnoreSuggest = new smc_AutoSuggest({
 			sSelf: \'oAddIgnoreSuggest\',
 			sSessionId: \'', $context['session_id'], '\',
@@ -656,57 +865,53 @@
 // This template shows an admin information on a users IP addresses used and errors attributed to them.
 function template_trackActivity()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	// The first table shows IP information about the user.
 	echo '
-			<div class="title_bar">
-				<h3 class="titlebg"><strong>', $txt['view_ips_by'], ' ', $context['member']['name'], '</strong></h3>
-			</div>';
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['view_ips_by'], ' ', $context['member']['name'], '</h3>
+		</div>';
 
 	// The last IP the user used.
 	echo '
-			<div id="tracking" class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="noborder">
-						<dt>', $txt['most_recent_ip'], ':
-							', (empty($context['last_ip2']) ? '' : '<br />
-							<span class="smalltext">(<a href="' . $scripturl . '?action=helpadmin;help=whytwoip" onclick="return reqWin(this.href);">' . $txt['why_two_ip_address'] . '</a>)</span>'), '
-						</dt>
-						<dd>
-							<a href="', $scripturl, '?action=profile;area=tracking;sa=ip;searchip=', $context['last_ip'], ';u=', $context['member']['id'], '">', $context['last_ip'], '</a>';
+		<div id="tracking" class="windowbg2">
+			<dl class="noborder">
+				<dt>', $txt['most_recent_ip'], ':
+					', (empty($context['last_ip2']) ? '' : '<br>
+					<span class="smalltext">(<a href="' . $scripturl . '?action=helpadmin;help=whytwoip" onclick="return reqOverlayDiv(this.href);">' . $txt['why_two_ip_address'] . '</a>)</span>'), '
+				</dt>
+				<dd>
+					<a href="', $scripturl, '?action=profile;area=tracking;sa=ip;searchip=', $context['last_ip'], ';u=', $context['member']['id'], '">', $context['last_ip'], '</a>';
 
 	// Second address detected?
 	if (!empty($context['last_ip2']))
 		echo '
-							, <a href="', $scripturl, '?action=profile;area=tracking;sa=ip;searchip=', $context['last_ip2'], ';u=', $context['member']['id'], '">', $context['last_ip2'], '</a>';
+					, <a href="', $scripturl, '?action=profile;area=tracking;sa=ip;searchip=', $context['last_ip2'], ';u=', $context['member']['id'], '">', $context['last_ip2'], '</a>';
 
 	echo '
-						</dd>';
+				</dd>';
 
 	// Lists of IP addresses used in messages / error messages.
 	echo '
-						<dt>', $txt['ips_in_messages'], ':</dt>
-						<dd>
-							', (count($context['ips']) > 0 ? implode(', ', $context['ips']) : '(' . $txt['none'] . ')'), '
-						</dd>
-						<dt>', $txt['ips_in_errors'], ':</dt>
-						<dd>
-							', (count($context['ips']) > 0 ? implode(', ', $context['error_ips']) : '(' . $txt['none'] . ')'), '
-						</dd>';
+				<dt>', $txt['ips_in_messages'], ':</dt>
+				<dd>
+					', (count($context['ips']) > 0 ? implode(', ', $context['ips']) : '(' . $txt['none'] . ')'), '
+				</dd>
+				<dt>', $txt['ips_in_errors'], ':</dt>
+				<dd>
+					', (count($context['ips']) > 0 ? implode(', ', $context['error_ips']) : '(' . $txt['none'] . ')'), '
+				</dd>';
 
 	// List any members that have used the same IP addresses as the current member.
 	echo '
-						<dt>', $txt['members_in_range'], ':</dt>
-						<dd>
-							', (count($context['members_in_range']) > 0 ? implode(', ', $context['members_in_range']) : '(' . $txt['none'] . ')'), '
-						</dd>
-					</dl>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-		<br />';
+				<dt>', $txt['members_in_range'], ':</dt>
+				<dd>
+					', (count($context['members_in_range']) > 0 ? implode(', ', $context['members_in_range']) : '(' . $txt['none'] . ')'), '
+				</dd>
+			</dl>
+		</div>
+		<br>';
 
 	// Show the track user list.
 	template_show_list('track_user_list');
@@ -715,47 +920,51 @@
 // The template for trackIP, allowing the admin to see where/who a certain IP has been used.
 function template_trackIP()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $txt;
 
 	// This function always defaults to the last IP used by a member but can be set to track any IP.
 	// The first table in the template gives an input box to allow the admin to enter another IP to track.
 	echo '
+	<div class="tborder">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['trackIP'], '</h3>
 		</div>
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
 			<form action="', $context['base_url'], '" method="post" accept-charset="', $context['character_set'], '">
-				<div class="padding">', $txt['enter_ip'], ':&nbsp;&nbsp;<input type="text" name="searchip" value="', $context['ip'], '" class="input_text" />&nbsp;&nbsp;<input type="submit" value="', $txt['trackIP'], '" class="button_submit" /></div>
+				<dl class="settings">
+					<dt>
+						<label for="searchip"><strong>', $txt['enter_ip'], ':</strong></label>
+					</dt>
+					<dd>
+						<input type="text" name="searchip" value="', $context['ip'], '" class="input_text">
+					</dd>
+				</dl>
+				<input type="submit" value="', $txt['trackIP'], '" class="button_submit">
 			</form>
-			<span class="botslice"><span></span></span>
 		</div>
-		<br />';
+	</div>
+	<br>';
 
 	// The table inbetween the first and second table shows links to the whois server for every region.
 	if ($context['single_ip'])
 	{
 		echo '
-			<div class="title_bar">
-				<h3 class="titlebg">', $txt['whois_title'], ' ', $context['ip'], '</h3>
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['whois_title'], ' ', $context['ip'], '</h3>
 			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="padding">';
+			<div class="windowbg2">';
 			foreach ($context['whois_servers'] as $server)
-				echo '
-					<a href="', $server['url'], '" target="_blank" class="new_win"', isset($context['auto_whois_server']) && $context['auto_whois_server']['name'] == $server['name'] ? ' style="font-weight: bold;"' : '', '>', $server['name'], '</a><br />';
 			echo '
-				</div>
-				<span class="botslice"><span></span></span>
+				<a href="', $server['url'], '" target="_blank" class="new_win"', isset($context['auto_whois_server']) && $context['auto_whois_server']['name'] == $server['name'] ? ' style="font-weight: bold;"' : '', '>', $server['name'], '</a><br>';
+			echo '
 			</div>
-		<br />';
+			<br>';
 	}
 
 	// The second table lists all the members who have been logged as using this IP address.
 	echo '
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['members_from_ip'], ' ', $context['ip'], '</h3>
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['members_from_ip'], ' ', $context['ip'], '</h3>
 		</div>';
 	if (empty($context['ips']))
 		echo '
@@ -763,11 +972,11 @@
 	else
 	{
 		echo '
-		<table class="table_grid" cellspacing="0" width="100%">
+		<table class="table_grid">
 			<thead>
-				<tr class="catbg">
-					<th class="first_th" scope="col">', $txt['ip_address'], '</th>
-					<th class="last_th" scope="col">', $txt['display_name'], '</th>
+				<tr class="title_bar">
+					<th scope="col">', $txt['ip_address'], '</th>
+					<th scope="col">', $txt['display_name'], '</th>
 				</tr>
 			</thead>
 			<tbody>';
@@ -775,44 +984,46 @@
 		// Loop through each of the members and display them.
 		foreach ($context['ips'] as $ip => $memberlist)
 			echo '
-				<tr>
-					<td class="windowbg2"><a href="', $context['base_url'], ';searchip=', $ip, '">', $ip, '</a></td>
-					<td class="windowbg2">', implode(', ', $memberlist), '</td>
+				<tr class="windowbg">
+					<td><a href="', $context['base_url'], ';searchip=', $ip, '">', $ip, '</a></td>
+					<td>', implode(', ', $memberlist), '</td>
 				</tr>';
 
 		echo '
 			</tbody>
-		</table>
-		<br />';
+		</table>';
 	}
 
+	echo '
+	<br>';
+
 	template_show_list('track_message_list');
 
-	echo '<br />';
+	echo '<br>';
 
 	template_show_list('track_user_list');
 }
 
 function template_showPermissions()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<div class="cat_bar">
-			<h3 class="catbg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />', $txt['showPermissions'], '</span>
+			<h3 class="catbg profile_hd">
+				', $txt['showPermissions'], '
 			</h3>
 		</div>';
 
 	if ($context['member']['has_all_permissions'])
 	{
 		echo '
-		<p class="windowbg description">', $txt['showPermissions_all'], '</p>';
+		<p class="information">', $txt['showPermissions_all'], '</p>';
 	}
 	else
 	{
 		echo '
-		<p class="description">',$txt['showPermissions_help'],'</p>
+		<p class="information">',$txt['showPermissions_help'],'</p>
 		<div id="permissions" class="flow_hidden">';
 
 		if (!empty($context['no_access_boards']))
@@ -822,14 +1033,11 @@
 					<h3 class="catbg">', $txt['showPermissions_restricted_boards'], '</h3>
 				</div>
 				<div class="windowbg smalltext">
-					<span class="topslice"><span></span></span>
-					<div class="content">', $txt['showPermissions_restricted_boards_desc'], ':<br />';
+					', $txt['showPermissions_restricted_boards_desc'], ':<br>';
 				foreach ($context['no_access_boards'] as $no_access_board)
 					echo '
 						<a href="', $scripturl, '?board=', $no_access_board['id'], '.0">', $no_access_board['name'], '</a>', $no_access_board['is_last'] ? '' : ', ';
 				echo '
-					</div>
-					<span class="botslice"><span></span></span>
 				</div>';
 		}
 
@@ -842,11 +1050,11 @@
 		if (!empty($context['member']['permissions']['general']))
 		{
 			echo '
-					<table class="table_grid" width="100%" cellspacing="0">
+					<table class="table_grid">
 						<thead>
-							<tr class="titlebg">
-								<th class="lefttext first_th" scope="col" width="50%">', $txt['showPermissions_permission'], '</th>
-								<th class="lefttext last_th" scope="col" width="50%">', $txt['showPermissions_status'], '</th>
+							<tr class="title_bar">
+								<th class="lefttext" scope="col" width="50%">', $txt['showPermissions_permission'], '</th>
+								<th class="lefttext" scope="col" width="50%">', $txt['showPermissions_status'], '</th>
 							</tr>
 						</thead>
 						<tbody>';
@@ -854,11 +1062,11 @@
 			foreach ($context['member']['permissions']['general'] as $permission)
 			{
 				echo '
-							<tr>
-								<td class="windowbg" title="', $permission['id'], '">
+							<tr class="windowbg">
+								<td title="', $permission['id'], '">
 									', $permission['is_denied'] ? '<del>' . $permission['name'] . '</del>' : $permission['name'], '
 								</td>
-								<td class="windowbg2 smalltext">';
+								<td class="smalltext">';
 
 				if ($permission['is_denied'])
 					echo '
@@ -874,7 +1082,7 @@
 			echo '
 						</tbody>
 					</table>
-				</div><br />';
+				</div><br>';
 		}
 		else
 			echo '
@@ -885,43 +1093,43 @@
 			<div class="tborder">
 				<form action="' . $scripturl . '?action=profile;u=', $context['id_member'], ';area=permissions#board_permissions" method="post" accept-charset="', $context['character_set'], '">
 					<div class="cat_bar">
-						<h3 class="catbg"><span class="ie6_header floatleft">
+						<h3 class="catbg">
 							<a id="board_permissions"></a>', $txt['showPermissions_select'], ':
 							<select name="board" onchange="if (this.options[this.selectedIndex].value) this.form.submit();">
-								<option value="0"', $context['board'] == 0 ? ' selected="selected"' : '', '>', $txt['showPermissions_global'], '&nbsp;</option>';
+								<option value="0"', $context['board'] == 0 ? ' selected' : '', '>', $txt['showPermissions_global'], '&nbsp;</option>';
 				if (!empty($context['boards']))
 					echo '
-								<option value="" disabled="disabled">---------------------------</option>';
+								<option value="" disabled>---------------------------</option>';
 
 				// Fill the box with any local permission boards.
 				foreach ($context['boards'] as $board)
 					echo '
-								<option value="', $board['id'], '"', $board['selected'] ? ' selected="selected"' : '', '>', $board['name'], ' (', $board['profile_name'], ')</option>';
+								<option value="', $board['id'], '"', $board['selected'] ? ' selected' : '', '>', $board['name'], ' (', $board['profile_name'], ')</option>';
 
 				echo '
-							</select></span>
+							</select>
 						</h3>
 					</div>
 				</form>';
 		if (!empty($context['member']['permissions']['board']))
 		{
 			echo '
-				<table class="table_grid" width="100%" cellspacing="0">
+				<table class="table_grid">
 					<thead>
-						<tr class="titlebg">
-							<th class="lefttext first_th" scope="col" width="50%">', $txt['showPermissions_permission'], '</th>
-							<th class="lefttext last_th" scope="col" width="50%">', $txt['showPermissions_status'], '</th>
+						<tr class="title_bar">
+							<th class="lefttext" scope="col" width="50%">', $txt['showPermissions_permission'], '</th>
+							<th class="lefttext" scope="col" width="50%">', $txt['showPermissions_status'], '</th>
 						</tr>
 					</thead>
 					<tbody>';
 			foreach ($context['member']['permissions']['board'] as $permission)
 			{
 				echo '
-						<tr>
-							<td class="windowbg" title="', $permission['id'], '">
+						<tr class="windowbg">
+							<td title="', $permission['id'], '">
 								', $permission['is_denied'] ? '<del>' . $permission['name'] . '</del>' : $permission['name'], '
 							</td>
-							<td class="windowbg2 smalltext">';
+							<td class="smalltext">';
 
 				if ($permission['is_denied'])
 				{
@@ -953,188 +1161,160 @@
 // Template for user statistics, showing graphs and the like.
 function template_statPanel()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $txt;
 
 	// First, show a few text statistics such as post/topic count.
 	echo '
-	<div id="profileview">
+	<div id="profileview" class="roundframe">
 		<div id="generalstats">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/stats_info.gif" alt="" class="icon" />
-					', $txt['statPanel_generalStats'], ' - ', $context['member']['name'], '
-					</span>
-				</h3>
-			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl>
-						<dt>', $txt['statPanel_total_time_online'], ':</dt>
-						<dd>', $context['time_logged_in'], '</dd>
-						<dt>', $txt['statPanel_total_posts'], ':</dt>
-						<dd>', $context['num_posts'], ' ', $txt['statPanel_posts'], '</dd>
-						<dt>', $txt['statPanel_total_topics'], ':</dt>
-						<dd>', $context['num_topics'], ' ', $txt['statPanel_topics'], '</dd>
-						<dt>', $txt['statPanel_users_polls'], ':</dt>
-						<dd>', $context['num_polls'], ' ', $txt['statPanel_polls'], '</dd>
-						<dt>', $txt['statPanel_users_votes'], ':</dt>
-						<dd>', $context['num_votes'], ' ', $txt['statPanel_votes'], '</dd>
-					</dl>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
+			<dl class="stats">
+				<dt>', $txt['statPanel_total_time_online'], ':</dt>
+				<dd>', $context['time_logged_in'], '</dd>
+				<dt>', $txt['statPanel_total_posts'], ':</dt>
+				<dd>', $context['num_posts'], ' ', $txt['statPanel_posts'], '</dd>
+				<dt>', $txt['statPanel_total_topics'], ':</dt>
+				<dd>', $context['num_topics'], ' ', $txt['statPanel_topics'], '</dd>
+				<dt>', $txt['statPanel_users_polls'], ':</dt>
+				<dd>', $context['num_polls'], ' ', $txt['statPanel_polls'], '</dd>
+				<dt>', $txt['statPanel_users_votes'], ':</dt>
+				<dd>', $context['num_votes'], ' ', $txt['statPanel_votes'], '</dd>
+			</dl>
 		</div>';
 
 	// This next section draws a graph showing what times of day they post the most.
 	echo '
 		<div id="activitytime" class="flow_hidden">
-			<div class="cat_bar">
-				<h3 class="catbg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/stats_history.gif" alt="" class="icon" />', $txt['statPanel_activityTime'], '</span>
+			<div class="title_bar">
+				<h3 class="titlebg">
+					<span class="generic_icons history"></span> ', $txt['statPanel_activityTime'], '
 				</h3>
-			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">';
+			</div>';
 
 	// If they haven't post at all, don't draw the graph.
 	if (empty($context['posts_by_time']))
 		echo '
-					<span>', $txt['statPanel_noPosts'], '</span>';
+			<span class="centertext">', $txt['statPanel_noPosts'], '</span>';
 	// Otherwise do!
 	else
 	{
 		echo '
-					<ul class="activity_stats flow_hidden">';
+			<ul class="activity_stats flow_hidden">';
 
 		// The labels.
 		foreach ($context['posts_by_time'] as $time_of_day)
 		{
 			echo '
-						<li', $time_of_day['is_last'] ? ' class="last"' : '', '>
-							<div class="bar" style="padding-top: ', ((int) (100 - $time_of_day['relative_percent'])), 'px;" title="', sprintf($txt['statPanel_activityTime_posts'], $time_of_day['posts'], $time_of_day['posts_percent']), '">
-								<div style="height: ', (int) $time_of_day['relative_percent'], 'px;">
-									<span>', sprintf($txt['statPanel_activityTime_posts'], $time_of_day['posts'], $time_of_day['posts_percent']), '</span>
-								</div>
-							</div>
-							<span class="stats_hour">', $time_of_day['hour_format'], '</span>
-						</li>';
+				<li', $time_of_day['is_last'] ? ' class="last"' : '', '>
+					<div class="bar" style="padding-top: ', ((int) (100 - $time_of_day['relative_percent'])), 'px;" title="', sprintf($txt['statPanel_activityTime_posts'], $time_of_day['posts'], $time_of_day['posts_percent']), '">
+						<div style="height: ', (int) $time_of_day['relative_percent'], 'px;">
+							<span>', sprintf($txt['statPanel_activityTime_posts'], $time_of_day['posts'], $time_of_day['posts_percent']), '</span>
+						</div>
+					</div>
+					<span class="stats_hour">', $time_of_day['hour_format'], '</span>
+				</li>';
 		}
 
 		echo '
 
-					</ul>';
+			</ul>';
 	}
 
 	echo '
-					<span class="clear" />
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
+			<span class="clear">
 		</div>';
 
 	// Two columns with the most popular boards by posts and activity (activity = users posts / total posts).
 	echo '
 		<div class="flow_hidden">
-			<div id="popularposts">
-				<div class="cat_bar">
-					<h3 class="catbg">
-						<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/stats_replies.gif" alt="" class="icon" />', $txt['statPanel_topBoards'], '</span>
+			<div class="half_content">
+				<div class="title_bar">
+					<h3 class="titlebg">
+						<span class="generic_icons replies"></span> ', $txt['statPanel_topBoards'], '
 					</h3>
-				</div>
-				<div class="windowbg2">
-					<span class="topslice"><span></span></span>
-					<div class="content">';
+				</div>';
 
 	if (empty($context['popular_boards']))
 		echo '
-						<span>', $txt['statPanel_noPosts'], '</span>';
+				<span class="centertext">', $txt['statPanel_noPosts'], '</span>';
 
 	else
 	{
 		echo '
-						<dl>';
+				<dl class="stats">';
 
 		// Draw a bar for every board.
 		foreach ($context['popular_boards'] as $board)
 		{
 			echo '
-							<dt>', $board['link'], '</dt>
-							<dd>
-								<div class="profile_pie" style="background-position: -', ((int) ($board['posts_percent'] / 5) * 20), 'px 0;" title="', sprintf($txt['statPanel_topBoards_memberposts'], $board['posts'], $board['total_posts_member'], $board['posts_percent']), '">
-									', sprintf($txt['statPanel_topBoards_memberposts'], $board['posts'], $board['total_posts_member'], $board['posts_percent']), '
-								</div>
-								<span>', empty($context['hide_num_posts']) ? $board['posts'] : '', '</span>
-							</dd>';
+					<dt>', $board['link'], '</dt>
+					<dd>
+						<div class="profile_pie" style="background-position: -', ((int) ($board['posts_percent'] / 5) * 20), 'px 0;" title="', sprintf($txt['statPanel_topBoards_memberposts'], $board['posts'], $board['total_posts_member'], $board['posts_percent']), '">
+							', sprintf($txt['statPanel_topBoards_memberposts'], $board['posts'], $board['total_posts_member'], $board['posts_percent']), '
+						</div>
+						', empty($context['hide_num_posts']) ? $board['posts'] : '', '
+					</dd>';
 		}
 
 		echo '
-						</dl>';
+				</dl>';
 	}
 	echo '
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
 			</div>';
 	echo '
-			<div id="popularactivity">
-				<div class="cat_bar">
-					<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/stats_replies.gif" alt="" class="icon" />', $txt['statPanel_topBoardsActivity'], '</span>
+			<div class="half_content">
+				<div class="title_bar">
+					<h3 class="titlebg">
+						<span class="generic_icons replies"></span> ', $txt['statPanel_topBoardsActivity'], '
 					</h3>
-				</div>
-				<div class="windowbg2">
-					<span class="topslice"><span></span></span>
-					<div class="content">';
+				</div>';
 
 	if (empty($context['board_activity']))
 		echo '
-						<span>', $txt['statPanel_noPosts'], '</span>';
+				<span>', $txt['statPanel_noPosts'], '</span>';
 	else
 	{
 		echo '
-						<dl>';
+				<dl class="stats">';
 
 		// Draw a bar for every board.
 		foreach ($context['board_activity'] as $activity)
 		{
 			echo '
-							<dt>', $activity['link'], '</dt>
-							<dd>
-								<div class="profile_pie" style="background-position: -', ((int) ($activity['percent'] / 5) * 20), 'px 0;" title="', sprintf($txt['statPanel_topBoards_posts'], $activity['posts'], $activity['total_posts'], $activity['posts_percent']), '">
-									', sprintf($txt['statPanel_topBoards_posts'], $activity['posts'], $activity['total_posts'], $activity['posts_percent']), '
-								</div>
-								<span>', $activity['percent'], '%</span>
-							</dd>';
+					<dt>', $activity['link'], '</dt>
+					<dd>
+						<div class="profile_pie" style="background-position: -', ((int) ($activity['percent'] / 5) * 20), 'px 0;" title="', sprintf($txt['statPanel_topBoards_posts'], $activity['posts'], $activity['total_posts'], $activity['posts_percent']), '">
+							', sprintf($txt['statPanel_topBoards_posts'], $activity['posts'], $activity['total_posts'], $activity['posts_percent']), '
+						</div>
+						', $activity['percent'], '%
+					</dd>';
 		}
 
 		echo '
-						</dl>';
+				</dl>';
 	}
 	echo '
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
 			</div>
 		</div>';
 
 	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Template for editing profile options.
 function template_edit_options()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $scripturl, $txt, $modSettings;
 
 	// The main header!
+	// because some browsers ignore autocomplete=off and fill username in display name and/ or email field, fake them out.
+	$url = !empty($context['profile_custom_submit_url']) ? $context['profile_custom_submit_url'] : $scripturl . '?action=profile;area=' . $context['menu_item_selected'] . ';u=' . $context['id_member'];
+	$url = $context['require_password'] && !empty($modSettings['force_ssl']) && $modSettings['force_ssl'] < 2 ? strtr($url, array('http://' => 'https://')) : $url;
+
 	echo '
-		<form action="', (!empty($context['profile_custom_submit_url']) ? $context['profile_custom_submit_url'] : $scripturl . '?action=profile;area=' . $context['menu_item_selected'] . ';u=' . $context['id_member'] . ';save'), '" method="post" accept-charset="', $context['character_set'], '" name="creator" id="creator" enctype="multipart/form-data" onsubmit="return checkProfileSubmit();">
+		<form action="', $url, '" method="post" accept-charset="', $context['character_set'], '" name="creator" id="creator" enctype="multipart/form-data"', ($context['menu_item_selected'] == 'account' ? ' autocomplete="off"' : ''), '>
+			<div style="position:absolute; top:-100px;"><input type="text" id="autocompleteFakeName"/><input type="password" id="autocompleteFakePassword"/></div>
 			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />';
+				<h3 class="catbg profile_hd">';
 
 		// Don't say "Profile" if this isn't the profile...
 		if (!empty($context['profile_header_text']))
@@ -1145,28 +1325,25 @@
 					', $txt['profile'];
 
 		echo '
-					</span>
 				</h3>
 			</div>';
 
 	// Have we some description?
 	if ($context['page_desc'])
 		echo '
-			<p class="windowbg description">', $context['page_desc'], '</p>';
+			<p class="information">', $context['page_desc'], '</p>';
 
 	echo '
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">';
+			<div class="roundframe">';
 
 	// Any bits at the start?
 	if (!empty($context['profile_prehtml']))
 		echo '
-					<div>', $context['profile_prehtml'], '</div>';
+				<div>', $context['profile_prehtml'], '</div>';
 
 	if (!empty($context['profile_fields']))
 		echo '
-					<dl>';
+				<dl>';
 
 	// Start the big old loop 'of love.
 	$lastItem = 'hr';
@@ -1180,9 +1357,9 @@
 		if ($field['type'] == 'hr')
 		{
 			echo '
-					</dl>
-					<hr width="100%" size="1" class="hrcolor clear" />
-					<dl>';
+				</dl>
+				<hr width="100%" size="1" class="hrcolor clear">
+				<dl>';
 		}
 		elseif ($field['type'] == 'callback')
 		{
@@ -1195,59 +1372,67 @@
 		else
 		{
 			echo '
-						<dt>
-							<strong', !empty($field['is_error']) ? ' class="error"' : '', '>', $field['label'], '</strong>';
+					<dt>
+						<strong', !empty($field['is_error']) ? ' class="error"' : '', '>', $field['type'] !== 'label' ? '<label for="' . $key . '">' : '', $field['label'], $field['type'] !== 'label' ? '</label>' : '', '</strong>';
 
 			// Does it have any subtext to show?
 			if (!empty($field['subtext']))
 				echo '
-							<br />
-							<span class="smalltext">', $field['subtext'], '</span>';
+						<br>
+						<span class="smalltext">', $field['subtext'], '</span>';
 
 			echo '
-						</dt>
-						<dd>';
+					</dt>
+					<dd>';
 
 			// Want to put something infront of the box?
 			if (!empty($field['preinput']))
 				echo '
-							', $field['preinput'];
+						', $field['preinput'];
 
 			// What type of data are we showing?
 			if ($field['type'] == 'label')
 				echo '
-							', $field['value'];
+						', $field['value'];
 
 			// Maybe it's a text box - very likely!
-			elseif (in_array($field['type'], array('int', 'float', 'text', 'password')))
-				echo '
-							<input type="', $field['type'] == 'password' ? 'password' : 'text', '" name="', $key, '" id="', $key, '" size="', empty($field['size']) ? 30 : $field['size'], '" value="', $field['value'], '" ', $field['input_attr'], ' class="input_', $field['type'] == 'password' ? 'password' : 'text', '" />';
+			elseif (in_array($field['type'], array('int', 'float', 'text', 'password', 'color', 'date', 'datetime', 'datetime-local', 'email', 'month', 'number', 'time', 'url')))
+			{
+				if ($field['type'] == 'int' || $field['type'] == 'float')
+					$type = 'number';
+				else
+					$type = $field['type'];
+				$step = $field['type'] == 'float' ? ' step="0.1"' : '';
 
+
+				echo '
+						<input type="', $type, '" name="', $key, '" id="', $key, '" size="', empty($field['size']) ? 30 : $field['size'], '" value="', $field['value'], '" ', $field['input_attr'], ' class="input_', $field['type'] == 'password' ? 'password' : 'text', '"', $step, '>';
+			}
 			// You "checking" me out? ;)
 			elseif ($field['type'] == 'check')
 				echo '
-							<input type="hidden" name="', $key, '" value="0" /><input type="checkbox" name="', $key, '" id="', $key, '" ', !empty($field['value']) ? ' checked="checked"' : '', ' value="1" class="input_check" ', $field['input_attr'], ' />';
+						<input type="hidden" name="', $key, '" value="0"><input type="checkbox" name="', $key, '" id="', $key, '"', !empty($field['value']) ? ' checked' : '', ' value="1" class="input_check" ', $field['input_attr'], '>';
 
 			// Always fun - select boxes!
 			elseif ($field['type'] == 'select')
 			{
 				echo '
-							<select name="', $key, '" id="', $key, '">';
+						<select name="', $key, '" id="', $key, '">';
 
 				if (isset($field['options']))
 				{
 					// Is this some code to generate the options?
 					if (!is_array($field['options']))
-						$field['options'] = eval($field['options']);
+						$field['options'] = $field['options']();
 					// Assuming we now have some!
 					if (is_array($field['options']))
 						foreach ($field['options'] as $value => $name)
 							echo '
-								<option value="', $value, '" ', $value == $field['value'] ? 'selected="selected"' : '', '>', $name, '</option>';
+								<option value="', $value, '"', $value == $field['value'] ? ' selected' : '', '>', $name, '</option>';
 				}
 
 				echo '
-							</select>';
+						</select>';
 			}
 
 			// Something to end with?
@@ -1256,34 +1441,34 @@
 							', $field['postinput'];
 
 			echo '
-						</dd>';
+					</dd>';
 		}
 	}
 
 	if (!empty($context['profile_fields']))
 		echo '
-					</dl>';
+				</dl>';
 
 	// Are there any custom profile fields - if so print them!
 	if (!empty($context['custom_fields']))
 	{
 		if ($lastItem != 'hr')
 			echo '
-					<hr width="100%" size="1" class="hrcolor clear" />';
+				<hr width="100%" size="1" class="hrcolor clear">';
 
 		echo '
-					<dl>';
+				<dl>';
 
 		foreach ($context['custom_fields'] as $field)
 		{
 			echo '
-						<dt>
-							<strong>', $field['name'], ': </strong><br />
-							<span class="smalltext">', $field['desc'], '</span>
-						</dt>
-						<dd>
-							', $field['input_html'], '
-						</dd>';
+					<dt>
+						<strong>', $field['name'], ': </strong><br>
+						<span class="smalltext">', $field['desc'], '</span>
+					</dt>
+					<dd>
+						', $field['input_html'], '
+					</dd>';
 		}
 
 		echo '
@@ -1294,164 +1479,104 @@
 	// Any closing HTML?
 	if (!empty($context['profile_posthtml']))
 		echo '
-					<div>', $context['profile_posthtml'], '</div>';
-	elseif ($lastItem != 'hr')
-		echo '
-					<hr width="100%" size="1" class="hrcolor clear" />';
+				<div>', $context['profile_posthtml'], '</div>';
 
 	// Only show the password box if it's actually needed.
 	if ($context['require_password'])
 		echo '
-					<dl>
-						<dt>
-							<strong', isset($context['modify_error']['bad_password']) || isset($context['modify_error']['no_password']) ? ' class="error"' : '', '>', $txt['current_password'], ': </strong><br />
-							<span class="smalltext">', $txt['required_security_reasons'], '</span>
-						</dt>
-						<dd>
-							<input type="password" name="oldpasswrd" size="20" style="margin-right: 4ex;" class="input_password" />
-						</dd>
-					</dl>';
-
-	echo '
-					<div class="righttext">';
+				<dl>
+					<dt>
+						<strong', isset($context['modify_error']['bad_password']) || isset($context['modify_error']['no_password']) ? ' class="error"' : '', '><label for="oldpasswrd">', $txt['current_password'], ': </label></strong><br>
+						<span class="smalltext">', $txt['required_security_reasons'], '</span>
+					</dt>
+					<dd>
+						<input type="password" name="oldpasswrd" id="oldpasswrd" size="20" style="margin-right: 4ex;" class="input_password">
+					</dd>
+				</dl>';
 
 	// The button shouldn't say "Change profile" unless we're changing the profile...
 	if (!empty($context['submit_button_text']))
 		echo '
-						<input type="submit" value="', $context['submit_button_text'], '" class="button_submit" />';
+				<input type="submit" name="save" value="', $context['submit_button_text'], '" class="button_submit">';
 	else
 		echo '
-						<input type="submit" value="', $txt['change_profile'], '" class="button_submit" />';
+				<input type="submit" name="save" value="', $txt['change_profile'], '" class="button_submit">';
 
-	echo '
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="hidden" name="u" value="', $context['id_member'], '" />
-						<input type="hidden" name="sa" value="', $context['menu_item_selected'], '" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<br />
-		</form>';
-
-	// Some javascript!
-	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			function checkProfileSubmit()
-			{';
-
-	// If this part requires a password, make sure to give a warning.
-	if ($context['require_password'])
+	if (!empty($context['token_check']))
 		echo '
-				// Did you forget to type your password?
-				if (document.forms.creator.oldpasswrd.value == "")
-				{
-					alert("', $txt['required_security_reasons'], '");
-					return false;
-				}';
-
-	// Any onsubmit javascript?
-	if (!empty($context['profile_onsubmit_javascript']))
-		echo '
-				', $context['profile_javascript'];
-
-	echo '
-			}';
-
-	// Any totally custom stuff?
-	if (!empty($context['profile_javascript']))
-		echo '
-			', $context['profile_javascript'];
+				<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">';
 
 	echo '
-		// ]]></script>';
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="u" value="', $context['id_member'], '">
+				<input type="hidden" name="sa" value="', $context['menu_item_selected'], '">
+			</div>
+		</form>';
 
 	// Any final spellchecking stuff?
 	if (!empty($context['show_spellchecking']))
 		echo '
-		<form name="spell_form" id="spell_form" method="post" accept-charset="', $context['character_set'], '" target="spellWindow" action="', $scripturl, '?action=spellcheck"><input type="hidden" name="spellstring" value="" /></form>';
+		<form name="spell_form" id="spell_form" method="post" accept-charset="', $context['character_set'], '" target="spellWindow" action="', $scripturl, '?action=spellcheck"><input type="hidden" name="spellstring" value=""></form>';
 }
 
 // Personal Message settings.
 function template_profile_pm_settings()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $modSettings, $txt;
 
 	echo '
 								<dt>
-										<label for="pm_prefs">', $txt['pm_display_mode'], ':</label>
+									<label for="pm_prefs">', $txt['pm_display_mode'], ':</label>
 								</dt>
 								<dd>
-										<select name="pm_prefs" id="pm_prefs" onchange="if (this.value == 2 &amp;&amp; !document.getElementById(\'copy_to_outbox\').checked) alert(\'', $txt['pm_recommend_enable_outbox'], '\');">
-											<option value="0"', $context['display_mode'] == 0 ? ' selected="selected"' : '', '>', $txt['pm_display_mode_all'], '</option>
-											<option value="1"', $context['display_mode'] == 1 ? ' selected="selected"' : '', '>', $txt['pm_display_mode_one'], '</option>
-											<option value="2"', $context['display_mode'] == 2 ? ' selected="selected"' : '', '>', $txt['pm_display_mode_linked'], '</option>
-										</select>
+									<select name="pm_prefs" id="pm_prefs">
+										<option value="0"', $context['display_mode'] == 0 ? ' selected' : '', '>', $txt['pm_display_mode_all'], '</option>
+										<option value="1"', $context['display_mode'] == 1 ? ' selected' : '', '>', $txt['pm_display_mode_one'], '</option>
+										<option value="2"', $context['display_mode'] == 2 ? ' selected' : '', '>', $txt['pm_display_mode_linked'], '</option>
+									</select>
 								</dd>
 								<dt>
-										<label for="view_newest_pm_first">', $txt['recent_pms_at_top'], '</label>
+									<label for="view_newest_pm_first">', $txt['recent_pms_at_top'], '</label>
 								</dt>
 								<dd>
-										<input type="hidden" name="default_options[view_newest_pm_first]" value="0" />
-										<input type="checkbox" name="default_options[view_newest_pm_first]" id="view_newest_pm_first" value="1"', !empty($context['member']['options']['view_newest_pm_first']) ? ' checked="checked"' : '', ' class="input_check" />
+										<input type="hidden" name="default_options[view_newest_pm_first]" value="0">
+										<input type="checkbox" name="default_options[view_newest_pm_first]" id="view_newest_pm_first" value="1"', !empty($context['member']['options']['view_newest_pm_first']) ? ' checked' : '', ' class="input_check">
 								</dd>
 						</dl>
-						<hr />
+						<hr>
 						<dl>
 								<dt>
 										<label for="pm_receive_from">', $txt['pm_receive_from'], '</label>
 								</dt>
 								<dd>
 										<select name="pm_receive_from" id="pm_receive_from">
-												<option value="0"', empty($context['receive_from']) || (empty($modSettings['enable_buddylist']) && $context['receive_from'] < 3) ? ' selected="selected"' : '', '>', $txt['pm_receive_from_everyone'], '</option>';
+												<option value="0"', empty($context['receive_from']) || (empty($modSettings['enable_buddylist']) && $context['receive_from'] < 3) ? ' selected' : '', '>', $txt['pm_receive_from_everyone'], '</option>';
 
 	if (!empty($modSettings['enable_buddylist']))
 		echo '
-												<option value="1"', !empty($context['receive_from']) && $context['receive_from'] == 1 ? ' selected="selected"' : '', '>', $txt['pm_receive_from_ignore'], '</option>
-												<option value="2"', !empty($context['receive_from']) && $context['receive_from'] == 2 ? ' selected="selected"' : '', '>', $txt['pm_receive_from_buddies'], '</option>';
-
-	echo '
-												<option value="3"', !empty($context['receive_from']) && $context['receive_from'] > 2 ? ' selected="selected"' : '', '>', $txt['pm_receive_from_admins'], '</option>
-										</select>
-								</dd>
-								<dt>
-										<label for="pm_email_notify">', $txt['email_notify'], '</label>
-								</dt>
-								<dd>
-										<select name="pm_email_notify" id="pm_email_notify">
-												<option value="0"', empty($context['send_email']) ? ' selected="selected"' : '', '>', $txt['email_notify_never'], '</option>
-												<option value="1"', !empty($context['send_email']) && ($context['send_email'] == 1 || (empty($modSettings['enable_buddylist']) && $context['send_email'] > 1)) ? ' selected="selected"' : '', '>', $txt['email_notify_always'], '</option>';
-
-	if (!empty($modSettings['enable_buddylist']))
-		echo '
-												<option value="2"', !empty($context['send_email']) && $context['send_email'] > 1 ? ' selected="selected"' : '', '>', $txt['email_notify_buddies'], '</option>';
+												<option value="1"', !empty($context['receive_from']) && $context['receive_from'] == 1 ? ' selected' : '', '>', $txt['pm_receive_from_ignore'], '</option>
+												<option value="2"', !empty($context['receive_from']) && $context['receive_from'] == 2 ? ' selected' : '', '>', $txt['pm_receive_from_buddies'], '</option>';
 
 	echo '
+												<option value="3"', !empty($context['receive_from']) && $context['receive_from'] > 2 ? ' selected' : '', '>', $txt['pm_receive_from_admins'], '</option>
 										</select>
 								</dd>
 								<dt>
 										<label for="popup_messages">', $txt['popup_messages'], '</label>
 								</dt>
 								<dd>
-										<input type="hidden" name="default_options[popup_messages]" value="0" />
-										<input type="checkbox" name="default_options[popup_messages]" id="popup_messages" value="1"', !empty($context['member']['options']['popup_messages']) ? ' checked="checked"' : '', ' class="input_check" />
+										<input type="hidden" name="default_options[popup_messages]" value="0">
+										<input type="checkbox" name="default_options[popup_messages]" id="popup_messages" value="1"', !empty($context['member']['options']['popup_messages']) ? ' checked' : '', ' class="input_check">
 								</dd>
 						</dl>
-						<hr />
+						<hr>
 						<dl>
 								<dt>
-										<label for="copy_to_outbox"> ', $txt['copy_to_outbox'], '</label>
-								</dt>
-								<dd>
-										<input type="hidden" name="default_options[copy_to_outbox]" value="0" />
-										<input type="checkbox" name="default_options[copy_to_outbox]" id="copy_to_outbox" value="1"', !empty($context['member']['options']['copy_to_outbox']) ? ' checked="checked"' : '', ' class="input_check" />
-								</dd>
-								<dt>
 										<label for="pm_remove_inbox_label">', $txt['pm_remove_inbox_label'], '</label>
 								</dt>
 								<dd>
-										<input type="hidden" name="default_options[pm_remove_inbox_label]" value="0" />
-										<input type="checkbox" name="default_options[pm_remove_inbox_label]" id="pm_remove_inbox_label" value="1"', !empty($context['member']['options']['pm_remove_inbox_label']) ? ' checked="checked"' : '', ' class="input_check" />
+										<input type="hidden" name="default_options[pm_remove_inbox_label]" value="0">
+										<input type="checkbox" name="default_options[pm_remove_inbox_label]" id="pm_remove_inbox_label" value="1"', !empty($context['member']['options']['pm_remove_inbox_label']) ? ' checked' : '', ' class="input_check">
 								</dd>';
 
 }
@@ -1459,196 +1584,343 @@
 // Template for showing theme settings. Note: template_options() actually adds the theme specific options.
 function template_profile_theme_settings()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $modSettings, $txt;
 
-	echo '
-							<dd></dd>
-						</dl>
-						<ul id="theme_settings">
-							<li>
-								<input type="hidden" name="default_options[show_board_desc]" value="0" />
-								<label for="show_board_desc"><input type="checkbox" name="default_options[show_board_desc]" id="show_board_desc" value="1"', !empty($context['member']['options']['show_board_desc']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['board_desc_inside'], '</label>
-							</li>
-							<li>
-								<input type="hidden" name="default_options[show_children]" value="0" />
-								<label for="show_children"><input type="checkbox" name="default_options[show_children]" id="show_children" value="1"', !empty($context['member']['options']['show_children']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['show_children'], '</label>
-							</li>
-							<li>
-								<input type="hidden" name="default_options[use_sidebar_menu]" value="0" />
-								<label for="use_sidebar_menu"><input type="checkbox" name="default_options[use_sidebar_menu]" id="use_sidebar_menu" value="1"', !empty($context['member']['options']['use_sidebar_menu']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['use_sidebar_menu'], '</label>
-							</li>
-							<li>
-								<input type="hidden" name="default_options[show_no_avatars]" value="0" />
-								<label for="show_no_avatars"><input type="checkbox" name="default_options[show_no_avatars]" id="show_no_avatars" value="1"', !empty($context['member']['options']['show_no_avatars']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['show_no_avatars'], '</label>
-							</li>
-							<li>
-								<input type="hidden" name="default_options[show_no_signatures]" value="0" />
-								<label for="show_no_signatures"><input type="checkbox" name="default_options[show_no_signatures]" id="show_no_signatures" value="1"', !empty($context['member']['options']['show_no_signatures']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['show_no_signatures'], '</label>
-							</li>';
+	echo '
+							<dt>
+								<label for="show_children">', $txt['show_children'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[show_children]" value="0">
+								<input type="checkbox" name="default_options[show_children]" id="show_children" value="1"', !empty($context['member']['options']['show_children']) ? ' checked' : '', ' class="input_check">
+							</dd>
+							<dt>
+								<label for="show_no_avatars">', $txt['show_no_avatars'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[show_no_avatars]" value="0">
+								<input type="checkbox" name="default_options[show_no_avatars]" id="show_no_avatars" value="1"', !empty($context['member']['options']['show_no_avatars']) ? ' checked' : '', ' class="input_check">
+							</dd>
+							<dt>
+								<label for="show_no_signatures">', $txt['show_no_signatures'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[show_no_signatures]" value="0">
+								<input type="checkbox" name="default_options[show_no_signatures]" id="show_no_signatures" value="1"', !empty($context['member']['options']['show_no_signatures']) ? ' checked' : '', ' class="input_check">
+							</dd>';
 
-	if ($settings['allow_no_censored'])
+	if (!empty($modSettings['allow_no_censored']))
 		echo '
-							<li>
-								<input type="hidden" name="default_options[show_no_censored]" value="0" />
-								<label for="show_no_censored"><input type="checkbox" name="default_options[show_no_censored]" id="show_no_censored" value="1"' . (!empty($context['member']['options']['show_no_censored']) ? ' checked="checked"' : '') . ' class="input_check" /> ' . $txt['show_no_censored'] . '</label>
-							</li>';
+							<dt>
+								<label for="show_no_censored">' . $txt['show_no_censored'] . '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[show_no_censored]" value="0">
+								<input type="checkbox" name="default_options[show_no_censored]" id="show_no_censored" value="1"' . (!empty($context['member']['options']['show_no_censored']) ? ' checked' : '') . ' class="input_check">
+							</dd>';
 
 	echo '
-							<li>
-								<input type="hidden" name="default_options[return_to_post]" value="0" />
-								<label for="return_to_post"><input type="checkbox" name="default_options[return_to_post]" id="return_to_post" value="1"', !empty($context['member']['options']['return_to_post']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['return_to_post'], '</label>
-							</li>
-							<li>
-								<input type="hidden" name="default_options[no_new_reply_warning]" value="0" />
-								<label for="no_new_reply_warning"><input type="checkbox" name="default_options[no_new_reply_warning]" id="no_new_reply_warning" value="1"', !empty($context['member']['options']['no_new_reply_warning']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['no_new_reply_warning'], '</label>
-							</li>';
+							<dt>
+								<label for="return_to_post">', $txt['return_to_post'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[return_to_post]" value="0">
+								<input type="checkbox" name="default_options[return_to_post]" id="return_to_post" value="1"', !empty($context['member']['options']['return_to_post']) ? ' checked' : '', ' class="input_check">
+							</dd>';
 
 	if (!empty($modSettings['enable_buddylist']))
 		echo '
-							<li>
-								<input type="hidden" name="default_options[posts_apply_ignore_list]" value="0" />
-								<label for="posts_apply_ignore_list"><input type="checkbox" name="default_options[posts_apply_ignore_list]" id="posts_apply_ignore_list" value="1"', !empty($context['member']['options']['posts_apply_ignore_list']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['posts_apply_ignore_list'], '</label>
-							</li>';
+							<dt>
+								<label for="posts_apply_ignore_list">', $txt['posts_apply_ignore_list'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[posts_apply_ignore_list]" value="0">
+								<input type="checkbox" name="default_options[posts_apply_ignore_list]" id="posts_apply_ignore_list" value="1"', !empty($context['member']['options']['posts_apply_ignore_list']) ? ' checked' : '', ' class="input_check">
+							</dd>';
 
 	echo '
-							<li>
-								<input type="hidden" name="default_options[view_newest_first]" value="0" />
-								<label for="view_newest_first"><input type="checkbox" name="default_options[view_newest_first]" id="view_newest_first" value="1"', !empty($context['member']['options']['view_newest_first']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['recent_posts_at_top'], '</label>
-							</li>';
+							<dt>
+								<label for="view_newest_first">', $txt['recent_posts_at_top'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[view_newest_first]" value="0">
+								<input type="checkbox" name="default_options[view_newest_first]" id="view_newest_first" value="1"', !empty($context['member']['options']['view_newest_first']) ? ' checked' : '', ' class="input_check">
+							</dd>';
 
 	// Choose WYSIWYG settings?
 	if (empty($modSettings['disable_wysiwyg']))
 		echo '
-							<li>
-								<input type="hidden" name="default_options[wysiwyg_default]" value="0" />
-								<label for="wysiwyg_default"><input type="checkbox" name="default_options[wysiwyg_default]" id="wysiwyg_default" value="1"', !empty($context['member']['options']['wysiwyg_default']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['wysiwyg_default'], '</label>
-							</li>';
+							<dt>
+								<label for="wysiwyg_default">', $txt['wysiwyg_default'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[wysiwyg_default]" value="0">
+								<input type="checkbox" name="default_options[wysiwyg_default]" id="wysiwyg_default" value="1"', !empty($context['member']['options']['wysiwyg_default']) ? ' checked' : '', ' class="input_check">
+							</dd>';
 
 	if (empty($modSettings['disableCustomPerPage']))
 	{
 		echo '
-							<li>
+							<dt>
 								<label for="topics_per_page">', $txt['topics_per_page'], '</label>
+							</dt>
+							<dd>
 								<select name="default_options[topics_per_page]" id="topics_per_page">
-									<option value="0"', empty($context['member']['options']['topics_per_page']) ? ' selected="selected"' : '', '>', $txt['per_page_default'], ' (', $modSettings['defaultMaxTopics'], ')</option>
-									<option value="5"', !empty($context['member']['options']['topics_per_page']) && $context['member']['options']['topics_per_page'] == 5 ? ' selected="selected"' : '', '>5</option>
-									<option value="10"', !empty($context['member']['options']['topics_per_page']) && $context['member']['options']['topics_per_page'] == 10 ? ' selected="selected"' : '', '>10</option>
-									<option value="25"', !empty($context['member']['options']['topics_per_page']) && $context['member']['options']['topics_per_page'] == 25 ? ' selected="selected"' : '', '>25</option>
-									<option value="50"', !empty($context['member']['options']['topics_per_page']) && $context['member']['options']['topics_per_page'] == 50 ? ' selected="selected"' : '', '>50</option>
+									<option value="0"', empty($context['member']['options']['topics_per_page']) ? ' selected' : '', '>', $txt['per_page_default'], ' (', $modSettings['defaultMaxTopics'], ')</option>
+									<option value="5"', !empty($context['member']['options']['topics_per_page']) && $context['member']['options']['topics_per_page'] == 5 ? ' selected' : '', '>5</option>
+									<option value="10"', !empty($context['member']['options']['topics_per_page']) && $context['member']['options']['topics_per_page'] == 10 ? ' selected' : '', '>10</option>
+									<option value="25"', !empty($context['member']['options']['topics_per_page']) && $context['member']['options']['topics_per_page'] == 25 ? ' selected' : '', '>25</option>
+									<option value="50"', !empty($context['member']['options']['topics_per_page']) && $context['member']['options']['topics_per_page'] == 50 ? ' selected' : '', '>50</option>
 								</select>
-							</li>
-							<li>
+							</dd>
+							<dt>
 								<label for="messages_per_page">', $txt['messages_per_page'], '</label>
+							</dt>
+							<dd>
 								<select name="default_options[messages_per_page]" id="messages_per_page">
-									<option value="0"', empty($context['member']['options']['messages_per_page']) ? ' selected="selected"' : '', '>', $txt['per_page_default'], ' (', $modSettings['defaultMaxMessages'], ')</option>
-									<option value="5"', !empty($context['member']['options']['messages_per_page']) && $context['member']['options']['messages_per_page'] == 5 ? ' selected="selected"' : '', '>5</option>
-									<option value="10"', !empty($context['member']['options']['messages_per_page']) && $context['member']['options']['messages_per_page'] == 10 ? ' selected="selected"' : '', '>10</option>
-									<option value="25"', !empty($context['member']['options']['messages_per_page']) && $context['member']['options']['messages_per_page'] == 25 ? ' selected="selected"' : '', '>25</option>
-									<option value="50"', !empty($context['member']['options']['messages_per_page']) && $context['member']['options']['messages_per_page'] == 50 ? ' selected="selected"' : '', '>50</option>
+									<option value="0"', empty($context['member']['options']['messages_per_page']) ? ' selected' : '', '>', $txt['per_page_default'], ' (', $modSettings['defaultMaxMessages'], ')</option>
+									<option value="5"', !empty($context['member']['options']['messages_per_page']) && $context['member']['options']['messages_per_page'] == 5 ? ' selected' : '', '>5</option>
+									<option value="10"', !empty($context['member']['options']['messages_per_page']) && $context['member']['options']['messages_per_page'] == 10 ? ' selected' : '', '>10</option>
+									<option value="25"', !empty($context['member']['options']['messages_per_page']) && $context['member']['options']['messages_per_page'] == 25 ? ' selected' : '', '>25</option>
+									<option value="50"', !empty($context['member']['options']['messages_per_page']) && $context['member']['options']['messages_per_page'] == 50 ? ' selected' : '', '>50</option>
 								</select>
-							</li>';
+							</dd>';
 	}
 
 	if (!empty($modSettings['cal_enabled']))
 		echo '
-							<li>
+							<dt>
 								<label for="calendar_start_day">', $txt['calendar_start_day'], ':</label>
+							</dt>
+							<dd>
 								<select name="default_options[calendar_start_day]" id="calendar_start_day">
-									<option value="0"', empty($context['member']['options']['calendar_start_day']) ? ' selected="selected"' : '', '>', $txt['days'][0], '</option>
-									<option value="1"', !empty($context['member']['options']['calendar_start_day']) && $context['member']['options']['calendar_start_day'] == 1 ? ' selected="selected"' : '', '>', $txt['days'][1], '</option>
-									<option value="6"', !empty($context['member']['options']['calendar_start_day']) && $context['member']['options']['calendar_start_day'] == 6 ? ' selected="selected"' : '', '>', $txt['days'][6], '</option>
+									<option value="0"', empty($context['member']['options']['calendar_start_day']) ? ' selected' : '', '>', $txt['days'][0], '</option>
+									<option value="1"', !empty($context['member']['options']['calendar_start_day']) && $context['member']['options']['calendar_start_day'] == 1 ? ' selected' : '', '>', $txt['days'][1], '</option>
+									<option value="6"', !empty($context['member']['options']['calendar_start_day']) && $context['member']['options']['calendar_start_day'] == 6 ? ' selected' : '', '>', $txt['days'][6], '</option>
 								</select>
-							</li>';
+							</dd>';
+
+	if ((!empty($modSettings['drafts_post_enabled']) || !empty($modSettings['drafts_pm_enabled'])) && !empty($modSettings['drafts_autosave_enabled']))
+		echo '
+							<dt>
+								<label for="drafts_autosave_enabled">', $txt['drafts_autosave_enabled'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[drafts_autosave_enabled]" value="0">
+								<input type="checkbox" name="default_options[drafts_autosave_enabled]" id="drafts_autosave_enabled" value="1"', !empty($context['member']['options']['drafts_autosave_enabled']) ? ' checked' : '', ' class="input_check">
+							</dd>';
+	if ((!empty($modSettings['drafts_post_enabled']) || !empty($modSettings['drafts_pm_enabled'])) && !empty($modSettings['drafts_show_saved_enabled']))
+		echo '
+							<dt>
+								<label for="drafts_show_saved_enabled">', $txt['drafts_show_saved_enabled'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[drafts_show_saved_enabled]" value="0">
+								<input type="checkbox" name="default_options[drafts_show_saved_enabled]" id="drafts_show_saved_enabled" value="1"', !empty($context['member']['options']['drafts_show_saved_enabled']) ? ' checked' : '', ' class="input_check">
+							</dd>';
 
 	echo '
-							<li>
-								<label for="display_quick_reply">', $txt['display_quick_reply'], '</label>
-								<select name="default_options[display_quick_reply]" id="display_quick_reply">
-									<option value="0"', empty($context['member']['options']['display_quick_reply']) ? ' selected="selected"' : '', '>', $txt['display_quick_reply1'], '</option>
-									<option value="1"', !empty($context['member']['options']['display_quick_reply']) && $context['member']['options']['display_quick_reply'] == 1 ? ' selected="selected"' : '', '>', $txt['display_quick_reply2'], '</option>
-									<option value="2"', !empty($context['member']['options']['display_quick_reply']) && $context['member']['options']['display_quick_reply'] == 2 ? ' selected="selected"' : '', '>', $txt['display_quick_reply3'], '</option>
-								</select>
-							</li>
-							<li>
-								<label for="display_quick_mod">', $txt['display_quick_mod'], '</label>
+							<dt>
+								<label for="use_editor_quick_reply">', $txt['use_editor_quick_reply'], '</label>
+							</dt>
+							<dd>
+								<input type="hidden" name="default_options[use_editor_quick_reply]" value="0">
+								<input type="checkbox" name="default_options[use_editor_quick_reply]" id="use_editor_quick_reply" value="1"', !empty($context['member']['options']['use_editor_quick_reply']) ? ' checked' : '', ' class="input_check">
+							</dd>
+							<dt>
+								<label for="display_quick_mod">', $txt['display_quick_mod'], ':</label>
+							</dt>
+							<dd>
 								<select name="default_options[display_quick_mod]" id="display_quick_mod">
-									<option value="0"', empty($context['member']['options']['display_quick_mod']) ? ' selected="selected"' : '', '>', $txt['display_quick_mod_none'], '</option>
-									<option value="1"', !empty($context['member']['options']['display_quick_mod']) && $context['member']['options']['display_quick_mod'] == 1 ? ' selected="selected"' : '', '>', $txt['display_quick_mod_check'], '</option>
-									<option value="2"', !empty($context['member']['options']['display_quick_mod']) && $context['member']['options']['display_quick_mod'] != 1 ? ' selected="selected"' : '', '>', $txt['display_quick_mod_image'], '</option>
+									<option value="0"', empty($context['member']['options']['display_quick_mod']) ? ' selected' : '', '>', $txt['display_quick_mod_none'], '</option>
+									<option value="1"', !empty($context['member']['options']['display_quick_mod']) && $context['member']['options']['display_quick_mod'] == 1 ? ' selected' : '', '>', $txt['display_quick_mod_check'], '</option>
+									<option value="2"', !empty($context['member']['options']['display_quick_mod']) && $context['member']['options']['display_quick_mod'] != 1 ? ' selected' : '', '>', $txt['display_quick_mod_image'], '</option>
 								</select>
-							</li>
-						</ul>
-						<dl>
-							<dd></dd>';
+							</dd>';
 }
 
-function template_notification()
+function template_alert_configuration()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $settings, $txt, $scripturl, $modSettings;
 
-	// The main containing header.
 	echo '
+		<div class="cat_bar">
+			<h3 class="catbg">
+				', $txt['alert_prefs'], '
+			</h3>
+		</div>
+		<p class="information">', (empty($context['description']) ? $txt['alert_prefs_desc'] : $context['description']), '</p>
+		<form action="', $scripturl, '?', $context['action'], '" id="admin_form_wrapper" method="post" accept-charset="', $context['character_set'], '" id="notify_options" class="flow_hidden">
 			<div class="cat_bar">
 				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />', $txt['profile'], '</span>
+					', $txt['notification_general'], '
 				</h3>
 			</div>
-			<p class="windowbg description">', $txt['notification_info'], '</p>
 			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<form action="', $scripturl, '?action=profile;area=notification;save" method="post" accept-charset="', $context['character_set'], '" id="notify_options" class="flow_hidden">';
+				<dl class="settings">';
 
 	// Allow notification on announcements to be disabled?
 	if (!empty($modSettings['allow_disableAnnounce']))
 		echo '
-						<input type="hidden" name="notify_announcements" value="0" />
-						<label for="notify_announcements"><input type="checkbox" id="notify_announcements" name="notify_announcements"', !empty($context['member']['notify_announcements']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['notify_important_email'], '</label><br />';
+					<dt>
+						<label for="notify_announcements">', $txt['notify_important_email'], '</label>
+					</dt>
+					<dd>
+						<input type="hidden" name="notify_announcements" value="0">
+						<input type="checkbox" id="notify_announcements" name="notify_announcements"', !empty($context['member']['notify_announcements']) ? ' checked' : '', ' class="input_check">
+					</dd>';
+
+	if (!empty($modSettings['enable_ajax_alerts']))
+		echo '
+					<dt>
+						<label for="notify_send_body">', $txt['notify_alert_timeout'], '</label>
+					</dt>
+					<dd>
+						<input type="number" size="4" id="notify_alert_timeout" name="opt_alert_timeout" min="0" value="', $context['member']['alert_timeout'], '" class="input_text">
+					</dd>
+		';
 
-	// More notification options.
 	echo '
-						<input type="hidden" name="default_options[auto_notify]" value="0" />
-						<label for="auto_notify"><input type="checkbox" id="auto_notify" name="default_options[auto_notify]" value="1"', !empty($context['member']['options']['auto_notify']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['auto_notify'], '</label><br />';
+				</dl>
+			</div>
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $txt['notify_what_how'], '
+				</h3>
+			</div>
+			<table class="table_grid">
+				<tr>
+					<td></td>
+					<td class="centercol">', $txt['receive_alert'], '</td>
+					<td class="centercol">', $txt['receive_mail'], '</td>
+				</tr>';
+
+	foreach ($context['alert_types'] as $alert_group => $alerts)
+	{
+		echo '
+				<tr class="title_bar">
+					<th colspan="3">
+						', $txt['alert_group_' . $alert_group];
+		if (isset($context['alert_group_options'][$alert_group]))
+		{
+			foreach ($context['alert_group_options'][$alert_group] as $opts)
+			{
+				echo '
+				<div class="smalltext">';
+				$label = $txt['alert_opt_' . $opts[1]];
+				$label_pos = isset($opts['label']) ? $opts['label'] : '';
+				if ($label_pos == 'before')
+					echo '
+					<label for="opt_', $opts[1], '">', $label, '</label>';
+
+				$this_value = isset($context['alert_prefs'][$opts[1]]) ? $context['alert_prefs'][$opts[1]] : 0;
+				switch ($opts[0])
+				{
+					case 'check':
+						echo '
+						<input type="checkbox" name="opt_', $opts[1], '" id="opt_', $opts[1], '"', $this_value ? ' checked' : '', '>';
+						break;
+					case 'select':
+						echo '
+						<select name="opt_', $opts[1], '" id="opt_', $opts[1], '">';
+						foreach ($opts['opts'] as $k => $v)
+							echo '
+							<option value="', $k, '"', $this_value == $k ? ' selected' : '', '>', $v, '</option>';
+						echo '
+						</select>';
+						break;
+				}
 
-	if (empty($modSettings['disallow_sendBody']))
-		echo '
-						<input type="hidden" name="notify_send_body" value="0" />
-						<label for="notify_send_body"><input type="checkbox" id="notify_send_body" name="notify_send_body"', !empty($context['member']['notify_send_body']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['notify_send_body'], '</label><br />';
-
-	echo '
-						<br />
-						<label for="notify_regularity">', $txt['notify_regularity'], ':</label>
-						<select name="notify_regularity" id="notify_regularity">
-							<option value="0"', $context['member']['notify_regularity'] == 0 ? ' selected="selected"' : '', '>', $txt['notify_regularity_instant'], '</option>
-							<option value="1"', $context['member']['notify_regularity'] == 1 ? ' selected="selected"' : '', '>', $txt['notify_regularity_first_only'], '</option>
-							<option value="2"', $context['member']['notify_regularity'] == 2 ? ' selected="selected"' : '', '>', $txt['notify_regularity_daily'], '</option>
-							<option value="3"', $context['member']['notify_regularity'] == 3 ? ' selected="selected"' : '', '>', $txt['notify_regularity_weekly'], '</option>
-						</select>
-						<br /><br />
-						<label for="notify_types">', $txt['notify_send_types'], ':</label>
-						<select name="notify_types" id="notify_types">
-							<option value="1"', $context['member']['notify_types'] == 1 ? ' selected="selected"' : '', '>', $txt['notify_send_type_everything'], '</option>
-							<option value="2"', $context['member']['notify_types'] == 2 ? ' selected="selected"' : '', '>', $txt['notify_send_type_everything_own'], '</option>
-							<option value="3"', $context['member']['notify_types'] == 3 ? ' selected="selected"' : '', '>', $txt['notify_send_type_only_replies'], '</option>
-							<option value="4"', $context['member']['notify_types'] == 4 ? ' selected="selected"' : '', '>', $txt['notify_send_type_nothing'], '</option>
-						</select><br class="clear" />
+				if ($label_pos == 'after')
+					echo '
+					<label for="opt_', $opts[1], '">', $label, '</label>';
 
-						<div>
-							<input id="notify_submit" type="submit" value="', $txt['notify_save'], '" class="button_submit floatright" />
-							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-							<input type="hidden" name="u" value="', $context['id_member'], '" />
-							<input type="hidden" name="sa" value="', $context['menu_item_selected'], '" />
-						</div><br class="clear" />
-					</form>
-				</div>
-				<span class="botslice"><span></span></span>
+				echo '
+				</div>';
+			}
+		}
+
+		echo '
+					</th>
+				</tr>';
+		foreach ($alerts as $alert_id => $alert_details)
+		{
+			echo '
+				<tr class="windowbg">
+					<td>', $txt['alert_' . $alert_id], isset($alert_details['help']) ? '<a href="' . $scripturl . '?action=helpadmin;help=' . $alert_details['help'] . '" onclick="return reqOverlayDiv(this.href);" class="help floatright"><span class="generic_icons help" title="'. $txt['help'].'"></span>' : '', '</td>';
+
+			foreach ($context['alert_bits'] as $type => $bitmask)
+			{
+				echo '
+					<td class="centercol">';
+				$this_value = isset($context['alert_prefs'][$alert_id]) ? $context['alert_prefs'][$alert_id] : 0;
+				switch ($alert_details[$type])
+				{
+					case 'always':
+						echo '
+						<input type="checkbox" checked disabled>';
+						break;
+					case 'yes':
+						echo '
+						<input type="checkbox" name="', $type, '_', $alert_id, '"', ($this_value & $bitmask) ? ' checked' : '', '>';
+						break;
+					case 'never':
+						echo '
+						<input type="checkbox" disabled>';
+						break;
+				}
+				echo '
+					</td>';
+			}
+
+			echo '
+				</tr>';
+		}
+	}
+
+	echo '
+			</table>
+			<br>
+			<div>
+				<input id="notify_submit" type="submit" name="notify_submit" value="', $txt['notify_save'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">', !empty($context['token_check']) ? '
+				<input type="hidden" name="' . $context[$context['token_check'] . '_token_var'] . '" value="' . $context[$context['token_check'] . '_token'] . '">' : '', '
+				<input type="hidden" name="u" value="', $context['id_member'], '">
+				<input type="hidden" name="sa" value="', $context['menu_item_selected'], '">
 			</div>
-			<br />';
+		</form>
+		<br>';
+}
+
+function template_alert_notifications_topics()
+{
+	global $txt;
+
+	// The main containing header.
+	echo '
+		<div class="cat_bar">
+			<h3 class="catbg">
+				', $txt['watched_topics'], '
+			</h3>
+		</div>
+		<p class="information">', $txt['watched_topics_desc'], '</p>
+		<br>';
 
 	template_show_list('topic_notification_list');
+}
+
+function template_alert_notifications_boards()
+{
+	global $txt;
 
 	echo '
-		<br />';
+		<div class="cat_bar">
+			<h3 class="catbg">
+				', $txt['watched_boards'], '
+			</h3>
+		</div>
+		<p class="information">', $txt['watched_boards_desc'], '</p>
+		<br>';
 
 	template_show_list('board_notification_list');
 }
@@ -1656,25 +1928,28 @@
 // Template for choosing group membership.
 function template_groupMembership()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $scripturl, $txt;
 
 	// The main containing header.
 	echo '
 		<form action="', $scripturl, '?action=profile;area=groupmembership;save" method="post" accept-charset="', $context['character_set'], '" name="creator" id="creator">
 			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />', $txt['profile'], '</span>
+				<h3 class="catbg profile_hd">
+					', $txt['profile'], '
 				</h3>
 			</div>
-			<p class="description">', $txt['groupMembership_info'], '</p>';
+			<p class="information">', $txt['groupMembership_info'], '</p>';
 
 	// Do we have an update message?
 	if (!empty($context['update_message']))
 		echo '
-			<div id="profile_success">
+			<div class="infobox">
 				', $context['update_message'], '.
 			</div>';
 
+	echo '
+		<div id="groups">';
+
 	// Requesting membership to a group?
 	if (!empty($context['group_request']))
 	{
@@ -1683,117 +1958,82 @@
 				<div class="cat_bar">
 					<h3 class="catbg">', $txt['request_group_membership'], '</h3>
 				</div>
-				<span class="upperframe"><span></span></span>
-				<div class="roundframe"><div class="innerframe">
+				<div class="roundframe">
 					', $txt['request_group_membership_desc'], ':
-					<textarea name="reason" rows="4" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 99%; min-width: 99%' : 'width: 99%') . ';"></textarea>
+					<textarea name="reason" rows="4" style="width: 99%;"></textarea>
 					<div class="righttext" style="margin: 0.5em 0.5% 0 0.5%;">
-						<input type="hidden" name="gid" value="', $context['group_request']['id'], '" />
-						<input type="submit" name="req" value="', $txt['submit_request'], '" class="button_submit" />
+						<input type="hidden" name="gid" value="', $context['group_request']['id'], '">
+						<input type="submit" name="req" value="', $txt['submit_request'], '" class="button_submit">
 					</div>
-				</div></div>
-				<span class="lowerframe"><span></span></span>
+				</div>
 			</div>';
 	}
 	else
 	{
 		echo '
-			<table border="0" width="100%" cellspacing="0" cellpadding="4" class="table_grid">
-				<thead>
-					<tr class="catbg">
-						<th class="first_th" scope="col" ', $context['can_edit_primary'] ? ' colspan="2"' : '', '>', $txt['current_membergroups'], '</th>
-						<th class="last_th" scope="col"></th>
-					</tr>
-				</thead>
-				<tbody>';
+			<div class="title_bar">
+				<h3 class="titlebg">', $txt['current_membergroups'], '</h3>
+			</div>';
 
-		$alternate = true;
 		foreach ($context['groups']['member'] as $group)
 		{
 			echo '
-					<tr class="', $alternate ? 'windowbg' : 'windowbg2', '" id="primdiv_', $group['id'], '">';
+					<div class="windowbg" id="primdiv_', $group['id'], '">';
 
 				if ($context['can_edit_primary'])
 					echo '
-						<td width="4%">
-							<input type="radio" name="primary" id="primary_', $group['id'], '" value="', $group['id'], '" ', $group['is_primary'] ? 'checked="checked"' : '', ' onclick="highlightSelected(\'primdiv_' . $group['id'] . '\');" ', $group['can_be_primary'] ? '' : 'disabled="disabled"', ' class="input_radio" />
-						</td>';
+						<input type="radio" name="primary" id="primary_', $group['id'], '" value="', $group['id'], '"', $group['is_primary'] ? ' checked' : '', ' onclick="highlightSelected(\'primdiv_' . $group['id'] . '\');"', $group['can_be_primary'] ? '' : ' disabled', ' class="input_radio">';
 
 				echo '
-						<td>
-							<label for="primary_', $group['id'], '"><strong>', (empty($group['color']) ? $group['name'] : '<span style="color: ' . $group['color'] . '">' . $group['name'] . '</span>'), '</strong>', (!empty($group['desc']) ? '<br /><span class="smalltext">' . $group['desc'] . '</span>' : ''), '</label>
-						</td>
-						<td width="15%" class="righttext">';
+						<label for="primary_', $group['id'], '"><strong>', (empty($group['color']) ? $group['name'] : '<span style="color: ' . $group['color'] . '">' . $group['name'] . '</span>'), '</strong>', (!empty($group['desc']) ? '<br><span class="smalltext">' . $group['desc'] . '</span>' : ''), '</label>';
 
 				// Can they leave their group?
 				if ($group['can_leave'])
 					echo '
-							<a href="' . $scripturl . '?action=profile;save;u=' . $context['id_member'] . ';area=groupmembership;' . $context['session_var'] . '=' . $context['session_id'] . ';gid=' . $group['id'] . '">' . $txt['leave_group'] . '</a>';
+						<a href="' . $scripturl . '?action=profile;save;u=' . $context['id_member'] . ';area=groupmembership;' . $context['session_var'] . '=' . $context['session_id'] . ';gid=' . $group['id'] . ';', $context[$context['token_check'] . '_token_var'], '=', $context[$context['token_check'] . '_token'], '">' . $txt['leave_group'] . '</a>';
+
 				echo '
-						</td>
-					</tr>';
-			$alternate = !$alternate;
+					</div>';
 		}
 
-		echo '
-				</tbody>
-			</table>';
-
 		if ($context['can_edit_primary'])
 			echo '
 			<div class="padding righttext">
-				<input type="submit" value="', $txt['make_primary'], '" class="button_submit" />
+				<input type="submit" value="', $txt['make_primary'], '" class="button_submit">
 			</div>';
 
 		// Any groups they can join?
 		if (!empty($context['groups']['available']))
 		{
 			echo '
-			<br />
-			<table border="0" width="100%" cellspacing="0" cellpadding="4" class="table_grid">
-				<thead>
-					<tr class="catbg">
-						<th class="first_th" scope="col">
-							', $txt['available_groups'], '
-						</th>
-						<th class="last_th" scope="col"></th>
-					</tr>
-				</thead>
-				<tbody>';
+					<div class="title_bar">
+						<h3 class="titlebg">', $txt['available_groups'], '</h3>
+					</div>';
 
-			$alternate = true;
 			foreach ($context['groups']['available'] as $group)
 			{
 				echo '
-					<tr class="', $alternate ? 'windowbg' : 'windowbg2', '">
-						<td>
-							<strong>', (empty($group['color']) ? $group['name'] : '<span style="color: ' . $group['color'] . '">' . $group['name'] . '</span>'), '</strong>', (!empty($group['desc']) ? '<br /><span class="smalltext">' . $group['desc'] . '</span>' : ''), '
-						</td>
-						<td width="15%" class="lefttext">';
+					<div class="windowbg">
+						<strong>', (empty($group['color']) ? $group['name'] : '<span style="color: ' . $group['color'] . '">' . $group['name'] . '</span>'), '</strong>', (!empty($group['desc']) ? '<br><span class="smalltext">' . $group['desc'] . '</span>' : ''), '';
 
 				if ($group['type'] == 3)
 					echo '
-							<a href="', $scripturl, '?action=profile;save;u=', $context['id_member'], ';area=groupmembership;', $context['session_var'], '=', $context['session_id'], ';gid=', $group['id'], '">', $txt['join_group'], '</a>';
+						<a href="', $scripturl, '?action=profile;save;u=', $context['id_member'], ';area=groupmembership;', $context['session_var'], '=', $context['session_id'], ';gid=', $group['id'], ';', $context[$context['token_check'] . '_token_var'], '=', $context[$context['token_check'] . '_token'], '" class="button floatright">', $txt['join_group'], '</a>';
 				elseif ($group['type'] == 2 && $group['pending'])
 					echo '
-							', $txt['approval_pending'];
+						<span class="floatright">', $txt['approval_pending'],'</span>';
 				elseif ($group['type'] == 2)
 					echo '
-							<a href="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=groupmembership;request=', $group['id'], '">', $txt['request_group'], '</a>';
+						<a href="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=groupmembership;request=', $group['id'], '" class="button floatright">', $txt['request_group'], '</a>';
 
 				echo '
-						</td>
-					</tr>';
-				$alternate = !$alternate;
+					</div>';
 			}
-			echo '
-				</tbody>
-			</table>';
 		}
 
 		// Javascript for the selector stuff.
 		echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 		var prevClass = "";
 		var prevDiv = "";
 		function highlightSelected(box)
@@ -1805,7 +2045,7 @@
 			prevDiv = document.getElementById(box);
 			prevClass = prevDiv.className;
 
-			prevDiv.className = "highlight2";
+			prevDiv.className = "windowbg";
 		}';
 		if (isset($context['groups']['member'][$context['primary_group']]))
 			echo '
@@ -1815,39 +2055,32 @@
 	}
 
 	echo '
-				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				<input type="hidden" name="u" value="', $context['id_member'], '" />
+		</div>';
+
+	if (!empty($context['token_check']))
+		echo '
+				<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">';
+
+	echo '
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="u" value="', $context['id_member'], '">
 			</form>';
 }
 
 function template_ignoreboards()
 {
-	global $context, $txt, $settings, $scripturl;
+	global $context, $txt, $scripturl;
 	// The main containing header.
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function selectBoards(ids)
-		{
-			var toggle = true;
-
-			for (i = 0; i < ids.length; i++)
-				toggle = toggle & document.forms.creator["ignore_brd" + ids[i]].checked;
-
-			for (i = 0; i < ids.length; i++)
-				document.forms.creator["ignore_brd" + ids[i]].checked = !toggle;
-		}
-	// ]]></script>
-
 	<form action="', $scripturl, '?action=profile;area=ignoreboards;save" method="post" accept-charset="', $context['character_set'], '" name="creator" id="creator">
 		<div class="cat_bar">
-			<h3 class="catbg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />', $txt['profile'], '</span>
+			<h3 class="catbg profile_hd">
+				', $txt['profile'], '
 			</h3>
 		</div>
-		<p class="description">', $txt['ignoreboards_info'], '</p>
+		<p class="information">', $txt['ignoreboards_info'], '</p>
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content flow_hidden">
+			<div class="flow_hidden">
 				<ul class="ignoreboards floatleft">';
 
 	$i = 0;
@@ -1865,7 +2098,7 @@
 
 		echo '
 					<li class="category">
-						<a href="javascript:void(0);" onclick="selectBoards([', implode(', ', $category['child_ids']), ']); return false;">', $category['name'], '</a>
+						<a href="javascript:void(0);" onclick="selectBoards([', implode(', ', $category['child_ids']), '], \'creator\'); return false;">', $category['name'], '</a>
 						<ul>';
 
 		foreach ($category['boards'] as $board)
@@ -1881,7 +2114,7 @@
 
 			echo '
 							<li class="board" style="margin-', $context['right_to_left'] ? 'right' : 'left', ': ', $board['child_level'], 'em;">
-								<label for="ignore_brd', $board['id'], '"><input type="checkbox" id="ignore_brd', $board['id'], '" name="ignore_brd[', $board['id'], ']" value="', $board['id'], '"', $board['selected'] ? ' checked="checked"' : '', ' class="input_check" /> ', $board['name'], '</label>
+								<label for="ignore_brd', $board['id'], '"><input type="checkbox" id="brd', $board['id'], '" name="ignore_brd[', $board['id'], ']" value="', $board['id'], '"', $board['selected'] ? ' checked' : '', ' class="input_check"> ', $board['name'], '</label>
 							</li>';
 
 			$i++;
@@ -1893,18 +2126,16 @@
 	}
 
 	echo '
-				</ul>
-				<br class="clear" />';
+				</ul>';
 
 	// Show the standard "Save Settings" profile button.
 	template_profile_save();
 
 	echo '
 			</div>
-			<span class="botslice"><span></span></span>
 		</div>
 	</form>
-	<br />';
+	<br>';
 }
 
 // Simple load some theme variables common to several warning templates.
@@ -1931,56 +2162,51 @@
 // Show all warnings of a user?
 function template_viewWarning()
 {
-	global $context, $txt, $scripturl, $settings;
+	global $context, $txt;
 
 	template_load_warning_variables();
 
 	echo '
-		<div class="title_bar">
-			<h3 class="titlebg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />
+		<div class="cat_bar">
+			<h3 class="catbg profile_hd">
 				', sprintf($txt['profile_viewwarning_for_user'], $context['member']['name']), '
-				</span>
 			</h3>
 		</div>
+		<p class="information">', $txt['viewWarning_help'], '</p>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl class="settings">
-					<dt>
-						<strong>', $txt['profile_warning_name'], ':</strong>
-					</dt>
-					<dd>
-						', $context['member']['name'], '
-					</dd>
-					<dt>
-						<strong>', $txt['profile_warning_level'], ':</strong>
-					</dt>
-					<dd>
+			<dl class="settings">
+				<dt>
+					<strong>', $txt['profile_warning_name'], ':</strong>
+				</dt>
+				<dd>
+					', $context['member']['name'], '
+				</dd>
+				<dt>
+					<strong>', $txt['profile_warning_level'], ':</strong>
+				</dt>
+				<dd>
+					<div>
 						<div>
-							<div>
-								<div style="font-size: 8pt; height: 12pt; width: ', $context['warningBarWidth'], 'px; border: 1px solid black; background-color: white; padding: 1px; position: relative;">
-									<div id="warning_text" style="padding-top: 1pt; width: 100%; z-index: 2; color: black; position: absolute; text-align: center; font-weight: bold;">', $context['member']['warning'], '%</div>
-									<div id="warning_progress" style="width: ', $context['member']['warning'], '%; height: 12pt; z-index: 1; background-color: ', $context['current_color'], ';">&nbsp;</div>
-								</div>
+							<div style="font-size: 8pt; height: 12pt; width: ', $context['warningBarWidth'], 'px; border: 1px solid black; background-color: white; padding: 1px; position: relative;">
+								<div id="warning_text" style="padding-top: 1pt; width: 100%; z-index: 2; color: black; position: absolute; text-align: center; font-weight: bold;">', $context['member']['warning'], '%</div>
+								<div id="warning_progress" style="width: ', $context['member']['warning'], '%; height: 12pt; z-index: 1; background-color: ', $context['current_color'], ';">&nbsp;</div>
 							</div>
 						</div>
-					</dd>';
+					</div>
+				</dd>';
 
 		// There's some impact of this?
 		if (!empty($context['level_effects'][$context['current_level']]))
 			echo '
-					<dt>
-						<strong>', $txt['profile_viewwarning_impact'], ':</strong>
-					</dt>
-					<dd>
-						', $context['level_effects'][$context['current_level']], '
-					</dd>';
+				<dt>
+					<strong>', $txt['profile_viewwarning_impact'], ':</strong>
+				</dt>
+				<dd>
+					', $context['level_effects'][$context['current_level']], '
+				</dd>';
 
 		echo '
-				</dl>
-			</div>
-			<span class="botslice"><span></span></span>
+			</dl>
 		</div>';
 
 	template_show_list('view_warnings');
@@ -1989,103 +2215,12 @@
 // Show a lovely interface for issuing warnings.
 function template_issueWarning()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $context, $scripturl, $txt;
 
 	template_load_warning_variables();
 
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function setWarningBarPos(curEvent, isMove, changeAmount)
-		{
-			barWidth = ', $context['warningBarWidth'], ';
-
-			// Are we passing the amount to change it by?
-			if (changeAmount)
-			{
-				if (document.getElementById(\'warning_level\').value == \'SAME\')
-					percent = ', $context['member']['warning'], ' + changeAmount;
-				else
-					percent = parseInt(document.getElementById(\'warning_level\').value) + changeAmount;
-			}
-			// If not then it\'s a mouse thing.
-			else
-			{
-				if (!curEvent)
-					var curEvent = window.event;
-
-				// If it\'s a movement check the button state first!
-				if (isMove)
-				{
-					if (!curEvent.button || curEvent.button != 1)
-						return false
-				}
-
-				// Get the position of the container.
-				contain = document.getElementById(\'warning_contain\');
-				position = 0;
-				while (contain != null)
-				{
-					position += contain.offsetLeft;
-					contain = contain.offsetParent;
-				}
-
-				// Where is the mouse?
-				if (curEvent.pageX)
-				{
-					mouse = curEvent.pageX;
-				}
-				else
-				{
-					mouse = curEvent.clientX;
-					mouse += document.documentElement.scrollLeft != "undefined" ? document.documentElement.scrollLeft : document.body.scrollLeft;
-				}
-
-				// Is this within bounds?
-				if (mouse < position || mouse > position + barWidth)
-					return;
-
-				percent = Math.round(((mouse - position) / barWidth) * 100);
-
-				// Round percent to the nearest 5 - by kinda cheating!
-				percent = Math.round(percent / 5) * 5;
-			}
-
-			// What are the limits?
-			minLimit = ', $context['min_allowed'], ';
-			maxLimit = ', $context['max_allowed'], ';
-
-			percent = Math.max(percent, minLimit);
-			percent = Math.min(percent, maxLimit);
-
-			size = barWidth * (percent/100);
-
-			setInnerHTML(document.getElementById(\'warning_text\'), percent + "%");
-			document.getElementById(\'warning_level\').value = percent;
-			document.getElementById(\'warning_progress\').style.width = size + "px";
-
-			// Get the right color.
-			color = "black"';
-
-	foreach ($context['colors'] as $limit => $color)
-		echo '
-			if (percent >= ', $limit, ')
-				color = "', $color, '";';
-
-	echo '
-			document.getElementById(\'warning_progress\').style.backgroundColor = color;
-
-			// Also set the right effect.
-			effectText = "";';
-
-	foreach ($context['level_effects'] as $limit => $text)
-		echo '
-			if (percent >= ', $limit, ')
-				effectText = "', $text, '";';
-
-	echo '
-			setInnerHTML(document.getElementById(\'cur_level_div\'), effectText);
-		}
-
+	<script><!-- // --><![CDATA[
 		// Disable notification boxes as required.
 		function modifyWarnNotify()
 		{
@@ -2094,11 +2229,7 @@
 			document.getElementById(\'warn_body\').disabled = disable;
 			document.getElementById(\'warn_temp\').disabled = disable;
 			document.getElementById(\'new_template_link\').style.display = disable ? \'none\' : \'\';
-		}
-
-		function changeWarnLevel(amount)
-		{
-			setWarningBarPos(false, false, amount);
+			document.getElementById(\'preview_button\').style.display = disable ? \'none\' : \'\';
 		}
 
 		// Warn template.
@@ -2117,194 +2248,179 @@
 
 	echo '
 		}
-
+
+		function updateSlider(slideAmount)
+		{
+			// Also set the right effect.
+			effectText = "";';
+
+	foreach ($context['level_effects'] as $limit => $text)
+		echo '
+			if (slideAmount >= ', $limit, ')
+				effectText = "', $text, '";';
+
+	echo '
+			setInnerHTML(document.getElementById(\'cur_level_div\'), slideAmount + \'% (\' + effectText + \')\');
+		}
 	// ]]></script>';
 
 	echo '
 	<form action="', $scripturl, '?action=profile;u=', $context['id_member'], ';area=issuewarning" method="post" class="flow_hidden" accept-charset="', $context['character_set'], '">
 		<div class="cat_bar">
-			<h3 class="catbg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />
+			<h3 class="catbg profile_hd">
 				', $context['user']['is_owner'] ? $txt['profile_warning_level'] : $txt['profile_issue_warning'], '
-				</span>
 			</h3>
 		</div>';
 
 	if (!$context['user']['is_owner'])
 		echo '
-		<p class="description">', $txt['profile_warning_desc'], '</p>';
+		<p class="information">', $txt['profile_warning_desc'], '</p>';
 
 	echo '
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl class="settings">';
+			<dl class="settings">';
 
 	if (!$context['user']['is_owner'])
 		echo '
-					<dt>
-						<strong>', $txt['profile_warning_name'], ':</strong>
-					</dt>
-					<dd>
-						<strong>', $context['member']['name'], '</strong>
-					</dd>';
+				<dt>
+					<strong>', $txt['profile_warning_name'], ':</strong>
+				</dt>
+				<dd>
+					<strong>', $context['member']['name'], '</strong>
+				</dd>';
 
 	echo '
-					<dt>
-						<strong>', $txt['profile_warning_level'], ':</strong>';
+				<dt>
+					<strong>', $txt['profile_warning_level'], ':</strong>';
 
 	// Is there only so much they can apply?
 	if ($context['warning_limit'])
 		echo '
-						<br /><span class="smalltext">', sprintf($txt['profile_warning_limit_attribute'], $context['warning_limit']), '</span>';
-
-	echo '
-					</dt>
-					<dd>
-						<div id="warndiv1" style="display: none;">
-							<div>
-								<span class="floatleft" style="padding: 0 0.5em"><a href="#" onclick="changeWarnLevel(-5); return false;">[-]</a></span>
-								<div class="floatleft" id="warning_contain" style="font-size: 8pt; height: 12pt; width: ', $context['warningBarWidth'], 'px; border: 1px solid black; background-color: white; padding: 1px; position: relative;" onmousedown="setWarningBarPos(event, true);" onmousemove="setWarningBarPos(event, true);" onclick="setWarningBarPos(event);">
-									<div id="warning_text" style="padding-top: 1pt; width: 100%; z-index: 2; color: black; position: absolute; text-align: center; font-weight: bold;">', $context['member']['warning'], '%</div>
-									<div id="warning_progress" style="width: ', $context['member']['warning'], '%; height: 12pt; z-index: 1; background-color: ', $context['current_color'], ';">&nbsp;</div>
-								</div>
-								<span class="floatleft" style="padding: 0 0.5em"><a href="#" onclick="changeWarnLevel(5); return false;">[+]</a></span>
-								<div class="clear_left smalltext">', $txt['profile_warning_impact'], ': <span id="cur_level_div">', $context['level_effects'][$context['current_level']], '</span></div>
-							</div>
-							<input type="hidden" name="warning_level" id="warning_level" value="SAME" />
-						</div>
-						<div id="warndiv2">
-							<input type="text" name="warning_level_nojs" size="6" maxlength="4" value="', $context['member']['warning'], '" class="input_text" />&nbsp;', $txt['profile_warning_max'], '
-							<div class="smalltext">', $txt['profile_warning_impact'], ':<br />';
-	// For non-javascript give a better list.
-	foreach ($context['level_effects'] as $limit => $effect)
-		echo '
-							', sprintf($txt['profile_warning_effect_text'], $limit, $effect), '<br />';
+					<br><span class="smalltext">', sprintf($txt['profile_warning_limit_attribute'], $context['warning_limit']), '</span>';
 
 	echo '
-							</div>
-						</div>
-					</dd>';
+				</dt>
+				<dd>
+					0% <input name="warning_level" id="warning_level" type="range" min="0" max="100" step="5" value="', $context['member']['warning'], '" onchange="updateSlider(this.value)" /> 100%
+					<div class="clear_left">', $txt['profile_warning_impact'], ': <span id="cur_level_div">', $context['member']['warning'], '% (', $context['level_effects'][$context['current_level']], ')</span></div>
+				</dd>';
 
 	if (!$context['user']['is_owner'])
 	{
 		echo '
-					<dt>
-						<strong>', $txt['profile_warning_reason'], ':</strong><br />
-						<span class="smalltext">', $txt['profile_warning_reason_desc'], '</span>
-					</dt>
-					<dd>
-						<input type="text" name="warn_reason" id="warn_reason" value="', $context['warning_data']['reason'], '" size="50" style="width: 80%;" class="input_text" />
-					</dd>
-				</dl>
-				<hr />
+				<dt>
+					<strong>', $txt['profile_warning_reason'], ':</strong><br>
+					<span class="smalltext">', $txt['profile_warning_reason_desc'], '</span>
+				</dt>
+				<dd>
+					<input type="text" name="warn_reason" id="warn_reason" value="', $context['warning_data']['reason'], '" size="50" style="width: 80%;" class="input_text">
+				</dd>
+			</dl>
+			<hr>
+			<div id="box_preview"', !empty($context['warning_data']['body_preview']) ? '' : ' style="display:none"', '>
 				<dl class="settings">
 					<dt>
-						<strong>', $txt['profile_warning_notify'], ':</strong>
-					</dt>
-					<dd>
-						<input type="checkbox" name="warn_notify" id="warn_notify" onclick="modifyWarnNotify();" ', $context['warning_data']['notify'] ? 'checked="checked"' : '', ' class="input_check" />
-					</dd>
-					<dt>
-						<strong>', $txt['profile_warning_notify_subject'], ':</strong>
+						<strong>', $txt['preview'] , '</strong>
 					</dt>
-					<dd>
-						<input type="text" name="warn_sub" id="warn_sub" value="', empty($context['warning_data']['notify_subject']) ? $txt['profile_warning_notify_template_subject'] : $context['warning_data']['notify_subject'], '" size="50" style="width: 80%;" class="input_text" />
+					<dd id="body_preview">
+						', !empty($context['warning_data']['body_preview']) ? $context['warning_data']['body_preview'] : '', '
 					</dd>
-					<dt>
-						<strong>', $txt['profile_warning_notify_body'], ':</strong>
-					</dt>
-					<dd>
-						<select name="warn_temp" id="warn_temp" disabled="disabled" onchange="populateNotifyTemplate();" style="font-size: x-small;">
-							<option value="-1">', $txt['profile_warning_notify_template'], '</option>
-							<option value="-1">------------------------------</option>';
+				</dl>
+				<hr>
+			</div>
+			<dl class="settings">
+				<dt>
+					<strong><label for="warn_notify">', $txt['profile_warning_notify'], ':</label></strong>
+				</dt>
+				<dd>
+					<input type="checkbox" name="warn_notify" id="warn_notify" onclick="modifyWarnNotify();"', $context['warning_data']['notify'] ? ' checked' : '', ' class="input_check">
+				</dd>
+				<dt>
+					<strong><label for="warn_sub">', $txt['profile_warning_notify_subject'], ':</label></strong>
+				</dt>
+				<dd>
+					<input type="text" name="warn_sub" id="warn_sub" value="', empty($context['warning_data']['notify_subject']) ? $txt['profile_warning_notify_template_subject'] : $context['warning_data']['notify_subject'], '" size="50" style="width: 80%;" class="input_text">
+				</dd>
+				<dt>
+					<strong><label for="warn_temp">', $txt['profile_warning_notify_body'], ':</label></strong>
+				</dt>
+				<dd>
+					<select name="warn_temp" id="warn_temp" disabled onchange="populateNotifyTemplate();" style="font-size: x-small;">
+						<option value="-1">', $txt['profile_warning_notify_template'], '</option>
+						<option value="-1">------------------------------</option>';
 
 		foreach ($context['notification_templates'] as $id_template => $template)
 			echo '
-							<option value="', $id_template, '">', $template['title'], '</option>';
+						<option value="', $id_template, '">', $template['title'], '</option>';
 
 		echo '
-						</select>
-						<span class="smalltext" id="new_template_link" style="display: none;">[<a href="', $scripturl, '?action=moderate;area=warnings;sa=templateedit;tid=0" target="_blank" class="new_win">', $txt['profile_warning_new_template'], '</a>]</span><br />
-						<textarea name="warn_body" id="warn_body" cols="40" rows="8">', $context['warning_data']['notify_body'], '</textarea>
-					</dd>';
+					</select>
+					<span class="smalltext" id="new_template_link" style="display: none;">[<a href="', $scripturl, '?action=moderate;area=warnings;sa=templateedit;tid=0" target="_blank" class="new_win">', $txt['profile_warning_new_template'], '</a>]</span><br>
+					<textarea name="warn_body" id="warn_body" cols="40" rows="8" style="min-width: 50%; max-width: 99%;">', $context['warning_data']['notify_body'], '</textarea>
+				</dd>';
 	}
 	echo '
-				</dl>
-				<div class="righttext">
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="submit" name="save" value="', $context['user']['is_owner'] ? $txt['change_profile'] : $txt['profile_warning_issue'], '" class="button_submit" />
-				</div>
+			</dl>
+			<div class="righttext">';
+
+	if (!empty($context['token_check']))
+		echo '
+				<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">';
+
+	echo '
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="button" name="preview" id="preview_button" value="', $txt['preview'], '" class="button_submit">
+				<input type="submit" name="save" value="', $context['user']['is_owner'] ? $txt['change_profile'] : $txt['profile_warning_issue'], '" class="button_submit">
 			</div>
-			<span class="botslice"><span></span></span>
 		</div>
 	</form>';
 
 	// Previous warnings?
-	echo '<br />
-		<div class="cat_bar">
-			<h3 class="catbg">
-				', $txt['profile_warning_previous'], '
-			</h3>
-		</div>
-		<table border="0" width="100%" cellspacing="0" cellpadding="5" class="table_grid">
-			<thead>
-				<tr class="titlebg lefttext">
-					<th class="first_th" scope="col" width="20%">', $txt['profile_warning_previous_issued'], '</th>
-					<th scope="col" width="30%">', $txt['profile_warning_previous_time'], '</th>
-					<th scope="col">', $txt['profile_warning_previous_reason'], '</th>
-					<th class="last_th" scope="col" width="6%">', $txt['profile_warning_previous_level'], '</th>
-				</tr>
-			</thead>
-			<tbody>';
-
-	// Print the warnings.
-	$alternate = 0;
-	foreach ($context['previous_warnings'] as $warning)
-	{
-		$alternate = !$alternate;
-		echo '
-				<tr class="', $alternate ? 'windowbg' : 'windowbg2', '">
-					<td class="smalltext">', $warning['issuer']['link'], '</td>
-					<td class="smalltext">', $warning['time'], '</td>
-					<td class="smalltext">
-						<div class="floatleft">
-							', $warning['reason'], '
-						</div>';
-
-		if (!empty($warning['id_notice']))
-			echo '
-						<div class="floatright">
-							<a href="', $scripturl, '?action=moderate;area=notice;nid=', $warning['id_notice'], '" onclick="window.open(this.href, \'\', \'scrollbars=yes,resizable=yes,width=400,height=250\');return false;" target="_blank" class="new_win" title="', $txt['profile_warning_previous_notice'], '"><img src="', $settings['images_url'], '/filter.gif" alt="" /></a>
-						</div>';
-		echo '
-					</td>
-					<td class="smalltext">', $warning['counter'], '</td>
-				</tr>';
-	}
-
-	if (empty($context['previous_warnings']))
-		echo '
-				<tr class="windowbg2">
-					<td align="center" colspan="4">
-						', $txt['profile_warning_previous_none'], '
-					</td>
-				</tr>';
-
-	echo '
-			</tbody>
-		</table>
-		<div class="pagesection">', $txt['pages'], ': ', $context['page_index'], '</div>';
+	template_show_list('view_warnings');
 
-	// Do our best to get pretty javascript enabled.
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-		document.getElementById(\'warndiv1\').style.display = "";
-		document.getElementById(\'warndiv2\').style.display = "none";';
+	<script><!-- // --><![CDATA[';
 
 	if (!$context['user']['is_owner'])
 		echo '
-		modifyWarnNotify();';
+		modifyWarnNotify();
+		$(document).ready(function() {
+			$("#preview_button").click(function() {
+				return ajax_getTemplatePreview();
+			});
+		});
+
+		function ajax_getTemplatePreview ()
+		{
+			$.ajax({
+				type: "POST",
+				url: "' . $scripturl . '?action=xmlhttp;sa=previews;xml",
+				data: {item: "warning_preview", title: $("#warn_sub").val(), body: $("#warn_body").val(), issuing: true},
+				context: document.body,
+				success: function(request){
+					$("#box_preview").css({display:""});
+					$("#body_preview").html($(request).find(\'body\').text());
+					if ($(request).find("error").text() != \'\')
+					{
+						$("#profile_error").css({display:""});
+						var errors_html = \'<ul class="list_errors" class="reset">\';
+						var errors = $(request).find(\'error\').each(function() {
+							errors_html += \'<li>\' + $(this).text() + \'</li>\';
+						});
+						errors_html += \'</ul>\';
+
+						$("#profile_error").html(errors_html);
+					}
+					else
+					{
+						$("#profile_error").css({display:"none"});
+						$("#error_list").html(\'\');
+					}
+				return false;
+				},
+			});
+			return false;
+		}';
 
 	echo '
 	// ]]></script>';
@@ -2313,109 +2429,124 @@
 // Template to show for deleting a users account - now with added delete post capability!
 function template_deleteAccount()
 {
-	global $context, $settings, $options, $scripturl, $txt, $scripturl;
+	global $context, $scripturl, $txt;
 
 	// The main containing header.
 	echo '
 		<form action="', $scripturl, '?action=profile;area=deleteaccount;save" method="post" accept-charset="', $context['character_set'], '" name="creator" id="creator">
-			<div class="title_bar">
-				<h3 class="titlebg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />', $txt['deleteAccount'], '</span>
+			<div class="cat_bar">
+				<h3 class="catbg profile_hd">
+					', $txt['deleteAccount'], '
 				</h3>
 			</div>';
+
 	// If deleting another account give them a lovely info box.
 	if (!$context['user']['is_owner'])
 		echo '
-			<p class="windowbg2 description">', $txt['deleteAccount_desc'], '</p>';
+			<p class="information">', $txt['deleteAccount_desc'], '</p>';
 	echo '
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">';
+			<div class="windowbg2">';
 
 	// If they are deleting their account AND the admin needs to approve it - give them another piece of info ;)
 	if ($context['needs_approval'])
 		echo '
-					<div id ="profile_error" class="alert">', $txt['deleteAccount_approval'], '</div>';
+				<div class="errorbox">', $txt['deleteAccount_approval'], '</div>';
 
 	// If the user is deleting their own account warn them first - and require a password!
 	if ($context['user']['is_owner'])
 	{
 		echo '
-					<div class="alert">', $txt['own_profile_confirm'], '</div>
-					<div>
-						<strong', (isset($context['modify_error']['bad_password']) || isset($context['modify_error']['no_password']) ? ' class="error"' : ''), '>', $txt['current_password'], ': </strong>
-						<input type="password" name="oldpasswrd" size="20" class="input_password" />&nbsp;&nbsp;&nbsp;&nbsp;
-						<input type="submit" value="', $txt['yes'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="hidden" name="u" value="', $context['id_member'], '" />
-						<input type="hidden" name="sa" value="', $context['menu_item_selected'], '" />
-					</div>';
+				<div class="alert">', $txt['own_profile_confirm'], '</div>
+				<div>
+					<strong', (isset($context['modify_error']['bad_password']) || isset($context['modify_error']['no_password']) ? ' class="error"' : ''), '>', $txt['current_password'], ': </strong>
+					<input type="password" name="oldpasswrd" size="20" class="input_password">&nbsp;&nbsp;&nbsp;&nbsp;
+					<input type="submit" value="', $txt['yes'], '" class="button_submit">';
+
+		if (!empty($context['token_check']))
+			echo '
+				<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">';
+
+		echo '
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="u" value="', $context['id_member'], '">
+					<input type="hidden" name="sa" value="', $context['menu_item_selected'], '">
+				</div>';
 	}
 	// Otherwise an admin doesn't need to enter a password - but they still get a warning - plus the option to delete lovely posts!
 	else
 	{
 		echo '
-					<div class="alert">', $txt['deleteAccount_warning'], '</div>';
+				<div class="alert">', $txt['deleteAccount_warning'], '</div>';
 
 		// Only actually give these options if they are kind of important.
 		if ($context['can_delete_posts'])
 			echo '
-					<div>
-						', $txt['deleteAccount_posts'], ':
-						<select name="remove_type">
-							<option value="none">', $txt['deleteAccount_none'], '</option>
-							<option value="posts">', $txt['deleteAccount_all_posts'], '</option>
-							<option value="topics">', $txt['deleteAccount_topics'], '</option>
-						</select>
-					</div>';
+				<div>
+					<label for="deleteVotes"><input type="checkbox" name="deleteVotes" id="deleteVotes" value="1" class="input_check"> ', $txt['deleteAccount_votes'], ':</label><br>
+					<label for="deletePosts"><input type="checkbox" name="deletePosts" id="deletePosts" value="1" class="input_check"> ', $txt['deleteAccount_posts'], ':</label>
+					<select name="remove_type">
+						<option value="posts">', $txt['deleteAccount_all_posts'], '</option>
+						<option value="topics">', $txt['deleteAccount_topics'], '</option>
+					</select>
+				</div>';
 
 		echo '
-					<div>
-						<label for="deleteAccount"><input type="checkbox" name="deleteAccount" id="deleteAccount" value="1" class="input_check" onclick="if (this.checked) return confirm(\'', $txt['deleteAccount_confirm'], '\');" /> ', $txt['deleteAccount_member'], '.</label>
-					</div>
-					<div>
-						<input type="submit" value="', $txt['delete'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="hidden" name="u" value="', $context['id_member'], '" />
-						<input type="hidden" name="sa" value="', $context['menu_item_selected'], '" />
-					</div>';
+				<div>
+					<label for="deleteAccount"><input type="checkbox" name="deleteAccount" id="deleteAccount" value="1" class="input_check" onclick="if (this.checked) return confirm(\'', $txt['deleteAccount_confirm'], '\');"> ', $txt['deleteAccount_member'], '.</label>
+				</div>
+				<div>
+					<input type="submit" value="', $txt['delete'], '" class="button_submit">';
+
+		if (!empty($context['token_check']))
+			echo '
+				<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">';
+
+		echo '
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="u" value="', $context['id_member'], '">
+					<input type="hidden" name="sa" value="', $context['menu_item_selected'], '">
+				</div>';
 	}
 	echo '
-				</div>
-				<span class="botslice"><span></span></span>
 			</div>
-			<br />
+			<br>
 		</form>';
 }
 
 // Template for the password box/save button stuck at the bottom of every profile page.
 function template_profile_save()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 
 	echo '
 
-					<hr width="100%" size="1" class="hrcolor clear" />';
+					<hr width="100%" size="1" class="hrcolor clear">';
 
 	// Only show the password box if it's actually needed.
 	if ($context['require_password'])
 		echo '
 					<dl>
 						<dt>
-							<strong', isset($context['modify_error']['bad_password']) || isset($context['modify_error']['no_password']) ? ' class="error"' : '', '>', $txt['current_password'], ': </strong><br />
+							<strong', isset($context['modify_error']['bad_password']) || isset($context['modify_error']['no_password']) ? ' class="error"' : '', '>', $txt['current_password'], ': </strong><br>
 							<span class="smalltext">', $txt['required_security_reasons'], '</span>
 						</dt>
 						<dd>
-							<input type="password" name="oldpasswrd" size="20" style="margin-right: 4ex;" class="input_password" />
+							<input type="password" name="oldpasswrd" size="20" style="margin-right: 4ex;" class="input_password">
 						</dd>
 					</dl>';
 
 	echo '
-					<div class="righttext">
-						<input type="submit" value="', $txt['change_profile'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="hidden" name="u" value="', $context['id_member'], '" />
-						<input type="hidden" name="sa" value="', $context['menu_item_selected'], '" />
+					<div class="righttext">';
+
+		if (!empty($context['token_check']))
+			echo '
+				<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '">';
+
+	echo '
+						<input type="submit" value="', $txt['change_profile'], '" class="button_submit">
+						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+						<input type="hidden" name="u" value="', $context['id_member'], '">
+						<input type="hidden" name="sa" value="', $context['menu_item_selected'], '">
 					</div>';
 }
 
@@ -2425,17 +2556,24 @@
 	global $context, $txt;
 
 	echo '
-		<div class="windowbg" id="profile_error">
+		<div class="errorbox" ', empty($context['post_errors']) ? 'style="display:none" ' : '', 'id="profile_error">';
+
+	if (!empty($context['post_errors']))
+	{
+		echo '
 			<span>', !empty($context['custom_error_title']) ? $context['custom_error_title'] : $txt['profile_errors_occurred'], ':</span>
-			<ul class="reset">';
+			<ul id="list_errors">';
 
 		// Cycle through each error and display an error message.
 		foreach ($context['post_errors'] as $error)
 			echo '
-				<li>', isset($txt['profile_error_' . $error]) ? $txt['profile_error_' . $error] : $error, '.</li>';
+				<li>', isset($txt['profile_error_' . $error]) ? $txt['profile_error_' . $error] : $error, '</li>';
 
 		echo '
-			</ul>
+			</ul>';
+	}
+
+	echo '
 		</div>';
 }
 
@@ -2446,16 +2584,17 @@
 
 	echo '
 							<dt>
-								<strong>', $txt['primary_membergroup'], ': </strong><br />
-								<span class="smalltext">(<a href="', $scripturl, '?action=helpadmin;help=moderator_why_missing" onclick="return reqWin(this.href);">', $txt['moderator_why_missing'], '</a>)</span>
+								<strong>', $txt['primary_membergroup'], ': </strong><br>
+								<span class="smalltext">[<a href="', $scripturl, '?action=helpadmin;help=moderator_why_missing" onclick="return reqOverlayDiv(this.href);">', $txt['moderator_why_missing'], '</a>]</span>
 							</dt>
 							<dd>
 								<select name="id_group" ', ($context['user']['is_owner'] && $context['member']['group_id'] == 1 ? 'onchange="if (this.value != 1 &amp;&amp; !confirm(\'' . $txt['deadmin_confirm'] . '\')) this.value = 1;"' : ''), '>';
+
 		// Fill the select box with all primary member groups that can be assigned to a member.
 		foreach ($context['member_groups'] as $member_group)
 			if (!empty($member_group['can_be_primary']))
 				echo '
-									<option value="', $member_group['id'], '"', $member_group['is_primary'] ? ' selected="selected"' : '', '>
+									<option value="', $member_group['id'], '"', $member_group['is_primary'] ? ' selected' : '', '>
 										', $member_group['name'], '
 									</option>';
 		echo '
@@ -2466,16 +2605,17 @@
 							</dt>
 							<dd>
 								<span id="additional_groupsList">
-									<input type="hidden" name="additional_groups[]" value="0" />';
+									<input type="hidden" name="additional_groups[]" value="0">';
+
 		// For each membergroup show a checkbox so members can be assigned to more than one group.
 		foreach ($context['member_groups'] as $member_group)
 			if ($member_group['can_be_additional'])
 				echo '
-									<label for="additional_groups-', $member_group['id'], '"><input type="checkbox" name="additional_groups[]" value="', $member_group['id'], '" id="additional_groups-', $member_group['id'], '"', $member_group['is_additional'] ? ' checked="checked"' : '', ' class="input_check" /> ', $member_group['name'], '</label><br />';
+									<label for="additional_groups-', $member_group['id'], '"><input type="checkbox" name="additional_groups[]" value="', $member_group['id'], '" id="additional_groups-', $member_group['id'], '"', $member_group['is_additional'] ? ' checked' : '', ' class="input_check"> ', $member_group['name'], '</label><br>';
 		echo '
 								</span>
-								<a href="javascript:void(0);" onclick="document.getElementById(\'additional_groupsList\').style.display = \'block\'; document.getElementById(\'additional_groupsLink\').style.display = \'none\'; return false;" id="additional_groupsLink" style="display: none;">', $txt['additional_membergroups_show'], '</a>
-								<script type="text/javascript"><!-- // --><![CDATA[
+								<a href="javascript:void(0);" onclick="document.getElementById(\'additional_groupsList\').style.display = \'block\'; document.getElementById(\'additional_groupsLink\').style.display = \'none\'; return false;" id="additional_groupsLink" style="display: none;" class="toggle_down">', $txt['additional_membergroups_show'], '</a>
+								<script><!-- // --><![CDATA[
 									document.getElementById("additional_groupsList").style.display = "none";
 									document.getElementById("additional_groupsLink").style.display = "";
 								// ]]></script>
@@ -2491,85 +2631,75 @@
 	// Just show the pretty box!
 	echo '
 							<dt>
-								<strong>', $txt['dob'], ':</strong><br />
+								<strong>', $txt['dob'], ':</strong><br>
 								<span class="smalltext">', $txt['dob_year'], ' - ', $txt['dob_month'], ' - ', $txt['dob_day'], '</span>
 							</dt>
 							<dd>
-								<input type="text" name="bday3" size="4" maxlength="4" value="', $context['member']['birth_date']['year'], '" class="input_text" /> -
-								<input type="text" name="bday1" size="2" maxlength="2" value="', $context['member']['birth_date']['month'], '" class="input_text" /> -
-								<input type="text" name="bday2" size="2" maxlength="2" value="', $context['member']['birth_date']['day'], '" class="input_text" />
+								<input type="text" name="bday3" size="4" maxlength="4" value="', $context['member']['birth_date']['year'], '" class="input_text"> -
+								<input type="text" name="bday1" size="2" maxlength="2" value="', $context['member']['birth_date']['month'], '" class="input_text"> -
+								<input type="text" name="bday2" size="2" maxlength="2" value="', $context['member']['birth_date']['day'], '" class="input_text">
 							</dd>';
 }
 
 // Show the signature editing box?
 function template_profile_signature_modify()
 {
-	global $txt, $context, $settings;
+	global $txt, $context;
+
+	echo '
+							<dt id="current_signature" style="display:none">
+								<strong>', $txt['current_signature'], ':</strong>
+							</dt>
+							<dd id="current_signature_display" style="display:none">
+								<hr>
+							</dd>';
+	echo '
+							<dt id="preview_signature" style="display:none">
+								<strong>', $txt['signature_preview'], ':</strong>
+							</dt>
+							<dd id="preview_signature_display" style="display:none">
+								<hr>
+							</dd>';
 
 	echo '
 							<dt>
-								<strong>', $txt['signature'], ':</strong><br />
-								<span class="smalltext">', $txt['sig_info'], '</span><br />
-								<br />';
+								<strong>', $txt['signature'], ':</strong><br>
+								<span class="smalltext">', $txt['sig_info'], '</span><br>
+								<br>';
 
 	if ($context['show_spellchecking'])
 		echo '
-								<input type="button" value="', $txt['spell_check'], '" onclick="spellCheck(\'creator\', \'signature\');" class="button_submit" />';
+								<input type="button" value="', $txt['spell_check'], '" onclick="spellCheck(\'creator\', \'signature\');" class="button_submit">';
 
 		echo '
 							</dt>
 							<dd>
-								<textarea class="editor" onkeyup="calcCharLeft();" name="signature" rows="5" cols="50">', $context['member']['signature'], '</textarea><br />';
+								<textarea class="editor" onkeyup="calcCharLeft();" id="signature" name="signature" rows="5" cols="50" style="min-width: 50%; max-width: 99%;">', $context['member']['signature'], '</textarea><br>';
 
 	// If there is a limit at all!
 	if (!empty($context['signature_limits']['max_length']))
 		echo '
-								<span class="smalltext">', sprintf($txt['max_sig_characters'], $context['signature_limits']['max_length']), ' <span id="signatureLeft">', $context['signature_limits']['max_length'], '</span></span><br />';
+								<span class="smalltext">', sprintf($txt['max_sig_characters'], $context['signature_limits']['max_length']), ' <span id="signatureLeft">', $context['signature_limits']['max_length'], '</span></span><br>';
 
-	if ($context['signature_warning'])
+	if (!empty($context['show_preview_button']))
 		echo '
-								<span class="smalltext">', $context['signature_warning'], '</span>';
+						<input type="button" name="preview_signature" id="preview_button" value="', $txt['preview_signature'], '" class="button_submit">';
 
-	// Load the spell checker?
-	if ($context['show_spellchecking'])
+	if ($context['signature_warning'])
 		echo '
-								<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/spellcheck.js"></script>';
+								<span class="smalltext">', $context['signature_warning'], '</span>';
 
 	// Some javascript used to count how many characters have been used so far in the signature.
 	echo '
-								<script type="text/javascript"><!-- // --><![CDATA[
-									function tick()
-									{
-										if (typeof(document.forms.creator) != "undefined")
-										{
-											calcCharLeft();
-											setTimeout("tick()", 1000);
-										}
-										else
-											setTimeout("tick()", 800);
-									}
-
-									function calcCharLeft()
-									{
-										var maxLength = ', $context['signature_limits']['max_length'], ';
-										var oldSignature = "", currentSignature = document.forms.creator.signature.value;
-
-										if (!document.getElementById("signatureLeft"))
-											return;
-
-										if (oldSignature != currentSignature)
-										{
-											oldSignature = currentSignature;
-
-											if (currentSignature.replace(/\r/, "").length > maxLength)
-												document.forms.creator.signature.value = currentSignature.replace(/\r/, "").substring(0, maxLength);
-											currentSignature = document.forms.creator.signature.value.replace(/\r/, "");
-										}
-
-										setInnerHTML(document.getElementById("signatureLeft"), maxLength - currentSignature.length);
-									}
+								<script><!-- // --><![CDATA[
+									var maxLength = ', $context['signature_limits']['max_length'], ';
 
-									addLoadEvent(tick);
+									$(document).ready(function() {
+										calcCharLeft();
+										$("#preview_button").click(function() {
+											return ajax_getSignaturePreview(true);
+										});
+									});
 								// ]]></script>
 							</dd>';
 }
@@ -2581,11 +2711,12 @@
 	// Start with the upper menu
 	echo '
 							<dt>
-								<strong id="personal_picture">', $txt['personal_picture'], '</strong>
-								<input type="radio" onclick="swap_avatar(this); return true;" name="avatar_choice" id="avatar_choice_none" value="none"' . ($context['member']['avatar']['choice'] == 'none' ? ' checked="checked"' : '') . ' class="input_radio" /><label for="avatar_choice_none"' . (isset($context['modify_error']['bad_avatar']) ? ' class="error"' : '') . '>' . $txt['no_avatar'] . '</label><br />
+								<strong id="personal_picture"><label for="avatar_upload_box">', $txt['personal_picture'], '</label></strong>
+								', empty($modSettings['gravatarOverride']) ? '<input type="radio" onclick="swap_avatar(this); return true;" name="avatar_choice" id="avatar_choice_none" value="none"' . ($context['member']['avatar']['choice'] == 'none' ? ' checked="checked"' : '') . ' class="input_radio" /><label for="avatar_choice_none"' . (isset($context['modify_error']['bad_avatar']) ? ' class="error"' : '') . '>' . $txt['no_avatar'] . '</label><br />' : '', '
 								', !empty($context['member']['avatar']['allow_server_stored']) ? '<input type="radio" onclick="swap_avatar(this); return true;" name="avatar_choice" id="avatar_choice_server_stored" value="server_stored"' . ($context['member']['avatar']['choice'] == 'server_stored' ? ' checked="checked"' : '') . ' class="input_radio" /><label for="avatar_choice_server_stored"' . (isset($context['modify_error']['bad_avatar']) ? ' class="error"' : '') . '>' . $txt['choose_avatar_gallery'] . '</label><br />' : '', '
 								', !empty($context['member']['avatar']['allow_external']) ? '<input type="radio" onclick="swap_avatar(this); return true;" name="avatar_choice" id="avatar_choice_external" value="external"' . ($context['member']['avatar']['choice'] == 'external' ? ' checked="checked"' : '') . ' class="input_radio" /><label for="avatar_choice_external"' . (isset($context['modify_error']['bad_avatar']) ? ' class="error"' : '') . '>' . $txt['my_own_pic'] . '</label><br />' : '', '
-								', !empty($context['member']['avatar']['allow_upload']) ? '<input type="radio" onclick="swap_avatar(this); return true;" name="avatar_choice" id="avatar_choice_upload" value="upload"' . ($context['member']['avatar']['choice'] == 'upload' ? ' checked="checked"' : '') . ' class="input_radio" /><label for="avatar_choice_upload"' . (isset($context['modify_error']['bad_avatar']) ? ' class="error"' : '') . '>' . $txt['avatar_will_upload'] . '</label>' : '', '
+								', !empty($context['member']['avatar']['allow_upload']) ? '<input type="radio" onclick="swap_avatar(this); return true;" name="avatar_choice" id="avatar_choice_upload" value="upload"' . ($context['member']['avatar']['choice'] == 'upload' ? ' checked="checked"' : '') . ' class="input_radio" /><label for="avatar_choice_upload"' . (isset($context['modify_error']['bad_avatar']) ? ' class="error"' : '') . '>' . $txt['avatar_will_upload'] . '</label><br />' : '', '
+								', !empty($context['member']['avatar']['allow_gravatar']) ? '<input type="radio" onclick="swap_avatar(this); return true;" name="avatar_choice" id="avatar_choice_gravatar" value="gravatar"'. ($context['member']['avatar']['choice'] == 'gravatar' ? ' checked="checked"' : '') . ' class="input_radio" /><label for="avatar_choice_gravatar"' . (isset($context['modify_error']['bad_avatar']) ? ' class="error"' : '') . '>' . $txt['use_gravatar'] . '</label>' : '', '
 							</dt>
 							<dd>';
 
@@ -2596,18 +2727,18 @@
 								<div id="avatar_server_stored">
 									<div>
 										<select name="cat" id="cat" size="10" onchange="changeSel(\'\');" onfocus="selectRadioByName(document.forms.creator.avatar_choice, \'server_stored\');">';
-		// This lists all the file catergories.
+		// This lists all the file categories.
 		foreach ($context['avatars'] as $avatar)
 			echo '
-											<option value="', $avatar['filename'] . ($avatar['is_dir'] ? '/' : ''), '"', ($avatar['checked'] ? ' selected="selected"' : ''), '>', $avatar['name'], '</option>';
+											<option value="', $avatar['filename'] . ($avatar['is_dir'] ? '/' : ''), '"', ($avatar['checked'] ? ' selected' : ''), '>', $avatar['name'], '</option>';
 		echo '
 										</select>
 									</div>
 									<div>
-										<select name="file" id="file" size="10" style="display: none;" onchange="showAvatar()" onfocus="selectRadioByName(document.forms.creator.avatar_choice, \'server_stored\');" disabled="disabled"><option></option></select>
+										<select name="file" id="file" size="10" style="display: none;" onchange="showAvatar()" onfocus="selectRadioByName(document.forms.creator.avatar_choice, \'server_stored\');" disabled><option></option></select>
 									</div>
-									<div><img name="avatar" id="avatar" src="', !empty($context['member']['avatar']['allow_external']) && $context['member']['avatar']['choice'] == 'external' ? $context['member']['avatar']['external'] : $modSettings['avatar_url'] . '/blank.gif', '" alt="Do Nothing" /></div>
-									<script type="text/javascript"><!-- // --><![CDATA[
+									<div><img name="avatar" id="avatar" src="', !empty($context['member']['avatar']['allow_external']) && $context['member']['avatar']['choice'] == 'external' ? $context['member']['avatar']['external'] : $modSettings['avatar_url'] . '/blank.png', '" alt="Do Nothing"></div>
+									<script><!-- // --><![CDATA[
 										var files = ["' . implode('", "', $context['avatar_list']) . '"];
 										var avatar = document.getElementById("avatar");
 										var cat = document.getElementById("cat");
@@ -2615,97 +2746,14 @@
 										var avatardir = "' . $modSettings['avatar_url'] . '/";
 										var size = avatar.alt.substr(3, 2) + " " + avatar.alt.substr(0, 2) + String.fromCharCode(117, 98, 116);
 										var file = document.getElementById("file");
+										var maxHeight = ', !empty($modSettings['avatar_max_height_external']) ? $modSettings['avatar_max_height_external'] : 0, ';
+										var maxWidth = ', !empty($modSettings['avatar_max_width_external']) ? $modSettings['avatar_max_width_external'] : 0, ';
 
-										if (avatar.src.indexOf("blank.gif") > -1)
+										if (avatar.src.indexOf("blank.png") > -1)
 											changeSel(selavatar);
 										else
 											previewExternalAvatar(avatar.src)
 
-										function changeSel(selected)
-										{
-											if (cat.selectedIndex == -1)
-												return;
-
-											if (cat.options[cat.selectedIndex].value.indexOf("/") > 0)
-											{
-												var i;
-												var count = 0;
-
-												file.style.display = "inline";
-												file.disabled = false;
-
-												for (i = file.length; i >= 0; i = i - 1)
-													file.options[i] = null;
-
-												for (i = 0; i < files.length; i++)
-													if (files[i].indexOf(cat.options[cat.selectedIndex].value) == 0)
-													{
-														var filename = files[i].substr(files[i].indexOf("/") + 1);
-														var showFilename = filename.substr(0, filename.lastIndexOf("."));
-														showFilename = showFilename.replace(/[_]/g, " ");
-
-														file.options[count] = new Option(showFilename, files[i]);
-
-														if (filename == selected)
-														{
-															if (file.options.defaultSelected)
-																file.options[count].defaultSelected = true;
-															else
-																file.options[count].selected = true;
-														}
-
-														count++;
-													}
-
-												if (file.selectedIndex == -1 && file.options[0])
-													file.options[0].selected = true;
-
-												showAvatar();
-											}
-											else
-											{
-												file.style.display = "none";
-												file.disabled = true;
-												document.getElementById("avatar").src = avatardir + cat.options[cat.selectedIndex].value;
-												document.getElementById("avatar").style.width = "";
-												document.getElementById("avatar").style.height = "";
-											}
-										}
-
-										function showAvatar()
-										{
-											if (file.selectedIndex == -1)
-												return;
-
-											document.getElementById("avatar").src = avatardir + file.options[file.selectedIndex].value;
-											document.getElementById("avatar").alt = file.options[file.selectedIndex].text;
-											document.getElementById("avatar").alt += file.options[file.selectedIndex].text == size ? "!" : "";
-											document.getElementById("avatar").style.width = "";
-											document.getElementById("avatar").style.height = "";
-										}
-
-										function previewExternalAvatar(src)
-										{
-											if (!document.getElementById("avatar"))
-												return;
-
-											var maxHeight = ', !empty($modSettings['avatar_max_height_external']) ? $modSettings['avatar_max_height_external'] : 0, ';
-											var maxWidth = ', !empty($modSettings['avatar_max_width_external']) ? $modSettings['avatar_max_width_external'] : 0, ';
-											var tempImage = new Image();
-
-											tempImage.src = src;
-											if (maxWidth != 0 && tempImage.width > maxWidth)
-											{
-												document.getElementById("avatar").style.height = parseInt((maxWidth * tempImage.height) / tempImage.width) + "px";
-												document.getElementById("avatar").style.width = maxWidth + "px";
-											}
-											else if (maxHeight != 0 && tempImage.height > maxHeight)
-											{
-												document.getElementById("avatar").style.width = parseInt((maxHeight * tempImage.width) / tempImage.height) + "px";
-												document.getElementById("avatar").style.height = maxHeight + "px";
-											}
-											document.getElementById("avatar").src = src;
-										}
 									// ]]></script>
 								</div>';
 	}
@@ -2715,8 +2763,8 @@
 	{
 		echo '
 								<div id="avatar_external">
-									<div class="smalltext">', $txt['avatar_by_url'], '</div>
-									<input type="text" name="userpicpersonal" size="45" value="', $context['member']['avatar']['external'], '" onfocus="selectRadioByName(document.forms.creator.avatar_choice, \'external\');" onchange="if (typeof(previewExternalAvatar) != \'undefined\') previewExternalAvatar(this.value);" class="input_text" />
+									<div class="smalltext">', $txt['avatar_by_url'], '</div>', !empty($modSettings['avatar_action_too_large']) && $modSettings['avatar_action_too_large'] == 'option_download_and_resize' ? template_max_size('external') : '', '
+									<input type="text" name="userpicpersonal" size="45" value="', (!stristr($context['member']['avatar']['external'], 'gravatar://www.gravatar.com/avatar/') ? $context['member']['avatar']['external'] : 'http://'), '" onfocus="selectRadioByName(document.forms.creator.avatar_choice, \'external\');" onchange="if (typeof(previewExternalAvatar) != \'undefined\') previewExternalAvatar(this.value);" class="input_text" />
 								</div>';
 	}
 
@@ -2725,16 +2773,43 @@
 	{
 		echo '
 								<div id="avatar_upload">
-									<input type="file" size="44" name="attachment" value="" onfocus="selectRadioByName(document.forms.creator.avatar_choice, \'upload\');" class="input_file" />
-									', ($context['member']['avatar']['id_attach'] > 0 ? '<br /><br /><img src="' . $context['member']['avatar']['href'] . (strpos($context['member']['avatar']['href'], '?') === false ? '?' : '&amp;') . 'time=' . time() . '" alt="" /><input type="hidden" name="id_attach" value="' . $context['member']['avatar']['id_attach'] . '" />' : ''), '
+									<input type="file" size="44" name="attachment" id="avatar_upload_box" value="" onfocus="selectRadioByName(document.forms.creator.avatar_choice, \'upload\');" class="input_file" accept="image/gif, image/jpeg, image/jpg, image/png">', template_max_size('upload'), '
+									', (!empty($context['member']['avatar']['id_attach']) ? '<br><img src="' . $context['member']['avatar']['href'] . (strpos($context['member']['avatar']['href'], '?') === false ? '?' : '&amp;') . 'time=' . time() . '" alt=""><input type="hidden" name="id_attach" value="' . $context['member']['avatar']['id_attach'] . '">' : ''), '
+								</div>';
+	}
+
+	// if the user is able to use Gravatar avatars show then the image preview
+	if (!empty($context['member']['avatar']['allow_gravatar']))
+	{
+		echo '
+								<div id="avatar_gravatar">
+									<img src="' . $context['member']['avatar']['href'] . '" alt="" />';
+
+		if (empty($modSettings['gravatarAllowExtraEmail']))
+			echo '
+									<div class="smalltext">', $txt['gravatar_noAlternateEmail'], '</div>';
+		else
+		{
+			// Depending on other stuff, the stored value here might have some odd things in it from other areas.
+			if ($context['member']['avatar']['external'] == $context['member']['email'])
+				$textbox_value = '';
+			else
+				$textbox_value = $context['member']['avatar']['external'];
+
+			echo '
+									<div class="smalltext">', $txt['gravatar_alternateEmail'], '</div>
+									<input type="text" name="gravatarEmail" id="gravatarEmail" size="45" value="', $textbox_value, '" class="input_text" />';
+		}
+		echo '
 								</div>';
 	}
 
 	echo '
-								<script type="text/javascript"><!-- // --><![CDATA[
+								<script><!-- // --><![CDATA[
 									', !empty($context['member']['avatar']['allow_server_stored']) ? 'document.getElementById("avatar_server_stored").style.display = "' . ($context['member']['avatar']['choice'] == 'server_stored' ? '' : 'none') . '";' : '', '
 									', !empty($context['member']['avatar']['allow_external']) ? 'document.getElementById("avatar_external").style.display = "' . ($context['member']['avatar']['choice'] == 'external' ? '' : 'none') . '";' : '', '
 									', !empty($context['member']['avatar']['allow_upload']) ? 'document.getElementById("avatar_upload").style.display = "' . ($context['member']['avatar']['choice'] == 'upload' ? '' : 'none') . '";' : '', '
+									', !empty($context['member']['avatar']['allow_gravatar']) ? 'document.getElementById("avatar_gravatar").style.display = "' . ($context['member']['avatar']['choice'] == 'gravatar' ? '' : 'none') . '";' : '', '
 
 									function swap_avatar(type)
 									{
@@ -2744,21 +2819,33 @@
 												', !empty($context['member']['avatar']['allow_server_stored']) ? 'document.getElementById("avatar_server_stored").style.display = "";' : '', '
 												', !empty($context['member']['avatar']['allow_external']) ? 'document.getElementById("avatar_external").style.display = "none";' : '', '
 												', !empty($context['member']['avatar']['allow_upload']) ? 'document.getElementById("avatar_upload").style.display = "none";' : '', '
+												', !empty($context['member']['avatar']['allow_gravatar']) ? 'document.getElementById("avatar_gravatar").style.display = "none";' : '', '
 												break;
 											case "avatar_choice_external":
 												', !empty($context['member']['avatar']['allow_server_stored']) ? 'document.getElementById("avatar_server_stored").style.display = "none";' : '', '
 												', !empty($context['member']['avatar']['allow_external']) ? 'document.getElementById("avatar_external").style.display = "";' : '', '
 												', !empty($context['member']['avatar']['allow_upload']) ? 'document.getElementById("avatar_upload").style.display = "none";' : '', '
+												', !empty($context['member']['avatar']['allow_gravatar']) ? 'document.getElementById("avatar_gravatar").style.display = "none";' : '', '
 												break;
 											case "avatar_choice_upload":
 												', !empty($context['member']['avatar']['allow_server_stored']) ? 'document.getElementById("avatar_server_stored").style.display = "none";' : '', '
 												', !empty($context['member']['avatar']['allow_external']) ? 'document.getElementById("avatar_external").style.display = "none";' : '', '
 												', !empty($context['member']['avatar']['allow_upload']) ? 'document.getElementById("avatar_upload").style.display = "";' : '', '
+												', !empty($context['member']['avatar']['allow_gravatar']) ? 'document.getElementById("avatar_gravatar").style.display = "none";' : '', '
 												break;
 											case "avatar_choice_none":
 												', !empty($context['member']['avatar']['allow_server_stored']) ? 'document.getElementById("avatar_server_stored").style.display = "none";' : '', '
 												', !empty($context['member']['avatar']['allow_external']) ? 'document.getElementById("avatar_external").style.display = "none";' : '', '
 												', !empty($context['member']['avatar']['allow_upload']) ? 'document.getElementById("avatar_upload").style.display = "none";' : '', '
+												', !empty($context['member']['avatar']['allow_gravatar']) ? 'document.getElementById("avatar_gravatar").style.display = "none";' : '', '
+												break;
+											case "avatar_choice_gravatar":
+												', !empty($context['member']['avatar']['allow_server_stored']) ? 'document.getElementById("avatar_server_stored").style.display = "none";' : '', '
+												', !empty($context['member']['avatar']['allow_external']) ? 'document.getElementById("avatar_external").style.display = "none";' : '', '
+												', !empty($context['member']['avatar']['allow_upload']) ? 'document.getElementById("avatar_upload").style.display = "none";' : '', '
+												', !empty($context['member']['avatar']['allow_gravatar']) ? 'document.getElementById("avatar_gravatar").style.display = "";' : '', '
+												', ($context['member']['avatar']['external'] == $context['member']['email'] || strstr($context['member']['avatar']['external'], 'http://')) ?
+												'document.getElementById("gravatarEmail").value = "";' : '', '
 												break;
 										}
 									}
@@ -2766,56 +2853,42 @@
 							</dd>';
 }
 
-// Callback for modifying karam.
-function template_profile_karma_modify()
+// This is just a really little helper to avoid duplicating code unnecessarily
+function template_max_size($type)
 {
-	global $context, $modSettings, $txt;
+	global $modSettings, $txt;
 
-		echo '
-							<dt>
-								<strong>', $modSettings['karmaLabel'], '</strong>
-							</dt>
-							<dd>
-								', $modSettings['karmaApplaudLabel'], ' <input type="text" name="karma_good" size="4" value="', $context['member']['karma']['good'], '" onchange="setInnerHTML(document.getElementById(\'karmaTotal\'), this.value - this.form.karma_bad.value);" style="margin-right: 2ex;" class="input_text" /> ', $modSettings['karmaSmiteLabel'], ' <input type="text" name="karma_bad" size="4" value="', $context['member']['karma']['bad'], '" onchange="this.form.karma_good.onchange();" class="input_text" /><br />
-								(', $txt['total'], ': <span id="karmaTotal">', ($context['member']['karma']['good'] - $context['member']['karma']['bad']), '</span>)
-							</dd>';
+	$w = !empty($modSettings['avatar_max_width_' . $type]) ? comma_format($modSettings['avatar_max_width_' . $type]) : 0;
+	$h = !empty($modSettings['avatar_max_height_' . $type]) ? comma_format($modSettings['avatar_max_height_' . $type]) : 0;
+
+	$suffix = (!empty($w) ? 'w' : '') . (!empty($h) ? 'h' : '');
+	if (empty($suffix))
+		return;
+
+	echo '
+									<div class="smalltext">', sprintf($txt['avatar_max_size_' . $suffix], $w, $h), '</div>';
 }
 
 // Select the time format!
 function template_profile_timeformat_modify()
 {
-	global $context, $modSettings, $txt, $scripturl, $settings;
+	global $context, $txt, $scripturl, $settings;
 
 	echo '
 							<dt>
-								<strong>', $txt['time_format'], ':</strong><br />
-								<a href="', $scripturl, '?action=helpadmin;help=time_format" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" class="floatleft" /></a>
-								<span class="smalltext">&nbsp;', $txt['date_format'], '</span>
+								<strong><label for="easyformat">', $txt['time_format'], ':</label></strong><br>
+								<a href="', $scripturl, '?action=helpadmin;help=time_format" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a>
+								<span class="smalltext">&nbsp;<label for="time_format">', $txt['date_format'], '</label></span>
 							</dt>
 							<dd>
-								<select name="easyformat" onchange="document.forms.creator.time_format.value = this.options[this.selectedIndex].value;" style="margin-bottom: 4px;">';
+								<select name="easyformat" id="easyformat" onchange="document.forms.creator.time_format.value = this.options[this.selectedIndex].value;" style="margin-bottom: 4px;">';
 	// Help the user by showing a list of common time formats.
 	foreach ($context['easy_timeformats'] as $time_format)
 		echo '
-									<option value="', $time_format['format'], '"', $time_format['format'] == $context['member']['time_format'] ? ' selected="selected"' : '', '>', $time_format['title'], '</option>';
-	echo '
-								</select><br />
-								<input type="text" name="time_format" value="', $context['member']['time_format'], '" size="30" class="input_text" />
-							</dd>';
-}
-
-// Time offset?
-function template_profile_timeoffset_modify()
-{
-	global $txt, $context;
-
+									<option value="', $time_format['format'], '"', $time_format['format'] == $context['member']['time_format'] ? ' selected' : '', '>', $time_format['title'], '</option>';
 	echo '
-							<dt>
-								<strong', (isset($context['modify_error']['bad_offset']) ? ' class="error"' : ''), '>', $txt['time_offset'], ':</strong><br />
-								<span class="smalltext">', $txt['personal_time_offset'], '</span>
-							</dt>
-							<dd>
-								<input type="text" name="time_offset" id="time_offset" size="5" maxlength="5" value="', $context['member']['time_offset'], '" class="input_text" /> <a href="javascript:void(0);" onclick="currentDate = new Date(', $context['current_forum_time_js'], '); document.getElementById(\'time_offset\').value = autoDetectTimeOffset(currentDate); return false;">', $txt['timeoffset_autodetect'], '</a><br />', $txt['current_time'], ': <em>', $context['current_forum_time'], '</em>
+								</select><br>
+								<input type="text" name="time_format" id="time_format" value="', $context['member']['time_format'], '" size="30" class="input_text">
 							</dd>';
 }
 
@@ -2829,7 +2902,7 @@
 								<strong>', $txt['current_theme'], ':</strong>
 							</dt>
 							<dd>
-								', $context['member']['theme']['name'], ' <a href="', $scripturl, '?action=theme;sa=pick;u=', $context['id_member'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['change'], '</a>
+								', $context['member']['theme']['name'], ' [<a href="', $scripturl, '?action=theme;sa=pick;u=', $context['id_member'], ';', $context['session_var'], '=', $context['session_id'], '">', $txt['change'], '</a>]
 							</dd>';
 }
 
@@ -2840,143 +2913,106 @@
 
 	echo '
 							<dt>
-								<strong>', $txt['smileys_current'], ':</strong>
+								<strong><label for="smiley_set">', $txt['smileys_current'], ':</label></strong>
 							</dt>
 							<dd>
-								<select name="smiley_set" onchange="document.getElementById(\'smileypr\').src = this.selectedIndex == 0 ? \'', $settings['images_url'], '/blank.gif\' : \'', $modSettings['smileys_url'], '/\' + (this.selectedIndex != 1 ? this.options[this.selectedIndex].value : \'', !empty($settings['smiley_sets_default']) ? $settings['smiley_sets_default'] : $modSettings['smiley_sets_default'], '\') + \'/smiley.gif\';">';
+								<select name="smiley_set" id="smiley_set" onchange="document.getElementById(\'smileypr\').src = this.selectedIndex == 0 ? \'', $settings['images_url'], '/blank.png\' : \'', $modSettings['smileys_url'], '/\' + (this.selectedIndex != 1 ? this.options[this.selectedIndex].value : \'', !empty($settings['smiley_sets_default']) ? $settings['smiley_sets_default'] : $modSettings['smiley_sets_default'], '\') + \'/smiley.gif\';">';
 	foreach ($context['smiley_sets'] as $set)
 		echo '
-									<option value="', $set['id'], '"', $set['selected'] ? ' selected="selected"' : '', '>', $set['name'], '</option>';
+									<option value="', $set['id'], '"', $set['selected'] ? ' selected' : '', '>', $set['name'], '</option>';
 	echo '
-								</select> <img id="smileypr" src="', $context['member']['smiley_set']['id'] != 'none' ? $modSettings['smileys_url'] . '/' . ($context['member']['smiley_set']['id'] != '' ? $context['member']['smiley_set']['id'] : (!empty($settings['smiley_sets_default']) ? $settings['smiley_sets_default'] : $modSettings['smiley_sets_default'])) . '/smiley.gif' : $settings['images_url'] . '/blank.gif', '" alt=":)" align="top" style="padding-left: 20px;" />
+								</select> <img id="smileypr" class="centericon" src="', $context['member']['smiley_set']['id'] != 'none' ? $modSettings['smileys_url'] . '/' . ($context['member']['smiley_set']['id'] != '' ? $context['member']['smiley_set']['id'] : (!empty($settings['smiley_sets_default']) ? $settings['smiley_sets_default'] : $modSettings['smiley_sets_default'])) . '/smiley.gif' : $settings['images_url'] . '/blank.png', '" alt=":)"  style="padding-left: 20px;">
 							</dd>';
 }
 
-// Change the way you login to the forum.
-function template_authentication_method()
+function template_tfasetup()
 {
-	global $context, $settings, $options, $scripturl, $modSettings, $txt;
+	global $txt, $context, $scripturl, $modSettings;
 
-	// The main header!
 	echo '
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/register.js"></script>
-		<form action="', $scripturl, '?action=profile;area=authentication;save" method="post" accept-charset="', $context['character_set'], '" name="creator" id="creator" enctype="multipart/form-data">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/profile_sm.gif" alt="" class="icon" />', $txt['authentication'], '</span>
-				</h3>
-			</div>
-			<p class="windowbg description">', $txt['change_authentication'], '</p>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl>
-						<dt>
-							<input type="radio" onclick="updateAuthMethod();" name="authenticate" value="openid" id="auth_openid"', $context['auth_method'] == 'openid' ? ' checked="checked"' : '', ' class="input_radio" /><label for="auth_openid"><strong>', $txt['authenticate_openid'], '</strong></label>&nbsp;<em><a href="', $scripturl, '?action=helpadmin;help=register_openid" onclick="return reqWin(this.href);" class="help">(?)</a></em><br />
-							<input type="radio" onclick="updateAuthMethod();" name="authenticate" value="passwd" id="auth_pass"', $context['auth_method'] == 'password' ? ' checked="checked"' : '', ' class="input_radio" /><label for="auth_pass"><strong>', $txt['authenticate_password'], '</strong></label>
-						</dt>
-						<dd>
-							<dl id="auth_openid_div">
-								<dt>
-									<em>', $txt['authenticate_openid_url'], ':</em>
-								</dt>
-								<dd>
-									<input type="text" name="openid_identifier" id="openid_url" size="30" tabindex="', $context['tabindex']++, '" value="', $context['member']['openid_uri'], '" class="input_text openid_login" />
-								</dd>
-							</dl>
-							<dl id="auth_pass_div">
-								<dt>
-									<em>', $txt['choose_pass'], ':</em>
-								</dt>
-								<dd>
-									<input type="password" name="passwrd1" id="smf_autov_pwmain" size="30" tabindex="', $context['tabindex']++, '" class="input_password" />
-									<span id="smf_autov_pwmain_div" style="display: none;"><img id="smf_autov_pwmain_img" src="', $settings['images_url'], '/icons/field_invalid.gif" alt="*" /></span>
-								</dd>
-								<dt>
-									<em>', $txt['verify_pass'], ':</em>
-								</dt>
-								<dd>
-									<input type="password" name="passwrd2" id="smf_autov_pwverify" size="30" tabindex="', $context['tabindex']++, '" class="input_password" />
-									<span id="smf_autov_pwverify_div" style="display: none;"><img id="smf_autov_pwverify_img" src="', $settings['images_url'], '/icons/field_valid.gif" alt="*" /></span>
-								</dd>
-							</dl>
-						</dd>
-					</dl>';
+							<div class="cat_bar">
+								<h3 class="catbg">', $txt['tfa_title'], '</h3>
+							</div>
+							<div class="roundframe">
+								<div>
+		', !empty($context['tfa_backup']) ? '
+									<div class="smalltext error">' . $txt['tfa_backup_used_desc'] . '</div>' :
+			($modSettings['tfa_mode'] == 2 ? '
+									<div class="smalltext"><strong>' . $txt['tfa_forced_desc'] . '</strong></div>' : ''), '
+									<div class="smalltext">', $txt['tfa_desc'], '</div>
+									<div id="basicinfo" style="width: 60%">
+										<form action="', $scripturl, '?action=profile;area=tfasetup" method="post">
+											<div>
+												<strong>', $txt['tfa_step1'], '</strong><br />
+												', !empty($context['tfa_pass_error']) ? '<div class="error smalltext">' . $txt['tfa_pass_invalid'] . '</div>' : '', '
+												<input type="password" name="passwd" style="width: 200px;"', !empty($context['tfa_pass_error']) ? ' class="error"' : '', !empty($context['tfa_pass_value']) ? ' value="' . $context['tfa_pass_value'] . '"' : '' ,'>
+											</div>
+											<div>
+												<strong>', $txt['tfa_step2'], '</strong>
+												<div class="smalltext">', $txt['tfa_step2_desc'], '</div>
+												<div class="bbc_code" style="resize: none; border: none;">', $context['tfa_secret'], '</div>
+											</div>
+											<div style="margin-top: 10px;">
+												<strong>', $txt['tfa_step3'] , '</strong><br />
+												', !empty($context['tfa_error']) ? '<div class="error smalltext">' . $txt['tfa_code_invalid'] . '</div>' : '', '
+												<input type="text" name="tfa_code" style="width: 200px;"', !empty($context['tfa_error']) ? ' class="error"' : '', !empty($context['tfa_value']) ? ' value="' . $context['tfa_value'] . '"' : '' ,'>
+												<input type="submit" name="save" value="', $txt['tfa_enable'], '" class="button_submit" style="float: none;" />
+											</div>
+											<input type="hidden" name="', $context[$context['token_check'] . '_token_var'], '" value="', $context[$context['token_check'] . '_token'], '" />
+											<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+										</form>
+									</div>
+									<div id="detailedinfo" style="width: 30%;">
+										<img src="', $context['tfa_qr_url'], '" alt="" style="max-width: 120px;" />
+									</div>
+									<div class="clear"></div>';
 
-	if ($context['require_password'])
+	if (!empty($context['from_ajax']))
 		echo '
-					<hr width="100%" size="1" class="hrcolor clear" />
-					<dl>
-						<dt>
-							<strong', isset($context['modify_error']['bad_password']) || isset($context['modify_error']['no_password']) ? ' class="error"' : '', '>', $txt['current_password'], ': </strong><br />
-							<span class="smalltext">', $txt['required_security_reasons'], '</span>
-						</dt>
-						<dd>
-							<input type="password" name="oldpasswrd" size="20" style="margin-right: 4ex;" class="input_password" />
-						</dd>
-					</dl>';
-
-echo '
-					<div class="righttext">
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-						<input type="hidden" name="u" value="', $context['id_member'], '" />
-						<input type="hidden" name="sa" value="', $context['menu_item_selected'], '" />
-						<input type="submit" value="', $txt['change_profile'], '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-		</form>';
+									<br>
+									<a href="javascript:self.close();"></a>';
 
-	// The password stuff.
 	echo '
-	<script type="text/javascript"><!-- // --><![CDATA[
-	var regTextStrings = {
-		"password_short": "', $txt['registration_password_short'], '",
-		"password_reserved": "', $txt['registration_password_reserved'], '",
-		"password_numbercase": "', $txt['registration_password_numbercase'], '",
-		"password_no_match": "', $txt['registration_password_no_match'], '",
-		"password_valid": "', $txt['registration_password_valid'], '"
-	};
-	var verificationHandle = new smfRegister("creator", ', empty($modSettings['password_strength']) ? 0 : $modSettings['password_strength'], ', regTextStrings);
-	var currentAuthMethod = \'passwd\';
-	function updateAuthMethod()
-	{
-		// What authentication method is being used?
-		if (!document.getElementById(\'auth_openid\') || !document.getElementById(\'auth_openid\').checked)
-			currentAuthMethod = \'passwd\';
-		else
-			currentAuthMethod = \'openid\';
+								</div>
+							</div>';
+}
 
-		// No openID?
-		if (!document.getElementById(\'auth_openid\'))
-			return true;
-
-		document.forms.creator.openid_url.disabled = currentAuthMethod == \'openid\' ? false : true;
-		document.forms.creator.smf_autov_pwmain.disabled = currentAuthMethod == \'passwd\' ? false : true;
-		document.forms.creator.smf_autov_pwverify.disabled = currentAuthMethod == \'passwd\' ? false : true;
-		document.getElementById(\'smf_autov_pwmain_div\').style.display = currentAuthMethod == \'passwd\' ? \'\' : \'none\';
-		document.getElementById(\'smf_autov_pwverify_div\').style.display = currentAuthMethod == \'passwd\' ? \'\' : \'none\';
-
-		if (currentAuthMethod == \'passwd\')
-		{
-			verificationHandle.refreshMainPassword();
-			verificationHandle.refreshVerifyPassword();
-			document.forms.creator.openid_url.style.backgroundColor = \'\';
-			document.getElementById("auth_openid_div").style.display = "none";
-			document.getElementById("auth_pass_div").style.display = "";
-		}
-		else
-		{
-			document.forms.creator.smf_autov_pwmain.style.backgroundColor = \'\';
-			document.forms.creator.smf_autov_pwverify.style.backgroundColor = \'\';
-			document.forms.creator.openid_url.style.backgroundColor = \'#FCE184\';
-			document.getElementById("auth_openid_div").style.display = "";
-			document.getElementById("auth_pass_div").style.display = "none";
-		}
-	}
-	updateAuthMethod();
-	// ]]></script>';
+function template_tfasetup_backup()
+{
+	global $context, $txt;
+
+	echo '
+							<div class="cat_bar">
+								<h3 class="catbg">', $txt['tfa_backup_title'], '</h3>
+							</div>
+							<div class="roundframe">
+								<div>
+									<div class="smalltext">', $txt['tfa_backup_desc'], '</div>
+									<div class="bbc_code" style="resize: none; border: none;">', $context['tfa_backup'], '</div>
+								</div>
+							</div>';
 }
 
+function template_profile_tfa()
+{
+	global $context, $txt, $scripturl, $modSettings;
+
+	echo '
+							<dt>
+								<strong>', $txt['tfa_profile_label'], ':</strong>
+								<br /><div class="smalltext">', $txt['tfa_profile_desc'], '</div>
+							</dt>
+							<dd>';
+	if (!$context['tfa_enabled'] && $context['user']['is_owner'])
+		echo '
+								<a href="', !empty($modSettings['force_ssl']) && $modSettings['force_ssl'] < 2 ? strtr($scripturl, array('http://' => 'https://')) : $scripturl, '?action=profile;area=tfasetup" id="enable_tfa">', $txt['tfa_profile_enable'], '</a>';
+	elseif (!$context['tfa_enabled'])
+		echo '
+								', $txt['tfa_profile_disabled'];
+	else
+		echo '
+							', sprintf($txt['tfa_profile_enabled'], $scripturl . '?action=profile;u=' . $context['id_member'] . ';area=tfasetup;disable');
+	echo '
+							</dd>';
+}
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Recent.template.php b/Themes/default/Recent.template.php
--- a/Themes/default/Recent.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Recent.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,444 +3,369 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
-function template_main()
+function template_recent()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="recent" class="main_section">
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/post/xx.gif" alt="" class="icon" />',$txt['recent_posts'],'</span>
+				<span class="xx"></span>',$txt['recent_posts'],'
 			</h3>
 		</div>
 		<div class="pagesection">
-			<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+			<span>', $context['page_index'], '</span>
 		</div>';
 
+	if (empty($context['posts']))
+	{
+		echo '
+			<div class="windowbg">', $txt['no_messages'], '</div>';
+	}
+
 	foreach ($context['posts'] as $post)
 	{
 		echo '
-			<div class="', $post['alternate'] == 0 ? 'windowbg' : 'windowbg2', ' core_posts">
-				<span class="topslice"><span></span></span>
-				<div class="content">
+			<div class="windowbg">
 					<div class="counter">', $post['counter'], '</div>
 					<div class="topic_details">
 						<h5>', $post['board']['link'], ' / ', $post['link'], '</h5>
-						<span class="smalltext">&#171;&nbsp;', $txt['last_post'], ' ', $txt['by'], ' <strong>', $post['poster']['link'], ' </strong> ', $txt['on'], '<em> ', $post['time'], '</em>&nbsp;&#187;</span>
+						<span class="smalltext">', $txt['last_poster'], ' <strong>', $post['poster']['link'], ' </strong> - ', $post['time'], '</span>
 					</div>
-					<div class="list_posts">', $post['message'], '</div>
-				</div>';
+					<div class="list_posts">', $post['message'], '</div>';
 
-		if ($post['can_reply'] || $post['can_mark_notify'] || $post['can_delete'])
+		if ($post['can_reply'] || $post['can_delete'])
 			echo '
-				<div class="quickbuttons_wrap">
 					<ul class="reset smalltext quickbuttons">';
 
 		// If they *can* reply?
 		if ($post['can_reply'])
 			echo '
-						<li class="reply_button"><a href="', $scripturl, '?action=post;topic=', $post['topic'], '.', $post['start'], '"><span>', $txt['reply'], '</span></a></li>';
+						<li><a href="', $scripturl, '?action=post;topic=', $post['topic'], '.', $post['start'], '" class="reply_button"><span>', $txt['reply'], '</span></a></li>';
 
 		// If they *can* quote?
 		if ($post['can_quote'])
 			echo '
-						<li class="quote_button"><a href="', $scripturl, '?action=post;topic=', $post['topic'], '.', $post['start'], ';quote=', $post['id'], '"><span>', $txt['quote'], '</span></a></li>';
-
-		// Can we request notification of topics?
-		if ($post['can_mark_notify'])
-			echo '
-						<li class="notify_button"><a href="', $scripturl, '?action=notify;topic=', $post['topic'], '.', $post['start'], '"><span>', $txt['notify'], '</span></a></li>';
+						<li><a href="', $scripturl, '?action=post;topic=', $post['topic'], '.', $post['start'], ';quote=', $post['id'], '" class="quote_button"><span>', $txt['quote_action'], '</span></a></li>';
 
 		// How about... even... remove it entirely?!
 		if ($post['can_delete'])
 			echo '
-						<li class="remove_button"><a href="', $scripturl, '?action=deletemsg;msg=', $post['id'], ';topic=', $post['topic'], ';recent;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['remove_message'], '?\');"><span>', $txt['remove'], '</span></a></li>';
+						<li><a href="', $scripturl, '?action=deletemsg;msg=', $post['id'], ';topic=', $post['topic'], ';recent;', $context['session_var'], '=', $context['session_id'], '" data-confirm="', $txt['remove_message'] ,'" class="remove_button you_sure"><span>', $txt['remove'], '</span></a></li>';
 
-		if ($post['can_reply'] || $post['can_mark_notify'] || $post['can_delete'])
+		if ($post['can_reply'] || $post['can_delete'])
 			echo '
-					</ul>
-				</div>';
+					</ul>';
 
 		echo '
-				<span class="botslice clear"><span></span></span>
 			</div>';
 
 	}
 
 	echo '
 		<div class="pagesection">
-			<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+			<span>', $context['page_index'], '</span>
 		</div>
 	</div>';
 }
 
 function template_unread()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $settings, $txt, $scripturl, $modSettings;
 
 	echo '
 	<div id="recent" class="main_content">';
 
-	$showCheckboxes = !empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1 && $settings['show_mark_read'];
-
-	if ($showCheckboxes)
+	if ($context['showCheckboxes'])
 		echo '
 		<form action="', $scripturl, '?action=quickmod" method="post" accept-charset="', $context['character_set'], '" name="quickModForm" id="quickModForm" style="margin: 0;">
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			<input type="hidden" name="qaction" value="markread" />
-			<input type="hidden" name="redirect_url" value="action=unread', (!empty($context['showing_all_topics']) ? ';all' : ''), $context['querystring_board_limits'], '" />';
-
-	if ($settings['show_mark_read'])
-	{
-		// Generate the button strip.
-		$mark_read = array(
-			'markread' => array('text' => !empty($context['no_board_limits']) ? 'mark_as_read' : 'mark_read_short', 'image' => 'markread.gif', 'lang' => true, 'url' => $scripturl . '?action=markasread;sa=' . (!empty($context['no_board_limits']) ? 'all' : 'board' . $context['querystring_board_limits']) . ';' . $context['session_var'] . '=' . $context['session_id']),
-		);
-
-		if ($showCheckboxes)
-			$mark_read['markselectread'] = array(
-				'text' => 'quick_mod_markread',
-				'image' => 'markselectedread.gif',
-				'lang' => true,
-				'url' => 'javascript:document.quickModForm.submit();',
-			);
-	}
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="qaction" value="markread">
+			<input type="hidden" name="redirect_url" value="action=unread', (!empty($context['showing_all_topics']) ? ';all' : ''), $context['querystring_board_limits'], '">';
 
 	if (!empty($context['topics']))
 	{
 		echo '
-			<div class="pagesection">';
-
-		if (!empty($mark_read) && !empty($settings['use_tabs']))
-			template_button_strip($mark_read, 'right');
-
-		echo '
-				<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+			<div class="pagesection">
+				', $context['menu_separator'], '<a href="#bot" class="topbottom floatleft">', $txt['go_down'], '</a>
+				<div class="pagelinks floatleft">', $context['page_index'], '</div>
+				', !empty($context['recent_buttons']) ? template_button_strip($context['recent_buttons'], 'right') : '', '
 			</div>';
 
 		echo '
-			<div class="tborder topic_table" id="unread">
-				<table class="table_grid" cellspacing="0">
-					<thead>
-						<tr class="catbg">
-							<th scope="col" class="first_th" width="8%" colspan="2">&nbsp;</th>
-							<th scope="col">
-								<a href="', $scripturl, '?action=unread', $context['showing_all_topics'] ? ';all' : '', $context['querystring_board_limits'], ';sort=subject', $context['sort_by'] == 'subject' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['subject'], $context['sort_by'] == 'subject' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
-							</th>
-							<th scope="col" width="14%" align="center">
-								<a href="', $scripturl, '?action=unread', $context['showing_all_topics'] ? ';all' : '', $context['querystring_board_limits'], ';sort=replies', $context['sort_by'] == 'replies' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['replies'], $context['sort_by'] == 'replies' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
-							</th>';
+			<div id="unread">
+				<div id="topic_header" class="title_bar">
+					<div class="icon"></div>
+					<div class="info">
+						<a href="', $scripturl, '?action=unread', $context['showing_all_topics'] ? ';all' : '', $context['querystring_board_limits'], ';sort=subject', $context['sort_by'] == 'subject' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['subject'], $context['sort_by'] == 'subject' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a>
+					</div>
+					<div class="stats">
+						<a href="', $scripturl, '?action=unread', $context['showing_all_topics'] ? ';all' : '', $context['querystring_board_limits'], ';sort=replies', $context['sort_by'] == 'replies' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['replies'], $context['sort_by'] == 'replies' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a>
+					</div>
+					<div class="lastpost">
+						<a href="', $scripturl, '?action=unread', $context['showing_all_topics'] ? ';all' : '', $context['querystring_board_limits'], ';sort=last_post', $context['sort_by'] == 'last_post' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['last_post'], $context['sort_by'] == 'last_post' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a>
+					</div>';
 
 		// Show a "select all" box for quick moderation?
-		if ($showCheckboxes)
+		if ($context['showCheckboxes'])
 			echo '
-							<th scope="col" width="22%">
-								<a href="', $scripturl, '?action=unread', $context['showing_all_topics'] ? ';all' : '', $context['querystring_board_limits'], ';sort=last_post', $context['sort_by'] == 'last_post' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['last_post'], $context['sort_by'] == 'last_post' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
-							</th>
-							<th class="last_th">
-								<input type="checkbox" onclick="invertAll(this, this.form, \'topics[]\');" class="input_check" />
-							</th>';
-		else
-			echo '
-							<th scope="col" class="smalltext last_th" width="22%">
-								<a href="', $scripturl, '?action=unread', $context['showing_all_topics'] ? ';all' : '', $context['querystring_board_limits'], ';sort=last_post', $context['sort_by'] == 'last_post' && $context['sort_direction'] == 'up' ? ';desc' : '', '">', $txt['last_post'], $context['sort_by'] == 'last_post' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
-							</th>';
-		echo '
-						</tr>
-					</thead>
-					<tbody>';
+					<div class="moderation">
+						<input type="checkbox" onclick="invertAll(this, this.form, \'topics[]\');" class="input_check">
+					</div>';
+
+		echo '
+				</div>
+				<div id="topic_container">';
 
 		foreach ($context['topics'] as $topic)
 		{
-			// Calculate the color class of the topic.
-			$color_class = '';
-			if (strpos($topic['class'], 'sticky') !== false)
-				$color_class = 'stickybg';
-			if (strpos($topic['class'], 'locked') !== false)
-				$color_class .= 'lockedbg';
-
-			$color_class2 = !empty($color_class) ? $color_class . '2' : '';
-
-			echo '
-						<tr>
-							<td class="', $color_class, ' icon1 windowbg">
-								<img src="', $settings['images_url'], '/topic/', $topic['class'], '.gif" alt="" />
-							</td>
-							<td class="', $color_class, ' icon2 windowbg">
-								<img src="', $topic['first_post']['icon_url'], '" alt="" />
-							</td>
-							<td class="subject ', $color_class2, ' windowbg2">
-								<div>
-									', $topic['is_sticky'] ? '<strong>' : '', '<span id="msg_' . $topic['first_post']['id'] . '">', $topic['first_post']['link'], '</span>', $topic['is_sticky'] ? '</strong>' : '', '
-									<a href="', $topic['new_href'], '" id="newicon', $topic['first_post']['id'], '"><img src="', $settings['lang_images_url'], '/new.gif" alt="', $txt['new'], '" /></a>
-									<p>
-										', $txt['started_by'], ' <strong>', $topic['first_post']['member']['link'], '</strong>
-										', $txt['in'], ' <em>', $topic['board']['link'], '</em>
-										<small id="pages', $topic['first_post']['id'], '">', $topic['pages'], '</small>
-									</p>
-								</div>
-							</td>
-							<td class="', $color_class, ' stats windowbg">
-								', $topic['replies'], ' ', $txt['replies'], '
-								<br />
-								', $topic['views'], ' ', $txt['views'], '
-							</td>
-							<td class="', $color_class2, ' lastpost windowbg2">
-								<a href="', $topic['last_post']['href'], '"><img src="', $settings['images_url'], '/icons/last_post.gif" alt="', $txt['last_post'], '" title="', $txt['last_post'], '" style="float: right;" /></a>
-								', $topic['last_post']['time'], '<br />
-								', $txt['by'], ' ', $topic['last_post']['member']['link'], '
-							</td>';
+			$color_class = 'windowbg';
+
+			// Sticky topics should get a different color, too.
+			if ($topic['is_sticky'])
+				$color_class = 'sticky ' . $color_class;
+			// Locked topics get special treatment as well.
+			if ($topic['is_locked'])
+				$color_class = 'locked ' . $color_class;
+
+			$color_class2 = $color_class . '2';
 
-			if ($showCheckboxes)
-				echo '
-							<td class="windowbg2" valign="middle" align="center">
-								<input type="checkbox" name="topics[]" value="', $topic['id'], '" class="input_check" />
-							</td>';
 			echo '
-						</tr>';
-		}
+					<div class="', $color_class, '">
+						<div class="icon">
+							<img src="', $topic['first_post']['icon_url'], '" alt="">
+								', $topic['is_posted_in'] ? '<img src="'. $settings['images_url']. '/icons/profile_sm.png" alt="" style="position: absolute; z-index: 5; right: 4px; bottom: -3px;">' : '','
+						</div>
+						<div class="info">';
 
-		if (!empty($context['topics']) && !$context['showing_all_topics'])
-			$mark_read['readall'] = array('text' => 'unread_topics_all', 'image' => 'markreadall.gif', 'lang' => true, 'url' => $scripturl . '?action=unread;all' . $context['querystring_board_limits'], 'active' => true);
+			// Now we handle the icons
+			echo '
+							<div class="icons">';
+			if ($topic['is_locked'])
+				echo '
+								<span class="generic_icons lock floatright"></span>';
+			if ($topic['is_sticky'])
+				echo '
+								<span class="generic_icons sticky floatright"></span>';
+			if ($topic['is_poll'])
+				echo '
+								<span class="generic_icons poll floatright"></span>';
+			echo '
+							</div>';
 
-		if (empty($settings['use_tabs']) && !empty($mark_read))
 			echo '
-						<tr class="catbg">
-							<td colspan="', $showCheckboxes ? '6' : '5', '" align="right">
-								', template_button_strip($mark_read, 'top'), '
-							</td>
-						</tr>';
+							<div class="recent_title">
+								<a href="', $topic['new_href'], '" id="newicon', $topic['first_post']['id'], '"><span class="new_posts">' . $txt['new'] . '</span></a>
+								', $topic['is_sticky'] ? '<strong>' : '', '<span class="preview" title="', $topic[(empty($modSettings['message_index_preview_first']) ? 'last_post' : 'first_post')]['preview'], '"><span id="msg_' . $topic['first_post']['id'] . '">', $topic['first_post']['link'], '</span></span>', $topic['is_sticky'] ? '</strong>' : '', '
+							</div>
+							<p class="floatleft">
+								', $topic['first_post']['started_by'], '
+							</p>
+							<small id="pages', $topic['first_post']['id'], '">&nbsp;', $topic['pages'], '</small>
+						</div>
+						<div class="stats">
+							<p>
+								', $topic['replies'], ' ', $txt['replies'], '
+								<br>
+								', $topic['views'], ' ', $txt['views'], '
+							</p>
+						</div>
+						<div class="lastpost">
+							', sprintf($txt['last_post_topic'], '<a href="' . $topic['last_post']['href'] . '">' . $topic['last_post']['time'] . '</a>', $topic['last_post']['member']['link']), '
+						</div>';
+
+			if ($context['showCheckboxes'])
+				echo '
+						<div class="moderation">
+							<input type="checkbox" name="topics[]" value="', $topic['id'], '" class="input_check">
+						</div>';
+
+				echo '
+					</div>';
+		}
 
 		if (empty($context['topics']))
 			echo '
-					<tr style="display: none;"><td></td></tr>';
+						<div style="display: none;"></div>';
 
 		echo '
-					</tbody>
-				</table>
-			</div>
-			<div class="pagesection" id="readbuttons">';
-
-		if (!empty($settings['use_tabs']) && !empty($mark_read))
-			template_button_strip($mark_read, 'right');
+				</div>
+			</div>';
 
 		echo '
-				<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+			<div class="pagesection">
+				', !empty($context['recent_buttons']) ? template_button_strip($context['recent_buttons'], 'right') : '', '
+				', $context['menu_separator'], '<a href="#recent" class="topbottom floatleft">', $txt['go_up'], '</a>
+				<div class="pagelinks">', $context['page_index'], '</div>
 			</div>';
 	}
 	else
 		echo '
 			<div class="cat_bar">
 				<h3 class="catbg centertext">
-					', $context['showing_all_topics'] ? $txt['msg_alert_none'] : $txt['unread_topics_visit_none'], '
+					', $context['showing_all_topics'] ? $txt['topic_alert_none'] : $txt['unread_topics_visit_none'], '
 				</h3>
 			</div>';
 
-	if ($showCheckboxes)
+	if ($context['showCheckboxes'])
 		echo '
 		</form>';
 
 	echo '
-		<div class="description " id="topic_icons">
-			<p class="smalltext floatleft">
-				', !empty($modSettings['enableParticipation']) ? '
-				<img src="' . $settings['images_url'] . '/topic/my_normal_post.gif" alt="" align="middle" /> ' . $txt['participation_caption'] . '<br />' : '', '
-				<img src="', $settings['images_url'], '/topic/normal_post.gif" alt="" align="middle" /> ', $txt['normal_topic'], '<br />
-				<img src="', $settings['images_url'], '/topic/hot_post.gif" alt="" align="middle" /> ', sprintf($txt['hot_topics'], $modSettings['hotTopicPosts']), '<br />
-				<img src="', $settings['images_url'], '/topic/veryhot_post.gif" alt="" align="middle" /> ', sprintf($txt['very_hot_topics'], $modSettings['hotTopicVeryPosts']), '
-			</p>
-			<p class="smalltext para2">
-				<img src="', $settings['images_url'], '/icons/quick_lock.gif" alt="" align="middle" /> ', $txt['locked_topic'], '<br />', ($modSettings['enableStickyTopics'] == '1' ? '
-				<img src="' . $settings['images_url'] . '/icons/quick_sticky.gif" alt="" align="middle" /> ' . $txt['sticky_topic'] . '<br />' : ''), ($modSettings['pollMode'] == '1' ? '
-				<img src="' . $settings['images_url'] . '/topic/normal_poll.gif" alt="" align="middle" /> ' . $txt['poll'] : ''), '
-			</p>
-		</div>
 	</div>';
+
+	if (empty($context['no_topic_listing']))
+		template_topic_legend();
 }
 
 function template_replies()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $settings, $txt, $scripturl, $modSettings;
 
 	echo '
 	<div id="recent">';
 
-	$showCheckboxes = !empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1 && $settings['show_mark_read'];
-
-	if ($showCheckboxes)
+	if ($context['showCheckboxes'])
 		echo '
 		<form action="', $scripturl, '?action=quickmod" method="post" accept-charset="', $context['character_set'], '" name="quickModForm" id="quickModForm" style="margin: 0;">
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			<input type="hidden" name="qaction" value="markread" />
-			<input type="hidden" name="redirect_url" value="action=unreadreplies', (!empty($context['showing_all_topics']) ? ';all' : ''), $context['querystring_board_limits'], '" />';
-
-	if (isset($context['topics_to_mark']) && !empty($settings['show_mark_read']))
-	{
-		// Generate the button strip.
-		$mark_read = array(
-			'markread' => array('text' => 'mark_as_read', 'image' => 'markread.gif', 'lang' => true, 'url' => $scripturl . '?action=markasread;sa=unreadreplies;topics=' . $context['topics_to_mark'] . ';' . $context['session_var'] . '=' . $context['session_id']),
-		);
-
-		if ($showCheckboxes)
-			$mark_read['markselectread'] = array(
-				'text' => 'quick_mod_markread',
-				'image' => 'markselectedread.gif',
-				'lang' => true,
-				'url' => 'javascript:document.quickModForm.submit();',
-			);
-	}
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="qaction" value="markread">
+			<input type="hidden" name="redirect_url" value="action=unreadreplies', (!empty($context['showing_all_topics']) ? ';all' : ''), $context['querystring_board_limits'], '">';
 
 	if (!empty($context['topics']))
 	{
 		echo '
-			<div class="pagesection">';
-
-		if (!empty($mark_read) && !empty($settings['use_tabs']))
-			template_button_strip($mark_read, 'right');
-
-		echo '
-				<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+			<div class="pagesection">
+				', $context['menu_separator'], '<a href="#bot" class="topbottom floatleft">', $txt['go_down'], '</a>
+				<div class="pagelinks floatleft">', $context['page_index'], '</div>
+				', !empty($context['recent_buttons']) ? template_button_strip($context['recent_buttons'], 'right') : '', '
 			</div>';
 
 		echo '
-			<div class="tborder topic_table" id="unreadreplies">
-				<table class="table_grid" cellspacing="0">
-					<thead>
-						<tr class="catbg">
-							<th scope="col" class="first_th" width="8%" colspan="2">&nbsp;</th>
-							<th scope="col">
-								<a href="', $scripturl, '?action=unreadreplies', $context['querystring_board_limits'], ';sort=subject', $context['sort_by'] === 'subject' && $context['sort_direction'] === 'up' ? ';desc' : '', '">', $txt['subject'], $context['sort_by'] === 'subject' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
-							</th>
-							<th scope="col" width="14%" align="center">
-								<a href="', $scripturl, '?action=unreadreplies', $context['querystring_board_limits'], ';sort=replies', $context['sort_by'] === 'replies' && $context['sort_direction'] === 'up' ? ';desc' : '', '">', $txt['replies'], $context['sort_by'] === 'replies' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
-							</th>';
+			<div id="unreadreplies">
+				<div id="topic_header" class="title_bar">
+					<div class="icon"></div>
+					<div class="info">
+						<a href="', $scripturl, '?action=unreadreplies', $context['querystring_board_limits'], ';sort=subject', $context['sort_by'] === 'subject' && $context['sort_direction'] === 'up' ? ';desc' : '', '">', $txt['subject'], $context['sort_by'] === 'subject' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a>
+					</div>
+					<div class="stats">
+						<a href="', $scripturl, '?action=unreadreplies', $context['querystring_board_limits'], ';sort=replies', $context['sort_by'] === 'replies' && $context['sort_direction'] === 'up' ? ';desc' : '', '">', $txt['replies'], $context['sort_by'] === 'replies' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a>
+					</div>
+					<div class="lastpost">
+						<a href="', $scripturl, '?action=unreadreplies', $context['querystring_board_limits'], ';sort=last_post', $context['sort_by'] === 'last_post' && $context['sort_direction'] === 'up' ? ';desc' : '', '">', $txt['last_post'], $context['sort_by'] === 'last_post' ? ' <span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a>
+					</div>';
 
 		// Show a "select all" box for quick moderation?
-		if ($showCheckboxes)
+		if ($context['showCheckboxes'])
 				echo '
-							<th scope="col" width="22%">
-								<a href="', $scripturl, '?action=unreadreplies', $context['querystring_board_limits'], ';sort=last_post', $context['sort_by'] === 'last_post' && $context['sort_direction'] === 'up' ? ';desc' : '', '">', $txt['last_post'], $context['sort_by'] === 'last_post' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
-							</th>
-							<th class="last_th">
-								<input type="checkbox" onclick="invertAll(this, this.form, \'topics[]\');" class="input_check" />
-							</th>';
-		else
-			echo '
-							<th scope="col" class="last_th" width="22%">
-								<a href="', $scripturl, '?action=unreadreplies', $context['querystring_board_limits'], ';sort=last_post', $context['sort_by'] === 'last_post' && $context['sort_direction'] === 'up' ? ';desc' : '', '">', $txt['last_post'], $context['sort_by'] === 'last_post' ? ' <img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a>
-							</th>';
-		echo '
-						</tr>
-					</thead>
-					<tbody>';
+					<div class="moderation">
+						<input type="checkbox" onclick="invertAll(this, this.form, \'topics[]\');" class="input_check">
+					</div>';
+
+		echo '
+				</div>
+				<div id="topic_container">';
 
 		foreach ($context['topics'] as $topic)
 		{
-			// Calculate the color class of the topic.
-			$color_class = '';
-			if (strpos($topic['class'], 'sticky') !== false)
-				$color_class = 'stickybg';
-			if (strpos($topic['class'], 'locked') !== false)
-				$color_class .= 'lockedbg';
-
-			$color_class2 = !empty($color_class) ? $color_class . '2' : '';
-
-			echo '
-						<tr>
-							<td class="', $color_class, ' icon1 windowbg">
-								<img src="', $settings['images_url'], '/topic/', $topic['class'], '.gif" alt="" />
-							</td>
-							<td class="', $color_class, ' icon2 windowbg">
-								<img src="', $topic['first_post']['icon_url'], '" alt="" />
-							</td>
-							<td class="subject ', $color_class2, ' windowbg2">
-								<div>
-									', $topic['is_sticky'] ? '<strong>' : '', '<span id="msg_' . $topic['first_post']['id'] . '">', $topic['first_post']['link'], '</span>', $topic['is_sticky'] ? '</strong>' : '', '
-									<a href="', $topic['new_href'], '" id="newicon', $topic['first_post']['id'], '"><img src="', $settings['lang_images_url'], '/new.gif" alt="', $txt['new'], '" /></a>
-									<p>
-										', $txt['started_by'], ' <strong>', $topic['first_post']['member']['link'], '</strong>
-										', $txt['in'], ' <em>', $topic['board']['link'], '</em>
-										<small id="pages', $topic['first_post']['id'], '">', $topic['pages'], '</small>
-									</p>
-								</div>
-							</td>
-							<td class="', $color_class, ' stats windowbg">
-								', $topic['replies'], ' ', $txt['replies'], '
-								<br />
-								', $topic['views'], ' ', $txt['views'], '
-							</td>
-							<td class="', $color_class2, ' lastpost windowbg2">
-								<a href="', $topic['last_post']['href'], '"><img src="', $settings['images_url'], '/icons/last_post.gif" alt="', $txt['last_post'], '" title="', $txt['last_post'], '" style="float: right;" /></a>
-								', $topic['last_post']['time'], '<br />
-								', $txt['by'], ' ', $topic['last_post']['member']['link'], '
-							</td>';
+			$color_class = 'windowbg';
+
+			// Sticky topics should get a different color, too.
+			if ($topic['is_sticky'])
+				$color_class = 'sticky ' . $color_class;
+			// Locked topics get special treatment as well.
+			if ($topic['is_locked'])
+				$color_class = 'locked ' . $color_class;
+
+			$color_class2 = $color_class . '2';
 
-			if ($showCheckboxes)
-				echo '
-							<td class="windowbg2" valign="middle" align="center">
-								<input type="checkbox" name="topics[]" value="', $topic['id'], '" class="input_check" />
-							</td>';
 			echo '
-						</tr>';
-		}
+						<div class="', $color_class, '">
+							<div class="icon">
+								<img src="', $topic['first_post']['icon_url'], '" alt="">
+								', $topic['is_posted_in'] ? '<img class="posted" src="' . $settings['images_url'] . '/icons/profile_sm.png" alt="">' : '','
+							</div>
+							<div class="info">';
 
-		if (empty($settings['use_tabs']) && !empty($mark_read))
+			// Now we handle the icons
 			echo '
-						<tr class="catbg">
-							<td colspan="', $showCheckboxes ? '6' : '5', '" align="right">
-								', template_button_strip($mark_read, 'top'), '
-							</td>
-						</tr>';
+								<div class="icons">';
+			if ($topic['is_locked'])
+				echo '
+									<span class="generic_icons lock floatright"></span>';
+			if ($topic['is_sticky'])
+				echo '
+									<span class="generic_icons sticky floatright"></span>';
+			if ($topic['is_poll'])
+				echo '
+									<span class="generic_icons poll floatright"></span>';
+			echo '
+								</div>';
 
-		echo '
-					</tbody>
-				</table>
-			</div>
-			<div class="pagesection">';
+			echo '
+								<div class="recent_title">
+									<a href="', $topic['new_href'], '" id="newicon', $topic['first_post']['id'], '"><span class="new_posts">' . $txt['new'] . '</span></a>
+									', $topic['is_sticky'] ? '<strong>' : '', '<span title="', $topic[(empty($modSettings['message_index_preview_first']) ? 'last_post' : 'first_post')]['preview'], '"><span id="msg_' . $topic['first_post']['id'] . '">', $topic['first_post']['link'], '</span>', $topic['is_sticky'] ? '</strong>' : '', '
+								</div>
+								<p class="floatleft">
+									', $topic['first_post']['started_by'], '
+								</p>
+								<small id="pages', $topic['first_post']['id'], '">&nbsp;', $topic['pages'], '</small>
+							</div>
+							<div class="stats">
+								<p>
+									', $topic['replies'], ' ', $txt['replies'], '
+									<br>
+									', $topic['views'], ' ', $txt['views'], '
+								</p>
+							</div>
+							<div class="lastpost">
+								', sprintf($txt['last_post_topic'], '<a href="' . $topic['last_post']['href'] . '">' . $topic['last_post']['time'] . '</a>', $topic['last_post']['member']['link']), '
+							</div>';
 
-		if (!empty($settings['use_tabs']) && !empty($mark_read))
-			template_button_strip($mark_read, 'right');
+			if ($context['showCheckboxes'])
+				echo '
+							<div class="moderation">
+								<input type="checkbox" name="topics[]" value="', $topic['id'], '" class="input_check">
+							</div>';
+			echo '
+						</div>';
+		}
 
 		echo '
-				<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+					</div>
+			</div>
+			<div class="pagesection">
+				', !empty($context['recent_buttons']) ? template_button_strip($context['recent_buttons'], 'right') : '', '
+				', $context['menu_separator'], '<a href="#recent" class="topbottom floatleft">', $txt['go_up'], '</a>
+				<div class="pagelinks">', $context['page_index'], '</div>
 			</div>';
 	}
 	else
 		echo '
 			<div class="cat_bar">
 				<h3 class="catbg centertext">
-					', $context['showing_all_topics'] ? $txt['msg_alert_none'] : $txt['unread_topics_visit_none'], '
+					', $context['showing_all_topics'] ? $txt['topic_alert_none'] : $txt['unread_topics_visit_none'], '
 				</h3>
 			</div>';
 
-	if ($showCheckboxes)
+	if ($context['showCheckboxes'])
 		echo '
 		</form>';
 
 	echo '
-		<div class="description flow_auto" id="topic_icons">
-			<p class="smalltext floatleft">
-				', !empty($modSettings['enableParticipation']) ? '
-				<img src="' . $settings['images_url'] . '/topic/my_normal_post.gif" alt="" align="middle" /> ' . $txt['participation_caption'] . '<br />' : '', '
-				<img src="', $settings['images_url'], '/topic/normal_post.gif" alt="" align="middle" /> ', $txt['normal_topic'], '<br />
-				<img src="', $settings['images_url'], '/topic/hot_post.gif" alt="" align="middle" /> ', sprintf($txt['hot_topics'], $modSettings['hotTopicPosts']), '<br />
-				<img src="', $settings['images_url'], '/topic/veryhot_post.gif" alt="" align="middle" /> ', sprintf($txt['very_hot_topics'], $modSettings['hotTopicVeryPosts']), '
-			</p>
-			<p class="smalltext para2">
-				<img src="', $settings['images_url'], '/icons/quick_lock.gif" alt="" align="middle" /> ', $txt['locked_topic'], '<br />', ($modSettings['enableStickyTopics'] == '1' ? '
-				<img src="' . $settings['images_url'] . '/icons/quick_sticky.gif" alt="" align="middle" /> ' . $txt['sticky_topic'] . '<br />' : '') . ($modSettings['pollMode'] == '1' ? '
-				<img src="' . $settings['images_url'] . '/topic/normal_poll.gif" alt="" align="middle" /> ' . $txt['poll'] : '') . '
-			</p>
-		</div>
 	</div>';
+
+	if (empty($context['no_topic_listing']))
+		template_topic_legend();
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Register.template.php b/Themes/default/Register.template.php
--- a/Themes/default/Register.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Register.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,42 +3,44 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
-// Before showing users a registration form, show them the registration agreement.
+/**
+ * Before showing users a registration form, show them the registration agreement.
+ */
 function template_registration_agreement()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt;
 
 	echo '
-		<form action="', $scripturl, '?action=register" method="post" accept-charset="', $context['character_set'], '" id="registration">
+		<form action="', $scripturl, '?action=signup" method="post" accept-charset="', $context['character_set'], '" id="registration">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['registration_agreement'], '</h3>
 			</div>
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
 				<p>', $context['agreement'], '</p>
 			</div>
-			<span class="lowerframe"><span></span></span>
 			<div id="confirm_buttons">';
 
 	// Age restriction in effect?
 	if ($context['show_coppa'])
 		echo '
-				<input type="submit" name="accept_agreement" value="', $context['coppa_agree_above'], '" class="button_submit" /><br /><br />
-				<input type="submit" name="accept_agreement_coppa" value="', $context['coppa_agree_below'], '" class="button_submit" />';
+				<input type="submit" name="accept_agreement" value="', $context['coppa_agree_above'], '" class="button_submit"><br><br>
+				<input type="submit" name="accept_agreement_coppa" value="', $context['coppa_agree_below'], '" class="button_submit">';
 	else
 		echo '
-				<input type="submit" name="accept_agreement" value="', $txt['agreement_agree'], '" class="button_submit" />';
+				<input type="submit" name="accept_agreement" value="', $txt['agreement_agree'], '" class="button_submit">';
 
 	echo '
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['register_token_var'], '" value="', $context['register_token'], '">
 			</div>
-			<input type="hidden" name="step" value="1" />
+			<input type="hidden" name="step" value="1">
 		</form>';
 
 }
@@ -46,11 +48,10 @@
 // Before registering - get their information.
 function template_registration_form()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
-		<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/register.js"></script>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			function verifyAgree()
 			{
 				if (currentAuthMethod == \'passwd\' && document.forms.registration.smf_autov_pwmain.value != document.forms.registration.smf_autov_pwverify.value)
@@ -63,58 +64,19 @@
 			}
 
 			var currentAuthMethod = \'passwd\';
-			function updateAuthMethod()
-			{
-				// What authentication method is being used?
-				if (!document.getElementById(\'auth_openid\') || !document.getElementById(\'auth_openid\').checked)
-					currentAuthMethod = \'passwd\';
-				else
-					currentAuthMethod = \'openid\';
-
-				// No openID?
-				if (!document.getElementById(\'auth_openid\'))
-					return true;
-
-				document.forms.registration.openid_url.disabled = currentAuthMethod == \'openid\' ? false : true;
-				document.forms.registration.smf_autov_pwmain.disabled = currentAuthMethod == \'passwd\' ? false : true;
-				document.forms.registration.smf_autov_pwverify.disabled = currentAuthMethod == \'passwd\' ? false : true;
-				document.getElementById(\'smf_autov_pwmain_div\').style.display = currentAuthMethod == \'passwd\' ? \'\' : \'none\';
-				document.getElementById(\'smf_autov_pwverify_div\').style.display = currentAuthMethod == \'passwd\' ? \'\' : \'none\';
-
-				if (currentAuthMethod == \'passwd\')
-				{
-					verificationHandle.refreshMainPassword();
-					verificationHandle.refreshVerifyPassword();
-					document.forms.registration.openid_url.style.backgroundColor = \'\';
-					document.getElementById(\'password1_group\').style.display = \'\';
-					document.getElementById(\'password2_group\').style.display = \'\';
-					document.getElementById(\'openid_group\').style.display = \'none\';
-				}
-				else
-				{
-					document.forms.registration.smf_autov_pwmain.style.backgroundColor = \'\';
-					document.forms.registration.smf_autov_pwverify.style.backgroundColor = \'\';
-					document.forms.registration.openid_url.style.backgroundColor = \'#FFF0F0\';
-					document.getElementById(\'password1_group\').style.display = \'none\';
-					document.getElementById(\'password2_group\').style.display = \'none\';
-					document.getElementById(\'openid_group\').style.display = \'\';
-				}
-
-				return true;
-			}
 		// ]]></script>';
 
 	// Any errors?
 	if (!empty($context['registration_errors']))
 	{
 		echo '
-		<div class="register_error">
+		<div class="errorbox">
 			<span>', $txt['registration_errors_occurred'], '</span>
 			<ul class="reset">';
 
 		// Cycle through each error and display an error message.
 		foreach ($context['registration_errors'] as $error)
-				echo '
+			echo '
 				<li>', $error, '</li>';
 
 		echo '
@@ -123,107 +85,82 @@
 	}
 
 	echo '
-		<form action="', $scripturl, '?action=register2" method="post" accept-charset="', $context['character_set'], '" name="registration" id="registration" onsubmit="return verifyAgree();">
+		<form action="', !empty($modSettings['force_ssl']) && $modSettings['force_ssl'] < 2 ? strtr($scripturl, array('http://' => 'https://')) : $scripturl, '?action=signup2" method="post" accept-charset="', $context['character_set'], '" name="registration" id="registration" onsubmit="return verifyAgree();">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['registration_form'], '</h3>
 			</div>
-			<div class="title_bar">
-				<h4 class="titlebg">', $txt['required_info'], '</h4>
+			<div class="title_bar title_top">
+				<h3 class="titlebg">', $txt['required_info'], '</h3>
 			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<fieldset class="content">
+			<div class="roundframe">
+				<fieldset>
 					<dl class="register_form">
 						<dt><strong><label for="smf_autov_username">', $txt['username'], ':</label></strong></dt>
 						<dd>
-							<input type="text" name="user" id="smf_autov_username" size="30" tabindex="', $context['tabindex']++, '" maxlength="25" value="', isset($context['username']) ? $context['username'] : '', '" class="input_text" />
+							<input type="text" name="user" id="smf_autov_username" size="30" tabindex="', $context['tabindex']++, '" maxlength="25" value="', isset($context['username']) ? $context['username'] : '', '" class="input_text">
 							<span id="smf_autov_username_div" style="display: none;">
 								<a id="smf_autov_username_link" href="#">
-									<img id="smf_autov_username_img" src="', $settings['images_url'], '/icons/field_check.gif" alt="*" />
+									<span id="smf_autov_username_img" class="generic_icons check"></span>
 								</a>
 							</span>
 						</dd>
-						<dt><strong><label for="smf_autov_reserve1">', $txt['email'], ':</label></strong></dt>
+						<dt><strong><label for="smf_autov_reserve1">', $txt['user_email_address'], ':</label></strong></dt>
 						<dd>
-							<input type="text" name="email" id="smf_autov_reserve1" size="30" tabindex="', $context['tabindex']++, '" value="', isset($context['email']) ? $context['email'] : '', '" class="input_text" />
+							<input type="text" name="email" id="smf_autov_reserve1" size="30" tabindex="', $context['tabindex']++, '" value="', isset($context['email']) ? $context['email'] : '', '" class="input_text">
 						</dd>
-						<dt><strong><label for="allow_email">', $txt['allow_user_email'], ':</label></strong></dt>
-						<dd>
-							<input type="checkbox" name="allow_email" id="allow_email" tabindex="', $context['tabindex']++, '" class="input_check" />
-						</dd>
-					</dl>';
-
-	// If OpenID is enabled, give the user a choice between password and OpenID.
-	if (!empty($modSettings['enableOpenID']))
-	{
-		echo '
-					<dl class="register_form" id="authentication_group">
-						<dt>
-							<strong>', $txt['authenticate_label'], ':</strong>
-							<a href="', $scripturl, '?action=helpadmin;help=register_openid" onclick="return reqWin(this.href);" class="help">(?)</a>
-						</dt>
-						<dd>
-							<label for="auth_pass" id="option_auth_pass">
-								<input type="radio" name="authenticate" value="passwd" id="auth_pass" tabindex="', $context['tabindex']++, '" ', empty($context['openid']) ? 'checked="checked" ' : '', ' onclick="updateAuthMethod();" class="input_radio" />
-								', $txt['authenticate_password'], '
-							</label>
-							<label for="auth_openid" id="option_auth_openid">
-								<input type="radio" name="authenticate" value="openid" id="auth_openid" tabindex="', $context['tabindex']++, '" ', !empty($context['openid']) ? 'checked="checked" ' : '', ' onclick="updateAuthMethod();" class="input_radio" />
-								', $txt['authenticate_openid'], '
-							</label>
-						</dd>
-					</dl>';
-	}
-
-	echo '
+					</dl>
 					<dl class="register_form" id="password1_group">
-						<dt><strong><label for="smf_autov_pwmain">', $txt['choose_pass'], ':</label></strong></dt>
+						<dt><strong><label for="smf_autov_pwmain">', ucwords($txt['choose_pass']), ':</label></strong></dt>
 						<dd>
-							<input type="password" name="passwrd1" id="smf_autov_pwmain" size="30" tabindex="', $context['tabindex']++, '" class="input_password" />
+							<input type="password" name="passwrd1" id="smf_autov_pwmain" size="30" tabindex="', $context['tabindex']++, '" class="input_password">
 							<span id="smf_autov_pwmain_div" style="display: none;">
-								<img id="smf_autov_pwmain_img" src="', $settings['images_url'], '/icons/field_invalid.gif" alt="*" />
+								<span id="smf_autov_pwmain_img" class="generic_icons invalid"></span>
 							</span>
 						</dd>
 					</dl>
 					<dl class="register_form" id="password2_group">
-						<dt><strong><label for="smf_autov_pwverify">', $txt['verify_pass'], ':</label></strong></dt>
+						<dt><strong><label for="smf_autov_pwverify">', ucwords($txt['verify_pass']), ':</label></strong></dt>
 						<dd>
-							<input type="password" name="passwrd2" id="smf_autov_pwverify" size="30" tabindex="', $context['tabindex']++, '" class="input_password" />
+							<input type="password" name="passwrd2" id="smf_autov_pwverify" size="30" tabindex="', $context['tabindex']++, '" class="input_password">
 							<span id="smf_autov_pwverify_div" style="display: none;">
-								<img id="smf_autov_pwverify_img" src="', $settings['images_url'], '/icons/field_valid.gif" alt="*" />
+								<span id="smf_autov_pwverify_img" class="generic_icons valid"></span>
 							</span>
 						</dd>
 					</dl>';
 
-	// If OpenID is enabled, give the user a choice between password and OpenID.
-	if (!empty($modSettings['enableOpenID']))
+	// If there is any field marked as required, show it here!
+	if (!empty($context['custom_fields_required']) && !empty($context['custom_fields']))
 	{
 		echo '
 
-					<dl class="register_form" id="openid_group">
-						<dt><strong>', $txt['authenticate_openid_url'], ':</strong></dt>
-						<dd>
-							<input type="text" name="openid_identifier" id="openid_url" size="30" tabindex="', $context['tabindex']++, '" value="', isset($context['openid']) ? $context['openid'] : '', '" class="input_text openid_login" />
-						</dd>
-					</dl>';
+					<dl class="register_form">';
 
+		foreach ($context['custom_fields'] as $field)
+			if ($field['show_reg'] > 1)
+				echo '
+						<dt>
+							<strong', !empty($field['is_error']) ? ' class="red"' : '', '>', $field['name'], ':</strong>
+							<span class="smalltext">', $field['desc'], '</span>
+						</dt>
+						<dd>', str_replace('name="', 'tabindex="' . $context['tabindex']++ .'" name="', $field['input_html']), '</dd>';
+
+		echo '
+					</dl>';
 	}
 
 	echo '
 				</fieldset>
-				<span class="botslice"><span></span></span>
 			</div>';
 
 	// If we have either of these, show the extra group.
 	if (!empty($context['profile_fields']) || !empty($context['custom_fields']))
 	{
 		echo '
-			<div class="title_bar">
-				<h4 class="titlebg">', $txt['additional_information'], '</h4>
+			<div class="title_bar title_top">
+				<h3 class="titlebg">', $txt['additional_information'], '</h3>
 			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<fieldset class="content">
+			<div class="roundframe">
+				<fieldset>
 					<dl class="register_form" id="custom_group">';
 	}
 
@@ -244,7 +181,7 @@
 			{
 					echo '
 						<dt>
-							<strong', !empty($field['is_error']) ? ' style="color: red;"' : '', '>', $field['label'], ':</strong>';
+							<strong', !empty($field['is_error']) ? ' class="red"' : '', '>', $field['label'], ':</strong>';
 
 				// Does it have any subtext to show?
 				if (!empty($field['subtext']))
@@ -268,12 +205,12 @@
 				// Maybe it's a text box - very likely!
 				elseif (in_array($field['type'], array('int', 'float', 'text', 'password')))
 					echo '
-							<input type="', $field['type'] == 'password' ? 'password' : 'text', '" name="', $key, '" id="', $key, '" size="', empty($field['size']) ? 30 : $field['size'], '" value="', $field['value'], '" tabindex="', $context['tabindex']++, '" ', $field['input_attr'], ' class="input_', $field['type'] == 'password' ? 'password' : 'text', '" />';
+							<input type="', $field['type'] == 'password' ? 'password' : 'text', '" name="', $key, '" id="', $key, '" size="', empty($field['size']) ? 30 : $field['size'], '" value="', $field['value'], '" tabindex="', $context['tabindex']++, '" ', $field['input_attr'], ' class="input_', $field['type'] == 'password' ? 'password' : 'text', '">';
 
 				// You "checking" me out? ;)
 				elseif ($field['type'] == 'check')
 					echo '
-							<input type="hidden" name="', $key, '" value="0" /><input type="checkbox" name="', $key, '" id="', $key, '" ', !empty($field['value']) ? ' checked="checked"' : '', ' value="1" tabindex="', $context['tabindex']++, '" class="input_check" ', $field['input_attr'], ' />';
+							<input type="hidden" name="', $key, '" value="0"><input type="checkbox" name="', $key, '" id="', $key, '"', !empty($field['value']) ? ' checked' : '', ' value="1" tabindex="', $context['tabindex']++, '" class="input_check" ', $field['input_attr'], '>';
 
 				// Always fun - select boxes!
 				elseif ($field['type'] == 'select')
@@ -290,7 +227,7 @@
 						if (is_array($field['options']))
 							foreach ($field['options'] as $value => $name)
 								echo '
-								<option value="', $value, '" ', $value == $field['value'] ? 'selected="selected"' : '', '>', $name, '</option>';
+								<option value="', $value, '"', $value == $field['value'] ? ' selected' : '', '>', $name, '</option>';
 					}
 
 					echo '
@@ -312,12 +249,15 @@
 	if (!empty($context['custom_fields']))
 	{
 		foreach ($context['custom_fields'] as $field)
-			echo '
+		{
+			if ($field['show_reg'] < 2)
+				echo '
 						<dt>
-							<strong', !empty($field['is_error']) ? ' style="color: red;"' : '', '>', $field['name'], ':</strong>
+							<strong', !empty($field['is_error']) ? ' class="red"' : '', '>', $field['name'], ':</strong>
 							<span class="smalltext">', $field['desc'], '</span>
 						</dt>
 						<dd>', $field['input_html'], '</dd>';
+		}
 	}
 
 	// If we have either of these, close the list like a proper gent.
@@ -326,32 +266,40 @@
 		echo '
 					</dl>
 				</fieldset>
-				<span class="botslice"><span></span></span>
 			</div>';
 	}
 
 	if ($context['visual_verification'])
 	{
 		echo '
-			<div class="title_bar">
-				<h4 class="titlebg">', $txt['verification'], '</h4>
+			<div class="title_bar title_top">
+				<h3 class="titlebg">', $txt['verification'], '</h3>
 			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<fieldset class="content centertext">
+			<div class="roundframe">
+				<fieldset class="centertext">
 					', template_control_verification($context['visual_verification_id'], 'all'), '
 				</fieldset>
-				<span class="botslice"><span></span></span>
 			</div>';
 	}
 
 	echo '
-			<div id="confirm_buttons">
-				<input type="submit" name="regSubmit" value="', $txt['register'], '" tabindex="', $context['tabindex']++, '" class="button_submit" />
+			<div id="confirm_buttons" class="flow_auto">';
+
+	// Age restriction in effect?
+	if (!$context['require_agreement'] && $context['show_coppa'])
+		echo '
+				<input type="submit" name="accept_agreement" value="', $context['coppa_agree_above'], '" class="button_submit"><br><br>
+				<input type="submit" name="accept_agreement_coppa" value="', $context['coppa_agree_below'], '" class="button_submit">';
+	else
+		echo '
+				<input type="submit" name="regSubmit" value="', $txt['register'], '" tabindex="', $context['tabindex']++, '" class="button_submit">';
+	echo '
 			</div>
-			<input type="hidden" name="step" value="2" />
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			<input type="hidden" name="', $context['register_token_var'], '" value="', $context['register_token'], '">
+			<input type="hidden" name="step" value="2">
 		</form>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			var regTextStrings = {
 				"username_valid": "', $txt['registration_username_available'], '",
 				"username_invalid": "', $txt['registration_username_unavailable'], '",
@@ -371,7 +319,7 @@
 // After registration... all done ;).
 function template_after()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context;
 
 	// Not much to see here, just a quick... "you're now registered!" or what have you.
 	echo '
@@ -380,9 +328,7 @@
 				<h3 class="catbg">', $context['title'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<p class="content">', $context['description'], '</p>
-				<span class="botslice"><span></span></span>
+				<p>', $context['description'], '</p>
 			</div>
 		</div>';
 }
@@ -390,75 +336,71 @@
 // Template for giving instructions about COPPA activation.
 function template_coppa()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	// Formulate a nice complicated message!
 	echo '
-			<div class="title_bar">
+			<div class="title_bar title_top">
 				<h3 class="titlebg">', $context['page_title'], '</h3>
 			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>', $context['coppa']['body'], '</p>
-					<p>
-						<span><a href="', $scripturl, '?action=coppa;form;member=', $context['coppa']['id'], '" target="_blank" class="new_win">', $txt['coppa_form_link_popup'], '</a> | <a href="', $scripturl, '?action=coppa;form;dl;member=', $context['coppa']['id'], '">', $txt['coppa_form_link_download'], '</a></span>
-					</p>
-					<p>', $context['coppa']['many_options'] ? $txt['coppa_send_to_two_options'] : $txt['coppa_send_to_one_option'], '</p>';
+			<div id="coppa" class="roundframe">
+				<p>', $context['coppa']['body'], '</p>
+				<p>
+					<span><a href="', $scripturl, '?action=coppa;form;member=', $context['coppa']['id'], '" target="_blank" class="new_win">', $txt['coppa_form_link_popup'], '</a> | <a href="', $scripturl, '?action=coppa;form;dl;member=', $context['coppa']['id'], '">', $txt['coppa_form_link_download'], '</a></span>
+				</p>
+				<p>', $context['coppa']['many_options'] ? $txt['coppa_send_to_two_options'] : $txt['coppa_send_to_one_option'], '</p>';
 
 	// Can they send by post?
 	if (!empty($context['coppa']['post']))
 	{
 		echo '
-					<h4>1) ', $txt['coppa_send_by_post'], '</h4>
-					<div class="coppa_contact">
-						', $context['coppa']['post'], '
-					</div>';
+				<h4>1) ', $txt['coppa_send_by_post'], '</h4>
+				<div class="coppa_contact">
+					', $context['coppa']['post'], '
+				</div>';
 	}
 
 	// Can they send by fax??
 	if (!empty($context['coppa']['fax']))
 	{
 		echo '
-					<h4>', !empty($context['coppa']['post']) ? '2' : '1', ') ', $txt['coppa_send_by_fax'], '</h4>
-					<div class="coppa_contact">
-						', $context['coppa']['fax'], '
-					</div>';
+				<h4>', !empty($context['coppa']['post']) ? '2' : '1', ') ', $txt['coppa_send_by_fax'], '</h4>
+				<div class="coppa_contact">
+					', $context['coppa']['fax'], '
+				</div>';
 	}
 
 	// Offer an alternative Phone Number?
 	if ($context['coppa']['phone'])
 	{
 		echo '
-					<p>', $context['coppa']['phone'], '</p>';
+				<p>', $context['coppa']['phone'], '</p>';
 	}
 	echo '
-				</div>
-				<span class="botslice"><span></span></span>
 			</div>';
 }
 
 // An easily printable form for giving permission to access the forum for a minor.
 function template_coppa_form()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt;
 
 	// Show the form (As best we can)
 	echo '
-		<table border="0" width="100%" cellpadding="3" cellspacing="0" class="tborder" align="center">
+		<table style="width: 100%; padding: 3px; border: 0" class="tborder">
 			<tr>
 				<td align="left">', $context['forum_contacts'], '</td>
 			</tr><tr>
 				<td align="right">
-					<em>', $txt['coppa_form_address'], '</em>: ', $context['ul'], '<br />
-					', $context['ul'], '<br />
-					', $context['ul'], '<br />
+					<em>', $txt['coppa_form_address'], '</em>: ', $context['ul'], '<br>
+					', $context['ul'], '<br>
+					', $context['ul'], '<br>
 					', $context['ul'], '
 				</td>
 			</tr><tr>
 				<td align="right">
 					<em>', $txt['coppa_form_date'], '</em>: ', $context['ul'], '
-					<br /><br />
+					<br><br>
 				</td>
 			</tr><tr>
 				<td align="left">
@@ -466,21 +408,21 @@
 				</td>
 			</tr>
 		</table>
-		<br />';
+		<br>';
 }
 
 // Show a window containing the spoken verification code.
 function template_verification_sound()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $settings, $txt, $modSettings;
 
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
-		<title>', $context['page_title'], '</title>
-		<meta name="robots" content="noindex" />
-		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index.css" />
+		<meta charset="', $context['character_set'], '">
+		<title>', $txt['visual_verification_sound'], '</title>
+		<meta name="robots" content="noindex">
+		<link rel="stylesheet" type="text/css" href="', $settings['theme_url'], '/css/index', $context['theme_variant'], '.css', $modSettings['browser_cache'] ,'">
 		<style type="text/css">';
 
 	// Just show the help text and a "close window" link.
@@ -488,23 +430,25 @@
 		</style>
 	</head>
 	<body style="margin: 1ex;">
-		<div class="popuptext" style="text-align: center;">';
-	if ($context['browser']['is_ie'])
+		<div class="windowbg description" style="text-align: center;">';
+	if (isBrowser('is_ie') || isBrowser('is_ie11'))
 		echo '
 			<object classid="clsid:22D6F312-B0F6-11D0-94AB-0080C74C7E95" type="audio/x-wav">
-				<param name="AutoStart" value="1" />
-				<param name="FileName" value="', $context['verification_sound_href'], '" />
+				<param name="AutoStart" value="1">
+				<param name="FileName" value="', $context['verification_sound_href'], '">
 			</object>';
 	else
 		echo '
-			<object type="audio/x-wav" data="', $context['verification_sound_href'], '">
-				<a href="', $context['verification_sound_href'], '" rel="nofollow">', $context['verification_sound_href'], '</a>
-			</object>';
-	echo '
-			<br />
-			<a href="', $context['verification_sound_href'], ';sound" rel="nofollow">', $txt['visual_verification_sound_again'], '</a><br />
-			<a href="javascript:self.close();">', $txt['visual_verification_sound_close'], '</a><br />
-			<a href="', $context['verification_sound_href'], '" rel="nofollow">', $txt['visual_verification_sound_direct'], '</a>
+			<audio src="', $context['verification_sound_href'], '" controls>
+				<object type="audio/x-wav" data="', $context['verification_sound_href'], '">
+					<a href="', $context['verification_sound_href'], '" rel="nofollow">', $context['verification_sound_href'], '</a>
+				</object>
+			</audio>';
+	echo '
+		<br>
+		<a href="', $context['verification_sound_href'], ';sound" rel="nofollow">', $txt['visual_verification_sound_again'], '</a><br>
+		<a href="', $context['verification_sound_href'], '" rel="nofollow">', $txt['visual_verification_sound_direct'], '</a><br><br>
+		<a href="javascript:self.close();">', $txt['visual_verification_sound_close'], '</a><br>
 		</div>
 	</body>
 </html>';
@@ -512,130 +456,139 @@
 
 function template_admin_register()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<div id="admincenter">
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['admin_browse_register_new'], '</h3>
-		</div>
-		<form class="windowbg2" action="', $scripturl, '?action=admin;area=regcenter" method="post" accept-charset="', $context['character_set'], '" name="postForm" id="postForm">
-			<span class="topslice"><span></span></span>
-			<script type="text/javascript"><!-- // --><![CDATA[
-				function onCheckChange()
-				{
-					if (document.forms.postForm.emailActivate.checked || document.forms.postForm.password.value == \'\')
-					{
-						document.forms.postForm.emailPassword.disabled = true;
-						document.forms.postForm.emailPassword.checked = true;
-					}
-					else
-						document.forms.postForm.emailPassword.disabled = false;
-				}
-			// ]]></script>
-			<div class="content" id="register_screen">';
+		<div id="admin_form_wrapper">
+			<form id="postForm" action="', $scripturl, '?action=admin;area=regcenter" method="post" accept-charset="', $context['character_set'], '" name="postForm">
+				<div class="cat_bar">
+					<h3 class="catbg">', $txt['admin_browse_register_new'], '</h3>
+				</div>
+				<div id="register_screen" class="windowbg2">';
 
 	if (!empty($context['registration_done']))
 		echo '
-				<div class="windowbg" id="profile_success">
-					', $context['registration_done'], '
-				</div>';
+					<div class="infobox">
+						', $context['registration_done'], '
+					</div>';
 
 	echo '
-				<dl class="register_form" id="admin_register_form">
-					<dt>
-						<strong><label for="user_input">', $txt['admin_register_username'], ':</label></strong>
-						<span class="smalltext">', $txt['admin_register_username_desc'], '</span>
-					</dt>
-					<dd>
-						<input type="text" name="user" id="user_input" tabindex="', $context['tabindex']++, '" size="30" maxlength="25" class="input_text" />
-					</dd>
-					<dt>
-						<strong><label for="email_input">', $txt['admin_register_email'], ':</label></strong>
-						<span class="smalltext">', $txt['admin_register_email_desc'], '</span>
-					</dt>
-					<dd>
-						<input type="text" name="email" id="email_input" tabindex="', $context['tabindex']++, '" size="30" class="input_text" />
-					</dd>
-					<dt>
-						<strong><label for="password_input">', $txt['admin_register_password'], ':</label></strong>
-						<span class="smalltext">', $txt['admin_register_password_desc'], '</span>
-					</dt>
-					<dd>
-						<input type="password" name="password" id="password_input" tabindex="', $context['tabindex']++, '" size="30" class="input_password" onchange="onCheckChange();" />
-					</dd>';
+					<dl class="register_form" id="admin_register_form">
+						<dt>
+							<strong><label for="user_input">', $txt['admin_register_username'], ':</label></strong>
+							<span class="smalltext">', $txt['admin_register_username_desc'], '</span>
+						</dt>
+						<dd>
+							<input type="text" name="user" id="user_input" tabindex="', $context['tabindex']++, '" size="30" maxlength="25" class="input_text">
+						</dd>
+						<dt>
+							<strong><label for="email_input">', $txt['admin_register_email'], ':</label></strong>
+							<span class="smalltext">', $txt['admin_register_email_desc'], '</span>
+						</dt>
+						<dd>
+							<input type="text" name="email" id="email_input" tabindex="', $context['tabindex']++, '" size="30" class="input_text">
+						</dd>
+						<dt>
+							<strong><label for="password_input">', $txt['admin_register_password'], ':</label></strong>
+							<span class="smalltext">', $txt['admin_register_password_desc'], '</span>
+						</dt>
+						<dd>
+							<input type="password" name="password" id="password_input" tabindex="', $context['tabindex']++, '" size="30" class="input_password" onchange="onCheckChange();">
+						</dd>';
 
 	if (!empty($context['member_groups']))
 	{
 		echo '
-					<dt>
-						<strong><label for="group_select">', $txt['admin_register_group'], ':</label></strong>
-						<span class="smalltext">', $txt['admin_register_group_desc'], '</span>
-					</dt>
-					<dd>
-						<select name="group" id="group_select" tabindex="', $context['tabindex']++, '">';
+						<dt>
+							<strong><label for="group_select">', $txt['admin_register_group'], ':</label></strong>
+							<span class="smalltext">', $txt['admin_register_group_desc'], '</span>
+						</dt>
+						<dd>
+							<select name="group" id="group_select" tabindex="', $context['tabindex']++, '">';
 
 		foreach ($context['member_groups'] as $id => $name)
 			echo '
-							<option value="', $id, '">', $name, '</option>';
+								<option value="', $id, '">', $name, '</option>';
 
 		echo '
-						</select>
-					</dd>';
+							</select>
+						</dd>';
 	}
 
+	// If there is any field marked as required, show it here!
+	if (!empty($context['custom_fields_required']) && !empty($context['custom_fields']))
+		foreach ($context['custom_fields'] as $field)
+			if ($field['show_reg'] > 1)
+				echo '
+						<dt>
+							<strong', !empty($field['is_error']) ? ' class="red"' : '', '>', $field['name'], ':</strong>
+							<span class="smalltext">', $field['desc'], '</span>
+						</dt>
+						<dd>', str_replace('name="', 'tabindex="' . $context['tabindex']++ .'" name="', $field['input_html']), '</dd>';
+
 	echo '
-					<dt>
-						<strong><label for="emailPassword_check">', $txt['admin_register_email_detail'], ':</label></strong>
-						<span class="smalltext">', $txt['admin_register_email_detail_desc'], '</span>
-					</dt>
-					<dd>
-						<input type="checkbox" name="emailPassword" id="emailPassword_check" tabindex="', $context['tabindex']++, '" checked="checked" disabled="disabled" class="input_check" />
-					</dd>
-					<dt>
-						<strong><label for="emailActivate_check">', $txt['admin_register_email_activate'], ':</label></strong>
-					</dt>
-					<dd>
-						<input type="checkbox" name="emailActivate" id="emailActivate_check" tabindex="', $context['tabindex']++, '"', !empty($modSettings['registration_method']) && $modSettings['registration_method'] == 1 ? ' checked="checked"' : '', ' onclick="onCheckChange();" class="input_check" />
-					</dd>
-				</dl>
-				<div class="righttext">
-					<input type="submit" name="regSubmit" value="', $txt['register'], '" tabindex="', $context['tabindex']++, '" class="button_submit" />
-					<input type="hidden" name="sa" value="register" />
+						<dt>
+							<strong><label for="emailPassword_check">', $txt['admin_register_email_detail'], ':</label></strong>
+							<span class="smalltext">', $txt['admin_register_email_detail_desc'], '</span>
+						</dt>
+						<dd>
+							<input type="checkbox" name="emailPassword" id="emailPassword_check" tabindex="', $context['tabindex']++, '" checked disabled class="input_check">
+						</dd>
+						<dt>
+							<strong><label for="emailActivate_check">', $txt['admin_register_email_activate'], ':</label></strong>
+						</dt>
+						<dd>
+							<input type="checkbox" name="emailActivate" id="emailActivate_check" tabindex="', $context['tabindex']++, '"', !empty($modSettings['registration_method']) && $modSettings['registration_method'] == 1 ? ' checked' : '', ' onclick="onCheckChange();" class="input_check">
+						</dd>
+					</dl>
+					<div class="flow_auto">
+						<input type="submit" name="regSubmit" value="', $txt['register'], '" tabindex="', $context['tabindex']++, '" class="button_submit">
+						<input type="hidden" name="sa" value="register">
+						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+						<input type="hidden" name="', $context['admin-regc_token_var'], '" value="', $context['admin-regc_token'], '">
+					</div>
 				</div>
-			</div>
-			<span class="botslice"><span></span></span>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
+			</form>
+		</div>
 	</div>
-	<br class="clear" />';
+	<br class="clear">';
 }
 
 // Form for editing the agreement shown for people registering to the forum.
 function template_edit_agreement()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
+
+	if (!empty($context['saved_successful']))
+		echo '
+					<div class="infobox">', $txt['settings_saved'], '</div>';
+	elseif (!empty($context['could_not_save']))
+		echo '
+					<div class="errorbox">', $txt['admin_agreement_not_saved'], '</div>';
 
 	// Just a big box to edit the text file ;).
 	echo '
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['registration_agreement'], '</h3>
-		</div>';
+		<div id="admin_form_wrapper">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['registration_agreement'], '</h3>
+			</div>';
 
 	// Warning for if the file isn't writable.
 	if (!empty($context['warning']))
 		echo '
-		<p class="error">', $context['warning'], '</p>';
+			<p class="error">', $context['warning'], '</p>';
 
 	echo '
-		<div class="windowbg2" id="registration_agreement">
-			<span class="topslice"><span></span></span>
-			<div class="content">';
+			<div class="windowbg2" id="registration_agreement">';
 
 	// Is there more than one language to choose from?
 	if (count($context['editable_agreements']) > 1)
 	{
 		echo '
+				<div class="cat_bar">
+					<h3 class="catbg">', $txt['language_configuration'], '</h3>
+				</div>
 				<div class="information">
 					<form action="', $scripturl, '?action=admin;area=regcenter" id="change_reg" method="post" accept-charset="', $context['character_set'], '" style="display: inline;">
 						<strong>', $txt['admin_agreement_select_language'], ':</strong>&nbsp;
@@ -643,73 +596,95 @@
 
 		foreach ($context['editable_agreements'] as $file => $name)
 			echo '
-							<option value="', $file, '" ', $context['current_agreement'] == $file ? 'selected="selected"' : '', '>', $name, '</option>';
+							<option value="', $file, '"', $context['current_agreement'] == $file ? ' selected' : '', '>', $name, '</option>';
 
 		echo '
 						</select>
 						<div class="righttext">
-							<input type="hidden" name="sa" value="agreement" />
-							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-							<input type="submit" name="change" value="', $txt['admin_agreement_select_language_change'], '" tabindex="', $context['tabindex']++, '" class="button_submit" />
+							<input type="hidden" name="sa" value="agreement">
+							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+							<input type="hidden" name="', $context['admin-rega_token_var'], '" value="', $context['admin-rega_token'], '">
+							<input type="submit" name="change" value="', $txt['admin_agreement_select_language_change'], '" tabindex="', $context['tabindex']++, '" class="button_submit">
 						</div>
 					</form>
 				</div>';
 	}
 
-	echo '
-				<form action="', $scripturl, '?action=admin;area=regcenter" method="post" accept-charset="', $context['character_set'], '">';
+
 
 	// Show the actual agreement in an oversized text box.
 	echo '
+				<form action="', $scripturl, '?action=admin;area=regcenter" method="post" accept-charset="', $context['character_set'], '">
 					<p class="agreement">
 						<textarea cols="70" rows="20" name="agreement" id="agreement">', $context['agreement'], '</textarea>
 					</p>
 					<p>
-						<label for="requireAgreement"><input type="checkbox" name="requireAgreement" id="requireAgreement"', $context['require_agreement'] ? ' checked="checked"' : '', ' tabindex="', $context['tabindex']++, '" value="1" class="input_check" /> ', $txt['admin_agreement'], '.</label>
+						<label for="requireAgreement"><input type="checkbox" name="requireAgreement" id="requireAgreement"', $context['require_agreement'] ? ' checked' : '', ' tabindex="', $context['tabindex']++, '" value="1" class="input_check"> ', $txt['admin_agreement'], '.</label>
 					</p>
-					<div class="righttext">
-						<input type="submit" value="', $txt['save'], '" tabindex="', $context['tabindex']++, '" class="button_submit" />
-						<input type="hidden" name="agree_lang" value="', $context['current_agreement'], '" />
-						<input type="hidden" name="sa" value="agreement" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+					<div class="flow_auto">
+						<input type="submit" value="', $txt['save'], '" tabindex="', $context['tabindex']++, '" class="button_submit">
+						<input type="hidden" name="agree_lang" value="', $context['current_agreement'], '">
+						<input type="hidden" name="sa" value="agreement">
+						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+						<input type="hidden" name="', $context['admin-rega_token_var'], '" value="', $context['admin-rega_token'], '">
 					</div>
 				</form>
 			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-		<br class="clear" />';
+		</div>';
 }
 
 function template_edit_reserved_words()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
+
+	if (!empty($context['saved_successful']))
+		echo '
+	<div class="infobox">', $txt['settings_saved'], '</div>';
 
 	echo '
-		<div class="cat_bar">
-			<h3 class="catbg">', $txt['admin_reserved_set'], '</h3>
-		</div>
-		<form id="registration_agreement" class="windowbg2" action="', $scripturl, '?action=admin;area=regcenter" method="post" accept-charset="', $context['character_set'], '">
-			<span class="topslice"><span></span></span>
-			<div class="content">
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=regcenter" method="post" accept-charset="', $context['character_set'], '">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['admin_reserved_set'], '</h3>
+			</div>
+			<div class="windowbg2">
 				<h4>', $txt['admin_reserved_line'], '</h4>
 				<p class="reserved_names">
 					<textarea cols="30" rows="6" name="reserved" id="reserved">', implode("\n", $context['reserved_words']), '</textarea>
 				</p>
-				<ul class="reset">
-					<li><label for="matchword"><input type="checkbox" name="matchword" id="matchword" tabindex="', $context['tabindex']++, '" ', $context['reserved_word_options']['match_word'] ? 'checked="checked"' : '', ' class="input_check" /> ', $txt['admin_match_whole'], '</label></li>
-					<li><label for="matchcase"><input type="checkbox" name="matchcase" id="matchcase" tabindex="', $context['tabindex']++, '" ', $context['reserved_word_options']['match_case'] ? 'checked="checked"' : '', ' class="input_check" /> ', $txt['admin_match_case'], '</label></li>
-					<li><label for="matchuser"><input type="checkbox" name="matchuser" id="matchuser" tabindex="', $context['tabindex']++, '" ', $context['reserved_word_options']['match_user'] ? 'checked="checked"' : '', ' class="input_check" /> ', $txt['admin_check_user'], '</label></li>
-					<li><label for="matchname"><input type="checkbox" name="matchname" id="matchname" tabindex="', $context['tabindex']++, '" ', $context['reserved_word_options']['match_name'] ? 'checked="checked"' : '', ' class="input_check" /> ', $txt['admin_check_display'], '</label></li>
-				</ul>
-				<div class="righttext">
-					<input type="submit" value="', $txt['save'], '" name="save_reserved_names" tabindex="', $context['tabindex']++, '" style="margin: 1ex;" class="button_submit" />
+				<dl class="settings">
+					<dt>
+						<label for="matchword">', $txt['admin_match_whole'], '</label>
+					</dt>
+					<dd>
+						<input type="checkbox" name="matchword" id="matchword" tabindex="', $context['tabindex']++, '"', $context['reserved_word_options']['match_word'] ? ' checked' : '', ' class="input_check">
+					</dd>
+					<dt>
+						<label for="matchcase">', $txt['admin_match_case'], '</label>
+					</dt>
+					<dd>
+						<input type="checkbox" name="matchcase" id="matchcase" tabindex="', $context['tabindex']++, '"', $context['reserved_word_options']['match_case'] ? ' checked' : '', ' class="input_check">
+					</dd>
+					<dt>
+						<label for="matchuser">', $txt['admin_check_user'], '</label>
+					</dt>
+					<dd>
+						<input type="checkbox" name="matchuser" id="matchuser" tabindex="', $context['tabindex']++, '"', $context['reserved_word_options']['match_user'] ? ' checked' : '', ' class="input_check">
+					</dd>
+					<dt>
+						<label for="matchname">', $txt['admin_check_display'], '</label>
+					</dt>
+					<dd>
+						<input type="checkbox" name="matchname" id="matchname" tabindex="', $context['tabindex']++, '"', $context['reserved_word_options']['match_name'] ? ' checked' : '', ' class="input_check">
+					</dd>
+				</dl>
+				<div class="flow_auto">
+					<input type="submit" value="', $txt['save'], '" name="save_reserved_names" tabindex="', $context['tabindex']++, '" style="margin: 1ex;" class="button_submit">
+					<input type="hidden" name="sa" value="reservednames">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['admin-regr_token_var'], '" value="', $context['admin-regr_token'], '">
 				</div>
 			</div>
-			<span class="botslice"><span></span></span>
-			<input type="hidden" name="sa" value="reservednames" />
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
-		<br class="clear" />';
+		</form>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Reminder.template.php b/Themes/default/Reminder.template.php
--- a/Themes/default/Reminder.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Reminder.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,76 +3,77 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_main()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
-	<br />
+	<br>
 	<form action="', $scripturl, '?action=reminder;sa=picktype" method="post" accept-charset="', $context['character_set'], '">
 		<div class="tborder login">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['authentication_reminder'], '</h3>
 			</div>
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
 				<p class="smalltext centertext">', $txt['password_reminder_desc'], '</p>
 				<dl>
 					<dt>', $txt['user_email'], ':</dt>
-					<dd><input type="text" name="user" size="30" class="input_text" /></dd>
+					<dd><input type="text" name="user" size="30" class="input_text"></dd>
 				</dl>
-				<p class="centertext"><input type="submit" value="', $txt['reminder_continue'], '" class="button_submit" /></p>
+				<input type="submit" value="', $txt['reminder_continue'], '" class="button_submit">
+				<br class="clear">
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</div>
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+		<input type="hidden" name="', $context['remind_token_var'], '" value="', $context['remind_token'], '">
 	</form>';
 }
 
 function template_reminder_pick()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
-	<br />
+	<br>
 	<form action="', $scripturl, '?action=reminder;sa=picktype" method="post" accept-charset="', $context['character_set'], '">
 		<div class="tborder login">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['authentication_reminder'], '</h3>
 			</div>
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
 				<p><strong>', $txt['authentication_options'], ':</strong></p>
 				<p>
-					<input type="radio" name="reminder_type" id="reminder_type_email" value="email" checked="checked" class="input_radio" /></dt>
-					<label for="reminder_type_email">', $txt['authentication_' . $context['account_type'] . '_email'], '</label></dd>
+					<input type="radio" name="reminder_type" id="reminder_type_email" value="email" checked class="input_radio"></dt>
+					<label for="reminder_type_email">', $txt['authentication_password_email'], '</label></dd>
 				</p>
 				<p>
-					<input type="radio" name="reminder_type" id="reminder_type_secret" value="secret" class="input_radio" />
-					<label for="reminder_type_secret">', $txt['authentication_' . $context['account_type'] . '_secret'], '</label>
+					<input type="radio" name="reminder_type" id="reminder_type_secret" value="secret" class="input_radio">
+					<label for="reminder_type_secret">', $txt['authentication_password_secret'], '</label>
 				</p>
-				<p class="centertext"><input type="submit" value="', $txt['reminder_continue'], '" class="button_submit" /></p>
+				<div class="flow_auto">
+					<input type="submit" value="', $txt['reminder_continue'], '" class="button_submit">
+					<input type="hidden" name="uid" value="', $context['current_member']['id'], '">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['remind_token_var'], '" value="', $context['remind_token'], '">
+				</div>
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</div>
-		<input type="hidden" name="uid" value="', $context['current_member']['id'], '" />
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
 	</form>';
 }
 
 function template_sent()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context;
 
 	echo '
-		<br />
+		<br>
 		<div class="tborder login" id="reminder_sent">
 			<div class="cat_bar">
 				<h3 class="catbg">' . $context['page_title'] . '</h3>
@@ -83,43 +84,41 @@
 
 function template_set_password()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $txt, $scripturl, $modSettings;
 
 	echo '
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/register.js"></script>
-	<br />
+	<br>
 	<form action="', $scripturl, '?action=reminder;sa=setpassword2" name="reminder_form" id="reminder_form" method="post" accept-charset="', $context['character_set'], '">
 		<div class="tborder login">
 			<div class="cat_bar">
 				<h3 class="catbg">', $context['page_title'], '</h3>
 			</div>
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
 				<dl>
 					<dt>', $txt['choose_pass'], ': </dt>
 					<dd>
-						<input type="password" name="passwrd1" id="smf_autov_pwmain" size="22" class="input_password" />
+						<input type="password" name="passwrd1" id="smf_autov_pwmain" size="22" class="input_password">
 						<span id="smf_autov_pwmain_div" style="display: none;">
-							<img id="smf_autov_pwmain_img" src="', $settings['images_url'], '/icons/field_invalid.gif" alt="*" />
+							<span id="smf_autov_pwmain_img" class="generic_icons invalid"></span>
 						</span>
 					</dd>
 					<dt>', $txt['verify_pass'], ': </dt>
 					<dd>
-						<input type="password" name="passwrd2" id="smf_autov_pwverify" size="22" class="input_password" />
+						<input type="password" name="passwrd2" id="smf_autov_pwverify" size="22" class="input_password">
 						<span id="smf_autov_pwverify_div" style="display: none;">
-							<img id="smf_autov_pwverify_img" src="', $settings['images_url'], '/icons/field_invalid.gif" alt="*" />
+							<span id="smf_autov_pwverify_img" class="generic_icons invalid"></span>
 						</span>
 					</dd>
 				</dl>
-				<p class="align_center"><input type="submit" value="', $txt['save'], '" class="button_submit" /></p>
+				<p class="align_center"><input type="submit" value="', $txt['save'], '" class="button_submit"></p>
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</div>
-		<input type="hidden" name="code" value="', $context['code'], '" />
-		<input type="hidden" name="u" value="', $context['memID'], '" />
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+		<input type="hidden" name="code" value="', $context['code'], '">
+		<input type="hidden" name="u" value="', $context['memID'], '">
+		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+		<input type="hidden" name="', $context['remind-sp_token_var'], '" value="', $context['remind-sp_token'], '">
 	</form>
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 	var regTextStrings = {
 		"password_short": "', $txt['registration_password_short'], '",
 		"password_reserved": "', $txt['registration_password_reserved'], '",
@@ -133,55 +132,47 @@
 
 function template_ask()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $txt, $scripturl, $modSettings;
 
 	echo '
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/register.js"></script>
-	<br />
+	<br>
 	<form action="', $scripturl, '?action=reminder;sa=secret2" method="post" accept-charset="', $context['character_set'], '" name="creator" id="creator">
 		<div class="tborder login">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['authentication_reminder'], '</h3>
 			</div>
-			<span class="upperframe"><span></span></span>
 			<div class="roundframe">
-				<p class="smalltext">', $context['account_type'] == 'password' ? $txt['enter_new_password'] : $txt['openid_secret_reminder'], '</p>
+				<p class="smalltext">', $txt['enter_new_password'], '</p>
 				<dl>
 					<dt>', $txt['secret_question'], ':</dt>
 					<dd>', $context['secret_question'], '</dd>
 					<dt>', $txt['secret_answer'], ':</dt>
-					<dd><input type="text" name="secret_answer" size="22" class="input_text" /></dd>';
-
-	if ($context['account_type'] == 'password')
-		echo '
+					<dd><input type="text" name="secret_answer" size="22" class="input_text"></dd>
 					<dt>', $txt['choose_pass'], ': </dt>
 					<dd>
-						<input type="password" name="passwrd1" id="smf_autov_pwmain" size="22" class="input_password" />
+						<input type="password" name="passwrd1" id="smf_autov_pwmain" size="22" class="input_password">
 						<span id="smf_autov_pwmain_div" style="display: none;">
-							<img id="smf_autov_pwmain_img" src="', $settings['images_url'], '/icons/field_invalid.gif" alt="*" />
+							<span id="smf_autov_pwmain_img" class="generic_icons invalid"></span>
 						</span>
 					</dd>
 					<dt>', $txt['verify_pass'], ': </dt>
 					<dd>
-						<input type="password" name="passwrd2" id="smf_autov_pwverify" size="22" class="input_password" />
+						<input type="password" name="passwrd2" id="smf_autov_pwverify" size="22" class="input_password">
 						<span id="smf_autov_pwverify_div" style="display: none;">
-							<img id="smf_autov_pwverify_img" src="', $settings['images_url'], '/icons/field_valid.gif" alt="*" />
+							<span id="smf_autov_pwverify_img" class="generic_icons valid"></span>
 						</span>
-					</dd>';
-
-	echo '
+					</dd>
 				</dl>
-				<p class="align_center"><input type="submit" value="', $txt['save'], '" class="button_submit" /></p>
+				<div class="auto_flow">
+					<input type="submit" value="', $txt['save'], '" class="button_submit">
+					<input type="hidden" name="uid" value="', $context['remind_user'], '">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+					<input type="hidden" name="', $context['remind-sai_token_var'], '" value="', $context['remind-sai_token'], '">
+				</div>
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</div>
-		<input type="hidden" name="uid" value="', $context['remind_user'], '" />
-		<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-	</form>';
-
-	if ($context['account_type'] == 'password')
-		echo '
-<script type="text/javascript"><!-- // --><![CDATA[
+	</form>
+<script><!-- // --><![CDATA[
 	var regTextStrings = {
 		"password_short": "', $txt['registration_password_short'], '",
 		"password_reserved": "', $txt['registration_password_reserved'], '",
Only in b/Themes/default: ReportedContent.template.php
diff -ru a/Themes/default/Reports.template.php b/Themes/default/Reports.template.php
--- a/Themes/default/Reports.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Reports.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,33 +3,26 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // Choose which type of report to run?
 function template_report_type()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
 		<form action="', $scripturl, '?action=admin;area=reports" method="post" accept-charset="', $context['character_set'], '">
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['generate_reports'], '</h3>
-			</div>
-			<div class="information">
-				', $txt['generate_reports_desc'], '
-			</div>
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['generate_reports_type'], '</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
+			<div id="generate_reports_type">
+				<div class="cat_bar">
+					<h3 class="catbg">', $txt['generate_reports_type'], '</h3>
+				</div>
+				<div class="windowbg2">
 					<dl class="generate_report">';
 
 	// Go through each type of report they can run.
@@ -37,7 +30,7 @@
 	{
 		echo '
 						<dt>
-							<input type="radio" id="rt_', $type['id'], '" name="rt" value="', $type['id'], '"', $type['is_first'] ? ' checked="checked"' : '', ' class="input_radio" />
+							<input type="radio" id="rt_', $type['id'], '" name="rt" value="', $type['id'], '"', $type['is_first'] ? ' checked' : '', ' class="input_radio">
 							<strong><label for="rt_', $type['id'], '">', $type['title'], '</label></strong>
 						</dt>';
 		if (isset($type['description']))
@@ -46,38 +39,28 @@
 	}
 		echo '
 					</dl>
-					<div class="righttext">
-						<input type="submit" name="continue" value="', $txt['generate_reports_continue'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					</div>
+					<input type="submit" name="continue" value="', $txt['generate_reports_continue'], '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // This is the standard template for showing reports in.
 function template_main()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
-
-	// Build the reports button array.
-	$report_buttons = array(
-			'generate_reports' => array('text' => 'generate_reports', 'image' => 'print.gif', 'lang' => true, 'url' => $scripturl . '?action=admin;area=reports', 'active' => true),
-			'print' => array('text' => 'print', 'image' => 'print.gif', 'lang' => true, 'url' => $scripturl . '?action=admin;area=reports;rt=' . $context['report_type']. ';st=print', 'custom' => 'target="_blank"'),
-		);
+	global $context, $txt;
 
 	echo '
 	<div id="admincenter">
-		<div class="title_bar">
-			<h3 class="titlebg">', $txt['results'], '</h3>
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['results'], '</h3>
 		</div>
 		<div id="report_buttons">';
 
-	if (!empty($report_buttons) && !empty($settings['use_tabs']))
-		template_button_strip($report_buttons, 'right');
+	if (!empty($context['report_buttons']))
+		template_button_strip($context['report_buttons'], 'right');
 
 	echo '
 		</div>';
@@ -86,12 +69,12 @@
 	foreach ($context['tables'] as $table)
 	{
 		echo '
-		<table class="table_grid" width="100%">';
+		<table class="table_grid report_results">';
 
 		if (!empty($table['title']))
 			echo '
 			<thead>
-				<tr class="catbg">
+				<tr class="title_bar">
 					<th scope="col" colspan="', $table['column_count'], '">', $table['title'], '</th>
 				</tr>
 			</thead>
@@ -99,7 +82,6 @@
 
 		// Now do each row!
 		$row_number = 0;
-		$alternate = false;
 		foreach ($table['data'] as $row)
 		{
 			if ($row_number == 0 && !empty($table['shading']['top']))
@@ -107,12 +89,12 @@
 				<tr class="windowbg table_caption">';
 			else
 				echo '
-				<tr class="', !empty($row[0]['separator']) ? 'catbg' : ($alternate ? 'windowbg' : 'windowbg2'), '" valign="top">';
+				<tr class="', !empty($row[0]['separator']) ? 'title_bar' : 'windowbg', '">';
 
 			// Now do each column.
 			$column_number = 0;
 
-			foreach ($row as $key => $data)
+			foreach ($row as $data)
 			{
 				// If this is a special separator, skip over!
 				if (!empty($data['separator']) && $column_number == 0)
@@ -143,72 +125,70 @@
 				</tr>';
 
 			$row_number++;
-			$alternate = !$alternate;
 		}
 		echo '
 			</tbody>
-		</table>';
+		</table>
+		<br>';
 	}
 	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Header of the print page!
 function template_print_above()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $settings, $modSettings;
 
-	echo '<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
-<html xmlns="http://www.w3.org/1999/xhtml"', $context['right_to_left'] ? ' dir="rtl"' : '', '>
+	echo '<!DOCTYPE html>
+<html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />
+		<meta charset="', $context['character_set'], '">
 		<title>', $context['page_title'], '</title>
-		<link rel="stylesheet" type="text/css" href="', $settings['default_theme_url'], '/css/report.css" />
+		<link rel="stylesheet" type="text/css" href="', $settings['default_theme_url'], '/css/report.css', $modSettings['browser_cache'] ,'">
 	</head>
 	<body>';
 }
 
 function template_print()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context;
 
 	// Go through each table!
 	foreach ($context['tables'] as $table)
 	{
 		echo '
 		<div style="overflow: visible;', $table['max_width'] != 'auto' ? ' width: ' . $table['max_width'] . 'px;' : '', '">
-			<table border="0" cellspacing="1" cellpadding="4" width="100%" class="bordercolor">';
+			<table class="bordercolor">';
 
 		if (!empty($table['title']))
 			echo '
-				<tr class="catbg">
+				<tr class="title_bar">
 					<td colspan="', $table['column_count'], '">
 						', $table['title'], '
 					</td>
 				</tr>';
 
 		// Now do each row!
-		$alternate = false;
 		$row_number = 0;
 		foreach ($table['data'] as $row)
 		{
 			if ($row_number == 0 && !empty($table['shading']['top']))
 				echo '
-				<tr class="titlebg" valign="top">';
+				<tr class="titlebg">';
 			else
 				echo '
-				<tr class="', $alternate ? 'windowbg' : 'windowbg2', '" valign="top">';
+				<tr class="windowbg">';
 
 			// Now do each column!!
 			$column_number = 0;
-			foreach ($row as $key => $data)
+			foreach ($row as $data)
 			{
 				// If this is a special separator, skip over!
 				if (!empty($data['separator']) && $column_number == 0)
 				{
 					echo '
-					<td colspan="', $table['column_count'], '" class="catbg">
+					<td colspan="', $table['column_count'], '" class="smalltext">
 						<strong>', $data['v'], ':</strong>
 					</td>';
 					break;
@@ -233,19 +213,16 @@
 				</tr>';
 
 			$row_number++;
-			$alternate = !$alternate;
 		}
 		echo '
 			</table>
-		</div><br />';
+		</div><br>';
 	}
 }
 
 // Footer of the print page.
 function template_print_below()
 {
-	global $context, $settings, $options;
-
 	echo '
 		<div class="copyright">', theme_copyright(), '</div>
 	</body>
Only in b/Themes/default: ReportToMod.template.php
diff -ru a/Themes/default/scripts/admin.js b/Themes/default/scripts/admin.js
--- a/Themes/default/scripts/admin.js	2011-06-11 07:13:11.000000000 -0700
+++ b/Themes/default/scripts/admin.js	2015-03-05 23:30:06.031345444 -0800
@@ -95,15 +95,7 @@
 	// Parse in the package download URL if it exists in the string.
 	document.getElementById('update-link').href = this.opt.sUpdateNotificationLink.replace('%package%', window.smfUpdatePackage);
 
-	// If we decide to override life into "red" mode, do it.
-	if ('smfUpdateCritical' in window)
-	{
-		document.getElementById('update_table').style.backgroundColor = '#aa2222';
-		document.getElementById('update_title').style.backgroundColor = '#dd2222';
-		document.getElementById('update_title').style.color = 'white';
-		document.getElementById('update_message').style.backgroundColor = '#eebbbb';
-		document.getElementById('update_message').style.color = 'black';
-	}
+	oContainer.className = ('smfUpdateCritical' in window) ? 'errorbox' : 'noticebox';
 }
 
 
@@ -134,7 +126,10 @@
 {
 	// If it is undefined, or currently off, turn it on - otherwise off.
 	this.oSwaps[sName] = !(sName in this.oSwaps) || !this.oSwaps[sName];
-	document.getElementById(sName).style.display = this.oSwaps[sName] ? '' : 'none';
+	if (this.oSwaps[sName])
+		$("#" + sName).show(300);
+	else
+		$("#" + sName).hide(300);
 
 	// Unselect the link and return false.
 	oSendingElement.blur();
@@ -196,26 +191,30 @@
 		Sources: '??',
 		Default: '??',
 		Languages: '??',
-		Templates: '??'
+		Templates: '??',
+		Tasks: '??'
 	};
 	var oHighCurrent = {
 		Sources: '??',
 		Default: '??',
 		Languages: '??',
-		Templates: '??'
+		Templates: '??',
+		Tasks: '??'
 	};
 	var oLowVersion = {
 		Sources: false,
 		Default: false,
 		Languages: false,
-		Templates: false
+		Templates: false,
+		Tasks: false
 	};
 
 	var sSections = [
 		'Sources',
 		'Default',
 		'Languages',
-		'Templates'
+		'Templates',
+		'Tasks'
 	];
 
 	for (var i = 0, n = sSections.length; i < n; i++)
@@ -327,4 +326,296 @@
 	setInnerHTML(document.getElementById('currentLanguages'), oHighCurrent.Languages);
 	if (oLowVersion.Languages)
 		document.getElementById('yourLanguages').style.color = 'red';
+}
+
+function addNewWord()
+{
+	setOuterHTML(document.getElementById('moreCensoredWords'), '<div style="margin-top: 1ex;"><input type="text" name="censor_vulgar[]" size="30" class="input_text"> => <input type="text" name="censor_proper[]" size="30" class="input_text"><' + '/div><div id="moreCensoredWords"><' + '/div>');
+}
+
+function toggleBBCDisabled(section, disable)
+{
+	elems = document.getElementById(section).getElementsByTagName('*');
+	for (var i = 0; i < elems.length; i++)
+	{
+		if (typeof(elems[i].name) == "undefined" || (elems[i].name.substr((section.length + 1), (elems[i].name.length - 2 - (section.length + 1))) != "enabledTags") || (elems[i].name.indexOf(section) != 0))
+			continue;
+
+		elems[i].disabled = disable;
+	}
+	document.getElementById("bbc_" + section + "_select_all").disabled = disable;
+}
+
+function updateInputBoxes()
+{
+	curType = document.getElementById("field_type").value;
+	privStatus = document.getElementById("private").value;
+	document.getElementById("max_length_dt").style.display = curType == "text" || curType == "textarea" ? "" : "none";
+	document.getElementById("max_length_dd").style.display = curType == "text" || curType == "textarea" ? "" : "none";
+	document.getElementById("dimension_dt").style.display = curType == "textarea" ? "" : "none";
+	document.getElementById("dimension_dd").style.display = curType == "textarea" ? "" : "none";
+	document.getElementById("bbc_dt").style.display = curType == "text" || curType == "textarea" ? "" : "none";
+	document.getElementById("bbc_dd").style.display = curType == "text" || curType == "textarea" ? "" : "none";
+	document.getElementById("options_dt").style.display = curType == "select" || curType == "radio" ? "" : "none";
+	document.getElementById("options_dd").style.display = curType == "select" || curType == "radio" ? "" : "none";
+	document.getElementById("default_dt").style.display = curType == "check" ? "" : "none";
+	document.getElementById("default_dd").style.display = curType == "check" ? "" : "none";
+	document.getElementById("mask_dt").style.display = curType == "text" ? "" : "none";
+	document.getElementById("mask").style.display = curType == "text" ? "" : "none";
+	document.getElementById("can_search_dt").style.display = curType == "text" || curType == "textarea" || curType == "select" ? "" : "none";
+	document.getElementById("can_search_dd").style.display = curType == "text" || curType == "textarea" || curType == "select" ? "" : "none";
+	document.getElementById("regex_div").style.display = curType == "text" && document.getElementById("mask").value == "regex" ? "" : "none";
+	document.getElementById("display").disabled = false;
+	// Cannot show this on the topic
+	if (curType == "textarea" || privStatus >= 2)
+	{
+		document.getElementById("display").checked = false;
+		document.getElementById("display").disabled = true;
+	}
+}
+
+function addOption()
+{
+	setOuterHTML(document.getElementById("addopt"), '<br><input type="radio" name="default_select" value="' + startOptID + '" id="' + startOptID + '" class="input_radio"><input type="text" name="select_option[' + startOptID + ']" value="" class="input_text"><span id="addopt"></span>');
+	startOptID++;
+}
+
+
+//Create a named element dynamically - thanks to: http://www.thunderguy.com/semicolon/2005/05/23/setting-the-name-attribute-in-internet-explorer/
+function createNamedElement(type, name, customFields)
+{
+	var element = null;
+
+	if (!customFields)
+		customFields = "";
+
+	// Try the IE way; this fails on standards-compliant browsers
+	try
+	{
+		element = document.createElement("<" + type + ' name="' + name + '" ' + customFields + ">");
+	}
+	catch (e)
+	{
+	}
+	if (!element || element.nodeName != type.toUpperCase())
+	{
+		// Non-IE browser; use canonical method to create named element
+		element = document.createElement(type);
+		element.name = name;
+	}
+
+	return element;
+}
+
+function smfSetLatestThemes()
+{
+	if (typeof(window.smfLatestThemes) != "undefined")
+		setInnerHTML(document.getElementById("themeLatest"), window.smfLatestThemes);
+
+	if (tempOldOnload)
+		tempOldOnload();
+}
+
+function changeVariant(sVariant)
+{
+	document.getElementById('variant_preview').src = oThumbnails[sVariant];
+}
+
+// The idea here is simple: don't refresh the preview on every keypress, but do refresh after they type.
+function setPreviewTimeout()
+{
+	if (previewTimeout)
+	{
+		window.clearTimeout(previewTimeout);
+		previewTimeout = null;
+	}
+
+	previewTimeout = window.setTimeout("refreshPreview(true); previewTimeout = null;", 500);
+}
+
+function toggleDuration(toChange)
+{
+	if (toChange == 'fixed')
+	{
+		document.getElementById("fixed_area").style.display = "inline";
+		document.getElementById("flexible_area").style.display = "none";
+	}
+	else
+	{
+		document.getElementById("fixed_area").style.display = "none";
+		document.getElementById("flexible_area").style.display = "inline";
+	}
+}
+
+function calculateNewValues()
+{
+	var total = 0;
+	for (var i = 1; i <= 6; i++)
+	{
+		total += parseInt(document.getElementById('weight' + i + '_val').value);
+	}
+	setInnerHTML(document.getElementById('weighttotal'), total);
+	for (var i = 1; i <= 6; i++)
+	{
+		setInnerHTML(document.getElementById('weight' + i), (Math.round(1000 * parseInt(document.getElementById('weight' + i + '_val').value) / total) / 10) + '%');
+	}
+}
+
+function switchType()
+{
+	document.getElementById("ul_settings").style.display = document.getElementById("method-existing").checked ? "none" : "";
+	document.getElementById("ex_settings").style.display = document.getElementById("method-upload").checked ? "none" : "";
+}
+
+function swapUploads()
+{
+	document.getElementById("uploadMore").style.display = document.getElementById("uploadSmiley").disabled ? "none" : "";
+	document.getElementById("uploadSmiley").disabled = !document.getElementById("uploadSmiley").disabled;
+}
+
+function selectMethod(element)
+{
+	document.getElementById("method-existing").checked = element != "upload";
+	document.getElementById("method-upload").checked = element == "upload";
+}
+
+function updatePreview()
+{
+	var currentImage = document.getElementById("preview");
+	currentImage.src = smf_smileys_url + "/" + document.forms.smileyForm.set.value + "/" + document.forms.smileyForm.smiley_filename.value;
+}
+
+function swap_database_changes()
+{
+	db_vis = !db_vis;
+	database_changes_area.style.display = db_vis ? "" : "none";
+	return false;
+}
+
+function testFTP()
+{
+	ajax_indicator(true);
+
+	// What we need to post.
+	var oPostData = {
+		0: "ftp_server",
+		1: "ftp_port",
+		2: "ftp_username",
+		3: "ftp_password",
+		4: "ftp_path"
+	}
+
+	var sPostData = "";
+	for (i = 0; i < 5; i++)
+		sPostData = sPostData + (sPostData.length == 0 ? "" : "&") + oPostData[i] + "=" + escape(document.getElementById(oPostData[i]).value);
+
+	// Post the data out.
+	sendXMLDocument(smf_prepareScriptUrl(smf_scripturl) + 'action=admin;area=packages;sa=ftptest;xml;' + smf_session_var + '=' + smf_session_id, sPostData, testFTPResults);
+}
+
+function expandFolder(folderIdent, folderReal)
+{
+	// See if it already exists.
+	var possibleTags = document.getElementsByTagName("tr");
+	var foundOne = false;
+
+	for (var i = 0; i < possibleTags.length; i++)
+	{
+		if (possibleTags[i].id.indexOf("content_" + folderIdent + ":-:") == 0)
+		{
+			possibleTags[i].style.display = possibleTags[i].style.display == "none" ? "" : "none";
+			foundOne = true;
+		}
+	}
+
+	// Got something then we're done.
+	if (foundOne)
+	{
+		return false;
+	}
+	// Otherwise we need to get the wicked thing.
+	else if (window.XMLHttpRequest)
+	{
+		ajax_indicator(true);
+		getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + 'action=admin;area=packages;onlyfind=' + escape(folderReal) + ';sa=perms;xml;' + smf_session_var + '=' + smf_session_id, onNewFolderReceived);
+	}
+	// Otherwise reload.
+	else
+		return true;
+
+	return false;
+}
+
+function dynamicExpandFolder()
+{
+	expandFolder(this.ident, this.path);
+
+	return false;
+}
+
+function repeatString(sString, iTime)
+{
+	if (iTime < 1)
+		return '';
+	else
+		return sString + repeatString(sString, iTime - 1);
+}
+
+function select_in_category(cat_id, elem, brd_list)
+{
+	for (var brd in brd_list)
+		document.getElementById(elem.value + '_brd' + brd_list[brd]).checked = true;
+
+	elem.selectedIndex = 0;
+}
+
+/*
+* Server Settings > Caching
+*/
+function toggleCache ()
+{
+	var memcache = document.getElementById('cache_memcached');
+	var cachedir = document.getElementById('cachedir');
+	memcache.disabled = cache_type.value != "memcached";
+	cachedir.disabled = cache_type.value != "smf";
+}
+
+/*
+* Attachments Settings
+*/
+function toggleSubDir ()
+{
+	var auto_attach = document.getElementById('automanage_attachments');
+	var use_sub_dir = document.getElementById('use_subdirectories_for_attachments');
+	var dir_elem = document.getElementById('basedirectory_for_attachments');
+
+	use_sub_dir.disabled = !Boolean(auto_attach.selectedIndex);
+	if (use_sub_dir.disabled)
+	{
+		use_sub_dir.style.display = "none";
+		document.getElementById('setting_use_subdirectories_for_attachments').parentNode.style.display = "none";
+		dir_elem.style.display = "none";
+		document.getElementById('setting_basedirectory_for_attachments').parentNode.style.display = "none";
+	}
+	else
+	{
+		use_sub_dir.style.display = "";
+		document.getElementById('setting_use_subdirectories_for_attachments').parentNode.style.display = "";
+		dir_elem.style.display = "";
+		document.getElementById('setting_basedirectory_for_attachments').parentNode.style.display = "";
+	}
+		toggleBaseDir();
+}
+function toggleBaseDir ()
+{
+	var auto_attach = document.getElementById('automanage_attachments');
+	var sub_dir = document.getElementById('use_subdirectories_for_attachments');
+	var dir_elem = document.getElementById('basedirectory_for_attachments');
+
+	if (auto_attach.selectedIndex == 0)
+	{
+		dir_elem.disabled = 1;
+	}
+	else
+		dir_elem.disabled = !sub_dir.checked;
 }
\ No newline at end of file
Only in b/Themes/default/scripts: alertSettings.js
Only in b/Themes/default/scripts: alerts.js
Only in b/Themes/default/scripts: drafts.js
diff -ru a/Themes/default/scripts/editor.js b/Themes/default/scripts/editor.js
--- a/Themes/default/scripts/editor.js	2014-06-16 10:10:18.000000000 -0700
+++ b/Themes/default/scripts/editor.js	2015-03-05 23:30:06.031345444 -0800
@@ -1,1058 +1,30 @@
 // *** smc_Editor class.
+/*
+ Kept for compatibility with SMF 2.0 editor
+ */
 function smc_Editor(oOptions)
 {
 	this.opt = oOptions;
 
-	// Create some links to the editor object.
-	this.oTextHandle = null;
-	this.sCurrentText = 'sText' in this.opt ? this.opt.sText : '';
-
-	// How big?
-	this.sEditWidth = 'sEditWidth' in this.opt ? this.opt.sEditWidth : '70%';
-	this.sEditHeight = 'sEditHeight' in this.opt ? this.opt.sEditHeight : '150px';
-
-	this.showDebug = false;
-	this.bRichTextEnabled = 'bWysiwyg' in this.opt && this.opt.bWysiwyg;
-	// This doesn't work on Opera as they cannot restore focus after clicking a BBC button.
-	this.bRichTextPossible = !this.opt.bRichEditOff && ((is_ie5up && !is_ie50) || is_ff || is_opera95up || is_safari || is_chrome) && !(is_iphone || is_android);
-
-	this.oFrameHandle = null;
-	this.oFrameDocument = null;
-	this.oFrameWindow = null;
-
-	// These hold the breadcrumb.
-	this.oBreadHandle = null;
-	this.oResizerElement = null;
-
-	// Kinda holds all the useful stuff.
-	this.aKeyboardShortcuts = new Array();
-
-	// This tracks the cursor position on IE to avoid refocus problems.
-	this.cursorX = 0;
-	this.cursorY = 0;
-
-	// This is all the elements that can have a simple execCommand.
-	this.oSimpleExec = {
-		b: 'bold',
-		u: 'underline',
-		i: 'italic',
-		s: 'strikethrough',
-		left: 'justifyleft',
-		center: 'justifycenter',
-		right: 'justifyright',
-		hr: 'inserthorizontalrule',
-		list: 'insertunorderedlist',
-		orderlist: 'insertorderedlist',
-		sub: 'subscript',
-		sup: 'superscript',
-		indent: 'indent',
-		outdent: 'outdent'
-	}
-
-	// Codes to call a private function
-	this.oSmfExec = {
-		unformat: 'removeFormatting',
-		toggle: 'toggleView'
-	}
-
-	// Any special breadcrumb mappings to ensure we show a consistant tag name.
-	this.breadCrumbNameTags = {
-		strike: 's',
-		strong: 'b',
-		em: 'i'
-	}
-
-	this.aBreadCrumbNameStyles = [
-		{
-			sStyleType: 'text-decoration',
-			sStyleValue: 'underline',
-			sBbcTag: 'u'
-		},
-		{
-			sStyleType: 'text-decoration',
-			sStyleValue: 'line-through',
-			sBbcTag: 's'
-		},
-		{
-			sStyleType: 'text-align',
-			sStyleValue: 'left',
-			sBbcTag: 'left'
-		},
-		{
-			sStyleType: 'text-align',
-			sStyleValue: 'center',
-			sBbcTag: 'center'
-		},
-		{
-			sStyleType: 'text-align',
-			sStyleValue: 'right',
-			sBbcTag: 'right'
-		},
-		{
-			sStyleType: 'font-weight',
-			sStyleValue: 'bold',
-			sBbcTag: 'b'
-		},
-		{
-			sStyleType: 'font-style',
-			sStyleValue: 'italic',
-			sBbcTag: 'i'
-		}
-	];
-
-	// All the fonts in the world.
-	this.aFontFaces = [
-		'Arial',
-		'Arial Black',
-		'Impact',
-		'Verdana',
-		'Times New Roman',
-		'Georgia',
-		'Andale Mono',
-		'Trebuchet MS',
-		'Comic Sans MS'
-	];
-	// Font maps (HTML => CSS size)
-	this.aFontSizes = [
-		0,
-		8,
-		10,
-		12,
-		14,
-		18,
-		24,
-		36
-	];
-	// Color maps! (hex => name)
-	this.oFontColors = {
-		black: '#000000',
-		red: '#ff0000',
-		yellow: '#ffff00',
-		pink: '#ffc0cb',
-		green: '#008000',
-		orange: '#ffa500',
-		purple: '#800080',
-		blue: '#0000ff',
-		beige: '#f5f5dc',
-		brown: '#a52a2a',
-		teal: '#008080',
-		navy: '#000080',
-		maroon: '#800000',
-		limegreen: '#32cd32'
-	}
-
-	this.sFormId = 'sFormId' in this.opt ? this.opt.sFormId : 'postmodify';
-	this.iArrayPosition = smf_editorArray.length;
-
-	// Current resize state.
-	this.osmc_EditorCurrentResize = {};
-
-	this.init();
-}
-
-smc_Editor.prototype.init = function()
-{
-	// Define the event wrapper functions.
-	var oCaller = this;
-	this.aEventWrappers = {
-		editorKeyUp: function(oEvent) {return oCaller.editorKeyUp(oEvent);},
-		shortcutCheck: function(oEvent) {return oCaller.shortcutCheck(oEvent);},
-		editorBlur: function(oEvent) {return oCaller.editorBlur(oEvent);},
-		editorFocus: function(oEvent) {return oCaller.editorFocus(oEvent);},
-		startResize: function(oEvent) {return oCaller.startResize(oEvent);},
-		resizeOverDocument: function(oEvent) {return oCaller.resizeOverDocument(oEvent);},
-		endResize: function(oEvent) {return oCaller.endResize(oEvent);},
-		resizeOverIframe: function(oEvent) {return oCaller.resizeOverIframe(oEvent);}
-	};
-
-	// Set the textHandle.
-	this.oTextHandle = document.getElementById(this.opt.sUniqueId);
-
-	// Ensure the currentText is set correctly depending on the mode.
-	if (this.sCurrentText == '' && !this.bRichTextEnabled)
-		this.sCurrentText = getInnerHTML(this.oTextHandle).php_unhtmlspecialchars();
-
-	// Only try to do this if rich text is supported.
-	if (this.bRichTextPossible)
-	{
-		// Make the iframe itself, stick it next to the current text area, and give it an ID.
-		this.oFrameHandle = document.createElement('iframe');
-		this.oFrameHandle.src = 'about:blank';
-		this.oFrameHandle.id = 'html_' + this.opt.sUniqueId;
-		this.oFrameHandle.className = 'rich_editor_frame';
-		this.oFrameHandle.style.display = 'none';
-		this.oFrameHandle.style.margin = '0px';
-		this.oFrameHandle.tabIndex = this.oTextHandle.tabIndex;
-		this.oTextHandle.parentNode.appendChild(this.oFrameHandle);
-
-		// Create some handy shortcuts.
-		this.oFrameDocument = this.oFrameHandle.contentDocument ? this.oFrameHandle.contentDocument : ('contentWindow' in this.oFrameHandle ? this.oFrameHandle.contentWindow.document : this.oFrameHandle.document);
-		this.oFrameWindow = 'contentWindow' in this.oFrameHandle ? this.oFrameHandle.contentWindow : this.oFrameHandle.document.parentWindow;
-
-		// Create the debug window... and stick this under the main frame - make it invisible by default.
-		this.oBreadHandle = document.createElement('div');
-		this.oBreadHandle.id = 'bread_' . uid;
-		this.oBreadHandle.style.visibility = 'visible';
-		this.oBreadHandle.style.display = 'none';
-		this.oFrameHandle.parentNode.appendChild(this.oBreadHandle);
-
-		// Size the iframe dimensions to something sensible.
-		this.oFrameHandle.style.width = this.sEditWidth;
-		this.oFrameHandle.style.height = this.sEditHeight;
-		this.oFrameHandle.style.visibility = 'visible';
-
-		// Only bother formatting the debug window if debug is enabled.
-		if (this.showDebug)
-		{
-			this.oBreadHandle.style.width = this.sEditWidth;
-			this.oBreadHandle.style.height = '20px';
-			this.oBreadHandle.className = 'windowbg2';
-			this.oBreadHandle.style.border = '1px black solid';
-			this.oBreadHandle.style.display = '';
-		}
-
-		// Populate the editor with nothing by default.
-		if (!is_opera95up)
-		{
-			this.oFrameDocument.open();
-			this.oFrameDocument.write('');
-			this.oFrameDocument.close();
-		}
-
-		// Right to left mode?
-		if (this.opt.bRTL)
-		{
-			this.oFrameDocument.dir = "rtl";
-			this.oFrameDocument.body.dir = "rtl";
-		}
-
-		// Mark it as editable...
-		if (this.oFrameDocument.body.contentEditable)
-			this.oFrameDocument.body.contentEditable = true;
-		else
-		{
-			this.oFrameHandle.style.display = '';
-			this.oFrameDocument.designMode = 'on';
-			this.oFrameHandle.style.display = 'none';
-		}
-
-		// Now we need to try and style the editor - internet explorer allows us to do the whole lot.
-		if (document.styleSheets['editor_css'] || document.styleSheets['editor_ie_css'])
-		{
-			var oMyStyle = this.oFrameDocument.createElement('style');
-			this.oFrameDocument.documentElement.firstChild.appendChild(oMyStyle);
-			oMyStyle.styleSheet.cssText = document.styleSheets['editor_ie_css'] ? document.styleSheets['editor_ie_css'].cssText : document.styleSheets['editor_css'].cssText;
-		}
-		// Otherwise we seem to have to try to rip out each of the styles one by one!
-		else if (document.styleSheets.length)
-		{
-			var bFoundSomething = false;
-			// First we need to find the right style sheet.
-			for (var i = 0, iNumStyleSheets = document.styleSheets.length; i < iNumStyleSheets; i++)
-			{
-				// Start off looking for the right style sheet.
-				if (!document.styleSheets[i].href || document.styleSheets[i].href.indexOf('editor') < 1)
-					continue;
-
-				// Firefox won't allow us to get a CSS file which ain't in the right URL.
-				try
-				{
-					if (document.styleSheets[i].cssRules.length < 1)
-						continue;
-				}
-				catch (e)
-				{
-					continue;
-				}
-
-				// Manually try to find the rich_editor class.
-				for (var r = 0, iNumRules = document.styleSheets[i].cssRules.length; r < iNumRules; r++)
-				{
-					// Got the main editor?
-					if (document.styleSheets[i].cssRules[r].selectorText == '.rich_editor')
-					{
-						// Set some possible styles.
-						if (document.styleSheets[i].cssRules[r].style.color)
-							this.oFrameDocument.body.style.color = document.styleSheets[i].cssRules[r].style.color;
-						if (document.styleSheets[i].cssRules[r].style.backgroundColor)
-							this.oFrameDocument.body.style.backgroundColor = document.styleSheets[i].cssRules[r].style.backgroundColor;
-						if (document.styleSheets[i].cssRules[r].style.fontSize)
-							this.oFrameDocument.body.style.fontSize = document.styleSheets[i].cssRules[r].style.fontSize;
-						if (document.styleSheets[i].cssRules[r].style.fontFamily)
-							this.oFrameDocument.body.style.fontFamily = document.styleSheets[i].cssRules[r].style.fontFamily;
-						if (document.styleSheets[i].cssRules[r].style.border)
-							this.oFrameDocument.body.style.border = document.styleSheets[i].cssRules[r].style.border;
-						bFoundSomething = true;
-					}
-					// The frame?
-					else if (document.styleSheets[i].cssRules[r].selectorText == '.rich_editor_frame')
-					{
-						if (document.styleSheets[i].cssRules[r].style.border)
-							this.oFrameHandle.style.border = document.styleSheets[i].cssRules[r].style.border;
-					}
-				}
-			}
-
-			// Didn't find it?
-			if (!bFoundSomething)
-			{
-				// Do something that is better than nothing.
-				this.oFrameDocument.body.style.color = 'black';
-				this.oFrameDocument.body.style.backgroundColor = 'white';
-				this.oFrameDocument.body.style.fontSize = '78%';
-				this.oFrameDocument.body.style.fontFamily = '"Verdana", "Arial", "Helvetica", "sans-serif"';
-				this.oFrameDocument.body.style.border = 'none';
-				this.oFrameHandle.style.border = '1px solid #808080';
-				if (is_opera)
-					this.oFrameDocument.body.style.height = '99%';
-			}
-		}
-
-		// Apply the class...
-		this.oFrameDocument.body.className = 'rich_editor';
-
-		// Set the frame padding/margin inside the editor.
-		this.oFrameDocument.body.style.padding = '1px';
-		this.oFrameDocument.body.style.margin = '0';
-
-		// Listen for input.
-		this.oFrameDocument.instanceRef = this;
-		this.oFrameHandle.instanceRef = this;
-		this.oTextHandle.instanceRef = this;
-
-		// Attach addEventListener for those browsers that don't support it.
-		createEventListener(this.oFrameHandle);
-		createEventListener(this.oFrameDocument);
-		createEventListener(this.oTextHandle);
-		createEventListener(window);
-		createEventListener(document);
-
-		// Attach functions to the key and mouse events.
-		this.oFrameDocument.addEventListener('keyup', this.aEventWrappers.editorKeyUp, true);
-		this.oFrameDocument.addEventListener('mouseup', this.aEventWrappers.editorKeyUp, true);
-		this.oFrameDocument.addEventListener('keydown', this.aEventWrappers.shortcutCheck, true);
-		this.oTextHandle.addEventListener('keydown', this.aEventWrappers.shortcutCheck, true);
-
-		if (is_ie)
-		{
-			this.oFrameDocument.addEventListener('blur', this.aEventWrappers.editorBlur, true);
-			this.oFrameDocument.addEventListener('focus', this.aEventWrappers.editorFocus, true);
-		}
-
-		// Show the iframe only if wysiwyrg is on - and hide the text area.
-		this.oTextHandle.style.display = this.bRichTextEnabled ? 'none' : '';
-		this.oFrameHandle.style.display = this.bRichTextEnabled ? '' : 'none';
-		this.oBreadHandle.style.display = this.bRichTextEnabled ? '' : 'none';
-	}
-	// If we can't do advanced stuff then just do the basics.
-	else
-	{
-		// Cannot have WYSIWYG anyway!
-		this.bRichTextEnabled = false;
-
-		// We need some of the event handlers.
-		createEventListener(this.oTextHandle);
-		createEventListener(window);
-		createEventListener(document);
-	}
-
-	// Make sure we set the message mode correctly.
-	document.getElementById(this.opt.sUniqueId + '_mode').value = this.bRichTextEnabled ? 1 : 0;
-
-	// Show the resizer.
-	if (document.getElementById(this.opt.sUniqueId + '_resizer') && (!is_opera || is_opera95up) && !(is_chrome && !this.bRichTextEnabled))
-	{
-		// Currently nothing is being resized...I assume!
-		window.smf_oCurrentResizeEditor = null;
-
-		this.oResizerElement = document.getElementById(this.opt.sUniqueId + '_resizer');
-		this.oResizerElement.style.display = '';
-
-		createEventListener(this.oResizerElement);
-		this.oResizerElement.addEventListener('mousedown', this.aEventWrappers.startResize, false);
-	}
-
-	// Set the text - if WYSIWYG is enabled that is.
-	if (this.bRichTextEnabled)
-	{
-		this.insertText(this.sCurrentText, true);
-
-		// Better make us the focus!
-		this.setFocus();
-	}
-
-	// Finally, register shortcuts.
-	this.registerDefaultShortcuts();
-	this.updateEditorControls();
+	var editor = $('#' + oOptions.sUniqueId);
+	this.sUniqueId = this.opt.sUniqueId;
+	this.bRichTextEnabled = true;
 }
 
 // Return the current text.
 smc_Editor.prototype.getText = function(bPrepareEntities, bModeOverride)
 {
-	var bCurMode = typeof(bModeOverride) != 'undefined' ? bModeOverride : this.bRichTextEnabled;
-
-	if (!bCurMode || this.oFrameDocument == null)
-	{
-		var sText = this.oTextHandle.value;
-		if (bPrepareEntities)
-			sText = sText.replace(/</g, '#smlt#').replace(/>/g, '#smgt#').replace(/&/g, '#smamp#');
-	}
-	else
-	{
-		var sText = this.oFrameDocument.body.innerHTML;
-		if (bPrepareEntities)
-			sText = sText.replace(/&lt;/g, '#smlt#').replace(/&gt;/g, '#smgt#').replace(/&amp;/g, '#smamp#');
-	}
-
-	// Clean it up - including removing semi-colons.
-	if (bPrepareEntities)
-		sText = sText.replace(/&nbsp;/g, ' ').replace(/;/g, '#smcol#');
-
-	// Return it.
-	return sText;
-}
-
-// Return the current text.
-smc_Editor.prototype.unprotectText = function(sText)
-{
-	var bCurMode = typeof(bModeOverride) != 'undefined' ? bModeOverride : this.bRichTextEnabled;
-
-	// This restores smlt, smgt and smamp into boring entities, to unprotect against XML'd information like quotes.
-	sText = sText.replace(/#smlt#/g, '&lt;').replace(/#smgt#/g, '&gt;').replace(/#smamp#/g, '&amp;');
-
-	// Return it.
-	return sText;
-}
-
-smc_Editor.prototype.editorKeyUp = function()
-{
-	// Rebuild the breadcrumb.
-	this.updateEditorControls();
-}
-
-smc_Editor.prototype.editorBlur = function()
-{
-	if (!is_ie)
-		return;
-
-	// Need to do something here.
-}
-
-smc_Editor.prototype.editorFocus = function()
-{
-	if (!is_ie)
-		return;
-
-	// Need to do something here.
-}
-
-// Rebuild the breadcrumb etc - and set things to the correct context.
-smc_Editor.prototype.updateEditorControls = function()
-{
-	// Everything else is specific to HTML mode.
-	if (!this.bRichTextEnabled)
-	{
-		// Set none of the buttons active.
-		if (this.opt.oBBCBox)
-			this.opt.oBBCBox.setActive([]);
-		return;
-	}
-
-	var aCrumb = new Array();
-	var aAllCrumbs = new Array();
-	var iMaxLength = 6;
-
-	// What is the current element?
-	var oCurTag = this.getCurElement();
-
-	var i = 0;
-	while (typeof(oCurTag) == 'object' && oCurTag != null && oCurTag.nodeName.toLowerCase() != 'body' && i < iMaxLength)
-	{
-		aCrumb[i++] = oCurTag;
-		oCurTag = oCurTag.parentNode;
-	}
-
-	// Now print out the tree.
-	var sTree = '';
-	var sCurFontName = '';
-	var sCurFontSize = '';
-	var sCurFontColor = '';
-	for (var i = 0, iNumCrumbs = aCrumb.length; i < iNumCrumbs; i++)
-	{
-		var sCrumbName = aCrumb[i].nodeName.toLowerCase();
-
-		// Does it have an alternative name?
-		if (sCrumbName in this.breadCrumbNameTags)
-			sCrumbName = this.breadCrumbNameTags[sCrumbName];
-		// Don't bother with this...
-		else if (sCrumbName == 'p')
-			continue;
-		// A link?
-		else if (sCrumbName == 'a')
-		{
-			var sUrlInfo = aCrumb[i].getAttribute('href');
-			sCrumbName = 'url';
-			if (typeof(sUrlInfo) == 'string')
-			{
-				if (sUrlInfo.substr(0, 3) == 'ftp')
-					sCrumbName = 'ftp';
-				else if (sUrlInfo.substr(0, 6) == 'mailto')
-					sCrumbName = 'email';
-			}
-		}
-		else if (sCrumbName == 'span' || sCrumbName == 'div')
-		{
-			if (aCrumb[i].style)
-			{
-				for (var j = 0, iNumStyles = this.aBreadCrumbNameStyles.length; j < iNumStyles; j++)
-				{
-					// Do we have a font?
-					if (aCrumb[i].style.fontFamily && aCrumb[i].style.fontFamily != '' && sCurFontName == '')
-					{
-						sCurFontName = aCrumb[i].style.fontFamily;
-						sCrumbName = 'face';
-					}
-					// ... or a font size?
-					if (aCrumb[i].style.fontSize && aCrumb[i].style.fontSize != '' && sCurFontSize == '')
-					{
-						sCurFontSize = aCrumb[i].style.fontSize;
-						sCrumbName = 'size';
-					}
-					// ... even color?
-					if (aCrumb[i].style.color && aCrumb[i].style.color != '' && sCurFontColor == '')
-					{
-						sCurFontColor = aCrumb[i].style.color;
-						if (in_array(sCurFontColor, this.oFontColors))
-							sCurFontColor = array_search(sCurFontColor, this.oFontColors);
-						sCrumbName = 'color';
-					}
-
-					if (this.aBreadCrumbNameStyles[j].sStyleType == 'text-align' && aCrumb[i].style.textAlign && aCrumb[i].style.textAlign == this.aBreadCrumbNameStyles[j].sStyleValue)
-						sCrumbName = this.aBreadCrumbNameStyles[j].sBbcTag;
-					else if (this.aBreadCrumbNameStyles[j].sStyleType == 'text-decoration' && aCrumb[i].style.textDecoration && aCrumb[i].style.textDecoration == this.aBreadCrumbNameStyles[j].sStyleValue)
-						sCrumbName = this.aBreadCrumbNameStyles[j].sBbcTag;
-					else if (this.aBreadCrumbNameStyles[j].sStyleType == 'font-weight' && aCrumb[i].style.fontWeight && aCrumb[i].style.fontWeight == this.aBreadCrumbNameStyles[j].sStyleValue)
-						sCrumbName = this.aBreadCrumbNameStyles[j].sBbcTag;
-					else if (this.aBreadCrumbNameStyles[j].sStyleType == 'font-style' && aCrumb[i].style.fontStyle && aCrumb[i].style.fontStyle == this.aBreadCrumbNameStyles[j].sStyleValue)
-						sCrumbName = this.aBreadCrumbNameStyles[j].sBbcTag;
-				}
-			}
-		}
-		// Do we have a font?
-		else if (sCrumbName == 'font')
-		{
-			if (aCrumb[i].getAttribute('face') && sCurFontName == '')
-			{
-				sCurFontName = aCrumb[i].getAttribute('face').toLowerCase();
-				sCrumbName = 'face';
-			}
-			if (aCrumb[i].getAttribute('size') && sCurFontSize == '')
-			{
-				sCurFontSize = aCrumb[i].getAttribute('size');
-				sCrumbName = 'size';
-			}
-			if (aCrumb[i].getAttribute('color') && sCurFontColor == '')
-			{
-				sCurFontColor = aCrumb[i].getAttribute('color');
-				if (in_array(sCurFontColor, this.oFontColors))
-					sCurFontColor = array_search(sCurFontColor, this.oFontColors);
-				sCrumbName = 'color';
-			}
-			// Something else - ignore.
-			if (sCrumbName == 'font')
-				continue;
-		}
-
-		sTree += (i != 0 ? '&nbsp;<strong>&gt;</strong>' : '') + '&nbsp;' + sCrumbName;
-		aAllCrumbs[aAllCrumbs.length] = sCrumbName;
-	}
-
-	// Since we're in WYSIWYG state, show the toggle button as active.
-	aAllCrumbs[aAllCrumbs.length] = 'toggle';
-
-	this.opt.oBBCBox.setActive(aAllCrumbs);
-
-	// Try set the font boxes correct.
-	this.opt.oBBCBox.setSelect('sel_face', sCurFontName);
-	this.opt.oBBCBox.setSelect('sel_size', sCurFontSize);
-	this.opt.oBBCBox.setSelect('sel_color', sCurFontColor);
-
-	if (this.showDebug)
-		setInnerHTML(this.oBreadHandle, sTree);
+	return $('#' + this.sUniqueId).data("sceditor").getText();
 }
 
 // Set the HTML content to be that of the text box - if we are in wysiwyg mode.
 smc_Editor.prototype.doSubmit = function()
-{
-	if (this.bRichTextEnabled)
-		this.oTextHandle.value = this.oFrameDocument.body.innerHTML;
-}
+{}
 
 // Populate the box with text.
 smc_Editor.prototype.insertText = function(sText, bClear, bForceEntityReverse, iMoveCursorBack)
 {
-	if (bForceEntityReverse)
-		sText = this.unprotectText(sText);
-
-	// Erase it all?
-	if (bClear)
-	{
-		if (this.bRichTextEnabled)
-		{
-			// This includes a work around for FF to get the cursor to show!
-			this.oFrameDocument.body.innerHTML = sText;
-
-			// This used to be the home of a slightly ugly bug in Firefox (but it's long gone)
-		}
-		else
-			this.oTextHandle.value = sText;
-	}
-	else
-	{
-		this.setFocus();
-		if (this.bRichTextEnabled)
-		{
-			// IE croaks if you have an image selected and try to insert!
-			if ('selection' in this.oFrameDocument && this.oFrameDocument.selection.type != 'Text' && this.oFrameDocument.selection.type != 'None' && this.oFrameDocument.selection.clear)
-				this.oFrameDocument.selection.clear();
-
-			var oRange = this.getRange();
-
-			if (oRange.pasteHTML)
-			{
-				oRange.pasteHTML(sText);
-
-				// Do we want to move the cursor back at all?
-				if (iMoveCursorBack)
-					oRange.moveEnd('character', -iMoveCursorBack);
-
-				oRange.select();
-			}
-			else
-			{
-				// If the cursor needs to be positioned, insert the last fragment first.
-				if (typeof(iMoveCursorBack) != 'undefined' && iMoveCursorBack > 0 && sText.length > iMoveCursorBack)
-				{
-					var oSelection = this.getSelect(false, false);
-					var oRange = oSelection.getRangeAt(0);
-					oRange.insertNode(this.oFrameDocument.createTextNode(sText.substr(sText.length - iMoveCursorBack)));
-				}
-
-				this.smf_execCommand('inserthtml', false, typeof(iMoveCursorBack) == 'undefined' ? sText : sText.substr(0, sText.length - iMoveCursorBack));
-			}
-		}
-		else
-		{
-			replaceText(sText, this.oTextHandle);
-		}
-	}
-}
-
-
-// Special handler for WYSIWYG.
-smc_Editor.prototype.smf_execCommand = function(sCommand, bUi, sValue)
-{
-	return this.oFrameDocument.execCommand(sCommand, bUi, sValue);
-}
-
-smc_Editor.prototype.insertSmiley = function(oSmileyProperties)
-{
-	// In text mode we just add it in as we always did.
-	if (!this.bRichTextEnabled)
-		this.insertText(' ' + oSmileyProperties.sCode);
-
-	// Otherwise we need to do a whole image...
-	else
-	{
-		var iUniqueSmileyId = 1000 + Math.floor(Math.random() * 100000);
-		this.insertText('<img src="' + oSmileyProperties.sSrc + '" id="smiley_' + iUniqueSmileyId + '_' + oSmileyProperties.sSrc.replace(/^.*\//, '') + '" onresizestart="return false;" align="bottom" alt="" title="' + oSmileyProperties.sDescription.php_htmlspecialchars() + '" style="padding: 0 3px 0 3px;" />');
-	}
-}
-
-smc_Editor.prototype.handleButtonClick = function (oButtonProperties)
-{
-	this.setFocus();
-
-	// A special SMF function?
-	if (oButtonProperties.sCode in this.oSmfExec)
-		this[this.oSmfExec[oButtonProperties.sCode]]();
-
-	else
-	{
-		// In text this is easy...
-		if (!this.bRichTextEnabled)
-		{
-			// Replace?
-			if (!('sAfter' in oButtonProperties) || oButtonProperties.sAfter == null)
-				replaceText(oButtonProperties.sBefore.replace(/\\n/g, '\n'), this.oTextHandle)
-
-			// Surround!
-			else
-				surroundText(oButtonProperties.sBefore.replace(/\\n/g, '\n'), oButtonProperties.sAfter.replace(/\\n/g, '\n'), this.oTextHandle)
-		}
-		else
-		{
-			// Is it easy?
-			if (oButtonProperties.sCode in this.oSimpleExec)
-				this.smf_execCommand(this.oSimpleExec[oButtonProperties.sCode], false, null);
-
-			// A link?
-			else if (oButtonProperties.sCode == 'url' || oButtonProperties.sCode == 'email' || oButtonProperties.sCode == 'ftp')
-				this.insertLink(oButtonProperties.sCode);
-
-			// Maybe an image?
-			else if (oButtonProperties.sCode == 'img')
-				this.insertImage();
-
-			// Everything else means doing something ourselves.
-			else if ('sBefore' in oButtonProperties)
-				this.insertCustomHTML(oButtonProperties.sBefore.replace(/\\n/g, '\n'), oButtonProperties.sAfter.replace(/\\n/g, '\n'));
-
-		}
-	}
-
-	this.updateEditorControls();
-
-	// Finally set the focus.
-	this.setFocus();
-}
-
-// Changing a select box?
-smc_Editor.prototype.handleSelectChange = function (oSelectProperties)
-{
-	this.setFocus();
-
-	var sValue = oSelectProperties.oSelect.value;
-	if (sValue == '')
-		return true;
-
-	// Changing font face?
-	if (oSelectProperties.sName == 'sel_face')
-	{
-		// Not in HTML mode?
-		if (!this.bRichTextEnabled)
-		{
-			sValue = sValue.replace(/"/, '');
-			surroundText('[font=' + sValue + ']', '[/font]', this.oTextHandle);
-			oSelectProperties.oSelect.selectedIndex = 0;
-		}
-		else
-		{
-			if (is_webkit)
-				this.smf_execCommand('styleWithCSS', false, true);
-			this.smf_execCommand('fontname', false, sValue);
-		}
-	}
-
-	// Font size?
-	else if (oSelectProperties.sName == 'sel_size')
-	{
-		// Are we in boring mode?
-		if (!this.bRichTextEnabled)
-		{
-			surroundText('[size=' + this.aFontSizes[sValue] + 'pt]', '[/size]', this.oTextHandle);
-			oSelectProperties.oSelect.selectedIndex = 0;
-		}
-
-		else
-			this.smf_execCommand('fontsize', false, sValue);
-	}
-	// Or color even?
-	else if (oSelectProperties.sName == 'sel_color')
-	{
-		// Are we in boring mode?
-		if (!this.bRichTextEnabled)
-		{
-			surroundText('[color=' + sValue + ']', '[/color]', this.oTextHandle);
-			oSelectProperties.oSelect.selectedIndex = 0;
-		}
-
-		else
-			this.smf_execCommand('forecolor', false, sValue);
-	}
-
-	this.updateEditorControls();
-
-	return true;
-}
-
-// Put in some custom HTML.
-smc_Editor.prototype.insertCustomHTML = function(sLeftTag, sRightTag)
-{
-	var sSelection = this.getSelect(true, true);
-	if (sSelection.length == 0)
-		sSelection = '';
-
-	// Are we overwriting?
-	if (sRightTag == '')
-		this.insertText(sLeftTag);
-	// If something was selected, replace and position cursor at the end of it.
-	else if (sSelection.length > 0)
-		this.insertText(sLeftTag + sSelection + sRightTag, false, false, 0);
-	// Wrap the tags around the cursor position.
-	else
-		this.insertText(sLeftTag + sRightTag, false, false, sRightTag.length);
-
-}
-
-// Insert a URL link.
-smc_Editor.prototype.insertLink = function(sType)
-{
-	if (sType == 'email')
-		var sPromptText = oEditorStrings['prompt_text_email'];
-	else if (sType == 'ftp')
-		var sPromptText = oEditorStrings['prompt_text_ftp'];
-	else
-		var sPromptText = oEditorStrings['prompt_text_url'];
-
-	// IE has a nice prompt for this - others don't.
-	if (sType != 'email' && sType != 'ftp' && is_ie)
-		this.smf_execCommand('createlink', true, 'http://');
-
-	else
-	{
-		// Ask them where to link to.
-		var sText = prompt(sPromptText, sType == 'email' ? '' : (sType == 'ftp' ? 'ftp://' : 'http://'));
-		if (!sText)
-			return;
-
-		if (sType == 'email' && sText.indexOf('mailto:') != 0)
-			sText = 'mailto:' + sText;
-
-		// Check if we have text selected and if not force us to have some.
-		var oCurText = this.getSelect(true, true);
-
-		if (oCurText.toString().length != 0)
-		{
-			this.smf_execCommand('unlink');
-			this.smf_execCommand('createlink', false, sText);
-		}
-		else
-			this.insertText('<a href="' + sText + '">' + sText + '</a>');
-	}
-}
-
-smc_Editor.prototype.insertImage = function(sSrc)
-{
-	if (!sSrc)
-	{
-		sSrc = prompt(oEditorStrings['prompt_text_img'], 'http://');
-		if (!sSrc || sSrc.length < 10)
-			return;
-	}
-	this.smf_execCommand('insertimage', false, sSrc);
-}
-
-smc_Editor.prototype.getSelect = function(bWantText, bWantHTMLText)
-{
-	if (is_ie && 'selection' in this.oFrameDocument)
-	{
-		// Just want plain text?
-		if (bWantText && !bWantHTMLText)
-			return this.oFrameDocument.selection.createRange().text;
-		// We want the HTML flavoured variety?
-		else if (bWantHTMLText)
-			return this.oFrameDocument.selection.createRange().htmlText;
-
-		return this.oFrameDocument.selection;
-	}
-
-	// This is mainly Firefox.
-	if ('getSelection' in this.oFrameWindow)
-	{
-		// Plain text?
-		if (bWantText && !bWantHTMLText)
-			return this.oFrameWindow.getSelection().toString();
-
-		// HTML is harder - currently using: http://www.faqts.com/knowledge_base/view.phtml/aid/32427
-		else if (bWantHTMLText)
-		{
-			var oSelection = this.oFrameWindow.getSelection();
-			if (oSelection.rangeCount > 0)
-			{
-				var oRange = oSelection.getRangeAt(0);
-				var oClonedSelection = oRange.cloneContents();
-				var oDiv = this.oFrameDocument.createElement('div');
-				oDiv.appendChild(oClonedSelection);
-				return oDiv.innerHTML;
-			}
-			else
-				return '';
-		}
-
-		// Want the whole object then.
-		return this.oFrameWindow.getSelection();
-	}
-
-	// If we're here it's not good.
-	return this.oFrameDocument.getSelection();
-}
-
-smc_Editor.prototype.getRange = function()
-{
-	// Get the current selection.
-	var oSelection = this.getSelect();
-
-	if (!oSelection)
-		return null;
-
-	if (is_ie && oSelection.createRange)
-		return oSelection.createRange();
-
-	return oSelection.rangeCount == 0 ? null : oSelection.getRangeAt(0);
-}
-
-// Get the current element.
-smc_Editor.prototype.getCurElement = function()
-{
-	var oRange = this.getRange();
-
-	if (!oRange)
-		return null;
-
-	if (is_ie)
-	{
-		if (oRange.item)
-			return oRange.item(0);
-		else
-			return oRange.parentElement();
-	}
-	else
-	{
-		var oElement = oRange.commonAncestorContainer;
-		return this.getParentElement(oElement);
-	}
-}
-
-smc_Editor.prototype.getParentElement = function(oNode)
-{
-	if (oNode.nodeType == 1)
-		return oNode;
-
-	for (var i = 0; i < 50; i++)
-	{
-		if (!oNode.parentNode)
-			break;
-
-		oNode = oNode.parentNode;
-		if (oNode.nodeType == 1)
-			return oNode;
-	}
-	return null;
-}
-
-// Remove formatting for the selected text.
-smc_Editor.prototype.removeFormatting = function()
-{
-	// Do both at once.
-	if (this.bRichTextEnabled)
-	{
-		this.smf_execCommand('removeformat');
-		this.smf_execCommand('unlink');
-	}
-	// Otherwise do a crude move indeed.
-	else
-	{
-		// Get the current selection first.
-		if (this.oTextHandle.caretPos)
-			var sCurrentText = this.oTextHandle.caretPos.text;
-
-		else if ('selectionStart' in this.oTextHandle)
-			var sCurrentText = this.oTextHandle.value.substr(this.oTextHandle.selectionStart, (this.oTextHandle.selectionEnd - this.oTextHandle.selectionStart));
-
-		else
-			return;
-
-		// Do bits that are likely to have attributes.
-		sCurrentText = sCurrentText.replace(RegExp("\\[/?(url|img|iurl|ftp|email|img|color|font|size|list|bdo).*?\\]", "g"), '');
-		// Then just anything that looks like BBC.
-		sCurrentText = sCurrentText.replace(RegExp("\\[/?[A-Za-z]+\\]", "g"), '');
-
-		replaceText(sCurrentText, this.oTextHandle);
-	}
-}
-
-// Toggle wysiwyg/normal mode.
-smc_Editor.prototype.toggleView = function(bView)
-{
-	if (!this.bRichTextPossible)
-	{
-		alert(oEditorStrings['wont_work']);
-		return false;
-	}
-
-	// Overriding or alternating?
-	if (typeof(bView) == 'undefined')
-		bView = !this.bRichTextEnabled;
-
-	this.requestParsedMessage(bView);
-
-	return true;
-}
-
-// Request the message in a different form.
-smc_Editor.prototype.requestParsedMessage = function(bView)
-{
-	// Replace with a force reload.
-	if (!window.XMLHttpRequest)
-	{
-		alert(oEditorStrings['func_disabled']);
-		return;
-	}
-
-	// Get the text.
-	var sText = this.getText(true, !bView).replace(/&#/g, "&#38;#").php_to8bit().php_urlencode();
-
-	this.tmpMethod = sendXMLDocument;
-	this.tmpMethod(smf_prepareScriptUrl(smf_scripturl) + 'action=jseditor;view=' + (bView ? 1 : 0) + ';' + this.opt.sSessionVar + '=' + this.opt.sSessionId + ';xml', 'message=' + sText, this.onToggleDataReceived);
-	delete tmpMethod;
-}
-
-smc_Editor.prototype.onToggleDataReceived = function(oXMLDoc)
-{
-	var sText = '';
-	for (var i = 0; i < oXMLDoc.getElementsByTagName('message')[0].childNodes.length; i++)
-		sText += oXMLDoc.getElementsByTagName('message')[0].childNodes[i].nodeValue;
-
-	// What is this new view we have?
-	this.bRichTextEnabled = oXMLDoc.getElementsByTagName('message')[0].getAttribute('view') != '0';
-
-	if (this.bRichTextEnabled)
-	{
-		this.oFrameHandle.style.display = '';
-		if (this.showDebug)
-			this.oBreadHandle.style.display = '';
-		this.oTextHandle.style.display = 'none';
-	}
-	else
-	{
-		sText = sText.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
-		this.oFrameHandle.style.display = 'none';
-		this.oBreadHandle.style.display = 'none';
-		this.oTextHandle.style.display = '';
-	}
-
-	// First we focus.
-	this.setFocus();
-
-	this.insertText(sText, true);
-
-	// Record the new status.
-	document.getElementById(this.opt.sUniqueId + '_mode').value = this.bRichTextEnabled ? '1' : '0';
-
-	// Rebuild the bread crumb!
-	this.updateEditorControls();
-}
-
-// Set the focus for the editing window.
-smc_Editor.prototype.setFocus = function(force_both)
-{
-	if (!this.bRichTextEnabled)
-		this.oTextHandle.focus();
-	else if (is_ff || is_opera)
-		this.oFrameHandle.focus();
-	else
-		this.oFrameWindow.focus();
+	$('#' + this.sUniqueId).data("sceditor").InsertText(sText.replace(/<br \/>/gi, ''), bClear);
 }
 
 // Start up the spellchecker!
@@ -1061,682 +33,11 @@
 	if (!spellCheck)
 		return false;
 
+	$('#' + this.sUniqueId).data("sceditor").storeLastState();
 	// If we're in HTML mode we need to get the non-HTML text.
-	if (this.bRichTextEnabled)
-	{
-		var sText = escape(this.getText(true, 1).php_to8bit());
+	$('#' + this.sUniqueId).data("sceditor").setTextMode();
 
-		this.tmpMethod = sendXMLDocument;
-		this.tmpMethod(smf_prepareScriptUrl(smf_scripturl) + 'action=jseditor;view=0;' + this.opt.sSessionVar + '=' + this.opt.sSessionId + ';xml', 'message=' + sText, this.onSpellCheckDataReceived);
-		delete tmpMethod;
-	}
-	// Otherwise start spellchecking right away.
-	else
-		spellCheck(this.sFormId, this.opt.sUniqueId);
+	spellCheck(false, this.opt.sUniqueId);
 
 	return true;
 }
-
-// This contains the spellcheckable text.
-smc_Editor.prototype.onSpellCheckDataReceived = function(oXMLDoc)
-{
-	var sText = '';
-	for (var i = 0; i < oXMLDoc.getElementsByTagName('message')[0].childNodes.length; i++)
-		sText += oXMLDoc.getElementsByTagName('message')[0].childNodes[i].nodeValue;
-
-	sText = sText.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
-
-	this.oTextHandle.value = sText;
-	spellCheck(this.sFormId, this.opt.sUniqueId);
-}
-
-// Function called when the Spellchecker is finished and ready to pass back.
-smc_Editor.prototype.spellCheckEnd = function()
-{
-	// If HTML edit put the text back!
-	if (this.bRichTextEnabled)
-	{
-		var sText = escape(this.getText(true, 0).php_to8bit());
-
-		this.tmpMethod = sendXMLDocument;
-		this.tmpMethod(smf_prepareScriptUrl(smf_scripturl) + 'action=jseditor;view=1;' + this.opt.sSessionVar + '=' + this.opt.sSessionId + ';xml', 'message=' + sText, smf_editorArray[this.iArrayPosition].onSpellCheckCompleteDataReceived);
-		delete tmpMethod;
-	}
-	else
-		this.setFocus();
-}
-
-// The corrected text.
-smc_Editor.prototype.onSpellCheckCompleteDataReceived = function(oXMLDoc)
-{
-	var sText = '';
-	for (var i = 0; i < oXMLDoc.getElementsByTagName('message')[0].childNodes.length; i++)
-		sText += oXMLDoc.getElementsByTagName('message')[0].childNodes[i].nodeValue;
-
-	this.insertText(sText, true);
-	this.setFocus();
-}
-
-smc_Editor.prototype.resizeTextArea = function(newHeight, newWidth, is_change)
-{
-	// Work out what the new height is.
-	if (is_change)
-	{
-		// We'll assume pixels but may not be.
-		newHeight = this._calculateNewDimension(this.oTextHandle.style.height, newHeight);
-		if (newWidth)
-			newWidth = this._calculateNewDimension(this.oTextHandle.style.width, newWidth);
-	}
-
-	// Do the HTML editor - but only if it's enabled!
-	if (this.bRichTextPossible)
-	{
-		this.oFrameHandle.style.height = newHeight;
-		if (newWidth)
-			this.oFrameHandle.style.width = newWidth;
-	}
-	// Do the text box regardless!
-	this.oTextHandle.style.height = newHeight;
-	if (newWidth)
-		this.oTextHandle.style.width = newWidth;
-}
-
-// A utility instruction to save repetition when trying to work out what to change on a height/width.
-smc_Editor.prototype._calculateNewDimension = function(old_size, change_size)
-{
-	// We'll assume pixels but may not be.
-	changeReg = change_size.toString().match(/(-)?(\d+)(\D*)/);
-	curReg = old_size.toString().match(/(\d+)(\D*)/);
-
-	if (!changeReg[3])
-		changeReg[3] = 'px';
-
-	if (changeReg[1] == '-')
-		changeReg[2] = 0 - changeReg[2];
-
-	// Both the same type?
-	if (changeReg[3] == curReg[2])
-	{
-		new_size = parseInt(changeReg[2]) + parseInt(curReg[1]);
-		if (new_size < 50)
-			new_size = 50;
-		new_size = new_size.toString() + changeReg[3];
-	}
-	// Is the change a percentage?
-	else if (changeReg[3] == '%')
-		new_size = (parseInt(curReg[1]) + parseInt((parseInt(changeReg[2]) * parseInt(curReg[1])) / 100)).toString() + 'px';
-	// Otherwise just guess!
-	else
-		new_size = (parseInt(curReg[1]) + (parseInt(changeReg[2]) / 10)).toString() + '%';
-
-	return new_size;
-}
-
-// Register default keyboard shortcuts.
-smc_Editor.prototype.registerDefaultShortcuts = function()
-{
-	if (is_ff)
-	{
-		this.registerShortcut('b', 'ctrl', 'b');
-		this.registerShortcut('u', 'ctrl', 'u');
-		this.registerShortcut('i', 'ctrl', 'i');
-		this.registerShortcut('p', 'alt', 'preview');
-		this.registerShortcut('s', 'alt', 'submit');
-	}
-}
-
-// Register a keyboard shortcut.
-smc_Editor.prototype.registerShortcut = function(sLetter, sModifiers, sCodeName)
-{
-	if (!sCodeName)
-		return;
-
-	var oNewShortcut = {
-		code : sCodeName,
-		key: sLetter.toUpperCase().charCodeAt(0),
-		alt : false,
-		ctrl : false
-	};
-
-	var aSplitModifiers = sModifiers.split(',');
-	for(var i = 0, n = aSplitModifiers.length; i < n; i++)
-		if (aSplitModifiers[i] in oNewShortcut)
-			oNewShortcut[aSplitModifiers[i]] = true;
-
-	this.aKeyboardShortcuts[this.aKeyboardShortcuts.length] = oNewShortcut;
-}
-
-// Check whether the key has triggered a shortcut?
-smc_Editor.prototype.checkShortcut = function(oEvent)
-{
-	// To be a shortcut it needs to be one of these, duh!
-	if (!oEvent.altKey && !oEvent.ctrlKey)
-		return false;
-
-	var sReturnCode = false;
-
-	// Let's take a look at each of our shortcuts shall we?
-	for (var i = 0, n = this.aKeyboardShortcuts.length; i < n; i++)
-	{
-		// Found something?
-		if (oEvent.altKey == this.aKeyboardShortcuts[i].alt && oEvent.ctrlKey == this.aKeyboardShortcuts[i].ctrl && oEvent.keyCode == this.aKeyboardShortcuts[i].key)
-			sReturnCode = this.aKeyboardShortcuts[i].code;
-	}
-
-	return sReturnCode;
-}
-
-// The actual event check for the above!
-smc_Editor.prototype.shortcutCheck = function(oEvent)
-{
-	var sFoundCode = this.checkShortcut(oEvent);
-
-	// Run it and exit.
-	if (typeof(sFoundCode) == 'string' && sFoundCode != '')
-	{
-		var bCancelEvent = false;
-		if (sFoundCode == 'submit')
-		{
-			// So much to do!
-			var oForm = document.getElementById(this.sFormId);
-			submitThisOnce(oForm);
-			submitonce(oForm);
-			smc_saveEntities(oForm.name, ['subject', this.opt.sUniqueId, 'guestname', 'evtitle', 'question']);
-			oForm.submit();
-
-			bCancelEvent = true;
-		}
-		else if (sFoundCode == 'preview')
-		{
-			previewPost();
-			bCancelEvent = true;
-		}
-		else
-			bCancelEvent = this.opt.oBBCBox.emulateClick(sFoundCode);
-
-		if (bCancelEvent)
-		{
-			if (is_ie && oEvent.cancelBubble)
-				oEvent.cancelBubble = true;
-
-			else if (oEvent.stopPropagation)
-			{
-				oEvent.stopPropagation();
-				oEvent.preventDefault();
-			}
-
-			return false;
-		}
-	}
-
-	return true;
-}
-
-// This is the method called after clicking the resize bar.
-smc_Editor.prototype.startResize = function(oEvent)
-{
-	if ('event' in window)
-		oEvent = window.event;
-
-	if (!oEvent || window.smf_oCurrentResizeEditor != null)
-		return true;
-
-	window.smf_oCurrentResizeEditor = this.iArrayPosition;
-
-	var aCurCoordinates = smf_mousePose(oEvent);
-	this.osmc_EditorCurrentResize.old_y = aCurCoordinates[1];
-	this.osmc_EditorCurrentResize.old_rel_y = null;
-	this.osmc_EditorCurrentResize.cur_height = parseInt(this.oTextHandle.style.height);
-
-	// Set the necessary events for resizing.
-	var oResizeEntity = is_ie ? document : window;
-	oResizeEntity.addEventListener('mousemove', this.aEventWrappers.resizeOverDocument, false);
-
-	if (this.bRichTextPossible)
-		this.oFrameDocument.addEventListener('mousemove', this.aEventWrappers.resizeOverIframe, false);
-
-	document.addEventListener('mouseup', this.aEventWrappers.endResize, true);
-
-	if (this.bRichTextPossible)
-		this.oFrameDocument.addEventListener('mouseup', this.aEventWrappers.endResize, true);
-
-	return false;
-}
-
-// This is kind of a cheat, as it only works over the IFRAME.
-smc_Editor.prototype.resizeOverIframe = function(oEvent)
-{
-	if ('event' in window)
-		oEvent = window.event;
-
-	if (!oEvent || window.smf_oCurrentResizeEditor == null)
-		return true;
-
-	var newCords = smf_mousePose(oEvent);
-
-	if (this.osmc_EditorCurrentResize.old_rel_y == null)
-		this.osmc_EditorCurrentResize.old_rel_y = newCords[1];
-	else
-	{
-		var iNewHeight = newCords[1] - this.osmc_EditorCurrentResize.old_rel_y + this.osmc_EditorCurrentResize.cur_height;
-		if (iNewHeight < 0)
-			this.endResize();
-		else
-			this.resizeTextArea(iNewHeight + 'px', 0, false);
-	}
-
-	return false;
-}
-
-// This resizes an editor.
-smc_Editor.prototype.resizeOverDocument = function (oEvent)
-{
-	if ('event' in window)
-		oEvent = window.event;
-
-	if (!oEvent || window.smf_oCurrentResizeEditor == null)
-		return true;
-
-	var newCords = smf_mousePose(oEvent);
-
-	var iNewHeight = newCords[1] - this.osmc_EditorCurrentResize.old_y + this.osmc_EditorCurrentResize.cur_height;
-	if (iNewHeight < 0)
-		this.endResize();
-	else
-		this.resizeTextArea(iNewHeight + 'px', 0, false);
-
-	return false;
-}
-
-smc_Editor.prototype.endResize = function (oEvent)
-{
-	if ('event' in window)
-		oEvent = window.event;
-
-	if (window.smf_oCurrentResizeEditor == null)
-		return true;
-
-	window.smf_oCurrentResizeEditor = null;
-
-	// Remove the event...
-	var oResizeEntity = is_ie ? document : window;
-	oResizeEntity.removeEventListener('mousemove', this.aEventWrappers.resizeOverDocument, false);
-
-	if (this.bRichTextPossible)
-		this.oFrameDocument.removeEventListener('mousemove', this.aEventWrappers.resizeOverIframe, false);
-
-	document.removeEventListener('mouseup', this.aEventWrappers.endResize, true);
-
-	if (this.bRichTextPossible)
-		this.oFrameDocument.removeEventListener('mouseup', this.aEventWrappers.endResize, true);
-
-	return false;
-}
-
-// *** smc_SmileyBox class.
-function smc_SmileyBox(oOptions)
-{
-	this.opt = oOptions;
-	this.oSmileyRowsContent = {};
-	this.oSmileyPopupWindow = null;
-	this.init();
-}
-
-smc_SmileyBox.prototype.init = function ()
-{
-	// Get the HTML content of the smileys visible on the post screen.
-	this.getSmileyRowsContent('postform');
-
-	// Inject the HTML.
-	setInnerHTML(document.getElementById(this.opt.sContainerDiv), this.opt.sSmileyBoxTemplate.easyReplace({
-		smileyRows: this.oSmileyRowsContent.postform,
-		moreSmileys: this.opt.oSmileyLocations.popup.length == 0 ? '' : this.opt.sMoreSmileysTemplate.easyReplace({
-			moreSmileysId: this.opt.sUniqueId + '_addMoreSmileys'
-		})
-	}));
-
-	// Initialize the smileys.
-	this.initSmileys('postform', document);
-
-	// Initialize the [more] button.
-	if (this.opt.oSmileyLocations.popup.length > 0)
-	{
-		var oMoreLink = document.getElementById(this.opt.sUniqueId + '_addMoreSmileys');
-		oMoreLink.instanceRef = this;
-		oMoreLink.onclick = function () {
-			this.instanceRef.handleShowMoreSmileys();
-			return false;
-		}
-	}
-}
-
-// Loop through the smileys to setup the HTML.
-smc_SmileyBox.prototype.getSmileyRowsContent = function (sLocation)
-{
-	// If it's already defined, don't bother.
-	if (sLocation in this.oSmileyRowsContent)
-		return;
-
-	this.oSmileyRowsContent[sLocation] = '';
-
-	for (var iSmileyRowIndex = 0, iSmileyRowCount = this.opt.oSmileyLocations[sLocation].length; iSmileyRowIndex < iSmileyRowCount; iSmileyRowIndex++)
-	{
-		var sSmileyRowContent = '';
-		for (var iSmileyIndex = 0, iSmileyCount = this.opt.oSmileyLocations[sLocation][iSmileyRowIndex].length; iSmileyIndex < iSmileyCount; iSmileyIndex++)
-			sSmileyRowContent += this.opt.sSmileyTemplate.easyReplace({
-				smileySource: this.opt.oSmileyLocations[sLocation][iSmileyRowIndex][iSmileyIndex].sSrc.php_htmlspecialchars(),
-				smileyDescription: this.opt.oSmileyLocations[sLocation][iSmileyRowIndex][iSmileyIndex].sDescription.php_htmlspecialchars(),
-				smileyCode: this.opt.oSmileyLocations[sLocation][iSmileyRowIndex][iSmileyIndex].sCode.php_htmlspecialchars(),
-				smileyId: this.opt.sUniqueId + '_' + sLocation + '_' + iSmileyRowIndex.toString() + '_' + iSmileyIndex.toString()
-			});
-
-		this.oSmileyRowsContent[sLocation] += this.opt.sSmileyRowTemplate.easyReplace({
-			smileyRow: sSmileyRowContent
-		});
-	}
-}
-
-smc_SmileyBox.prototype.initSmileys = function (sLocation, oDocument)
-{
-	for (var iSmileyRowIndex = 0, iSmileyRowCount = this.opt.oSmileyLocations[sLocation].length; iSmileyRowIndex < iSmileyRowCount; iSmileyRowIndex++)
-	{
-		for (var iSmileyIndex = 0, iSmileyCount = this.opt.oSmileyLocations[sLocation][iSmileyRowIndex].length; iSmileyIndex < iSmileyCount; iSmileyIndex++)
-		{
-			var oSmiley = oDocument.getElementById(this.opt.sUniqueId + '_' + sLocation + '_' + iSmileyRowIndex.toString() + '_' + iSmileyIndex.toString());
-			oSmiley.instanceRef = this;
-			oSmiley.style.cursor = 'pointer';
-			oSmiley.onclick = function () {
-				this.instanceRef.clickHandler(this);
-				return false;
-			}
-		}
-	}
-}
-
-smc_SmileyBox.prototype.clickHandler = function (oSmileyImg)
-{
-	// Dissect the id...
-	var aMatches = oSmileyImg.id.match(/([^_]+)_(\d+)_(\d+)$/);
-	if (aMatches.length != 4)
-		return false;
-
-	// ...to determine its exact smiley properties.
-	var sLocation = aMatches[1];
-	var iSmileyRowIndex = aMatches[2];
-	var iSmileyIndex = aMatches[3];
-	var oProperties = this.opt.oSmileyLocations[sLocation][iSmileyRowIndex][iSmileyIndex];
-
-	if ('sClickHandler' in this.opt)
-		eval(this.opt.sClickHandler + '(oProperties)');
-
-	return false;
-}
-
-smc_SmileyBox.prototype.handleShowMoreSmileys = function ()
-{
-	// Focus the window if it's already opened.
-	if (this.oSmileyPopupWindow != null && 'closed' in this.oSmileyPopupWindow && !this.oSmileyPopupWindow.closed)
-	{
-		this.oSmileyPopupWindow.focus();
-		return;
-	}
-
-	// Get the smiley HTML.
-	this.getSmileyRowsContent('popup');
-
-	// Open the popup.
-	this.oSmileyPopupWindow = window.open('about:blank', this.opt.sUniqueId + '_addMoreSmileysPopup', 'toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,width=480,height=220,resizable=yes');
-
-	// Paste the template in the popup.
-	this.oSmileyPopupWindow.document.open('text/html', 'replace');
-	this.oSmileyPopupWindow.document.write(this.opt.sMoreSmileysPopupTemplate.easyReplace({
-		smileyRows: this.oSmileyRowsContent.popup,
-		moreSmileysCloseLinkId: this.opt.sUniqueId + '_closeMoreSmileys'
-	}));
-	this.oSmileyPopupWindow.document.close();
-
-	// Initialize the smileys that are in the popup window.
-	this.initSmileys('popup', this.oSmileyPopupWindow.document);
-
-	// Add a function to the close window button.
-	var aCloseLink = this.oSmileyPopupWindow.document.getElementById(this.opt.sUniqueId + '_closeMoreSmileys');
-	aCloseLink.instanceRef = this;
-	aCloseLink.onclick = function () {
-		this.instanceRef.oSmileyPopupWindow.close();
-		return false;
-	}
-}
-
-
-// *** smc_BBCButtonBox class.
-function smc_BBCButtonBox(oOptions)
-{
-	this.opt = oOptions;
-	this.init();
-
-	var items = ['sActiveButtonBackgroundImageHover', 'sActiveButtonBackgroundImage', 'sButtonBackgroundImageHover', 'sButtonBackgroundImage'];
-	for (var i = 0; i < items.length; i++)
-	{
-		if (items[i] in this.opt)
-			this.opt[items[i]] = this.opt[items[i]].replace(' ', '%20');
-	}
-}
-
-smc_BBCButtonBox.prototype.init = function ()
-{
-	var sBbcContent = '';
-	for (var iButtonRowIndex = 0, iRowCount = this.opt.aButtonRows.length; iButtonRowIndex < iRowCount; iButtonRowIndex++)
-	{
-		var sRowContent = '';
-		var bPreviousWasDivider = false;
-		for (var iButtonIndex = 0, iButtonCount = this.opt.aButtonRows[iButtonRowIndex].length; iButtonIndex < iButtonCount; iButtonIndex++)
-		{
-			var oCurButton = this.opt.aButtonRows[iButtonRowIndex][iButtonIndex];
-			switch (oCurButton.sType)
-			{
-				case 'button':
-					if (oCurButton.bEnabled)
-					{
-						sRowContent += this.opt.sButtonTemplate.easyReplace({
-							buttonId: this.opt.sUniqueId.php_htmlspecialchars() + '_button_' + iButtonRowIndex.toString() + '_' + iButtonIndex.toString(),
-							buttonSrc: oCurButton.sImage.php_htmlspecialchars(),
-							buttonDescription: oCurButton.sDescription.php_htmlspecialchars()
-						});
-
-						bPreviousWasDivider = false;
-					}
-				break;
-
-				case 'divider':
-					if (!bPreviousWasDivider)
-						sRowContent += this.opt.sDividerTemplate;
-
-					bPreviousWasDivider = true;
-				break;
-
-				case 'select':
-					var sOptions = '';
-
-					// Fighting javascript's idea of order in a for loop... :P
-					if ('' in oCurButton.oOptions)
-						sOptions = '<option value="">' + oCurButton.oOptions[''].php_htmlspecialchars() + '</option>';
-					for (var sSelectValue in oCurButton.oOptions)
-						// we've been through this before
-						if (sSelectValue != '')
-							sOptions += '<option value="' + sSelectValue.php_htmlspecialchars() + '">' + oCurButton.oOptions[sSelectValue].php_htmlspecialchars() + '</option>';
-
-					sRowContent += this.opt.sSelectTemplate.easyReplace({
-						selectName: oCurButton.sName,
-						selectId: this.opt.sUniqueId.php_htmlspecialchars() + '_select_' + iButtonRowIndex.toString() + '_' + iButtonIndex.toString(),
-						selectOptions: sOptions
-					});
-
-					bPreviousWasDivider = false;
-				break;
-			}
-		}
-		sBbcContent += this.opt.sButtonRowTemplate.easyReplace({
-			buttonRow: sRowContent
-		});
-	}
-
-	var oBbcContainer = document.getElementById(this.opt.sContainerDiv);
-	setInnerHTML(oBbcContainer, sBbcContent);
-
-	for (var iButtonRowIndex = 0, iRowCount = this.opt.aButtonRows.length; iButtonRowIndex < iRowCount; iButtonRowIndex++)
-	{
-		for (var iButtonIndex = 0, iButtonCount = this.opt.aButtonRows[iButtonRowIndex].length; iButtonIndex < iButtonCount; iButtonIndex++)
-		{
-			var oCurControl = this.opt.aButtonRows[iButtonRowIndex][iButtonIndex];
-			switch (oCurControl.sType)
-			{
-				case 'button':
-					if (!oCurControl.bEnabled)
-						break;
-
-					oCurControl.oImg = document.getElementById(this.opt.sUniqueId.php_htmlspecialchars() + '_button_' + iButtonRowIndex.toString() + '_' + iButtonIndex.toString());
-					oCurControl.oImg.style.cursor = 'pointer';
-					if ('sButtonBackgroundImage' in this.opt)
-						oCurControl.oImg.style.backgroundImage = 'url(' + this.opt.sButtonBackgroundImage + ')';
-
-					oCurControl.oImg.instanceRef = this;
-					oCurControl.oImg.onmouseover = function () {
-						this.instanceRef.handleButtonMouseOver(this);
-					};
-					oCurControl.oImg.onmouseout = function () {
-						this.instanceRef.handleButtonMouseOut(this);
-					};
-					oCurControl.oImg.onclick = function () {
-						this.instanceRef.handleButtonClick(this);
-					};
-
-					oCurControl.oImg.bIsActive = false;
-					oCurControl.oImg.bHover = false;
-				break;
-
-				case 'select':
-					oCurControl.oSelect = document.getElementById(this.opt.sUniqueId.php_htmlspecialchars() + '_select_' + iButtonRowIndex.toString() + '_' + iButtonIndex.toString());
-
-					oCurControl.oSelect.instanceRef = this;
-					oCurControl.oSelect.onchange = oCurControl.onchange = function () {
-						this.instanceRef.handleSelectChange(this);
-					}
-				break;
-			}
-		}
-	}
-}
-
-smc_BBCButtonBox.prototype.handleButtonMouseOver = function (oButtonImg)
-{
-	oButtonImg.bHover = true;
-	this.updateButtonStatus(oButtonImg);
-}
-
-smc_BBCButtonBox.prototype.handleButtonMouseOut = function (oButtonImg)
-{
-	oButtonImg.bHover = false;
-	this.updateButtonStatus(oButtonImg);
-}
-
-smc_BBCButtonBox.prototype.updateButtonStatus = function (oButtonImg)
-{
-	var sNewURL = '';
-	if (oButtonImg.bHover && oButtonImg.bIsActive && 'sActiveButtonBackgroundImageHover' in this.opt)
-		sNewURL = 'url(' + this.opt.sActiveButtonBackgroundImageHover + ')';
-	else if (!oButtonImg.bHover && oButtonImg.bIsActive && 'sActiveButtonBackgroundImage' in this.opt)
-		sNewURL = 'url(' + this.opt.sActiveButtonBackgroundImage + ')';
-	else if (oButtonImg.bHover && 'sButtonBackgroundImageHover' in this.opt)
-		sNewURL = 'url(' + this.opt.sButtonBackgroundImageHover + ')';
-	else if ('sButtonBackgroundImage' in this.opt)
-		sNewURL = 'url(' + this.opt.sButtonBackgroundImage + ')';
-
-	if (oButtonImg.style.backgroundImage != sNewURL)
-		oButtonImg.style.backgroundImage = sNewURL;
-}
-
-smc_BBCButtonBox.prototype.handleButtonClick = function (oButtonImg)
-{
-	// Dissect the id attribute...
-	var aMatches = oButtonImg.id.match(/(\d+)_(\d+)$/);
-	if (aMatches.length != 3)
-		return false;
-
-	// ...so that we can point to the exact button.
-	var iButtonRowIndex = aMatches[1];
-	var iButtonIndex = aMatches[2];
-	var oProperties = this.opt.aButtonRows[iButtonRowIndex][iButtonIndex];
-	oProperties.bIsActive = oButtonImg.bIsActive;
-
-	if ('sButtonClickHandler' in this.opt)
-		eval(this.opt.sButtonClickHandler + '(oProperties)');
-
-	return false;
-}
-
-smc_BBCButtonBox.prototype.handleSelectChange = function (oSelectControl)
-{
-	// Dissect the id attribute...
-	var aMatches = oSelectControl.id.match(/(\d+)_(\d+)$/);
-	if (aMatches.length != 3)
-		return false;
-
-	// ...so that we can point to the exact button.
-	var iButtonRowIndex = aMatches[1];
-	var iButtonIndex = aMatches[2];
-	var oProperties = this.opt.aButtonRows[iButtonRowIndex][iButtonIndex];
-
-	if ('sSelectChangeHandler' in this.opt)
-		eval(this.opt.sSelectChangeHandler + '(oProperties)');
-
-	return true;
-}
-
-smc_BBCButtonBox.prototype.setActive = function (aButtons)
-{
-	for (var iButtonRowIndex = 0, iRowCount = this.opt.aButtonRows.length; iButtonRowIndex < iRowCount; iButtonRowIndex++)
-	{
-		for (var iButtonIndex = 0, iButtonCount = this.opt.aButtonRows[iButtonRowIndex].length; iButtonIndex < iButtonCount; iButtonIndex++)
-		{
-			var oCurControl = this.opt.aButtonRows[iButtonRowIndex][iButtonIndex];
-			if (oCurControl.sType == 'button' && oCurControl.bEnabled)
-			{
-				oCurControl.oImg.bIsActive = in_array(oCurControl.sCode, aButtons);
-				this.updateButtonStatus(oCurControl.oImg);
-			}
-		}
-	}
-}
-
-smc_BBCButtonBox.prototype.emulateClick = function (sCode)
-{
-	for (var iButtonRowIndex = 0, iRowCount = this.opt.aButtonRows.length; iButtonRowIndex < iRowCount; iButtonRowIndex++)
-	{
-		for (var iButtonIndex = 0, iButtonCount = this.opt.aButtonRows[iButtonRowIndex].length; iButtonIndex < iButtonCount; iButtonIndex++)
-		{
-			var oCurControl = this.opt.aButtonRows[iButtonRowIndex][iButtonIndex];
-			if (oCurControl.sType == 'button' && oCurControl.sCode == sCode)
-			{
-				eval(this.opt.sButtonClickHandler + '(oCurControl)');
-				return true;
-			}
-		}
-	}
-	return false;
-}
-
-smc_BBCButtonBox.prototype.setSelect = function (sSelectName, sValue)
-{
-	if (!('sButtonClickHandler' in this.opt))
-		return;
-
-	for (var iButtonRowIndex = 0, iRowCount = this.opt.aButtonRows.length; iButtonRowIndex < iRowCount; iButtonRowIndex++)
-	{
-		for (var iButtonIndex = 0, iButtonCount = this.opt.aButtonRows[iButtonRowIndex].length; iButtonIndex < iButtonCount; iButtonIndex++)
-		{
-			var oCurControl = this.opt.aButtonRows[iButtonRowIndex][iButtonIndex];
-			if (oCurControl.sType == 'select' && oCurControl.sName == sSelectName)
-				oCurControl.oSelect.value = sValue;
-		}
-	}
-}
Only in a/Themes/default/scripts: fader.js
Only in b/Themes/default/scripts: icondropdown.js
Only in b/Themes/default/scripts: jquery-2.1.3.min.js
Only in b/Themes/default/scripts: jquery.atwho.js
Only in b/Themes/default/scripts: jquery.custom-scrollbar.js
Only in b/Themes/default/scripts: jquery.sceditor.bbcode.js
Only in b/Themes/default/scripts: jquery.sceditor.js
Only in b/Themes/default/scripts: jquery.sceditor.smf.js
Only in b/Themes/default/scripts: mentions.js
diff -ru a/Themes/default/scripts/profile.js b/Themes/default/scripts/profile.js
--- a/Themes/default/scripts/profile.js	2010-09-24 08:04:08.000000000 -0700
+++ b/Themes/default/scripts/profile.js	2015-03-05 23:30:06.034678866 -0800
@@ -37,4 +37,205 @@
 			if (die[j].type == "text" || die[j].type == "password")
 				die[j].setAttribute("autocomplete", "off");
 	}
-}
\ No newline at end of file
+}
+
+function calcCharLeft()
+{
+	var oldSignature = "", currentSignature = document.forms.creator.signature.value;
+	var currentChars = 0;
+
+	if (!document.getElementById("signatureLeft"))
+		return;
+
+	if (oldSignature != currentSignature)
+	{
+		oldSignature = currentSignature;
+
+		var currentChars = currentSignature.replace(/\r/, "").length;
+		if (is_opera)
+			currentChars = currentSignature.replace(/\r/g, "").length;
+
+		if (currentChars > maxLength)
+			document.getElementById("signatureLeft").className = "error";
+		else
+			document.getElementById("signatureLeft").className = "";
+
+		if (currentChars > maxLength)
+			ajax_getSignaturePreview(false);
+		// Only hide it if the only errors were signature errors...
+		else if (currentChars <= maxLength)
+		{
+			// Are there any errors to begin with?
+			if ($(document).has("#list_errors"))
+			{
+				// Remove any signature errors
+				$("#list_errors").remove(".sig_error");
+
+				// Don't hide this if other errors remain
+				if (!$("#list_errors").has("li"))
+				{
+					$("#profile_error").css({display:"none"});
+					$("#profile_error").html('');
+				}
+			}
+		}
+	}
+
+	setInnerHTML(document.getElementById("signatureLeft"), maxLength - currentChars);
+}
+
+function ajax_getSignaturePreview (showPreview)
+{
+	showPreview = (typeof showPreview == 'undefined') ? false : showPreview;
+
+	// Is the error box already visible?
+	var errorbox_visible = $("#profile_error").is(":visible");
+
+	$.ajax({
+		type: "POST",
+		url: smf_scripturl + "?action=xmlhttp;sa=previews;xml",
+		data: {item: "sig_preview", signature: $("#signature").val(), user: $('input[name="u"]').attr("value")},
+		context: document.body,
+		success: function(request){
+			if (showPreview)
+			{
+				var signatures = new Array("current", "preview");
+				for (var i = 0; i < signatures.length; i++)
+				{
+					$("#" + signatures[i] + "_signature").css({display:""});
+					$("#" + signatures[i] + "_signature_display").css({display:""}).html($(request).find('[type="' + signatures[i] + '"]').text() + '<hr>');
+				}
+			}
+
+			if ($(request).find("error").text() != '')
+			{
+				// If the box isn't already visible...
+				// 1. Add the initial HTML
+				// 2. Make it visible
+				if (!errorbox_visible)
+				{
+					// Build our HTML...
+					var errors_html = '<span>' + $(request).find('[type="errors_occurred"]').text() + '</span><ul id="list_errors"></ul>';
+
+					// Add it to the box...
+					$("#profile_error").html(errors_html);
+
+					// Make it visible
+					$("#profile_error").css({display: ""});
+				}
+				else
+				{
+					// Remove any existing signature-related errors...
+					$("#list_errors").remove(".sig_error");
+				}
+
+				var errors = $(request).find('[type="error"]');
+				var errors_list = '';
+
+				for (var i = 0; i < errors.length; i++)
+					errors_list += '<li class="sig_error">' + $(errors).text() + '</li>';
+
+				$("#list_errors").html(errors_list);
+			}
+			// If there were more errors besides signature-related ones, don't hide it
+			else
+			{
+				// Remove any signature errors first...
+				$("#list_errors").remove(".sig_error");
+
+				// If it still has content, there are other non-signature errors...
+				if (!$("#list_errors").has("li"))
+				{
+					$("#profile_error").css({display:"none"});
+					$("#profile_error").html('');
+				}
+			}
+		return false;
+		},
+	});
+	return false;
+}
+
+function changeSel(selected)
+{
+	if (cat.selectedIndex == -1)
+		return;
+
+	if (cat.options[cat.selectedIndex].value.indexOf("/") > 0)
+	{
+		var i;
+		var count = 0;
+
+		file.style.display = "inline";
+		file.disabled = false;
+
+		for (i = file.length; i >= 0; i = i - 1)
+			file.options[i] = null;
+
+		for (i = 0; i < files.length; i++)
+			if (files[i].indexOf(cat.options[cat.selectedIndex].value) == 0)
+			{
+				var filename = files[i].substr(files[i].indexOf("/") + 1);
+				var showFilename = filename.substr(0, filename.lastIndexOf("."));
+				showFilename = showFilename.replace(/[_]/g, " ");
+
+				file.options[count] = new Option(showFilename, files[i]);
+
+				if (filename == selected)
+				{
+					if (file.options.defaultSelected)
+						file.options[count].defaultSelected = true;
+					else
+						file.options[count].selected = true;
+				}
+
+				count++;
+			}
+
+		if (file.selectedIndex == -1 && file.options[0])
+			file.options[0].selected = true;
+
+		showAvatar();
+	}
+	else
+	{
+		file.style.display = "none";
+		file.disabled = true;
+		document.getElementById("avatar").src = avatardir + cat.options[cat.selectedIndex].value;
+		document.getElementById("avatar").style.width = "";
+		document.getElementById("avatar").style.height = "";
+	}
+}
+
+function showAvatar()
+{
+	if (file.selectedIndex == -1)
+		return;
+
+	document.getElementById("avatar").src = avatardir + file.options[file.selectedIndex].value;
+	document.getElementById("avatar").alt = file.options[file.selectedIndex].text;
+	document.getElementById("avatar").alt += file.options[file.selectedIndex].text == size ? "!" : "";
+	document.getElementById("avatar").style.width = "";
+	document.getElementById("avatar").style.height = "";
+}
+
+function previewExternalAvatar(src)
+{
+	if (!document.getElementById("avatar"))
+		return;
+
+	var tempImage = new Image();
+
+	tempImage.src = src;
+	if (maxWidth != 0 && tempImage.width > maxWidth)
+	{
+		document.getElementById("avatar").style.height = parseInt((maxWidth * tempImage.height) / tempImage.width) + "px";
+		document.getElementById("avatar").style.width = maxWidth + "px";
+	}
+	else if (maxHeight != 0 && tempImage.height > maxHeight)
+	{
+		document.getElementById("avatar").style.width = parseInt((maxHeight * tempImage.width) / tempImage.height) + "px";
+		document.getElementById("avatar").style.height = maxHeight + "px";
+	}
+	document.getElementById("avatar").src = src;
+}
diff -ru a/Themes/default/scripts/register.js b/Themes/default/scripts/register.js
--- a/Themes/default/scripts/register.js	2010-09-24 08:04:08.000000000 -0700
+++ b/Themes/default/scripts/register.js	2015-03-05 23:30:06.034678866 -0800
@@ -159,7 +159,7 @@
 			stringIndex = 'password_valid';
 
 		// Set the image.
-		setVerificationImage(verificationFields['pwmain'][2], isValid, textStrings[stringIndex] ? textStrings[stringIndex] : '');
+		setVerificationImage(verificationFields['pwmain'][0], isValid, textStrings[stringIndex] ? textStrings[stringIndex] : '');
 		verificationFields['pwmain'][1].className = verificationFields['pwmain'][5] + ' ' + (isValid ? 'valid_input' : 'invalid_input');
 
 		// As this has changed the verification one may have too!
@@ -179,7 +179,7 @@
 		// Check and set valid status!
 		var isValid = verificationFields['pwmain'][1].value == verificationFields['pwverify'][1].value && refreshMainPassword(true);
 		var alt = textStrings[isValid == 1 ? 'password_valid' : 'password_no_match'] ? textStrings[isValid == 1 ? 'password_valid' : 'password_no_match'] : '';
-		setVerificationImage(verificationFields['pwverify'][2], isValid, alt);
+		setVerificationImage(verificationFields['pwverify'][0], isValid, alt);
 		verificationFields['pwverify'][1].className = verificationFields['pwverify'][5] + ' ' + (isValid ? 'valid_input' : 'invalid_input');
 
 		return true;
@@ -196,7 +196,7 @@
 			verificationFields['username'][1].className = verificationFields['username'][5];
 		// Check the image is correct.
 		var alt = textStrings['username_check'] ? textStrings['username_check'] : '';
-		setVerificationImage(verificationFields['username'][2], 'check', alt);
+		setVerificationImage(verificationFields['username'][0], 'check', alt);
 
 		// Check the password is still OK.
 		refreshMainPassword();
@@ -226,7 +226,7 @@
 
 		// Request a search on that username.
 		checkName = curUsername.php_to8bit().php_urlencode();
-		getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + 'action=register;sa=usernamecheck;xml;username=' + checkName, checkUsernameCallback);
+		getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + 'action=signup;sa=usernamecheck;xml;username=' + checkName, checkUsernameCallback);
 
 		return true;
 	}
@@ -243,24 +243,36 @@
 		var alt = textStrings[isValid == 1 ? 'username_valid' : 'username_invalid'] ? textStrings[isValid == 1 ? 'username_valid' : 'username_invalid'] : '';
 
 		verificationFields['username'][1].className = verificationFields['username'][5] + ' ' + (isValid == 1 ? 'valid_input' : 'invalid_input');
-		setVerificationImage(verificationFields['username'][2], isValid == 1, alt);
+		setVerificationImage(verificationFields['username'][0], isValid == 1, alt);
 
 		ajax_indicator(false);
 	}
 
 	// Set the image to be the correct type.
-	function setVerificationImage(imageHandle, imageIcon, alt)
+	function setVerificationImage(fieldID, imageIcon, alt)
 	{
-		if (!imageHandle)
+		if (!fieldID)
 			return false;
 		if (!alt)
 			alt = '*';
 
-		var curImage = imageIcon ? (imageIcon == 'check' ? 'field_check.gif' : 'field_valid.gif') : 'field_invalid.gif';
-		imageHandle.src = smf_images_url + '/icons/' + curImage;
-		imageHandle.alt = alt;
-		imageHandle.title = alt;
+		$('#' + fieldID + '_img').removeClass('valid check invalid').attr('alt', alt).attr('title', alt);
+		if (imageIcon)
+			$('#' + fieldID + '_img').addClass(imageIcon == 'check' ? 'check' : 'valid');
+		else
+			$('#' + fieldID + '_img').addClass('invalid');
 
 		return true;
 	}
+}
+
+function onCheckChange()
+{
+	if (document.forms.postForm.emailActivate.checked || document.forms.postForm.password.value == '')
+	{
+		document.forms.postForm.emailPassword.disabled = true;
+		document.forms.postForm.emailPassword.checked = true;
+	}
+	else
+		document.forms.postForm.emailPassword.disabled = false;
 }
\ No newline at end of file
diff -ru a/Themes/default/scripts/script.js b/Themes/default/scripts/script.js
--- a/Themes/default/scripts/script.js	2011-04-24 06:27:52.000000000 -0700
+++ b/Themes/default/scripts/script.js	2015-03-05 23:30:06.034678866 -0800
@@ -6,16 +6,6 @@
 var ua = navigator.userAgent.toLowerCase();
 
 var is_opera = ua.indexOf('opera') != -1;
-var is_opera5 = ua.indexOf('opera/5') != -1 || ua.indexOf('opera 5') != -1;
-var is_opera6 = ua.indexOf('opera/6') != -1 || ua.indexOf('opera 6') != -1;
-var is_opera7 = ua.indexOf('opera/7') != -1 || ua.indexOf('opera 7') != -1;
-var is_opera8 = ua.indexOf('opera/8') != -1 || ua.indexOf('opera 8') != -1;
-var is_opera9 = ua.indexOf('opera/9') != -1 || ua.indexOf('opera 9') != -1;
-var is_opera95 = ua.indexOf('opera/9.5') != -1 || ua.indexOf('opera 9.5') != -1;
-var is_opera96 = ua.indexOf('opera/9.6') != -1 || ua.indexOf('opera 9.6') != -1;
-var is_opera10 = (ua.indexOf('opera/9.8') != -1 || ua.indexOf('opera 9.8') != -1 || ua.indexOf('opera/10.') != -1 || ua.indexOf('opera 10.') != -1) || ua.indexOf('version/10.') != -1;
-var is_opera95up = is_opera95 || is_opera96 || is_opera10;
-
 var is_ff = (ua.indexOf('firefox') != -1 || ua.indexOf('iceweasel') != -1 || ua.indexOf('icecat') != -1 || ua.indexOf('shiretoko') != -1 || ua.indexOf('minefield') != -1) && !is_opera;
 var is_gecko = ua.indexOf('gecko') != -1 && !is_opera;
 
@@ -24,48 +14,32 @@
 var is_webkit = ua.indexOf('applewebkit') != -1;
 
 var is_ie = ua.indexOf('msie') != -1 && !is_opera;
-var is_ie4 = is_ie && ua.indexOf('msie 4') != -1;
-var is_ie5 = is_ie && ua.indexOf('msie 5') != -1;
-var is_ie50 = is_ie && ua.indexOf('msie 5.0') != -1;
-var is_ie55 = is_ie && ua.indexOf('msie 5.5') != -1;
-var is_ie5up = is_ie && !is_ie4;
-var is_ie6 = is_ie && ua.indexOf('msie 6') != -1;
-var is_ie6up = is_ie5up && !is_ie55 && !is_ie5;
-var is_ie6down = is_ie6 || is_ie5 || is_ie4;
-var is_ie7 = is_ie && ua.indexOf('msie 7') != -1;
-var is_ie7up = is_ie6up && !is_ie6;
-var is_ie7down = is_ie7 || is_ie6 || is_ie5 || is_ie4;
-
-var is_ie8 = is_ie && ua.indexOf('msie 8') != -1;
-var is_ie8up = is_ie8 && !is_ie7down;
-
+// Stupid Microsoft...
+var is_ie11 = ua.indexOf('trident') != -1 && ua.indexOf('gecko') != -1;
 var is_iphone = ua.indexOf('iphone') != -1 || ua.indexOf('ipod') != -1;
 var is_android = ua.indexOf('android') != -1;
 
 var ajax_indicator_ele = null;
 
-// Define document.getElementById for Internet Explorer 4.
-if (!('getElementById' in document) && 'all' in document)
-	document.getElementById = function (sId) {
-		return document.all[sId];
-	}
-
-// Define XMLHttpRequest for IE 5 and above. (don't bother for IE 4 :/.... works in Opera 7.6 and Safari 1.2!)
-else if (!('XMLHttpRequest' in window) && 'ActiveXObject' in window)
+// Define XMLHttpRequest for IE
+if (!('XMLHttpRequest' in window) && 'ActiveXObject' in window)
 	window.XMLHttpRequest = function () {
-		return new ActiveXObject(is_ie5 ? 'Microsoft.XMLHTTP' : 'MSXML2.XMLHTTP');
+		return new ActiveXObject('MSXML2.XMLHTTP');
 	};
 
-// Ensure the getElementsByTagName exists.
-if (!'getElementsByTagName' in document && 'all' in document)
-	document.getElementsByTagName = function (sName) {
-		return document.all.tags[sName];
-	}
-
 // Some older versions of Mozilla don't have this, for some reason.
 if (!('forms' in document))
 	document.forms = document.getElementsByTagName('form');
 
+// Versions of ie < 9 do not have this built in
+if (!('getElementsByClassName' in document))
+{
+	document.getElementsByClassName = function(className)
+	{
+		return $('".' + className + '"');
+	}
+}
+
 // Load an XML document using XMLHttpRequest.
 function getXMLDocument(sUrl, funcCallback)
 {
@@ -148,7 +122,7 @@
 		{
 			n = this.charCodeAt(i);
 			if (n < 128)
-				sReturn += String.fromCharCode(n)
+				sReturn += String.fromCharCode(n);
 			else if (n < 2048)
 				sReturn += String.fromCharCode(192 | n >> 6) + String.fromCharCode(128 | n & 63);
 			else if (n < 65536)
@@ -317,8 +291,7 @@
 	return sResult;
 }
 
-
-// Open a new window.
+// Open a new window
 function reqWin(desktopURL, alternateWidth, alternateHeight, noScrollbars)
 {
 	if ((alternateWidth && self.screen.availWidth * 0.8 < alternateWidth) || (alternateHeight && self.screen.availHeight * 0.8 < alternateHeight))
@@ -336,6 +309,156 @@
 	return false;
 }
 
+// Open a overlay div
+function reqOverlayDiv(desktopURL, sHeader, sIcon)
+{
+	// Set up our div details
+	var sAjax_indicator = '<div class="centertext"><img src="' + smf_images_url + '/loading_sm.gif"></div>';
+	var sIcon = smf_images_url + '/' + (typeof(sIcon) == 'string' ? sIcon : 'helptopics.png');
+	var sHeader = typeof(sHeader) == 'string' ? sHeader : help_popup_heading_text;
+
+	// Create the div that we are going to load
+	var oContainer = new smc_Popup({heading: sHeader, content: sAjax_indicator, icon: sIcon});
+	var oPopup_body = $('#' + oContainer.popup_id).find('.popup_content');
+
+	// Load the help page content (we just want the text to show)
+	$.ajax({
+		url: desktopURL,
+		type: "GET",
+		dataType: "html",
+		beforeSend: function () {
+		},
+		success: function (data, textStatus, xhr) {
+			var help_content = $('<div id="temp_help">').html(data).find('a[href$="self.close();"]').hide().prev('br').hide().parent().html();
+			oPopup_body.html(help_content);
+		},
+		error: function (xhr, textStatus, errorThrown) {
+			oPopup_body.html(textStatus);
+		}
+	});
+	return false;
+}
+
+// Create the popup menus for the top level/user menu area.
+function smc_PopupMenu(oOptions)
+{
+	this.opt = (typeof oOptions == 'object') ? oOptions : {};
+	this.opt.menus = {};
+}
+
+smc_PopupMenu.prototype.add = function (sItem, sUrl)
+{
+	var $menu = $('#' + sItem + '_menu'), $item = $('#' + sItem + '_menu_top');
+	if ($item.length == 0)
+		return;
+
+	this.opt.menus[sItem] = {open: false, loaded: false, sUrl: sUrl, itemObj: $item, menuObj: $menu };
+
+	$item.click({obj: this}, function (e) {
+		e.preventDefault();
+
+		e.data.obj.toggle(sItem);
+	});
+}
+
+smc_PopupMenu.prototype.toggle = function (sItem)
+{
+	if (!!this.opt.menus[sItem].open)
+		this.close(sItem);
+	else
+		this.open(sItem);
+}
+
+smc_PopupMenu.prototype.open = function (sItem)
+{
+	this.closeAll();
+
+	if (!this.opt.menus[sItem].loaded)
+	{
+		this.opt.menus[sItem].menuObj.html('<div class="loading">' + (typeof(ajax_notification_text) != null ? ajax_notification_text : '') + '</div>');
+		this.opt.menus[sItem].menuObj.load(this.opt.menus[sItem].sUrl, function() {
+			if ($(this).hasClass('scrollable'))
+				$(this).customScrollbar({
+					skin: "default-skin",
+					hScroll: false,
+					updateOnWindowResize: true
+				});
+		});
+		this.opt.menus[sItem].loaded = true;
+	}
+
+	this.opt.menus[sItem].menuObj.addClass('visible');
+	this.opt.menus[sItem].itemObj.addClass('open');
+	this.opt.menus[sItem].open = true;
+
+	// Now set up closing the menu if we click off.
+	$(document).on('click.menu', {obj: this}, function(e) {
+		if ($(e.target).closest(e.data.obj.opt.menus[sItem].menuObj.parent()).length)
+			return;
+		e.data.obj.closeAll();
+		$(document).off('click.menu');
+	});
+}
+
+smc_PopupMenu.prototype.close = function (sItem)
+{
+	this.opt.menus[sItem].menuObj.removeClass('visible');
+	this.opt.menus[sItem].itemObj.removeClass('open');
+	this.opt.menus[sItem].open = false;
+	$(document).off('click.menu');
+}
+
+smc_PopupMenu.prototype.closeAll = function ()
+{
+	for (var prop in this.opt.menus)
+		if (!!this.opt.menus[prop].open)
+			this.close(prop);
+}
+
+// *** smc_Popup class.
+function smc_Popup(oOptions)
+{
+	this.opt = oOptions;
+	this.popup_id = this.opt.custom_id ? this.opt.custom_id : 'smf_popup';
+	this.show();
+}
+
+smc_Popup.prototype.show = function ()
+{
+	popup_class = 'popup_window ' + (this.opt.custom_class ? this.opt.custom_class : 'description');
+	if (this.opt.icon_class)
+		icon = '<span class="' + this.opt.icon_class + '"></span> ';
+	else
+		icon = this.opt.icon ? '<img src="' + this.opt.icon + '" class="icon" alt=""> ' : '';
+
+	// Create the div that will be shown
+	$('body').append('<div id="' + this.popup_id + '" class="popup_container"><div class="' + popup_class + '"><div class="catbg popup_heading"><a href="javascript:void(0);" class="generic_icons hide_popup"></a>' + icon + this.opt.heading + '</div><div class="popup_content">' + this.opt.content + '</div></div></div>');
+
+	// Show it
+	this.popup_body = $('#' + this.popup_id).children('.popup_window');
+	this.popup_body.parent().fadeIn(300);
+
+	// Trigger hide on escape or mouse click
+	var popup_instance = this;
+	$(document).mouseup(function (e) {
+		if ($('#' + popup_instance.popup_id).has(e.target).length === 0)
+			popup_instance.hide();
+	}).keyup(function(e){
+		if (e.keyCode == 27)
+			popup_instance.hide();
+	});
+	$('#' + this.popup_id).find('.hide_popup').click(function (){ return popup_instance.hide(); });
+
+	return false;
+}
+
+smc_Popup.prototype.hide = function ()
+{
+	$('#' + this.popup_id).fadeOut(300, function(){ $(this).remove(); });
+
+	return false;
+}
+
 // Remember the current position.
 function storeCaret(oTextHandle)
 {
@@ -433,7 +556,10 @@
 function isEmptyText(theField)
 {
 	// Copy the value so changes can be made..
-	var theValue = theField.value;
+	if (typeof(theField) == 'string')
+		var theValue = theField;
+	else
+		var theValue = theField.value;
 
 	// Strip whitespace off the left side.
 	while (theValue.length > 0 && (theValue.charAt(0) == ' ' || theValue.charAt(0) == '\t'))
@@ -459,10 +585,6 @@
 }
 function submitThisOnce(oControl)
 {
-	// Hateful, hateful fix for Safari 1.3 beta.
-	if (is_safari)
-		return !smf_formSubmitted;
-
 	// oControl might also be a form.
 	var oForm = 'form' in oControl ? oControl.form : oControl;
 
@@ -530,6 +652,13 @@
 	return false;
 }
 
+function selectAllRadio(oInvertCheckbox, oForm, sMask, sValue, bIgnoreDisabled)
+{
+	for (var i = 0; i < oForm.length; i++)
+		if (oForm[i].name != undefined && oForm[i].name.substr(0, sMask.length) == sMask && oForm[i].value == sValue && (!oForm[i].disabled || (typeof(bIgnoreDisabled) == 'boolean' && bIgnoreDisabled)))
+			oForm[i].checked = true;
+}
+
 // Invert all checkboxes at once by clicking a single checkbox.
 function invertAll(oInvertCheckbox, oForm, sMask, bIgnoreDisabled)
 {
@@ -577,95 +706,12 @@
 	tempImage.src = smf_prepareScriptUrl(smf_scripturl) + 'action=jsoption;var=' + option + ';val=' + value + ';' + cur_session_var + '=' + cur_session_id + additional_vars + (theme == null ? '' : '&th=' + theme) + ';time=' + (new Date().getTime());
 }
 
-function smf_avatarResize()
-{
-	var possibleAvatars = document.getElementsByTagName('img');
-
-	for (var i = 0; i < possibleAvatars.length; i++)
-	{
-		var tempAvatars = []; j = 0;
-		if (possibleAvatars[i].className != 'avatar')
-			continue;
-
-		// Image.prototype.avatar = possibleAvatars[i];
-		tempAvatars[j] = new Image();
-		tempAvatars[j].avatar = possibleAvatars[i];
-		
-		tempAvatars[j].onload = function()
-		{
-			this.avatar.width = this.width;
-			this.avatar.height = this.height;
-			if (smf_avatarMaxWidth != 0 && this.width > smf_avatarMaxWidth)
-			{
-				this.avatar.height = (smf_avatarMaxWidth * this.height) / this.width;
-				this.avatar.width = smf_avatarMaxWidth;
-			}
-			if (smf_avatarMaxHeight != 0 && this.avatar.height > smf_avatarMaxHeight)
-			{
-				this.avatar.width = (smf_avatarMaxHeight * this.avatar.width) / this.avatar.height;
-				this.avatar.height = smf_avatarMaxHeight;
-			}
-		}
-		tempAvatars[j].src = possibleAvatars[i].src;
-		j++;
-	}
-
-	if (typeof(window_oldAvatarOnload) != 'undefined' && window_oldAvatarOnload)
-	{
-		window_oldAvatarOnload();
-		window_oldAvatarOnload = null;
-	}
-}
-
-
-function hashLoginPassword(doForm, cur_session_id)
-{
-	// Compatibility.
-	if (cur_session_id == null)
-		cur_session_id = smf_session_id;
-
-	if (typeof(hex_sha1) == 'undefined')
-		return;
-	// Are they using an email address?
-	if (doForm.user.value.indexOf('@') != -1)
-		return;
-
-	// Unless the browser is Opera, the password will not save properly.
-	if (!('opera' in window))
-		doForm.passwrd.autocomplete = 'off';
-
-	doForm.hash_passwrd.value = hex_sha1(hex_sha1(doForm.user.value.php_to8bit().php_strtolower() + doForm.passwrd.value.php_to8bit()) + cur_session_id);
-
-	// It looks nicer to fill it with asterisks, but Firefox will try to save that.
-	if (is_ff != -1)
-		doForm.passwrd.value = '';
-	else
-		doForm.passwrd.value = doForm.passwrd.value.replace(/./g, '*');
-}
-
-function hashAdminPassword(doForm, username, cur_session_id)
-{
-	// Compatibility.
-	if (cur_session_id == null)
-		cur_session_id = smf_session_id;
-
-	if (typeof(hex_sha1) == 'undefined')
-		return;
-
-	doForm.admin_hash_pass.value = hex_sha1(hex_sha1(username.php_to8bit().php_strtolower() + doForm.admin_pass.value.php_to8bit()) + cur_session_id);
-	doForm.admin_pass.value = doForm.admin_pass.value.replace(/./g, '*');
-}
-
 // Shows the page numbers by clicking the dots (in compact view).
-function expandPages(spanNode, baseURL, firstPage, lastPage, perPage)
+function expandPages(spanNode, baseLink, firstPage, lastPage, perPage)
 {
 	var replacement = '', i, oldLastPage = 0;
 	var perPageLimit = 50;
 
-	// The dots were bold, the page numbers are not (in most cases).
-	spanNode.style.fontWeight = 'normal';
-	spanNode.onclick = '';
-
 	// Prevent too many pages to be loaded at once.
 	if ((lastPage - firstPage) / perPage > perPageLimit)
 	{
@@ -675,13 +721,19 @@
 
 	// Calculate the new pages.
 	for (i = firstPage; i < lastPage; i += perPage)
-		replacement += '<a class="navPages" href="' + baseURL.replace(/%1\$d/, i).replace(/%%/g, '%') + '">' + (1 + i / perPage) + '</a> ';
+		replacement += baseLink.replace(/%1\$d/, i).replace(/%2\$s/, 1 + i / perPage).replace(/%%/g, '%');
 
-	if (oldLastPage > 0)
-		replacement += '<span style="font-weight: bold; cursor: ' + (is_ie && !is_ie6up ? 'hand' : 'pointer') + ';" onclick="expandPages(this, \'' + baseURL + '\', ' + lastPage + ', ' + oldLastPage + ', ' + perPage + ');"> ... </span> ';
+	// Add the new page links.
+	$(spanNode).before(replacement);
 
-	// Replace the dots by the new page links.
-	setInnerHTML(spanNode, replacement);
+	if (oldLastPage)
+		// Access the raw DOM element so the native onclick event can be overridden.
+		spanNode.onclick = function ()
+		{
+			expandPages(spanNode, baseLink, lastPage, oldLastPage, perPage);
+		};
+	else
+		$(spanNode).remove();
 }
 
 function smc_preCacheImage(sSrc)
@@ -756,31 +808,36 @@
 			this.opt.bCurrentlyCollapsed = cookieValue == '1';
 	}
 
-	// If the init state is set to be collapsed, collapse it.
-	if (this.opt.bCurrentlyCollapsed)
-		this.changeState(true, true);
-
 	// Initialize the images to be clickable.
 	if ('aSwapImages' in this.opt)
 	{
 		for (var i = 0, n = this.opt.aSwapImages.length; i < n; i++)
 		{
+			this.opt.aSwapImages[i].isCSS = (typeof this.opt.aSwapImages[i].srcCollapsed == 'undefined');
+			if (this.opt.aSwapImages[i].isCSS)
+			{
+				if (!this.opt.aSwapImages[i].cssCollapsed)
+					this.opt.aSwapImages[i].cssCollapsed = 'toggle_down';
+				if (!this.opt.aSwapImages[i].cssExpanded)
+					this.opt.aSwapImages[i].cssExpanded = 'toggle_up';
+			}
+			else
+			{
+				// Preload the collapsed image.
+				smc_preCacheImage(this.opt.aSwapImages[i].srcCollapsed);
+			}
+
+			// Display the image in case it was hidden.
+			$('#' + this.opt.aSwapImages[i].sId).show();
 			var oImage = document.getElementById(this.opt.aSwapImages[i].sId);
 			if (typeof(oImage) == 'object' && oImage != null)
 			{
-				// Display the image in case it was hidden.
-				if (oImage.style.display == 'none')
-					oImage.style.display = '';
-
 				oImage.instanceRef = this;
 				oImage.onclick = function () {
 					this.instanceRef.toggle();
 					this.blur();
 				}
 				oImage.style.cursor = 'pointer';
-
-				// Preload the collapsed image.
-				smc_preCacheImage(this.opt.aSwapImages[i].srcCollapsed);
 			}
 		}
 	}
@@ -806,6 +863,10 @@
 			}
 		}
 	}
+
+	// If the init state is set to be collapsed, collapse it.
+	if (this.opt.bCurrentlyCollapsed)
+		this.changeState(true, true);
 }
 
 // Collapse or expand the section.
@@ -835,15 +896,22 @@
 	{
 		for (var i = 0, n = this.opt.aSwapImages.length; i < n; i++)
 		{
-			var oImage = document.getElementById(this.opt.aSwapImages[i].sId);
-			if (typeof(oImage) == 'object' && oImage != null)
+			if (this.opt.aSwapImages[i].isCSS)
+			{
+				$('#' + this.opt.aSwapImages[i].sId).toggleClass(this.opt.aSwapImages[i].cssCollapsed, bCollapse).toggleClass(this.opt.aSwapImages[i].cssExpanded, !bCollapse).attr('title', bCollapse ? this.opt.aSwapImages[i].altCollapsed : this.opt.aSwapImages[i].altExpanded);
+			}
+			else
 			{
-				// Only (re)load the image if it's changed.
-				var sTargetSource = bCollapse ? this.opt.aSwapImages[i].srcCollapsed : this.opt.aSwapImages[i].srcExpanded;
-				if (oImage.src != sTargetSource)
-					oImage.src = sTargetSource;
+				var oImage = document.getElementById(this.opt.aSwapImages[i].sId);
+				if (typeof(oImage) == 'object' && oImage != null)
+				{
+					// Only (re)load the image if it's changed.
+					var sTargetSource = bCollapse ? this.opt.aSwapImages[i].srcCollapsed : this.opt.aSwapImages[i].srcExpanded;
+					if (oImage.src != sTargetSource)
+						oImage.src = sTargetSource;
 
-				oImage.alt = oImage.title = bCollapse ? this.opt.aSwapImages[i].altCollapsed : this.opt.aSwapImages[i].altExpanded;
+					oImage.alt = oImage.title = bCollapse ? this.opt.aSwapImages[i].altCollapsed : this.opt.aSwapImages[i].altExpanded;
+				}
 			}
 		}
 	}
@@ -867,7 +935,19 @@
 
 		var oContainer = document.getElementById(this.opt.aSwappableContainers[i]);
 		if (typeof(oContainer) == 'object' && oContainer != null)
-			oContainer.style.display = bCollapse ? 'none' : '';
+		{
+			if (!!this.opt.bNoAnimate || bInit)
+			{
+				$(oContainer).toggle(!bCollapse);
+			}
+			else
+			{
+				if (bCollapse)
+					$(oContainer).slideUp();
+				else
+					$(oContainer).slideDown();
+			}
+		}
 	}
 
 	// Update the new state.
@@ -877,8 +957,8 @@
 	if ('oCookieOptions' in this.opt && this.opt.oCookieOptions.bUseCookie)
 		this.oCookie.set(this.opt.oCookieOptions.sCookieName, this.bCollapsed ? '1' : '0');
 
-	if ('oThemeOptions' in this.opt && this.opt.oThemeOptions.bUseThemeSettings)
-		smf_setThemeOption(this.opt.oThemeOptions.sOptionName, this.bCollapsed ? '1' : '0', 'sThemeId' in this.opt.oThemeOptions ? this.opt.oThemeOptions.sThemeId : null, this.opt.oThemeOptions.sSessionId, this.opt.oThemeOptions.sSessionVar, 'sAdditionalVars' in this.opt.oThemeOptions ? this.opt.oThemeOptions.sAdditionalVars : null);
+	if (!bInit && 'oThemeOptions' in this.opt && this.opt.oThemeOptions.bUseThemeSettings)
+		smf_setThemeOption(this.opt.oThemeOptions.sOptionName, this.bCollapsed ? '1' : '0', 'sThemeId' in this.opt.oThemeOptions ? this.opt.oThemeOptions.sThemeId : null, smf_session_id, smf_session_var, 'sAdditionalVars' in this.opt.oThemeOptions ? this.opt.oThemeOptions.sAdditionalVars : null);
 }
 
 smc_Toggle.prototype.toggle = function()
@@ -902,12 +982,6 @@
 
 	if (ajax_indicator_ele != null)
 	{
-		if (navigator.appName == 'Microsoft Internet Explorer' && !is_ie7up)
-		{
-			ajax_indicator_ele.style.position = 'absolute';
-			ajax_indicator_ele.style.top = document.documentElement.scrollTop;
-		}
-
 		ajax_indicator_ele.style.display = turn_on ? 'block' : 'none';
 	}
 }
@@ -920,22 +994,6 @@
 	// Set the id so it'll load the style properly.
 	ajax_indicator_ele.id = 'ajax_in_progress';
 
-	// Add the image in and link to turn it off.
-	var cancel_link = document.createElement('a');
-	cancel_link.href = 'javascript:ajax_indicator(false)';
-	var cancel_img = document.createElement('img');
-	cancel_img.src = smf_images_url + '/icons/quick_remove.gif';
-
-	if (typeof(ajax_notification_cancel_text) != 'undefined')
-	{
-		cancel_img.alt = ajax_notification_cancel_text;
-		cancel_img.title = ajax_notification_cancel_text;
-	}
-
-	// Add the cancel link and image to the indicator.
-	cancel_link.appendChild(cancel_img);
-	ajax_indicator_ele.appendChild(cancel_link);
-
 	// Set the text.  (Note:  You MUST append here and not overwrite.)
 	ajax_indicator_ele.innerHTML += ajax_notification_text;
 
@@ -969,10 +1027,11 @@
 }
 
 // This function will retrieve the contents needed for the jump to boxes.
-function grabJumpToContent()
+function grabJumpToContent(elem)
 {
 	var oXMLDoc = getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + 'action=xmlhttp;sa=jumpto;xml');
 	var aBoardsAndCategories = new Array();
+	var bIE5x = !('implementation' in document);
 
 	ajax_indicator(true);
 
@@ -995,6 +1054,14 @@
 
 	for (var i = 0, n = aJumpTo.length; i < n; i++)
 		aJumpTo[i].fillSelect(aBoardsAndCategories);
+
+	if (bIE5x)
+		elem.options[iIndexPointer].selected = true;
+
+	// Internet Explorer needs this to keep the box dropped down.
+	elem.style.width = 'auto';
+	elem.focus();
+
 }
 
 // This'll contain all JumpTo objects on the page.
@@ -1014,14 +1081,13 @@
 	var sChildLevelPrefix = '';
 	for (var i = this.opt.iCurBoardChildLevel; i > 0; i--)
 		sChildLevelPrefix += this.opt.sBoardChildLevelIndicator;
-	setInnerHTML(document.getElementById(this.opt.sContainerId), this.opt.sJumpToTemplate.replace(/%select_id%/, this.opt.sContainerId + '_select').replace(/%dropdown_list%/, '<select name="' + this.opt.sContainerId + '_select" id="' + this.opt.sContainerId + '_select" ' + ('implementation' in document ? '' : 'onmouseover="grabJumpToContent();" ') + ('onbeforeactivate' in document ? 'onbeforeactivate' : 'onfocus') + '="grabJumpToContent();"><option value="?board=' + this.opt.iCurBoardId + '.0">' + sChildLevelPrefix + this.opt.sBoardPrefix + this.opt.sCurBoardName.removeEntities() + '</option></select>&nbsp;<input type="button" value="' + this.opt.sGoButtonLabel + '" onclick="window.location.href = \'' + smf_prepareScriptUrl(smf_scripturl) + 'board=' + this.opt.iCurBoardId + '.0\';" />'));
+	setInnerHTML(document.getElementById(this.opt.sContainerId), this.opt.sJumpToTemplate.replace(/%select_id%/, this.opt.sContainerId + '_select').replace(/%dropdown_list%/, '<select ' + (this.opt.bDisabled == true ? 'disabled ' : '') + (this.opt.sClassName != undefined ? 'class="' + this.opt.sClassName + '" ' : '') + 'name="' + (this.opt.sCustomName != undefined ? this.opt.sCustomName : this.opt.sContainerId + '_select') + '" id="' + this.opt.sContainerId + '_select" ' + ('implementation' in document ? '' : 'onmouseover="grabJumpToContent(this);" ') + ('onbeforeactivate' in document ? 'onbeforeactivate' : 'onfocus') + '="grabJumpToContent(this);"><option value="' + (this.opt.bNoRedirect != undefined && this.opt.bNoRedirect == true ? this.opt.iCurBoardId : '?board=' + this.opt.iCurBoardId + '.0') + '">' + sChildLevelPrefix + this.opt.sBoardPrefix + this.opt.sCurBoardName.removeEntities() + '</option></select>&nbsp;' + (this.opt.sGoButtonLabel != undefined ? '<input type="button" class="button_submit" value="' + this.opt.sGoButtonLabel + '" onclick="window.location.href = \'' + smf_prepareScriptUrl(smf_scripturl) + 'board=' + this.opt.iCurBoardId + '.0\';">' : '')));
 	this.dropdownList = document.getElementById(this.opt.sContainerId + '_select');
 }
 
 // Fill the jump to box with entries. Method of the JumpTo class.
 JumpTo.prototype.fillSelect = function (aBoardsAndCategories)
 {
-	var bIE5x = !('implementation' in document);
 	var iIndexPointer = 0;
 
 	// Create an option that'll be above and below the category.
@@ -1030,19 +1096,16 @@
 	oDashOption.disabled = 'disabled';
 	oDashOption.value = '';
 
-	// Reset the events and clear the list (IE5.x only).
-	if (bIE5x)
-	{
-		this.dropdownList.onmouseover = null;
-		this.dropdownList.remove(0);
-	}
 	if ('onbeforeactivate' in document)
 		this.dropdownList.onbeforeactivate = null;
 	else
 		this.dropdownList.onfocus = null;
 
+	if (this.opt.bNoRedirect)
+		this.dropdownList.options[0].disabled = 'disabled';
+
 	// Create a document fragment that'll allowing inserting big parts at once.
-	var oListFragment = bIE5x ? this.dropdownList : document.createDocumentFragment();
+	var oListFragment = document.createDocumentFragment();
 
 	// Loop through all items to be added.
 	for (var i = 0, n = aBoardsAndCategories.length; i < n; i++)
@@ -1052,14 +1115,9 @@
 		// If we've reached the currently selected board add all items so far.
 		if (!aBoardsAndCategories[i].isCategory && aBoardsAndCategories[i].id == this.opt.iCurBoardId)
 		{
-			if (bIE5x)
-				iIndexPointer = this.dropdownList.options.length;
-			else
-			{
 				this.dropdownList.insertBefore(oListFragment, this.dropdownList.options[0]);
 				oListFragment = document.createDocumentFragment();
 				continue;
-			}
 		}
 
 		if (aBoardsAndCategories[i].isCategory)
@@ -1070,7 +1128,15 @@
 
 		oOption = document.createElement('option');
 		oOption.appendChild(document.createTextNode((aBoardsAndCategories[i].isCategory ? this.opt.sCatPrefix : sChildLevelPrefix + this.opt.sBoardPrefix) + aBoardsAndCategories[i].name));
-		oOption.value = aBoardsAndCategories[i].isCategory ? '#c' + aBoardsAndCategories[i].id : '?board=' + aBoardsAndCategories[i].id + '.0';
+		if (!this.opt.bNoRedirect)
+			oOption.value = aBoardsAndCategories[i].isCategory ? '#c' + aBoardsAndCategories[i].id : '?board=' + aBoardsAndCategories[i].id + '.0';
+		else
+		{
+			if (aBoardsAndCategories[i].isCategory)
+				oOption.disabled = 'disabled';
+			else
+				oOption.value = aBoardsAndCategories[i].id;
+		}
 		oListFragment.appendChild(oOption);
 
 		if (aBoardsAndCategories[i].isCategory)
@@ -1080,18 +1146,12 @@
 	// Add the remaining items after the currently selected item.
 	this.dropdownList.appendChild(oListFragment);
 
-	if (bIE5x)
-		this.dropdownList.options[iIndexPointer].selected = true;
-
-	// Internet Explorer needs this to keep the box dropped down.
-	this.dropdownList.style.width = 'auto';
-	this.dropdownList.focus();
-
 	// Add an onchange action
-	this.dropdownList.onchange = function() {
-		if (this.selectedIndex > 0 && this.options[this.selectedIndex].value)
-			window.location.href = smf_scripturl + this.options[this.selectedIndex].value.substr(smf_scripturl.indexOf('?') == -1 || this.options[this.selectedIndex].value.substr(0, 1) != '?' ? 0 : 1);
-	}
+	if (!this.opt.bNoRedirect)
+		this.dropdownList.onchange = function() {
+			if (this.selectedIndex > 0 && this.options[this.selectedIndex].value)
+				window.location.href = smf_scripturl + this.options[this.selectedIndex].value.substr(smf_scripturl.indexOf('?') == -1 || this.options[this.selectedIndex].value.substr(0, 1) != '?' ? 0 : 1);
+		}
 }
 
 // A global array containing all IconList objects.
@@ -1123,7 +1183,7 @@
 {
 	for (var i = document.images.length - 1, iPrefixLength = this.opt.sIconIdPrefix.length; i >= 0; i--)
 		if (document.images[i].id.substr(0, iPrefixLength) == this.opt.sIconIdPrefix)
-			setOuterHTML(document.images[i], '<div title="' + this.opt.sLabelIconList + '" onclick="' + this.opt.sBackReference + '.openPopup(this, ' + document.images[i].id.substr(iPrefixLength) + ')" onmouseover="' + this.opt.sBackReference + '.onBoxHover(this, true)" onmouseout="' + this.opt.sBackReference + '.onBoxHover(this, false)" style="background: ' + this.opt.sBoxBackground + '; cursor: ' + (is_ie && !is_ie6up ? 'hand' : 'pointer') + '; padding: 3px; text-align: center;"><img src="' + document.images[i].src + '" alt="' + document.images[i].alt + '" id="' + document.images[i].id + '" style="margin: 0px; padding: ' + (is_ie ? '3px' : '3px 0px 3px 0px') + ';" /></div>');
+			setOuterHTML(document.images[i], '<div title="' + this.opt.sLabelIconList + '" onclick="' + this.opt.sBackReference + '.openPopup(this, ' + document.images[i].id.substr(iPrefixLength) + ')" onmouseover="' + this.opt.sBackReference + '.onBoxHover(this, true)" onmouseout="' + this.opt.sBackReference + '.onBoxHover(this, false)" style="background: ' + this.opt.sBoxBackground + '; cursor: pointer; padding: 3px; text-align: center;"><img src="' + document.images[i].src + '" alt="' + document.images[i].alt + '" id="' + document.images[i].id + '" style="margin: 0px; padding: ' + (is_ie ? '3px' : '3px 0px 3px 0px') + ';"></div>');
 }
 
 // Event for the mouse hovering over the original icon.
@@ -1145,28 +1205,22 @@
 		this.oContainerDiv = document.createElement('div');
 		this.oContainerDiv.id = 'iconList';
 		this.oContainerDiv.style.display = 'none';
-		this.oContainerDiv.style.cursor = is_ie && !is_ie6up ? 'hand' : 'pointer';
+		this.oContainerDiv.style.cursor = 'pointer';
 		this.oContainerDiv.style.position = 'absolute';
-		this.oContainerDiv.style.width = oDiv.offsetWidth + 'px';
 		this.oContainerDiv.style.background = this.opt.sContainerBackground;
 		this.oContainerDiv.style.border = this.opt.sContainerBorder;
-		this.oContainerDiv.style.padding = '1px';
-		this.oContainerDiv.style.textAlign = 'center';
+		this.oContainerDiv.style.padding = '6px 0px';
 		document.body.appendChild(this.oContainerDiv);
 
 		// Start to fetch its contents.
 		ajax_indicator(true);
-		this.tmpMethod = getXMLDocument;
-		this.tmpMethod(smf_prepareScriptUrl(this.opt.sScriptUrl) + 'action=xmlhttp;sa=messageicons;board=' + this.opt.iBoardId + ';xml', this.onIconsReceived);
-		delete this.tmpMethod;
+		sendXMLDocument.call(this, smf_prepareScriptUrl(smf_scripturl) + 'action=xmlhttp;sa=messageicons;board=' + this.opt.iBoardId + ';xml', '', this.onIconsReceived);
 
 		createEventListener(document.body);
 	}
 
 	// Set the position of the container.
 	var aPos = smf_itemPos(oDiv);
-	if (is_ie50)
-		aPos[1] += 4;
 
 	this.oContainerDiv.style.top = (aPos[1] + oDiv.offsetHeight) + 'px';
 	this.oContainerDiv.style.left = (aPos[0] - 1) + 'px';
@@ -1185,7 +1239,7 @@
 	var sItems = '';
 
 	for (var i = 0, n = icons.length; i < n; i++)
-		sItems += '<div onmouseover="' + this.opt.sBackReference + '.onItemHover(this, true)" onmouseout="' + this.opt.sBackReference + '.onItemHover(this, false);" onmousedown="' + this.opt.sBackReference + '.onItemMouseDown(this, \'' + icons[i].getAttribute('value') + '\');" style="padding: 3px 0px 3px 0px; margin-left: auto; margin-right: auto; border: ' + this.opt.sItemBorder + '; background: ' + this.opt.sItemBackground + '"><img src="' + icons[i].getAttribute('url') + '" alt="' + icons[i].getAttribute('name') + '" title="' + icons[i].firstChild.nodeValue + '" /></div>';
+		sItems += '<span onmouseover="' + this.opt.sBackReference + '.onItemHover(this, true)" onmouseout="' + this.opt.sBackReference + '.onItemHover(this, false);" onmousedown="' + this.opt.sBackReference + '.onItemMouseDown(this, \'' + icons[i].getAttribute('value') + '\');" style="padding: 2px 3px; line-height: 20px; border: ' + this.opt.sItemBorder + '; background: ' + this.opt.sItemBackground + '"><img src="' + icons[i].getAttribute('url') + '" alt="' + icons[i].getAttribute('name') + '" title="' + icons[i].firstChild.nodeValue + '" style="vertical-align: middle"></span>';
 
 	setInnerHTML(this.oContainerDiv, sItems);
 	this.oContainerDiv.style.display = 'block';
@@ -1217,7 +1271,7 @@
 	{
 		ajax_indicator(true);
 		this.tmpMethod = getXMLDocument;
-		var oXMLDoc = this.tmpMethod(smf_prepareScriptUrl(this.opt.sScriptUrl) + 'action=jsmodify;topic=' + this.opt.iTopicId + ';msg=' + this.iCurMessageId + ';' + this.opt.sSessionVar + '=' + this.opt.sSessionId + ';icon=' + sNewIcon + ';xml');
+		var oXMLDoc = this.tmpMethod(smf_prepareScriptUrl(smf_scripturl) + 'action=jsmodify;topic=' + this.opt.iTopicId + ';msg=' + this.iCurMessageId + ';' + smf_session_var + '=' + smf_session_id + ';icon=' + sNewIcon + ';xml');
 		delete this.tmpMethod;
 		ajax_indicator(false);
 
@@ -1333,7 +1387,7 @@
 
 function smfFooterHighlight(element, value)
 {
-	element.src = smf_images_url + '/' + (value ? 'h_' : '') + element.id + '.gif';
+	element.src = smf_images_url + '/' + (value ? 'h_' : '') + element.id + '.png';
 }
 
 // Get the text in a code tag.
@@ -1410,3 +1464,153 @@
 		document.getElementById(idElement).type = 'file';
 	}
 }
+
+function applyWindowClasses(oList)
+{
+	var bAlternate = false;
+	oListItems = oList.getElementsByTagName("LI");
+	for (i = 0; i < oListItems.length; i++)
+	{
+		// Skip dummies.
+		if (oListItems[i].id == "")
+			continue;
+		oListItems[i].className = "windowbg" + (bAlternate ? "2" : "");
+		bAlternate = !bAlternate;
+	}
+}
+
+function reActivate()
+{
+	document.forms.postmodify.message.readOnly = false;
+}
+
+// The actual message icon selector.
+function showimage()
+{
+	document.images.icons.src = icon_urls[document.forms.postmodify.icon.options[document.forms.postmodify.icon.selectedIndex].value];
+}
+
+function pollOptions()
+{
+	var expire_time = document.getElementById('poll_expire');
+
+	if (isEmptyText(expire_time) || expire_time.value == 0)
+	{
+		document.forms.postmodify.poll_hide[2].disabled = true;
+		if (document.forms.postmodify.poll_hide[2].checked)
+			document.forms.postmodify.poll_hide[1].checked = true;
+	}
+	else
+		document.forms.postmodify.poll_hide[2].disabled = false;
+}
+
+function generateDays(offset)
+{
+	// Work around JavaScript's lack of support for default values...
+	offset = typeof(offset) != 'undefined' ? offset : '';
+
+	var days = 0, selected = 0;
+	var dayElement = document.getElementById("day" + offset), yearElement = document.getElementById("year" + offset), monthElement = document.getElementById("month" + offset);
+
+	var monthLength = [
+		31, 28, 31, 30,
+		31, 30, 31, 31,
+		30, 31, 30, 31
+	];
+	if (yearElement.options[yearElement.selectedIndex].value % 4 == 0)
+		monthLength[1] = 29;
+
+	selected = dayElement.selectedIndex;
+	while (dayElement.options.length)
+		dayElement.options[0] = null;
+
+	days = monthLength[monthElement.value - 1];
+
+	for (i = 1; i <= days; i++)
+		dayElement.options[dayElement.length] = new Option(i, i);
+
+	if (selected < days)
+		dayElement.selectedIndex = selected;
+}
+
+function toggleLinked(form)
+{
+	form.board.disabled = !form.link_to_board.checked;
+}
+
+function initSearch()
+{
+	if (document.forms.searchform.search.value.indexOf("%u") != -1)
+		document.forms.searchform.search.value = unescape(document.forms.searchform.search.value);
+}
+
+function selectBoards(ids, aFormID)
+{
+	var toggle = true;
+	var aForm = document.getElementById(aFormID);
+
+	for (i = 0; i < ids.length; i++)
+		toggle = toggle & aForm["brd" + ids[i]].checked;
+
+	for (i = 0; i < ids.length; i++)
+		aForm["brd" + ids[i]].checked = !toggle;
+}
+
+function updateRuleDef(optNum)
+{
+	if (document.getElementById("ruletype" + optNum).value == "gid")
+	{
+		document.getElementById("defdiv" + optNum).style.display = "none";
+		document.getElementById("defseldiv" + optNum).style.display = "";
+	}
+	else if (document.getElementById("ruletype" + optNum).value == "bud" || document.getElementById("ruletype" + optNum).value == "")
+	{
+		document.getElementById("defdiv" + optNum).style.display = "none";
+		document.getElementById("defseldiv" + optNum).style.display = "none";
+	}
+	else
+	{
+		document.getElementById("defdiv" + optNum).style.display = "";
+		document.getElementById("defseldiv" + optNum).style.display = "none";
+	}
+}
+
+function updateActionDef(optNum)
+{
+	if (document.getElementById("acttype" + optNum).value == "lab")
+	{
+		document.getElementById("labdiv" + optNum).style.display = "";
+	}
+	else
+	{
+		document.getElementById("labdiv" + optNum).style.display = "none";
+	}
+}
+
+$(function()
+{
+	$('.buttonlist > .dropmenu').each(function(index, item)
+	{
+		$(item).prev().click(function(e)
+		{
+			e.stopPropagation();
+			e.preventDefault();
+
+			if ($(item).is(':visible'))
+			{
+				$(item).css('display', 'none');
+
+				return true;
+			}
+
+			$(item).css('display', 'block');
+			$(item).css('top', $(this).offset().top + $(this).height());
+			$(item).css('left', Math.max($(this).offset().left - $(item).width() + $(this).outerWidth(), 0));
+			$(item).height($(item).find('div:first').height());
+		});
+		$(document).click(function()
+		{
+			$(item).css('display', 'none');
+		});
+	});
+})
Only in a/Themes/default/scripts: sha1.js
Only in b/Themes/default/scripts: slippry.min.js
Only in b/Themes/default/scripts: smf_jquery_plugins.js
diff -ru a/Themes/default/scripts/spellcheck.js b/Themes/default/scripts/spellcheck.js
--- a/Themes/default/scripts/spellcheck.js	2010-09-24 08:04:08.000000000 -0700
+++ b/Themes/default/scripts/spellcheck.js	2015-03-05 23:30:06.034678866 -0800
@@ -18,7 +18,7 @@
 	var aWordCharacters = ['-', '\''];
 
 	var aWords = new Array(), aResult = new Array();
-	var sText = document.forms[formName][fieldName].value;
+	var sText = $('#' + fieldName).data("sceditor").getText(false);
 	var bInCode = false;
 	var iOffset1, iOffset2;
 
@@ -185,7 +185,7 @@
 	divptr = document.getElementById("spellview");
 
 	newValue = htmlspecialchars(strstart) + '<span class="highlight" id="h1">' + misps[wordindex].word + '</span>' + htmlspecialchars(strend);
-	setInnerHTML(divptr, newValue.replace(/_\|_/g, '<br />'));
+	setInnerHTML(divptr, newValue.replace(/_\|_/g, '<br>'));
 
 	// We could use scrollIntoView, but it's just not that great anyway.
 	var spellview_height = typeof(document.getElementById("spellview").currentStyle) != "undefined" ? parseInt(document.getElementById("spellview").currentStyle.height) : document.getElementById("spellview").offsetHeight;
@@ -220,7 +220,7 @@
 	{
 		var divptr;
 		divptr = document.getElementById("spellview");
-		setInnerHTML(divptr, htmlspecialchars(mispstr).replace(/_\|_/g, "<br />"));
+		setInnerHTML(divptr, htmlspecialchars(mispstr).replace(/_\|_/g, "<br>"));
 
 		while (document.forms.spellingForm.suggestions.options.length > 0)
 			document.forms.spellingForm.suggestions.options[0] = null;
@@ -235,11 +235,7 @@
 		mispstr = mispstr.replace(/_\|_/g, "\n");
 
 		// Get a handle to the field we need to re-populate.
-		window.opener.document.forms[spell_formname][spell_fieldname].value = mispstr;
-		if (!window.opener.spellCheckDone)
-			window.opener.document.forms[spell_formname][spell_fieldname].focus();
-		else
-			window.opener.spellCheckDone();
+		window.opener.spellCheckSetText(mispstr, spell_fieldname);
 
 		window.close();
 		return true;
@@ -285,7 +281,7 @@
 {
 	thetext = thetext.replace(/\</g, "&lt;");
 	thetext = thetext.replace(/\>/g, "&gt;");
-	thetext = thetext.replace(/\n/g, "<br />");
+	thetext = thetext.replace(/\n/g, "<br>");
 	thetext = thetext.replace(/\ \ /g, " &nbsp;");
 
 	return thetext;
@@ -294,4 +290,15 @@
 function openSpellWin(width, height)
 {
 	window.open("", "spellWindow", "toolbar=no,location=no,directories=no,status=no,menubar=no,scrollbars=yes,resizable=no,width=" + width + ",height=" + height);
+}
+
+function spellCheckGetText(editorID)
+{
+	return $("#" + editorID).data("sceditor").getText(false);
+}
+function spellCheckSetText(text, editorID)
+{
+	$("#" + editorID).data("sceditor").InsertText(text, true);
+	if (!$("#" + editorID).data("sceditor").wasSource)
+		$("#" + editorID).data("sceditor").toggleTextMode();
 }
\ No newline at end of file
diff -ru a/Themes/default/scripts/stats.js b/Themes/default/scripts/stats.js
--- a/Themes/default/scripts/stats.js	2010-09-24 08:04:08.000000000 -0700
+++ b/Themes/default/scripts/stats.js	2015-03-05 23:30:06.034678866 -0800
@@ -180,10 +180,8 @@
 
 	if (oToggle.opt.aSwappableContainers.length == 0)
 	{
-		// A complicated way to call getXMLDocument, but stay in scope.
-		this.tmpMethod = getXMLDocument;
-		this.oXmlRequestHandle = this.tmpMethod(smf_prepareScriptUrl(smf_scripturl) + 'action=stats;expand=' + oToggle.opt.sMonthId + ';xml', this.onDocReceived);
-		delete this.tmpMethod;
+		// Make the xml call
+		sendXMLDocument.call(this, smf_prepareScriptUrl(smf_scripturl) + 'action=stats;expand=' + oToggle.opt.sMonthId + ';xml', '', this.onDocReceived);
 
 		if ('ajax_indicator' in window)
 			ajax_indicator(true);
@@ -219,9 +217,7 @@
 				var oCurCell = oCurRow.insertCell(-1);
 
 				if (this.opt.aDataCells[iCellIndex] == 'date')
-					oCurCell.style.paddingLeft = '6ex';
-				else
-					oCurCell.style.textAlign = 'center';
+					oCurCell.className = 'stats_day';
 
 				var sCurData = aDayNodes[iDayIndex].getAttribute(this.opt.aDataCells[iCellIndex]);
 				oCurCell.appendChild(document.createTextNode(sCurData));
diff -ru a/Themes/default/scripts/suggest.js b/Themes/default/scripts/suggest.js
--- a/Themes/default/scripts/suggest.js	2011-02-06 12:06:49.000000000 -0800
+++ b/Themes/default/scripts/suggest.js	2015-03-05 23:30:06.034678866 -0800
@@ -28,7 +28,7 @@
 	// Are there any items that should be added in advance?
 	this.aListItems = 'aListItems' in this.opt ? this.opt.aListItems : [];
 
-	this.sItemTemplate = 'sItemTemplate' in this.opt ? this.opt.sItemTemplate : '<input type="hidden" name="%post_name%[]" value="%item_id%" /><a href="%item_href%" class="extern" onclick="window.open(this.href, \'_blank\'); return false;">%item_name%</a>&nbsp;<img src="%images_url%/pm_recipient_delete.gif" alt="%delete_text%" title="%delete_text%" onclick="return %self%.deleteAddedItem(%item_id%);" />';
+	this.sItemTemplate = 'sItemTemplate' in this.opt ? this.opt.sItemTemplate : '<input type="hidden" name="%post_name%[]" value="%item_id%"><a href="%item_href%" class="extern" onclick="window.open(this.href, \'_blank\'); return false;">%item_name%</a>&nbsp;<span class="generic_icons delete" title="%delete_text%" onclick="return %self%.deleteAddedItem(%item_id%);"></span>';
 
 	this.sTextDeleteItem = 'sTextDeleteItem' in this.opt ? this.opt.sTextDeleteItem : '';
 
@@ -39,8 +39,6 @@
 	this.oHideTimer = null;
 	this.bPositionComplete = false;
 
-	this.oXmlRequestHandle = null;
-
 	// Just make sure the page is loaded before calling the init.
 	addLoadEvent(this.opt.sSelf + '.init();');
 }
@@ -614,17 +612,11 @@
 		}
 	}
 
-	// In progress means destroy!
-	if (typeof(this.oXmlRequestHandle) == 'object' && this.oXmlRequestHandle != null)
-		this.oXmlRequestHandle.abort();
-
 	// Clean the text handle.
 	sSearchString = sSearchString.php_to8bit().php_urlencode();
 
 	// Get the document.
-	this.tmpMethod = getXMLDocument;
-	this.oXmlRequestHandle = this.tmpMethod(this.sRetrieveURL.replace(/%scripturl%/g, smf_prepareScriptUrl(smf_scripturl)).replace(/%suggest_type%/g, this.opt.sSearchType).replace(/%search%/g, sSearchString).replace(/%sessionVar%/g, this.opt.sSessionVar).replace(/%sessionID%/g, this.opt.sSessionId).replace(/%time%/g, new Date().getTime()), this.onSuggestionReceived);
-	delete this.tmpMethod;
+	sendXMLDocument.call(this, this.sRetrieveURL.replace(/%scripturl%/g, smf_prepareScriptUrl(smf_scripturl)).replace(/%suggest_type%/g, this.opt.sSearchType).replace(/%search%/g, sSearchString).replace(/%sessionVar%/g, this.opt.sSessionVar).replace(/%sessionID%/g, this.opt.sSessionId).replace(/%time%/g, new Date().getTime()), '', this.onSuggestionReceived);
 
 	return true;
 }
\ No newline at end of file
diff -ru a/Themes/default/scripts/theme.js b/Themes/default/scripts/theme.js
--- a/Themes/default/scripts/theme.js	2010-09-24 08:04:08.000000000 -0700
+++ b/Themes/default/scripts/theme.js	2015-03-05 23:30:06.034678866 -0800
@@ -1,96 +1,67 @@
+$(document).ready(function() {
+	$('ul.dropmenu, ul.quickbuttons').superfish({delay : 250, speed: 100, sensitivity : 8, interval : 50, timeout : 1});
+
+	// tooltips
+	$('.preview').SMFtooltip();
+
+	// find all nested linked images and turn off the border
+	$('a.bbc_link img.bbc_img').parent().css('border', '0');
+});
+
 // The purpose of this code is to fix the height of overflow: auto blocks, because some browsers can't figure it out for themselves.
 function smf_codeBoxFix()
 {
-	var codeFix = document.getElementsByTagName('code');
-	for (var i = codeFix.length - 1; i >= 0; i--)
+	var codeFix = $('code');
+	$.each(codeFix, function(index, tag)
 	{
-		if (is_webkit && codeFix[i].offsetHeight < 20)
-			codeFix[i].style.height = (codeFix[i].offsetHeight + 20) + 'px';
+		if (is_webkit && $(tag).height() < 20)
+			$(tag).css({height: ($(tag).height + 20) + 'px'});
 
-		else if (is_ff && (codeFix[i].scrollWidth > codeFix[i].clientWidth || codeFix[i].clientWidth == 0))
-			codeFix[i].style.overflow = 'scroll';
+		else if (is_ff && ($(tag)[0].scrollWidth > $(tag).innerWidth() || $(tag).innerWidth() == 0))
+			$(tag).css({overflow: 'scroll'});
 
-		else if ('currentStyle' in codeFix[i] && codeFix[i].currentStyle.overflow == 'auto' && (codeFix[i].currentStyle.height == '' || codeFix[i].currentStyle.height == 'auto') && (codeFix[i].scrollWidth > codeFix[i].clientWidth || codeFix[i].clientWidth == 0) && (codeFix[i].offsetHeight != 0))
-			codeFix[i].style.height = (codeFix[i].offsetHeight + 24) + 'px';
-	}
+		// Holy conditional, Batman!
+		else if (
+			'currentStyle' in $(tag) && $(tag)[0].currentStyle.overflow == 'auto'
+			&& ($(tag).innerHeight() == '' || $(tag).innerHeight() == 'auto')
+			&& ($(tag)[0].scrollWidth > $(tag).innerWidth() || $(tag).innerWidth == 0)
+			&& ($(tag).outerHeight() != 0)
+		)
+			$(tag).css({height: ($(tag).height + 24) + 'px'});
+	});
 }
 
 // Add a fix for code stuff?
-if ((is_ie && !is_ie4) || is_webkit || is_ff)
+if (is_ie || is_webkit || is_ff)
 	addLoadEvent(smf_codeBoxFix);
 
 // Toggles the element height and width styles of an image.
 function smc_toggleImageDimensions()
 {
-	var oImages = document.getElementsByTagName('IMG');
-	for (oImage in oImages)
-	{
-		// Not a resized image? Skip it.
-		if (oImages[oImage].className == undefined || oImages[oImage].className.indexOf('bbc_img resized') == -1)
-			continue;
-
-		oImages[oImage].style.cursor = 'pointer';
-		oImages[oImage].onclick = function() {
-			this.style.width = this.style.height = this.style.width == 'auto' ? null : 'auto';
-		};
-	}
-}
+	var images = $('img.bbc_img');
 
-// Add a load event for the function above.
-addLoadEvent(smc_toggleImageDimensions);
-
-// Adds a button to a certain button strip.
-function smf_addButton(sButtonStripId, bUseImage, oOptions)
-{
-	var oButtonStrip = document.getElementById(sButtonStripId);
-	var aItems = oButtonStrip.getElementsByTagName('span');
-
-	// Remove the 'last' class from the last item.
-	if (aItems.length > 0)
+	$.each(images, function(key, img)
 	{
-		var oLastSpan = aItems[aItems.length - 1];
-		oLastSpan.className = oLastSpan.className.replace(/\s*last/, 'position_holder');
-	}
-
-	// Add the button.
-	var oButtonStripList = oButtonStrip.getElementsByTagName('ul')[0];
-	var oNewButton = document.createElement('li');
-	setInnerHTML(oNewButton, '<a href="' + oOptions.sUrl + '" ' + ('sCustom' in oOptions ? oOptions.sCustom : '') + '><span class="last"' + ('sId' in oOptions ? ' id="' + oOptions.sId + '"': '') + '>' + oOptions.sText + '</span></a>');
-
-	oButtonStripList.appendChild(oNewButton);
-}
-
-// Adds hover events to list items. Used for a versions of IE that don't support this by default.
-var smf_addListItemHoverEvents = function()
-{
-	var cssRule, newSelector;
-
-	// Add a rule for the list item hover event to every stylesheet.
-	for (var iStyleSheet = 0; iStyleSheet < document.styleSheets.length; iStyleSheet ++)
-		for (var iRule = 0; iRule < document.styleSheets[iStyleSheet].rules.length; iRule ++)
+		if ($(img).hasClass('resized'))
 		{
-			oCssRule = document.styleSheets[iStyleSheet].rules[iRule];
-			if (oCssRule.selectorText.indexOf('LI:hover') != -1)
+			$(img).css({cursor: 'pointer'});
+			$(img).on('click', function()
 			{
-				sNewSelector = oCssRule.selectorText.replace(/LI:hover/gi, 'LI.iehover');
-				document.styleSheets[iStyleSheet].addRule(sNewSelector, oCssRule.style.cssText);
-			}
+				var size = $(this)[0].style.width == 'auto' ? '' : 'auto';
+				$(this).css({width: size, height: size});
+			});
 		}
-
-	// Now add handling for these hover events.
-	var oListItems = document.getElementsByTagName('LI');
-	for (oListItem in oListItems)
-	{
-		oListItems[oListItem].onmouseover = function() {
-			this.className += ' iehover';
-		};
-
-		oListItems[oListItem].onmouseout = function() {
-			this.className = this.className.replace(new RegExp(' iehover\\b'), '');
-		};
-	}
+	});
 }
 
-// Add hover events to list items if the browser requires it.
-if (is_ie7down && 'attachEvent' in window)
-	window.attachEvent('onload', smf_addListItemHoverEvents);
+// Add a load event for the function above.
+addLoadEvent(smc_toggleImageDimensions);
+
+function smf_addButton(stripId, image, options)
+{
+	$('#' + stripId).append(
+		'<a href="' + options.sUrl + '" class="button last" ' + ('sCustom' in options ? options.sCustom : '') + ' ' + ('sId' in options ? ' id="' + options.sId + '_text"' : '') + '>'
+			+ options.sText +
+		'</a>'
+	);
+}
\ No newline at end of file
diff -ru a/Themes/default/scripts/topic.js b/Themes/default/scripts/topic.js
--- a/Themes/default/scripts/topic.js	2011-05-13 05:44:25.000000000 -0700
+++ b/Themes/default/scripts/topic.js	2015-03-05 23:30:06.034678866 -0800
@@ -1,66 +1,134 @@
-var cur_topic_id, cur_msg_id, buff_subject, cur_subject_div, in_edit_mode = 0;
-var hide_prefixes = Array();
+// *** QuickModifyTopic object.
+function QuickModifyTopic(oOptions)
+{
+	this.opt = oOptions;
+	this.aHidePrefixes = this.opt.aHidePrefixes;
+	this.iCurTopicId = 0;
+	this.sCurMessageId = '';
+	this.sBuffSubject = '';
+	this.oCurSubjectDiv = null;
+	this.oTopicModHandle = document;
+	this.bInEditMode = false;
+	this.bMouseOnDiv = false;
+	this.bXmlHttpCapable = this.isXmlHttpCapable();
+	this.init();
+}
 
-function modify_topic(topic_id, first_msg_id)
+// @todo Determine if this is even needed anymore opera meh
+// Ajax supported?
+QuickModifyTopic.prototype.isXmlHttpCapable = function ()
 {
-	if (!('XMLHttpRequest' in window))
-		return;
+	if (typeof(window.XMLHttpRequest) == 'undefined')
+		return false;
 
+	// Opera didn't always support POST requests. So test it first.
 	if ('opera' in window)
 	{
 		var oTest = new XMLHttpRequest();
 		if (!('setRequestHeader' in oTest))
-			return;
+			return false;
 	}
 
+	return true;
+}
+
+// Used to initialise the object event handlers
+QuickModifyTopic.prototype.init = function ()
+{
+	// Attach some events to it so we can respond to actions
+	this.oTopicModHandle.instanceRef = this;
+
+	// detect and act on keypress
+	this.oTopicModHandle.onkeydown = function (oEvent) {return this.instanceRef.modify_topic_keypress(oEvent);};
+
+	// Used to detect when we've stopped editing.
+	this.oTopicModHandle.onclick = function (oEvent) {return this.instanceRef.modify_topic_click(oEvent);};
+}
+
+// called from the double click in the div
+QuickModifyTopic.prototype.modify_topic = function (topic_id, first_msg_id)
+{
 	// Add backwards compatibility with old themes.
 	if (typeof(cur_session_var) == 'undefined')
 		cur_session_var = 'sesc';
 
-	if (in_edit_mode == 1)
+	// already editing
+	if (this.bInEditMode)
 	{
-		if (cur_topic_id == topic_id)
+		// same message then just return, otherwise drop out of this edit.
+		if (this.iCurTopicId == topic_id)
 			return;
 		else
-			modify_topic_cancel();
+			this.modify_topic_cancel();
 	}
 
-	in_edit_mode = 1;
-	mouse_on_div = 1;
-	cur_topic_id = topic_id;
+	this.bInEditMode = true;
+	this.bMouseOnDiv = true;
+	this.iCurTopicId = topic_id;
 
-	if (typeof window.ajax_indicator == "function")
-		ajax_indicator(true);
-	getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + "action=quotefast;quote=" + first_msg_id + ";modify;xml", onDocReceived_modify_topic);
+	// Get the topics current subject
+	ajax_indicator(true);
+	sendXMLDocument.call(this, smf_prepareScriptUrl(smf_scripturl) + "action=quotefast;quote=" + first_msg_id + ";modify;xml", '', this.onDocReceived_modify_topic);
 }
 
-function onDocReceived_modify_topic(XMLDoc)
+// callback function from the modify_topic ajax call
+QuickModifyTopic.prototype.onDocReceived_modify_topic = function (XMLDoc)
 {
-	cur_msg_id = XMLDoc.getElementsByTagName("message")[0].getAttribute("id");
+	// If it is not valid then clean up
+	if (!XMLDoc || !XMLDoc.getElementsByTagName('message'))
+	{
+		this.modify_topic_cancel();
+		return true;
+	}
 
-	cur_subject_div = document.getElementById('msg_' + cur_msg_id.substr(4));
-	buff_subject = getInnerHTML(cur_subject_div);
+	this.sCurMessageId = XMLDoc.getElementsByTagName("message")[0].getAttribute("id");
+	this.oCurSubjectDiv = document.getElementById('msg_' + this.sCurMessageId.substr(4));
+	this.sBuffSubject = getInnerHTML(this.oCurSubjectDiv);
 
-	// Here we hide any other things they want hiding on edit.
-	set_hidden_topic_areas('none');
+	// Here we hide any other things they want hidden on edit.
+	this.set_hidden_topic_areas('none');
 
-	modify_topic_show_edit(XMLDoc.getElementsByTagName("subject")[0].childNodes[0].nodeValue);
-	if (typeof window.ajax_indicator == "function")
-		ajax_indicator(false);
+	// Show we are in edit mode and allow the edit
+	ajax_indicator(false);
+	this.modify_topic_show_edit(XMLDoc.getElementsByTagName("subject")[0].childNodes[0].nodeValue);
 }
 
-function modify_topic_cancel()
+// Cancel out of an edit and return things to back to what they were
+QuickModifyTopic.prototype.modify_topic_cancel = function ()
 {
-	setInnerHTML(cur_subject_div, buff_subject);
-	set_hidden_topic_areas('');
+	setInnerHTML(this.oCurSubjectDiv, this.sBuffSubject);
+	this.set_hidden_topic_areas('');
+	this.bInEditMode = false;
 
-	in_edit_mode = 0;
 	return false;
 }
 
-function modify_topic_save(cur_session_id, cur_session_var)
+// Simply restore/show any hidden bits during topic editing.
+QuickModifyTopic.prototype.set_hidden_topic_areas = function (set_style)
+{
+	for (var i = 0; i < this.aHidePrefixes.length; i++)
+	{
+		if (document.getElementById(this.aHidePrefixes[i] + this.sCurMessageId.substr(4)) != null)
+			document.getElementById(this.aHidePrefixes[i] + this.sCurMessageId.substr(4)).style.display = set_style;
+	}
+}
+
+// For templating, shown that an inline edit is being made.
+QuickModifyTopic.prototype.modify_topic_show_edit = function (subject)
 {
-	if (!in_edit_mode)
+	// Just template the subject.
+	setInnerHTML(this.oCurSubjectDiv, '<input type="text" name="subject" value="' + subject + '" size="60" style="width: 95%;" maxlength="80" class="input_text"><input type="hidden" name="topic" value="' + this.iCurTopicId + '"><input type="hidden" name="msg" value="' + this.sCurMessageId.substr(4) + '">');
+
+	// attach mouse over and out events to this new div
+	this.oCurSubjectDiv.instanceRef = this;
+	this.oCurSubjectDiv.onmouseout = function (oEvent) {return this.instanceRef.modify_topic_mouseout(oEvent);};
+	this.oCurSubjectDiv.onmouseover = function (oEvent) {return this.instanceRef.modify_topic_mouseover(oEvent);};
+}
+
+// Yup thats right, save it
+QuickModifyTopic.prototype.modify_topic_save = function (cur_session_id, cur_session_var)
+{
+	if (!this.bInEditMode)
 		return true;
 
 	// Add backwards compatibility with old themes.
@@ -72,18 +140,22 @@
 	x[x.length] = 'topic=' + parseInt(document.forms.quickModForm.elements['topic'].value);
 	x[x.length] = 'msg=' + parseInt(document.forms.quickModForm.elements['msg'].value);
 
-	if (typeof window.ajax_indicator == "function")
-		ajax_indicator(true);
-	sendXMLDocument(smf_prepareScriptUrl(smf_scripturl) + "action=jsmodify;topic=" + parseInt(document.forms.quickModForm.elements['topic'].value) + ";" + cur_session_var + "=" + cur_session_id + ";xml", x.join("&"), modify_topic_done);
+	// send in the call to save the updated topic subject
+	ajax_indicator(true);
+	sendXMLDocument.call(this, smf_prepareScriptUrl(smf_scripturl) + "action=jsmodify;topic=" + parseInt(document.forms.quickModForm.elements['topic'].value) + ";" + cur_session_var + "=" + cur_session_id + ";xml", x.join("&"), this.modify_topic_done);
 
 	return false;
 }
 
-function modify_topic_done(XMLDoc)
+// done with the edit, if all went well show the new topic title
+QuickModifyTopic.prototype.modify_topic_done = function (XMLDoc)
 {
-	if (!XMLDoc)
+	ajax_indicator(false);
+
+	// If it is not valid then clean up
+	if (!XMLDoc || !XMLDoc.getElementsByTagName('subject'))
 	{
-		modify_topic_cancel();
+		this.modify_topic_cancel();
 		return true;
 	}
 
@@ -91,38 +163,78 @@
 	var subject = message.getElementsByTagName("subject")[0];
 	var error = message.getElementsByTagName("error")[0];
 
-	if (typeof window.ajax_indicator == "function")
-		ajax_indicator(false);
+	// No subject or other error?
 
 	if (!subject || error)
 		return false;
 
-	subjectText = subject.childNodes[0].nodeValue;
-
-	modify_topic_hide_edit(subjectText);
-
-	set_hidden_topic_areas('');
+	this.modify_topic_hide_edit(subject.childNodes[0].nodeValue);
+	this.set_hidden_topic_areas('');
+	this.bInEditMode = false;
 
-	in_edit_mode = 0;
+	// redo tips if they are on since we just pulled the rug out on this one
+	if ($.isFunction($.fn.SMFtooltip));
+		$('.preview').SMFtooltip().smf_tooltip_off;
 
 	return false;
 }
 
-// Simply restore any hidden bits during topic editing.
-function set_hidden_topic_areas(set_style)
+// Done with the edit, put in new subject and link.
+QuickModifyTopic.prototype.modify_topic_hide_edit = function (subject)
+{
+	// Re-template the subject!
+	setInnerHTML(this.oCurSubjectDiv, '<a href="' + smf_scripturl + '?topic=' + this.iCurTopicId + '.0">' + subject + '<' +'/a>');
+}
+
+// keypress event ... like enter or escape
+QuickModifyTopic.prototype.modify_topic_keypress = function (oEvent)
 {
-	for (var i = 0; i < hide_prefixes.length; i++)
+	if (typeof(oEvent.keyCode) != "undefined" && this.bInEditMode)
 	{
-		if (document.getElementById(hide_prefixes[i] + cur_msg_id.substr(4)) != null)
-			document.getElementById(hide_prefixes[i] + cur_msg_id.substr(4)).style.display = set_style;
+		if (oEvent.keyCode == 27)
+		{
+			this.modify_topic_cancel();
+			if (typeof(oEvent.preventDefault) == "undefined")
+				oEvent.returnValue = false;
+			else
+				oEvent.preventDefault();
+		}
+		else if (oEvent.keyCode == 13)
+		{
+			this.modify_topic_save(smf_session_id, smf_session_var);
+			if (typeof(oEvent.preventDefault) == "undefined")
+				oEvent.returnValue = false;
+			else
+				oEvent.preventDefault();
+		}
 	}
 }
 
+// A click event to signal the finish of the edit
+QuickModifyTopic.prototype.modify_topic_click = function (oEvent)
+{
+	if (this.bInEditMode && !this.bMouseOnDiv)
+		this.modify_topic_save(smf_session_id, smf_session_var);
+}
+
+// Moved out of the editing div
+QuickModifyTopic.prototype.modify_topic_mouseout = function (oEvent)
+{
+	this.bMouseOnDiv = false;
+}
+
+// Moved back over the editing div
+QuickModifyTopic.prototype.modify_topic_mouseover = function (oEvent)
+{
+	this.bMouseOnDiv = true;
+}
+
 // *** QuickReply object.
 function QuickReply(oOptions)
 {
 	this.opt = oOptions;
 	this.bCollapsed = this.opt.bDefaultCollapsed;
+	this.bIsFull = this.opt.bIsFull;
 }
 
 // When a user presses quote, put it in the quick reply box (if expanded).
@@ -143,7 +255,10 @@
 		if (window.XMLHttpRequest)
 		{
 			ajax_indicator(true);
-			getXMLDocument(smf_prepareScriptUrl(this.opt.sScriptUrl) + 'action=quotefast;quote=' + iMessageId + ';xml', this.onQuoteReceived);
+			if (this.bIsFull)
+				insertQuoteFast(iMessageId);
+			else
+				getXMLDocument(smf_prepareScriptUrl(this.opt.sScriptUrl) + 'action=quotefast;quote=' + iMessageId + ';xml', this.onQuoteReceived);
 		}
 		// Or with a smart popup!
 		else
@@ -175,8 +290,8 @@
 // The function handling the swapping of the quick reply.
 QuickReply.prototype.swap = function ()
 {
-	document.getElementById(this.opt.sImageId).src = this.opt.sImagesUrl + "/" + (this.bCollapsed ? this.opt.sImageCollapsed : this.opt.sImageExpanded);
-	document.getElementById(this.opt.sContainerId).style.display = this.bCollapsed ? '' : 'none';
+	$('#' + this.opt.sImageId).toggleClass(this.opt.sClassCollapsed + ' ' + this.opt.sClassExpanded);
+	$('#' + this.opt.sContainerId).slideToggle();
 
 	this.bCollapsed = !this.bCollapsed;
 }
@@ -192,13 +307,15 @@
 	this.sMessageBuffer = '';
 	this.sSubjectBuffer = '';
 	this.bXmlHttpCapable = this.isXmlHttpCapable();
+	this.aAccessKeys = new Array();
 
 	// Show the edit buttons
 	if (this.bXmlHttpCapable)
 	{
-		for (var i = document.images.length - 1; i >= 0; i--)
-			if (document.images[i].id.substr(0, 14) == 'modify_button_')
-				document.images[i].style.display = '';
+		var aShowQuickModify = document.getElementsByClassName(this.opt.sClassName);
+		for (var i = 0, length = aShowQuickModify.length; i < length; i++) {
+			aShowQuickModify[i].style.display = "inline";
+		}
 	}
 }
 
@@ -220,7 +337,7 @@
 }
 
 // Function called when a user presses the edit button.
-QuickModify.prototype.modifyMsg = function (iMessageId)
+QuickModify.prototype.modifyMsg = function (iMessageId, blnShowSubject)
 {
 	if (!this.bXmlHttpCapable)
 		return;
@@ -229,6 +346,23 @@
 	if (typeof(sSessionVar) == 'undefined')
 		sSessionVar = 'sesc';
 
+	// Removes the accesskeys from the quickreply inputs and saves them in an array to use them later
+	if (typeof(this.opt.sFormRemoveAccessKeys) != 'undefined')
+	{
+		if (typeof(document.forms[this.opt.sFormRemoveAccessKeys]))
+		{
+			var aInputs = document.forms[this.opt.sFormRemoveAccessKeys].getElementsByTagName('input');
+			for (var i = 0; i < aInputs.length; i++)
+			{
+				if (aInputs[i].accessKey != '')
+				{
+					this.aAccessKeys[aInputs[i].name] = aInputs[i].accessKey;
+					aInputs[i].accessKey = '';
+				}
+			}
+		}
+	}
+
 	// First cancel if there's another message still being edited.
 	if (this.bInEditMode)
 		this.modifyCancel();
@@ -236,13 +370,12 @@
 	// At least NOW we're in edit mode
 	this.bInEditMode = true;
 
+	// Keep track of whether we want to show the subject
+	this.opt.bShowSubject = blnShowSubject;
+
 	// Send out the XMLhttp request to get more info
 	ajax_indicator(true);
-
-	// For IE 5.0 support, 'call' is not yet used.
-	this.tmpMethod = getXMLDocument;
-	this.tmpMethod(smf_prepareScriptUrl(this.opt.sScriptUrl) + 'action=quotefast;quote=' + iMessageId + ';modify;xml', this.onMessageReceived);
-	delete this.tmpMethod;
+	sendXMLDocument.call(this, smf_prepareScriptUrl(smf_scripturl) + 'action=quotefast;quote=' + iMessageId + ';modify;xml', '', this.onMessageReceived);
 }
 
 // The callback function used for the XMLhttp request retrieving the message.
@@ -295,6 +428,22 @@
 	// No longer in edit mode, that's right.
 	this.bInEditMode = false;
 
+	// Let's put back the accesskeys to their original place
+	if (typeof(this.opt.sFormRemoveAccessKeys) != 'undefined')
+	{
+		if (typeof(document.forms[this.opt.sFormRemoveAccessKeys]))
+		{
+			var aInputs = document.forms[this.opt.sFormRemoveAccessKeys].getElementsByTagName('input');
+			for (var i = 0; i < aInputs.length; i++)
+			{
+				if (typeof(this.aAccessKeys[aInputs[i].name]) != 'undefined')
+				{
+					aInputs[i].name = this.aAccessKeys[aInputs[i].name];
+				}
+			}
+		}
+	}
+
 	return false;
 }
 
@@ -309,6 +458,23 @@
 	if (typeof(sSessionVar) == 'undefined')
 		sSessionVar = 'sesc';
 
+	// Let's put back the accesskeys to their original place
+	if (typeof(this.opt.sFormRemoveAccessKeys) != 'undefined')
+	{
+		if (typeof(document.forms[this.opt.sFormRemoveAccessKeys]))
+		{
+			var aInputs = document.forms[this.opt.sFormRemoveAccessKeys].getElementsByTagName('input');
+			for (var i = 0; i < aInputs.length; i++)
+			{
+				if (typeof(this.aAccessKeys[aInputs[i].name]) != 'undefined')
+				{
+					aInputs[i].name = this.aAccessKeys[aInputs[i].name];
+				}
+			}
+		}
+	}
+
+
 	var i, x = new Array();
 	x[x.length] = 'subject=' + escape(document.forms.quickModForm['subject'].value.replace(/&#/g, "&#38;#").php_to8bit()).replace(/\+/g, "%2B");
 	x[x.length] = 'message=' + escape(document.forms.quickModForm['message'].value.replace(/&#/g, "&#38;#").php_to8bit()).replace(/\+/g, "%2B");
@@ -317,7 +483,7 @@
 
 	// Send in the XMLhttp request and let's hope for the best.
 	ajax_indicator(true);
-	sendXMLDocument.call(this, smf_prepareScriptUrl(this.opt.sScriptUrl) + "action=jsmodify;topic=" + this.opt.iTopicId + ";" + sSessionVar + "=" + sSessionId + ";xml", x.join("&"), this.onModifyDone);
+	sendXMLDocument.call(this, smf_prepareScriptUrl(this.opt.sScriptUrl) + "action=jsmodify;topic=" + this.opt.iTopicId + ";" + smf_session_var + "=" + smf_session_id + ";xml", x.join("&"), this.onModifyDone);
 
 	return false;
 }
@@ -353,15 +519,16 @@
 		this.sMessageBuffer = this.opt.sTemplateBodyNormal.replace(/%body%/, bodyText.replace(/\$/g, '{&dollarfix;$}')).replace(/\{&dollarfix;\$\}/g,'$');
 		setInnerHTML(this.oCurMessageDiv, this.sMessageBuffer);
 
-		// Show new subject.
+		// Show new subject, but only if we want to...
 		var oSubject = message.getElementsByTagName('subject')[0];
-		var sSubjectText = oSubject.childNodes[0].nodeValue.replace(/\$/g, '{&dollarfix;$}');
+		var sSubjectText = this.opt.bshowSubject ? oSubject.childNodes[0].nodeValue.replace(/\$/g, '{&dollarfix;$}') : '';
+		var sTopSubjectText = oSubject.childNodes[0].nodeValue.replace(/\$/g, '{&dollarfix;$}');
 		this.sSubjectBuffer = this.opt.sTemplateSubjectNormal.replace(/%msg_id%/g, this.sCurMessageId.substr(4)).replace(/%subject%/, sSubjectText).replace(/\{&dollarfix;\$\}/g,'$');
 		setInnerHTML(this.oCurSubjectDiv, this.sSubjectBuffer);
 
 		// If this is the first message, also update the topic subject.
 		if (oSubject.getAttribute('is_first') == '1')
-			setInnerHTML(document.getElementById('top_subject'), this.opt.sTemplateTopSubject.replace(/%subject%/, sSubjectText).replace(/\{&dollarfix;\$\}/g, '$'));
+			setInnerHTML(document.getElementById('top_subject'), this.opt.sTemplateTopSubject.replace(/%subject%/, sTopSubjectText).replace(/\{&dollarfix;\$\}/g, '$'));
 
 		// Show this message as 'modified on x by y'.
 		if (this.opt.bShowModify)
@@ -424,7 +591,7 @@
 		else
 		{
 			var oNewDiv = document.createElement('div');
-			var oNewList = document.createElement('ul');
+			var oNewList = document.createElement('a');
 
 			oNewDiv.id = this.opt.sButtonStripDisplay;
 			oNewDiv.className = this.opt.sButtonStripClass ? this.opt.sButtonStripClass : 'buttonlist floatbottom';
@@ -453,6 +620,16 @@
 				sCustom: ' onclick="return ' + this.opt.sSelf + '.handleSubmit(\'restore\')"'
 			});
 
+		// Add the 'split selected items' button.
+		if (this.opt.bCanSplit)
+			smf_addButton(this.opt.sButtonStrip, this.opt.bUseImageButton, {
+				sId: this.opt.sSelf + '_split_button',
+				sText: this.opt.sSplitButtonLabel,
+				sImage: this.opt.sSplitButtonImage,
+				sUrl: '#',
+				sCustom: ' onclick="return ' + this.opt.sSelf + '.handleSubmit(\'split\')"'
+			});
+
 		// Adding these buttons once should be enough.
 		this.bButtonsShown = true;
 	}
@@ -463,31 +640,24 @@
 	// Show the number of messages selected in the button.
 	if (this.opt.bCanRemove && !this.opt.bUseImageButton)
 	{
-		setInnerHTML(document.getElementById(this.opt.sSelf + '_remove_button'), this.opt.sRemoveButtonLabel + ' [' + this.iNumSelected + ']');
-		document.getElementById(this.opt.sSelf + '_remove_button').style.display = this.iNumSelected < 1 ? "none" : "";
+		setInnerHTML(document.getElementById(this.opt.sSelf + '_remove_button_text'), this.opt.sRemoveButtonLabel + ' [' + this.iNumSelected + ']');
+		document.getElementById(this.opt.sSelf + '_remove_button_text').style.display = this.iNumSelected < 1 ? "none" : "";
 	}
 
 	if (this.opt.bCanRestore && !this.opt.bUseImageButton)
 	{
-		setInnerHTML(document.getElementById(this.opt.sSelf + '_restore_button'), this.opt.sRestoreButtonLabel + ' [' + this.iNumSelected + ']');
-		document.getElementById(this.opt.sSelf + '_restore_button').style.display = this.iNumSelected < 1 ? "none" : "";
+		setInnerHTML(document.getElementById(this.opt.sSelf + '_restore_button_text'), this.opt.sRestoreButtonLabel + ' [' + this.iNumSelected + ']');
+		document.getElementById(this.opt.sSelf + '_restore_button_text').style.display = this.iNumSelected < 1 ? "none" : "";
 	}
 
-	// Try to restore the correct position.
-	var aItems = document.getElementById(this.opt.sButtonStrip).getElementsByTagName('span');
-	if (aItems.length > 3)
+	if (this.opt.bCanSplit && !this.opt.bUseImageButton)
 	{
-		if (this.iNumSelected < 1)
-		{
-			aItems[aItems.length - 3].className = aItems[aItems.length - 3].className.replace(/\s*position_holder/, 'last');
-			aItems[aItems.length - 2].className = aItems[aItems.length - 2].className.replace(/\s*position_holder/, 'last');
-		}
-		else
-		{
-			aItems[aItems.length - 2].className = aItems[aItems.length - 2].className.replace(/\s*last/, 'position_holder');
-			aItems[aItems.length - 3].className = aItems[aItems.length - 3].className.replace(/\s*last/, 'position_holder');
-		}
+		setInnerHTML(document.getElementById(this.opt.sSelf + '_split_button_text'), this.opt.sSplitButtonLabel + ' [' + this.iNumSelected + ']');
+		document.getElementById(this.opt.sSelf + '_split_button_text').style.display = this.iNumSelected < 1 ? "none" : "";
 	}
+
+	if(typeof smf_fixButtonClass == 'function')
+		smf_fixButtonClass(this.opt.sButtonStrip);
 }
 
 InTopicModeration.prototype.handleSubmit = function (sSubmitType)
@@ -507,6 +677,7 @@
 			if (!confirm(this.opt.sRemoveButtonConfirm))
 				return false;
 
+			oForm.action = oForm.action.replace(/;split_selection=1/, '');
 			oForm.action = oForm.action.replace(/;restore_selected=1/, '');
 		break;
 
@@ -514,9 +685,18 @@
 			if (!confirm(this.opt.sRestoreButtonConfirm))
 				return false;
 
+			oForm.action = oForm.action.replace(/;split_selection=1/, '');
 			oForm.action = oForm.action + ';restore_selected=1';
 		break;
 
+		case 'split':
+			if (!confirm(this.opt.sRestoreButtonConfirm))
+				return false;
+
+			oForm.action = oForm.action.replace(/;restore_selected=1/, '');
+			oForm.action = oForm.action + ';split_selection=1';
+		break;
+
 		default:
 			return false;
 		break;
@@ -532,10 +712,98 @@
 {
 	var img = document.getElementById('thumb_' + thumbID);
 	var link = document.getElementById('link_' + thumbID);
-	var tmp = img.src;
+
+	// save the currently displayed image attributes
+	var tmp_src = img.src;
+	var tmp_height = img.style.height;
+	var tmp_width = img.style.width;
+
+	// set the displayed image attributes to the link attributes, this will expand in place
 	img.src = link.href;
-	link.href = tmp;
-	img.style.width = '';
-	img.style.height = '';
+	img.style.width = link.style.width;
+	img.style.height = link.style.height;
+
+	// place the image attributes back
+	link.href = tmp_src;
+	link.style.width = tmp_width;
+	link.style.height = tmp_height;
+
 	return false;
-}
\ No newline at end of file
+}
+
+function ignore_toggles(msgids, text)
+{
+	for (i = 0; i < msgids.length; i++)
+	{
+		var msgid = msgids[i];
+		new smc_Toggle({
+			bToggleEnabled: true,
+			bCurrentlyCollapsed: true,
+			aSwappableContainers: [
+				'msg_' + msgid + '_extra_info',
+				'msg_' + msgid,
+				'msg_' + msgid + '_footer',
+				'msg_' + msgid + '_quick_mod',
+				'modify_button_' + msgid,
+				'msg_' + msgid + '_signature',
+				'msg_' + msgid + '_likes'
+
+			],
+			aSwapLinks: [
+				{
+					sId: 'msg_' + msgid + '_ignored_link',
+					msgExpanded: '',
+					msgCollapsed: text
+				}
+			]
+		});
+	}
+}
+
+// Likes count for messages.
+$(function() {
+	$(document).on('click', '.like_count a', function(e){
+		e.preventDefault();
+		var title = $(this).parent().text(),
+			url = $(this).attr('href') + ';js=1';
+		return reqOverlayDiv(url, title);
+	});
+});
+
+// Message likes.
+$(function() {
+	$(document).on('click', '.msg_like', function(event){
+		var obj = $(this);
+		event.preventDefault();
+		ajax_indicator(true);
+		$.ajax({
+			type: 'GET',
+			url: obj.attr('href') + ';js=1;',
+			cache: false,
+			dataType: 'html',
+			success: function(html)
+			{
+				ajax_indicator(false);
+				obj.closest('ul').replaceWith(html);
+			},
+			error: function (html)
+			{
+				ajax_indicator(false);
+			}
+		});
+
+		return false;
+	});
+
+	$('.button_strip_notify').next().find('a').click(function (e) {
+		var $obj = $(this);
+		e.preventDefault();
+		ajax_indicator(true);
+		$.get($obj.attr('href') + ';xml', function () {
+			ajax_indicator(false);
+			$('.button_strip_notify').text($obj.find('strong').text());
+		});
+
+		return false;
+	});
+});
\ No newline at end of file
diff -ru a/Themes/default/Search.template.php b/Themes/default/Search.template.php
--- a/Themes/default/Search.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Search.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,97 +3,68 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_main()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $txt, $scripturl, $modSettings;
 
 	echo '
 	<form action="', $scripturl, '?action=search2" method="post" accept-charset="', $context['character_set'], '" name="searchform" id="searchform">
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<span class="ie6_header floatleft">', !empty($settings['use_buttons']) ? '<img src="' . $settings['images_url'] . '/buttons/search.gif" alt="" class="icon" />' : ' ', $txt['set_parameters'], '</span>
+				<span class="generic_icons filter"></span>', $txt['set_parameters'], '
 			</h3>
 		</div>';
 
 	if (!empty($context['search_errors']))
 		echo '
-		<p id="search_error" class="error">', implode('<br />', $context['search_errors']['messages']), '</p>';
+		<div class="errorbox">', implode('<br>', $context['search_errors']['messages']), '</div>';
 
-	// Simple Search?
-	if ($context['simple_search'])
-	{
+	if (!empty($context['search_ignored']))
 		echo '
-		<fieldset id="simple_search">
-			<span class="upperframe"><span></span></span>
-			<div class="roundframe">
-				<div id="search_term_input">
-					<strong>', $txt['search_for'], ':</strong>
-					<input type="text" name="search"', !empty($context['search_params']['search']) ? ' value="' . $context['search_params']['search'] . '"' : '', ' maxlength="', $context['search_string_limit'], '" size="40" class="input_text" />
-					', $context['require_verification'] ? '' : '&nbsp;<input type="submit" name="submit" value="' . $txt['search'] . '" class="button_submit" />
-				</div>';
-
-		if (empty($modSettings['search_simple_fulltext']))
-			echo '
-				<p class="smalltext">', $txt['search_example'], '</p>';
+		<p class="noticebox">', $txt['search_warning_ignored_word' . (count($context['search_ignored']) == 1 ? '' : 's')], ': ', implode(', ', $context['search_ignored']), '</p>';
 
-		if ($context['require_verification'])
-			echo '
-				<div class="verification>
-					<strong>', $txt['search_visual_verification_label'], ':</strong>
-					<br />', template_control_verification($context['visual_verification_id'], 'all'), '<br />
-					<input id="submit" type="submit" name="submit" value="' . $txt['search'] . '" class="button_submit" />
-				</div>';
+	echo '
+		<fieldset id="advanced_search">
+			<div class="roundframe">
+				<dl class="settings" id="search_options">
+					<dt class="righttext">
+						<strong><label for="searchfor">', $txt['search_for'], ':</label></strong>
+					</dt>
+					<dd>
+						<input type="search" name="search" id="searchfor" ', !empty($context['search_params']['search']) ? ' value="' . $context['search_params']['search'] . '"' : '', ' maxlength="', $context['search_string_limit'], '" size="40" class="input_text">';
 
+	if (empty($modSettings['search_simple_fulltext']))
 		echo '
-				<a href="', $scripturl, '?action=search;advanced" onclick="this.href += \';search=\' + escape(document.forms.searchform.search.value);">', $txt['search_advanced'], '</a>
-				<input type="hidden" name="advanced" value="0" />
-			</div>
-			<span class="lowerframe"><span></span></span>
-		</fieldset>';
-	}
+						<em class="smalltext">', $txt['search_example'], '</em>';
 
-	// Advanced search!
-	else
-	{
-		echo '
-		<fieldset id="advanced_search">
-			<span class="upperframe"><span></span></span>
-			<div class="roundframe">
-				<input type="hidden" name="advanced" value="1" />
-				<span class="enhanced">
-					<strong>', $txt['search_for'], ':</strong>
-					<input type="text" name="search"', !empty($context['search_params']['search']) ? ' value="' . $context['search_params']['search'] . '"' : '', ' maxlength="', $context['search_string_limit'], '" size="40" class="input_text" />
-					<script type="text/javascript"><!-- // --><![CDATA[
-						function initSearch()
-						{
-							if (document.forms.searchform.search.value.indexOf("%u") != -1)
-								document.forms.searchform.search.value = unescape(document.forms.searchform.search.value);
-						}
-						createEventListener(window);
-						window.addEventListener("load", initSearch, false);
-					// ]]></script>
-					<select name="searchtype">
-						<option value="1"', empty($context['search_params']['searchtype']) ? ' selected="selected"' : '', '>', $txt['all_words'], '</option>
-						<option value="2"', !empty($context['search_params']['searchtype']) ? ' selected="selected"' : '', '>', $txt['any_words'], '</option>
-					</select>
-				</span>';
-
-		if (empty($modSettings['search_simple_fulltext']))
-			echo '
-				<em class="smalltext">', $txt['search_example'], '</em>';
-
-		echo '
-				<dl id="search_options">
-					<dt>', $txt['by_user'], ':</dt>
-					<dd><input id="userspec" type="text" name="userspec" value="', empty($context['search_params']['userspec']) ? '*' : $context['search_params']['userspec'], '" size="40" class="input_text" /></dd>
-					<dt>', $txt['search_order'], ':</dt>
+	echo '
+					</dd>
+
+					<dt class="righttext"><label for="searchtype">',
+						$txt['search_match'], ':</label>
+					</dt>
+					<dd>
+						<select name="searchtype" id="searchtype">
+							<option value="1"', empty($context['search_params']['searchtype']) ? ' selected' : '', '>', $txt['all_words'], '</option>
+							<option value="2"', !empty($context['search_params']['searchtype']) ? ' selected' : '', '>', $txt['any_words'], '</option>
+						</select>
+					</dd>
+					<dt class="righttext"><label for="userspec">',
+						$txt['by_user'], ':</label>
+					</dt>
+					<dd>
+						<input id="userspec" type="text" name="userspec" value="', empty($context['search_params']['userspec']) ? '*' : $context['search_params']['userspec'], '" size="40" class="input_text">
+					</dd>
+					<dt class="righttext"><label for="sort">',
+						$txt['search_order'], ':</label>
+					</dt>
 					<dd>
 						<select id="sort" name="sort">
 							<option value="relevance|desc">', $txt['search_orderby_relevant_first'], '</option>
@@ -103,63 +74,77 @@
 							<option value="id_msg|asc">', $txt['search_orderby_old_first'], '</option>
 						</select>
 					</dd>
-					<dt class="options">', $txt['search_options'], ':</dt>
+					<dt class="righttext options">',
+						$txt['search_options'], ':
+					</dt>
 					<dd class="options">
-						<label for="show_complete"><input type="checkbox" name="show_complete" id="show_complete" value="1"', !empty($context['search_params']['show_complete']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['search_show_complete_messages'], '</label><br />
-						<label for="subject_only"><input type="checkbox" name="subject_only" id="subject_only" value="1"', !empty($context['search_params']['subject_only']) ? ' checked="checked"' : '', ' class="input_check" /> ', $txt['search_subject_only'], '</label>
+						<label for="show_complete">', $txt['search_show_complete_messages'], '
+							<input type="checkbox" name="show_complete" id="show_complete" value="1"', !empty($context['search_params']['show_complete']) ? ' checked' : '', ' class="input_check">
+						</label><br>
+						<label for="subject_only">', $txt['search_subject_only'], '
+							<input type="checkbox" name="subject_only" id="subject_only" value="1"', !empty($context['search_params']['subject_only']) ? ' checked' : '', ' class="input_check">
+						</label>
+					</dd>
+					<dt class="righttext between">',
+						$txt['search_post_age'], ':
+					</dt>
+					<dd><label for="minage">',
+						$txt['search_between'], '</label> <input type="number" name="minage" id="minage" value="', empty($context['search_params']['minage']) ? '0' : $context['search_params']['minage'], '" size="5" maxlength="4" class="input_text">&nbsp;<label for="maxage">', $txt['search_and'], '&nbsp;</label><input type="number" name="maxage" id="maxage" value="', empty($context['search_params']['maxage']) ? '9999' : $context['search_params']['maxage'], '" size="5" maxlength="4" class="input_text"> ', $txt['days_word'], '
 					</dd>
-					<dt class="between">', $txt['search_post_age'], ': </dt>
-					<dd>', $txt['search_between'], ' <input type="text" name="minage" value="', empty($context['search_params']['minage']) ? '0' : $context['search_params']['minage'], '" size="5" maxlength="4" class="input_text" />&nbsp;', $txt['search_and'], '&nbsp;<input type="text" name="maxage" value="', empty($context['search_params']['maxage']) ? '9999' : $context['search_params']['maxage'], '" size="5" maxlength="4" class="input_text" /> ', $txt['days_word'], '</dd>
-				</dl>';
+				</dl>
+				<script><!-- // --><![CDATA[
+					createEventListener(window);
+					window.addEventListener("load", initSearch, false);
+				// ]]></script>
+				<input type="hidden" name="advanced" value="1">';
 
-		// Require an image to be typed to save spamming?
-		if ($context['require_verification'])
-		{
-			echo '
+	// Require an image to be typed to save spamming?
+	if ($context['require_verification'])
+	{
+		echo '
 				<p>
 					<strong>', $txt['verification'], ':</strong>
 					', template_control_verification($context['visual_verification_id'], 'all'), '
 				</p>';
-		}
+	}
 
-		// If $context['search_params']['topic'] is set, that means we're searching just one topic.
-		if (!empty($context['search_params']['topic']))
-			echo '
+	// If $context['search_params']['topic'] is set, that means we're searching just one topic.
+	if (!empty($context['search_params']['topic']))
+		echo '
 				<p>', $txt['search_specific_topic'], ' &quot;', $context['search_topic']['link'], '&quot;.</p>
-				<input type="hidden" name="topic" value="', $context['search_topic']['id'], '" />';
+				<input type="hidden" name="topic" value="', $context['search_topic']['id'], '">';
 
-		echo '
+	echo '
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</fieldset>';
 
-		if (empty($context['search_params']['topic']))
-		{
-			echo '
+	if (empty($context['search_params']['topic']))
+	{
+		echo '
 		<fieldset class="flow_hidden">
-			<span class="upperframe"><span></span></span>
-			<div class="roundframe">
+			<div class="roundframe alt">
 				<div class="title_bar">
 					<h4 class="titlebg">
-						<a href="javascript:void(0);" onclick="expandCollapseBoards(); return false;"><img src="', $settings['images_url'], '/expand.gif" id="expandBoardsIcon" alt="" /></a> <a href="javascript:void(0);" onclick="expandCollapseBoards(); return false;"><strong>', $txt['choose_board'], '</strong></a>
+						<span id="advanced_panel_toggle" class="toggle_down floatright" style="display: none;"></span>
+						<a href="#" id="advanced_panel_link">', $txt['choose_board'], '</a>
 					</h4>
 				</div>
-				<div class="flow_auto" id="searchBoardsExpand"', $context['boards_check_all'] ? ' style="display: none;"' : '', '>
+				<div class="flow_auto" id="advanced_panel_div"', $context['boards_check_all'] ? ' style="display: none;"' : '', '>
 					<ul class="ignoreboards floatleft">';
 
-	$i = 0;
-	$limit = ceil($context['num_boards'] / 2);
-	foreach ($context['categories'] as $category)
-	{
-		echo '
+		$i = 0;
+		$limit = ceil($context['num_boards'] / 2);
+		foreach ($context['categories'] as $category)
+		{
+			echo '
 						<li class="category">
-							<a href="javascript:void(0);" onclick="selectBoards([', implode(', ', $category['child_ids']), ']); return false;">', $category['name'], '</a>
+							<a href="javascript:void(0);" onclick="selectBoards([', implode(', ', $category['child_ids']), '], \'searchform\'); return false;">', $category['name'], '</a>
 							<ul>';
 
-		foreach ($category['boards'] as $board)
-		{
-			if ($i == $limit)
-				echo '
+			foreach ($category['boards'] as $board)
+			{
+				if ($i == $limit)
+					echo '
 							</ul>
 						</li>
 					</ul>
@@ -167,62 +152,70 @@
 						<li class="category">
 							<ul>';
 
-			echo '
-								<li class="board" style="margin-', $context['right_to_left'] ? 'right' : 'left', ': ', $board['child_level'], 'em;">
-									<label for="brd', $board['id'], '"><input type="checkbox" id="brd', $board['id'], '" name="brd[', $board['id'], ']" value="', $board['id'], '"', $board['selected'] ? ' checked="checked"' : '', ' class="input_check" /> ', $board['name'], '</label>
+				echo '
+								<li class="board">
+									<label for="brd', $board['id'], '" style="margin-', $context['right_to_left'] ? 'right' : 'left', ': ', $board['child_level'], 'em;">
+										<input type="checkbox" id="brd', $board['id'], '" name="brd[', $board['id'], ']" value="', $board['id'], '"', $board['selected'] ? ' checked' : '', ' class="input_check"> ', $board['name'], '
+									</label>
 								</li>';
 
-			$i ++;
-		}
+				$i++;
+			}
 
-		echo '
+			echo '
 							</ul>
 						</li>';
-	}
+		}
 
-	echo '
+		echo '
 					</ul>
 				</div>
-				<br class="clear" />';
-
-			echo '
-				<div class="padding">
-					<input type="checkbox" name="all" id="check_all" value=""', $context['boards_check_all'] ? ' checked="checked"' : '', ' onclick="invertAll(this, this.form, \'brd\');" class="input_check floatleft" />
-					<label for="check_all" class="floatleft">', $txt['check_all'], '</label>
-					<input type="submit" name="submit" value="', $txt['search'], '" class="button_submit floatright" />
+				<br class="clear">
+				<div class="padding flow_auto">
+					<input type="checkbox" name="all" id="check_all" value=""', $context['boards_check_all'] ? ' checked' : '', ' onclick="invertAll(this, this.form, \'brd\');" class="input_check floatleft">
+					<label for="check_all" class="floatleft"><em>', $txt['check_all'], '</em></label>
+					<input type="submit" name="b_search" value="', $txt['search'], '" class="button_submit">
 				</div>
-				<br class="clear" />
 			</div>
-			<span class="lowerframe"><span></span></span>
 		</fieldset>';
-		}
 
+		echo '
+	<script><!-- // --><![CDATA[
+		var oAdvancedPanelToggle = new smc_Toggle({
+			bToggleEnabled: true,
+			bCurrentlyCollapsed: ', $context['boards_check_all'] ? 'true' : 'false', ',
+			aSwappableContainers: [
+				\'advanced_panel_div\'
+			],
+			aSwapImages: [
+				{
+					sId: \'advanced_panel_toggle\',
+					altExpanded: ', JavaScriptEscape($txt['hide']), ',
+					altCollapsed: ', JavaScriptEscape($txt['show']), '
+				}
+			],
+			aSwapLinks: [
+				{
+					sId: \'advanced_panel_link\',
+					msgExpanded: ', JavaScriptEscape($txt['choose_board']), ',
+					msgCollapsed: ', JavaScriptEscape($txt['choose_board']), '
+				}
+			]
+		});
+	// ]]></script>';
 	}
 
 	echo '
 	</form>
-
-	<script type="text/javascript"><!-- // --><![CDATA[
-		function selectBoards(ids)
-		{
-			var toggle = true;
-
-			for (i = 0; i < ids.length; i++)
-				toggle = toggle & document.forms.searchform["brd" + ids[i]].checked;
-
-			for (i = 0; i < ids.length; i++)
-				document.forms.searchform["brd" + ids[i]].checked = !toggle;
-		}
-
-		function expandCollapseBoards()
-		{
-			var current = document.getElementById("searchBoardsExpand").style.display != "none";
-
-			document.getElementById("searchBoardsExpand").style.display = current ? "none" : "";
-			document.getElementById("expandBoardsIcon").src = smf_images_url + (current ? "/expand.gif" : "/collapse.gif");
-		}';
-
-	echo '
+	<script><!-- // --><![CDATA[
+		var oAddMemberSuggest = new smc_AutoSuggest({
+			sSelf: \'oAddMemberSuggest\',
+			sSessionId: smf_session_id,
+			sSessionVar: smf_session_var,
+			sControlId: \'userspec\',
+			sSearchType: \'member\',
+			bItemList: false
+		});
 	// ]]></script>';
 }
 
@@ -230,7 +223,7 @@
 {
 	global $context, $settings, $options, $txt, $scripturl, $message;
 
-	if (isset($context['did_you_mean']) || empty($context['topics']))
+	if (isset($context['did_you_mean']) || empty($context['topics']) || !empty($context['search_ignored']))
 	{
 		echo '
 	<div id="search_results">
@@ -239,7 +232,6 @@
 				', $txt['search_adjust_query'], '
 			</h3>
 		</div>
-		<span class="upperframe"><span></span></span>
 		<div class="roundframe">';
 
 		// Did they make any typos or mistakes, perhaps?
@@ -247,29 +239,39 @@
 			echo '
 			<p>', $txt['search_did_you_mean'], ' <a href="', $scripturl, '?action=search2;params=', $context['did_you_mean_params'], '">', $context['did_you_mean'], '</a>.</p>';
 
+		if (!empty($context['search_ignored']))
+			echo '
+			<p>', $txt['search_warning_ignored_word' . (count($context['search_ignored']) == 1 ? '' : 's')], ': ', implode(', ', $context['search_ignored']), '</p>';
+
 		echo '
 			<form action="', $scripturl, '?action=search2" method="post" accept-charset="', $context['character_set'], '">
-				<strong>', $txt['search_for'], ':</strong>
-				<input type="text" name="search"', !empty($context['search_params']['search']) ? ' value="' . $context['search_params']['search'] . '"' : '', ' maxlength="', $context['search_string_limit'], '" size="40" class="input_text" />
-				<input type="submit" name="submit" value="', $txt['search_adjust_submit'], '" class="button_submit" />
-				<input type="hidden" name="searchtype" value="', !empty($context['search_params']['searchtype']) ? $context['search_params']['searchtype'] : 0, '" />
-				<input type="hidden" name="userspec" value="', !empty($context['search_params']['userspec']) ? $context['search_params']['userspec'] : '', '" />
-				<input type="hidden" name="show_complete" value="', !empty($context['search_params']['show_complete']) ? 1 : 0, '" />
-				<input type="hidden" name="subject_only" value="', !empty($context['search_params']['subject_only']) ? 1 : 0, '" />
-				<input type="hidden" name="minage" value="', !empty($context['search_params']['minage']) ? $context['search_params']['minage'] : '0', '" />
-				<input type="hidden" name="maxage" value="', !empty($context['search_params']['maxage']) ? $context['search_params']['maxage'] : '9999', '" />
-				<input type="hidden" name="sort" value="', !empty($context['search_params']['sort']) ? $context['search_params']['sort'] : 'relevance', '" />';
-
+				<dl class="settings">
+					<dt class="righttext">
+						<strong>', $txt['search_for'], ':</strong>
+					</dt>
+					<dd>
+						<input type="text" name="search"', !empty($context['search_params']['search']) ? ' value="' . $context['search_params']['search'] . '"' : '', ' maxlength="', $context['search_string_limit'], '" size="40" class="input_text">
+					</dd>
+				</dl>
+				<div class="flow_auto" >
+					<input type="submit" name="edit_search" value="', $txt['search_adjust_submit'], '" class="button_submit">
+					<input type="hidden" name="searchtype" value="', !empty($context['search_params']['searchtype']) ? $context['search_params']['searchtype'] : 0, '">
+					<input type="hidden" name="userspec" value="', !empty($context['search_params']['userspec']) ? $context['search_params']['userspec'] : '', '">
+					<input type="hidden" name="show_complete" value="', !empty($context['search_params']['show_complete']) ? 1 : 0, '">
+					<input type="hidden" name="subject_only" value="', !empty($context['search_params']['subject_only']) ? 1 : 0, '">
+					<input type="hidden" name="minage" value="', !empty($context['search_params']['minage']) ? $context['search_params']['minage'] : '0', '">
+					<input type="hidden" name="maxage" value="', !empty($context['search_params']['maxage']) ? $context['search_params']['maxage'] : '9999', '">
+					<input type="hidden" name="sort" value="', !empty($context['search_params']['sort']) ? $context['search_params']['sort'] : 'relevance', '">
+				</div>';
 		if (!empty($context['search_params']['brd']))
 			foreach ($context['search_params']['brd'] as $board_id)
 				echo '
-				<input type="hidden" name="brd[', $board_id, ']" value="', $board_id, '" />';
+				<input type="hidden" name="brd[', $board_id, ']" value="', $board_id, '">';
 
 		echo '
 			</form>
 		</div>
-		<span class="lowerframe"><span></span></span>
-	</div><br />';
+	</div><br>';
 	}
 
 	if ($context['compact'])
@@ -285,29 +287,30 @@
 				<span class="floatright">';
 					if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1)
 					echo '
-							<input type="checkbox" onclick="invertAll(this, this.form, \'topics[]\');" class="input_check" />';
+							<input type="checkbox" onclick="invertAll(this, this.form, \'topics[]\');" class="input_check">';
 				echo '
 				</span>
-				<span class="ie6_header floatleft"><img src="' . $settings['images_url'] . '/buttons/search.gif" alt="" />&nbsp;', $txt['mlist_search_results'],':&nbsp;',$context['search_params']['search'],'</span>
+				<span class="generic_icons filter"></span>&nbsp;', $txt['mlist_search_results'],':&nbsp;',$context['search_params']['search'],'
 			</h3>
-		</div>
+		</div>';
+
+		// was anything even found?
+		if (!empty($context['topics']))
+		echo'
 		<div class="pagesection">
-			<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+			<span>', $context['page_index'], '</span>
 		</div>';
+		else
+			echo '
+			<div class="roundframe">', $txt['find_no_results'], '</div>';
 
+		// while we have results to show ...
 		while ($topic = $context['get_topics']())
 		{
-			$color_class = '';
-			if ($topic['is_sticky'])
-				$color_class = 'stickybg';
-			if ($topic['is_locked'])
-				$color_class .= 'lockedbg';
 
 			echo '
-			<div class="search_results_posts">
-			<div class="', $message['alternate'] == 0 ? 'windowbg' : 'windowbg2', ' core_posts">
-				<span class="topslice"><span></span></span>
-				<div class="content flow_auto">';
+			<div class="windowbg">
+				<div class="flow_auto">';
 
 			foreach ($topic['matches'] as $message)
 			{
@@ -326,29 +329,29 @@
 					if ($options['display_quick_mod'] == 1)
 					{
 						echo '
-						<input type="checkbox" name="topics[]" value="', $topic['id'], '" class="input_check" />';
+						<input type="checkbox" name="topics[]" value="', $topic['id'], '" class="input_check">';
 					}
 					else
 					{
 						if ($topic['quick_mod']['remove'])
 							echo '
-						<a href="', $scripturl, '?action=quickmod;actions[', $topic['id'], ']=remove;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_remove.gif" width="16" alt="', $txt['remove_topic'], '" title="', $txt['remove_topic'], '" /></a>';
+						<a href="', $scripturl, '?action=quickmod;board='. $topic['board']['id']. '.0;actions%5B', $topic['id'], '%5D=remove;', $context['session_var'], '=', $context['session_id'], '" class="you_sure"><span class="generic_icons delete" title="', $txt['remove_topic'], '"></span></a>';
 
 						if ($topic['quick_mod']['lock'])
 							echo '
-						<a href="', $scripturl, '?action=quickmod;actions[', $topic['id'], ']=lock;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_lock.gif" width="16" alt="', $txt['set_lock'], '" title="', $txt['set_lock'], '" /></a>';
+						<a href="', $scripturl, '?action=quickmod;board='. $topic['board']['id']. '.0;actions%5B', $topic['id'], '%5D=lock;', $context['session_var'], '=', $context['session_id'], '" class="you_sure"><span class="generic_icons lock" title="', $topic['is_locked'] ? $txt['set_unlock'] : $txt['set_lock'], '"></span></a>';
 
 						if ($topic['quick_mod']['lock'] || $topic['quick_mod']['remove'])
 							echo '
-						<br />';
+						<br>';
 
 						if ($topic['quick_mod']['sticky'])
 							echo '
-						<a href="', $scripturl, '?action=quickmod;actions[', $topic['id'], ']=sticky;', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['quickmod_confirm'], '\');"><img src="', $settings['images_url'], '/icons/quick_sticky.gif" width="16" alt="', $txt['set_sticky'], '" title="', $txt['set_sticky'], '" /></a>';
+						<a href="', $scripturl, '?action=quickmod;board='. $topic['board']['id']. '.0;actions%5B', $topic['id'], '%5D=sticky;', $context['session_var'], '=', $context['session_id'], '" class="you_sure"><span class="generic_icons sticky" title="', $topic['is_sticky'] ? $txt['set_nonsticky'] : $txt['set_sticky'], '"></span></a>';
 
 						if ($topic['quick_mod']['move'])
 							echo '
-						<a href="', $scripturl, '?action=movetopic;topic=', $topic['id'], '.0"><img src="', $settings['images_url'], '/icons/quick_move.gif" width="16" alt="', $txt['move_topic'], '" title="', $txt['move_topic'], '" /></a>';
+						<a href="', $scripturl, '?action=movetopic;topic=', $topic['id'], '.0"><span class="generic_icons move" title="', $txt['move_topic'], '"></span></a>';
 					}
 
 					echo '
@@ -357,69 +360,52 @@
 
 				if ($message['body_highlighted'] != '')
 					echo '
-					<br class="clear" />
+					<br class="clear">
 					<div class="list_posts double_height">', $message['body_highlighted'], '</div>';
 			}
 
 			echo '
 				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-		</div>';
+			</div>';
 
 		}
 		if (!empty($context['topics']))
 		echo '
 		<div class="pagesection">
-			<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+			<span>', $context['page_index'], '</span>
 		</div>';
 
 		if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1 && !empty($context['topics']))
 		{
 			echo '
-			<div class="middletext titlebg2" style="padding: 4px;">
-				<div class="floatright">
-					<select name="qaction"', $context['can_move'] ? ' onchange="this.form.moveItTo.disabled = (this.options[this.selectedIndex].value != \'move\');"' : '', '>
-						<option value="">--------</option>', $context['can_remove'] ? '
-						<option value="remove">' . $txt['quick_mod_remove'] . '</option>' : '', $context['can_lock'] ? '
-						<option value="lock">' . $txt['quick_mod_lock'] . '</option>' : '', $context['can_sticky'] ? '
-						<option value="sticky">' . $txt['quick_mod_sticky'] . '</option>' : '',	$context['can_move'] ? '
-						<option value="move">' . $txt['quick_mod_move'] . ': </option>' : '', $context['can_merge'] ? '
-						<option value="merge">' . $txt['quick_mod_merge'] . '</option>' : '', '
-						<option value="markread">', $txt['quick_mod_markread'], '</option>
-					</select>';
+			<div style="padding: 4px;">
+				<div class="floatright flow_auto">
+					<select class="qaction" name="qaction"', $context['can_move'] ? ' onchange="this.form.move_to.disabled = (this.options[this.selectedIndex].value != \'move\');"' : '', '>
+						<option value="">--------</option>';
 
-			if ($context['can_move'])
-			{
+			foreach ($context['qmod_actions'] as $qmod_action)
+				if ($context['can_' . $qmod_action])
 					echo '
-					<select id="moveItTo" name="move_to" disabled="disabled">';
+							<option value="' . $qmod_action . '">' . $txt['quick_mod_'  . $qmod_action] . '</option>';
 
-					foreach ($context['move_to_boards'] as $category)
-					{
-						echo '
-						<optgroup label="', $category['name'], '">';
-						foreach ($category['boards'] as $board)
-								echo '
-						<option value="', $board['id'], '"', $board['selected'] ? ' selected="selected"' : '', '>', $board['child_level'] > 0 ? str_repeat('==', $board['child_level'] - 1) . '=&gt;' : '', ' ', $board['name'], '</option>';
-						echo '
-						</optgroup>';
-					}
-					echo '
+			echo '
 					</select>';
-			}
+
+			if ($context['can_move'])
+				echo '
+				<span id="quick_mod_jump_to">&nbsp;</span>';
 
 			echo '
-					<input type="hidden" name="redirect_url" value="', $scripturl . '?action=search2;params=' . $context['params'], '" />
-					<input type="submit" style="font-size: 0.8em;" value="', $txt['quick_mod_go'], '" onclick="return this.form.qaction.value != \'\' &amp;&amp; confirm(\'', $txt['quickmod_confirm'], '\');" class="button_submit" />
+					<input type="hidden" name="redirect_url" value="', $scripturl . '?action=search2;params=' . $context['params'], '">
+					<input type="submit" value="', $txt['quick_mod_go'], '" onclick="return this.form.qaction.value != \'\' &amp;&amp; confirm(\'', $txt['quickmod_confirm'], '\');" class="button_submit" style="float: none;font-size: .8em;"/>
 				</div>
-				<br class="clear" />
 			</div>';
 		}
 
 
 		if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1 && !empty($context['topics']))
 			echo '
-			<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '" />
+			<input type="hidden" name="' . $context['session_var'] . '" value="' . $context['session_id'] . '">
 		</form>';
 
 	}
@@ -428,11 +414,11 @@
 		echo '
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<span class="ie6_header floatleft"><img src="' . $settings['images_url'] . '/buttons/search.gif" alt="" />&nbsp;', $txt['mlist_search_results'],':&nbsp;',$context['search_params']['search'],'</span>
+				<span class="generic_icons filter"></span>&nbsp;', $txt['mlist_search_results'],':&nbsp;',$context['search_params']['search'],'
 			</h3>
 		</div>
 		<div class="pagesection">
-			<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+			<span>', $context['page_index'], '</span>
 		</div>';
 
 		if (empty($context['topics']))
@@ -444,65 +430,71 @@
 			foreach ($topic['matches'] as $message)
 			{
 				echo '
-			<div class="search_results_posts">
-				<div class="', $message['alternate'] == 0 ? 'windowbg' : 'windowbg2', ' core_posts">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<div class="counter">', $message['counter'], '</div>
-						<div class="topic_details">
-							<h5>', $topic['board']['link'], ' / <a href="', $scripturl, '?topic=', $topic['id'], '.', $message['start'], ';topicseen#msg', $message['id'], '">', $message['subject_highlighted'], '</a></h5>
-							<span class="smalltext">&#171;&nbsp;', $txt['message'], ' ', $txt['by'], ' <strong>', $message['member']['link'], ' </strong>', $txt['on'], '&nbsp;<em>', $message['time'], '</em>&nbsp;&#187;</span>
-						</div>
-						<div class="list_posts">', $message['body_highlighted'], '</div>';
+				<div class="windowbg">
+					<div class="counter">', $message['counter'], '</div>
+					<div class="topic_details">
+						<h5>', $topic['board']['link'], ' / <a href="', $scripturl, '?topic=', $topic['id'], '.', $message['start'], ';topicseen#msg', $message['id'], '">', $message['subject_highlighted'], '</a></h5>
+						<span class="smalltext">&#171;&nbsp;', $txt['message'], ' ', $txt['by'], ' <strong>', $message['member']['link'], ' </strong>', $txt['on'], '&nbsp;<em>', $message['time'], '</em>&nbsp;&#187;</span>
+					</div>
+					<div class="list_posts">', $message['body_highlighted'], '</div>';
 
-				if ($topic['can_reply'] || $topic['can_mark_notify'])
-					echo '
-						<div class="quickbuttons_wrap">
-							<ul class="reset smalltext quickbuttons">';
+			if ($topic['can_reply'])
+				echo '
+						<ul class="reset smalltext quickbuttons">';
 
 				// If they *can* reply?
-				if ($topic['can_reply'])
-					echo '
-								<li class="reply_button"><a href="', $scripturl . '?action=post;topic=' . $topic['id'] . '.' . $message['start'], '">', $txt['reply'], '</a></li>';
+			if ($topic['can_reply'])
+				echo '
+							<li><a href="', $scripturl . '?action=post;topic=' . $topic['id'] . '.' . $message['start'], '" class="reply_button">', $txt['reply'], '</a></li>';
 
 				// If they *can* quote?
-				if ($topic['can_quote'])
-					echo '
-								<li class="quote_button"><a href="', $scripturl . '?action=post;topic=' . $topic['id'] . '.' . $message['start'] . ';quote=' . $message['id'] . '">', $txt['quote'], '</a></li>';
-
-				// Can we request notification of topics?
-				if ($topic['can_mark_notify'])
-					echo '
-								<li class="notify_button"><a href="', $scripturl . '?action=notify;topic=' . $topic['id'] . '.' . $message['start'], '">', $txt['notify'], '</a></li>';
+			if ($topic['can_quote'])
+				echo '
+							<li><a href="', $scripturl . '?action=post;topic=' . $topic['id'] . '.' . $message['start'] . ';quote=' . $message['id'] . '" class="quote_button">', $txt['quote_action'], '</a></li>';
 
-				if ($topic['can_reply'] || $topic['can_mark_notify'])
-					echo '
-							</ul>
-						</div>';
+			if ($topic['can_reply'])
 				echo '
-						<br class="clear" />
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
-			</div>';
+						</ul>';
+			echo '
+					<br class="clear">
+				</div>';
 			}
 		}
 
 		echo '
 		<div class="pagesection">
-			<span>', $txt['pages'], ': ', $context['page_index'], '</span>
+			<span>', $context['page_index'], '</span>
 		</div>';
 	}
 
 	// Show a jump to box for easy navigation.
 	echo '
-		<br class="clear" />
+		<br class="clear">
 		<div class="smalltext righttext" id="search_jump_to">&nbsp;</div>
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[';
+
+	if (!empty($options['display_quick_mod']) && $options['display_quick_mod'] == 1 && !empty($context['topics']) && $context['can_move'])
+		echo '
+				if (typeof(window.XMLHttpRequest) != "undefined")
+					aJumpTo[aJumpTo.length] = new JumpTo({
+						sContainerId: "quick_mod_jump_to",
+						sClassName: "qaction",
+						sJumpToTemplate: "%dropdown_list%",
+						sCurBoardName: "', $context['jump_to']['board_name'], '",
+						sBoardChildLevelIndicator: "==",
+						sBoardPrefix: "=> ",
+						sCatSeparator: "-----------------------------",
+						sCatPrefix: "",
+						bNoRedirect: true,
+						bDisabled: true,
+						sCustomName: "move_to"
+					});';
+
+	echo '
 			if (typeof(window.XMLHttpRequest) != "undefined")
 				aJumpTo[aJumpTo.length] = new JumpTo({
 					sContainerId: "search_jump_to",
-					sJumpToTemplate: "<label class=\"smalltext\" for=\"%select_id%\">', $context['jump_to']['label'], ':<" + "/label> %dropdown_list%",
+					sJumpToTemplate: "<label class=\"smalltext jump_to\" for=\"%select_id%\">', $context['jump_to']['label'], '<" + "/label> %dropdown_list%",
 					iCurBoardId: 0,
 					iCurBoardChildLevel: 0,
 					sCurBoardName: "', $context['jump_to']['board_name'], '",
Only in a/Themes/default: SendTopic.template.php
diff -ru a/Themes/default/Settings.template.php b/Themes/default/Settings.template.php
--- a/Themes/default/Settings.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Settings.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,34 +3,24 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_options()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $txt;
 
 	$context['theme_options'] = array(
 		array(
-			'id' => 'show_board_desc',
-			'label' => $txt['board_desc_inside'],
-			'default' => true,
-		),
-		array(
 			'id' => 'show_children',
 			'label' => $txt['show_children'],
 			'default' => true,
 		),
 		array(
-			'id' => 'use_sidebar_menu',
-			'label' => $txt['use_sidebar_menu'],
-			'default' => true,
-		),
-		array(
 			'id' => 'show_no_avatars',
 			'label' => $txt['show_no_avatars'],
 			'default' => true,
@@ -41,21 +31,11 @@
 			'default' => true,
 		),
 		array(
-			'id' => 'show_no_censored',
-			'label' => $txt['show_no_censored'],
-			'default' => true,
-		),
-		array(
 			'id' => 'return_to_post',
 			'label' => $txt['return_to_post'],
 			'default' => true,
 		),
 		array(
-			'id' => 'no_new_reply_warning',
-			'label' => $txt['no_new_reply_warning'],
-			'default' => true,
-		),
-		array(
 			'id' => 'view_newest_first',
 			'label' => $txt['recent_posts_at_top'],
 			'default' => true,
@@ -81,11 +61,6 @@
 			'default' => true,
 		),
 		array(
-			'id' => 'copy_to_outbox',
-			'label' => $txt['copy_to_outbox'],
-			'default' => true,
-		),
-		array(
 			'id' => 'pm_remove_inbox_label',
 			'label' => $txt['pm_remove_inbox_label'],
 			'default' => true,
@@ -130,13 +105,8 @@
 			'default' => true,
 		),
 		array(
-			'id' => 'display_quick_reply',
-			'label' => $txt['display_quick_reply'],
-			'options' => array(
-				0 => $txt['display_quick_reply1'],
-				1 => $txt['display_quick_reply2'],
-				2 => $txt['display_quick_reply3']
-			),
+			'id' => 'use_editor_quick_reply',
+			'label' => $txt['use_editor_quick_reply'],
 			'default' => true,
 		),
 		array(
@@ -149,12 +119,17 @@
 			),
 			'default' => true,
 		),
+		array(
+			'id' => 'drafts_show_saved_enabled',
+			'label'  => $txt['drafts_show_saved_enabled'],
+			'default' => true,
+		)
 	);
 }
 
 function template_settings()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	$context['theme_settings'] = array(
 		array(
@@ -184,18 +159,6 @@
 		),
 	'',
 		array(
-			'id' => 'linktree_link',
-			'label' => $txt['current_pos_text_img'],
-		),
-		array(
-			'id' => 'show_mark_read',
-			'label' => $txt['enable_mark_as_read'],
-		),
-		array(
-			'id' => 'allow_no_censored',
-			'label' => $txt['allow_no_censored'],
-		),
-		array(
 			'id' => 'enable_news',
 			'label' => $txt['enable_random_news'],
 		),
@@ -212,7 +175,7 @@
 		array(
 			'id' => 'number_recent_posts',
 			'label' => $txt['number_recent_posts'],
-			'description' => $txt['number_recent_posts_desc'],
+			'description' => $txt['zero_to_disable'],
 			'type' => 'number',
 		),
 		array(
@@ -239,38 +202,10 @@
 		),
 	'',
 		array(
-			'id' => 'show_modify',
-			'label' => $txt['last_modification'],
-		),
-		array(
-			'id' => 'show_profile_buttons',
-			'label' => $txt['show_view_profile_button'],
-		),
-		array(
-			'id' => 'show_user_images',
-			'label' => $txt['user_avatars'],
-		),
-		array(
-			'id' => 'show_blurb',
-			'label' => $txt['user_text'],
-		),
-		array(
-			'id' => 'show_gender',
-			'label' => $txt['gender_images'],
-		),
-		array(
-			'id' => 'hide_post_group',
-			'label' => $txt['hide_post_group'],
-			'description' => $txt['hide_post_group_desc'],
-		),
-	'',
-		array(
-			'id' => 'show_bbc',
-			'label' => $txt['admin_bbc'],
-		),
-		array(
-			'id' => 'additional_options_collapsable',
-			'label' => $txt['additional_options_collapsable'],
+			'id' => 'og_image',
+			'label' => $txt['og_image'],
+			'description' => $txt['og_image_desc'],
+			'type' => 'text',
 		),
 	);
 }
diff -ru a/Themes/default/SplitTopics.template.php b/Themes/default/SplitTopics.template.php
--- a/Themes/default/SplitTopics.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/SplitTopics.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,56 +3,53 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_ask()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="split_topics">
 		<form action="', $scripturl, '?action=splittopics;sa=execute;topic=', $context['current_topic'], '.0" method="post" accept-charset="', $context['character_set'], '">
-			<input type="hidden" name="at" value="', $context['message']['id'], '" />
+			<input type="hidden" name="at" value="', $context['message']['id'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['split'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p class="split_topics">
-						<strong><label for="subname">', $txt['subject_new_topic'], '</label>:</strong>
-						<input type="text" name="subname" id="subname" value="', $context['message']['subject'], '" size="25" class="input_text" />
-					</p>
-					<ul class="reset split_topics">
-						<li>
-							<input type="radio" id="onlythis" name="step2" value="onlythis" checked="checked" class="input_radio" /> <label for="onlythis">', $txt['split_this_post'], '</label>
-						</li>
-						<li>
-							<input type="radio" id="afterthis" name="step2" value="afterthis" class="input_radio" /> <label for="afterthis">', $txt['split_after_and_this_post'], '</label>
-						</li>
-						<li>
-							<input type="radio" id="selective" name="step2" value="selective" class="input_radio" /> <label for="selective">', $txt['select_split_posts'], '</label>
-						</li>
-					</ul>
-					<div class="righttext">
-						<input type="submit" value="', $txt['split'], '" class="button_submit" />
-					</div>
+				<p class="split_topics">
+					<strong><label for="subname">', $txt['subject_new_topic'], '</label>:</strong>
+					<input type="text" name="subname" id="subname" value="', $context['message']['subject'], '" size="25" class="input_text">
+				</p>
+				<ul class="reset split_topics">
+					<li>
+						<input type="radio" id="onlythis" name="step2" value="onlythis" checked class="input_radio"> <label for="onlythis">', $txt['split_this_post'], '</label>
+					</li>
+					<li>
+						<input type="radio" id="afterthis" name="step2" value="afterthis" class="input_radio"> <label for="afterthis">', $txt['split_after_and_this_post'], '</label>
+					</li>
+					<li>
+						<input type="radio" id="selective" name="step2" value="selective" class="input_radio"> <label for="selective">', $txt['select_split_posts'], '</label>
+					</li>
+				</ul>
+				<hr class="hrcolor">
+				<div class="auto_flow">
+					<input type="submit" value="', $txt['split'], '" class="button_submit">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
 		</form>
 	</div>';
 }
 
 function template_main()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="split_topics">
@@ -60,29 +57,25 @@
 			<h3 class="catbg">', $txt['split'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $txt['split_successful'], '</p>
-				<ul class="reset">
-					<li>
-						<a href="', $scripturl, '?board=', $context['current_board'], '.0">', $txt['message_index'], '</a>
-					</li>
-					<li>
-						<a href="', $scripturl, '?topic=', $context['old_topic'], '.0">', $txt['origin_topic'], '</a>
-					</li>
-					<li>
-						<a href="', $scripturl, '?topic=', $context['new_topic'], '.0">', $txt['new_topic'], '</a>
-					</li>
-				</ul>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p>', $txt['split_successful'], '</p>
+			<ul class="reset">
+				<li>
+					<a href="', $scripturl, '?board=', $context['current_board'], '.0">', $txt['message_index'], '</a>
+				</li>
+				<li>
+					<a href="', $scripturl, '?topic=', $context['old_topic'], '.0">', $txt['origin_topic'], '</a>
+				</li>
+				<li>
+					<a href="', $scripturl, '?topic=', $context['new_topic'], '.0">', $txt['new_topic'], '</a>
+				</li>
+			</ul>
 		</div>
 	</div>';
 }
 
 function template_select()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<div id="split_topics">
@@ -95,27 +88,23 @@
 					', $txt['please_select_split'], '
 				</div>
 				<div class="pagesection">
-					<strong>', $txt['pages'], ':</strong> <span id="pageindex_not_selected">', $context['not_selected']['page_index'], '</span>
+					<span id="pageindex_not_selected">', $context['not_selected']['page_index'], '</span>
 				</div>
-				<ul id="messages_not_selected" class="split_messages smalltext reset">';
+				<ul id="messages_not_selected" class="split_messages smalltext">';
 
 	foreach ($context['not_selected']['messages'] as $message)
 		echo '
-					<li class="windowbg', $message['alternate'] ? '2' : '', '" id="not_selected_', $message['id'], '">
-						<span class="topslice"><span></span></span>
-						<div class="content">
-							<div class="message_header">
-								<a class="split_icon floatright" href="', $scripturl, '?action=splittopics;sa=selectTopics;subname=', $context['topic']['subject'], ';topic=', $context['topic']['id'], '.', $context['not_selected']['start'], ';start2=', $context['selected']['start'], ';move=down;msg=', $message['id'], '" onclick="return select(\'down\', ', $message['id'], ');"><img src="', $settings['images_url'], '/split_select.gif" alt="-&gt;" /></a>
-								<strong>', $message['subject'], '</strong> ', $txt['by'], ' <strong>', $message['poster'], '</strong><br />
-								<em>', $message['time'], '</em>
-							</div>
-							<div class="post">', $message['body'], '</div>
+					<li class="windowbg" id="not_selected_', $message['id'], '">
+						<div class="message_header">
+							<a class="split_icon floatright" href="', $scripturl, '?action=splittopics;sa=selectTopics;subname=', $context['topic']['subject'], ';topic=', $context['topic']['id'], '.', $context['not_selected']['start'], ';start2=', $context['selected']['start'], ';move=down;msg=', $message['id'], '" onclick="return select(\'down\', ', $message['id'], ');"><span class="generic_icons split_sel" title="-&gt;"></span></a>
+							', sprintf($txt['post_by_member'], $message['subject'], $message['poster']), '<br>
+							<em>', $message['time'], '</em>
 						</div>
-						<span class="botslice"><span></span></span>
+						<div class="post">', $message['body'], '</div>
 					</li>';
 
 	echo '
-					<li class="dummy" />
+					<li class="dummy">
 				</ul>
 			</div>
 			<div id="selected" class="floatright">
@@ -128,359 +117,106 @@
 					', $txt['split_selected_posts_desc'], '
 				</div>
 				<div class="pagesection">
-					<strong>', $txt['pages'], ':</strong> <span id="pageindex_selected">', $context['selected']['page_index'], '</span>
+					<span id="pageindex_selected">', $context['selected']['page_index'], '</span>
 				</div>
-				<ul id="messages_selected" class="split_messages smalltext reset">';
+				<ul id="messages_selected" class="split_messages smalltext">';
 
 	if (!empty($context['selected']['messages']))
 		foreach ($context['selected']['messages'] as $message)
 			echo '
-					<li class="windowbg', $message['alternate'] ? '2' : '', '" id="selected_', $message['id'], '">
-						<span class="topslice"><span></span></span>
-						<div class="content">
-							<div class="message_header">
-								<a class="split_icon floatleft" href="', $scripturl, '?action=splittopics;sa=selectTopics;subname=', $context['topic']['subject'], ';topic=', $context['topic']['id'], '.', $context['not_selected']['start'], ';start2=', $context['selected']['start'], ';move=up;msg=', $message['id'], '" onclick="return select(\'up\', ', $message['id'], ');"><img src="', $settings['images_url'], '/split_deselect.gif" alt="&lt;-" /></a>
-								<strong>', $message['subject'], '</strong> ', $txt['by'], ' <strong>', $message['poster'], '</strong><br />
-								<em>', $message['time'], '</em>
-							</div>
-							<div class="post">', $message['body'], '</div>
+					<li class="windowbg" id="selected_', $message['id'], '">
+						<div class="message_header">
+							<a class="split_icon floatleft" href="', $scripturl, '?action=splittopics;sa=selectTopics;subname=', $context['topic']['subject'], ';topic=', $context['topic']['id'], '.', $context['not_selected']['start'], ';start2=', $context['selected']['start'], ';move=up;msg=', $message['id'], '" onclick="return select(\'up\', ', $message['id'], ');"><span class="generic_icons split_desel" title="&lt;-"></span></a>
+							', sprintf($txt['post_by_member'], $message['subject'], $message['poster']), '<br>
+							<em>', $message['time'], '</em>
 						</div>
-						<span class="botslice"><span></span></span>
+						<div class="post">', $message['body'], '</div>
 					</li>';
 
 	echo '
-					<li class="dummy" />
+					<li class="dummy">
 				</ul>
 			</div>
-			<br class="clear" />
-			<p>
-				<input type="hidden" name="topic" value="', $context['current_topic'], '" />
-				<input type="hidden" name="subname" value="', $context['new_subject'], '" />
-				<input type="submit" value="', $txt['split'], '" class="button_submit" />
-				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-			</p>
+			<br class="clear">
+			<div class="flow_auto">
+				<input type="hidden" name="topic" value="', $context['current_topic'], '">
+				<input type="hidden" name="subname" value="', $context['new_subject'], '">
+				<input type="submit" value="', $txt['split'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+			</div>
 		</form>
 	</div>
-	<br class="clear" />
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var start = new Array();
-			start[0] = ', $context['not_selected']['start'], ';
-			start[1] = ', $context['selected']['start'], ';
-
-			function select(direction, msg_id)
+	<script><!-- // --><![CDATA[
+		var start = new Array();
+		start[0] = ', $context['not_selected']['start'], ';
+		start[1] = ', $context['selected']['start'], ';
+
+		function select(direction, msg_id)
+		{
+			if (window.XMLHttpRequest)
 			{
-				if (window.XMLHttpRequest)
-				{
-					getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + "action=splittopics;sa=selectTopics;subname=', $context['topic']['subject'], ';topic=', $context['topic']['id'], '." + start[0] + ";start2=" + start[1] + ";move=" + direction + ";msg=" + msg_id + ";xml", onDocReceived);
-					return false;
-				}
-				else
-					return true;
+				getXMLDocument(smf_prepareScriptUrl(smf_scripturl) + "action=splittopics;sa=selectTopics;subname=', $context['topic']['subject'], ';topic=', $context['topic']['id'], '." + start[0] + ";start2=" + start[1] + ";move=" + direction + ";msg=" + msg_id + ";xml", onDocReceived);
+				return false;
 			}
-			function applyWindowClasses(oList)
+			else
+				return true;
+		}
+		function onDocReceived(XMLDoc)
+		{
+			var i, j, pageIndex;
+			for (i = 0; i < 2; i++)
 			{
-				var bAlternate = false;
-				oListItems = oList.getElementsByTagName("LI");
-				for (i = 0; i < oListItems.length; i++)
-				{
-					// Skip dummies.
-					if (oListItems[i].id == "")
-						continue;
-					oListItems[i].className = "windowbg" + (bAlternate ? "2" : "");
-					bAlternate = !bAlternate;
-				}
+				pageIndex = XMLDoc.getElementsByTagName("pageIndex")[i];
+				setInnerHTML(document.getElementById("pageindex_" + pageIndex.getAttribute("section")), pageIndex.firstChild.nodeValue);
+				start[i] = pageIndex.getAttribute("startFrom");
 			}
-			function onDocReceived(XMLDoc)
+			var numChanges = XMLDoc.getElementsByTagName("change").length;
+			var curChange, curSection, curAction, curId, curList, curData, newItem, sInsertBeforeId;
+			for (i = 0; i < numChanges; i++)
 			{
-				var i, j, pageIndex;
-				for (i = 0; i < 2; i++)
-				{
-					pageIndex = XMLDoc.getElementsByTagName("pageIndex")[i];
-					setInnerHTML(document.getElementById("pageindex_" + pageIndex.getAttribute("section")), pageIndex.firstChild.nodeValue);
-					start[i] = pageIndex.getAttribute("startFrom");
-				}
-				var numChanges = XMLDoc.getElementsByTagName("change").length;
-				var curChange, curSection, curAction, curId, curList, curData, newItem, sInsertBeforeId;
-				for (i = 0; i < numChanges; i++)
+				curChange = XMLDoc.getElementsByTagName("change")[i];
+				curSection = curChange.getAttribute("section");
+				curAction = curChange.getAttribute("curAction");
+				curId = curChange.getAttribute("id");
+				curList = document.getElementById("messages_" + curSection);
+				if (curAction == "remove")
+					curList.removeChild(document.getElementById(curSection + "_" + curId));
+				// Insert a message.
+				else
 				{
-					curChange = XMLDoc.getElementsByTagName("change")[i];
-					curSection = curChange.getAttribute("section");
-					curAction = curChange.getAttribute("curAction");
-					curId = curChange.getAttribute("id");
-					curList = document.getElementById("messages_" + curSection);
-					if (curAction == "remove")
-						curList.removeChild(document.getElementById(curSection + "_" + curId));
-					// Insert a message.
-					else
+					// By default, insert the element at the end of the list.
+					sInsertBeforeId = null;
+					// Loop through the list to try and find an item to insert after.
+					oListItems = curList.getElementsByTagName("LI");
+					for (j = 0; j < oListItems.length; j++)
 					{
-						// By default, insert the element at the end of the list.
-						sInsertBeforeId = null;
-						// Loop through the list to try and find an item to insert after.
-						oListItems = curList.getElementsByTagName("LI");
-						for (j = 0; j < oListItems.length; j++)
+						if (parseInt(oListItems[j].id.substr(curSection.length + 1)) < curId)
 						{
-							if (parseInt(oListItems[j].id.substr(curSection.length + 1)) < curId)
-							{
-								// This would be a nice place to insert the row.
-								sInsertBeforeId = oListItems[j].id;
-								// We\'re done for now. Escape the loop.
-								j = oListItems.length + 1;
-							}
+							// This would be a nice place to insert the row.
+							sInsertBeforeId = oListItems[j].id;
+							// We\'re done for now. Escape the loop.
+							j = oListItems.length + 1;
 						}
-
-						// Let\'s create a nice container for the message.
-						newItem = document.createElement("LI");
-						newItem.className = "windowbg2";
-						newItem.id = curSection + "_" + curId;
-						newItem.innerHTML = "<span class=\\"topslice\\"><span></span></span><div class=\\"content\\"><div class=\\"message_header\\"><a class=\\"split_icon float" + (curSection == "selected" ? "left" : "right") + "\\" href=\\"" + smf_prepareScriptUrl(smf_scripturl) + "action=splittopics;sa=selectTopics;subname=', $context['topic']['subject'], ';topic=', $context['topic']['id'], '.', $context['not_selected']['start'], ';start2=', $context['selected']['start'], ';move=" + (curSection == "selected" ? "up" : "down") + ";msg=" + curId + "\\" onclick=\\"return select(\'" + (curSection == "selected" ? "up" : "down") + "\', " + curId + ");\\"><img src=\\"', $settings['images_url'], '/split_" + (curSection == "selected" ? "de" : "") + "select.gif\\" alt=\\"" + (curSection == "selected" ? "&lt;-" : "-&gt;") + "\\" /></a><strong>" + curChange.getElementsByTagName("subject")[0].firstChild.nodeValue + "</strong> ', $txt['by'], ' <strong>" + curChange.getElementsByTagName("poster")[0].firstChild.nodeValue + "</strong><br /><em>" + curChange.getElementsByTagName("time")[0].firstChild.nodeValue + "</em></div><div class=\\"post\\">" + curChange.getElementsByTagName("body")[0].firstChild.nodeValue + "</div></div><span class=\\"botslice\\"><span></span></span>";
-
-						// So, where do we insert it?
-						if (typeof sInsertBeforeId == "string")
-							curList.insertBefore(newItem, document.getElementById(sInsertBeforeId));
-						else
-							curList.appendChild(newItem);
 					}
+
+					// Let\'s create a nice container for the message.
+					newItem = document.createElement("LI");
+					newItem.className = "windowbg2";
+					newItem.id = curSection + "_" + curId;
+					newItem.innerHTML = "<div class=\\"message_header\\"><a class=\\"split_icon float" + (curSection == "selected" ? "left" : "right") + "\\" href=\\"" + smf_prepareScriptUrl(smf_scripturl) + "action=splittopics;sa=selectTopics;subname=', $context['topic']['subject'], ';topic=', $context['topic']['id'], '.', $context['not_selected']['start'], ';start2=', $context['selected']['start'], ';move=" + (curSection == "selected" ? "up" : "down") + ";msg=" + curId + "\\" onclick=\\"return select(\'" + (curSection == "selected" ? "up" : "down") + "\', " + curId + ");\\"><span class=\\"generic_icons split_" + (curSection == "selected" ? "de" : "") + "sel\\" title=\\"" + (curSection == "selected" ? "&lt;-" : "-&gt;") + "\\"></span></a><strong>" + curChange.getElementsByTagName("subject")[0].firstChild.nodeValue + "</strong> ', $txt['by'], ' <strong>" + curChange.getElementsByTagName("poster")[0].firstChild.nodeValue + "</strong><br><em>" + curChange.getElementsByTagName("time")[0].firstChild.nodeValue + "</em><div class=\\"post\\">" + curChange.getElementsByTagName("body")[0].firstChild.nodeValue + "</div></div>";
+
+					// So, where do we insert it?
+					if (typeof sInsertBeforeId == "string")
+						curList.insertBefore(newItem, document.getElementById(sInsertBeforeId));
+					else
+						curList.appendChild(newItem);
 				}
-				// After all changes, make sure the window backgrounds are still correct for both lists.
-				applyWindowClasses(document.getElementById("messages_selected"));
-				applyWindowClasses(document.getElementById("messages_not_selected"));
 			}
-		// ]]></script>';
-}
-
-function template_merge_done()
-{
-	global $context, $settings, $options, $txt, $scripturl;
-
-	echo '
-		<div id="merge_topics">
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['merge'], '</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<p>', $txt['merge_successful'], '</p>
-					<br />
-					<ul class="reset">
-						<li>
-							<a href="', $scripturl, '?board=', $context['target_board'], '.0">', $txt['message_index'], '</a>
-						</li>
-						<li>
-							<a href="', $scripturl, '?topic=', $context['target_topic'], '.0">', $txt['new_merged_topic'], '</a>
-						</li>
-					</ul>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-		</div>
-	<br class="clear" />';
-}
-
-function template_merge()
-{
-	global $context, $settings, $options, $txt, $scripturl;
-
-	echo '
-		<div id="merge_topics">
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['merge'], '</h3>
-			</div>
-			<div class="information">
-				', $txt['merge_desc'], '
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings merge_topic">
-						<dt>
-							<strong>', $txt['topic_to_merge'], ':</strong>
-						</dt>
-						<dd>
-							', $context['origin_subject'], '
-						</dd>';
-
-	if (!empty($context['boards']) && count($context['boards']) > 1)
-	{
-			echo '
-						<dt>
-							<strong>', $txt['target_board'], ':</strong>
-						</dt>
-						<dd>
-							<form action="' . $scripturl . '?action=mergetopics;from=' . $context['origin_topic'] . ';targetboard=' . $context['target_board'] . ';board=' . $context['current_board'] . '.0" method="post" accept-charset="', $context['character_set'], '">
-								<input type="hidden" name="from" value="' . $context['origin_topic'] . '" />
-								<select name="targetboard" onchange="this.form.submit();">';
-			foreach ($context['boards'] as $board)
-				echo '
-									<option value="', $board['id'], '"', $board['id'] == $context['target_board'] ? ' selected="selected"' : '', '>', $board['category'], ' - ', $board['name'], '</option>';
-			echo '
-								</select>
-								<input type="submit" value="', $txt['go'], '" class="button_submit" />
-							</form>
-						</dd>';
-	}
-
-	echo '
-					</dl>
-					<hr class="hrcolor" />
-					<dl class="settings merge_topic">
-						<dt>
-							<strong>', $txt['merge_to_topic_id'], ': </strong>
-						</dt>
-						<dd>
-							<form action="', $scripturl , '?action=mergetopics;sa=options" method="post" accept-charset="', $context['character_set'], '">
-								<input type="hidden" name="topics[]" value="', $context['origin_topic'], '" />
-								<input type="text" name="topics[]" class="input_text" />
-								<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-								<input type="submit" value="', $txt['merge'], '" class="button_submit" />
-							</form>
-						</dd>';
-
-		echo '
-					</dl>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div><br />
-			<div class="cat_bar">
-				<h3 class="catbg">', $txt['target_topic'], '</h3>
-			</div>
-			<div class="pagesection">
-				<strong>', $txt['pages'], ':</strong> ', $context['page_index'], '
-			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<ul class="reset merge_topics">';
-
-		$merge_button = create_button('merge.gif', 'merge', '');
-
-		foreach ($context['topics'] as $topic)
-			echo '
-						<li>
-							<a href="', $scripturl, '?action=mergetopics;sa=options;board=', $context['current_board'], '.0;from=', $context['origin_topic'], ';to=', $topic['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $merge_button, '</a>&nbsp;
-							<a href="', $scripturl, '?topic=', $topic['id'], '.0" target="_blank" class="new_win">', $topic['subject'], '</a> ', $txt['started_by'], ' ', $topic['poster']['link'], '
-						</li>';
-
-		echo '
-					</ul>
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-			<div class="pagesection">
-				<strong>', $txt['pages'], ':</strong> ', $context['page_index'], '
-			</div>
-		</div>
-	<br class="clear" />';
-}
-
-function template_merge_extra_options()
-{
-	global $context, $settings, $options, $txt, $scripturl;
-
-	echo '
-	<div id="merge_topics">
-		<form action="', $scripturl, '?action=mergetopics;sa=execute;" method="post" accept-charset="', $context['character_set'], '">
-			<div class="title_bar">
-				<h3 class="titlebg">', $txt['merge_topic_list'], '</h3>
-			</div>
-			<table width="100%" class="bordercolor table_grid">
-				<thead>
-					<tr class="catbg">
-						<th scope="col" class="first_th" align="center" width="10px">', $txt['merge_check'], '</th>
-						<th scope="col" class="lefttext">', $txt['subject'], '</th>
-						<th scope="col" class="lefttext">', $txt['started_by'], '</th>
-						<th scope="col" class="lefttext">', $txt['last_post'], '</th>
-						<th scope="col" class="last_th" width="20px">' . $txt['merge_include_notifications'] . '</th>
-					</tr>
-				</thead>
-				<tbody>';
-		foreach ($context['topics'] as $topic)
-			echo '
-					<tr class="windowbg2">
-						<td align="center">
-							<input type="checkbox" class="input_check" name="topics[]" value="' . $topic['id'] . '" checked="checked" />
-						</td>
-						<td>
-							<a href="' . $scripturl . '?topic=' . $topic['id'] . '.0" target="_blank" class="new_win">' . $topic['subject'] . '</a>
-						</td>
-						<td>
-							', $topic['started']['link'], '<br />
-							<span class="smalltext">', $topic['started']['time'], '</span>
-						</td>
-						<td>
-							' . $topic['updated']['link'] . '<br />
-							<span class="smalltext">', $topic['updated']['time'], '</span>
-						</td>
-						<td align="center">
-							<input type="checkbox" class="input_check" name="notifications[]" value="' . $topic['id'] . '" checked="checked" />
-						</td>
-					</tr>';
-		echo '
-				</tbody>
-			</table>
-			<br />
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">';
-
-	echo '
-					<fieldset id="merge_subject" class="merge_options">
-						<legend>', $txt['merge_select_subject'], '</legend>
-						<select name="subject" onchange="this.form.custom_subject.style.display = (this.options[this.selectedIndex].value != 0) ? \'none\': \'\' ;">';
-	foreach ($context['topics'] as $topic)
-		echo '
-							<option value="', $topic['id'], '"' . ($topic['selected'] ? ' selected="selected"' : '') . '>', $topic['subject'], '</option>';
-	echo '
-							<option value="0">', $txt['merge_custom_subject'], ':</option>
-						</select>
-						<br /><input type="text" name="custom_subject" size="60" id="custom_subject" class="input_text custom_subject" style="display: none;" />
-						<br />
-						<label for="enforce_subject"><input type="checkbox" class="input_check" name="enforce_subject" id="enforce_subject" value="1" /> ', $txt['merge_enforce_subject'], '</label>
-					</fieldset>';
-
-	if (!empty($context['boards']) && count($context['boards']) > 1)
-	{
-		echo '
-					<fieldset id="merge_board" class="merge_options">
-						<legend>', $txt['merge_select_target_board'], '</legend>
-						<ul class="reset">';
-		foreach ($context['boards'] as $board)
-			echo '
-							<li>
-								<input type="radio" name="board" value="' . $board['id'] . '"' . ($board['selected'] ? ' checked="checked"' : '') . ' class="input_radio" /> ' . $board['name'] . '
-							</li>';
-		echo '
-						</ul>
-					</fieldset>';
-	}
-	if (!empty($context['polls']))
-	{
-		echo '
-					<fieldset id="merge_poll" class="merge_options">
-						<legend>' . $txt['merge_select_poll'] . '</legend>
-						<ul class="reset">';
-		foreach ($context['polls'] as $poll)
-			echo '
-							<li>
-								<input type="radio" name="poll" value="' . $poll['id'] . '"' . ($poll['selected'] ? ' checked="checked"' : '') . ' class="input_radio" /> ' . $poll['question'] . ' (' . $txt['topic'] . ': <a href="' . $scripturl . '?topic=' . $poll['topic']['id'] . '.0" target="_blank" class="new_win">' . $poll['topic']['subject'] . '</a>)
-							</li>';
-		echo '
-							<li>
-								<input type="radio" name="poll" value="-1" class="input_radio" /> (' . $txt['merge_no_poll'] . ')
-							</li>
-						</ul>
-					</fieldset>';
-	}
-	echo '
-					<input type="submit" value="' . $txt['merge'] . '" class="button_submit floatright" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					<input type="hidden" name="sa" value="execute" /><br class="clear" />
-				</div>
-				<span class="botslice"><span></span></span>
-			</div>
-		</form>
-	</div>
-	<br class="clear" />';
+			// After all changes, make sure the window backgrounds are still correct for both lists.
+			applyWindowClasses(document.getElementById("messages_selected"));
+			applyWindowClasses(document.getElementById("messages_not_selected"));
+		}
+	// ]]></script>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Stats.template.php b/Themes/default/Stats.template.php
--- a/Themes/default/Stats.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Stats.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,356 +3,147 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_main()
 {
-	global $context, $settings, $options, $txt, $scripturl, $modSettings;
+	global $context, $settings, $txt, $scripturl, $modSettings;
 
 	echo '
 	<div id="statistics" class="main_section">
 		<div class="cat_bar">
 			<h3 class="catbg">', $context['page_title'], '</h3>
 		</div>
-		<div class="title_bar">
-			<h4 class="titlebg">
-				<span class="ie6_header floatleft">
-					<img src="', $settings['images_url'], '/stats_info.gif" class="icon" alt="" /> ', $txt['general_stats'], '
-				</span>
-			</h4>
-		</div>
-		<div class="flow_hidden">
-			<div id="stats_left">
-				<div class="windowbg2">
-					<span class="topslice"><span></span></span>
-					<div class="content top_row">
-						<dl class="stats">
-							<dt>', $txt['total_members'], ':</dt>
-							<dd>', $context['show_member_list'] ? '<a href="' . $scripturl . '?action=mlist">' . $context['num_members'] . '</a>' : $context['num_members'], '</dd>
-							<dt>', $txt['total_posts'], ':</dt>
-							<dd>', $context['num_posts'], '</dd>
-							<dt>', $txt['total_topics'], ':</dt>
-							<dd>', $context['num_topics'], '</dd>
-							<dt>', $txt['total_cats'], ':</dt>
-							<dd>', $context['num_categories'], '</dd>
-							<dt>', $txt['users_online'], ':</dt>
-							<dd>', $context['users_online'], '</dd>
-							<dt>', $txt['most_online'], ':</dt>
-							<dd>', $context['most_members_online']['number'], ' - ', $context['most_members_online']['date'], '</dd>
-							<dt>', $txt['users_online_today'], ':</dt>
-							<dd>', $context['online_today'], '</dd>';
+		<div class="roundframe">
+			<div class="title_bar">
+				<h4 class="titlebg">
+					<span class="generic_icons general"></span> ', $txt['general_stats'], '
+				</h4>
+			</div>
+			<dl class="stats half_content nobb">
+				<dt>', $txt['total_members'], ':</dt>
+				<dd>', $context['show_member_list'] ? '<a href="' . $scripturl . '?action=mlist">' . $context['num_members'] . '</a>' : $context['num_members'], '</dd>
+				<dt>', $txt['total_posts'], ':</dt>
+				<dd>', $context['num_posts'], '</dd>
+				<dt>', $txt['total_topics'], ':</dt>
+				<dd>', $context['num_topics'], '</dd>
+				<dt>', $txt['total_cats'], ':</dt>
+				<dd>', $context['num_categories'], '</dd>
+				<dt>', $txt['users_online'], ':</dt>
+				<dd>', $context['users_online'], '</dd>
+				<dt>', $txt['most_online'], ':</dt>
+				<dd>', $context['most_members_online']['number'], ' - ', $context['most_members_online']['date'], '</dd>
+				<dt>', $txt['users_online_today'], ':</dt>
+				<dd>', $context['online_today'], '</dd>';
 
 	if (!empty($modSettings['hitStats']))
 		echo '
-							<dt>', $txt['num_hits'], ':</dt>
-							<dd>', $context['num_hits'], '</dd>';
+				<dt>', $txt['num_hits'], ':</dt>
+				<dd>', $context['num_hits'], '</dd>';
 
 	echo '
-						</dl>
-						<div class="clear"></div>
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
-			</div>
-			<div id="stats_right">
-				<div class="windowbg2">
-					<span class="topslice"><span></span></span>
-					<div class="content top_row">
-						<dl class="stats">
-							<dt>', $txt['average_members'], ':</dt>
-							<dd>', $context['average_members'], '</dd>
-							<dt>', $txt['average_posts'], ':</dt>
-							<dd>', $context['average_posts'], '</dd>
-							<dt>', $txt['average_topics'], ':</dt>
-							<dd>', $context['average_topics'], '</dd>
-							<dt>', $txt['total_boards'], ':</dt>
-							<dd>', $context['num_boards'], '</dd>
-							<dt>', $txt['latest_member'], ':</dt>
-							<dd>', $context['common_stats']['latest_member']['link'], '</dd>
-							<dt>', $txt['average_online'], ':</dt>
-							<dd>', $context['average_online'], '</dd>
-							<dt>', $txt['gender_ratio'], ':</dt>
-							<dd>', $context['gender']['ratio'], '</dd>';
-
-	if (!empty($modSettings['hitStats']))
-		echo '
-							<dt>', $txt['average_hits'], ':</dt>
-							<dd>', $context['average_hits'], '</dd>';
-
-	echo '
-						</dl>
-						<div class="clear"></div>
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
-			</div>
-		</div>
-		<div class="flow_hidden">
-			<div id="top_posters">
-				<div class="title_bar">
-					<h4 class="titlebg">
-						<span class="ie6_header floatleft">
-							<img src="', $settings['images_url'], '/stats_posters.gif" class="icon" alt="" /> ', $txt['top_posters'], '
-						</span>
-					</h4>
-				</div>
-					<div class="windowbg2">
-						<span class="topslice"><span></span></span>
-						<div class="content">
-							<dl class="stats">';
+			</dl>
+			<dl class="stats half_content nobb">
+				<dt>', $txt['average_members'], ':</dt>
+				<dd>', $context['average_members'], '</dd>
+				<dt>', $txt['average_posts'], ':</dt>
+				<dd>', $context['average_posts'], '</dd>
+				<dt>', $txt['average_topics'], ':</dt>
+				<dd>', $context['average_topics'], '</dd>
+				<dt>', $txt['total_boards'], ':</dt>
+				<dd>', $context['num_boards'], '</dd>
+				<dt>', $txt['latest_member'], ':</dt>
+				<dd>', $context['common_stats']['latest_member']['link'], '</dd>
+				<dt>', $txt['average_online'], ':</dt>
+				<dd>', $context['average_online'], '</dd>';
 
-	foreach ($context['top_posters'] as $poster)
+	if (!empty($context['gender']))
 	{
 		echo '
-								<dt>
-									', $poster['link'], '
-								</dt>
-								<dd class="statsbar">';
+				<dt>', $txt['gender_stats'], ':</dt>
+				<dd>';
 
-		if (!empty($poster['post_percent']))
-			echo '
-									<div class="bar" style="width: ', $poster['post_percent'] + 4, 'px;">
-										<div style="width: ', $poster['post_percent'], 'px;"></div>
-									</div>';
+		foreach ($context['gender'] as $g => $n)
+			echo $g, ': ', $n, '<br>';
 
 		echo '
-									<span class="righttext">', $poster['num_posts'], '</span>
-								</dd>';
+				</dd>';
 	}
 
-	echo '
-							</dl>
-							<div class="clear"></div>
-						</div>
-						<span class="botslice"><span></span></span>
-					</div>
-			</div>
-			<div id="top_boards">
-				<div class="title_bar">
-					<h4 class="titlebg">
-						<span class="ie6_header floatleft">
-							<img src="', $settings['images_url'], '/stats_board.gif" class="icon" alt="" /> ', $txt['top_boards'], '
-						</span>
-					</h4>
-				</div>
-					<div class="windowbg2">
-						<span class="topslice"><span></span></span>
-						<div class="content">
-							<dl class="stats">';
-
-	foreach ($context['top_boards'] as $board)
-	{
+	if (!empty($modSettings['hitStats']))
 		echo '
-								<dt>
-									', $board['link'], '
-								</dt>
-								<dd class="statsbar">';
-
-		if (!empty($board['post_percent']))
-			echo '
-									<div class="bar" style="width: ', $board['post_percent'] + 4, 'px;">
-										<div style="width: ', $board['post_percent'], 'px;"></div>
-									</div>';
-		echo '
-									<span class="righttext">', $board['num_posts'], '</span>
-								</dd>';
-	}
+				<dt>', $txt['average_hits'], ':</dt>
+				<dd>', $context['average_hits'], '</dd>';
 
 	echo '
-							</dl>
-							<div class="clear"></div>
-						</div>
-						<span class="botslice"><span></span></span>
-					</div>
-			</div>
-		</div>
-		<div class="flow_hidden">
-			<div id="top_topics_replies">
-				<div class="title_bar">
-					<h4 class="titlebg">
-						<span class="ie6_header floatleft">
-							<img src="', $settings['images_url'], '/stats_replies.gif" class="icon" alt="" /> ', $txt['top_topics_replies'], '
-						</span>
-					</h4>
-				</div>
-					<div class="windowbg2">
-						<span class="topslice"><span></span></span>
-						<div class="content">
-							<dl class="stats">';
+			</dl>';
 
-	foreach ($context['top_topics_replies'] as $topic)
+	foreach ($context['stats_blocks'] as $name => $block)
 	{
 		echo '
-								<dt>
-									', $topic['link'], '
-								</dt>
-								<dd class="statsbar">';
-		if (!empty($topic['post_percent']))
-			echo '
-									<div class="bar" style="width: ', $topic['post_percent'] + 4, 'px;">
-										<div style="width: ', $topic['post_percent'], 'px;"></div>
-									</div>';
-
-		echo '
-									<span class="righttext">' . $topic['num_replies'] . '</span>
-								</dd>';
-	}
-	echo '
-							</dl>
-							<div class="clear"></div>
-						</div>
-						<span class="botslice"><span></span></span>
-					</div>
-			</div>
-
-			<div id="top_topics_views">
+			<div class="half_content">
 				<div class="title_bar">
 					<h4 class="titlebg">
-						<span class="ie6_header floatleft">
-							<img src="', $settings['images_url'], '/stats_views.gif" class="icon" alt="" /> ', $txt['top_topics_views'], '
-						</span>
+						<span class="generic_icons ', $name, '"></span> ', $txt['top_' . $name], '
 					</h4>
 				</div>
-				<div class="windowbg2">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<dl class="stats">';
+					<dl class="stats">';
 
-	foreach ($context['top_topics_views'] as $topic)
-	{
-		echo '
-							<dt>', $topic['link'], '</dt>
-							<dd class="statsbar">';
-
-		if (!empty($topic['post_percent']))
-			echo '
-								<div class="bar" style="width: ', $topic['post_percent'] + 4, 'px;">
-									<div style="width: ', $topic['post_percent'], 'px;"></div>
-								</div>';
-
-		echo '
-								<span class="righttext">' . $topic['num_views'] . '</span>
-							</dd>';
-	}
-
-	echo '
-						</dl>
-						<div class="clear"></div>
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
-			</div>
-		</div>
-		<div class="flow_hidden">
-			<div id="top_topics_starter">
-				<div class="title_bar">
-					<h4 class="titlebg">
-						<span class="ie6_header floatleft">
-							<img src="', $settings['images_url'], '/stats_replies.gif" class="icon" alt="" /> ', $txt['top_starters'], '
-						</span>
-					</h4>
-				</div>
-				<div class="windowbg2">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<dl class="stats">';
-
-	foreach ($context['top_starters'] as $poster)
-	{
-		echo '
-							<dt>
-								', $poster['link'], '
-							</dt>
-							<dd class="statsbar">';
-
-		if (!empty($poster['post_percent']))
+		foreach ($block as $item)
+		{
 			echo '
-								<div class="bar" style="width: ', $poster['post_percent'] + 4, 'px;">
-									<div style="width: ', $poster['post_percent'], 'px;"></div>
-								</div>';
-
-		echo '
-								<span class="righttext">', $poster['num_topics'], '</span>
-							</dd>';
-	}
+						<dt>
+							', $item['link'], '
+						</dt>
+						<dd class="statsbar">';
 
-	echo '
-						</dl>
-						<div class="clear"></div>
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
-			</div>
-			<div id="most_online">
-				<div class="title_bar">
-					<h4 class="titlebg">
-						<span class="ie6_header floatleft">
-							<img src="', $settings['images_url'], '/stats_views.gif" class="icon" alt="" /> ', $txt['most_time_online'], '
-						</span>
-					</h4>
-				</div>
-				<div class="windowbg2">
-					<span class="topslice"><span></span></span>
-					<div class="content">
-						<dl class="stats">';
-
-	foreach ($context['top_time_online'] as $poster)
-	{
-		echo '
-							<dt>
-								', $poster['link'], '
-							</dt>
-							<dd class="statsbar">';
+			if (!empty($item['percent']))
+				echo '
+							<div class="bar" style="width: ', $item['percent'], '%;">
+								<span class="righttext">', $item['num'], '</span>
+							</div>';
+			else
+				echo '
+							<div class="bar empty"><span class="righttext">', $item['num'], '</span></div>';
 
-		if (!empty($poster['time_percent']))
 			echo '
-								<div class="bar" style="width: ', $poster['time_percent'] + 4, 'px;">
-									<div style="width: ', $poster['time_percent'], 'px;"></div>
-								</div>';
+						</dd>';
+		}
 
 		echo '
-								<span>', $poster['time_online'], '</span>
-							</dd>';
+					</dl>
+			</div>';
 	}
 
 	echo '
-						</dl>
-						<div class="clear"></div>
-					</div>
-					<span class="botslice"><span></span></span>
-				</div>
-			</div>
 		</div>
-		<br class="clear" />
-		<div class="flow_hidden">
-			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft">
-						<img src="', $settings['images_url'], '/stats_history.gif" class="icon" alt="" /> ', $txt['forum_history'], '
-					</span>
-				</h3>
-			</div>';
+		<br class="clear">
+		<div class="cat_bar">
+			<h3 class="catbg">
+				<span class="generic_icons history"></span>', $txt['forum_history'], '
+			</h3>
+		</div>';
 
 	if (!empty($context['yearly']))
 	{
 		echo '
-		<table border="0" width="100%" cellspacing="1" cellpadding="4" class="table_grid" id="stats">
+		<table id="stats" class="table_grid">
 			<thead>
-				<tr class="titlebg" valign="middle" align="center">
-					<th class="first_th lefttext" width="25%">', $txt['yearly_summary'], '</th>
-					<th width="15%">', $txt['stats_new_topics'], '</th>
-					<th width="15%">', $txt['stats_new_posts'], '</th>
-					<th width="15%">', $txt['stats_new_members'], '</th>
-					<th', empty($modSettings['hitStats']) ? ' class="last_th"' : '', ' width="15%">', $txt['smf_stats_14'], '</th>';
+				<tr class="title_bar">
+					<th class="lefttext">', $txt['yearly_summary'], '</th>
+					<th>', $txt['stats_new_topics'], '</th>
+					<th>', $txt['stats_new_posts'], '</th>
+					<th>', $txt['stats_new_members'], '</th>
+					<th>', $txt['most_online'], '</th>';
 
 		if (!empty($modSettings['hitStats']))
 			echo '
-					<th class="last_th">', $txt['page_views'], '</th>';
+					<th>', $txt['page_views'], '</th>';
 
 		echo '
 				</tr>
@@ -362,14 +153,14 @@
 		foreach ($context['yearly'] as $id => $year)
 		{
 			echo '
-				<tr class="windowbg2" valign="middle" align="center" id="year_', $id, '">
-					<th class="lefttext" width="25%">
-						<img id="year_img_', $id, '" src="', $settings['images_url'], '/collapse.gif" alt="*" /> <a href="#year_', $id, '" id="year_link_', $id, '">', $year['year'], '</a>
+				<tr class="windowbg" id="year_', $id, '">
+					<th class="lefttext">
+						<img id="year_img_', $id, '" src="', $settings['images_url'], '/selected_open.png" alt="*"> <a href="#year_', $id, '" id="year_link_', $id, '">', $year['year'], '</a>
 					</th>
-					<th width="15%">', $year['new_topics'], '</th>
-					<th width="15%">', $year['new_posts'], '</th>
-					<th width="15%">', $year['new_members'], '</th>
-					<th width="15%">', $year['most_members_online'], '</th>';
+					<th>', $year['new_topics'], '</th>
+					<th>', $year['new_posts'], '</th>
+					<th>', $year['new_members'], '</th>
+					<th>', $year['most_members_online'], '</th>';
 
 			if (!empty($modSettings['hitStats']))
 				echo '
@@ -381,14 +172,14 @@
 			foreach ($year['months'] as $month)
 			{
 				echo '
-				<tr class="windowbg2" valign="middle" align="center" id="tr_month_', $month['id'], '">
+				<tr class="windowbg" id="tr_month_', $month['id'], '">
 					<th class="stats_month">
-						<img src="', $settings['images_url'], '/', $month['expanded'] ? 'collapse.gif' : 'expand.gif', '" alt="" id="img_', $month['id'], '" /> <a id="m', $month['id'], '" href="', $month['href'], '" onclick="return doingExpandCollapse;">', $month['month'], ' ', $month['year'], '</a>
+						<img src="', $settings['images_url'], '/', $month['expanded'] ? 'selected_open.png' : 'selected.png', '" alt="" id="img_', $month['id'], '"> <a id="m', $month['id'], '" href="', $month['href'], '" onclick="return doingExpandCollapse;">', $month['month'], ' ', $month['year'], '</a>
 					</th>
-					<th width="15%">', $month['new_topics'], '</th>
-					<th width="15%">', $month['new_posts'], '</th>
-					<th width="15%">', $month['new_members'], '</th>
-					<th width="15%">', $month['most_members_online'], '</th>';
+					<th>', $month['new_topics'], '</th>
+					<th>', $month['new_posts'], '</th>
+					<th>', $month['new_members'], '</th>
+					<th>', $month['most_members_online'], '</th>';
 
 				if (!empty($modSettings['hitStats']))
 					echo '
@@ -402,7 +193,7 @@
 					foreach ($month['days'] as $day)
 					{
 						echo '
-				<tr class="windowbg2" valign="middle" align="center" id="tr_day_', $day['year'], '-', $day['month'], '-', $day['day'], '">
+				<tr class="windowbg" id="tr_day_', $day['year'], '-', $day['month'], '-', $day['day'], '">
 					<td class="stats_day">', $day['year'], '-', $day['month'], '-', $day['day'], '</td>
 					<td>', $day['new_topics'], '</td>
 					<td>', $day['new_posts'], '</td>
@@ -423,27 +214,25 @@
 		echo '
 			</tbody>
 		</table>
-		</div>
 	</div>
-	<script type="text/javascript" src="', $settings['default_theme_url'], '/scripts/stats.js"></script>
-	<script type="text/javascript"><!-- // --><![CDATA[
+	<script><!-- // --><![CDATA[
 		var oStatsCenter = new smf_StatsCenter({
 			sTableId: \'stats\',
 
 			reYearPattern: /year_(\d+)/,
-			sYearImageCollapsed: \'expand.gif\',
-			sYearImageExpanded: \'collapse.gif\',
+			sYearImageCollapsed: \'selected.png\',
+			sYearImageExpanded: \'selected_open.png\',
 			sYearImageIdPrefix: \'year_img_\',
 			sYearLinkIdPrefix: \'year_link_\',
 
 			reMonthPattern: /tr_month_(\d+)/,
-			sMonthImageCollapsed: \'expand.gif\',
-			sMonthImageExpanded: \'collapse.gif\',
+			sMonthImageCollapsed: \'selected.png\',
+			sMonthImageExpanded: \'selected_open.png\',
 			sMonthImageIdPrefix: \'img_\',
 			sMonthLinkIdPrefix: \'m\',
 
 			reDayPattern: /tr_day_(\d+-\d+-\d+)/,
-			sDayRowClassname: \'windowbg2\',
+			sDayRowClassname: \'windowbg\',
 			sDayRowIdPrefix: \'tr_day_\',
 
 			aCollapsedYears: [';
diff -ru a/Themes/default/Themes.template.php b/Themes/default/Themes.template.php
--- a/Themes/default/Themes.template.php	2014-01-20 09:52:31.000000000 -0800
+++ b/Themes/default/Themes.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,298 +3,291 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0.7
+ * @version 2.1 Beta 1
  */
 
 // The main sub template - for theme administration.
 function template_main()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $settings, $scripturl, $txt, $modSettings;
 
 	echo '
-	<div id="admincenter">
+	<div id="admincenter">';
+
+	// Theme install info.
+	echo '
+		<div class="cat_bar">
+		<h3 class="catbg">
+			<a href="', $scripturl, '?action=helpadmin;help=themes" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a>
+			', $txt['themeadmin_title'], '
+		</h3>
+		</div>
+		<div class="information">
+			', $txt['themeadmin_explain'], '
+		</div>';
+
+	echo '<br>
 		<form action="', $scripturl, '?action=admin;area=theme;sa=admin" method="post" accept-charset="', $context['character_set'], '">
-			<input type="hidden" value="0" name="options[theme_allow]" />
 			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft"><a href="', $scripturl, '?action=helpadmin;help=themes" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" class="icon" alt="', $txt['help'], '" align="top" /></a>
-					', $txt['themeadmin_title'], '
-					</span>
+				<h3 class="catbg">',
+					$txt['settings'], '
 				</h3>
 			</div>
-			<div class="information">
-				', $txt['themeadmin_explain'], '
-			</div>
 			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<label for="options-theme_allow"> ', $txt['theme_allow'], '</label>
-						</dt>
-						<dd>
-							<input type="checkbox" name="options[theme_allow]" id="options-theme_allow" value="1"', !empty($modSettings['theme_allow']) ? ' checked="checked"' : '', ' class="input_check" />
-						</dd>
-						<dt>
-							<label for="known_themes_list">', $txt['themeadmin_selectable'], '</label>:
-						</dt>
-						<dd>
-							<div id="known_themes_list">';
+				<dl class="settings">
+					<dt>
+						<label for="options-theme_allow"> ', $txt['theme_allow'], '</label>
+					</dt>
+					<dd>
+						<input type="hidden" value="0" name="options[theme_allow]">
+						<input type="checkbox" name="options[theme_allow]" id="options-theme_allow" value="1"', !empty($modSettings['theme_allow']) ? ' checked' : '', ' class="input_check">
+					</dd>
+					<dt>
+						<label for="known_themes_list">', $txt['themeadmin_selectable'], '</label>:
+					</dt>
+					<dd>
+						<div id="known_themes_list">';
+
 	foreach ($context['themes'] as $theme)
 		echo '
-								<label for="options-known_themes_', $theme['id'], '"><input type="checkbox" name="options[known_themes][]" id="options-known_themes_', $theme['id'], '" value="', $theme['id'], '"', $theme['known'] ? ' checked="checked"' : '', ' class="input_check" /> ', $theme['name'], '</label><br />';
+							<label for="options-known_themes_', $theme['id'], '"><input type="checkbox" name="options[known_themes][]" id="options-known_themes_', $theme['id'], '" value="', $theme['id'], '"', $theme['known'] ? ' checked' : '', ' class="input_check"> ', $theme['name'], '</label><br>';
 
 		echo '
-							</div>
-							<a href="javascript:void(0);" onclick="document.getElementById(\'known_themes_list\').style.display=\'block\'; document.getElementById(\'known_themes_link\').style.display = \'none\'; return false; " id="known_themes_link" style="display: none;">[ ', $txt['themeadmin_themelist_link'], ' ]</a>
-							<script type="text/javascript"><!-- // --><![CDATA[
-								document.getElementById("known_themes_list").style.display = "none";
-								document.getElementById("known_themes_link").style.display = "";
-							// ]]></script>
-						</dd>
-						<dt>
-							<label for="theme_guests">', $txt['theme_guests'], ':</label>
-						</dt>
-						<dd>
-							<select name="options[theme_guests]" id="theme_guests">';
+						</div>
+						<a href="javascript:void(0);" onclick="document.getElementById(\'known_themes_list\').style.display=\'block\'; document.getElementById(\'known_themes_link\').style.display = \'none\'; return false; " id="known_themes_link" style="display: none;">[ ', $txt['themeadmin_themelist_link'], ' ]</a>
+						<script><!-- // --><![CDATA[
+							document.getElementById("known_themes_list").style.display = "none";
+							document.getElementById("known_themes_link").style.display = "";
+						// ]]></script>
+					</dd>
+					<dt>
+						<label for="theme_guests">', $txt['theme_guests'], ':</label>
+					</dt>
+					<dd>
+						<select name="options[theme_guests]" id="theme_guests">';
 
 	// Put an option for each theme in the select box.
 	foreach ($context['themes'] as $theme)
 		echo '
-								<option value="', $theme['id'], '"', $modSettings['theme_guests'] == $theme['id'] ? ' selected="selected"' : '', '>', $theme['name'], '</option>';
+							<option value="', $theme['id'], '"', $modSettings['theme_guests'] == $theme['id'] ? ' selected' : '', '>', $theme['name'], '</option>';
 
 	echo '
-							</select>
-							<span class="smalltext pick_theme"><a href="', $scripturl, '?action=theme;sa=pick;u=-1;', $context['session_var'], '=', $context['session_id'], '">', $txt['theme_select'], '</a></span>
-						</dd>
-						<dt>
-							<label for="theme_reset">', $txt['theme_reset'], '</label>:
-						</dt>
-						<dd>
-							<select name="theme_reset" id="theme_reset">
-								<option value="-1" selected="selected">', $txt['theme_nochange'], '</option>
-								<option value="0">', $txt['theme_forum_default'], '</option>';
+						</select>
+						<span class="smalltext pick_theme"><a href="', $scripturl, '?action=theme;sa=pick;u=-1;', $context['session_var'], '=', $context['session_id'], '">', $txt['theme_select'], '</a></span>
+					</dd>
+					<dt>
+						<label for="theme_reset">', $txt['theme_reset'], '</label>:
+					</dt>
+					<dd>
+						<select name="theme_reset" id="theme_reset">
+							<option value="-1" selected>', $txt['theme_nochange'], '</option>
+							<option value="0">', $txt['theme_forum_default'], '</option>';
 
 	// Same thing, this time for changing the theme of everyone.
 	foreach ($context['themes'] as $theme)
 		echo '
-								<option value="', $theme['id'], '">', $theme['name'], '</option>';
+							<option value="', $theme['id'], '">', $theme['name'], '</option>';
 
 	echo '
-							</select>
-							<span class="smalltext pick_theme"><a href="', $scripturl, '?action=theme;sa=pick;u=0;', $context['session_var'], '=', $context['session_id'], '">', $txt['theme_select'], '</a></span>
-						</dd>
-					</dl>
-					<div class="righttext">
-						<input type="submit" name="submit" value="' . $txt['save'] . '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
+						</select>
+						<span class="smalltext pick_theme"><a href="', $scripturl, '?action=theme;sa=pick;u=0;', $context['session_var'], '=', $context['session_id'], '">', $txt['theme_select'], '</a></span>
+					</dd>
+				</dl>
+				<input type="submit" name="save" value="' . $txt['save'] . '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-tm_token_var'], '" value="', $context['admin-tm_token'], '">
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
 		</form>';
 
 	// Link to simplemachines.org for latest themes and info!
 	echo '
-		<br />
+		<br>
 		<div class="cat_bar">
 			<h3 class="catbg">
-				<span class="ie6_header floatleft"><a href="', $scripturl, '?action=helpadmin;help=latest_themes" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" class="icon" alt="', $txt['help'], '" /></a> ', $txt['theme_latest'], '</span>
+				', $txt['theme_adding_title'], '
 			</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<div id="themeLatest">
-					', $txt['theme_latest_fetch'], '
-				</div>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>
-		<br />';
-
-	// Warn them if theme creation isn't possible!
-	if (!$context['can_create_new'])
-		echo '
-		<div class="errorbox">', $txt['theme_install_writable'], '</div>';
+		<div class="windowbg2">
+			', $txt['theme_adding'], '
+		</div>';
 
-		echo '
-		<form action="', $scripturl, '?action=admin;area=theme;sa=install" method="post" accept-charset="', $context['character_set'], '" enctype="multipart/form-data" onsubmit="return confirm(\'', $txt['theme_install_new_confirm'], '\');">
+	// All the install options.
+	echo '
+		<div id="admin_form_wrapper">
 			<div class="cat_bar">
 				<h3 class="catbg">
-					<span class="ie6_header floatleft"><a href="', $scripturl, '?action=helpadmin;help=theme_install" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" class="icon" alt="', $txt['help'], '" /></a> ', $txt['theme_install'], '</span>
+					', $txt['theme_install'], '
 				</h3>
-			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">';
+			</div>';
 
-	// Here's a little box for installing a new theme.
-	// !!! Should the value="theme_gz" be there?!
 	if ($context['can_create_new'])
+	{
+		// From a file.
 		echo '
-						<dt>
-							<label for="theme_gz">', $txt['theme_install_file'], '</label>:
-						</dt>
-						<dd>
-							<input type="file" name="theme_gz" id="theme_gz" value="theme_gz" size="40" onchange="this.form.copy.disabled = this.value != \'\'; this.form.theme_dir.disabled = this.value != \'\';" class="input_file" />
-						</dd>';
-
-	echo '
-						<dt>
-							<label for="theme_dir">', $txt['theme_install_dir'], '</label>:
-						</dt>
-						<dd>
-							<input type="text" name="theme_dir" id="theme_dir" value="', $context['new_theme_dir'], '" size="40" style="width: 70%;" class="input_text" />
-						</dd>';
+			<br>
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $txt['theme_install_file'], '
+				</h3>
+			</div>
+			<form action="', $scripturl, '?action=admin;area=theme;sa=install;do=file" method="post" accept-charset="', $context['character_set'], '" enctype="multipart/form-data" class="windowbg2">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-t-file_token_var'], '" value="', $context['admin-t-file_token'], '">
+				<input type="file" name="theme_gz" id="theme_gz" value="theme_gz" size="40" onchange="this.form.copy.disabled = this.value != \'\'; this.form.theme_dir.disabled = this.value != \'\';" class="input_file">
+				<input type="submit" name="save_file" value="' . $txt['upload'] . '" class="button_submit">
+			</form>';
 
-	if ($context['can_create_new'])
+		// Copied from the default.
 		echo '
-						<dt>
-							<label for="copy">', $txt['theme_install_new'], ':</label>
-						</dt>
-						<dd>
-							<input type="text" name="copy" id="copy" value="', $context['new_theme_name'], '" size="40" class="input_text" />
-						</dd>';
+			<br>
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $txt['theme_install_new'], '
+				</h3>
+			</div>
+			<form action="', $scripturl, '?action=admin;area=theme;sa=install;do=copy" method="post" accept-charset="', $context['character_set'], '" class="windowbg2">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-t-copy_token_var'], '" value="', $context['admin-t-copy_token'], '">
+				<input type="text" name="copy" id="copy" value="', $context['new_theme_name'], '" size="40" class="input_text">
+				<input type="submit" name="save_copy" value="' . $txt['save'] . '" class="button_submit">
+			</form>';
+	}
 
+	// From a dir.
 	echo '
-					</dl>
-					<div class="righttext">
-						<input type="submit" name="submit" value="', $txt['theme_install_go'], '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
+			<br>
+			<div class="cat_bar">
+				<h3 class="catbg">
+					', $txt['theme_install_dir'], '
+				</h3>
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-		</form>
-	</div>
-	<br class="clear" />
-
-		<script type="text/javascript"><!-- // --><![CDATA[
-			window.smfForum_scripturl = "', $scripturl, '";
-			window.smfForum_sessionid = "', $context['session_id'], '";
-			window.smfForum_sessionvar = "', $context['session_var'], '";
-			window.smfThemes_writable = ', $context['can_create_new'] ? 'true' : 'false', ';
-		// ]]></script>';
-
-	if (empty($modSettings['disable_smf_js']))
-		echo '
-		<script type="text/javascript" src="', $scripturl, '?action=viewsmfile;filename=latest-themes.js"></script>';
+			<form action="', $scripturl, '?action=admin;area=theme;sa=install;do=dir" method="post" accept-charset="', $context['character_set'], '" class="windowbg2">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-t-dir_token_var'], '" value="', $context['admin-t-dir_token'], '">
+				<input type="text" name="theme_dir" id="theme_dir" value="', $context['new_theme_dir'], '" size="40" style="width: 40%;" class="input_text">
+				<input type="submit" name="save_dir" value="' . $txt['save'] . '" class="button_submit">
+			</form>';
 
 	echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			var tempOldOnload;
-
-			function smfSetLatestThemes()
-			{
-				if (typeof(window.smfLatestThemes) != "undefined")
-					setInnerHTML(document.getElementById("themeLatest"), window.smfLatestThemes);
+		</div>';
 
-				if (tempOldOnload)
-					tempOldOnload();
-			}
-		// ]]></script>';
+	echo '
+	</div>';
 
-	// Gotta love IE4, and its hatefulness...
-	if ($context['browser']['is_ie4'])
-		echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			addLoadEvent(smfSetLatestThemes);
-		// ]]></script>';
-	else
-		echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
-			smfSetLatestThemes();
-		// ]]></script>';
+	echo '
+	<script><!-- // --><![CDATA[
+		window.smfForum_scripturl = smf_scripturl;
+		window.smfForum_sessionid = smf_session_id;
+		window.smfForum_sessionvar = smf_session_var;
+		window.smfThemes_writable = ', $context['can_create_new'] ? 'true' : 'false', ';
+	// ]]></script>';
 }
 
 function template_list_themes()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
+
+	// Show a nice confirmation message.
+	if (isset($_GET['done']))
+		echo '
+	<div class="infobox">
+		', $txt['theme_confirmed_'. $_GET['done']] ,'
+	</div>';
+
+	echo '
+	<div id="admincenter">';
 
 	echo '
-	<div id="admincenter">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['themeadmin_list_heading'], '</h3>
 		</div>
 		<div class="information">
 			', $txt['themeadmin_list_tip'], '
-		</div>';
+		</div>
+		<form id="admin_form_wrapper" action="', $scripturl, '?action=admin;area=theme;', $context['session_var'], '=', $context['session_id'], ';sa=list" method="post" accept-charset="', $context['character_set'], '">
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['theme_settings'], '</h3>
+			</div>
+			<br>';
 
-	// Show each theme.... with X for delete and a link to settings.
+	// Show each theme.... with X for delete, an enable/disable link and a link to their own settings page.
 	foreach ($context['themes'] as $theme)
 	{
 		echo '
-			<div class="title_bar">
-				<h3 class="titlebg">
-					<span class="floatleft"><strong><a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=settings">', $theme['name'], '</a></strong>', !empty($theme['version']) ? ' <em>(' . $theme['version'] . ')</em>' : '', '</span>';
+			<div class="cat_bar">
+				<h3 class="catbg">
+					<span class="floatleft">
+						', (!empty($theme['enable']) || $theme['id'] == 1 ? '<a href="'. $scripturl .'?action=admin;area=theme;th='. $theme['id'] .';'. $context['session_var'] .'='. $context['session_id'] .';sa=list">'. $theme['name'] .'</a>' : $theme['name'] ),'', (!empty($theme['version']) ? ' <em>(' . $theme['version'] . ')</em>' : ''), '
+					</span>';
 
-			// You *cannot* delete the default theme. It's important!
+			// You *cannot* disable/enable/delete the default theme. It's important!
 			if ($theme['id'] != 1)
+			{
+				echo '
+					<span class="floatright">';
+
+				// Enable/Disable.
+				echo '
+					<a href="', $scripturl, '?action=admin;area=theme;sa=enable;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';', $context['admin-tre_token_var'], '=', $context['admin-tre_token'], '', (!empty($theme['enable']) ? ';disabled' : '') ,'" data-confirm="', $txt['theme_'. (!empty($theme['enable']) ? 'disable' : 'enable') .'_confirm'], '" class="you_sure"><span class="generic_icons ',!empty($theme['enable']) ? 'disable' : 'enable','" title="', $txt['theme_'. (!empty($theme['enable']) ? 'disable' : 'enable')] ,'"></span></a>';
+
+				// Deleting.
+				echo '
+						<a href="', $scripturl, '?action=admin;area=theme;sa=remove;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';', $context['admin-tr_token_var'], '=', $context['admin-tr_token'], '" data-confirm="', $txt['theme_remove_confirm'], '" class="you_sure"><span class="generic_icons delete" title="', $txt['theme_remove'], '"></span></a>';
+
 				echo '
-					<span class="floatright"><a href="', $scripturl, '?action=admin;area=theme;sa=remove;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], '" onclick="return confirm(\'', $txt['theme_remove_confirm'], '\');"><img src="', $settings['images_url'], '/icons/delete.gif" alt="', $txt['theme_remove'], '" title="', $txt['theme_remove'], '" /></a></span>';
+					</span>';
+			}
 
 			echo '
 				</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings themes_list">
-						<dt>', $txt['themeadmin_list_theme_dir'], ':</dt>
-						<dd', $theme['valid_path'] ? '' : ' class="error"', '>', $theme['theme_dir'], $theme['valid_path'] ? '' : ' ' . $txt['themeadmin_list_invalid'], '</dd>
-						<dt>', $txt['themeadmin_list_theme_url'], ':</dt>
-						<dd>', $theme['theme_url'], '</dd>
-						<dt>', $txt['themeadmin_list_images_url'], ':</dt>
-						<dd>', $theme['images_url'], '</dd>
-					</dl>
-				</div>
-				<span class="botslice"><span></span></span>
+			<div class="windowbg2">
+				<dl class="settings themes_list">
+					<dt>', $txt['themeadmin_list_theme_dir'], ':</dt>
+					<dd', $theme['valid_path'] ? '' : ' class="error"', '>', $theme['theme_dir'], $theme['valid_path'] ? '' : ' ' . $txt['themeadmin_list_invalid'], '</dd>
+					<dt>', $txt['themeadmin_list_theme_url'], ':</dt>
+					<dd>', $theme['theme_url'], '</dd>
+					<dt>', $txt['themeadmin_list_images_url'], ':</dt>
+					<dd>', $theme['images_url'], '</dd>
+				</dl>
 			</div>';
 	}
 
 	echo '
-
-		<form action="', $scripturl, '?action=admin;area=theme;', $context['session_var'], '=', $context['session_id'], ';sa=list" method="post" accept-charset="', $context['character_set'], '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['themeadmin_list_reset'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<label for="reset_dir">', $txt['themeadmin_list_reset_dir'], '</label>:
-						</dt>
-						<dd>
-							<input type="text" name="reset_dir" id="reset_dir" value="', $context['reset_dir'], '" size="40" style="width: 80%;" class="input_text" />
-						</dd>
-						<dt>
-							<label for="reset_url">', $txt['themeadmin_list_reset_url'], '</label>:
-						</dt>
-						<dd>
-							<input type="text" name="reset_url" id="reset_url" value="', $context['reset_url'], '" size="40" style="width: 80%;" class="input_text" />
-						</dd>
-					</dl>
-					<input type="submit" name="submit" value="', $txt['themeadmin_list_reset_go'], '" class="button_submit" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</div>
-				<span class="botslice"><span></span></span>
+			<div class="windowbg2">
+				<dl class="settings">
+					<dt>
+						<label for="reset_dir">', $txt['themeadmin_list_reset_dir'], '</label>:
+					</dt>
+					<dd>
+						<input type="text" name="reset_dir" id="reset_dir" value="', $context['reset_dir'], '" size="40" style="width: 80%;" class="input_text">
+					</dd>
+					<dt>
+						<label for="reset_url">', $txt['themeadmin_list_reset_url'], '</label>:
+					</dt>
+					<dd>
+						<input type="text" name="reset_url" id="reset_url" value="', $context['reset_url'], '" size="40" style="width: 80%;" class="input_text">
+					</dd>
+				</dl>
+				<input type="submit" name="save" value="', $txt['themeadmin_list_reset_go'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-tl_token_var'], '" value="', $context['admin-tl_token'], '">
 			</div>
 
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_reset_list()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
@@ -303,22 +296,17 @@
 		</div>
 		<div class="information">
 			', $txt['themeadmin_reset_tip'], '
-		</div>';
+		</div>
+		<div id="admin_form_wrapper">';
 
 	// Show each theme.... with X for delete and a link to settings.
-	$alternate = false;
-
 	foreach ($context['themes'] as $theme)
 	{
-		$alternate = !$alternate;
-
 		echo '
-		<div class="title_bar">
-			<h3 class="titlebg">', $theme['name'], '</h3>
-		</div>
-		<div class="windowbg', $alternate ? '' : '2','">
-			<span class="topslice"><span></span></span>
-			<div class="content">
+			<div class="cat_bar">
+				<h3 class="catbg">', $theme['name'], '</h3>
+			</div>
+			<div class="windowbg">
 				<ul class="reset">
 					<li>
 						<a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=reset">', $txt['themeadmin_reset_defaults'], '</a> <em class="smalltext">(', $theme['num_default_options'], ' ', $txt['themeadmin_reset_defaults_current'], ')</em>
@@ -327,172 +315,198 @@
 						<a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=reset;who=1">', $txt['themeadmin_reset_members'], '</a>
 					</li>
 					<li>
-						<a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=reset;who=2" onclick="return confirm(\'', $txt['themeadmin_reset_remove_confirm'], '\');">', $txt['themeadmin_reset_remove'], '</a> <em class="smalltext">(', $theme['num_members'], ' ', $txt['themeadmin_reset_remove_current'], ')</em>
+						<a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=reset;who=2;', $context['admin-stor_token_var'], '=', $context['admin-stor_token'], '" data-confirm="', $txt['themeadmin_reset_remove_confirm'], '" class="you_sure">', $txt['themeadmin_reset_remove'], '</a> <em class="smalltext">(', $theme['num_members'], ' ', $txt['themeadmin_reset_remove_current'], ')</em>
 					</li>
 				</ul>
-			</div>
-			<span class="botslice"><span></span></span>
-		</div>';
+			</div>';
 	}
 
 	echo '
-	</div>
-	<br class="clear" />';
+		</div>
+	</div>';
 }
 
 function template_set_options()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
 		<form action="', $scripturl, '?action=admin;area=theme;th=', $context['theme_settings']['theme_id'], ';sa=reset" method="post" accept-charset="', $context['character_set'], '">
-			<input type="hidden" name="who" value="', $context['theme_options_reset'] ? 1 : 0, '" />
+			<input type="hidden" name="who" value="', $context['theme_options_reset'] ? 1 : 0, '">
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['theme_options_title'], ' - ', $context['theme_settings']['name'], '</h3>
 			</div>
 			<div class="information">
 				', $context['theme_options_reset'] ? $txt['themeadmin_reset_options_info'] : $txt['theme_options_defaults'], '
 			</div>
-			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<ul class="theme_options">';
+			<div class="windowbg2">';
+	echo '
+				<dl class="settings">';
 
 	foreach ($context['options'] as $setting)
 	{
 		echo '
-						<li class="theme_option">';
+					<dt ', $context['theme_options_reset'] ? 'style="width:50%"' : '', '>';
 
+		// Show the change option box ?
 		if ($context['theme_options_reset'])
 			echo '
-							<select name="', !empty($setting['default']) ? 'default_' : '', 'options_master[', $setting['id'], ']" onchange="this.form.options_', $setting['id'], '.disabled = this.selectedIndex != 1;">
-								<option value="0" selected="selected">', $txt['themeadmin_reset_options_none'], '</option>
-								<option value="1">', $txt['themeadmin_reset_options_change'], '</option>
-								<option value="2">', $txt['themeadmin_reset_options_remove'], '</option>
-							</select>';
+						<span class="floatleft"><select name="', !empty($setting['default']) ? 'default_' : '', 'options_master[', $setting['id'], ']" onchange="this.form.options_', $setting['id'], '.disabled = this.selectedIndex != 1;">
+							<option value="0" selected>', $txt['themeadmin_reset_options_none'], '</option>
+							<option value="1">', $txt['themeadmin_reset_options_change'], '</option>
+							<option value="2">', $txt['themeadmin_reset_options_default'], '</option>
+						</select>&nbsp;</span>';
 
+		// display checkbox options
 		if ($setting['type'] == 'checkbox')
 		{
 			echo '
-							<input type="hidden" name="' . (!empty($setting['default']) ? 'default_' : '') . 'options[' . $setting['id'] . ']" value="0" />
-							<label for="options_', $setting['id'], '"><input type="checkbox" name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="options_', $setting['id'], '"', !empty($setting['value']) ? ' checked="checked"' : '', $context['theme_options_reset'] ? ' disabled="disabled"' : '', ' value="1" class="input_check" /> ', $setting['label'], '</label>';
+						<label for="options_', $setting['id'], '">', $setting['label'], '</label>';
+			if (isset($setting['description']))
+				echo '
+						<br><span class="smalltext">', $setting['description'], '</span>';
+		echo '
+					</dt>
+					<dd ', $context['theme_options_reset'] ? 'style="width:40%"' : '', '>
+						<input type="hidden" name="' . (!empty($setting['default']) ? 'default_' : '') . 'options[' . $setting['id'] . ']" value="0">
+						<input type="checkbox" name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="options_', $setting['id'], '"', !empty($setting['value']) ? ' checked' : '', $context['theme_options_reset'] ? ' disabled' : '', ' value="1" class="input_check floatleft">';
 		}
+		// how about selection lists, we all love them
 		elseif ($setting['type'] == 'list')
 		{
 			echo '
-							&nbsp;<label for="options_', $setting['id'], '">', $setting['label'], '</label>
-							<select name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="options_', $setting['id'], '"', $context['theme_options_reset'] ? ' disabled="disabled"' : '', '>';
+						<label for="options_', $setting['id'], '">', $setting['label'], '</label>';
+			if (isset($setting['description']))
+				echo '
+						<br><span class="smalltext">', $setting['description'], '</span>';
+		echo '
+					</dt>
+					<dd ', $context['theme_options_reset'] ? 'style="width:40%"' : '', '>
+						&nbsp;<select class="floatleft" name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="options_', $setting['id'], '"', $context['theme_options_reset'] ? ' disabled' : '', '>';
 
 			foreach ($setting['options'] as $value => $label)
 			{
 				echo '
-								<option value="', $value, '"', $value == $setting['value'] ? ' selected="selected"' : '', '>', $label, '</option>';
+							<option value="', $value, '"', $value == $setting['value'] ? ' selected' : '', '>', $label, '</option>';
 			}
 
 			echo '
-							</select>';
+						</select>';
 		}
+		// a textbox it is then
 		else
+		{
 			echo '
-							&nbsp;<label for="options_', $setting['id'], '">', $setting['label'], '</label>
-							<input type="text" name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="options_', $setting['id'], '" value="', $setting['value'], '"', $setting['type'] == 'number' ? ' size="5"' : '', $context['theme_options_reset'] ? ' disabled="disabled"' : '', ' class="input_text" />';
+						<label for="options_', $setting['id'], '">', $setting['label'], '</label>';
+			if (isset($setting['description']))
+				echo '
+						<br><span class="smalltext">', $setting['description'], '</span>';
+		echo '
+					</dt>
+					<dd ', $context['theme_options_reset'] ? 'style="width:40%"' : '', '>';
 
-		if (isset($setting['description']))
-			echo '
-							<br /><span class="smalltext">', $setting['description'], '</span>';
+			if (isset($setting['type']) && $setting['type'] == 'number')
+			{
+				$min = isset($setting['min']) ? ' min="' . $setting['min'] . '"' : ' min="0"';
+				$max = isset($setting['max']) ? ' max="' . $setting['max'] . '"' : '';
+				$step = isset($setting['step']) ? ' step="' . $setting['step'] . '"' : '';
 
+				echo '
+						<input type="number"', $min . $max . $step;
+			}
+			else
+			{
+				echo '
+						<input type="text"';
+			}
+
+
+			echo ' name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="options_', $setting['id'], '" value="', $setting['value'], '"', $setting['type'] == 'number' ? ' size="5"' : '', $context['theme_options_reset'] ? ' disabled' : '', ' class="input_text">';
+		}
+
+		// end of this defintion
 		echo '
-					</li>';
+					</dd>';
 	}
 
+	// close the option page up
 	echo '
-					</ul>
-					<div class="righttext">
-						<input type="submit" name="submit" value="', $txt['save'], '" class="button_submit" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
+				</dl>
+				<input type="submit" name="submit" value="', $txt['save'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-sto_token_var'], '" value="', $context['admin-sto_token'], '">
 			</div>
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_set_settings()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $settings, $scripturl, $txt;
 
 	echo '
-	<div id="admincenter">
-		<form action="', $scripturl, '?action=admin;area=theme;sa=settings;th=', $context['theme_settings']['theme_id'], '" method="post" accept-charset="', $context['character_set'], '">
-			<div class="title_bar">
-				<h3 class="titlebg">
-					<span class="ie6_header floatleft"><a href="', $scripturl, '?action=helpadmin;help=theme_settings" onclick="return reqWin(this.href);" class="help"><img src="', $settings['images_url'], '/helptopics.gif" alt="', $txt['help'], '" class="icon" /></a> ', $txt['theme_settings'], ' - ', $context['theme_settings']['name'], '</span>
+	<div id="admin_form_wrapper">
+		<form action="', $scripturl, '?action=admin;area=theme;sa=list;th=', $context['theme_settings']['theme_id'], '" method="post" accept-charset="', $context['character_set'], '">
+			<div class="cat_bar">
+				<h3 class="catbg">
+					<a href="', $scripturl, '?action=helpadmin;help=theme_settings" onclick="return reqOverlayDiv(this.href);" class="help"><span class="generic_icons help" title="', $txt['help'],'"></span></a> ', $txt['theme_settings'], ' - ', $context['theme_settings']['name'], '
 				</h3>
-			</div>';
+			</div>
+			<br>';
 
-	// !!! Why can't I edit the default theme popup.
+	// @todo Why can't I edit the default theme popup.
 	if ($context['theme_settings']['theme_id'] != 1)
 		echo '
 			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/config_sm.gif" alt="" class="icon" /> ', $txt['theme_edit'], '</span>
+				<h3 class="catbg config_hd">
+					', $txt['theme_edit'], '
 				</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<ul class="reset">
-						<li>
-							<a href="', $scripturl, '?action=admin;area=theme;th=', $context['theme_settings']['theme_id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=edit;filename=index.template.php">', $txt['theme_edit_index'], '</a>
-						</li>
-						<li>
-							<a href="', $scripturl, '?action=admin;area=theme;th=', $context['theme_settings']['theme_id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=edit;directory=css">', $txt['theme_edit_style'], '</a>
-						</li>
-					</ul>
-				</div>
-				<span class="botslice"><span></span></span>
+			<div class="windowbg2">
+				<ul class="reset">
+					<li>
+						<a href="', $scripturl, '?action=admin;area=theme;th=', $context['theme_settings']['theme_id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=edit;filename=index.template.php">', $txt['theme_edit_index'], '</a>
+					</li>
+					<li>
+						<a href="', $scripturl, '?action=admin;area=theme;th=', $context['theme_settings']['theme_id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=edit;directory=css">', $txt['theme_edit_style'], '</a>
+					</li>
+				</ul>
 			</div>';
 
 	echo '
 			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/config_sm.gif" alt="" class="icon" /> ', $txt['theme_url_config'], '</span>
+				<h3 class="catbg config_hd">
+					', $txt['theme_url_config'], '
 				</h3>
 			</div>
 			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<label for="theme_name">', $txt['actual_theme_name'], '</label>
-						</dt>
-						<dd>
-							<input type="text" id="theme_name" name="options[name]" value="', $context['theme_settings']['name'], '" size="32" class="input_text" />
-						</dd>
-						<dt>
-							<label for="theme_url">', $txt['actual_theme_url'], '</label>
-						</dt>
-						<dd>
-							<input type="text" id="theme_url" name="options[theme_url]" value="', $context['theme_settings']['actual_theme_url'], '" size="50" style="max-width: 100%; width: 50ex;" class="input_text" />
-						</dd>
-						<dt>
-							<label for="images_url">', $txt['actual_images_url'], '</label>
-						</dt>
-						<dd>
-							<input type="text" id="images_url" name="options[images_url]" value="', $context['theme_settings']['actual_images_url'], '" size="50" style="max-width: 100%; width: 50ex;" class="input_text" />
-						</dd>
-						<dt>
-							<label for="theme_dir">', $txt['actual_theme_dir'], '</label>
-						</dt>
-						<dd>
-							<input type="text" id="theme_dir" name="options[theme_dir]" value="', $context['theme_settings']['actual_theme_dir'], '" size="50" style="max-width: 100%; width: 50ex;" class="input_text" />
-						</dd>
-					</dl>
-				</div>
-				<span class="botslice"><span></span></span>
+				<dl class="settings">
+					<dt>
+						<label for="theme_name">', $txt['actual_theme_name'], '</label>
+					</dt>
+					<dd>
+						<input type="text" id="theme_name" name="options[name]" value="', $context['theme_settings']['name'], '" size="32" class="input_text">
+					</dd>
+					<dt>
+						<label for="theme_url">', $txt['actual_theme_url'], '</label>
+					</dt>
+					<dd>
+						<input type="text" id="theme_url" name="options[theme_url]" value="', $context['theme_settings']['actual_theme_url'], '" size="50" style="max-width: 100%; width: 50ex;" class="input_text">
+					</dd>
+					<dt>
+						<label for="images_url">', $txt['actual_images_url'], '</label>
+					</dt>
+					<dd>
+						<input type="text" id="images_url" name="options[images_url]" value="', $context['theme_settings']['actual_images_url'], '" size="50" style="max-width: 100%; width: 50ex;" class="input_text">
+					</dd>
+					<dt>
+						<label for="theme_dir">', $txt['actual_theme_dir'], '</label>
+					</dt>
+					<dd>
+						<input type="text" id="theme_dir" name="options[theme_dir]" value="', $context['theme_settings']['actual_theme_dir'], '" size="50" style="max-width: 100%; width: 50ex;" class="input_text">
+					</dd>
+				</dl>
 			</div>';
 
 	// Do we allow theme variants?
@@ -500,51 +514,45 @@
 	{
 		echo '
 			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/config_sm.gif" alt="" align="top" /> ', $txt['theme_variants'], '</span>
+				<h3 class="catbg config_hd">
+					', $txt['theme_variants'], '
 				</h3>
 			</div>
 			<div class="windowbg2">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings">
-						<dt>
-							<label for="variant">', $txt['theme_variants_default'], '</label>:
-						</dt>
-						<dd>
-							<select id="variant" name="options[default_variant]" onchange="changeVariant(this.value)">';
+				<dl class="settings">
+					<dt>
+						<label for="variant">', $txt['theme_variants_default'], '</label>:
+					</dt>
+					<dd>
+						<select id="variant" name="options[default_variant]" onchange="changeVariant(this.value)">';
 
 		foreach ($context['theme_variants'] as $key => $variant)
 			echo '
-								<option value="', $key, '" ', $context['default_variant'] == $key ? 'selected="selected"' : '', '>', $variant['label'], '</option>';
+							<option value="', $key, '"', $context['default_variant'] == $key ? ' selected' : '', '>', $variant['label'], '</option>';
 
 		echo '
-							</select>
-						</dd>
-						<dt>
-							<label for="disable_user_variant">', $txt['theme_variants_user_disable'], '</label>:
-						</dt>
-						<dd>
-							<input type="hidden" name="options[disable_user_variant]" value="0" />
-							<input type="checkbox" name="options[disable_user_variant]" id="disable_user_variant"', !empty($context['theme_settings']['disable_user_variant']) ? ' checked="checked"' : '', ' value="1" class="input_check" />
-						</dd>
-					</dl>
-					<img src="', $context['theme_variants'][$context['default_variant']]['thumbnail'], '" id="variant_preview" alt="" />
-				</div>
-				<span class="botslice"><span></span></span>
+						</select>
+					</dd>
+					<dt>
+						<label for="disable_user_variant">', $txt['theme_variants_user_disable'], '</label>:
+					</dt>
+					<dd>
+						<input type="hidden" name="options[disable_user_variant]" value="0">
+						<input type="checkbox" name="options[disable_user_variant]" id="disable_user_variant"', !empty($context['theme_settings']['disable_user_variant']) ? ' checked' : '', ' value="1" class="input_check">
+					</dd>
+				</dl>
+				<img src="', $context['theme_variants'][$context['default_variant']]['thumbnail'], '" id="variant_preview" alt="">
 			</div>';
 	}
 
 	echo '
 			<div class="cat_bar">
-				<h3 class="catbg">
-					<span class="ie6_header floatleft"><img src="', $settings['images_url'], '/icons/config_sm.gif" alt="" class="icon" /> ', $txt['theme_options'], '</span>
+				<h3 class="catbg config_hd">
+					', $txt['theme_options'], '
 				</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<dl class="settings flow_auto">';
+			<div class="windowbg2">
+				<dl class="settings flow_auto">';
 
 	foreach ($context['settings'] as $setting)
 	{
@@ -552,88 +560,100 @@
 		if (empty($setting))
 		{
 			echo '
-					</dl>
-					<hr class="hrcolor" />
-					<dl class="settings flow_auto">';
+				</dl>
+				<hr class="hrcolor">
+				<dl class="settings flow_auto">';
 		}
 		// A checkbox?
 		elseif ($setting['type'] == 'checkbox')
 		{
 			echo '
-						<dt>
-							<label for="', $setting['id'], '">', $setting['label'], '</label>:';
+					<dt>
+						<label for="', $setting['id'], '">', $setting['label'], '</label>:';
 
 			if (isset($setting['description']))
-				echo '<br />
-							<span class="smalltext">', $setting['description'], '</span>';
+				echo '<br>
+						<span class="smalltext">', $setting['description'], '</span>';
 
 			echo '
-						</dt>
-						<dd>
-							<input type="hidden" name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" value="0" />
-							<input type="checkbox" name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="', $setting['id'], '"', !empty($setting['value']) ? ' checked="checked"' : '', ' value="1" class="input_check" />
-						</dd>';
+					</dt>
+					<dd>
+						<input type="hidden" name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" value="0">
+						<input type="checkbox" name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="', $setting['id'], '"', !empty($setting['value']) ? ' checked' : '', ' value="1" class="input_check">
+					</dd>';
 		}
 		// A list with options?
 		elseif ($setting['type'] == 'list')
 		{
 			echo '
-						<dt>
-							<label for="', $setting['id'], '">', $setting['label'], '</label>:';
+					<dt>
+						<label for="', $setting['id'], '">', $setting['label'], '</label>:';
 
 			if (isset($setting['description']))
-				echo '<br />
-							<span class="smalltext">', $setting['description'], '</span>';
+				echo '<br>
+						<span class="smalltext">', $setting['description'], '</span>';
 
 			echo '
-						</dt>
-						<dd>
-							<select name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="', $setting['id'], '">';
+					</dt>
+					<dd>
+						<select name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="', $setting['id'], '">';
 
 			foreach ($setting['options'] as $value => $label)
 				echo '
-							<option value="', $value, '"', $value == $setting['value'] ? ' selected="selected"' : '', '>', $label, '</option>';
+							<option value="', $value, '"', $value == $setting['value'] ? ' selected' : '', '>', $label, '</option>';
 
 			echo '
-							</select>
-						</dd>';
+						</select>
+					</dd>';
 		}
 		// A regular input box, then?
 		else
 		{
 			echo '
-						<dt>
-							<label for="', $setting['id'], '">', $setting['label'], '</label>:';
+					<dt>
+						<label for="', $setting['id'], '">', $setting['label'], '</label>:';
 
 			if (isset($setting['description']))
-				echo '<br />
-							<span class="smalltext">', $setting['description'], '</span>';
+				echo '<br>
+						<span class="smalltext">', $setting['description'], '</span>';
 
 			echo '
-						</dt>
-						<dd>
-							<input type="text" name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="', $setting['id'], '" value="', $setting['value'], '"', $setting['type'] == 'number' ? ' size="5"' : (empty($setting['size']) ? ' size="40"' : ' size="' . $setting['size'] . '"'), ' class="input_text" />
-						</dd>';
+					</dt>
+					<dd>';
+
+			if (isset($setting['type']) && $setting['type'] == 'number')
+			{
+				$min = isset($setting['min']) ? ' min="' . $setting['min'] . '"' : ' min="0"';
+				$max = isset($setting['max']) ? ' max="' . $setting['max'] . '"' : '';
+				$step = isset($setting['step']) ? ' step="' . $setting['step'] . '"' : '';
+
+				echo '
+						<input type="number"', $min . $max . $step;
+			}
+			else
+			{
+				echo '
+						<input type="text"';
+			}
+
+			echo ' name="', !empty($setting['default']) ? 'default_' : '', 'options[', $setting['id'], ']" id="options_', $setting['id'], '" value="', $setting['value'], '"', $setting['type'] == 'number' ? ' size="5"' : (empty($settings['size']) ? ' size="40"' : ' size="' . $setting['size'] . '"'), ' class="input_text">
+					</dd>';
 		}
 	}
 
 	echo '
-					</dl>
-					<div class="righttext">
-						<input type="submit" name="submit" value="', $txt['save'], '" class="button_submit" />
-					</div>
-				</div>
-				<span class="botslice"><span></span></span>
+				</dl>
+				<input type="submit" name="save" value="', $txt['save'], '" class="button_submit">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">
+				<input type="hidden" name="', $context['admin-sts_token_var'], '" value="', $context['admin-sts_token'], '">
 			</div>
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 
 	if (!empty($context['theme_variants']))
 	{
 		echo '
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 		var oThumbnails = {';
 
 		// All the variant thumbnails.
@@ -647,11 +667,6 @@
 
 		echo '
 		}
-
-		function changeVariant(sVariant)
-		{
-			document.getElementById(\'variant_preview\').src = oThumbnails[sVariant];
-		}
 		// ]]></script>';
 	}
 }
@@ -659,7 +674,7 @@
 // This template allows for the selection of different themes ;).
 function template_pick()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="pick_theme">
@@ -671,13 +686,12 @@
 		echo '
 			<div class="cat_bar">
 				<h3 class="catbg">
-					<a href="', $scripturl, '?action=theme;sa=pick;u=', $context['current_member'], ';th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $theme['name'], '</a>
+					<a href="', $scripturl, '?action=theme;sa=pick;u=', $context['current_member'], ';th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], !empty($theme['variants']) ? ';vrt=' . $theme['selected_variant'] : '', '">', $theme['name'], '</a>
 				</h3>
 			</div>
 			<div class="', $theme['selected'] ? 'windowbg' : 'windowbg2', '">
-				<span class="topslice"><span></span></span>
-				<div class="flow_hidden content">
-					<div class="floatright"><a href="', $scripturl, '?action=theme;sa=pick;u=', $context['current_member'], ';theme=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], '" id="theme_thumb_preview_', $theme['id'], '" title="', $txt['theme_preview'], '"><img src="', $theme['thumbnail_href'], '" id="theme_thumb_', $theme['id'], '" alt="" class="padding" /></a></div>
+				<div class="flow_hidden">
+					<div class="floatright"><a href="', $scripturl, '?action=theme;sa=pick;u=', $context['current_member'], ';theme=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], '" id="theme_thumb_preview_', $theme['id'], '" title="', $txt['theme_preview'], '"><img src="', $theme['thumbnail_href'], '" id="theme_thumb_', $theme['id'], '" alt="" class="padding"></a></div>
 					<p>', $theme['description'], '</p>';
 
 		if (!empty($theme['variants']))
@@ -689,37 +703,36 @@
 			foreach ($theme['variants'] as $key => $variant)
 			{
 				echo '
-						<option value="', $key, '" ', $theme['selected_variant'] == $key ? 'selected="selected"' : '', '>', $variant['label'], '</option>';
+						<option value="', $key, '"', $theme['selected_variant'] == $key ? ' selected' : '', '>', $variant['label'], '</option>';
 			}
 			echo '
 					</select>
 					<noscript>
-						<input type="submit" name="save[', $theme['id'], ']" value="', $txt['save'], '" class="button_submit" />
+						<input type="submit" name="save[', $theme['id'], ']" value="', $txt['save'], '" class="button_submit">
 					</noscript>';
 		}
 
 		echo '
-					<br />
+					<br>
 					<p>
 						<em class="smalltext">', $theme['num_users'], ' ', ($theme['num_users'] == 1 ? $txt['theme_user'] : $txt['theme_users']), '</em>
 					</p>
-					<br />
+					<br>
 					<ul class="reset">
 						<li>
-							<a href="', $scripturl, '?action=theme;sa=pick;u=', $context['current_member'], ';th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], '" id="theme_use_', $theme['id'], '">[', $txt['theme_set'], ']</a>
+							<a href="', $scripturl, '?action=theme;sa=pick;u=', $context['current_member'], ';th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], !empty($theme['variants']) ? ';vrt=' . $theme['selected_variant'] : '', '" id="theme_use_', $theme['id'], '">[', $txt['theme_set'], ']</a>
 						</li>
 						<li>
 							<a href="', $scripturl, '?action=theme;sa=pick;u=', $context['current_member'], ';theme=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], '" id="theme_preview_', $theme['id'], '">[', $txt['theme_preview'], ']</a>
 						</li>
 					</ul>
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>';
 
 		if (!empty($theme['variants']))
 		{
 			echo '
-			<script type="text/javascript"><!-- // --><![CDATA[
+			<script><!-- // --><![CDATA[
 			var sBaseUseUrl', $theme['id'], ' = smf_prepareScriptUrl(smf_scripturl) + \'action=theme;sa=pick;u=', $context['current_member'], ';th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], '\';
 			var sBasePreviewUrl', $theme['id'], ' = smf_prepareScriptUrl(smf_scripturl) + \'action=theme;sa=pick;u=', $context['current_member'], ';theme=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], '\';
 			var oThumbnails', $theme['id'], ' = {';
@@ -739,7 +752,7 @@
 			function changeVariant', $theme['id'], '(sVariant)
 			{
 				document.getElementById(\'theme_thumb_', $theme['id'], '\').src = oThumbnails', $theme['id'], '[sVariant];
-				document.getElementById(\'theme_use_', $theme['id'], '\').href = sBaseUseUrl', $theme['id'], ' + \';vrt=\' + sVariant;
+				document.getElementById(\'theme_use_', $theme['id'], '\').href = sBaseUseUrl', $theme['id'] == 0 ? $context['default_theme_id'] : $theme['id'], ' + \';vrt=\' + sVariant;
 				document.getElementById(\'theme_thumb_preview_', $theme['id'], '\').href = sBasePreviewUrl', $theme['id'], ' + \';vrt=\' + sVariant + \';variant=\' + sVariant;
 				document.getElementById(\'theme_preview_', $theme['id'], '\').href = sBasePreviewUrl', $theme['id'], ' + \';vrt=\' + sVariant + \';variant=\' + sVariant;
 			}
@@ -749,81 +762,80 @@
 
 	echo '
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
-// Okay, that theme was installed successfully!
+// Okay, that theme was installed/updated successfully!
 function template_installed()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
-	// Not much to show except a link back...
+	// The aftermath.
 	echo '
 	<div id="admincenter">
 		<div class="cat_bar">
 			<h3 class="catbg">', $context['page_title'], '</h3>
 		</div>
-		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>
-					<a href="', $scripturl, '?action=admin;area=theme;sa=settings;th=', $context['installed_theme']['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $context['installed_theme']['name'], '</a> ', $txt['theme_installed_message'], '
-				</p>
-				<p>
-					<a href="', $scripturl, '?action=admin;area=theme;sa=admin;', $context['session_var'], '=', $context['session_id'], '">', $txt['back'], '</a>
-				</p>
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg">';
+
+	// Oops! there was an error :(
+	if (!empty($context['error_message']))
+		echo '
+			<p>
+				', $context['error_message'] ,'
+			</p>';
+
+	// Not much to show except a link back...
+	else
+		echo '
+			<p>
+				<a href="', $scripturl, '?action=admin;area=theme;sa=list;th=', $context['installed_theme']['id'], ';', $context['session_var'], '=', $context['session_id'], '">', $context['installed_theme']['name'], '</a> ', $txt['theme_'. (isset($context['installed_theme']['updated']) ? 'updated' : 'installed') .'_message'], '
+			</p>
+			<p>
+				<a href="', $scripturl, '?action=admin;area=theme;sa=admin;', $context['session_var'], '=', $context['session_id'], '">', $txt['back'], '</a>
+			</p>';
+
+	echo '
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_edit_list()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
-	<div id="admincenter">
+	<div id="admin_form_wrapper">
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['themeadmin_edit_title'], '</h3>
-		</div>';
-
-	$alternate = false;
+		</div>
+		<br>';
 
 	foreach ($context['themes'] as $theme)
 	{
-		$alternate = !$alternate;
-
 		echo '
-		<div class="title_bar">
-			<h3 class="titlebg">
+		<div class="cat_bar">
+			<h3 class="catbg">
 				<a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=edit">', $theme['name'], '</a>', !empty($theme['version']) ? '
 				<em>(' . $theme['version'] . ')</em>' : '', '
 			</h3>
 		</div>
-		<div class="windowbg', $alternate ? '' : '2','">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<ul class="reset">
-					<li><a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=edit">', $txt['themeadmin_edit_browse'], '</a></li>', $theme['can_edit_style'] ? '
-					<li><a href="' . $scripturl . '?action=admin;area=theme;th=' . $theme['id'] . ';' . $context['session_var'] . '=' . $context['session_id'] . ';sa=edit;directory=css">' . $txt['themeadmin_edit_style'] . '</a></li>' : '', '
-					<li><a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=copy">', $txt['themeadmin_edit_copy_template'], '</a></li>
-				</ul>
-			</div>
-			<span class="botslice"><span></span></span>
+		<div class="windowbg">
+			<ul class="reset">
+				<li><a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=edit">', $txt['themeadmin_edit_browse'], '</a></li>', $theme['can_edit_style'] ? '
+				<li><a href="' . $scripturl . '?action=admin;area=theme;th=' . $theme['id'] . ';' . $context['session_var'] . '=' . $context['session_id'] . ';sa=edit;directory=css">' . $txt['themeadmin_edit_style'] . '</a></li>' : '', '
+				<li><a href="', $scripturl, '?action=admin;area=theme;th=', $theme['id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=copy">', $txt['themeadmin_edit_copy_template'], '</a></li>
+			</ul>
 		</div>';
 	}
 
 	echo '
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_copy_template()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<div id="admincenter">
@@ -834,63 +846,60 @@
 			', $txt['themeadmin_edit_copy_warning'], '
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<ul class="theme_options">';
+			<ul class="theme_options">';
 
-	$alternate = false;
 	foreach ($context['available_templates'] as $template)
 	{
-		$alternate = !$alternate;
-
 		echo '
-					<li class="reset flow_hidden windowbg', $alternate ? '2' : '', '">
-						<span class="floatleft">', $template['filename'], $template['already_exists'] ? ' <span class="error">(' . $txt['themeadmin_edit_exists'] . ')</span>' : '', '</span>
-						<span class="floatright">';
+				<li class="reset flow_hidden windowbg">
+					<span class="floatleft">', $template['filename'], $template['already_exists'] ? ' <span class="error">(' . $txt['themeadmin_edit_exists'] . ')</span>' : '', '</span>
+					<span class="floatright">';
 
 		if ($template['can_copy'])
-			echo '<a href="', $scripturl, '?action=admin;area=theme;th=', $context['theme_id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=copy;template=', $template['value'], '" onclick="return confirm(\'', $template['already_exists'] ? $txt['themeadmin_edit_overwrite_confirm'] : $txt['themeadmin_edit_copy_confirm'], '\');">', $txt['themeadmin_edit_do_copy'], '</a>';
+			echo '<a href="', $scripturl, '?action=admin;area=theme;th=', $context['theme_id'], ';', $context['session_var'], '=', $context['session_id'], ';sa=copy;template=', $template['value'], '" data-confirm="', $template['already_exists'] ? $txt['themeadmin_edit_overwrite_confirm'] : $txt['themeadmin_edit_copy_confirm'], '" class="you_sure">', $txt['themeadmin_edit_do_copy'], '</a>';
 		else
 			echo $txt['themeadmin_edit_no_copy'];
 
 		echo '
-						</span>
-					</li>';
+					</span>
+				</li>';
 	}
 
 	echo '
-				</ul>
-			</div>
-			<span class="botslice"><span></span></span>
+			</ul>
 		</div>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 function template_edit_browse()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $txt;
 
 	echo '
-	<div id="admincenter">
-		<table width="100%" class="table_grid tborder">
+	<div id="admincenter">';
+
+	if (!empty($context['browse_title']))
+		echo '
+		<div class="cat_bar">
+			<h3 class="catbg">', $context['browse_title'], '</h3>
+		</div>';
+
+	echo '
+		<table class="table_grid tborder">
 		<thead>
-			<tr class="catbg">
-				<th class="lefttext first_th" scope="col" width="50%">', $txt['themeadmin_edit_filename'], '</th>
+			<tr class="title_bar">
+				<th class="lefttext" scope="col" width="50%">', $txt['themeadmin_edit_filename'], '</th>
 				<th scope="col" width="35%">', $txt['themeadmin_edit_modified'], '</th>
-				<th class="last_th" scope="col" width="15%">', $txt['themeadmin_edit_size'], '</th>
+				<th scope="col" width="15%">', $txt['themeadmin_edit_size'], '</th>
 			</tr>
 		</thead>
 		<tbody>';
 
-	$alternate = false;
-
 	foreach ($context['theme_files'] as $file)
 	{
-		$alternate = !$alternate;
 
 		echo '
-			<tr class="windowbg', $alternate ? '2' : '', '">
+			<tr class="windowbg">
 				<td>';
 
 		if ($file['is_editable'])
@@ -912,14 +921,13 @@
 	echo '
 		</tbody>
 		</table>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // Wanna edit the stylesheet?
 function template_edit_style()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $settings, $scripturl, $txt;
 
 	if ($context['session_error'])
 		echo '
@@ -930,7 +938,7 @@
 	// From now on no one can complain that editing css is difficult. If you disagree, go to www.w3schools.com.
 	echo '
 	<div id="admincenter">
-		<script type="text/javascript"><!-- // --><![CDATA[
+		<script><!-- // --><![CDATA[
 			var previewData = "";
 			var previewTimeout;
 			var editFilename = ', JavaScriptEscape($context['edit_filename']), ';
@@ -988,7 +996,7 @@
 					try
 					{
 					';
-	if ($context['browser']['is_ie'])
+	if (isBrowser('is_ie'))
 		echo '
 						var sheets = frames["css_preview_box"].document.styleSheets;
 						for (var j = 0; j < sheets.length; j++)
@@ -1039,18 +1047,6 @@
 					};
 				}
 			}
-
-			// The idea here is simple: don\'t refresh the preview on every keypress, but do refresh after they type.
-			function setPreviewTimeout()
-			{
-				if (previewTimeout)
-				{
-					window.clearTimeout(previewTimeout);
-					previewTimeout = null;
-				}
-
-				previewTimeout = window.setTimeout("refreshPreview(true); previewTimeout = null;", 500);
-			}
 		// ]]></script>
 		<iframe id="css_preview_box" name="css_preview_box" src="about:blank" width="99%" height="300" frameborder="0" style="display: none; margin-bottom: 2ex; border: 1px solid black;"></iframe>';
 
@@ -1060,34 +1056,36 @@
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['theme_edit'], ' - ', $context['edit_filename'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">';
+			<div class="windowbg">';
 
 	if (!$context['allow_save'])
 		echo '
-					', $txt['theme_edit_no_save'], ': ', $context['allow_save_filename'], '<br />';
+				', $txt['theme_edit_no_save'], ': ', $context['allow_save_filename'], '<br>';
 
 	echo '
-					<textarea name="entire_file" cols="80" rows="20" style="' . ($context['browser']['is_ie8'] ? 'width: 635px; max-width: 96%; min-width: 96%' : 'width: 96%') . '; font-family: monospace; margin-top: 1ex; white-space: pre;" onkeyup="setPreviewTimeout();" onchange="refreshPreview(true);">', $context['entire_file'], '</textarea><br />
-					<div class="padding righttext">
-						<input type="submit" name="submit" value="', $txt['theme_edit_save'], '"', $context['allow_save'] ? '' : ' disabled="disabled"', ' style="margin-top: 1ex;" class="button_submit" />
-						<input type="button" value="', $txt['themeadmin_edit_preview'], '" onclick="refreshPreview(false);" class="button_submit" />
-					</div>
+				<textarea name="entire_file" cols="80" rows="20" style="width: 96%; font-family: monospace; margin-top: 1ex; white-space: pre;" onkeyup="setPreviewTimeout();" onchange="refreshPreview(true);">', $context['entire_file'], '</textarea><br>
+				<div class="padding righttext">
+					<input type="submit" name="save" value="', $txt['theme_edit_save'], '"', $context['allow_save'] ? '' : ' disabled', ' style="margin-top: 1ex;" class="button_submit">
+					<input type="button" value="', $txt['themeadmin_edit_preview'], '" onclick="refreshPreview(false);" class="button_submit">
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>
-			<input type="hidden" name="filename" value="', $context['edit_filename'], '" />
-			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
+			<input type="hidden" name="filename" value="', $context['edit_filename'], '">
+			<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">';
+
+	// Hopefully it exists.
+	if (isset($context['admin-te-' . md5($context['theme_id'] . '-' . $context['edit_filename']) . '_token']))
+		echo '
+			<input type="hidden" name="', $context['admin-te-' . md5($context['theme_id'] . '-' . $context['edit_filename']) . '_token_var'], '" value="', $context['admin-te-' . md5($context['theme_id'] . '-' . $context['edit_filename']) . '_token'], '">';
+
+	echo '
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 // This edits the template...
 function template_edit_template()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	if ($context['session_error'])
 		echo '
@@ -1099,7 +1097,7 @@
 		echo '
 	<div class="errorbox">
 		', $txt['themeadmin_edit_error'], '
-			<div><tt>', $context['parse_error'], '</tt></div>
+			<div><pre>', $context['parse_error'], '</pre></div>
 	</div>';
 
 	// Just show a big box.... gray out the Save button if it's not saveable... (ie. not 777.)
@@ -1109,29 +1107,32 @@
 			<div class="cat_bar">
 				<h3 class="catbg">', $txt['theme_edit'], ' - ', $context['edit_filename'], '</h3>
 			</div>
-			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">';
+			<div class="windowbg">';
 
 	if (!$context['allow_save'])
 		echo '
-					', $txt['theme_edit_no_save'], ': ', $context['allow_save_filename'], '<br />';
+				', $txt['theme_edit_no_save'], ': ', $context['allow_save_filename'], '<br>';
 
 	foreach ($context['file_parts'] as $part)
 		echo '
-					<label for="on_line', $part['line'], '">', $txt['themeadmin_edit_on_line'], ' ', $part['line'], '</label>:<br />
-					<div class="centertext">
-						<textarea id="on_line', $part['line'] ,'" name="entire_file[]" cols="80" rows="', $part['lines'] > 14 ? '14' : $part['lines'], '" class="edit_file">', $part['data'], '</textarea>
-					</div>';
+				<label for="on_line', $part['line'], '">', $txt['themeadmin_edit_on_line'], ' ', $part['line'], '</label>:<br>
+				<div class="centertext">
+					<textarea id="on_line', $part['line'] ,'" name="entire_file[]" cols="80" rows="', $part['lines'] > 14 ? '14' : $part['lines'], '" class="edit_file">', $part['data'], '</textarea>
+				</div>';
+
+	echo '
+				<div class="padding righttext">
+					<input type="submit" name="save" value="', $txt['theme_edit_save'], '"', $context['allow_save'] ? '' : ' disabled', ' class="button_submit">
+					<input type="hidden" name="filename" value="', $context['edit_filename'], '">
+					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">';
+
+	// Hopefully it exists.
+	if (isset($context['admin-te-' . md5($context['theme_id'] . '-' . $context['edit_filename']) . '_token']))
+		echo '
+					<input type="hidden" name="', $context['admin-te-' . md5($context['theme_id'] . '-' . $context['edit_filename']) . '_token_var'], '" value="', $context['admin-te-' . md5($context['theme_id'] . '-' . $context['edit_filename']) . '_token'], '">';
 
 	echo '
-					<div class="padding righttext">
-						<input type="submit" name="submit" value="', $txt['theme_edit_save'], '"', $context['allow_save'] ? '' : ' disabled="disabled"', ' class="button_submit" />
-						<input type="hidden" name="filename" value="', $context['edit_filename'], '" />
-						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-					</div>
 				</div>
-				<span class="botslice"><span></span></span>
 			</div>
 		</form>
 	</div>';
@@ -1139,7 +1140,7 @@
 
 function template_edit_file()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	if ($context['session_error'])
 		echo '
@@ -1162,19 +1163,21 @@
 				<h3 class="catbg">', $txt['theme_edit'], ' - ', $context['edit_filename'], '</h3>
 			</div>
 			<div class="windowbg">
-				<span class="topslice"><span></span></span>
-				<div class="content">
-					<textarea name="entire_file" id="entire_file" cols="80" rows="20" class="edit_file">', $context['entire_file'], '</textarea><br />
-					<input type="submit" name="submit" value="', $txt['theme_edit_save'], '"', $context['allow_save'] ? '' : ' disabled="disabled"', ' class="button_submit" />
-					<input type="hidden" name="filename" value="', $context['edit_filename'], '" />
-					<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
-				</div>
-				<span class="botslice"><span></span></span>
+				<textarea name="entire_file" id="entire_file" cols="80" rows="20" class="edit_file">', $context['entire_file'], '</textarea><br>
+				<input type="submit" name="save" value="', $txt['theme_edit_save'], '"', $context['allow_save'] ? '' : ' disabled', ' class="button_submit">
+				<input type="hidden" name="filename" value="', $context['edit_filename'], '">
+				<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '">';
+
+	// Hopefully it exists.
+	if (isset($context['admin-te-' . md5($context['theme_id'] . '-' . $context['edit_filename']) . '_token']))
+		echo '
+				<input type="hidden" name="', $context['admin-te-' . md5($context['theme_id'] . '-' . $context['edit_filename']) . '_token_var'], '" value="', $context['admin-te-' . md5($context['theme_id'] . '-' . $context['edit_filename']) . '_token'], '">';
+
+	echo '
 			</div>
 
 		</form>
-	</div>
-	<br class="clear" />';
+	</div>';
 }
 
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Who.template.php b/Themes/default/Who.template.php
--- a/Themes/default/Who.template.php	2011-06-11 07:43:24.000000000 -0700
+++ b/Themes/default/Who.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,69 +3,64 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 // The only template in the file.
 function template_main()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $settings, $scripturl, $txt;
 
 	// Display the table header and linktree.
 	echo '
 	<div class="main_section" id="whos_online">
 		<form action="', $scripturl, '?action=who" method="post" id="whoFilter" accept-charset="', $context['character_set'], '">
-			<div class="title_bar">
-				<h4 class="titlebg margin_lower">', $txt['who_title'], '</h4>
+			<div class="cat_bar">
+				<h3 class="catbg">', $txt['who_title'], '</h3>
 			</div>
-			<div class="topic_table" id="mlist">
+			<div id="mlist">
 				<div class="pagesection">
-					<div class="pagelinks floatleft">', $txt['pages'], ': ', $context['page_index'], '</div>';
-		echo '
-					<div class="selectbox floatright">', $txt['who_show1'], '
+					<div class="pagelinks floatleft">', $context['page_index'], '</div>';
+	echo '
+					<div class="selectbox floatright" id="upper_show">', $txt['who_show1'], '
 						<select name="show_top" onchange="document.forms.whoFilter.show.value = this.value; document.forms.whoFilter.submit();">';
 
-		foreach ($context['show_methods'] as $value => $label)
-			echo '
-							<option value="', $value, '" ', $value == $context['show_by'] ? ' selected="selected"' : '', '>', $label, '</option>';
+	foreach ($context['show_methods'] as $value => $label)
 		echo '
+							<option value="', $value, '" ', $value == $context['show_by'] ? ' selected' : '', '>', $label, '</option>';
+	echo '
 						</select>
 						<noscript>
-							<input type="submit" name="submit_top" value="', $txt['go'], '" class="button_submit" />
+							<input type="submit" name="submit_top" value="', $txt['go'], '" class="button_submit">
 						</noscript>
 					</div>
 				</div>
-				<table class="table_grid" cellspacing="0">
+				<table class="table_grid">
 					<thead>
-						<tr class="catbg">
-							<th scope="col" class="lefttext first_th" width="40%"><a href="', $scripturl, '?action=who;start=', $context['start'], ';show=', $context['show_by'], ';sort=user', $context['sort_direction'] != 'down' && $context['sort_by'] == 'user' ? '' : ';asc', '" rel="nofollow">', $txt['who_user'], ' ', $context['sort_by'] == 'user' ? '<img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>
-							<th scope="col" class="lefttext" width="10%"><a href="', $scripturl, '?action=who;start=', $context['start'], ';show=', $context['show_by'], ';sort=time', $context['sort_direction'] == 'down' && $context['sort_by'] == 'time' ? ';asc' : '', '" rel="nofollow">', $txt['who_time'], ' ', $context['sort_by'] == 'time' ? '<img src="' . $settings['images_url'] . '/sort_' . $context['sort_direction'] . '.gif" alt="" />' : '', '</a></th>
-							<th scope="col" class="lefttext last_th" width="50%">', $txt['who_action'], '</th>
+						<tr class="title_bar">
+							<th scope="col" class="lefttext" width="40%"><a href="', $scripturl, '?action=who;start=', $context['start'], ';show=', $context['show_by'], ';sort=user', $context['sort_direction'] != 'down' && $context['sort_by'] == 'user' ? '' : ';asc', '" rel="nofollow">', $txt['who_user'], $context['sort_by'] == 'user' ? '<span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a></th>
+							<th scope="col" class="lefttext time" width="10%"><a href="', $scripturl, '?action=who;start=', $context['start'], ';show=', $context['show_by'], ';sort=time', $context['sort_direction'] == 'down' && $context['sort_by'] == 'time' ? ';asc' : '', '" rel="nofollow">', $txt['who_time'], $context['sort_by'] == 'time' ? '<span class="generic_icons sort_' . $context['sort_direction'] . '"></span>' : '', '</a></th>
+							<th scope="col" class="lefttext half_table">', $txt['who_action'], '</th>
 						</tr>
 					</thead>
 					<tbody>';
 
-	// For every member display their name, time and action (and more for admin).
-	$alternate = 0;
-
 	foreach ($context['members'] as $member)
 	{
-		// $alternate will either be true or false. If it's true, use "windowbg2" and otherwise use "windowbg".
 		echo '
-						<tr class="windowbg', $alternate ? '2' : '', '">
+						<tr class="windowbg">
 							<td>';
 
-		// Guests don't have information like icq, msn, y!, and aim... and they can't be messaged.
+		// Guests can't be messaged.
 		if (!$member['is_guest'])
 		{
 			echo '
 								<span class="contact_info floatright">
-									', $context['can_send_pm'] ? '<a href="' . $member['online']['href'] . '" title="' . $member['online']['label'] . '">' : '', $settings['use_image_buttons'] ? '<img src="' . $member['online']['image_href'] . '" alt="' . $member['online']['text'] . '" align="bottom" />' : $member['online']['text'], $context['can_send_pm'] ? '</a>' : '', '
-									', isset($context['disabled_fields']['icq']) ? '' : $member['icq']['link'] , ' ', isset($context['disabled_fields']['msn']) ? '' : $member['msn']['link'], ' ', isset($context['disabled_fields']['yim']) ? '' : $member['yim']['link'], ' ', isset($context['disabled_fields']['aim']) ? '' : $member['aim']['link'], '
+									', $context['can_send_pm'] ? '<a href="' . $member['online']['href'] . '" title="' . $member['online']['text'] . '">' : '', $settings['use_image_buttons'] ? '<span class="' . ($member['online']['is_online'] == 1 ? 'on' : 'off') . '" title="' . $member['online']['text'] . '"></span>' : $member['online']['label'], $context['can_send_pm'] ? '</a>' : '', '
 								</span>';
 		}
 
@@ -80,20 +75,17 @@
 
 		echo '
 							</td>
-							<td nowrap="nowrap">', $member['time'], '</td>
+							<td class="time">', $member['time'], '</td>
 							<td>', $member['action'], '</td>
 						</tr>';
-
-		// Switch alternate to whatever it wasn't this time. (true -> false -> true -> false, etc.)
-		$alternate = !$alternate;
 	}
 
 	// No members?
 	if (empty($context['members']))
 	{
 		echo '
-						<tr class="windowbg2">
-							<td colspan="3" align="center">
+						<tr class="windowbg">
+							<td colspan="3">
 							', $txt['who_no_online_' . ($context['show_by'] == 'guests' || $context['show_by'] == 'spiders' ? $context['show_by'] : 'members')], '
 							</td>
 						</tr>';
@@ -102,22 +94,22 @@
 	echo '
 					</tbody>
 				</table>
-			</div>
-			<div class="pagesection">
-				<div class="pagelinks floatleft">', $txt['pages'], ': ', $context['page_index'], '</div>';
+				<div class="pagesection" id="lower_pagesection">
+					<div class="pagelinks floatleft" id="lower_pagelinks">', $context['page_index'], '</div>';
 
 	echo '
-				<div class="selectbox floatright">', $txt['who_show1'], '
-					<select name="show" onchange="document.forms.whoFilter.submit();">';
+					<div class="selectbox floatright">', $txt['who_show1'], '
+						<select name="show" onchange="document.forms.whoFilter.submit();">';
 
 	foreach ($context['show_methods'] as $value => $label)
 		echo '
-						<option value="', $value, '" ', $value == $context['show_by'] ? ' selected="selected"' : '', '>', $label, '</option>';
+							<option value="', $value, '" ', $value == $context['show_by'] ? ' selected' : '', '>', $label, '</option>';
 	echo '
-					</select>
-					<noscript>
-						<input type="submit" value="', $txt['go'], '" class="button_submit" />
-					</noscript>
+						</select>
+						<noscript>
+							<input type="submit" value="', $txt['go'], '" class="button_submit">
+						</noscript>
+					</div>
 				</div>
 			</div>
 		</form>
@@ -140,11 +132,7 @@
 		if (isset($section['pretext']))
 		echo '
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<p>', $section['pretext'], '</p>
-			</div>
-			<span class="botslice"><span></span></span>
+			<p>', $section['pretext'], '</p>
 		</div>';
 
 		if (isset($section['title']))
@@ -155,18 +143,16 @@
 
 		echo '
 		<div class="windowbg2">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl>';
+			<dl>';
 
 		foreach ($section['groups'] as $group)
 		{
 			if (isset($group['title']))
 				echo '
-					<dt>
-						<strong>', $group['title'], '</strong>
-					</dt>
-					<dd>';
+				<dt>
+					<strong>', $group['title'], '</strong>
+				</dt>
+				<dd>';
 
 			// Try to make this read nicely.
 			if (count($group['members']) <= 2)
@@ -178,50 +164,98 @@
 			}
 
 			echo '
-					</dd>';
+				</dd>';
 		}
 
 		echo '
-				</dl>';
+			</dl>';
 
 		if (isset($section['posttext']))
 			echo '
 				<p class="posttext">', $section['posttext'], '</p>';
 
 		echo '
-			</div>
-			<span class="botslice"><span></span></span>
 		</div>';
 	}
 
+	// Other software and graphics
+	if (!empty($context['credits_software_graphics']))
+	{
+		echo '
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['credits_software_graphics'], '</h3>
+		</div>
+		<div class="windowbg">';
+
+		if (!empty($context['credits_software_graphics']['graphics']))
+			echo '
+			<dl>
+				<dt><strong>', $txt['credits_graphics'], '</strong></dt>
+				<dd>', implode('</dd><dd>', $context['credits_software_graphics']['graphics']), '</dd>
+			</dl>';
+
+		if (!empty($context['credits_software_graphics']['software']))
+			echo '
+			<dl>
+				<dt><strong>', $txt['credits_software'], '</strong></dt>
+				<dd>', implode('</dd><dd>', $context['credits_software_graphics']['software']), '</dd>
+			</dl>';
+
+		if (!empty($context['credits_software_graphics']['fonts']))
+			echo '
+			<dl>
+				<dt><strong>', $txt['credits_fonts'], '</strong></dt>
+				<dd>', implode('</dd><dd>', $context['credits_software_graphics']['fonts']), '</dd>
+			</dl>';
+		echo '
+		</div>';
+	}
+
+	// How about Modifications, we all love em
+	if (!empty($context['credits_modifications']))
+	{
+		echo '
+		<div class="cat_bar">
+			<h3 class="catbg">', $txt['credits_modifications'], '</h3>
+		</div>
+		<div class="windowbg">';
+
+		echo '
+			<dl>
+				<dt><strong>', $txt['credits_modifications'], '</strong></dt>
+				<dd>', implode('</dd><dd>', $context['credits_modifications']), '</dd>
+			</dl>';
+
+		echo '
+		</div>';
+	}
+
+	// SMF itself
 	echo '
 		<div class="cat_bar">
 			<h3 class="catbg">', $txt['credits_copyright'], '</h3>
 		</div>
 		<div class="windowbg">
-			<span class="topslice"><span></span></span>
-			<div class="content">
-				<dl>
-					<dt><strong>', $txt['credits_forum'], '</strong></dt>', '
-					<dd>', $context['copyrights']['smf'];
+			<dl>
+				<dt><strong>', $txt['credits_forum'], '</strong></dt>', '
+				<dd>', $context['copyrights']['smf'];
 
 	echo '
-					</dd>
-				</dl>';
+				</dd>
+			</dl>';
 
 	if (!empty($context['copyrights']['mods']))
 	{
 		echo '
-				<dl>
-					<dt><strong>', $txt['credits_modifications'], '</strong></dt>
-					<dd>', implode('</dd><dd>', $context['copyrights']['mods']), '</dd>
-				</dl>';
+			<dl>
+				<dt><strong>', $txt['credits_modifications'], '</strong></dt>
+				<dd>', implode('</dd><dd>', $context['copyrights']['mods']), '</dd>
+			</dl>';
 	}
 
 	echo '
-			</div>
-			<span class="botslice"><span></span></span>
 		</div>
 	</div>';
 }
+
 ?>
\ No newline at end of file
diff -ru a/Themes/default/Wireless.template.php b/Themes/default/Wireless.template.php
--- a/Themes/default/Wireless.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Wireless.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,18 +3,33 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
+// Define page index info for wireless templates
+function template_wireless_init()
+{
+	global $settings, $txt;
+
+	// This defines the formatting for the page indexes used throughout the forumm.
+	$settings['page_index'] = array(
+		'extra_before' => '<span class="pages">' . $txt['pages'] . ': </span>',
+		'previous_page' => '<span class="previous_page"></span>',
+		'current_page' => '<span class="current_page">[%1$d]</span> ',
+		'page' => '<a class="navPages" href="{URL}">%2$s</a> ',
+		'expand_pages' => '<span class="expand_pages" onclick="expandPages(this, {LINK}, {FIRST_PAGE}, {LAST_PAGE}, {PER_PAGE});"> ... </span>',
+		'next_page' => '<span class="next_page"></span>',
+		'extra_after' => '',
+	);
+}
+
 // This is the header for WAP 1.1 output. You can view it with ?wap in the URL.
 function template_wap_above()
 {
-	global $context, $settings, $options;
-
 	// Show the xml declaration...
 	echo '<?xml version="1.0"?', '>
 <!DOCTYPE wml PUBLIC "-//WAPFORUM//DTD WML 1.1//EN" "http://www.wapforum.org/DTD/wml_1.1.xml">
@@ -26,7 +41,7 @@
 // This is the board index (main page) in WAP 1.1.
 function template_wap_boardindex()
 {
-	global $context, $settings, $options, $scripturl;
+	global $context, $scripturl;
 
 	// This is the "main" card...
 	echo '
@@ -67,7 +82,7 @@
 // This is the message index (list of topics in a board) for WAP 1.1.
 function template_wap_messageindex()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<card id="main" title="', $context['page_title'], '">
@@ -101,7 +116,7 @@
 
 function template_wap_display()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 
 	echo '
 	<card id="main" title="', $context['page_title'], '">
@@ -158,17 +173,7 @@
 		<input type="text" name="user" class="input_text" /></p>
 
 		<p>', $txt['password'], ':<br />
-		<input type="password" name="passwrd" class="input_password" /></p>';
-
-	// Open ID?
-	if (!empty($modSettings['enableOpenID']))
-		echo '
-		<p><strong>&mdash;', $txt['or'], '&mdash;</strong></p>
-
-		<p>', $txt['openid'], ':<br />
-		<input type="text" name="openid_identifier" class="input_text openid_login" size="17" /></p>';
-
-	echo '
+		<input type="password" name="passwrd" class="input_password" /></p>
 		<p><do type="accept" label="', $txt['login'], '">
 			<go method="post" href="', $scripturl, '?action=login2;wap">
 				<postfield name="user" value="$user" />
@@ -181,7 +186,7 @@
 
 function template_wap_recent()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 	<card id="recent" title="', $context['page_title'], '">
@@ -207,7 +212,7 @@
 
 function template_wap_error()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 	<card id="main" title="', $context['page_title'], '">
@@ -219,7 +224,7 @@
 
 function template_wap_below()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 
 	echo '
 	<card id="switch" title="', $txt['wireless_go_to_full_version'], '">
@@ -233,12 +238,12 @@
 // The cHTML protocol used for i-mode starts here.
 function template_imode_above()
 {
-	global $context, $settings, $options, $user_info;
+	global $context, $user_info;
 
 	echo '<!DOCTYPE HTML PUBLIC "-//W3C//DTD Compact HTML 1.0 Draft//EN">
 <html', $context['right_to_left'] ? ' dir="rtl"' : '', '>
 	<head>
-		<meta http-equiv="Content-Type" content="text/html; charset=', $context['character_set'], '" />';
+		<meta charset="', $context['character_set'], '" />';
 
 	// Present a canonical url for search engines to prevent duplicate content in their indices.
 	if ($user_info['is_guest'] && !empty($context['canonical_url']))
@@ -253,11 +258,16 @@
 
 function template_imode_boardindex()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<table border="0" cellspacing="0" cellpadding="0">
 			<tr bgcolor="#6d92aa"><td><font color="#ffffff">', $context['forum_name_html_safe'], '</font></td></tr>';
+	if (!$context['user']['is_guest'])
+		echo '
+			<tr><td><a href="', $scripturl, '?action=unread;imode">', $txt['wireless_recent_unread_posts'], '</a></td></tr>
+			<tr><td><a href="', $scripturl, '?action=unreadreplies;imode">', $txt['wireless_recent_unread_replies'], '</a></td></tr>';
+
 	$count = 0;
 	foreach ($context['categories'] as $category)
 	{
@@ -283,8 +293,6 @@
 			echo '
 			<tr><td><a href="', $scripturl, '?action=pm;imode">', empty($context['user']['unread_messages']) ? $txt['wireless_pm_inbox'] : sprintf($txt['wireless_pm_inbox_new'], $context['user']['unread_messages']), '</a></td></tr>';
 		echo '
-			<tr><td><a href="', $scripturl, '?action=unread;imode">', $txt['wireless_recent_unread_posts'], '</a></td></tr>
-			<tr><td><a href="', $scripturl, '?action=unreadreplies;imode">', $txt['wireless_recent_unread_replies'], '</a></td></tr>
 			<tr><td><a href="', $scripturl, '?action=logout;', $context['session_var'], '=', $context['session_id'], ';imode">', $txt['wireless_options_logout'], '</a></td></tr>';
 	}
 	echo '
@@ -293,7 +301,7 @@
 
 function template_imode_messageindex()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<table border="0" cellspacing="0" cellpadding="0">
@@ -302,7 +310,7 @@
 	if (!empty($context['boards']))
 	{
 		echo '
-		<tr bgcolor="#b6dbff"><td>', $txt['parent_boards'], '</td></tr>';
+		<tr bgcolor="#b6dbff"><td>', $txt['sub_boards'], '</td></tr>';
 		foreach ($context['boards'] as $board)
 			echo '
 		<tr><td>', $board['new'] ? '<font color="#ff0000">-</font> ' : ($board['children_new'] ? '-<font color="#ff0000">.</font>' : '- '), '<a href="', $scripturl, '?board=', $board['id'], '.0;imode">', $board['name'], '</a></td></tr>';
@@ -332,7 +340,7 @@
 
 function template_imode_display()
 {
-	global $context, $settings, $options, $scripturl, $board, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<table border="0" cellspacing="0" cellpadding="0">
@@ -396,9 +404,9 @@
 
 function template_imode_post()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $options, $scripturl, $txt, $modSettings;
 
-	// !!! $modSettings['guest_post_no_email']
+	// @todo $modSettings['guest_post_no_email']
 	echo '
 		<form action="', $scripturl, '?action=', $context['destination'], ';board=', $context['current_board'], '.0;imode" method="post">
 			<table border="0" cellspacing="0" cellpadding="0">';
@@ -423,7 +431,7 @@
 				<tr><td><input type="text" name="email" value="', $context['email'], '" class="input_text" /></td></tr>';
 	}
 
-	// !!! Needs a more specific imode template.
+	// @todo Needs a more specific imode template.
 	if ($context['require_verification'])
 		echo '
 				<tr><td>', !empty($context['post_error']['need_qr_verification']) ? '<font color="#cc0000">' . $txt['verification'] . '</font>' : $txt['verification'], ':</td></tr>
@@ -452,7 +460,7 @@
 
 function template_imode_login()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 		<form action="', $scripturl, '?action=login2;imode" method="post">
@@ -466,16 +474,7 @@
 				<tr><td>', $txt['username'], ':</td></tr>
 				<tr><td><input type="text" name="user" size="10" class="input_text" /></td></tr>
 				<tr><td>', $txt['password'], ':</td></tr>
-				<tr><td><input type="password" name="passwrd" size="10" class="input_password" /></td></tr>';
-
-	// Open ID?
-	if (!empty($modSettings['enableOpenID']))
-		echo '
-				<tr><td><strong>&mdash;', $txt['or'], '&mdash;</strong></td></tr>
-				<tr><td>', $txt['openid'], ':</td></tr>
-				<tr><td><input type="text" name="openid_identifier" class="input_text openid_login" size="17" /></td></tr>';
-
-	echo '
+				<tr><td><input type="password" name="passwrd" size="10" class="input_password" /></td></tr>
 				<tr><td><input type="submit" value="', $txt['login'], '" class="button_submit" /><input type="hidden" name="cookieneverexp" value="1" /></td></tr>
 				<tr bgcolor="#b6dbff"><td>', $txt['wireless_navigation'], '</td></tr>
 				<tr><td>[0] <a href="', $scripturl, '?imode" accesskey="0">', $txt['wireless_navigation_up'], '</a></td></tr>
@@ -485,7 +484,7 @@
 
 function template_imode_pm()
 {
-	global $context, $settings, $options, $scripturl, $txt, $user_info;
+	global $context, $scripturl, $txt, $user_info;
 
 	if ($_REQUEST['action'] == 'findmember')
 	{
@@ -597,7 +596,6 @@
 						</tr></td>
 						<tr><td>
 							<input type="submit" value="', $txt['send_message'], '" class="button_submit" />
-							<input type="hidden" name="outbox" value="', $context['copy_to_outbox'] ? '1' : '0', '" />
 							<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
 							<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '" />
 							<input type="hidden" name="replied_to" value="', !empty($context['quoted_message']['id']) ? $context['quoted_message']['id'] : 0, '" />
@@ -702,7 +700,7 @@
 
 function template_imode_recent()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<table border="0" cellspacing="0" cellpadding="0">
@@ -733,7 +731,7 @@
 
 function template_imode_error()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 		<table border="0" cellspacing="0" cellpadding="0">
@@ -745,7 +743,7 @@
 
 function template_imode_profile()
 {
-	global $context, $settings, $options, $scripturl, $board, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<table border="0" cellspacing="0" cellpadding="0">
@@ -795,7 +793,7 @@
 
 function template_imode_ban_edit()
 {
-	global $context, $settings, $options, $scripturl, $board, $txt, $modSettings;
+	global $context, $scripturl, $board, $txt, $modSettings;
 
 	echo '
 	<form action="', $scripturl, '?action=admin;area=ban;sa=add;imode" method="post">
@@ -808,7 +806,7 @@
 			<tr><td>
 				<strong>', $txt['ban_expiration'], ': </strong><br />
 				<input type="radio" name="expiration" value="never" ', $context['ban']['expiration']['status'] == 'never' ? ' checked="checked"' : '', ' class="input_radio" /> ', $txt['never'], '<br />
-				<input type="radio" name="expiration" value="one_day" ', $context['ban']['expiration']['status'] == 'still_active_but_we_re_counting_the_days' ? ' checked="checked"' : '', ' class="input_radio" /> ', $txt['ban_will_expire_within'], ' <input type="text" name="expire_date" size="3" value="', $context['ban']['expiration']['days'], '" /> ', $txt['ban_days'], '<br />
+				<input type="radio" name="expiration" value="one_day" ', $context['ban']['expiration']['status'] == 'one_day' ? ' checked="checked"' : '', ' class="input_radio" /> ', $txt['ban_will_expire_within'], ' <input type="text" name="expire_date" size="3" value="', $context['ban']['expiration']['days'], '" /> ', $txt['ban_days'], '<br />
 				<input type="radio" name="expiration" value="expired" ', $context['ban']['expiration']['status'] == 'expired' ? ' checked="checked"' : '', ' class="input_radio" /> ', $txt['ban_expired'], '<br />
 			</td></tr>
 			<tr><td>
@@ -832,24 +830,24 @@
 		echo '
 			<tr bgcolor="#b6dbff"><td>', $txt['ban_triggers'], '</td></tr>
 			<tr><td>
-				<input type="checkbox" name="ban_suggestion[]" value="main_ip" class="input_check" /> <strong>', $txt['wireless_ban_ip'], ':</strong><br />
+				<input type="checkbox" name="ban_suggestions[]" value="main_ip" class="input_check" /> <strong>', $txt['wireless_ban_ip'], ':</strong><br />
 				&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="main_ip" value="', $context['ban_suggestions']['main_ip'], '" size="20" class="input_text" />
 			</td></tr>';
 
 		if (empty($modSettings['disableHostnameLookup']))
 			echo '
 			<tr><td>
-				<input type="checkbox" name="ban_suggestion[]" value="hostname" class="input_check" /> <strong>', $txt['wireless_ban_hostname'], ':</strong><br />
+				<input type="checkbox" name="ban_suggestions[]" value="hostname" class="input_check" /> <strong>', $txt['wireless_ban_hostname'], ':</strong><br />
 				&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="hostname" value="', $context['ban_suggestions']['hostname'], '" size="20" class="input_text" />
 			</td></tr>';
 
 		echo '
 			<tr><td>
-				<input type="checkbox" name="ban_suggestion[]" value="email" class="input_check" /> <strong>', $txt['wireless_ban_email'], ':</strong><br />
+				<input type="checkbox" name="ban_suggestions[]" value="email" class="input_check" /> <strong>', $txt['wireless_ban_email'], ':</strong><br />
 				&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="email" value="', $context['ban_suggestions']['email'], '" size="20" class="input_text" />
 			</td></tr>
 			<tr><td>
-				<input type="checkbox" name="ban_suggestion[]" value="user" class="input_check" /> <strong>', $txt['ban_on_username'], ':</strong><br />';
+				<input type="checkbox" name="ban_suggestions[]" value="user" class="input_check" /> <strong>', $txt['ban_on_username'], ':</strong><br />';
 
 		if (empty($context['ban_suggestions']['member']['id']))
 			echo '
@@ -878,7 +876,7 @@
 
 function template_imode_below()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 
 	echo '
 		<br /><a href="', $context['linktree'][count($context['linktree']) - 1]['url'], (count($context['linktree']) > 1 ? ';' : '?'), 'nowap" rel="nofollow">', $txt['wireless_go_to_full_version'], '</a>
@@ -889,7 +887,7 @@
 // XHTMLMP (XHTML Mobile Profile) templates used for WAP 2.0 start here
 function template_wap2_above()
 {
-	global $context, $settings, $options, $user_info;
+	global $context, $settings, $user_info, $modSettings;
 
 	echo '<?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <!DOCTYPE html PUBLIC "-//WAPFORUM//DTD XHTML Mobile 1.0//EN" "http://www.wapforum.org/DTD/xhtml-mobile10.dtd">
@@ -903,17 +901,21 @@
 		<link rel="canonical" href="', $context['canonical_url'], '" />';
 
 	echo '
-		<link rel="stylesheet" href="', $settings['default_theme_url'], '/css/wireless.css" type="text/css" />
+		<link rel="stylesheet" href="', $settings['default_theme_url'], '/css/wireless.css" type="text/css', $modSettings['browser_cache'] ,'" />
 	</head>
 	<body>';
 }
 
 function template_wap2_boardindex()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<p class="catbg">', $context['forum_name_html_safe'], '</p>';
+	if (!$context['user']['is_guest'])
+		echo '
+		<p class="windowbg"><a href="', $scripturl, '?action=unread;wap2">', $txt['wireless_recent_unread_posts'], '</a></p>
+		<p class="windowbg"><a href="', $scripturl, '?action=unreadreplies;wap2">', $txt['wireless_recent_unread_replies'], '</a></p>';
 
 	$count = 0;
 	foreach ($context['categories'] as $category)
@@ -941,15 +943,13 @@
 			echo '
 			<p class="windowbg"><a href="', $scripturl, '?action=pm;wap2">', empty($context['user']['unread_messages']) ? $txt['wireless_pm_inbox'] : sprintf($txt['wireless_pm_inbox_new'], $context['user']['unread_messages']), '</a></p>';
 		echo '
-		<p class="windowbg"><a href="', $scripturl, '?action=unread;wap2">', $txt['wireless_recent_unread_posts'], '</a></p>
-		<p class="windowbg"><a href="', $scripturl, '?action=unreadreplies;wap2">', $txt['wireless_recent_unread_replies'], '</a></p>
 		<p class="windowbg"><a href="', $scripturl, '?action=logout;', $context['session_var'], '=', $context['session_id'], ';wap2">', $txt['wireless_options_logout'], '</a></p>';
 	}
 }
 
 function template_wap2_messageindex()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<p class="catbg">', $context['name'], '</p>';
@@ -957,7 +957,7 @@
 	if (!empty($context['boards']))
 	{
 		echo '
-		<p class="titlebg">', $txt['parent_boards'], '</p>';
+		<p class="titlebg">', $txt['sub_boards'], '</p>';
 		foreach ($context['boards'] as $board)
 			echo '
 		<p class="windowbg">', $board['new'] ? '<span class="updated">[-] </span>' : ($board['children_new'] ? '[-<span class="updated">] </span>' : '[-] '), '<a href="', $scripturl, '?board=', $board['id'], '.0;wap2">', $board['name'], '</a></p>';
@@ -987,13 +987,13 @@
 
 function template_wap2_display()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<p class="titlebg">' . $context['linktree'][1]['name'] . ' > ' . $context['linktree'][count($context['linktree']) - 2]['name'] . '</p>
 		<p class="catbg">', $context['subject'], '</p>
 		<p class="windowbg">', !empty($context['links']['prev']) ? '<a href="' . $context['links']['first'] . ';wap2">&lt;&lt;</a> <a href="' . $context['links']['prev'] . ';wap2">&lt;</a> ' : '', '(', $context['page_info']['current_page'], '/', $context['page_info']['num_pages'], ')', !empty($context['links']['next']) ? ' <a href="' . $context['links']['next'] . ';wap2">&gt;</a> <a href="' . $context['links']['last'] . ';wap2">&gt;&gt;</a> ' : '', '</p>';
-	$alternate = true;
+
 	while ($message = $context['get_message']())
 	{
 		// This is a special modification to the post so it will work on phones:
@@ -1018,12 +1018,11 @@
 
 		echo $message['first_new'] ? '
 		<a id="new"></a>' : '', '
-		<p class="windowbg', $alternate ? '' : '2', '">
+		<p class="windowbg">
 			', $context['wireless_moderate'] && $message['member']['id'] ? '<a href="' . $scripturl . '?action=profile;u=' . $message['member']['id'] . ';wap2">' . $message['member']['name'] . '</a>' : '<strong>' . $message['member']['name'] . '</strong>', ':
 			', ((empty($context['wireless_more']) && $message['can_modify']) || !empty($context['wireless_moderate']) ? '[<a href="' . $scripturl . '?action=post;msg=' . $message['id'] . ';topic=' . $context['current_topic'] . '.' . $context['start'] . ';wap2">' . $txt['wireless_display_edit'] . '</a>]' : ''), (!$message['approved'] ? '&nbsp;<em>(' . $txt['awaiting_approval'] . ')</em>' : ''), '<br />
 			', $message['body'], '
 		</p>';
-		$alternate = !$alternate;
 	}
 	echo '
 		<p class="titlebg">', $txt['wireless_navigation'], '</p>
@@ -1064,16 +1063,7 @@
 			<p class="windowbg">', $txt['username'], ':</p>
 			<p class="windowbg"><input type="text" name="user" size="10" class="input_text" /></p>
 			<p class="windowbg">', $txt['password'], ':</p>
-			<p class="windowbg"><input type="password" name="passwrd" size="10" class="input_password" /></p>';
-
-	// Open ID?
-	if (!empty($modSettings['enableOpenID']))
-		echo '
-			<p class="windowbg"><strong>&mdash;', $txt['or'], '&mdash;</strong></p>
-			<p class="windowbg">', $txt['openid'], ':</p>
-			<p class="windowbg"><input type="text" name="openid_identifier" class="input_text openid_login" size="17" /></p>';
-
-	echo '
+			<p class="windowbg"><input type="password" name="passwrd" size="10" class="input_password" /></p>
 			<p class="windowbg"><input type="submit" value="', $txt['login'], '" class="button_submit" /><input type="hidden" name="cookieneverexp" value="1" /></p>
 			<p class="catbg">', $txt['wireless_navigation'], '</p>
 			<p class="windowbg">[0] <a href="', $scripturl, '?wap2" accesskey="0">', $txt['wireless_navigation_up'], '</a></p>
@@ -1082,7 +1072,7 @@
 
 function template_wap2_post()
 {
-	global $context, $settings, $options, $scripturl, $txt, $modSettings;
+	global $context, $options, $scripturl, $txt, $modSettings;
 
 	echo '
 		<form action="', $scripturl, '?action=', $context['destination'], ';board=', $context['current_board'], '.0;wap2" method="post">
@@ -1144,7 +1134,7 @@
 
 function template_wap2_pm()
 {
-	global $context, $settings, $options, $scripturl, $txt, $user_info;
+	global $context, $scripturl, $txt, $user_info;
 
 	if ($_REQUEST['action'] == 'findmember')
 	{
@@ -1249,7 +1239,6 @@
 					</p>
 					<p class="windowbg">
 						<input type="submit" value="', $txt['send_message'], '" class="button_submit" />
-						<input type="hidden" name="outbox" value="', $context['copy_to_outbox'] ? '1' : '0', '" />
 						<input type="hidden" name="', $context['session_var'], '" value="', $context['session_id'], '" />
 						<input type="hidden" name="seqnum" value="', $context['form_sequence_number'], '" />
 						<input type="hidden" name="replied_to" value="', !empty($context['quoted_message']['id']) ? $context['quoted_message']['id'] : 0, '" />
@@ -1351,7 +1340,7 @@
 
 function template_wap2_recent()
 {
-	global $context, $settings, $options, $scripturl, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<p class="catbg">', $_REQUEST['action'] == 'unread' ? $txt['wireless_recent_unread_posts'] : $txt['wireless_recent_unread_replies'], '</p>';
@@ -1380,7 +1369,7 @@
 
 function template_wap2_error()
 {
-	global $context, $settings, $options, $txt, $scripturl;
+	global $context, $txt, $scripturl;
 
 	echo '
 		<p class="catbg">', $context['error_title'], '</p>
@@ -1390,7 +1379,7 @@
 
 function template_wap2_profile()
 {
-	global $context, $settings, $options, $scripturl, $board, $txt;
+	global $context, $scripturl, $txt;
 
 	echo '
 		<p class="catbg">', $txt['summary'], ' - ', $context['member']['name'], '</p>
@@ -1428,7 +1417,7 @@
 
 function template_wap2_ban_edit()
 {
-	global $context, $settings, $options, $scripturl, $board, $txt, $modSettings;
+	global $context, $scripturl, $txt, $modSettings;
 
 	echo '
 	<form action="', $scripturl, '?action=admin;area=ban;sa=add;wap2" method="post">
@@ -1440,7 +1429,7 @@
 		<p class="windowbg">
 			<strong>', $txt['ban_expiration'], ': </strong><br />
 			<input type="radio" name="expiration" value="never" ', $context['ban']['expiration']['status'] == 'never' ? ' checked="checked"' : '', ' class="input_radio" /> ', $txt['never'], '<br />
-			<input type="radio" name="expiration" value="one_day" ', $context['ban']['expiration']['status'] == 'still_active_but_we_re_counting_the_days' ? ' checked="checked"' : '', ' class="input_radio" /> ', $txt['ban_will_expire_within'], ' <input type="text" name="expire_date" size="3" value="', $context['ban']['expiration']['days'], '" /> ', $txt['ban_days'], '<br />
+			<input type="radio" name="expiration" value="one_day" ', $context['ban']['expiration']['status'] == 'one_day' ? ' checked="checked"' : '', ' class="input_radio" /> ', $txt['ban_will_expire_within'], ' <input type="text" name="expire_date" size="3" value="', $context['ban']['expiration']['days'], '" /> ', $txt['ban_days'], '<br />
 			<input type="radio" name="expiration" value="expired" ', $context['ban']['expiration']['status'] == 'expired' ? ' checked="checked"' : '', ' class="input_radio" /> ', $txt['ban_expired'], '<br />
 		</p>
 		<p class="windowbg">
@@ -1464,24 +1453,24 @@
 		echo '
 		<p class="titlebg">', $txt['ban_triggers'], '</p>
 		<p class="windowbg">
-			<input type="checkbox" name="ban_suggestion[]" value="main_ip" class="input_check" /> <strong>', $txt['wireless_ban_ip'], ':</strong><br />
+			<input type="checkbox" name="ban_suggestions[]" value="main_ip" class="input_check" /> <strong>', $txt['wireless_ban_ip'], ':</strong><br />
 			&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="main_ip" value="', $context['ban_suggestions']['main_ip'], '" size="20" class="input_text" />
 		</p>';
 
 		if (empty($modSettings['disableHostnameLookup']))
 			echo '
 		<p class="windowbg">
-			<input type="checkbox" name="ban_suggestion[]" value="hostname" class="input_check" /> <strong>', $txt['wireless_ban_hostname'], ':</strong><br />
+			<input type="checkbox" name="ban_suggestions[]" value="hostname" class="input_check" /> <strong>', $txt['wireless_ban_hostname'], ':</strong><br />
 			&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="hostname" value="', $context['ban_suggestions']['hostname'], '" size="20" class="input_text" />
 		<p>';
 
 		echo '
 		<p class="windowbg">
-			<input type="checkbox" name="ban_suggestion[]" value="email" class="input_check" /> <strong>', $txt['wireless_ban_email'], ':</strong><br />
+			<input type="checkbox" name="ban_suggestions[]" value="email" class="input_check" /> <strong>', $txt['wireless_ban_email'], ':</strong><br />
 			&nbsp;&nbsp;&nbsp;&nbsp;<input type="text" name="email" value="', $context['ban_suggestions']['email'], '" size="20" class="input_text" />
 		</p>
 		<p class="windowbg">
-			<input type="checkbox" name="ban_suggestion[]" value="user" class="input_check" /> <strong>', $txt['ban_on_username'], ':</strong><br />';
+			<input type="checkbox" name="ban_suggestions[]" value="user" class="input_check" /> <strong>', $txt['ban_on_username'], ':</strong><br />';
 
 		if (empty($context['ban_suggestions']['member']['id']))
 			echo '
@@ -1510,7 +1499,7 @@
 
 function template_wap2_below()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 
 	echo '
 		<a href="', $context['linktree'][count($context['linktree']) - 1]['url'], (count($context['linktree']) > 1 ? ';' : '?'), 'nowap" rel="nofollow">', $txt['wireless_go_to_full_version'], '</a>
diff -ru a/Themes/default/Xml.template.php b/Themes/default/Xml.template.php
--- a/Themes/default/Xml.template.php	2011-06-06 09:43:45.000000000 -0700
+++ b/Themes/default/Xml.template.php	2015-03-05 23:30:06.004678068 -0800
@@ -3,16 +3,16 @@
  * Simple Machines Forum (SMF)
  *
  * @package SMF
- * @author Simple Machines
- * @copyright 2011 Simple Machines
+ * @author Simple Machines http://www.simplemachines.org
+ * @copyright 2015 Simple Machines and individual contributors
  * @license http://www.simplemachines.org/about/smf/license.php BSD
  *
- * @version 2.0
+ * @version 2.1 Beta 1
  */
 
 function template_sendbody()
 {
-	global $context, $settings, $options, $txt;
+	global $context;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>
@@ -22,7 +22,7 @@
 
 function template_quotefast()
 {
-	global $context, $settings, $options, $txt;
+	global $context;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>
@@ -32,7 +32,7 @@
 
 function template_modifyfast()
 {
-	global $context, $settings, $options, $txt;
+	global $context;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>
@@ -44,15 +44,19 @@
 
 function template_modifydone()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>
 	<message id="msg_', $context['message']['id'], '">';
 	if (empty($context['message']['errors']))
 	{
+		// Build our string of info about when and why it was modified
+		$modified = empty($context['message']['modified']['time']) ? '' : sprintf($txt['last_edit_by'], $context['message']['modified']['time'], $context['message']['modified']['name']);
+		$modified .= empty($context['message']['modified']['reason']) ? '' : sprintf($txt['last_edit_reason'], $context['message']['modified']['reason']);
+
 		echo '
-		<modified><![CDATA[', empty($context['message']['modified']['time']) ? '' : cleanXml('&#171; <em>' . $txt['last_edit'] . ': ' . $context['message']['modified']['time'] . ' ' . $txt['by'] . ' ' . $context['message']['modified']['name'] . '</em> &#187;'), ']]></modified>
+		<modified><![CDATA[', empty($modified) ? '' : cleanXml('&#171; <em>' . $modified . '</em>&#187;'), ']]></modified>
 		<subject is_first="', $context['message']['first_in_topic'] ? '1' : '0', '"><![CDATA[', cleanXml($context['message']['subject']), ']]></subject>
 		<body><![CDATA[', $context['message']['body'], ']]></body>';
 	}
@@ -66,15 +70,19 @@
 
 function template_modifytopicdone()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>
 	<message id="msg_', $context['message']['id'], '">';
 	if (empty($context['message']['errors']))
 	{
+		// Build our string of info about when and why it was modified
+		$modified = empty($context['message']['modified']['time']) ? '' : sprintf($txt['last_edit_by'], $context['message']['modified']['time'], $context['message']['modified']['name']);
+		$modified .= empty($context['message']['modified']['reason']) ? '' : sprintf($txt['last_edit_reason'], $context['message']['modified']['reason']);
+
 		echo '
-		<modified><![CDATA[', empty($context['message']['modified']['time']) ? '' : cleanXml('&#171; <em>' . $txt['last_edit'] . ': ' . $context['message']['modified']['time'] . ' ' . $txt['by'] . ' ' . $context['message']['modified']['name'] . '</em> &#187;'), ']]></modified>';
+		<modified><![CDATA[', empty($modified) ? '' : cleanXml('&#171; <em>' . $modified . '</em>&#187;'), ']]></modified>';
 		if (!empty($context['message']['subject']))
 			echo '
 		<subject><![CDATA[', cleanXml($context['message']['subject']), ']]></subject>';
@@ -89,7 +97,7 @@
 
 function template_post()
 {
-	global $context, $settings, $options, $txt;
+	global $context;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>
@@ -98,8 +106,8 @@
 		<body><![CDATA[', $context['preview_message'], ']]></body>
 	</preview>
 	<errors serious="', empty($context['error_type']) || $context['error_type'] != 'serious' ? '0' : '1', '" topic_locked="', $context['locked'] ? '1' : '0', '">';
-	if (!empty($context['post_error']['messages']))
-		foreach ($context['post_error']['messages'] as $message)
+	if (!empty($context['post_error']))
+		foreach ($context['post_error'] as $message)
 			echo '
 		<error><![CDATA[', cleanXml($message), ']]></error>';
 	echo '
@@ -132,14 +140,67 @@
 </smf>';
 }
 
+function template_pm()
+{
+	global $context, $txt;
+
+	// @todo something could be removed...otherwise it can be merged again with template_post
+	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
+<smf>
+	<preview>
+		<subject><![CDATA[', $txt['preview'], ' - ', !empty($context['preview_subject']) ? $context['preview_subject'] : $txt['no_subject'], ']]></subject>
+		<body><![CDATA[', $context['preview_message'], ']]></body>
+	</preview>
+	<errors serious="', empty($context['error_type']) || $context['error_type'] != 'serious' ? '0' : '1', '">';
+	if (!empty($context['post_error']['messages']))
+		foreach ($context['post_error']['messages'] as $message)
+			echo '
+		<error><![CDATA[', cleanXml($message), ']]></error>';
+
+	echo '
+		<caption name="to" class="', isset($context['post_error']['no_to']) ? 'error' : '', '" />
+		<caption name="bbc" class="', isset($context['post_error']['no_bbc']) ? 'error' : '', '" />
+		<caption name="subject" class="', isset($context['post_error']['no_subject']) ? 'error' : '', '" />
+		<caption name="question" class="', isset($context['post_error']['no_question']) ? 'error' : '', '" />', isset($context['post_error']['no_message']) || isset($context['post_error']['long_message']) ? '
+		<post_error />' : '', '
+	</errors>';
+
+	echo '
+</smf>';
+}
+
+function template_warning()
+{
+	global $context;
+
+	// @todo something could be removed...otherwise it can be merged again with template_post
+	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
+<smf>
+	<preview>
+		<subject><![CDATA[', $context['preview_subject'], ']]></subject>
+		<body><![CDATA[', $context['preview_message'], ']]></body>
+	</preview>
+	<errors serious="', empty($context['error_type']) || $context['error_type'] != 'serious' ? '0' : '1', '">';
+	if (!empty($context['post_error']['messages']))
+		foreach ($context['post_error']['messages'] as $message)
+			echo '
+		<error><![CDATA[', cleanXml($message), ']]></error>';
+
+	echo '
+	</errors>';
+
+	echo '
+</smf>';
+}
+
 function template_stats()
 {
-	global $context, $settings, $options, $txt, $modSettings;
+	global $context, $modSettings;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>';
 	foreach ($context['yearly'] as $year)
-		foreach ($year['months'] as $month);
+		foreach ($year['months'] as $month)
 		{
 			echo '
 	<month id="', $month['date']['year'], $month['date']['month'], '">';
@@ -155,7 +216,7 @@
 
 function template_split()
 {
-	global $context, $settings, $options;
+	global $context;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>
@@ -195,7 +256,7 @@
 
 function template_results()
 {
-	global $context, $settings, $options, $txt;
+	global $context, $txt;
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>';
 
@@ -257,7 +318,7 @@
 
 function template_jump_to()
 {
-	global $context, $settings, $options;
+	global $context;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>';
@@ -275,7 +336,7 @@
 
 function template_message_icons()
 {
-	global $context, $settings, $options;
+	global $context;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>';
@@ -288,7 +349,7 @@
 
 function template_check_username()
 {
-	global $context, $settings, $options, $txt;
+	global $context;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>
 <smf>
@@ -299,7 +360,7 @@
 // This prints XML in it's most generic form.
 function template_generic_xml()
 {
-	global $context, $settings, $options, $txt;
+	global $context;
 
 	echo '<', '?xml version="1.0" encoding="', $context['character_set'], '"?', '>';
 
@@ -336,54 +397,4 @@
 	echo "\n", str_repeat("\t", $level), '</', $parent_ident, '>';
 }
 
-function template_webslice_header_above()
-{
-	global $settings;
-
-	echo '
-	<link rel="stylesheet" href="', $settings['default_theme_url'], '/css/wireless.css" type="text/css" />';
-}
-
-function template_webslice_header_below()
-{
-}
-
-// This shows a webslice of the recent posts.
-function template_webslice_recent_posts()
-{
-	global $context, $scripturl, $txt;
-
-	echo '
-	<div style="width: 100%; height: 100%; border: 1px solid black; padding: 0; margin: 0 0 0 0; font: 100.01%/100% Verdana, Helvetica, sans-serif;">
-		<div style="background-color: #080436; color: #ffffff; padding: 4px;">
-			', cleanXml($txt['recent_posts']), '
-		</div>';
-
-	$alternate = 0;
-	foreach ($context['recent_posts_data'] as $item)
-	{
-		echo '
-		<div style="background-color: ', $alternate ? '#ECEDF3' : '#F6F6F6', '; font-size: 90%; padding: 2px;">
-			<strong><a href="', $item['link'], '">', cleanXml($item['subject']), '</a></strong> ', cleanXml($txt['by']), ' ', cleanXml(!empty($item['poster']['link']) ? '<a href="' . $item['poster']['link'] . '">' . $item['poster']['name'] . '</a>' : $item['poster']['name']), '
-		</div>';
-		$alternate = !$alternate;
-	}
-
-	echo '
-	</div>
-	<div style="width: 100%; height: 100%; border: 0; padding: 0; margin: 0 0 0 0; font: 100.01%/100% Verdana, Helvetica, sans-serif;">
-		<div style="font-size: xx-small;" class="righttext">';
-
-	if ($context['user']['is_guest'])
-		echo '
-			<a href="', $scripturl, '?action=login">', $txt['login'], '</a>';
-	else
-		echo '
-			', cleanXml($context['user']['name']), ', ', cleanXml($txt['msg_alert_you_have']), ' <a href="', $scripturl, '?action=pm">', cleanXml($context['user']['messages']), ' ', cleanXml($context['user']['messages'] != 1 ? $txt['msg_alert_messages'] : $txt['message_lowercase']), '</a>', cleanXml($txt['newmessages4'] . ' ' . $context['user']['unread_messages']), ' ', cleanXml($context['user']['unread_messages'] == 1 ? $txt['newmessages0'] : $txt['newmessages1']);
-
-	echo '
-		</div>
-	</div>';
-}
-
 ?>
\ No newline at end of file
